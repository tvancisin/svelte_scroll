var app=function(){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t,e,r){return r={path:e,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&r.path)}},t(r,r.exports),r.exports}var i=function(t){return t&&t.Math==Math&&t},n=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof t&&t)||function(){return this}()||Function("return this")(),o=function(t){try{return!!t()}catch(t){return!0}},a=!o((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),s={}.propertyIsEnumerable,l=Object.getOwnPropertyDescriptor,c=l&&!s.call({1:2},1)?function(t){var e=l(this,t);return!!e&&e.enumerable}:s,u={f:c},h=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},A={}.toString,p=function(t){return A.call(t).slice(8,-1)},d="".split,f=o((function(){return!Object("z").propertyIsEnumerable(0)}))?function(t){return"String"==p(t)?d.call(t,""):Object(t)}:Object,m=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t},_=function(t){return f(m(t))},y=function(t){return"object"==typeof t?null!==t:"function"==typeof t},v=function(t,e){if(!y(t))return t;var r,i;if(e&&"function"==typeof(r=t.toString)&&!y(i=r.call(t)))return i;if("function"==typeof(r=t.valueOf)&&!y(i=r.call(t)))return i;if(!e&&"function"==typeof(r=t.toString)&&!y(i=r.call(t)))return i;throw TypeError("Can't convert object to primitive value")},x={}.hasOwnProperty,w=function(t,e){return x.call(t,e)},B=n.document,C=y(B)&&y(B.createElement),E=function(t){return C?B.createElement(t):{}},T=!a&&!o((function(){return 7!=Object.defineProperty(E("div"),"a",{get:function(){return 7}}).a})),I=Object.getOwnPropertyDescriptor,S={f:a?I:function(t,e){if(t=_(t),e=v(e,!0),T)try{return I(t,e)}catch(t){}if(w(t,e))return h(!u.f.call(t,e),t[e])}},M=function(t){if(!y(t))throw TypeError(String(t)+" is not an object");return t},F=Object.defineProperty,P={f:a?F:function(t,e,r){if(M(t),e=v(e,!0),M(r),T)try{return F(t,e,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(t[e]=r.value),t}},L=a?function(t,e,r){return P.f(t,e,h(1,r))}:function(t,e,r){return t[e]=r,t},D=function(t,e){try{L(n,t,e)}catch(r){n[t]=e}return e},U="__core-js_shared__",k=n[U]||D(U,{}),z=Function.toString;"function"!=typeof k.inspectSource&&(k.inspectSource=function(t){return z.call(t)});var R,O,Q,N=k.inspectSource,V=n.WeakMap,H="function"==typeof V&&/native code/.test(N(V)),j=e((function(t){(t.exports=function(t,e){return k[t]||(k[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.9.0",mode:"global",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"})})),G=0,K=Math.random(),q=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++G+K).toString(36)},Z=j("keys"),W=function(t){return Z[t]||(Z[t]=q(t))},X={},$=n.WeakMap;if(H){var Y=k.state||(k.state=new $),J=Y.get,tt=Y.has,et=Y.set;R=function(t,e){return e.facade=t,et.call(Y,t,e),e},O=function(t){return J.call(Y,t)||{}},Q=function(t){return tt.call(Y,t)}}else{var rt=W("state");X[rt]=!0,R=function(t,e){return e.facade=t,L(t,rt,e),e},O=function(t){return w(t,rt)?t[rt]:{}},Q=function(t){return w(t,rt)}}var it,nt,ot={set:R,get:O,has:Q,enforce:function(t){return Q(t)?O(t):R(t,{})},getterFor:function(t){return function(e){var r;if(!y(e)||(r=O(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return r}}},at=e((function(t){var e=ot.get,r=ot.enforce,i=String(String).split("String");(t.exports=function(t,e,o,a){var s,l=!!a&&!!a.unsafe,c=!!a&&!!a.enumerable,u=!!a&&!!a.noTargetGet;"function"==typeof o&&("string"!=typeof e||w(o,"name")||L(o,"name",e),(s=r(o)).source||(s.source=i.join("string"==typeof e?e:""))),t!==n?(l?!u&&t[e]&&(c=!0):delete t[e],c?t[e]=o:L(t,e,o)):c?t[e]=o:D(e,o)})(Function.prototype,"toString",(function(){return"function"==typeof this&&e(this).source||N(this)}))})),st=n,lt=function(t){return"function"==typeof t?t:void 0},ct=function(t,e){return arguments.length<2?lt(st[t])||lt(n[t]):st[t]&&st[t][e]||n[t]&&n[t][e]},ut=Math.ceil,ht=Math.floor,At=function(t){return isNaN(t=+t)?0:(t>0?ht:ut)(t)},pt=Math.min,dt=function(t){return t>0?pt(At(t),9007199254740991):0},ft=Math.max,mt=Math.min,gt=function(t,e){var r=At(t);return r<0?ft(r+e,0):mt(r,e)},_t=function(t){return function(e,r,i){var n,o=_(e),a=dt(o.length),s=gt(i,a);if(t&&r!=r){for(;a>s;)if((n=o[s++])!=n)return!0}else for(;a>s;s++)if((t||s in o)&&o[s]===r)return t||s||0;return!t&&-1}},yt={includes:_t(!0),indexOf:_t(!1)},vt=yt.indexOf,xt=function(t,e){var r,i=_(t),n=0,o=[];for(r in i)!w(X,r)&&w(i,r)&&o.push(r);for(;e.length>n;)w(i,r=e[n++])&&(~vt(o,r)||o.push(r));return o},wt=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],bt=wt.concat("length","prototype"),Bt={f:Object.getOwnPropertyNames||function(t){return xt(t,bt)}},Ct={f:Object.getOwnPropertySymbols},Et=ct("Reflect","ownKeys")||function(t){var e=Bt.f(M(t)),r=Ct.f;return r?e.concat(r(t)):e},Tt=function(t,e){for(var r=Et(e),i=P.f,n=S.f,o=0;o<r.length;o++){var a=r[o];w(t,a)||i(t,a,n(e,a))}},It=/#|\.prototype\./,St=function(t,e){var r=Ft[Mt(t)];return r==Lt||r!=Pt&&("function"==typeof e?o(e):!!e)},Mt=St.normalize=function(t){return String(t).replace(It,".").toLowerCase()},Ft=St.data={},Pt=St.NATIVE="N",Lt=St.POLYFILL="P",Dt=St,Ut=S.f,kt=function(t,e){var r,i,o,a,s,l=t.target,c=t.global,u=t.stat;if(r=c?n:u?n[l]||D(l,{}):(n[l]||{}).prototype)for(i in e){if(a=e[i],o=t.noTargetGet?(s=Ut(r,i))&&s.value:r[i],!Dt(c?i:l+(u?".":"#")+i,t.forced)&&void 0!==o){if(typeof a==typeof o)continue;Tt(a,o)}(t.sham||o&&o.sham)&&L(a,"sham",!0),at(r,i,a,t)}},zt=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t},Rt=function(t,e,r){if(zt(t),void 0===e)return t;switch(r){case 0:return function(){return t.call(e)};case 1:return function(r){return t.call(e,r)};case 2:return function(r,i){return t.call(e,r,i)};case 3:return function(r,i,n){return t.call(e,r,i,n)}}return function(){return t.apply(e,arguments)}},Ot=function(t){return Object(m(t))},Qt=Array.isArray||function(t){return"Array"==p(t)},Nt=!!Object.getOwnPropertySymbols&&!o((function(){return!String(Symbol())})),Vt=Nt&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Ht=j("wks"),jt=n.Symbol,Gt=Vt?jt:jt&&jt.withoutSetter||q,Kt=function(t){return w(Ht,t)||(Nt&&w(jt,t)?Ht[t]=jt[t]:Ht[t]=Gt("Symbol."+t)),Ht[t]},qt=Kt("species"),Zt=function(t,e){var r;return Qt(t)&&("function"!=typeof(r=t.constructor)||r!==Array&&!Qt(r.prototype)?y(r)&&null===(r=r[qt])&&(r=void 0):r=void 0),new(void 0===r?Array:r)(0===e?0:e)},Wt=[].push,Xt=function(t){var e=1==t,r=2==t,i=3==t,n=4==t,o=6==t,a=7==t,s=5==t||o;return function(l,c,u,h){for(var A,p,d=Ot(l),m=f(d),g=Rt(c,u,3),_=dt(m.length),y=0,v=h||Zt,x=e?v(l,_):r||a?v(l,0):void 0;_>y;y++)if((s||y in m)&&(p=g(A=m[y],y,d),t))if(e)x[y]=p;else if(p)switch(t){case 3:return!0;case 5:return A;case 6:return y;case 2:Wt.call(x,A)}else switch(t){case 4:return!1;case 7:Wt.call(x,A)}return o?-1:i||n?n:x}},$t={forEach:Xt(0),map:Xt(1),filter:Xt(2),some:Xt(3),every:Xt(4),find:Xt(5),findIndex:Xt(6),filterOut:Xt(7)},Yt=ct("navigator","userAgent")||"",Jt=n.process,te=Jt&&Jt.versions,ee=te&&te.v8;ee?nt=(it=ee.split("."))[0]+it[1]:Yt&&(!(it=Yt.match(/Edge\/(\d+)/))||it[1]>=74)&&(it=Yt.match(/Chrome\/(\d+)/))&&(nt=it[1]);var re=nt&&+nt,ie=Kt("species"),ne=function(t){return re>=51||!o((function(){var e=[];return(e.constructor={})[ie]=function(){return{foo:1}},1!==e[t](Boolean).foo}))},oe=$t.filter,ae=ne("filter");kt({target:"Array",proto:!0,forced:!ae},{filter:function(t){return oe(this,t,arguments.length>1?arguments[1]:void 0)}});var se,le=Object.keys||function(t){return xt(t,wt)},ce=a?Object.defineProperties:function(t,e){M(t);for(var r,i=le(e),n=i.length,o=0;n>o;)P.f(t,r=i[o++],e[r]);return t},ue=ct("document","documentElement"),he="prototype",Ae="script",pe=W("IE_PROTO"),de=function(){},fe=function(t){return"<"+Ae+">"+t+"</"+Ae+">"},me=function(){try{se=document.domain&&new ActiveXObject("htmlfile")}catch(t){}var t,e,r;me=se?function(t){t.write(fe("")),t.close();var e=t.parentWindow.Object;return t=null,e}(se):(e=E("iframe"),r="java"+Ae+":",e.style.display="none",ue.appendChild(e),e.src=String(r),(t=e.contentWindow.document).open(),t.write(fe("document.F=Object")),t.close(),t.F);for(var i=wt.length;i--;)delete me[he][wt[i]];return me()};X[pe]=!0;var ge=Object.create||function(t,e){var r;return null!==t?(de[he]=M(t),r=new de,de[he]=null,r[pe]=t):r=me(),void 0===e?r:ce(r,e)},_e=Kt("unscopables"),ye=Array.prototype;null==ye[_e]&&P.f(ye,_e,{configurable:!0,value:ge(null)});var ve=function(t){ye[_e][t]=!0},xe=$t.find,we="find",be=!0;we in[]&&Array(1)[we]((function(){be=!1})),kt({target:"Array",proto:!0,forced:be},{find:function(t){return xe(this,t,arguments.length>1?arguments[1]:void 0)}}),ve(we);var Be=$t.map,Ce=ne("map");kt({target:"Array",proto:!0,forced:!Ce},{map:function(t){return Be(this,t,arguments.length>1?arguments[1]:void 0)}});var Ee=function(t,e){var r=[][t];return!!r&&o((function(){r.call(null,e||function(){throw 1},1)}))},Te=[],Ie=Te.sort,Se=o((function(){Te.sort(void 0)})),Me=o((function(){Te.sort(null)})),Fe=Ee("sort");kt({target:"Array",proto:!0,forced:Se||!Me||!Fe},{sort:function(t){return void 0===t?Ie.call(Ot(this)):Ie.call(Ot(this),zt(t))}});var Pe=P.f,Le=Function.prototype,De=Le.toString,Ue=/^\s*function ([^ (]*)/,ke="name";a&&!(ke in Le)&&Pe(Le,ke,{configurable:!0,get:function(){try{return De.call(this).match(Ue)[1]}catch(t){return""}}});var ze=o((function(){le(1)}));kt({target:"Object",stat:!0,forced:ze},{keys:function(t){return le(Ot(t))}});var Re={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Oe=$t.forEach,Qe=Ee("forEach")?[].forEach:function(t){return Oe(this,t,arguments.length>1?arguments[1]:void 0)};for(var Ne in Re){var Ve=n[Ne],He=Ve&&Ve.prototype;if(He&&He.forEach!==Qe)try{L(He,"forEach",Qe)}catch(t){He.forEach=Qe}}function je(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ge(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ke(t,e){return Ke=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ke(t,e)}function qe(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ke(t,e)}function Ze(t){return Ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ze(t)}function We(t,e){return!e||"object"!==Ze(e)&&"function"!=typeof e?Ge(t):e}function Xe(t){return Xe=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Xe(t)}function $e(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function Ye(t,e){if(t){if("string"==typeof t)return $e(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?$e(t,e):void 0}}function Je(t){return function(t){if(Array.isArray(t))return $e(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||Ye(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tr(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var er=Bt.f,rr={}.toString,ir="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],nr={f:function(t){return ir&&"[object Window]"==rr.call(t)?function(t){try{return er(t)}catch(t){return ir.slice()}}(t):er(_(t))}},or={f:Kt},ar=P.f,sr=function(t){var e=st.Symbol||(st.Symbol={});w(e,t)||ar(e,t,{value:or.f(t)})},lr=P.f,cr=Kt("toStringTag"),ur=function(t,e,r){t&&!w(t=r?t:t.prototype,cr)&&lr(t,cr,{configurable:!0,value:e})},hr=$t.forEach,Ar=W("hidden"),pr="Symbol",dr="prototype",fr=Kt("toPrimitive"),mr=ot.set,gr=ot.getterFor(pr),_r=Object[dr],yr=n.Symbol,vr=ct("JSON","stringify"),xr=S.f,wr=P.f,br=nr.f,Br=u.f,Cr=j("symbols"),Er=j("op-symbols"),Tr=j("string-to-symbol-registry"),Ir=j("symbol-to-string-registry"),Sr=j("wks"),Mr=n.QObject,Fr=!Mr||!Mr[dr]||!Mr[dr].findChild,Pr=a&&o((function(){return 7!=ge(wr({},"a",{get:function(){return wr(this,"a",{value:7}).a}})).a}))?function(t,e,r){var i=xr(_r,e);i&&delete _r[e],wr(t,e,r),i&&t!==_r&&wr(_r,e,i)}:wr,Lr=function(t,e){var r=Cr[t]=ge(yr[dr]);return mr(r,{type:pr,tag:t,description:e}),a||(r.description=e),r},Dr=Vt?function(t){return"symbol"==typeof t}:function(t){return Object(t)instanceof yr},Ur=function(t,e,r){t===_r&&Ur(Er,e,r),M(t);var i=v(e,!0);return M(r),w(Cr,i)?(r.enumerable?(w(t,Ar)&&t[Ar][i]&&(t[Ar][i]=!1),r=ge(r,{enumerable:h(0,!1)})):(w(t,Ar)||wr(t,Ar,h(1,{})),t[Ar][i]=!0),Pr(t,i,r)):wr(t,i,r)},kr=function(t,e){M(t);var r=_(e),i=le(r).concat(Qr(r));return hr(i,(function(e){a&&!zr.call(r,e)||Ur(t,e,r[e])})),t},zr=function(t){var e=v(t,!0),r=Br.call(this,e);return!(this===_r&&w(Cr,e)&&!w(Er,e))&&(!(r||!w(this,e)||!w(Cr,e)||w(this,Ar)&&this[Ar][e])||r)},Rr=function(t,e){var r=_(t),i=v(e,!0);if(r!==_r||!w(Cr,i)||w(Er,i)){var n=xr(r,i);return!n||!w(Cr,i)||w(r,Ar)&&r[Ar][i]||(n.enumerable=!0),n}},Or=function(t){var e=br(_(t)),r=[];return hr(e,(function(t){w(Cr,t)||w(X,t)||r.push(t)})),r},Qr=function(t){var e=t===_r,r=br(e?Er:_(t)),i=[];return hr(r,(function(t){!w(Cr,t)||e&&!w(_r,t)||i.push(Cr[t])})),i};if(Nt||(yr=function(){if(this instanceof yr)throw TypeError("Symbol is not a constructor");var t=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,e=q(t),r=function(t){this===_r&&r.call(Er,t),w(this,Ar)&&w(this[Ar],e)&&(this[Ar][e]=!1),Pr(this,e,h(1,t))};return a&&Fr&&Pr(_r,e,{configurable:!0,set:r}),Lr(e,t)},at(yr[dr],"toString",(function(){return gr(this).tag})),at(yr,"withoutSetter",(function(t){return Lr(q(t),t)})),u.f=zr,P.f=Ur,S.f=Rr,Bt.f=nr.f=Or,Ct.f=Qr,or.f=function(t){return Lr(Kt(t),t)},a&&(wr(yr[dr],"description",{configurable:!0,get:function(){return gr(this).description}}),at(_r,"propertyIsEnumerable",zr,{unsafe:!0}))),kt({global:!0,wrap:!0,forced:!Nt,sham:!Nt},{Symbol:yr}),hr(le(Sr),(function(t){sr(t)})),kt({target:pr,stat:!0,forced:!Nt},{for:function(t){var e=String(t);if(w(Tr,e))return Tr[e];var r=yr(e);return Tr[e]=r,Ir[r]=e,r},keyFor:function(t){if(!Dr(t))throw TypeError(t+" is not a symbol");if(w(Ir,t))return Ir[t]},useSetter:function(){Fr=!0},useSimple:function(){Fr=!1}}),kt({target:"Object",stat:!0,forced:!Nt,sham:!a},{create:function(t,e){return void 0===e?ge(t):kr(ge(t),e)},defineProperty:Ur,defineProperties:kr,getOwnPropertyDescriptor:Rr}),kt({target:"Object",stat:!0,forced:!Nt},{getOwnPropertyNames:Or,getOwnPropertySymbols:Qr}),kt({target:"Object",stat:!0,forced:o((function(){Ct.f(1)}))},{getOwnPropertySymbols:function(t){return Ct.f(Ot(t))}}),vr){var Nr=!Nt||o((function(){var t=yr();return"[null]"!=vr([t])||"{}"!=vr({a:t})||"{}"!=vr(Object(t))}));kt({target:"JSON",stat:!0,forced:Nr},{stringify:function(t,e,r){for(var i,n=[t],o=1;arguments.length>o;)n.push(arguments[o++]);if(i=e,(y(e)||void 0!==t)&&!Dr(t))return Qt(e)||(e=function(t,e){if("function"==typeof i&&(e=i.call(this,t,e)),!Dr(e))return e}),n[1]=e,vr.apply(null,n)}})}yr[dr][fr]||L(yr[dr],fr,yr[dr].valueOf),ur(yr,pr),X[Ar]=!0;var Vr=P.f,Hr=n.Symbol;if(a&&"function"==typeof Hr&&(!("description"in Hr.prototype)||void 0!==Hr().description)){var jr={},Gr=function(){var t=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),e=this instanceof Gr?new Hr(t):void 0===t?Hr():Hr(t);return""===t&&(jr[e]=!0),e};Tt(Gr,Hr);var Kr=Gr.prototype=Hr.prototype;Kr.constructor=Gr;var qr=Kr.toString,Zr="Symbol(test)"==String(Hr("test")),Wr=/^Symbol\((.*)\)[^)]+$/;Vr(Kr,"description",{configurable:!0,get:function(){var t=y(this)?this.valueOf():this,e=qr.call(t);if(w(jr,t))return"";var r=Zr?e.slice(7,-1):e.replace(Wr,"$1");return""===r?void 0:r}}),kt({global:!0,forced:!0},{Symbol:Gr})}sr("iterator");var Xr=function(t,e,r){var i=v(e);i in t?P.f(t,i,h(0,r)):t[i]=r},$r=Kt("isConcatSpreadable"),Yr=9007199254740991,Jr="Maximum allowed index exceeded",ti=re>=51||!o((function(){var t=[];return t[$r]=!1,t.concat()[0]!==t})),ei=ne("concat"),ri=function(t){if(!y(t))return!1;var e=t[$r];return void 0!==e?!!e:Qt(t)};kt({target:"Array",proto:!0,forced:!ti||!ei},{concat:function(t){var e,r,i,n,o,a=Ot(this),s=Zt(a,0),l=0;for(e=-1,i=arguments.length;e<i;e++)if(ri(o=-1===e?a:arguments[e])){if(l+(n=dt(o.length))>Yr)throw TypeError(Jr);for(r=0;r<n;r++,l++)r in o&&Xr(s,l,o[r])}else{if(l>=Yr)throw TypeError(Jr);Xr(s,l++,o)}return s.length=l,s}});var ii=function(t){for(var e=Ot(this),r=dt(e.length),i=arguments.length,n=gt(i>1?arguments[1]:void 0,r),o=i>2?arguments[2]:void 0,a=void 0===o?r:gt(o,r);a>n;)e[n++]=t;return e};kt({target:"Array",proto:!0},{fill:ii}),ve("fill");var ni=function(t){var e=t.return;if(void 0!==e)return M(e.call(t)).value},oi=function(t,e,r,i){try{return i?e(M(r)[0],r[1]):e(r)}catch(e){throw ni(t),e}},ai={},si=Kt("iterator"),li=Array.prototype,ci=function(t){return void 0!==t&&(ai.Array===t||li[si]===t)},ui={};ui[Kt("toStringTag")]="z";var hi="[object z]"===String(ui),Ai=Kt("toStringTag"),pi="Arguments"==p(function(){return arguments}()),di=hi?p:function(t){var e,r,i;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),Ai))?r:pi?p(e):"Object"==(i=p(e))&&"function"==typeof e.callee?"Arguments":i},fi=Kt("iterator"),mi=function(t){if(null!=t)return t[fi]||t["@@iterator"]||ai[di(t)]},gi=function(t){var e,r,i,n,o,a,s=Ot(t),l="function"==typeof this?this:Array,c=arguments.length,u=c>1?arguments[1]:void 0,h=void 0!==u,A=mi(s),p=0;if(h&&(u=Rt(u,c>2?arguments[2]:void 0,2)),null==A||l==Array&&ci(A))for(r=new l(e=dt(s.length));e>p;p++)a=h?u(s[p],p):s[p],Xr(r,p,a);else for(o=(n=A.call(s)).next,r=new l;!(i=o.call(n)).done;p++)a=h?oi(n,u,[i.value,p],!0):i.value,Xr(r,p,a);return r.length=p,r},_i=Kt("iterator"),yi=!1;try{var vi=0,xi={next:function(){return{done:!!vi++}},return:function(){yi=!0}};xi[_i]=function(){return this},Array.from(xi,(function(){throw 2}))}catch(t){}var wi=function(t,e){if(!e&&!yi)return!1;var r=!1;try{var i={};i[_i]=function(){return{next:function(){return{done:r=!0}}}},t(i)}catch(t){}return r},bi=!wi((function(t){Array.from(t)}));kt({target:"Array",stat:!0,forced:bi},{from:gi});var Bi,Ci,Ei,Ti=!o((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),Ii=W("IE_PROTO"),Si=Object.prototype,Mi=Ti?Object.getPrototypeOf:function(t){return t=Ot(t),w(t,Ii)?t[Ii]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?Si:null},Fi=Kt("iterator"),Pi=!1;[].keys&&("next"in(Ei=[].keys())?(Ci=Mi(Mi(Ei)))!==Object.prototype&&(Bi=Ci):Pi=!0);var Li=null==Bi||o((function(){var t={};return Bi[Fi].call(t)!==t}));Li&&(Bi={}),w(Bi,Fi)||L(Bi,Fi,(function(){return this}));var Di={IteratorPrototype:Bi,BUGGY_SAFARI_ITERATORS:Pi},Ui=Di.IteratorPrototype,ki=function(){return this},zi=function(t,e,r){var i=e+" Iterator";return t.prototype=ge(Ui,{next:h(1,r)}),ur(t,i,!1),ai[i]=ki,t},Ri=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,r={};try{(t=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(r,[]),e=r instanceof Array}catch(t){}return function(r,i){return M(r),function(t){if(!y(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype")}(i),e?t.call(r,i):r.__proto__=i,r}}():void 0),Oi=Di.IteratorPrototype,Qi=Di.BUGGY_SAFARI_ITERATORS,Ni=Kt("iterator"),Vi="keys",Hi="values",ji="entries",Gi=function(){return this},Ki=function(t,e,r,i,n,o,a){zi(r,e,i);var s,l,c,u=function(t){if(t===n&&f)return f;if(!Qi&&t in p)return p[t];switch(t){case Vi:case Hi:case ji:return function(){return new r(this,t)}}return function(){return new r(this)}},h=e+" Iterator",A=!1,p=t.prototype,d=p[Ni]||p["@@iterator"]||n&&p[n],f=!Qi&&d||u(n),m="Array"==e&&p.entries||d;if(m&&(s=Mi(m.call(new t)),Oi!==Object.prototype&&s.next&&(Mi(s)!==Oi&&(Ri?Ri(s,Oi):"function"!=typeof s[Ni]&&L(s,Ni,Gi)),ur(s,h,!0))),n==Hi&&d&&d.name!==Hi&&(A=!0,f=function(){return d.call(this)}),p[Ni]!==f&&L(p,Ni,f),ai[e]=f,n)if(l={values:u(Hi),keys:o?f:u(Vi),entries:u(ji)},a)for(c in l)(Qi||A||!(c in p))&&at(p,c,l[c]);else kt({target:e,proto:!0,forced:Qi||A},l);return l},qi="Array Iterator",Zi=ot.set,Wi=ot.getterFor(qi),Xi=Ki(Array,"Array",(function(t,e){Zi(this,{type:qi,target:_(t),index:0,kind:e})}),(function(){var t=Wi(this),e=t.target,r=t.kind,i=t.index++;return!e||i>=e.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==r?{value:i,done:!1}:"values"==r?{value:e[i],done:!1}:{value:[i,e[i]],done:!1}}),"values");ai.Arguments=ai.Array,ve("keys"),ve("values"),ve("entries");var $i=[].join,Yi=f!=Object,Ji=Ee("join",",");kt({target:"Array",proto:!0,forced:Yi||!Ji},{join:function(t){return $i.call(_(this),void 0===t?",":t)}});var tn=ne("slice"),en=Kt("species"),rn=[].slice,nn=Math.max;kt({target:"Array",proto:!0,forced:!tn},{slice:function(t,e){var r,i,n,o=_(this),a=dt(o.length),s=gt(t,a),l=gt(void 0===e?a:e,a);if(Qt(o)&&("function"!=typeof(r=o.constructor)||r!==Array&&!Qt(r.prototype)?y(r)&&null===(r=r[en])&&(r=void 0):r=void 0,r===Array||void 0===r))return rn.call(o,s,l);for(i=new(void 0===r?Array:r)(nn(l-s,0)),n=0;s<l;s++,n++)s in o&&Xr(i,n,o[s]);return i.length=n,i}});var on=ne("splice"),an=Math.max,sn=Math.min;kt({target:"Array",proto:!0,forced:!on},{splice:function(t,e){var r,i,n,o,a,s,l=Ot(this),c=dt(l.length),u=gt(t,c),h=arguments.length;if(0===h?r=i=0:1===h?(r=0,i=c-u):(r=h-2,i=sn(an(At(e),0),c-u)),c+r-i>9007199254740991)throw TypeError("Maximum allowed length exceeded");for(n=Zt(l,i),o=0;o<i;o++)(a=u+o)in l&&Xr(n,o,l[a]);if(n.length=i,r<i){for(o=u;o<c-i;o++)s=o+r,(a=o+i)in l?l[s]=l[a]:delete l[s];for(o=c;o>c-i+r;o--)delete l[o-1]}else if(r>i)for(o=c-i;o>u;o--)s=o+r-1,(a=o+i-1)in l?l[s]=l[a]:delete l[s];for(o=0;o<r;o++)l[o+u]=arguments[o+2];return l.length=c-i+r,n}});var ln=!o((function(){return Object.isExtensible(Object.preventExtensions({}))})),cn=e((function(t){var e=P.f,r=q("meta"),i=0,n=Object.isExtensible||function(){return!0},o=function(t){e(t,r,{value:{objectID:"O"+ ++i,weakData:{}}})},a=t.exports={REQUIRED:!1,fastKey:function(t,e){if(!y(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!w(t,r)){if(!n(t))return"F";if(!e)return"E";o(t)}return t[r].objectID},getWeakData:function(t,e){if(!w(t,r)){if(!n(t))return!0;if(!e)return!1;o(t)}return t[r].weakData},onFreeze:function(t){return ln&&a.REQUIRED&&n(t)&&!w(t,r)&&o(t),t}};X[r]=!0})),un=function(t,e){this.stopped=t,this.result=e},hn=function(t,e,r){var i,n,o,a,s,l,c,u=r&&r.that,h=!(!r||!r.AS_ENTRIES),A=!(!r||!r.IS_ITERATOR),p=!(!r||!r.INTERRUPTED),d=Rt(e,u,1+h+p),f=function(t){return i&&ni(i),new un(!0,t)},m=function(t){return h?(M(t),p?d(t[0],t[1],f):d(t[0],t[1])):p?d(t,f):d(t)};if(A)i=t;else{if("function"!=typeof(n=mi(t)))throw TypeError("Target is not iterable");if(ci(n)){for(o=0,a=dt(t.length);a>o;o++)if((s=m(t[o]))&&s instanceof un)return s;return new un(!1)}i=n.call(t)}for(l=i.next;!(c=l.call(i)).done;){try{s=m(c.value)}catch(t){throw ni(i),t}if("object"==typeof s&&s&&s instanceof un)return s}return new un(!1)},An=function(t,e,r){if(!(t instanceof e))throw TypeError("Incorrect "+(r?r+" ":"")+"invocation");return t},pn=function(t,e,r){var i,n;return Ri&&"function"==typeof(i=e.constructor)&&i!==r&&y(n=i.prototype)&&n!==r.prototype&&Ri(t,n),t},dn=function(t,e,r){var i=-1!==t.indexOf("Map"),a=-1!==t.indexOf("Weak"),s=i?"set":"add",l=n[t],c=l&&l.prototype,u=l,h={},A=function(t){var e=c[t];at(c,t,"add"==t?function(t){return e.call(this,0===t?0:t),this}:"delete"==t?function(t){return!(a&&!y(t))&&e.call(this,0===t?0:t)}:"get"==t?function(t){return a&&!y(t)?void 0:e.call(this,0===t?0:t)}:"has"==t?function(t){return!(a&&!y(t))&&e.call(this,0===t?0:t)}:function(t,r){return e.call(this,0===t?0:t,r),this})};if(Dt(t,"function"!=typeof l||!(a||c.forEach&&!o((function(){(new l).entries().next()})))))u=r.getConstructor(e,t,i,s),cn.REQUIRED=!0;else if(Dt(t,!0)){var p=new u,d=p[s](a?{}:-0,1)!=p,f=o((function(){p.has(1)})),m=wi((function(t){new l(t)})),g=!a&&o((function(){for(var t=new l,e=5;e--;)t[s](e,e);return!t.has(-0)}));m||((u=e((function(e,r){An(e,u,t);var n=pn(new l,e,u);return null!=r&&hn(r,n[s],{that:n,AS_ENTRIES:i}),n}))).prototype=c,c.constructor=u),(f||g)&&(A("delete"),A("has"),i&&A("get")),(g||d)&&A(s),a&&c.clear&&delete c.clear}return h[t]=u,kt({global:!0,forced:u!=l},h),ur(u,t),a||r.setStrong(u,t,i),u},fn=function(t,e,r){for(var i in e)at(t,i,e[i],r);return t},mn=Kt("species"),gn=function(t){var e=ct(t),r=P.f;a&&e&&!e[mn]&&r(e,mn,{configurable:!0,get:function(){return this}})},_n=P.f,yn=cn.fastKey,vn=ot.set,xn=ot.getterFor,wn={getConstructor:function(t,e,r,i){var n=t((function(t,o){An(t,n,e),vn(t,{type:e,index:ge(null),first:void 0,last:void 0,size:0}),a||(t.size=0),null!=o&&hn(o,t[i],{that:t,AS_ENTRIES:r})})),o=xn(e),s=function(t,e,r){var i,n,s=o(t),c=l(t,e);return c?c.value=r:(s.last=c={index:n=yn(e,!0),key:e,value:r,previous:i=s.last,next:void 0,removed:!1},s.first||(s.first=c),i&&(i.next=c),a?s.size++:t.size++,"F"!==n&&(s.index[n]=c)),t},l=function(t,e){var r,i=o(t),n=yn(e);if("F"!==n)return i.index[n];for(r=i.first;r;r=r.next)if(r.key==e)return r};return fn(n.prototype,{clear:function(){for(var t=o(this),e=t.index,r=t.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete e[r.index],r=r.next;t.first=t.last=void 0,a?t.size=0:this.size=0},delete:function(t){var e=this,r=o(e),i=l(e,t);if(i){var n=i.next,s=i.previous;delete r.index[i.index],i.removed=!0,s&&(s.next=n),n&&(n.previous=s),r.first==i&&(r.first=n),r.last==i&&(r.last=s),a?r.size--:e.size--}return!!i},forEach:function(t){for(var e,r=o(this),i=Rt(t,arguments.length>1?arguments[1]:void 0,3);e=e?e.next:r.first;)for(i(e.value,e.key,this);e&&e.removed;)e=e.previous},has:function(t){return!!l(this,t)}}),fn(n.prototype,r?{get:function(t){var e=l(this,t);return e&&e.value},set:function(t,e){return s(this,0===t?0:t,e)}}:{add:function(t){return s(this,t=0===t?0:t,t)}}),a&&_n(n.prototype,"size",{get:function(){return o(this).size}}),n},setStrong:function(t,e,r){var i=e+" Iterator",n=xn(e),o=xn(i);Ki(t,e,(function(t,e){vn(this,{type:i,target:t,state:n(t),kind:e,last:void 0})}),(function(){for(var t=o(this),e=t.kind,r=t.last;r&&r.removed;)r=r.previous;return t.target&&(t.last=r=r?r.next:t.state.first)?"keys"==e?{value:r.key,done:!1}:"values"==e?{value:r.value,done:!1}:{value:[r.key,r.value],done:!1}:(t.target=void 0,{value:void 0,done:!0})}),r?"entries":"values",!r,!0),gn(e)}},bn=(dn("Map",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),wn),Object.assign),Bn=Object.defineProperty,Cn=!bn||o((function(){if(a&&1!==bn({b:1},bn(Bn({},"a",{enumerable:!0,get:function(){Bn(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},r=Symbol(),i="abcdefghijklmnopqrst";return t[r]=7,i.split("").forEach((function(t){e[t]=t})),7!=bn({},t)[r]||le(bn({},e)).join("")!=i}))?function(t,e){for(var r=Ot(t),i=arguments.length,n=1,o=Ct.f,s=u.f;i>n;)for(var l,c=f(arguments[n++]),h=o?le(c).concat(o(c)):le(c),A=h.length,p=0;A>p;)l=h[p++],a&&!s.call(c,l)||(r[l]=c[l]);return r}:bn;kt({target:"Object",stat:!0,forced:Object.assign!==Cn},{assign:Cn}),kt({target:"Object",stat:!0,sham:!a},{getOwnPropertyDescriptors:function(t){for(var e,r,i=_(t),n=S.f,o=Et(i),a={},s=0;o.length>s;)void 0!==(r=n(i,e=o[s++]))&&Xr(a,e,r);return a}});var En=hi?{}.toString:function(){return"[object "+di(this)+"]"};hi||at(Object.prototype,"toString",En,{unsafe:!0});var Tn,In,Sn,Mn=n.Promise,Fn=Kt("species"),Pn=function(t,e){var r,i=M(t).constructor;return void 0===i||null==(r=M(i)[Fn])?e:zt(r)},Ln=/(iphone|ipod|ipad).*applewebkit/i.test(Yt),Dn="process"==p(n.process),Un=n.location,kn=n.setImmediate,zn=n.clearImmediate,Rn=n.process,On=n.MessageChannel,Qn=n.Dispatch,Nn=0,Vn={},Hn="onreadystatechange",jn=function(t){if(Vn.hasOwnProperty(t)){var e=Vn[t];delete Vn[t],e()}},Gn=function(t){return function(){jn(t)}},Kn=function(t){jn(t.data)},qn=function(t){n.postMessage(t+"",Un.protocol+"//"+Un.host)};kn&&zn||(kn=function(t){for(var e=[],r=1;arguments.length>r;)e.push(arguments[r++]);return Vn[++Nn]=function(){("function"==typeof t?t:Function(t)).apply(void 0,e)},Tn(Nn),Nn},zn=function(t){delete Vn[t]},Dn?Tn=function(t){Rn.nextTick(Gn(t))}:Qn&&Qn.now?Tn=function(t){Qn.now(Gn(t))}:On&&!Ln?(Sn=(In=new On).port2,In.port1.onmessage=Kn,Tn=Rt(Sn.postMessage,Sn,1)):n.addEventListener&&"function"==typeof postMessage&&!n.importScripts&&Un&&"file:"!==Un.protocol&&!o(qn)?(Tn=qn,n.addEventListener("message",Kn,!1)):Tn=Hn in E("script")?function(t){ue.appendChild(E("script"))[Hn]=function(){ue.removeChild(this),jn(t)}}:function(t){setTimeout(Gn(t),0)});var Zn,Wn,Xn,$n,Yn,Jn,to,eo,ro={set:kn,clear:zn},io=/web0s(?!.*chrome)/i.test(Yt),no=S.f,oo=ro.set,ao=n.MutationObserver||n.WebKitMutationObserver,so=n.document,lo=n.process,co=n.Promise,uo=no(n,"queueMicrotask"),ho=uo&&uo.value;ho||(Zn=function(){var t,e;for(Dn&&(t=lo.domain)&&t.exit();Wn;){e=Wn.fn,Wn=Wn.next;try{e()}catch(t){throw Wn?$n():Xn=void 0,t}}Xn=void 0,t&&t.enter()},Ln||Dn||io||!ao||!so?co&&co.resolve?(to=co.resolve(void 0),eo=to.then,$n=function(){eo.call(to,Zn)}):$n=Dn?function(){lo.nextTick(Zn)}:function(){oo.call(n,Zn)}:(Yn=!0,Jn=so.createTextNode(""),new ao(Zn).observe(Jn,{characterData:!0}),$n=function(){Jn.data=Yn=!Yn}));var Ao,po,fo,mo,go=ho||function(t){var e={fn:t,next:void 0};Xn&&(Xn.next=e),Wn||(Wn=e,$n()),Xn=e},_o=function(t){var e,r;this.promise=new t((function(t,i){if(void 0!==e||void 0!==r)throw TypeError("Bad Promise constructor");e=t,r=i})),this.resolve=zt(e),this.reject=zt(r)},yo={f:function(t){return new _o(t)}},vo=function(t,e){if(M(t),y(e)&&e.constructor===t)return e;var r=yo.f(t);return(0,r.resolve)(e),r.promise},xo=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},wo=ro.set,bo=Kt("species"),Bo="Promise",Co=ot.get,Eo=ot.set,To=ot.getterFor(Bo),Io=Mn,So=n.TypeError,Mo=n.document,Fo=n.process,Po=ct("fetch"),Lo=yo.f,Do=Lo,Uo=!!(Mo&&Mo.createEvent&&n.dispatchEvent),ko="function"==typeof PromiseRejectionEvent,zo="unhandledrejection",Ro=Dt(Bo,(function(){if(!(N(Io)!==String(Io))){if(66===re)return!0;if(!Dn&&!ko)return!0}if(re>=51&&/native code/.test(Io))return!1;var t=Io.resolve(1),e=function(t){t((function(){}),(function(){}))};return(t.constructor={})[bo]=e,!(t.then((function(){}))instanceof e)})),Oo=Ro||!wi((function(t){Io.all(t).catch((function(){}))})),Qo=function(t){var e;return!(!y(t)||"function"!=typeof(e=t.then))&&e},No=function(t,e){if(!t.notified){t.notified=!0;var r=t.reactions;go((function(){for(var i=t.value,n=1==t.state,o=0;r.length>o;){var a,s,l,c=r[o++],u=n?c.ok:c.fail,h=c.resolve,A=c.reject,p=c.domain;try{u?(n||(2===t.rejection&&Go(t),t.rejection=1),!0===u?a=i:(p&&p.enter(),a=u(i),p&&(p.exit(),l=!0)),a===c.promise?A(So("Promise-chain cycle")):(s=Qo(a))?s.call(a,h,A):h(a)):A(i)}catch(t){p&&!l&&p.exit(),A(t)}}t.reactions=[],t.notified=!1,e&&!t.rejection&&Ho(t)}))}},Vo=function(t,e,r){var i,o;Uo?((i=Mo.createEvent("Event")).promise=e,i.reason=r,i.initEvent(t,!1,!0),n.dispatchEvent(i)):i={promise:e,reason:r},!ko&&(o=n["on"+t])?o(i):t===zo&&function(t,e){var r=n.console;r&&r.error&&(1===arguments.length?r.error(t):r.error(t,e))}("Unhandled promise rejection",r)},Ho=function(t){wo.call(n,(function(){var e,r=t.facade,i=t.value;if(jo(t)&&(e=xo((function(){Dn?Fo.emit("unhandledRejection",i,r):Vo(zo,r,i)})),t.rejection=Dn||jo(t)?2:1,e.error))throw e.value}))},jo=function(t){return 1!==t.rejection&&!t.parent},Go=function(t){wo.call(n,(function(){var e=t.facade;Dn?Fo.emit("rejectionHandled",e):Vo("rejectionhandled",e,t.value)}))},Ko=function(t,e,r){return function(i){t(e,i,r)}},qo=function(t,e,r){t.done||(t.done=!0,r&&(t=r),t.value=e,t.state=2,No(t,!0))},Zo=function(t,e,r){if(!t.done){t.done=!0,r&&(t=r);try{if(t.facade===e)throw So("Promise can't be resolved itself");var i=Qo(e);i?go((function(){var r={done:!1};try{i.call(e,Ko(Zo,r,t),Ko(qo,r,t))}catch(e){qo(r,e,t)}})):(t.value=e,t.state=1,No(t,!1))}catch(e){qo({done:!1},e,t)}}};Ro&&(Io=function(t){An(this,Io,Bo),zt(t),Ao.call(this);var e=Co(this);try{t(Ko(Zo,e),Ko(qo,e))}catch(t){qo(e,t)}},(Ao=function(t){Eo(this,{type:Bo,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=fn(Io.prototype,{then:function(t,e){var r=To(this),i=Lo(Pn(this,Io));return i.ok="function"!=typeof t||t,i.fail="function"==typeof e&&e,i.domain=Dn?Fo.domain:void 0,r.parent=!0,r.reactions.push(i),0!=r.state&&No(r,!1),i.promise},catch:function(t){return this.then(void 0,t)}}),po=function(){var t=new Ao,e=Co(t);this.promise=t,this.resolve=Ko(Zo,e),this.reject=Ko(qo,e)},yo.f=Lo=function(t){return t===Io||t===fo?new po(t):Do(t)},"function"==typeof Mn&&(mo=Mn.prototype.then,at(Mn.prototype,"then",(function(t,e){var r=this;return new Io((function(t,e){mo.call(r,t,e)})).then(t,e)}),{unsafe:!0}),"function"==typeof Po&&kt({global:!0,enumerable:!0,forced:!0},{fetch:function(t){return vo(Io,Po.apply(n,arguments))}}))),kt({global:!0,wrap:!0,forced:Ro},{Promise:Io}),ur(Io,Bo,!1),gn(Bo),fo=ct(Bo),kt({target:Bo,stat:!0,forced:Ro},{reject:function(t){var e=Lo(this);return e.reject.call(void 0,t),e.promise}}),kt({target:Bo,stat:!0,forced:Ro},{resolve:function(t){return vo(this,t)}}),kt({target:Bo,stat:!0,forced:Oo},{all:function(t){var e=this,r=Lo(e),i=r.resolve,n=r.reject,o=xo((function(){var r=zt(e.resolve),o=[],a=0,s=1;hn(t,(function(t){var l=a++,c=!1;o.push(void 0),s++,r.call(e,t).then((function(t){c||(c=!0,o[l]=t,--s||i(o))}),n)})),--s||i(o)}));return o.error&&n(o.value),r.promise},race:function(t){var e=this,r=Lo(e),i=r.reject,n=xo((function(){var n=zt(e.resolve);hn(t,(function(t){n.call(e,t).then(r.resolve,i)}))}));return n.error&&i(n.value),r.promise}});var Wo=function(){var t=M(this),e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e};function Xo(t,e){return RegExp(t,e)}var $o=o((function(){var t=Xo("a","y");return t.lastIndex=2,null!=t.exec("abcd")})),Yo=o((function(){var t=Xo("^r","gy");return t.lastIndex=2,null!=t.exec("str")})),Jo={UNSUPPORTED_Y:$o,BROKEN_CARET:Yo},ta=RegExp.prototype.exec,ea=String.prototype.replace,ra=ta,ia=function(){var t=/a/,e=/b*/g;return ta.call(t,"a"),ta.call(e,"a"),0!==t.lastIndex||0!==e.lastIndex}(),na=Jo.UNSUPPORTED_Y||Jo.BROKEN_CARET,oa=void 0!==/()??/.exec("")[1];(ia||oa||na)&&(ra=function(t){var e,r,i,n,o=this,a=na&&o.sticky,s=Wo.call(o),l=o.source,c=0,u=t;return a&&(-1===(s=s.replace("y","")).indexOf("g")&&(s+="g"),u=String(t).slice(o.lastIndex),o.lastIndex>0&&(!o.multiline||o.multiline&&"\n"!==t[o.lastIndex-1])&&(l="(?: "+l+")",u=" "+u,c++),r=new RegExp("^(?:"+l+")",s)),oa&&(r=new RegExp("^"+l+"$(?!\\s)",s)),ia&&(e=o.lastIndex),i=ta.call(a?r:o,u),a?i?(i.input=i.input.slice(c),i[0]=i[0].slice(c),i.index=o.lastIndex,o.lastIndex+=i[0].length):o.lastIndex=0:ia&&i&&(o.lastIndex=o.global?i.index+i[0].length:e),oa&&i&&i.length>1&&ea.call(i[0],r,(function(){for(n=1;n<arguments.length-2;n++)void 0===arguments[n]&&(i[n]=void 0)})),i});var aa=ra;kt({target:"RegExp",proto:!0,forced:/./.exec!==aa},{exec:aa});dn("Set",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),wn);var sa=function(t){return function(e,r){var i,n,o=String(m(e)),a=At(r),s=o.length;return a<0||a>=s?t?"":void 0:(i=o.charCodeAt(a))<55296||i>56319||a+1===s||(n=o.charCodeAt(a+1))<56320||n>57343?t?o.charAt(a):i:t?o.slice(a,a+2):n-56320+(i-55296<<10)+65536}},la={codeAt:sa(!1),charAt:sa(!0)},ca=la.charAt,ua="String Iterator",ha=ot.set,Aa=ot.getterFor(ua);Ki(String,"String",(function(t){ha(this,{type:ua,string:String(t),index:0})}),(function(){var t,e=Aa(this),r=e.string,i=e.index;return i>=r.length?{value:void 0,done:!0}:(t=ca(r,i),e.index+=t.length,{value:t,done:!1})}));var pa=Kt("species"),da=!o((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")})),fa="$0"==="a".replace(/./,"$0"),ma=Kt("replace"),ga=!!/./[ma]&&""===/./[ma]("a","$0"),_a=!o((function(){var t=/(?:)/,e=t.exec;t.exec=function(){return e.apply(this,arguments)};var r="ab".split(t);return 2!==r.length||"a"!==r[0]||"b"!==r[1]})),ya=function(t,e,r,i){var n=Kt(t),a=!o((function(){var e={};return e[n]=function(){return 7},7!=""[t](e)})),s=a&&!o((function(){var e=!1,r=/a/;return"split"===t&&((r={}).constructor={},r.constructor[pa]=function(){return r},r.flags="",r[n]=/./[n]),r.exec=function(){return e=!0,null},r[n](""),!e}));if(!a||!s||"replace"===t&&(!da||!fa||ga)||"split"===t&&!_a){var l=/./[n],c=r(n,""[t],(function(t,e,r,i,n){return e.exec===aa?a&&!n?{done:!0,value:l.call(e,r,i)}:{done:!0,value:t.call(r,e,i)}:{done:!1}}),{REPLACE_KEEPS_$0:fa,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:ga}),u=c[0],h=c[1];at(String.prototype,t,u),at(RegExp.prototype,n,2==e?function(t,e){return h.call(t,this,e)}:function(t){return h.call(t,this)})}i&&L(RegExp.prototype[n],"sham",!0)},va=la.charAt,xa=function(t,e,r){return e+(r?va(t,e).length:1)},wa=function(t,e){var r=t.exec;if("function"==typeof r){var i=r.call(t,e);if("object"!=typeof i)throw TypeError("RegExp exec method returned something other than an Object or null");return i}if("RegExp"!==p(t))throw TypeError("RegExp#exec called on incompatible receiver");return aa.call(t,e)};ya("match",1,(function(t,e,r){return[function(e){var r=m(this),i=null==e?void 0:e[t];return void 0!==i?i.call(e,r):new RegExp(e)[t](String(r))},function(t){var i=r(e,t,this);if(i.done)return i.value;var n=M(t),o=String(this);if(!n.global)return wa(n,o);var a=n.unicode;n.lastIndex=0;for(var s,l=[],c=0;null!==(s=wa(n,o));){var u=String(s[0]);l[c]=u,""===u&&(n.lastIndex=xa(o,dt(n.lastIndex),a)),c++}return 0===c?null:l}]}));var ba=Kt("match"),Ba=function(t){var e;return y(t)&&(void 0!==(e=t[ba])?!!e:"RegExp"==p(t))},Ca=[].push,Ea=Math.min,Ta=4294967295,Ia=!o((function(){return!RegExp(Ta,"y")}));ya("split",2,(function(t,e,r){var i;return i="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(t,r){var i=String(m(this)),n=void 0===r?Ta:r>>>0;if(0===n)return[];if(void 0===t)return[i];if(!Ba(t))return e.call(i,t,n);for(var o,a,s,l=[],c=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),u=0,h=new RegExp(t.source,c+"g");(o=aa.call(h,i))&&!((a=h.lastIndex)>u&&(l.push(i.slice(u,o.index)),o.length>1&&o.index<i.length&&Ca.apply(l,o.slice(1)),s=o[0].length,u=a,l.length>=n));)h.lastIndex===o.index&&h.lastIndex++;return u===i.length?!s&&h.test("")||l.push(""):l.push(i.slice(u)),l.length>n?l.slice(0,n):l}:"0".split(void 0,0).length?function(t,r){return void 0===t&&0===r?[]:e.call(this,t,r)}:e,[function(e,r){var n=m(this),o=null==e?void 0:e[t];return void 0!==o?o.call(e,n,r):i.call(String(n),e,r)},function(t,n){var o=r(i,t,this,n,i!==e);if(o.done)return o.value;var a=M(t),s=String(this),l=Pn(a,RegExp),c=a.unicode,u=(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.unicode?"u":"")+(Ia?"y":"g"),h=new l(Ia?a:"^(?:"+a.source+")",u),A=void 0===n?Ta:n>>>0;if(0===A)return[];if(0===s.length)return null===wa(h,s)?[s]:[];for(var p=0,d=0,f=[];d<s.length;){h.lastIndex=Ia?d:0;var m,g=wa(h,Ia?s:s.slice(d));if(null===g||(m=Ea(dt(h.lastIndex+(Ia?0:d)),s.length))===p)d=xa(s,d,c);else{if(f.push(s.slice(p,d)),f.length===A)return f;for(var _=1;_<=g.length-1;_++)if(f.push(g[_]),f.length===A)return f;d=p=m}}return f.push(s.slice(p)),f}]}),!Ia);var Sa,Ma=function(t){if(Ba(t))throw TypeError("The method doesn't accept regular expressions");return t},Fa=Kt("match"),Pa=function(t){var e=/./;try{"/./"[t](e)}catch(r){try{return e[Fa]=!1,"/./"[t](e)}catch(t){}}return!1},La=S.f,Da="".startsWith,Ua=Math.min,ka=Pa("startsWith"),za=!(ka||(Sa=La(String.prototype,"startsWith"),!Sa||Sa.writable));kt({target:"String",proto:!0,forced:!za&&!ka},{startsWith:function(t){var e=String(m(this));Ma(t);var r=dt(Ua(arguments.length>1?arguments[1]:void 0,e.length)),i=String(t);return Da?Da.call(e,i,r):e.slice(r,r+i.length)===i}});var Ra="\t\n\v\f\r                　\u2028\u2029\ufeff",Oa="["+Ra+"]",Qa=RegExp("^"+Oa+Oa+"*"),Na=RegExp(Oa+Oa+"*$"),Va=function(t){return function(e){var r=String(m(e));return 1&t&&(r=r.replace(Qa,"")),2&t&&(r=r.replace(Na,"")),r}},Ha={start:Va(1),end:Va(2),trim:Va(3)},ja=Ha.trim;kt({target:"String",proto:!0,forced:function(t){return o((function(){return!!Ra[t]()||"​᠎"!="​᠎"[t]()||Ra[t].name!==t}))}("trim")},{trim:function(){return ja(this)}});var Ga=/"/g,Ka=function(t,e,r,i){var n=String(m(t)),o="<"+e;return""!==r&&(o+=" "+r+'="'+String(i).replace(Ga,"&quot;")+'"'),o+">"+n+"</"+e+">"},qa=function(t){return o((function(){var e=""[t]('"');return e!==e.toLowerCase()||e.split('"').length>3}))};kt({target:"String",proto:!0,forced:qa("anchor")},{anchor:function(t){return Ka(this,"a","name",t)}});var Za,Wa="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Xa=P.f,$a=n.Int8Array,Ya=$a&&$a.prototype,Ja=n.Uint8ClampedArray,ts=Ja&&Ja.prototype,es=$a&&Mi($a),rs=Ya&&Mi(Ya),is=Object.prototype,ns=is.isPrototypeOf,os=Kt("toStringTag"),as=q("TYPED_ARRAY_TAG"),ss=Wa&&!!Ri&&"Opera"!==di(n.opera),ls=!1,cs={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},us={BigInt64Array:8,BigUint64Array:8},hs=function(t){if(!y(t))return!1;var e=di(t);return w(cs,e)||w(us,e)};for(Za in cs)n[Za]||(ss=!1);if((!ss||"function"!=typeof es||es===Function.prototype)&&(es=function(){throw TypeError("Incorrect invocation")},ss))for(Za in cs)n[Za]&&Ri(n[Za],es);if((!ss||!rs||rs===is)&&(rs=es.prototype,ss))for(Za in cs)n[Za]&&Ri(n[Za].prototype,rs);if(ss&&Mi(ts)!==rs&&Ri(ts,rs),a&&!w(rs,os))for(Za in ls=!0,Xa(rs,os,{get:function(){return y(this)?this[as]:void 0}}),cs)n[Za]&&L(n[Za],as,Za);var As={NATIVE_ARRAY_BUFFER_VIEWS:ss,TYPED_ARRAY_TAG:ls&&as,aTypedArray:function(t){if(hs(t))return t;throw TypeError("Target is not a typed array")},aTypedArrayConstructor:function(t){if(Ri){if(ns.call(es,t))return t}else for(var e in cs)if(w(cs,Za)){var r=n[e];if(r&&(t===r||ns.call(r,t)))return t}throw TypeError("Target is not a typed array constructor")},exportTypedArrayMethod:function(t,e,r){if(a){if(r)for(var i in cs){var o=n[i];o&&w(o.prototype,t)&&delete o.prototype[t]}rs[t]&&!r||at(rs,t,r?e:ss&&Ya[t]||e)}},exportTypedArrayStaticMethod:function(t,e,r){var i,o;if(a){if(Ri){if(r)for(i in cs)(o=n[i])&&w(o,t)&&delete o[t];if(es[t]&&!r)return;try{return at(es,t,r?e:ss&&$a[t]||e)}catch(t){}}for(i in cs)!(o=n[i])||o[t]&&!r||at(o,t,e)}},isView:function(t){if(!y(t))return!1;var e=di(t);return"DataView"===e||w(cs,e)||w(us,e)},isTypedArray:hs,TypedArray:es,TypedArrayPrototype:rs},ps=As.NATIVE_ARRAY_BUFFER_VIEWS,ds=n.ArrayBuffer,fs=n.Int8Array,ms=!ps||!o((function(){fs(1)}))||!o((function(){new fs(-1)}))||!wi((function(t){new fs,new fs(null),new fs(1.5),new fs(t)}),!0)||o((function(){return 1!==new fs(new ds(2),1,void 0).length})),gs=function(t){if(void 0===t)return 0;var e=At(t),r=dt(e);if(e!==r)throw RangeError("Wrong length or index");return r},_s=Math.abs,ys=Math.pow,vs=Math.floor,xs=Math.log,ws=Math.LN2,bs=function(t,e,r){var i,n,o,a=new Array(r),s=8*r-e-1,l=(1<<s)-1,c=l>>1,u=23===e?ys(2,-24)-ys(2,-77):0,h=t<0||0===t&&1/t<0?1:0,A=0;for((t=_s(t))!=t||t===1/0?(n=t!=t?1:0,i=l):(i=vs(xs(t)/ws),t*(o=ys(2,-i))<1&&(i--,o*=2),(t+=i+c>=1?u/o:u*ys(2,1-c))*o>=2&&(i++,o/=2),i+c>=l?(n=0,i=l):i+c>=1?(n=(t*o-1)*ys(2,e),i+=c):(n=t*ys(2,c-1)*ys(2,e),i=0));e>=8;a[A++]=255&n,n/=256,e-=8);for(i=i<<e|n,s+=e;s>0;a[A++]=255&i,i/=256,s-=8);return a[--A]|=128*h,a},Bs=function(t,e){var r,i=t.length,n=8*i-e-1,o=(1<<n)-1,a=o>>1,s=n-7,l=i-1,c=t[l--],u=127&c;for(c>>=7;s>0;u=256*u+t[l],l--,s-=8);for(r=u&(1<<-s)-1,u>>=-s,s+=e;s>0;r=256*r+t[l],l--,s-=8);if(0===u)u=1-a;else{if(u===o)return r?NaN:c?-1/0:1/0;r+=ys(2,e),u-=a}return(c?-1:1)*r*ys(2,u-e)},Cs=Bt.f,Es=P.f,Ts=ot.get,Is=ot.set,Ss="ArrayBuffer",Ms="DataView",Fs="prototype",Ps="Wrong index",Ls=n[Ss],Ds=Ls,Us=n[Ms],ks=Us&&Us[Fs],zs=Object.prototype,Rs=n.RangeError,Os=bs,Qs=Bs,Ns=function(t){return[255&t]},Vs=function(t){return[255&t,t>>8&255]},Hs=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},js=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},Gs=function(t){return Os(t,23,4)},Ks=function(t){return Os(t,52,8)},qs=function(t,e){Es(t[Fs],e,{get:function(){return Ts(this)[e]}})},Zs=function(t,e,r,i){var n=gs(r),o=Ts(t);if(n+e>o.byteLength)throw Rs(Ps);var a=Ts(o.buffer).bytes,s=n+o.byteOffset,l=a.slice(s,s+e);return i?l:l.reverse()},Ws=function(t,e,r,i,n,o){var a=gs(r),s=Ts(t);if(a+e>s.byteLength)throw Rs(Ps);for(var l=Ts(s.buffer).bytes,c=a+s.byteOffset,u=i(+n),h=0;h<e;h++)l[c+h]=u[o?h:e-h-1]};if(Wa){if(!o((function(){Ls(1)}))||!o((function(){new Ls(-1)}))||o((function(){return new Ls,new Ls(1.5),new Ls(NaN),Ls.name!=Ss}))){for(var Xs,$s=(Ds=function(t){return An(this,Ds),new Ls(gs(t))})[Fs]=Ls[Fs],Ys=Cs(Ls),Js=0;Ys.length>Js;)(Xs=Ys[Js++])in Ds||L(Ds,Xs,Ls[Xs]);$s.constructor=Ds}Ri&&Mi(ks)!==zs&&Ri(ks,zs);var tl=new Us(new Ds(2)),el=ks.setInt8;tl.setInt8(0,2147483648),tl.setInt8(1,2147483649),!tl.getInt8(0)&&tl.getInt8(1)||fn(ks,{setInt8:function(t,e){el.call(this,t,e<<24>>24)},setUint8:function(t,e){el.call(this,t,e<<24>>24)}},{unsafe:!0})}else Ds=function(t){An(this,Ds,Ss);var e=gs(t);Is(this,{bytes:ii.call(new Array(e),0),byteLength:e}),a||(this.byteLength=e)},Us=function(t,e,r){An(this,Us,Ms),An(t,Ds,Ms);var i=Ts(t).byteLength,n=At(e);if(n<0||n>i)throw Rs("Wrong offset");if(n+(r=void 0===r?i-n:dt(r))>i)throw Rs("Wrong length");Is(this,{buffer:t,byteLength:r,byteOffset:n}),a||(this.buffer=t,this.byteLength=r,this.byteOffset=n)},a&&(qs(Ds,"byteLength"),qs(Us,"buffer"),qs(Us,"byteLength"),qs(Us,"byteOffset")),fn(Us[Fs],{getInt8:function(t){return Zs(this,1,t)[0]<<24>>24},getUint8:function(t){return Zs(this,1,t)[0]},getInt16:function(t){var e=Zs(this,2,t,arguments.length>1?arguments[1]:void 0);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=Zs(this,2,t,arguments.length>1?arguments[1]:void 0);return e[1]<<8|e[0]},getInt32:function(t){return js(Zs(this,4,t,arguments.length>1?arguments[1]:void 0))},getUint32:function(t){return js(Zs(this,4,t,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(t){return Qs(Zs(this,4,t,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(t){return Qs(Zs(this,8,t,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(t,e){Ws(this,1,t,Ns,e)},setUint8:function(t,e){Ws(this,1,t,Ns,e)},setInt16:function(t,e){Ws(this,2,t,Vs,e,arguments.length>2?arguments[2]:void 0)},setUint16:function(t,e){Ws(this,2,t,Vs,e,arguments.length>2?arguments[2]:void 0)},setInt32:function(t,e){Ws(this,4,t,Hs,e,arguments.length>2?arguments[2]:void 0)},setUint32:function(t,e){Ws(this,4,t,Hs,e,arguments.length>2?arguments[2]:void 0)},setFloat32:function(t,e){Ws(this,4,t,Gs,e,arguments.length>2?arguments[2]:void 0)},setFloat64:function(t,e){Ws(this,8,t,Ks,e,arguments.length>2?arguments[2]:void 0)}});ur(Ds,Ss),ur(Us,Ms);var rl={ArrayBuffer:Ds,DataView:Us},il=function(t,e){var r=function(t){var e=At(t);if(e<0)throw RangeError("The argument can't be less than 0");return e}(t);if(r%e)throw RangeError("Wrong offset");return r},nl=As.aTypedArrayConstructor,ol=function(t){var e,r,i,n,o,a,s=Ot(t),l=arguments.length,c=l>1?arguments[1]:void 0,u=void 0!==c,h=mi(s);if(null!=h&&!ci(h))for(a=(o=h.call(s)).next,s=[];!(n=a.call(o)).done;)s.push(n.value);for(u&&l>2&&(c=Rt(c,arguments[2],2)),r=dt(s.length),i=new(nl(this))(r),e=0;r>e;e++)i[e]=u?c(s[e],e):s[e];return i},al=e((function(t){var e=Bt.f,r=$t.forEach,i=ot.get,o=ot.set,s=P.f,l=S.f,c=Math.round,u=n.RangeError,A=rl.ArrayBuffer,p=rl.DataView,d=As.NATIVE_ARRAY_BUFFER_VIEWS,f=As.TYPED_ARRAY_TAG,m=As.TypedArray,g=As.TypedArrayPrototype,_=As.aTypedArrayConstructor,x=As.isTypedArray,b="BYTES_PER_ELEMENT",B="Wrong length",C=function(t,e){for(var r=0,i=e.length,n=new(_(t))(i);i>r;)n[r]=e[r++];return n},E=function(t,e){s(t,e,{get:function(){return i(this)[e]}})},T=function(t){var e;return t instanceof A||"ArrayBuffer"==(e=di(t))||"SharedArrayBuffer"==e},I=function(t,e){return x(t)&&"symbol"!=typeof e&&e in t&&String(+e)==String(e)},M=function(t,e){return I(t,e=v(e,!0))?h(2,t[e]):l(t,e)},F=function(t,e,r){return!(I(t,e=v(e,!0))&&y(r)&&w(r,"value"))||w(r,"get")||w(r,"set")||r.configurable||w(r,"writable")&&!r.writable||w(r,"enumerable")&&!r.enumerable?s(t,e,r):(t[e]=r.value,t)};a?(d||(S.f=M,P.f=F,E(g,"buffer"),E(g,"byteOffset"),E(g,"byteLength"),E(g,"length")),kt({target:"Object",stat:!0,forced:!d},{getOwnPropertyDescriptor:M,defineProperty:F}),t.exports=function(t,a,l){var h=t.match(/\d+$/)[0]/8,_=t+(l?"Clamped":"")+"Array",v="get"+t,w="set"+t,E=n[_],I=E,S=I&&I.prototype,M={},F=function(t,e){s(t,e,{get:function(){return function(t,e){var r=i(t);return r.view[v](e*h+r.byteOffset,!0)}(this,e)},set:function(t){return function(t,e,r){var n=i(t);l&&(r=(r=c(r))<0?0:r>255?255:255&r),n.view[w](e*h+n.byteOffset,r,!0)}(this,e,t)},enumerable:!0})};d?ms&&(I=a((function(t,e,r,i){return An(t,I,_),pn(y(e)?T(e)?void 0!==i?new E(e,il(r,h),i):void 0!==r?new E(e,il(r,h)):new E(e):x(e)?C(I,e):ol.call(I,e):new E(gs(e)),t,I)})),Ri&&Ri(I,m),r(e(E),(function(t){t in I||L(I,t,E[t])})),I.prototype=S):(I=a((function(t,e,r,i){An(t,I,_);var n,a,s,l=0,c=0;if(y(e)){if(!T(e))return x(e)?C(I,e):ol.call(I,e);n=e,c=il(r,h);var d=e.byteLength;if(void 0===i){if(d%h)throw u(B);if((a=d-c)<0)throw u(B)}else if((a=dt(i)*h)+c>d)throw u(B);s=a/h}else s=gs(e),n=new A(a=s*h);for(o(t,{buffer:n,byteOffset:c,byteLength:a,length:s,view:new p(n)});l<s;)F(t,l++)})),Ri&&Ri(I,m),S=I.prototype=ge(g)),S.constructor!==I&&L(S,"constructor",I),f&&L(S,f,_),M[_]=I,kt({global:!0,forced:I!=E,sham:!d},M),b in I||L(I,b,h),b in S||L(S,b,h),gn(_)}):t.exports=function(){}}));al("Int32",(function(t){return function(e,r,i){return t(this,e,r,i)}}));var sl=Math.min,ll=[].copyWithin||function(t,e){var r=Ot(this),i=dt(r.length),n=gt(t,i),o=gt(e,i),a=arguments.length>2?arguments[2]:void 0,s=sl((void 0===a?i:gt(a,i))-o,i-n),l=1;for(o<n&&n<o+s&&(l=-1,o+=s-1,n+=s-1);s-- >0;)o in r?r[n]=r[o]:delete r[n],n+=l,o+=l;return r},cl=As.aTypedArray;(0,As.exportTypedArrayMethod)("copyWithin",(function(t,e){return ll.call(cl(this),t,e,arguments.length>2?arguments[2]:void 0)}));var ul=$t.every,hl=As.aTypedArray;(0,As.exportTypedArrayMethod)("every",(function(t){return ul(hl(this),t,arguments.length>1?arguments[1]:void 0)}));var Al=As.aTypedArray;(0,As.exportTypedArrayMethod)("fill",(function(t){return ii.apply(Al(this),arguments)}));var pl=As.aTypedArrayConstructor,dl=$t.filter,fl=As.aTypedArray;(0,As.exportTypedArrayMethod)("filter",(function(t){return function(t,e){for(var r=Pn(t,t.constructor),i=0,n=e.length,o=new(pl(r))(n);n>i;)o[i]=e[i++];return o}(this,dl(fl(this),t,arguments.length>1?arguments[1]:void 0))}));var ml=$t.find,gl=As.aTypedArray;(0,As.exportTypedArrayMethod)("find",(function(t){return ml(gl(this),t,arguments.length>1?arguments[1]:void 0)}));var _l=$t.findIndex,yl=As.aTypedArray;(0,As.exportTypedArrayMethod)("findIndex",(function(t){return _l(yl(this),t,arguments.length>1?arguments[1]:void 0)}));var vl=$t.forEach,xl=As.aTypedArray;(0,As.exportTypedArrayMethod)("forEach",(function(t){vl(xl(this),t,arguments.length>1?arguments[1]:void 0)}));var wl=yt.includes,bl=As.aTypedArray;(0,As.exportTypedArrayMethod)("includes",(function(t){return wl(bl(this),t,arguments.length>1?arguments[1]:void 0)}));var Bl=yt.indexOf,Cl=As.aTypedArray;(0,As.exportTypedArrayMethod)("indexOf",(function(t){return Bl(Cl(this),t,arguments.length>1?arguments[1]:void 0)}));var El=Kt("iterator"),Tl=n.Uint8Array,Il=Xi.values,Sl=Xi.keys,Ml=Xi.entries,Fl=As.aTypedArray,Pl=As.exportTypedArrayMethod,Ll=Tl&&Tl.prototype[El],Dl=!!Ll&&("values"==Ll.name||null==Ll.name),Ul=function(){return Il.call(Fl(this))};Pl("entries",(function(){return Ml.call(Fl(this))})),Pl("keys",(function(){return Sl.call(Fl(this))})),Pl("values",Ul,!Dl),Pl(El,Ul,!Dl);var kl=As.aTypedArray,zl=[].join;(0,As.exportTypedArrayMethod)("join",(function(t){return zl.apply(kl(this),arguments)}));var Rl=Math.min,Ol=[].lastIndexOf,Ql=!!Ol&&1/[1].lastIndexOf(1,-0)<0,Nl=Ee("lastIndexOf"),Vl=Ql||!Nl?function(t){if(Ql)return Ol.apply(this,arguments)||0;var e=_(this),r=dt(e.length),i=r-1;for(arguments.length>1&&(i=Rl(i,At(arguments[1]))),i<0&&(i=r+i);i>=0;i--)if(i in e&&e[i]===t)return i||0;return-1}:Ol,Hl=As.aTypedArray;(0,As.exportTypedArrayMethod)("lastIndexOf",(function(t){return Vl.apply(Hl(this),arguments)}));var jl=$t.map,Gl=As.aTypedArray,Kl=As.aTypedArrayConstructor;(0,As.exportTypedArrayMethod)("map",(function(t){return jl(Gl(this),t,arguments.length>1?arguments[1]:void 0,(function(t,e){return new(Kl(Pn(t,t.constructor)))(e)}))}));var ql=function(t){return function(e,r,i,n){zt(r);var o=Ot(e),a=f(o),s=dt(o.length),l=t?s-1:0,c=t?-1:1;if(i<2)for(;;){if(l in a){n=a[l],l+=c;break}if(l+=c,t?l<0:s<=l)throw TypeError("Reduce of empty array with no initial value")}for(;t?l>=0:s>l;l+=c)l in a&&(n=r(n,a[l],l,o));return n}},Zl={left:ql(!1),right:ql(!0)},Wl=Zl.left,Xl=As.aTypedArray;(0,As.exportTypedArrayMethod)("reduce",(function(t){return Wl(Xl(this),t,arguments.length,arguments.length>1?arguments[1]:void 0)}));var $l=Zl.right,Yl=As.aTypedArray;(0,As.exportTypedArrayMethod)("reduceRight",(function(t){return $l(Yl(this),t,arguments.length,arguments.length>1?arguments[1]:void 0)}));var Jl=As.aTypedArray,tc=As.exportTypedArrayMethod,ec=Math.floor;tc("reverse",(function(){for(var t,e=this,r=Jl(e).length,i=ec(r/2),n=0;n<i;)t=e[n],e[n++]=e[--r],e[r]=t;return e}));var rc=As.aTypedArray;(0,As.exportTypedArrayMethod)("set",(function(t){rc(this);var e=il(arguments.length>1?arguments[1]:void 0,1),r=this.length,i=Ot(t),n=dt(i.length),o=0;if(n+e>r)throw RangeError("Wrong length");for(;o<n;)this[e+o]=i[o++]}),o((function(){new Int8Array(1).set({})})));var ic=As.aTypedArray,nc=As.aTypedArrayConstructor,oc=[].slice;(0,As.exportTypedArrayMethod)("slice",(function(t,e){for(var r=oc.call(ic(this),t,e),i=Pn(this,this.constructor),n=0,o=r.length,a=new(nc(i))(o);o>n;)a[n]=r[n++];return a}),o((function(){new Int8Array(1).slice()})));var ac=$t.some,sc=As.aTypedArray;(0,As.exportTypedArrayMethod)("some",(function(t){return ac(sc(this),t,arguments.length>1?arguments[1]:void 0)}));var lc=As.aTypedArray,cc=[].sort;(0,As.exportTypedArrayMethod)("sort",(function(t){return cc.call(lc(this),t)}));var uc=As.aTypedArray;(0,As.exportTypedArrayMethod)("subarray",(function(t,e){var r=uc(this),i=r.length,n=gt(t,i);return new(Pn(r,r.constructor))(r.buffer,r.byteOffset+n*r.BYTES_PER_ELEMENT,dt((void 0===e?i:gt(e,i))-n))}));var hc=n.Int8Array,Ac=As.aTypedArray,pc=As.exportTypedArrayMethod,dc=[].toLocaleString,fc=[].slice,mc=!!hc&&o((function(){dc.call(new hc(1))}));pc("toLocaleString",(function(){return dc.apply(mc?fc.call(Ac(this)):Ac(this),arguments)}),o((function(){return[1,2].toLocaleString()!=new hc([1,2]).toLocaleString()}))||!o((function(){hc.prototype.toLocaleString.call([1,2])})));var gc=As.exportTypedArrayMethod,_c=n.Uint8Array,yc=_c&&_c.prototype||{},vc=[].toString,xc=[].join;o((function(){vc.call({})}))&&(vc=function(){return xc.call(this)});var wc=yc.toString!=vc;gc("toString",vc,wc);var bc=cn.getWeakData,Bc=ot.set,Cc=ot.getterFor,Ec=$t.find,Tc=$t.findIndex,Ic=0,Sc=function(t){return t.frozen||(t.frozen=new Mc)},Mc=function(){this.entries=[]},Fc=function(t,e){return Ec(t.entries,(function(t){return t[0]===e}))};Mc.prototype={get:function(t){var e=Fc(this,t);if(e)return e[1]},has:function(t){return!!Fc(this,t)},set:function(t,e){var r=Fc(this,t);r?r[1]=e:this.entries.push([t,e])},delete:function(t){var e=Tc(this.entries,(function(e){return e[0]===t}));return~e&&this.entries.splice(e,1),!!~e}};var Pc,Lc={getConstructor:function(t,e,r,i){var n=t((function(t,o){An(t,n,e),Bc(t,{type:e,id:Ic++,frozen:void 0}),null!=o&&hn(o,t[i],{that:t,AS_ENTRIES:r})})),o=Cc(e),a=function(t,e,r){var i=o(t),n=bc(M(e),!0);return!0===n?Sc(i).set(e,r):n[i.id]=r,t};return fn(n.prototype,{delete:function(t){var e=o(this);if(!y(t))return!1;var r=bc(t);return!0===r?Sc(e).delete(t):r&&w(r,e.id)&&delete r[e.id]},has:function(t){var e=o(this);if(!y(t))return!1;var r=bc(t);return!0===r?Sc(e).has(t):r&&w(r,e.id)}}),fn(n.prototype,r?{get:function(t){var e=o(this);if(y(t)){var r=bc(t);return!0===r?Sc(e).get(t):r?r[e.id]:void 0}},set:function(t,e){return a(this,t,e)}}:{add:function(t){return a(this,t,!0)}}),n}},Dc=(e((function(t){var e,r=ot.enforce,i=!n.ActiveXObject&&"ActiveXObject"in n,o=Object.isExtensible,a=function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},s=t.exports=dn("WeakMap",a,Lc);if(H&&i){e=Lc.getConstructor(a,"WeakMap",!0),cn.REQUIRED=!0;var l=s.prototype,c=l.delete,u=l.has,h=l.get,A=l.set;fn(l,{delete:function(t){if(y(t)&&!o(t)){var i=r(this);return i.frozen||(i.frozen=new e),c.call(this,t)||i.frozen.delete(t)}return c.call(this,t)},has:function(t){if(y(t)&&!o(t)){var i=r(this);return i.frozen||(i.frozen=new e),u.call(this,t)||i.frozen.has(t)}return u.call(this,t)},get:function(t){if(y(t)&&!o(t)){var i=r(this);return i.frozen||(i.frozen=new e),u.call(this,t)?h.call(this,t):i.frozen.get(t)}return h.call(this,t)},set:function(t,i){if(y(t)&&!o(t)){var n=r(this);n.frozen||(n.frozen=new e),u.call(this,t)?A.call(this,t,i):n.frozen.set(t,i)}else A.call(this,t,i);return this}})}})),Kt("iterator")),Uc=Kt("toStringTag"),kc=Xi.values;for(var zc in Re){var Rc=n[zc],Oc=Rc&&Rc.prototype;if(Oc){if(Oc[Dc]!==kc)try{L(Oc,Dc,kc)}catch(t){Oc[Dc]=kc}if(Oc[Uc]||L(Oc,Uc,zc),Re[zc])for(var Qc in Xi)if(Oc[Qc]!==Xi[Qc])try{L(Oc,Qc,Xi[Qc])}catch(t){Oc[Qc]=Xi[Qc]}}}function Nc(t,e,r){return Nc=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,r){var i=[null];i.push.apply(i,e);var n=new(Function.bind.apply(t,i));return r&&Ke(n,r.prototype),n},Nc.apply(null,arguments)}function Vc(t){var e="function"==typeof Map?new Map:void 0;return Vc=function(t){if(null===t||(r=t,-1===Function.toString.call(r).indexOf("[native code]")))return t;var r;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,i)}function i(){return Nc(t,arguments,Xe(this).constructor)}return i.prototype=Object.create(t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Ke(i,t)},Vc(t)}function Hc(t,e,r){return Hc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Xe(t)););return t}(t,e);if(i){var n=Object.getOwnPropertyDescriptor(i,e);return n.get?n.get.call(r):n.value}},Hc(t,e,r||t)}function jc(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Gc(t,e,r){return e&&jc(t.prototype,e),r&&jc(t,r),t}function Kc(){}function qc(t){return t()}function Zc(){return Object.create(null)}function Wc(t){t.forEach(qc)}function Xc(t){return"function"==typeof t}function $c(t,e){return t!=t?e==e:t!==e||t&&"object"===Ze(t)||"function"==typeof t}function Yc(t,e){return Pc||(Pc=document.createElement("a")),Pc.href=e,t===Pc.href}function Jc(t,e,r,i){if(t){var n=tu(t,e,r,i);return t[0](n)}}function tu(t,e,r,i){return t[1]&&i?function(t,e){for(var r in e)t[r]=e[r];return t}(r.ctx.slice(),t[1](i(e))):r.ctx}function eu(t,e,r,i){if(t[2]&&i){var n=t[2](i(r));if(void 0===e.dirty)return n;if("object"===Ze(n)){for(var o=[],a=Math.max(e.dirty.length,n.length),s=0;s<a;s+=1)o[s]=e.dirty[s]|n[s];return o}return e.dirty|n}return e.dirty}function ru(t,e,r,i,n,o){if(n){var a=tu(e,r,i,o);t.p(a,n)}}function iu(t){if(t.ctx.length>32){for(var e=[],r=t.ctx.length/32,i=0;i<r;i++)e[i]=-1;return e}return-1}var nu,ou,au="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function su(t,e){t.appendChild(e)}function lu(t,e,r){var i=function(t){if(!t)return document;var e=t.getRootNode?t.getRootNode():t.ownerDocument;if(e&&e.host)return e;return t.ownerDocument}(t);if(!i.getElementById(e)){var n=Au("style");n.id=e,n.textContent=r,function(t,e){su(t.head||t,e),e.sheet}(i,n)}}function cu(t,e,r){t.insertBefore(e,r||null)}function uu(t){t.parentNode&&t.parentNode.removeChild(t)}function hu(t,e){for(var r=0;r<t.length;r+=1)t[r]&&t[r].d(e)}function Au(t){return document.createElement(t)}function pu(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function du(t){return document.createTextNode(t)}function fu(){return du(" ")}function mu(){return du("")}function gu(t,e,r,i){return t.addEventListener(e,r,i),function(){return t.removeEventListener(e,r,i)}}function _u(t,e,r){null==r?t.removeAttribute(e):t.getAttribute(e)!==r&&t.setAttribute(e,r)}function yu(t,e,r){e in t?t[e]="boolean"==typeof t[e]&&""===r||r:_u(t,e,r)}function vu(t,e){e=""+e,t.data!==e&&(t.data=e)}function xu(t,e,r,i){null==r?t.style.removeProperty(e):t.style.setProperty(e,r,i?"important":"")}function wu(){if(void 0===nu){nu=!1;try{"undefined"!=typeof window&&window.parent&&window.parent.document}catch(t){nu=!0}}return nu}function bu(t,e){"static"===getComputedStyle(t).position&&(t.style.position="relative");var r=Au("iframe");r.setAttribute("style","display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; border: 0; opacity: 0; pointer-events: none; z-index: -1;"),r.setAttribute("aria-hidden","true"),r.tabIndex=-1;var i,n=wu();return n?(r.src="data:text/html,<script>onresize=function(){parent.postMessage(0,'*')}<\/script>",i=gu(window,"message",(function(t){t.source===r.contentWindow&&e()}))):(r.src="about:blank",r.onload=function(){i=gu(r.contentWindow,"resize",e),e()}),su(t,r),function(){(n||i&&r.contentWindow)&&i(),uu(r)}}function Bu(t,e,r){t.classList[r?"add":"remove"](e)}function Cu(t){ou=t}function Eu(){if(!ou)throw new Error("Function called outside component initialization");return ou}function Tu(t){Eu().$$.on_mount.push(t)}function Iu(t){return Eu().$$.context.get(t)}var Su=[],Mu=[],Fu=[],Pu=[],Lu=Promise.resolve(),Du=!1;function Uu(t){Fu.push(t)}function ku(t){Pu.push(t)}var zu=new Set,Ru=0;function Ou(){if(0===Ru){var t=ou;do{try{for(;Ru<Su.length;){var e=Su[Ru];Ru++,Cu(e),Qu(e.$$)}}catch(t){throw Su.length=0,Ru=0,t}for(Cu(null),Su.length=0,Ru=0;Mu.length;)Mu.pop()();for(var r=0;r<Fu.length;r+=1){var i=Fu[r];zu.has(i)||(zu.add(i),i())}Fu.length=0}while(Su.length);for(;Pu.length;)Pu.pop()();Du=!1,zu.clear(),Cu(t)}}function Qu(t){if(null!==t.fragment){t.update(),Wc(t.before_update);var e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Uu)}}var Nu,Vu=new Set;function Hu(){Nu={r:0,c:[],p:Nu}}function ju(){Nu.r||Wc(Nu.c),Nu=Nu.p}function Gu(t,e){t&&t.i&&(Vu.delete(t),t.i(e))}function Ku(t,e,r,i){if(t&&t.o){if(Vu.has(t))return;Vu.add(t),Nu.c.push((function(){Vu.delete(t),i&&(r&&t.d(1),i())})),t.o(e)}else i&&i()}function qu(t,e,r){var i=t.$$.props[e];void 0!==i&&(t.$$.bound[i]=r,r(t.$$.ctx[i]))}function Zu(t){t&&t.c()}function Wu(t,e,r,i){var n=t.$$,o=n.fragment,a=n.after_update;o&&o.m(e,r),i||Uu((function(){var e,r=t.$$.on_mount.map(qc).filter(Xc);t.$$.on_destroy?(e=t.$$.on_destroy).push.apply(e,Je(r)):Wc(r);t.$$.on_mount=[]})),a.forEach(Uu)}function Xu(t,e){var r,i,n,o=t.$$;null!==o.fragment&&(r=o.after_update,i=[],n=[],Fu.forEach((function(t){return-1===r.indexOf(t)?i.push(t):n.push(t)})),n.forEach((function(t){return t()})),Fu=i,Wc(o.on_destroy),o.fragment&&o.fragment.d(e),o.on_destroy=o.fragment=null,o.ctx=[])}function $u(t,e){-1===t.$$.dirty[0]&&(Su.push(t),Du||(Du=!0,Lu.then(Ou)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Yu(t,e,r,i,n,o,a){var s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:[-1],l=ou;Cu(t);var c=t.$$={fragment:null,ctx:[],props:o,update:Kc,not_equal:n,bound:Zc(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:Zc(),dirty:s,skip_bound:!1,root:e.target||l.$$.root};a&&a(c.root);var u=!1;if(c.ctx=r?r(t,e.props||{},(function(e,r){var i=!(arguments.length<=2)&&arguments.length-2?arguments.length<=2?void 0:arguments[2]:r;return c.ctx&&n(c.ctx[e],c.ctx[e]=i)&&(!c.skip_bound&&c.bound[e]&&c.bound[e](i),u&&$u(t,e)),r})):[],c.update(),u=!0,Wc(c.before_update),c.fragment=!!i&&i(c.ctx),e.target){if(e.hydrate){var h=function(t){return Array.from(t.childNodes)}(e.target);c.fragment&&c.fragment.l(h),h.forEach(uu)}else c.fragment&&c.fragment.c();e.intro&&Gu(t.$$.fragment),Wu(t,e.target,e.anchor,e.customElement),Ou()}Cu(l)}var Ju=function(){function t(){je(this,t)}return Gc(t,[{key:"$destroy",value:function(){Xu(this,1),this.$destroy=Kc}},{key:"$on",value:function(t,e){if(!Xc(e))return Kc;var r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(e),function(){var t=r.indexOf(e);-1!==t&&r.splice(t,1)}}},{key:"$set",value:function(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}]),t}();sr("asyncIterator"),sr("toStringTag"),ur(n.JSON,"JSON",!0),ur(Math,"Math",!0);var th=o((function(){Mi(1)}));kt({target:"Object",stat:!0,forced:th,sham:!Ti},{getPrototypeOf:function(t){return Mi(Ot(t))}});var eh="toString",rh=RegExp.prototype,ih=rh[eh],nh=o((function(){return"/a/b"!=ih.call({source:"a",flags:"b"})})),oh=ih.name!=eh;(nh||oh)&&at(RegExp.prototype,eh,(function(){var t=M(this),e=String(t.source),r=t.flags;return"/"+e+"/"+String(void 0===r&&t instanceof RegExp&&!("flags"in rh)?Wo.call(t):r)}),{unsafe:!0});var ah=e((function(t){var e=function(t){var e,r=Object.prototype,i=r.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",s=n.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,i){var n=e&&e.prototype instanceof m?e:m,o=Object.create(n.prototype),a=new I(i||[]);return o._invoke=function(t,e,r){var i=h;return function(n,o){if(i===p)throw new Error("Generator is already running");if(i===d){if("throw"===n)throw o;return M()}for(r.method=n,r.arg=o;;){var a=r.delegate;if(a){var s=C(a,r);if(s){if(s===f)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===h)throw i=d,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=p;var l=u(t,e,r);if("normal"===l.type){if(i=r.done?d:A,l.arg===f)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(i=d,r.method="throw",r.arg=l.arg)}}}(t,r,a),o}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var h="suspendedStart",A="suspendedYield",p="executing",d="completed",f={};function m(){}function g(){}function _(){}var y={};y[o]=function(){return this};var v=Object.getPrototypeOf,x=v&&v(v(S([])));x&&x!==r&&i.call(x,o)&&(y=x);var w=_.prototype=m.prototype=Object.create(y);function b(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function B(t,e){function r(n,o,a,s){var l=u(t[n],t,o);if("throw"!==l.type){var c=l.arg,h=c.value;return h&&"object"===Ze(h)&&i.call(h,"__await")?e.resolve(h.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(h).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,s)}))}s(l.arg)}var n;this._invoke=function(t,i){function o(){return new e((function(e,n){r(t,i,e,n)}))}return n=n?n.then(o,o):o()}}function C(t,r){var i=t.iterator[r.method];if(i===e){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=e,C(t,r),"throw"===r.method))return f;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var n=u(i,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,f;var o=n.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,f):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,f)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function S(t){if(t){var r=t[o];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,a=function r(){for(;++n<t.length;)if(i.call(t,n))return r.value=t[n],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}return{next:M}}function M(){return{value:e,done:!0}}return g.prototype=w.constructor=_,_.constructor=g,g.displayName=l(_,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,_):(t.__proto__=_,l(t,s,"GeneratorFunction")),t.prototype=Object.create(w),t},t.awrap=function(t){return{__await:t}},b(B.prototype),B.prototype[a]=function(){return this},t.AsyncIterator=B,t.async=function(e,r,i,n,o){void 0===o&&(o=Promise);var a=new B(c(e,r,i,n),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(w),l(w,s,"Generator"),w[o]=function(){return this},w.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var i=e.pop();if(i in t)return r.value=i,r.done=!1,r}return r.done=!0,r}},t.values=S,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(T),!t)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(i,n){return s.type="throw",s.arg=t,r.next=i,n&&(r.method="next",r.arg=e),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var l=i.call(a,"catchLoc"),c=i.call(a,"finallyLoc");if(l&&c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),T(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var i=r.completion;if("throw"===i.type){var n=i.arg;T(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,i){return this.delegate={iterator:S(t),resultName:r,nextLoc:i},"next"===this.method&&(this.arg=e),f}},t}(t.exports);try{regeneratorRuntime=e}catch(t){Function("r","regeneratorRuntime = r")(e)}})),sh=ah;function lh(t,e,r,i,n,o,a){try{var s=t[o](a),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(i,n)}function ch(t){return function(){var e=this,r=arguments;return new Promise((function(i,n){var o=t.apply(e,r);function a(t){lh(o,i,n,a,s,"next",t)}function s(t){lh(o,i,n,a,s,"throw",t)}a(void 0)}))}}var uh=P.f,hh=Bt.f,Ah=ot.set,ph=Kt("match"),dh=n.RegExp,fh=dh.prototype,mh=/a/g,gh=/a/g,_h=new dh(mh)!==mh,yh=Jo.UNSUPPORTED_Y;if(a&&Dt("RegExp",!_h||yh||o((function(){return gh[ph]=!1,dh(mh)!=mh||dh(gh)==gh||"/a/i"!=dh(mh,"i")})))){for(var vh=function(t,e){var r,i=this instanceof vh,n=Ba(t),o=void 0===e;if(!i&&n&&t.constructor===vh&&o)return t;_h?n&&!o&&(t=t.source):t instanceof vh&&(o&&(e=Wo.call(t)),t=t.source),yh&&(r=!!e&&e.indexOf("y")>-1)&&(e=e.replace(/y/g,""));var a=pn(_h?new dh(t,e):dh(t,e),i?this:fh,vh);return yh&&r&&Ah(a,{sticky:r}),a},xh=function(t){t in vh||uh(vh,t,{configurable:!0,get:function(){return dh[t]},set:function(e){dh[t]=e}})},wh=hh(dh),bh=0;wh.length>bh;)xh(wh[bh++]);fh.constructor=vh,vh.prototype=fh,at(n,"RegExp",vh)}gn("RegExp");var Bh=Math.floor,Ch="".replace,Eh=/\$([$&'`]|\d\d?|<[^>]*>)/g,Th=/\$([$&'`]|\d\d?)/g,Ih=function(t,e,r,i,n,o){var a=r+t.length,s=i.length,l=Th;return void 0!==n&&(n=Ot(n),l=Eh),Ch.call(o,l,(function(o,l){var c;switch(l.charAt(0)){case"$":return"$";case"&":return t;case"`":return e.slice(0,r);case"'":return e.slice(a);case"<":c=n[l.slice(1,-1)];break;default:var u=+l;if(0===u)return o;if(u>s){var h=Bh(u/10);return 0===h?o:h<=s?void 0===i[h-1]?l.charAt(1):i[h-1]+l.charAt(1):o}c=i[u-1]}return void 0===c?"":c}))},Sh=Math.max,Mh=Math.min;ya("replace",2,(function(t,e,r,i){var n=i.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,o=i.REPLACE_KEEPS_$0,a=n?"$":"$0";return[function(r,i){var n=m(this),o=null==r?void 0:r[t];return void 0!==o?o.call(r,n,i):e.call(String(n),r,i)},function(t,i){if(!n&&o||"string"==typeof i&&-1===i.indexOf(a)){var s=r(e,t,this,i);if(s.done)return s.value}var l=M(t),c=String(this),u="function"==typeof i;u||(i=String(i));var h=l.global;if(h){var A=l.unicode;l.lastIndex=0}for(var p=[];;){var d=wa(l,c);if(null===d)break;if(p.push(d),!h)break;""===String(d[0])&&(l.lastIndex=xa(c,dt(l.lastIndex),A))}for(var f,m="",g=0,_=0;_<p.length;_++){d=p[_];for(var y=String(d[0]),v=Sh(Mh(At(d.index),c.length),0),x=[],w=1;w<d.length;w++)x.push(void 0===(f=d[w])?f:String(f));var b=d.groups;if(u){var B=[y].concat(x,v,c);void 0!==b&&B.push(b);var C=String(i.apply(void 0,B))}else C=Ih(y,c,v,x,b,i);v>=g&&(m+=c.slice(g,v)+C,g=v+y.length)}return m+c.slice(g)}]}));var Fh={},Ph={};function Lh(t){return new Function("d","return {"+t.map((function(t,e){return JSON.stringify(t)+": d["+e+'] || ""'})).join(",")+"}")}function Dh(t){var e=Object.create(null),r=[];return t.forEach((function(t){for(var i in t)i in e||r.push(e[i]=i)})),r}function Uh(t,e){var r=t+"",i=r.length;return i<e?new Array(e-i+1).join(0)+r:r}function kh(t){var e,r=t.getUTCHours(),i=t.getUTCMinutes(),n=t.getUTCSeconds(),o=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":((e=t.getUTCFullYear())<0?"-"+Uh(-e,6):e>9999?"+"+Uh(e,6):Uh(e,4))+"-"+Uh(t.getUTCMonth()+1,2)+"-"+Uh(t.getUTCDate(),2)+(o?"T"+Uh(r,2)+":"+Uh(i,2)+":"+Uh(n,2)+"."+Uh(o,3)+"Z":n?"T"+Uh(r,2)+":"+Uh(i,2)+":"+Uh(n,2)+"Z":i||r?"T"+Uh(r,2)+":"+Uh(i,2)+"Z":"")}var zh=function(t){var e=new RegExp('["'+t+"\n\r]"),r=t.charCodeAt(0);function i(t,e){var i,n=[],o=t.length,a=0,s=0,l=o<=0,c=!1;function u(){if(l)return Ph;if(c)return c=!1,Fh;var e,i,n=a;if(34===t.charCodeAt(n)){for(;a++<o&&34!==t.charCodeAt(a)||34===t.charCodeAt(++a););return(e=a)>=o?l=!0:10===(i=t.charCodeAt(a++))?c=!0:13===i&&(c=!0,10===t.charCodeAt(a)&&++a),t.slice(n+1,e-1).replace(/""/g,'"')}for(;a<o;){if(10===(i=t.charCodeAt(e=a++)))c=!0;else if(13===i)c=!0,10===t.charCodeAt(a)&&++a;else if(i!==r)continue;return t.slice(n,e)}return l=!0,t.slice(n,o)}for(10===t.charCodeAt(o-1)&&--o,13===t.charCodeAt(o-1)&&--o;(i=u())!==Ph;){for(var h=[];i!==Fh&&i!==Ph;)h.push(i),i=u();e&&null==(h=e(h,s++))||n.push(h)}return n}function n(e,r){return e.map((function(e){return r.map((function(t){return a(e[t])})).join(t)}))}function o(e){return e.map(a).join(t)}function a(t){return null==t?"":t instanceof Date?kh(t):e.test(t+="")?'"'+t.replace(/"/g,'""')+'"':t}return{parse:function(t,e){var r,n,o=i(t,(function(t,i){if(r)return r(t,i-1);n=t,r=e?function(t,e){var r=Lh(t);return function(i,n){return e(r(i),n,t)}}(t,e):Lh(t)}));return o.columns=n||[],o},parseRows:i,format:function(e,r){return null==r&&(r=Dh(e)),[r.map(a).join(t)].concat(n(e,r)).join("\n")},formatBody:function(t,e){return null==e&&(e=Dh(t)),n(t,e).join("\n")},formatRows:function(t){return t.map(o).join("\n")},formatRow:o,formatValue:a}}(","),Rh=zh.parse;function Oh(t){for(var e in t){var r,i,n=t[e].trim();if(n)if("true"===n)n=!0;else if("false"===n)n=!1;else if("NaN"===n)n=NaN;else if(isNaN(r=+n)){if(!(i=n.match(/^([-+]\d{2})?\d{4}(-\d{2}(-\d{2})?)?(T\d{2}:\d{2}(:\d{2}(\.\d{3})?)?(Z|[-+]\d{2}:\d{2})?)?$/)))continue;Qh&&i[4]&&!i[7]&&(n=n.replace(/-/g,"/").replace(/T/," ")),n=new Date(n)}else n=r;else n=null;t[e]=n}return t}var Qh=new Date("2019-01-01T00:00").getHours()||new Date("2019-07-01T00:00").getHours();function Nh(t){return t}function Vh(t,e){return"string"==typeof e&&(e=t.objects[e]),"GeometryCollection"===e.type?{type:"FeatureCollection",features:e.geometries.map((function(e){return Hh(t,e)}))}:Hh(t,e)}function Hh(t,e){var r=e.id,i=e.bbox,n=null==e.properties?{}:e.properties,o=function(t,e){var r=function(t){if(null==t)return Nh;var e,r,i=t.scale[0],n=t.scale[1],o=t.translate[0],a=t.translate[1];return function(t,s){s||(e=r=0);var l=2,c=t.length,u=new Array(c);for(u[0]=(e+=t[0])*i+o,u[1]=(r+=t[1])*n+a;l<c;)u[l]=t[l],++l;return u}}(t.transform),i=t.arcs;function n(t,e){e.length&&e.pop();for(var n=i[t<0?~t:t],o=0,a=n.length;o<a;++o)e.push(r(n[o],o));t<0&&function(t,e){for(var r,i=t.length,n=i-e;n<--i;)r=t[n],t[n++]=t[i],t[i]=r}(e,a)}function o(t){return r(t)}function a(t){for(var e=[],r=0,i=t.length;r<i;++r)n(t[r],e);return e.length<2&&e.push(e[0]),e}function s(t){for(var e=a(t);e.length<4;)e.push(e[0]);return e}function l(t){return t.map(s)}function c(t){var e,r=t.type;switch(r){case"GeometryCollection":return{type:r,geometries:t.geometries.map(c)};case"Point":e=o(t.coordinates);break;case"MultiPoint":e=t.coordinates.map(o);break;case"LineString":e=a(t.arcs);break;case"MultiLineString":e=t.arcs.map(a);break;case"Polygon":e=l(t.arcs);break;case"MultiPolygon":e=t.arcs.map(l);break;default:return null}return{type:r,coordinates:e}}return c(e)}(t,e);return null==r&&null==i?{type:"Feature",properties:n,geometry:o}:null==i?{type:"Feature",id:r,properties:n,geometry:o}:{type:"Feature",id:r,bbox:i,properties:n,geometry:o}}function jh(t,e){return null==t||null==e?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Gh(t,e){return null==t||null==e?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Kh(t){var e,r,i;function n(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.length;if(n<o){if(0!==e(i,i))return o;do{var a=n+o>>>1;r(t[a],i)<0?n=a+1:o=a}while(n<o)}return n}return 2!==t.length?(e=jh,r=function(e,r){return jh(t(e),r)},i=function(e,r){return t(e)-r}):(e=t===jh||t===Gh?t:qh,r=t,i=t),{left:n,center:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=n(t,e,r,(arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.length)-1);return o>r&&i(t[o-1],e)>-i(t[o],e)?o-1:o},right:function(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.length;if(n<o){if(0!==e(i,i))return o;do{var a=n+o>>>1;r(t[a],i)<=0?n=a+1:o=a}while(n<o)}return n}}}function qh(){return 0}var Zh=Kh(jh).right;Kh((function(t){return null===t?NaN:+t})).center;function Wh(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return Xh(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Xh(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var i=0,n=function(){};return{s:n,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function Xh(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function $h(t,e){var r,i;if(void 0===e){var n,o=Wh(t);try{for(o.s();!(n=o.n()).done;){var a=n.value;null!=a&&(void 0===r?a>=a&&(r=i=a):(r>a&&(r=a),i<a&&(i=a)))}}catch(t){o.e(t)}finally{o.f()}}else{var s,l=-1,c=Wh(t);try{for(c.s();!(s=c.n()).done;){var u=s.value;null!=(u=e(u,++l,t))&&(void 0===r?u>=u&&(r=i=u):(r>u&&(r=u),i<u&&(i=u)))}}catch(t){c.e(t)}finally{c.f()}}return[r,i]}al("Float64",(function(t){return function(e,r,i){return t(this,e,r,i)}}));var Yh=function(t,e,r,i,n,o,a,s){for(var l,c=n,u=0,h=!!a&&Rt(a,s,3);u<i;){if(u in r){if(l=h?h(r[u],u,e):r[u],o>0&&Qt(l))c=Yh(t,e,l,dt(l.length),c,o-1)-1;else{if(c>=9007199254740991)throw TypeError("Exceed the acceptable array length");t[c]=l}c++}u++}return c},Jh=Yh;function tA(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var r=[],i=!0,n=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);i=!0);}catch(t){n=!0,o=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw o}}return r}}(t,e)||Ye(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function eA(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return rA(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return rA(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var i=0,n=function(){};return{s:n,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function rA(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function iA(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,i=Xe(t);if(e){var n=Xe(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return We(this,r)}}kt({target:"Array",proto:!0},{flatMap:function(t){var e,r=Ot(this),i=dt(r.length);return zt(t),(e=Zt(r,0)).length=Jh(e,r,r,i,0,1,t,arguments.length>1?arguments[1]:void 0),e}}),ve("flatMap");var nA=function(t){qe(r,t);var e=iA(r);function r(t){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:aA;if(je(this,r),i=e.call(this),Object.defineProperties(Ge(i),{_intern:{value:new Map},_key:{value:n}}),null!=t){var o,a=eA(t);try{for(a.s();!(o=a.n()).done;){var s=tA(o.value,2),l=s[0],c=s[1];i.set(l,c)}}catch(t){a.e(t)}finally{a.f()}}return i}return Gc(r,[{key:"get",value:function(t){return Hc(Xe(r.prototype),"get",this).call(this,oA(this,t))}},{key:"has",value:function(t){return Hc(Xe(r.prototype),"has",this).call(this,oA(this,t))}},{key:"set",value:function(t,e){return Hc(Xe(r.prototype),"set",this).call(this,function(t,e){var r=t._intern,i=(0,t._key)(e);return r.has(i)?r.get(i):(r.set(i,e),e)}(this,t),e)}},{key:"delete",value:function(t){return Hc(Xe(r.prototype),"delete",this).call(this,function(t,e){var r=t._intern,i=(0,t._key)(e);r.has(i)&&(e=r.get(i),r.delete(i));return e}(this,t))}}]),r}(Vc(Map));function oA(t,e){var r=t._intern,i=(0,t._key)(e);return r.has(i)?r.get(i):e}function aA(t){return null!==t&&"object"===Ze(t)?t.valueOf():t}function sA(t){return t}function lA(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return cA(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return cA(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var i=0,n=function(){};return{s:n,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function cA(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function uA(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];return function(t,e,r,i){return function t(n,o){if(o>=i.length)return r(n);var a,s=new nA,l=i[o++],c=-1,u=lA(n);try{for(u.s();!(a=u.n()).done;){var h=a.value,A=l(h,++c,n),p=s.get(A);p?p.push(h):s.set(A,[h])}}catch(t){u.e(t)}finally{u.f()}var d,f=lA(s);try{for(f.s();!(d=f.n()).done;){var m=tA(d.value,2),g=m[0],_=m[1];s.set(g,t(_,o))}}catch(t){f.e(t)}finally{f.f()}return e(s)}(t,0)}(t,Array.from,sA,r)}al("Uint32",(function(t){return function(e,r,i){return t(this,e,r,i)}}));var hA=Math.log,AA=Math.LOG10E;kt({target:"Math",stat:!0},{log10:function(t){return hA(t)*AA}});var pA=Math.sqrt(50),dA=Math.sqrt(10),fA=Math.sqrt(2);function mA(t,e,r){var i,n,o,a=(e-t)/Math.max(0,r),s=Math.floor(Math.log10(a)),l=a/Math.pow(10,s),c=l>=pA?10:l>=dA?5:l>=fA?2:1;return s<0?(o=Math.pow(10,-s)/c,(i=Math.round(t*o))/o<t&&++i,(n=Math.round(e*o))/o>e&&--n,o=-o):(o=Math.pow(10,s)*c,(i=Math.round(t/o))*o<t&&++i,(n=Math.round(e/o))*o>e&&--n),n<i&&.5<=r&&r<2?mA(t,e,2*r):[i,n,o]}function gA(t,e,r){return mA(t=+t,e=+e,r=+r)[2]}function _A(t,e,r){r=+r;var i=(e=+e)<(t=+t),n=i?gA(e,t,r):gA(t,e,r);return(i?-1:1)*(n<0?1/-n:n)}var yA=Math.sign||function(t){return 0==(t=+t)||t!=t?t:t<0?-1:1};var vA={value:function(){}};function xA(){for(var t,e=0,r=arguments.length,i={};e<r;++e){if(!(t=arguments[e]+"")||t in i||/[\s.]/.test(t))throw new Error("illegal type: "+t);i[t]=[]}return new wA(i)}function wA(t){this._=t}function bA(t,e){for(var r,i=0,n=t.length;i<n;++i)if((r=t[i]).name===e)return r.value}function BA(t,e,r){for(var i=0,n=t.length;i<n;++i)if(t[i].name===e){t[i]=vA,t=t.slice(0,i).concat(t.slice(i+1));break}return null!=r&&t.push({name:e,value:r}),t}function CA(t,e,r){t.prototype=e.prototype=r,r.constructor=t}function EA(t,e){var r=Object.create(t.prototype);for(var i in e)r[i]=e[i];return r}function TA(){}wA.prototype=xA.prototype={constructor:wA,on:function(t,e){var r,i,n=this._,o=(i=n,(t+"").trim().split(/^|\s+/).map((function(t){var e="",r=t.indexOf(".");if(r>=0&&(e=t.slice(r+1),t=t.slice(0,r)),t&&!i.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}}))),a=-1,s=o.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++a<s;)if(r=(t=o[a]).type)n[r]=BA(n[r],t.name,e);else if(null==e)for(r in n)n[r]=BA(n[r],t.name,null);return this}for(;++a<s;)if((r=(t=o[a]).type)&&(r=bA(n[r],t.name)))return r},copy:function(){var t={},e=this._;for(var r in e)t[r]=e[r].slice();return new wA(t)},call:function(t,e){if((r=arguments.length-2)>0)for(var r,i,n=new Array(r),o=0;o<r;++o)n[o]=arguments[o+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=0,r=(i=this._[t]).length;o<r;++o)i[o].value.apply(e,n)},apply:function(t,e,r){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],n=0,o=i.length;n<o;++n)i[n].value.apply(e,r)}};var IA=.7,SA=1/IA,MA="\\s*([+-]?\\d+)\\s*",FA="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",PA="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",LA=/^#([0-9a-f]{3,8})$/,DA=new RegExp("^rgb\\(".concat(MA,",").concat(MA,",").concat(MA,"\\)$")),UA=new RegExp("^rgb\\(".concat(PA,",").concat(PA,",").concat(PA,"\\)$")),kA=new RegExp("^rgba\\(".concat(MA,",").concat(MA,",").concat(MA,",").concat(FA,"\\)$")),zA=new RegExp("^rgba\\(".concat(PA,",").concat(PA,",").concat(PA,",").concat(FA,"\\)$")),RA=new RegExp("^hsl\\(".concat(FA,",").concat(PA,",").concat(PA,"\\)$")),OA=new RegExp("^hsla\\(".concat(FA,",").concat(PA,",").concat(PA,",").concat(FA,"\\)$")),QA={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function NA(){return this.rgb().formatHex()}function VA(){return this.rgb().formatRgb()}function HA(t){var e,r;return t=(t+"").trim().toLowerCase(),(e=LA.exec(t))?(r=e[1].length,e=parseInt(e[1],16),6===r?jA(e):3===r?new qA(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===r?GA(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===r?GA(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=DA.exec(t))?new qA(e[1],e[2],e[3],1):(e=UA.exec(t))?new qA(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=kA.exec(t))?GA(e[1],e[2],e[3],e[4]):(e=zA.exec(t))?GA(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=RA.exec(t))?JA(e[1],e[2]/100,e[3]/100,1):(e=OA.exec(t))?JA(e[1],e[2]/100,e[3]/100,e[4]):QA.hasOwnProperty(t)?jA(QA[t]):"transparent"===t?new qA(NaN,NaN,NaN,0):null}function jA(t){return new qA(t>>16&255,t>>8&255,255&t,1)}function GA(t,e,r,i){return i<=0&&(t=e=r=NaN),new qA(t,e,r,i)}function KA(t,e,r,i){return 1===arguments.length?((n=t)instanceof TA||(n=HA(n)),n?new qA((n=n.rgb()).r,n.g,n.b,n.opacity):new qA):new qA(t,e,r,null==i?1:i);var n}function qA(t,e,r,i){this.r=+t,this.g=+e,this.b=+r,this.opacity=+i}function ZA(){return"#".concat(YA(this.r)).concat(YA(this.g)).concat(YA(this.b))}function WA(){var t=XA(this.opacity);return"".concat(1===t?"rgb(":"rgba(").concat($A(this.r),", ").concat($A(this.g),", ").concat($A(this.b)).concat(1===t?")":", ".concat(t,")"))}function XA(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function $A(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function YA(t){return((t=$A(t))<16?"0":"")+t.toString(16)}function JA(t,e,r,i){return i<=0?t=e=r=NaN:r<=0||r>=1?t=e=NaN:e<=0&&(t=NaN),new ep(t,e,r,i)}function tp(t){if(t instanceof ep)return new ep(t.h,t.s,t.l,t.opacity);if(t instanceof TA||(t=HA(t)),!t)return new ep;if(t instanceof ep)return t;var e=(t=t.rgb()).r/255,r=t.g/255,i=t.b/255,n=Math.min(e,r,i),o=Math.max(e,r,i),a=NaN,s=o-n,l=(o+n)/2;return s?(a=e===o?(r-i)/s+6*(r<i):r===o?(i-e)/s+2:(e-r)/s+4,s/=l<.5?o+n:2-o-n,a*=60):s=l>0&&l<1?0:a,new ep(a,s,l,t.opacity)}function ep(t,e,r,i){this.h=+t,this.s=+e,this.l=+r,this.opacity=+i}function rp(t){return(t=(t||0)%360)<0?t+360:t}function ip(t){return Math.max(0,Math.min(1,t||0))}function np(t,e,r){return 255*(t<60?e+(r-e)*t/60:t<180?r:t<240?e+(r-e)*(240-t)/60:e)}CA(TA,HA,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:NA,formatHex:NA,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return tp(this).formatHsl()},formatRgb:VA,toString:VA}),CA(qA,KA,EA(TA,{brighter:function(t){return t=null==t?SA:Math.pow(SA,t),new qA(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?IA:Math.pow(IA,t),new qA(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},clamp:function(){return new qA($A(this.r),$A(this.g),$A(this.b),XA(this.opacity))},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:ZA,formatHex:ZA,formatHex8:function(){return"#".concat(YA(this.r)).concat(YA(this.g)).concat(YA(this.b)).concat(YA(255*(isNaN(this.opacity)?1:this.opacity)))},formatRgb:WA,toString:WA})),CA(ep,(function(t,e,r,i){return 1===arguments.length?tp(t):new ep(t,e,r,null==i?1:i)}),EA(TA,{brighter:function(t){return t=null==t?SA:Math.pow(SA,t),new ep(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?IA:Math.pow(IA,t),new ep(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,r=this.l,i=r+(r<.5?r:1-r)*e,n=2*r-i;return new qA(np(t>=240?t-240:t+120,n,i),np(t,n,i),np(t<120?t+240:t-120,n,i),this.opacity)},clamp:function(){return new ep(rp(this.h),ip(this.s),ip(this.l),XA(this.opacity))},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=XA(this.opacity);return"".concat(1===t?"hsl(":"hsla(").concat(rp(this.h),", ").concat(100*ip(this.s),"%, ").concat(100*ip(this.l),"%").concat(1===t?")":", ".concat(t,")"))}}));var op=function(t){return function(){return t}};function ap(t){return 1==(t=+t)?sp:function(e,r){return r-e?function(t,e,r){return t=Math.pow(t,r),e=Math.pow(e,r)-t,r=1/r,function(i){return Math.pow(t+i*e,r)}}(e,r,t):op(isNaN(e)?r:e)}}function sp(t,e){var r=e-t;return r?function(t,e){return function(r){return t+r*e}}(t,r):op(isNaN(t)?e:t)}var lp=function t(e){var r=ap(e);function i(t,e){var i=r((t=KA(t)).r,(e=KA(e)).r),n=r(t.g,e.g),o=r(t.b,e.b),a=sp(t.opacity,e.opacity);return function(e){return t.r=i(e),t.g=n(e),t.b=o(e),t.opacity=a(e),t+""}}return i.gamma=t,i}(1),cp="ArrayBuffer",up=rl[cp],hp=n[cp];function Ap(t,e){e||(e=[]);var r,i=t?Math.min(e.length,t.length):0,n=e.slice();return function(o){for(r=0;r<i;++r)n[r]=t[r]*(1-o)+e[r]*o;return n}}function pp(t,e){var r,i=e?e.length:0,n=t?Math.min(i,t.length):0,o=new Array(n),a=new Array(i);for(r=0;r<n;++r)o[r]=vp(t[r],e[r]);for(;r<i;++r)a[r]=e[r];return function(t){for(r=0;r<n;++r)a[r]=o[r](t);return a}}function dp(t,e){var r=new Date;return t=+t,e=+e,function(i){return r.setTime(t*(1-i)+e*i),r}}function fp(t,e){return t=+t,e=+e,function(r){return t*(1-r)+e*r}}function mp(t,e){var r,i={},n={};for(r in null!==t&&"object"===Ze(t)||(t={}),null!==e&&"object"===Ze(e)||(e={}),e)r in t?i[r]=vp(t[r],e[r]):n[r]=e[r];return function(t){for(r in i)n[r]=i[r](t);return n}}kt({global:!0,forced:hp!==up},{ArrayBuffer:up}),gn(cp);var gp=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,_p=new RegExp(gp.source,"g");function yp(t,e){var r,i,n,o=gp.lastIndex=_p.lastIndex=0,a=-1,s=[],l=[];for(t+="",e+="";(r=gp.exec(t))&&(i=_p.exec(e));)(n=i.index)>o&&(n=e.slice(o,n),s[a]?s[a]+=n:s[++a]=n),(r=r[0])===(i=i[0])?s[a]?s[a]+=i:s[++a]=i:(s[++a]=null,l.push({i:a,x:fp(r,i)})),o=_p.lastIndex;return o<e.length&&(n=e.slice(o),s[a]?s[a]+=n:s[++a]=n),s.length<2?l[0]?function(t){return function(e){return t(e)+""}}(l[0].x):function(t){return function(){return t}}(e):(e=l.length,function(t){for(var r,i=0;i<e;++i)s[(r=l[i]).i]=r.x(t);return s.join("")})}function vp(t,e){var r,i=Ze(e);return null==e||"boolean"===i?op(e):("number"===i?fp:"string"===i?(r=HA(e))?(e=r,lp):yp:e instanceof HA?lp:e instanceof Date?dp:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}(e)?Ap:Array.isArray(e)?pp:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?mp:fp)(t,e)}function xp(t,e){return t=+t,e=+e,function(r){return Math.round(t*(1-r)+e*r)}}var wp,bp,Bp=0,Cp=0,Ep=0,Tp=1e3,Ip=0,Sp=0,Mp=0,Fp="object"===("undefined"==typeof performance?"undefined":Ze(performance))&&performance.now?performance:Date,Pp="object"===("undefined"==typeof window?"undefined":Ze(window))&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Lp(){return Sp||(Pp(Dp),Sp=Fp.now()+Mp)}function Dp(){Sp=0}function Up(){this._call=this._time=this._next=null}function kp(t,e,r){var i=new Up;return i.restart(t,e,r),i}function zp(){Sp=(Ip=Fp.now())+Mp,Bp=Cp=0;try{!function(){Lp(),++Bp;for(var t,e=wp;e;)(t=Sp-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Bp}()}finally{Bp=0,function(){var t,e,r=wp,i=1/0;for(;r;)r._call?(i>r._time&&(i=r._time),t=r,r=r._next):(e=r._next,r._next=null,r=t?t._next=e:wp=e);bp=t,Op(i)}(),Sp=0}}function Rp(){var t=Fp.now(),e=t-Ip;e>Tp&&(Mp-=e,Ip=t)}function Op(t){Bp||(Cp&&(Cp=clearTimeout(Cp)),t-Sp>24?(t<1/0&&(Cp=setTimeout(zp,t-Fp.now()-Mp)),Ep&&(Ep=clearInterval(Ep))):(Ep||(Ip=Fp.now(),Ep=setInterval(Rp,Tp)),Bp=1,Pp(zp)))}Up.prototype=kp.prototype={constructor:Up,restart:function(t,e,r){if("function"!=typeof t)throw new TypeError("callback is not a function");r=(null==r?Lp():+r)+(null==e?0:+e),this._next||bp===this||(bp?bp._next=this:wp=this,bp=this),this._call=t,this._time=r,Op()},stop:function(){this._call&&(this._call=null,this._time=1/0,Op())}};var Qp,Np,Vp,Hp,jp,Gp,Kp,qp,Zp,Wp,Xp,$p,Yp,Jp,td=u.f,ed=function(t){return function(e){for(var r,i=_(e),n=le(i),o=n.length,s=0,l=[];o>s;)r=n[s++],a&&!td.call(i,r)||l.push(t?[r,i[r]]:i[r]);return l}},rd={entries:ed(!0),values:ed(!1)};function id(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}var nd=Math.PI,od=2*nd,ad=1e-6,sd=od-ad;function ld(t){this._+=t[0];for(var e=1,r=t.length;e<r;++e)this._+=arguments[e]+t[e]}var cd=function(){function t(e){je(this,t),this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==e?ld:function(t){var e=Math.floor(t);if(!(e>=0))throw new Error("invalid digits: ".concat(t));if(e>15)return ld;var r=Math.pow(10,e);return function(t){this._+=t[0];for(var e=1,i=t.length;e<i;++e)this._+=Math.round(arguments[e]*r)/r+t[e]}}(e)}return Gc(t,[{key:"moveTo",value:function(t,e){this._append(Qp||(Qp=id(["M",",",""])),this._x0=this._x1=+t,this._y0=this._y1=+e)}},{key:"closePath",value:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append(Np||(Np=id(["Z"]))))}},{key:"lineTo",value:function(t,e){this._append(Vp||(Vp=id(["L",",",""])),this._x1=+t,this._y1=+e)}},{key:"quadraticCurveTo",value:function(t,e,r,i){this._append(Hp||(Hp=id(["Q",",",",",",",""])),+t,+e,this._x1=+r,this._y1=+i)}},{key:"bezierCurveTo",value:function(t,e,r,i,n,o){this._append(jp||(jp=id(["C",",",",",",",",",",",""])),+t,+e,+r,+i,this._x1=+n,this._y1=+o)}},{key:"arcTo",value:function(t,e,r,i,n){if(t=+t,e=+e,r=+r,i=+i,(n=+n)<0)throw new Error("negative radius: ".concat(n));var o=this._x1,a=this._y1,s=r-t,l=i-e,c=o-t,u=a-e,h=c*c+u*u;if(null===this._x1)this._append(Gp||(Gp=id(["M",",",""])),this._x1=t,this._y1=e);else if(h>ad)if(Math.abs(u*s-l*c)>ad&&n){var A=r-o,p=i-a,d=s*s+l*l,f=A*A+p*p,m=Math.sqrt(d),g=Math.sqrt(h),_=n*Math.tan((nd-Math.acos((d+h-f)/(2*m*g)))/2),y=_/g,v=_/m;Math.abs(y-1)>ad&&this._append(qp||(qp=id(["L",",",""])),t+y*c,e+y*u),this._append(Zp||(Zp=id(["A",",",",0,0,",",",",",""])),n,n,+(u*A>c*p),this._x1=t+v*s,this._y1=e+v*l)}else this._append(Kp||(Kp=id(["L",",",""])),this._x1=t,this._y1=e);else;}},{key:"arc",value:function(t,e,r,i,n,o){if(t=+t,e=+e,o=!!o,(r=+r)<0)throw new Error("negative radius: ".concat(r));var a=r*Math.cos(i),s=r*Math.sin(i),l=t+a,c=e+s,u=1^o,h=o?i-n:n-i;null===this._x1?this._append(Wp||(Wp=id(["M",",",""])),l,c):(Math.abs(this._x1-l)>ad||Math.abs(this._y1-c)>ad)&&this._append(Xp||(Xp=id(["L",",",""])),l,c),r&&(h<0&&(h=h%od+od),h>sd?this._append($p||($p=id(["A",",",",0,1,",",",",","A",",",",0,1,",",",",",""])),r,r,u,t-a,e-s,r,r,u,this._x1=l,this._y1=c):h>ad&&this._append(Yp||(Yp=id(["A",",",",0,",",",",",",",""])),r,r,+(h>=nd),u,this._x1=t+r*Math.cos(n),this._y1=e+r*Math.sin(n)))}},{key:"rect",value:function(t,e,r,i){this._append(Jp||(Jp=id(["M",",","h","v","h","Z"])),this._x0=this._x1=+t,this._y0=this._y1=+e,r=+r,+i,-r)}},{key:"toString",value:function(){return this._}}]),t}();kt({target:"Math",stat:!0},{sign:yA});var ud=Bt.f,hd=S.f,Ad=P.f,pd=Ha.trim,dd="Number",fd=n[dd],md=fd.prototype,gd=p(ge(md))==dd,_d=function(t){var e,r,i,n,o,a,s,l,c=v(t,!1);if("string"==typeof c&&c.length>2)if(43===(e=(c=pd(c)).charCodeAt(0))||45===e){if(88===(r=c.charCodeAt(2))||120===r)return NaN}else if(48===e){switch(c.charCodeAt(1)){case 66:case 98:i=2,n=49;break;case 79:case 111:i=8,n=55;break;default:return+c}for(a=(o=c.slice(2)).length,s=0;s<a;s++)if((l=o.charCodeAt(s))<48||l>n)return NaN;return parseInt(o,i)}return+c};if(Dt(dd,!fd(" 0o1")||!fd("0b1")||fd("+0x1"))){for(var yd,vd=function(t){var e=arguments.length<1?0:t,r=this;return r instanceof vd&&(gd?o((function(){md.valueOf.call(r)})):p(r)!=dd)?pn(new fd(_d(e)),r,vd):_d(e)},xd=a?ud(fd):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger,fromString,range".split(","),wd=0;xd.length>wd;wd++)w(fd,yd=xd[wd])&&!w(vd,yd)&&Ad(vd,yd,hd(fd,yd));vd.prototype=md,md.constructor=vd,at(n,dd,vd)}al("Float32",(function(t){return function(e,r,i){return t(this,e,r,i)}}));var bd=Math.hypot,Bd=Math.abs,Cd=Math.sqrt,Ed=!!bd&&bd(1/0,NaN)!==1/0;function Td(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.text()}kt({target:"Math",stat:!0,forced:Ed},{hypot:function(t,e){for(var r,i,n=0,o=0,a=arguments.length,s=0;o<a;)s<(r=Bd(arguments[o++]))?(n=n*(i=s/r)*i+1,s=r):n+=r>0?(i=r/s)*i:r;return s===1/0?1/0:s*Cd(n)}});var Id,Sd=(Id=Rh,function(t,e,r){return 2===arguments.length&&"function"==typeof e&&(r=e,e=void 0),function(t,e){return fetch(t,e).then(Td)}(t,e).then((function(t){return Id(t,r)}))});function Md(t,e,r,i){if(isNaN(e)||isNaN(r))return t;var n,o,a,s,l,c,u,h,A,p=t._root,d={data:i},f=t._x0,m=t._y0,g=t._x1,_=t._y1;if(!p)return t._root=d,t;for(;p.length;)if((c=e>=(o=(f+g)/2))?f=o:g=o,(u=r>=(a=(m+_)/2))?m=a:_=a,n=p,!(p=p[h=u<<1|c]))return n[h]=d,t;if(s=+t._x.call(null,p.data),l=+t._y.call(null,p.data),e===s&&r===l)return d.next=p,n?n[h]=d:t._root=d,t;do{n=n?n[h]=new Array(4):t._root=new Array(4),(c=e>=(o=(f+g)/2))?f=o:g=o,(u=r>=(a=(m+_)/2))?m=a:_=a}while((h=u<<1|c)==(A=(l>=a)<<1|s>=o));return n[A]=p,n[h]=d,t}function Fd(t,e,r,i,n){this.node=t,this.x0=e,this.y0=r,this.x1=i,this.y1=n}function Pd(t){return t[0]}function Ld(t){return t[1]}function Dd(t,e,r){var i=new Ud(null==e?Pd:e,null==r?Ld:r,NaN,NaN,NaN,NaN);return null==t?i:i.addAll(t)}function Ud(t,e,r,i,n,o){this._x=t,this._y=e,this._x0=r,this._y0=i,this._x1=n,this._y1=o,this._root=void 0}function kd(t){for(var e={data:t.data},r=e;t=t.next;)r=r.next={data:t.data};return e}var zd=Dd.prototype=Ud.prototype;function Rd(t){return function(){return t}}function Od(t){return 1e-6*(t()-.5)}function Qd(t){return t.x+t.vx}function Nd(t){return t.y+t.vy}zd.copy=function(){var t,e,r=new Ud(this._x,this._y,this._x0,this._y0,this._x1,this._y1),i=this._root;if(!i)return r;if(!i.length)return r._root=kd(i),r;for(t=[{source:i,target:r._root=new Array(4)}];i=t.pop();)for(var n=0;n<4;++n)(e=i.source[n])&&(e.length?t.push({source:e,target:i.target[n]=new Array(4)}):i.target[n]=kd(e));return r},zd.add=function(t){var e=+this._x.call(null,t),r=+this._y.call(null,t);return Md(this.cover(e,r),e,r,t)},zd.addAll=function(t){var e,r,i,n,o=t.length,a=new Array(o),s=new Array(o),l=1/0,c=1/0,u=-1/0,h=-1/0;for(r=0;r<o;++r)isNaN(i=+this._x.call(null,e=t[r]))||isNaN(n=+this._y.call(null,e))||(a[r]=i,s[r]=n,i<l&&(l=i),i>u&&(u=i),n<c&&(c=n),n>h&&(h=n));if(l>u||c>h)return this;for(this.cover(l,c).cover(u,h),r=0;r<o;++r)Md(this,a[r],s[r],t[r]);return this},zd.cover=function(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var r=this._x0,i=this._y0,n=this._x1,o=this._y1;if(isNaN(r))n=(r=Math.floor(t))+1,o=(i=Math.floor(e))+1;else{for(var a,s,l=n-r||1,c=this._root;r>t||t>=n||i>e||e>=o;)switch(s=(e<i)<<1|t<r,(a=new Array(4))[s]=c,c=a,l*=2,s){case 0:n=r+l,o=i+l;break;case 1:r=n-l,o=i+l;break;case 2:n=r+l,i=o-l;break;case 3:r=n-l,i=o-l}this._root&&this._root.length&&(this._root=c)}return this._x0=r,this._y0=i,this._x1=n,this._y1=o,this},zd.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},zd.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},zd.find=function(t,e,r){var i,n,o,a,s,l,c,u=this._x0,h=this._y0,A=this._x1,p=this._y1,d=[],f=this._root;for(f&&d.push(new Fd(f,u,h,A,p)),null==r?r=1/0:(u=t-r,h=e-r,A=t+r,p=e+r,r*=r);l=d.pop();)if(!(!(f=l.node)||(n=l.x0)>A||(o=l.y0)>p||(a=l.x1)<u||(s=l.y1)<h))if(f.length){var m=(n+a)/2,g=(o+s)/2;d.push(new Fd(f[3],m,g,a,s),new Fd(f[2],n,g,m,s),new Fd(f[1],m,o,a,g),new Fd(f[0],n,o,m,g)),(c=(e>=g)<<1|t>=m)&&(l=d[d.length-1],d[d.length-1]=d[d.length-1-c],d[d.length-1-c]=l)}else{var _=t-+this._x.call(null,f.data),y=e-+this._y.call(null,f.data),v=_*_+y*y;if(v<r){var x=Math.sqrt(r=v);u=t-x,h=e-x,A=t+x,p=e+x,i=f.data}}return i},zd.remove=function(t){if(isNaN(o=+this._x.call(null,t))||isNaN(a=+this._y.call(null,t)))return this;var e,r,i,n,o,a,s,l,c,u,h,A,p=this._root,d=this._x0,f=this._y0,m=this._x1,g=this._y1;if(!p)return this;if(p.length)for(;;){if((c=o>=(s=(d+m)/2))?d=s:m=s,(u=a>=(l=(f+g)/2))?f=l:g=l,e=p,!(p=p[h=u<<1|c]))return this;if(!p.length)break;(e[h+1&3]||e[h+2&3]||e[h+3&3])&&(r=e,A=h)}for(;p.data!==t;)if(i=p,!(p=p.next))return this;return(n=p.next)&&delete p.next,i?(n?i.next=n:delete i.next,this):e?(n?e[h]=n:delete e[h],(p=e[0]||e[1]||e[2]||e[3])&&p===(e[3]||e[2]||e[1]||e[0])&&!p.length&&(r?r[A]=p:this._root=p),this):(this._root=n,this)},zd.removeAll=function(t){for(var e=0,r=t.length;e<r;++e)this.remove(t[e]);return this},zd.root=function(){return this._root},zd.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},zd.visit=function(t){var e,r,i,n,o,a,s=[],l=this._root;for(l&&s.push(new Fd(l,this._x0,this._y0,this._x1,this._y1));e=s.pop();)if(!t(l=e.node,i=e.x0,n=e.y0,o=e.x1,a=e.y1)&&l.length){var c=(i+o)/2,u=(n+a)/2;(r=l[3])&&s.push(new Fd(r,c,u,o,a)),(r=l[2])&&s.push(new Fd(r,i,u,c,a)),(r=l[1])&&s.push(new Fd(r,c,n,o,u)),(r=l[0])&&s.push(new Fd(r,i,n,c,u))}return this},zd.visitAfter=function(t){var e,r=[],i=[];for(this._root&&r.push(new Fd(this._root,this._x0,this._y0,this._x1,this._y1));e=r.pop();){var n=e.node;if(n.length){var o,a=e.x0,s=e.y0,l=e.x1,c=e.y1,u=(a+l)/2,h=(s+c)/2;(o=n[0])&&r.push(new Fd(o,a,s,u,h)),(o=n[1])&&r.push(new Fd(o,u,s,l,h)),(o=n[2])&&r.push(new Fd(o,a,h,u,c)),(o=n[3])&&r.push(new Fd(o,u,h,l,c))}i.push(e)}for(;e=i.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this},zd.x=function(t){return arguments.length?(this._x=t,this):this._x},zd.y=function(t){return arguments.length?(this._y=t,this):this._y};var Vd=1664525,Hd=1013904223,jd=4294967296;var Gd=10,Kd=Math.PI*(3-Math.sqrt(5));function qd(t){var e,r,i=1,n=.001,o=1-Math.pow(n,1/300),a=0,s=.6,l=new Map,c=kp(A),u=xA("tick","end"),h=(r=1,function(){return(r=(Vd*r+Hd)%jd)/jd});function A(){p(),u.call("tick",e),i<n&&(c.stop(),u.call("end",e))}function p(r){var n,c,u=t.length;void 0===r&&(r=1);for(var h=0;h<r;++h)for(i+=(a-i)*o,l.forEach((function(t){t(i)})),n=0;n<u;++n)null==(c=t[n]).fx?c.x+=c.vx*=s:(c.x=c.fx,c.vx=0),null==c.fy?c.y+=c.vy*=s:(c.y=c.fy,c.vy=0);return e}function d(){for(var e,r=0,i=t.length;r<i;++r){if((e=t[r]).index=r,null!=e.fx&&(e.x=e.fx),null!=e.fy&&(e.y=e.fy),isNaN(e.x)||isNaN(e.y)){var n=Gd*Math.sqrt(.5+r),o=r*Kd;e.x=n*Math.cos(o),e.y=n*Math.sin(o)}(isNaN(e.vx)||isNaN(e.vy))&&(e.vx=e.vy=0)}}function f(e){return e.initialize&&e.initialize(t,h),e}return null==t&&(t=[]),d(),e={tick:p,restart:function(){return c.restart(A),e},stop:function(){return c.stop(),e},nodes:function(r){return arguments.length?(t=r,d(),l.forEach(f),e):t},alpha:function(t){return arguments.length?(i=+t,e):i},alphaMin:function(t){return arguments.length?(n=+t,e):n},alphaDecay:function(t){return arguments.length?(o=+t,e):+o},alphaTarget:function(t){return arguments.length?(a=+t,e):a},velocityDecay:function(t){return arguments.length?(s=1-t,e):1-s},randomSource:function(t){return arguments.length?(h=t,l.forEach(f),e):h},force:function(t,r){return arguments.length>1?(null==r?l.delete(t):l.set(t,f(r)),e):l.get(t)},find:function(e,r,i){var n,o,a,s,l,c=0,u=t.length;for(null==i?i=1/0:i*=i,c=0;c<u;++c)(a=(n=e-(s=t[c]).x)*n+(o=r-s.y)*o)<i&&(l=s,i=a);return l},on:function(t,r){return arguments.length>1?(u.on(t,r),e):u.on(t)}}}function Zd(t,e){if((r=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var r,i=t.slice(0,r);return[i.length>1?i[0]+i.slice(2):i,+t.slice(r+1)]}function Wd(t){return(t=Zd(Math.abs(t)))?t[1]:NaN}var Xd=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function $d(t){if(!(e=Xd.exec(t)))throw new Error("invalid format: "+t);var e;return new Yd({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function Yd(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}$d.prototype=Yd.prototype,Yd.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var Jd,tf="".repeat||function(t){var e=String(m(this)),r="",i=At(t);if(i<0||i==1/0)throw RangeError("Wrong number of repetitions");for(;i>0;(i>>>=1)&&(e+=e))1&i&&(r+=e);return r},ef=1..toFixed,rf=Math.floor,nf=function(t,e,r){return 0===e?r:e%2==1?nf(t,e-1,r*t):nf(t*t,e/2,r)},of=function(t,e,r){for(var i=-1,n=r;++i<6;)n+=e*t[i],t[i]=n%1e7,n=rf(n/1e7)},af=function(t,e){for(var r=6,i=0;--r>=0;)i+=t[r],t[r]=rf(i/e),i=i%e*1e7},sf=function(t){for(var e=6,r="";--e>=0;)if(""!==r||0===e||0!==t[e]){var i=String(t[e]);r=""===r?i:r+tf.call("0",7-i.length)+i}return r},lf=ef&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!o((function(){ef.call({})}));function cf(t,e){var r=Zd(t,e);if(!r)return t+"";var i=r[0],n=r[1];return n<0?"0."+new Array(-n).join("0")+i:i.length>n+1?i.slice(0,n+1)+"."+i.slice(n+1):i+new Array(n-i.length+2).join("0")}kt({target:"Number",proto:!0,forced:lf},{toFixed:function(t){var e,r,i,n,o=function(t){if("number"!=typeof t&&"Number"!=p(t))throw TypeError("Incorrect invocation");return+t}(this),a=At(t),s=[0,0,0,0,0,0],l="",c="0";if(a<0||a>20)throw RangeError("Incorrect fraction digits");if(o!=o)return"NaN";if(o<=-1e21||o>=1e21)return String(o);if(o<0&&(l="-",o=-o),o>1e-21)if(e=function(t){for(var e=0,r=t;r>=4096;)e+=12,r/=4096;for(;r>=2;)e+=1,r/=2;return e}(o*nf(2,69,1))-69,r=e<0?o*nf(2,-e,1):o/nf(2,e,1),r*=4503599627370496,(e=52-e)>0){for(of(s,0,r),i=a;i>=7;)of(s,1e7,0),i-=7;for(of(s,nf(10,i,1),0),i=e-1;i>=23;)af(s,1<<23),i-=23;af(s,1<<i),of(s,1,1),af(s,2),c=sf(s)}else of(s,0,r),of(s,1<<-e,0),c=sf(s)+tf.call("0",a);return c=a>0?l+((n=c.length)<=a?"0."+tf.call("0",a-n)+c:c.slice(0,n-a)+"."+c.slice(n-a)):l+c}});var uf={"%":function(t,e){return(100*t).toFixed(e)},b:function(t){return Math.round(t).toString(2)},c:function(t){return t+""},d:function(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},g:function(t,e){return t.toPrecision(e)},o:function(t){return Math.round(t).toString(8)},p:function(t,e){return cf(100*t,e)},r:cf,s:function(t,e){var r=Zd(t,e);if(!r)return t+"";var i=r[0],n=r[1],o=n-(Jd=3*Math.max(-8,Math.min(8,Math.floor(n/3))))+1,a=i.length;return o===a?i:o>a?i+new Array(o-a+1).join("0"):o>0?i.slice(0,o)+"."+i.slice(o):"0."+new Array(1-o).join("0")+Zd(t,Math.max(0,e+o-1))[0]},X:function(t){return Math.round(t).toString(16).toUpperCase()},x:function(t){return Math.round(t).toString(16)}};function hf(t){return t}var Af,pf,df,ff=Array.prototype.map,mf=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function gf(t){var e,r,i=void 0===t.grouping||void 0===t.thousands?hf:(e=ff.call(t.grouping,Number),r=t.thousands+"",function(t,i){for(var n=t.length,o=[],a=0,s=e[0],l=0;n>0&&s>0&&(l+s+1>i&&(s=Math.max(1,i-l)),o.push(t.substring(n-=s,n+s)),!((l+=s+1)>i));)s=e[a=(a+1)%e.length];return o.reverse().join(r)}),n=void 0===t.currency?"":t.currency[0]+"",o=void 0===t.currency?"":t.currency[1]+"",a=void 0===t.decimal?".":t.decimal+"",s=void 0===t.numerals?hf:function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(ff.call(t.numerals,String)),l=void 0===t.percent?"%":t.percent+"",c=void 0===t.minus?"−":t.minus+"",u=void 0===t.nan?"NaN":t.nan+"";function h(t){var e=(t=$d(t)).fill,r=t.align,h=t.sign,A=t.symbol,p=t.zero,d=t.width,f=t.comma,m=t.precision,g=t.trim,_=t.type;"n"===_?(f=!0,_="g"):uf[_]||(void 0===m&&(m=12),g=!0,_="g"),(p||"0"===e&&"="===r)&&(p=!0,e="0",r="=");var y="$"===A?n:"#"===A&&/[boxX]/.test(_)?"0"+_.toLowerCase():"",v="$"===A?o:/[%p]/.test(_)?l:"",x=uf[_],w=/[defgprs%]/.test(_);function b(t){var n,o,l,A=y,b=v;if("c"===_)b=x(t)+b,t="";else{var B=(t=+t)<0||1/t<0;if(t=isNaN(t)?u:x(Math.abs(t),m),g&&(t=function(t){t:for(var e,r=t.length,i=1,n=-1;i<r;++i)switch(t[i]){case".":n=e=i;break;case"0":0===n&&(n=i),e=i;break;default:if(!+t[i])break t;n>0&&(n=0)}return n>0?t.slice(0,n)+t.slice(e+1):t}(t)),B&&0==+t&&"+"!==h&&(B=!1),A=(B?"("===h?h:c:"-"===h||"("===h?"":h)+A,b=("s"===_?mf[8+Jd/3]:"")+b+(B&&"("===h?")":""),w)for(n=-1,o=t.length;++n<o;)if(48>(l=t.charCodeAt(n))||l>57){b=(46===l?a+t.slice(n+1):t.slice(n))+b,t=t.slice(0,n);break}}f&&!p&&(t=i(t,1/0));var C=A.length+t.length+b.length,E=C<d?new Array(d-C+1).join(e):"";switch(f&&p&&(t=i(E+t,E.length?d-b.length:1/0),E=""),r){case"<":t=A+t+b+E;break;case"=":t=A+E+t+b;break;case"^":t=E.slice(0,C=E.length>>1)+A+t+b+E.slice(C);break;default:t=E+A+t+b}return s(t)}return m=void 0===m?6:/[gprs]/.test(_)?Math.max(1,Math.min(21,m)):Math.max(0,Math.min(20,m)),b.toString=function(){return t+""},b}return{format:h,formatPrefix:function(t,e){var r=h(((t=$d(t)).type="f",t)),i=3*Math.max(-8,Math.min(8,Math.floor(Wd(e)/3))),n=Math.pow(10,-i),o=mf[8+i/3];return function(t){return r(n*t)+o}}}}Af=gf({thousands:",",grouping:[3],currency:["$",""]}),pf=Af.format,df=Af.formatPrefix;var _f=Zl.left,yf=Ee("reduce");kt({target:"Array",proto:!0,forced:!yf||!Dn&&re>79&&re<83},{reduce:function(t){return _f(this,t,arguments.length,arguments.length>1?arguments[1]:void 0)}});var vf=Math.log,xf=Math.log1p||function(t){return(t=+t)>-1e-8&&t<1e-8?t-t*t/2:vf(1+t)};function wf(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}function bf(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return Bf(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Bf(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var i=0,n=function(){};return{s:n,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function Bf(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}kt({target:"Math",stat:!0},{log1p:xf});var Cf=Symbol("implicit");function Ef(){var t=new nA,e=[],r=[],i=Cf;function n(n){var o=t.get(n);if(void 0===o){if(i!==Cf)return i;t.set(n,o=e.push(n)-1)}return r[o%r.length]}return n.domain=function(r){if(!arguments.length)return e.slice();e=[],t=new nA;var i,o=bf(r);try{for(o.s();!(i=o.n()).done;){var a=i.value;t.has(a)||t.set(a,e.push(a)-1)}}catch(t){o.e(t)}finally{o.f()}return n},n.range=function(t){return arguments.length?(r=Array.from(t),n):r.slice()},n.unknown=function(t){return arguments.length?(i=t,n):i},n.copy=function(){return Ef(e,r).unknown(i)},wf.apply(n,arguments),n}function Tf(){var t,e,r=Ef().unknown(void 0),i=r.domain,n=r.range,o=0,a=1,s=!1,l=0,c=0,u=.5;function h(){var r=i().length,h=a<o,A=h?a:o,p=h?o:a;t=(p-A)/Math.max(1,r-l+2*c),s&&(t=Math.floor(t)),A+=(p-A-t*(r-l))*u,e=t*(1-l),s&&(A=Math.round(A),e=Math.round(e));var d=function(t,e,r){t=+t,e=+e,r=(n=arguments.length)<2?(e=t,t=0,1):n<3?1:+r;for(var i=-1,n=0|Math.max(0,Math.ceil((e-t)/r)),o=new Array(n);++i<n;)o[i]=t+i*r;return o}(r).map((function(e){return A+t*e}));return n(h?d.reverse():d)}return delete r.unknown,r.domain=function(t){return arguments.length?(i(t),h()):i()},r.range=function(t){var e;return arguments.length?(e=tA(t,2),o=e[0],a=e[1],o=+o,a=+a,h()):[o,a]},r.rangeRound=function(t){var e;return e=tA(t,2),o=e[0],a=e[1],o=+o,a=+a,s=!0,h()},r.bandwidth=function(){return e},r.step=function(){return t},r.round=function(t){return arguments.length?(s=!!t,h()):s},r.padding=function(t){return arguments.length?(l=Math.min(1,c=+t),h()):l},r.paddingInner=function(t){return arguments.length?(l=Math.min(1,t),h()):l},r.paddingOuter=function(t){return arguments.length?(c=+t,h()):c},r.align=function(t){return arguments.length?(u=Math.max(0,Math.min(1,t)),h()):u},r.copy=function(){return Tf(i(),[o,a]).round(s).paddingInner(l).paddingOuter(c).align(u)},wf.apply(h(),arguments)}function If(t){return+t}var Sf=[0,1];function Mf(t){return t}function Ff(t,e){return(e-=t=+t)?function(r){return(r-t)/e}:function(t){return function(){return t}}(isNaN(e)?NaN:.5)}function Pf(t,e,r){var i=t[0],n=t[1],o=e[0],a=e[1];return n<i?(i=Ff(n,i),o=r(a,o)):(i=Ff(i,n),o=r(o,a)),function(t){return o(i(t))}}function Lf(t,e,r){var i=Math.min(t.length,e.length)-1,n=new Array(i),o=new Array(i),a=-1;for(t[i]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++a<i;)n[a]=Ff(t[a],t[a+1]),o[a]=r(e[a],e[a+1]);return function(e){var r=Zh(t,e,1,i)-1;return o[r](n[r](e))}}function Df(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Uf(){var t,e,r,i,n,o,a=Sf,s=Sf,l=vp,c=Mf;function u(){var t=Math.min(a.length,s.length);return c!==Mf&&(c=function(t,e){var r;return t>e&&(r=t,t=e,e=r),function(r){return Math.max(t,Math.min(e,r))}}(a[0],a[t-1])),i=t>2?Lf:Pf,n=o=null,h}function h(e){return null==e||isNaN(e=+e)?r:(n||(n=i(a.map(t),s,l)))(t(c(e)))}return h.invert=function(r){return c(e((o||(o=i(s,a.map(t),fp)))(r)))},h.domain=function(t){return arguments.length?(a=Array.from(t,If),u()):a.slice()},h.range=function(t){return arguments.length?(s=Array.from(t),u()):s.slice()},h.rangeRound=function(t){return s=Array.from(t),l=xp,u()},h.clamp=function(t){return arguments.length?(c=!!t||Mf,u()):c!==Mf},h.interpolate=function(t){return arguments.length?(l=t,u()):l},h.unknown=function(t){return arguments.length?(r=t,h):r},function(r,i){return t=r,e=i,u()}}function kf(){return Uf()(Mf,Mf)}function zf(t,e,r,i){var n,o=_A(t,e,r);switch((i=$d(null==i?",f":i)).type){case"s":var a=Math.max(Math.abs(t),Math.abs(e));return null!=i.precision||isNaN(n=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Wd(e)/3)))-Wd(Math.abs(t)))}(o,a))||(i.precision=n),df(i,a);case"":case"e":case"g":case"p":case"r":null!=i.precision||isNaN(n=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Wd(e)-Wd(t))+1}(o,Math.max(Math.abs(t),Math.abs(e))))||(i.precision=n-("e"===i.type));break;case"f":case"%":null!=i.precision||isNaN(n=function(t){return Math.max(0,-Wd(Math.abs(t)))}(o))||(i.precision=n-2*("%"===i.type))}return pf(i)}function Rf(t){var e=t.domain;return t.ticks=function(t){var r=e();return function(t,e,r){if(!((r=+r)>0))return[];if((t=+t)==(e=+e))return[t];var i=e<t,n=tA(i?mA(e,t,r):mA(t,e,r),3),o=n[0],a=n[1],s=n[2];if(!(a>=o))return[];var l=a-o+1,c=new Array(l);if(i)if(s<0)for(var u=0;u<l;++u)c[u]=(a-u)/-s;else for(var h=0;h<l;++h)c[h]=(a-h)*s;else if(s<0)for(var A=0;A<l;++A)c[A]=(o+A)/-s;else for(var p=0;p<l;++p)c[p]=(o+p)*s;return c}(r[0],r[r.length-1],null==t?10:t)},t.tickFormat=function(t,r){var i=e();return zf(i[0],i[i.length-1],null==t?10:t,r)},t.nice=function(r){null==r&&(r=10);var i,n,o=e(),a=0,s=o.length-1,l=o[a],c=o[s],u=10;for(c<l&&(n=l,l=c,c=n,n=a,a=s,s=n);u-- >0;){if((n=gA(l,c,r))===i)return o[a]=l,o[s]=c,e(o);if(n>0)l=Math.floor(l/n)*n,c=Math.ceil(c/n)*n;else{if(!(n<0))break;l=Math.ceil(l*n)/n,c=Math.floor(c*n)/n}i=n}return t},t}function Of(){var t=kf();return t.copy=function(){return Df(t,Of())},wf.apply(t,arguments),Rf(t)}var Qf=Math.expm1,Nf=Math.exp,Vf=!Qf||Qf(10)>22025.465794806718||Qf(10)<22025.465794806718||-2e-17!=Qf(-2e-17)?function(t){return 0==(t=+t)?t:t>-1e-6&&t<1e-6?t+t*t/2:Nf(t)-1}:Qf;kt({target:"Math",stat:!0,forced:Vf!=Math.expm1},{expm1:Vf});var Hf=new Date,jf=new Date;function Gf(t,e,r,i){function n(e){return t(e=0===arguments.length?new Date:new Date(+e)),e}return n.floor=function(e){return t(e=new Date(+e)),e},n.ceil=function(r){return t(r=new Date(r-1)),e(r,1),t(r),r},n.round=function(t){var e=n(t),r=n.ceil(t);return t-e<r-t?e:r},n.offset=function(t,r){return e(t=new Date(+t),null==r?1:Math.floor(r)),t},n.range=function(r,i,o){var a,s=[];if(r=n.ceil(r),o=null==o?1:Math.floor(o),!(r<i&&o>0))return s;do{s.push(a=new Date(+r)),e(r,o),t(r)}while(a<r&&r<i);return s},n.filter=function(r){return Gf((function(e){if(e>=e)for(;t(e),!r(e);)e.setTime(e-1)}),(function(t,i){if(t>=t)if(i<0)for(;++i<=0;)for(;e(t,-1),!r(t););else for(;--i>=0;)for(;e(t,1),!r(t););}))},r&&(n.count=function(e,i){return Hf.setTime(+e),jf.setTime(+i),t(Hf),t(jf),Math.floor(r(Hf,jf))},n.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?n.filter(i?function(e){return i(e)%t==0}:function(e){return n.count(0,e)%t==0}):n:null}),n}var Kf=Gf((function(){}),(function(t,e){t.setTime(+t+e)}),(function(t,e){return e-t}));Kf.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?Gf((function(e){e.setTime(Math.floor(e/t)*t)}),(function(e,r){e.setTime(+e+r*t)}),(function(e,r){return(r-e)/t})):Kf:null};var qf=1e3,Zf=6e4,Wf=36e5,Xf=864e5,$f=6048e5,Yf=2592e6,Jf=31536e6,tm=Gf((function(t){t.setTime(t-t.getMilliseconds())}),(function(t,e){t.setTime(+t+e*qf)}),(function(t,e){return(e-t)/qf}),(function(t){return t.getUTCSeconds()})),em=Gf((function(t){t.setTime(t-t.getMilliseconds()-t.getSeconds()*qf)}),(function(t,e){t.setTime(+t+e*Zf)}),(function(t,e){return(e-t)/Zf}),(function(t){return t.getMinutes()})),rm=Gf((function(t){t.setUTCSeconds(0,0)}),(function(t,e){t.setTime(+t+e*Zf)}),(function(t,e){return(e-t)/Zf}),(function(t){return t.getUTCMinutes()})),im=Gf((function(t){t.setTime(t-t.getMilliseconds()-t.getSeconds()*qf-t.getMinutes()*Zf)}),(function(t,e){t.setTime(+t+e*Wf)}),(function(t,e){return(e-t)/Wf}),(function(t){return t.getHours()})),nm=Gf((function(t){t.setUTCMinutes(0,0,0)}),(function(t,e){t.setTime(+t+e*Wf)}),(function(t,e){return(e-t)/Wf}),(function(t){return t.getUTCHours()})),om=Gf((function(t){return t.setHours(0,0,0,0)}),(function(t,e){return t.setDate(t.getDate()+e)}),(function(t,e){return(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*Zf)/Xf}),(function(t){return t.getDate()-1})),am=Gf((function(t){t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+e)}),(function(t,e){return(e-t)/Xf}),(function(t){return t.getUTCDate()-1})),sm=Gf((function(t){t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+e)}),(function(t,e){return(e-t)/Xf}),(function(t){return Math.floor(t/Xf)}));function lm(t){return Gf((function(e){e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)}),(function(t,e){t.setDate(t.getDate()+7*e)}),(function(t,e){return(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*Zf)/$f}))}var cm=lm(0),um=lm(1),hm=(lm(2),lm(3),lm(4));lm(5),lm(6);function Am(t){return Gf((function(e){e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+7*e)}),(function(t,e){return(e-t)/$f}))}var pm=Am(0),dm=Am(1),fm=(Am(2),Am(3),Am(4)),mm=(Am(5),Am(6),Gf((function(t){t.setDate(1),t.setHours(0,0,0,0)}),(function(t,e){t.setMonth(t.getMonth()+e)}),(function(t,e){return e.getMonth()-t.getMonth()+12*(e.getFullYear()-t.getFullYear())}),(function(t){return t.getMonth()}))),gm=Gf((function(t){t.setUTCDate(1),t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCMonth(t.getUTCMonth()+e)}),(function(t,e){return e.getUTCMonth()-t.getUTCMonth()+12*(e.getUTCFullYear()-t.getUTCFullYear())}),(function(t){return t.getUTCMonth()})),_m=Gf((function(t){t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,e){t.setFullYear(t.getFullYear()+e)}),(function(t,e){return e.getFullYear()-t.getFullYear()}),(function(t){return t.getFullYear()}));_m.every=function(t){return isFinite(t=Math.floor(t))&&t>0?Gf((function(e){e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,r){e.setFullYear(e.getFullYear()+r*t)})):null};var ym=Gf((function(t){t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCFullYear(t.getUTCFullYear()+e)}),(function(t,e){return e.getUTCFullYear()-t.getUTCFullYear()}),(function(t){return t.getUTCFullYear()}));function vm(t,e,r,i,n,o){var a=[[tm,1,qf],[tm,5,5e3],[tm,15,15e3],[tm,30,3e4],[o,1,Zf],[o,5,3e5],[o,15,9e5],[o,30,18e5],[n,1,Wf],[n,3,108e5],[n,6,216e5],[n,12,432e5],[i,1,Xf],[i,2,1728e5],[r,1,$f],[e,1,Yf],[e,3,7776e6],[t,1,Jf]];function s(e,r,i){var n=Math.abs(r-e)/i,o=Kh((function(t){return tA(t,3)[2]})).right(a,n);if(o===a.length)return t.every(_A(e/Jf,r/Jf,i));if(0===o)return Kf.every(Math.max(_A(e,r,i),1));var s=tA(a[n/a[o-1][2]<a[o][2]/n?o-1:o],2),l=s[0],c=s[1];return l.every(c)}return[function(t,e,r){var i=e<t;if(i){var n=[e,t];t=n[0],e=n[1]}var o=r&&"function"==typeof r.range?r:s(t,e,r),a=o?o.range(t,+e+1):[];return i?a.reverse():a},s]}ym.every=function(t){return isFinite(t=Math.floor(t))&&t>0?Gf((function(e){e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,r){e.setUTCFullYear(e.getUTCFullYear()+r*t)})):null};var xm=tA(vm(ym,gm,pm,sm,nm,rm),2),wm=xm[0],bm=xm[1],Bm=tA(vm(_m,mm,cm,om,im,em),2),Cm=Bm[0],Em=Bm[1];function Tm(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function Im(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function Sm(t,e,r){return{y:t,m:e,d:r,H:0,M:0,S:0,L:0}}var Mm,Fm,Pm,Lm,Dm={"-":"",_:" ",0:"0"},Um=/^\s*\d+/,km=/^%/,zm=/[\\^$*+?|[\]().{}]/g;function Rm(t,e,r){var i=t<0?"-":"",n=(i?-t:t)+"",o=n.length;return i+(o<r?new Array(r-o+1).join(e)+n:n)}function Om(t){return t.replace(zm,"\\$&")}function Qm(t){return new RegExp("^(?:"+t.map(Om).join("|")+")","i")}function Nm(t){return new Map(t.map((function(t,e){return[t.toLowerCase(),e]})))}function Vm(t,e,r){var i=Um.exec(e.slice(r,r+1));return i?(t.w=+i[0],r+i[0].length):-1}function Hm(t,e,r){var i=Um.exec(e.slice(r,r+1));return i?(t.u=+i[0],r+i[0].length):-1}function jm(t,e,r){var i=Um.exec(e.slice(r,r+2));return i?(t.U=+i[0],r+i[0].length):-1}function Gm(t,e,r){var i=Um.exec(e.slice(r,r+2));return i?(t.V=+i[0],r+i[0].length):-1}function Km(t,e,r){var i=Um.exec(e.slice(r,r+2));return i?(t.W=+i[0],r+i[0].length):-1}function qm(t,e,r){var i=Um.exec(e.slice(r,r+4));return i?(t.y=+i[0],r+i[0].length):-1}function Zm(t,e,r){var i=Um.exec(e.slice(r,r+2));return i?(t.y=+i[0]+(+i[0]>68?1900:2e3),r+i[0].length):-1}function Wm(t,e,r){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(r,r+6));return i?(t.Z=i[1]?0:-(i[2]+(i[3]||"00")),r+i[0].length):-1}function Xm(t,e,r){var i=Um.exec(e.slice(r,r+1));return i?(t.q=3*i[0]-3,r+i[0].length):-1}function $m(t,e,r){var i=Um.exec(e.slice(r,r+2));return i?(t.m=i[0]-1,r+i[0].length):-1}function Ym(t,e,r){var i=Um.exec(e.slice(r,r+2));return i?(t.d=+i[0],r+i[0].length):-1}function Jm(t,e,r){var i=Um.exec(e.slice(r,r+3));return i?(t.m=0,t.d=+i[0],r+i[0].length):-1}function tg(t,e,r){var i=Um.exec(e.slice(r,r+2));return i?(t.H=+i[0],r+i[0].length):-1}function eg(t,e,r){var i=Um.exec(e.slice(r,r+2));return i?(t.M=+i[0],r+i[0].length):-1}function rg(t,e,r){var i=Um.exec(e.slice(r,r+2));return i?(t.S=+i[0],r+i[0].length):-1}function ig(t,e,r){var i=Um.exec(e.slice(r,r+3));return i?(t.L=+i[0],r+i[0].length):-1}function ng(t,e,r){var i=Um.exec(e.slice(r,r+6));return i?(t.L=Math.floor(i[0]/1e3),r+i[0].length):-1}function og(t,e,r){var i=km.exec(e.slice(r,r+1));return i?r+i[0].length:-1}function ag(t,e,r){var i=Um.exec(e.slice(r));return i?(t.Q=+i[0],r+i[0].length):-1}function sg(t,e,r){var i=Um.exec(e.slice(r));return i?(t.s=+i[0],r+i[0].length):-1}function lg(t,e){return Rm(t.getDate(),e,2)}function cg(t,e){return Rm(t.getHours(),e,2)}function ug(t,e){return Rm(t.getHours()%12||12,e,2)}function hg(t,e){return Rm(1+om.count(_m(t),t),e,3)}function Ag(t,e){return Rm(t.getMilliseconds(),e,3)}function pg(t,e){return Ag(t,e)+"000"}function dg(t,e){return Rm(t.getMonth()+1,e,2)}function fg(t,e){return Rm(t.getMinutes(),e,2)}function mg(t,e){return Rm(t.getSeconds(),e,2)}function gg(t){var e=t.getDay();return 0===e?7:e}function _g(t,e){return Rm(cm.count(_m(t)-1,t),e,2)}function yg(t){var e=t.getDay();return e>=4||0===e?hm(t):hm.ceil(t)}function vg(t,e){return t=yg(t),Rm(hm.count(_m(t),t)+(4===_m(t).getDay()),e,2)}function xg(t){return t.getDay()}function wg(t,e){return Rm(um.count(_m(t)-1,t),e,2)}function bg(t,e){return Rm(t.getFullYear()%100,e,2)}function Bg(t,e){return Rm((t=yg(t)).getFullYear()%100,e,2)}function Cg(t,e){return Rm(t.getFullYear()%1e4,e,4)}function Eg(t,e){var r=t.getDay();return Rm((t=r>=4||0===r?hm(t):hm.ceil(t)).getFullYear()%1e4,e,4)}function Tg(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+Rm(e/60|0,"0",2)+Rm(e%60,"0",2)}function Ig(t,e){return Rm(t.getUTCDate(),e,2)}function Sg(t,e){return Rm(t.getUTCHours(),e,2)}function Mg(t,e){return Rm(t.getUTCHours()%12||12,e,2)}function Fg(t,e){return Rm(1+am.count(ym(t),t),e,3)}function Pg(t,e){return Rm(t.getUTCMilliseconds(),e,3)}function Lg(t,e){return Pg(t,e)+"000"}function Dg(t,e){return Rm(t.getUTCMonth()+1,e,2)}function Ug(t,e){return Rm(t.getUTCMinutes(),e,2)}function kg(t,e){return Rm(t.getUTCSeconds(),e,2)}function zg(t){var e=t.getUTCDay();return 0===e?7:e}function Rg(t,e){return Rm(pm.count(ym(t)-1,t),e,2)}function Og(t){var e=t.getUTCDay();return e>=4||0===e?fm(t):fm.ceil(t)}function Qg(t,e){return t=Og(t),Rm(fm.count(ym(t),t)+(4===ym(t).getUTCDay()),e,2)}function Ng(t){return t.getUTCDay()}function Vg(t,e){return Rm(dm.count(ym(t)-1,t),e,2)}function Hg(t,e){return Rm(t.getUTCFullYear()%100,e,2)}function jg(t,e){return Rm((t=Og(t)).getUTCFullYear()%100,e,2)}function Gg(t,e){return Rm(t.getUTCFullYear()%1e4,e,4)}function Kg(t,e){var r=t.getUTCDay();return Rm((t=r>=4||0===r?fm(t):fm.ceil(t)).getUTCFullYear()%1e4,e,4)}function qg(){return"+0000"}function Zg(){return"%"}function Wg(t){return+t}function Xg(t){return Math.floor(+t/1e3)}function $g(t){return new Date(t)}function Yg(t){return t instanceof Date?+t:+new Date(+t)}function Jg(t,e,r,i,n,o,a,s,l,c){var u=kf(),h=u.invert,A=u.domain,p=c(".%L"),d=c(":%S"),f=c("%I:%M"),m=c("%I %p"),g=c("%a %d"),_=c("%b %d"),y=c("%B"),v=c("%Y");function x(t){return(l(t)<t?p:s(t)<t?d:a(t)<t?f:o(t)<t?m:i(t)<t?n(t)<t?g:_:r(t)<t?y:v)(t)}return u.invert=function(t){return new Date(h(t))},u.domain=function(t){return arguments.length?A(Array.from(t,Yg)):A().map($g)},u.ticks=function(e){var r=A();return t(r[0],r[r.length-1],null==e?10:e)},u.tickFormat=function(t,e){return null==e?x:c(e)},u.nice=function(t){var r=A();return t&&"function"==typeof t.range||(t=e(r[0],r[r.length-1],null==t?10:t)),t?A(function(t,e){var r,i=0,n=(t=t.slice()).length-1,o=t[i],a=t[n];return a<o&&(r=i,i=n,n=r,r=o,o=a,a=r),t[i]=e.floor(o),t[n]=e.ceil(a),t}(r,t)):u},u.copy=function(){return Df(u,Jg(t,e,r,i,n,o,a,s,l,c))},u}function t_(){return wf.apply(Jg(Cm,Em,_m,mm,cm,om,im,em,tm,Fm).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function e_(t){return function(){return t}}!function(t){Mm=function(t){var e=t.dateTime,r=t.date,i=t.time,n=t.periods,o=t.days,a=t.shortDays,s=t.months,l=t.shortMonths,c=Qm(n),u=Nm(n),h=Qm(o),A=Nm(o),p=Qm(a),d=Nm(a),f=Qm(s),m=Nm(s),g=Qm(l),_=Nm(l),y={a:function(t){return a[t.getDay()]},A:function(t){return o[t.getDay()]},b:function(t){return l[t.getMonth()]},B:function(t){return s[t.getMonth()]},c:null,d:lg,e:lg,f:pg,g:Bg,G:Eg,H:cg,I:ug,j:hg,L:Ag,m:dg,M:fg,p:function(t){return n[+(t.getHours()>=12)]},q:function(t){return 1+~~(t.getMonth()/3)},Q:Wg,s:Xg,S:mg,u:gg,U:_g,V:vg,w:xg,W:wg,x:null,X:null,y:bg,Y:Cg,Z:Tg,"%":Zg},v={a:function(t){return a[t.getUTCDay()]},A:function(t){return o[t.getUTCDay()]},b:function(t){return l[t.getUTCMonth()]},B:function(t){return s[t.getUTCMonth()]},c:null,d:Ig,e:Ig,f:Lg,g:jg,G:Kg,H:Sg,I:Mg,j:Fg,L:Pg,m:Dg,M:Ug,p:function(t){return n[+(t.getUTCHours()>=12)]},q:function(t){return 1+~~(t.getUTCMonth()/3)},Q:Wg,s:Xg,S:kg,u:zg,U:Rg,V:Qg,w:Ng,W:Vg,x:null,X:null,y:Hg,Y:Gg,Z:qg,"%":Zg},x={a:function(t,e,r){var i=p.exec(e.slice(r));return i?(t.w=d.get(i[0].toLowerCase()),r+i[0].length):-1},A:function(t,e,r){var i=h.exec(e.slice(r));return i?(t.w=A.get(i[0].toLowerCase()),r+i[0].length):-1},b:function(t,e,r){var i=g.exec(e.slice(r));return i?(t.m=_.get(i[0].toLowerCase()),r+i[0].length):-1},B:function(t,e,r){var i=f.exec(e.slice(r));return i?(t.m=m.get(i[0].toLowerCase()),r+i[0].length):-1},c:function(t,r,i){return B(t,e,r,i)},d:Ym,e:Ym,f:ng,g:Zm,G:qm,H:tg,I:tg,j:Jm,L:ig,m:$m,M:eg,p:function(t,e,r){var i=c.exec(e.slice(r));return i?(t.p=u.get(i[0].toLowerCase()),r+i[0].length):-1},q:Xm,Q:ag,s:sg,S:rg,u:Hm,U:jm,V:Gm,w:Vm,W:Km,x:function(t,e,i){return B(t,r,e,i)},X:function(t,e,r){return B(t,i,e,r)},y:Zm,Y:qm,Z:Wm,"%":og};function w(t,e){return function(r){var i,n,o,a=[],s=-1,l=0,c=t.length;for(r instanceof Date||(r=new Date(+r));++s<c;)37===t.charCodeAt(s)&&(a.push(t.slice(l,s)),null!=(n=Dm[i=t.charAt(++s)])?i=t.charAt(++s):n="e"===i?" ":"0",(o=e[i])&&(i=o(r,n)),a.push(i),l=s+1);return a.push(t.slice(l,s)),a.join("")}}function b(t,e){return function(r){var i,n,o=Sm(1900,void 0,1);if(B(o,t,r+="",0)!=r.length)return null;if("Q"in o)return new Date(o.Q);if("s"in o)return new Date(1e3*o.s+("L"in o?o.L:0));if(e&&!("Z"in o)&&(o.Z=0),"p"in o&&(o.H=o.H%12+12*o.p),void 0===o.m&&(o.m="q"in o?o.q:0),"V"in o){if(o.V<1||o.V>53)return null;"w"in o||(o.w=1),"Z"in o?(n=(i=Im(Sm(o.y,0,1))).getUTCDay(),i=n>4||0===n?dm.ceil(i):dm(i),i=am.offset(i,7*(o.V-1)),o.y=i.getUTCFullYear(),o.m=i.getUTCMonth(),o.d=i.getUTCDate()+(o.w+6)%7):(n=(i=Tm(Sm(o.y,0,1))).getDay(),i=n>4||0===n?um.ceil(i):um(i),i=om.offset(i,7*(o.V-1)),o.y=i.getFullYear(),o.m=i.getMonth(),o.d=i.getDate()+(o.w+6)%7)}else("W"in o||"U"in o)&&("w"in o||(o.w="u"in o?o.u%7:"W"in o?1:0),n="Z"in o?Im(Sm(o.y,0,1)).getUTCDay():Tm(Sm(o.y,0,1)).getDay(),o.m=0,o.d="W"in o?(o.w+6)%7+7*o.W-(n+5)%7:o.w+7*o.U-(n+6)%7);return"Z"in o?(o.H+=o.Z/100|0,o.M+=o.Z%100,Im(o)):Tm(o)}}function B(t,e,r,i){for(var n,o,a=0,s=e.length,l=r.length;a<s;){if(i>=l)return-1;if(37===(n=e.charCodeAt(a++))){if(n=e.charAt(a++),!(o=x[n in Dm?e.charAt(a++):n])||(i=o(t,r,i))<0)return-1}else if(n!=r.charCodeAt(i++))return-1}return i}return y.x=w(r,y),y.X=w(i,y),y.c=w(e,y),v.x=w(r,v),v.X=w(i,v),v.c=w(e,v),{format:function(t){var e=w(t+="",y);return e.toString=function(){return t},e},parse:function(t){var e=b(t+="",!1);return e.toString=function(){return t},e},utcFormat:function(t){var e=w(t+="",v);return e.toString=function(){return t},e},utcParse:function(t){var e=b(t+="",!0);return e.toString=function(){return t},e}}}(t),Fm=Mm.format,Pm=Mm.parse,Lm=Mm.utcFormat,Mm.utcParse}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var r_=Math.abs,i_=Math.atan2,n_=Math.cos,o_=Math.max,a_=Math.min,s_=Math.sin,l_=Math.sqrt,c_=1e-12,u_=Math.PI,h_=u_/2,A_=2*u_;function p_(t){return t>=1?h_:t<=-1?-h_:Math.asin(t)}function d_(t){return t.innerRadius}function f_(t){return t.outerRadius}function m_(t){return t.startAngle}function g_(t){return t.endAngle}function __(t){return t&&t.padAngle}function y_(t,e,r,i,n,o,a){var s=t-r,l=e-i,c=(a?o:-o)/l_(s*s+l*l),u=c*l,h=-c*s,A=t+u,p=e+h,d=r+u,f=i+h,m=(A+d)/2,g=(p+f)/2,_=d-A,y=f-p,v=_*_+y*y,x=n-o,w=A*f-d*p,b=(y<0?-1:1)*l_(o_(0,x*x*v-w*w)),B=(w*y-_*b)/v,C=(-w*_-y*b)/v,E=(w*y+_*b)/v,T=(-w*_+y*b)/v,I=B-m,S=C-g,M=E-m,F=T-g;return I*I+S*S>M*M+F*F&&(B=E,C=T),{cx:B,cy:C,x01:-u,y01:-h,x11:B*(n/x-1),y11:C*(n/x-1)}}function v_(){var t,e,r=d_,i=f_,n=e_(0),o=null,a=m_,s=g_,l=__,c=null,u=(e=3,(t=h).digits=function(r){if(!arguments.length)return e;if(null==r)e=null;else{var i=Math.floor(r);if(!(i>=0))throw new RangeError("invalid digits: ".concat(r));e=i}return t},function(){return new cd(e)});function h(){var t,e,h=+r.apply(this,arguments),A=+i.apply(this,arguments),p=a.apply(this,arguments)-h_,d=s.apply(this,arguments)-h_,f=r_(d-p),m=d>p;if(c||(c=t=u()),A<h&&(e=A,A=h,h=e),A>c_)if(f>A_-c_)c.moveTo(A*n_(p),A*s_(p)),c.arc(0,0,A,p,d,!m),h>c_&&(c.moveTo(h*n_(d),h*s_(d)),c.arc(0,0,h,d,p,m));else{var g,_,y=p,v=d,x=p,w=d,b=f,B=f,C=l.apply(this,arguments)/2,E=C>c_&&(o?+o.apply(this,arguments):l_(h*h+A*A)),T=a_(r_(A-h)/2,+n.apply(this,arguments)),I=T,S=T;if(E>c_){var M=p_(E/h*s_(C)),F=p_(E/A*s_(C));(b-=2*M)>c_?(x+=M*=m?1:-1,w-=M):(b=0,x=w=(p+d)/2),(B-=2*F)>c_?(y+=F*=m?1:-1,v-=F):(B=0,y=v=(p+d)/2)}var P=A*n_(y),L=A*s_(y),D=h*n_(w),U=h*s_(w);if(T>c_){var k,z=A*n_(v),R=A*s_(v),O=h*n_(x),Q=h*s_(x);if(f<u_)if(k=function(t,e,r,i,n,o,a,s){var l=r-t,c=i-e,u=a-n,h=s-o,A=h*l-u*c;if(!(A*A<c_))return[t+(A=(u*(e-o)-h*(t-n))/A)*l,e+A*c]}(P,L,O,Q,z,R,D,U)){var N=P-k[0],V=L-k[1],H=z-k[0],j=R-k[1],G=1/s_(function(t){return t>1?0:t<-1?u_:Math.acos(t)}((N*H+V*j)/(l_(N*N+V*V)*l_(H*H+j*j)))/2),K=l_(k[0]*k[0]+k[1]*k[1]);I=a_(T,(h-K)/(G-1)),S=a_(T,(A-K)/(G+1))}else I=S=0}B>c_?S>c_?(g=y_(O,Q,P,L,A,S,m),_=y_(z,R,D,U,A,S,m),c.moveTo(g.cx+g.x01,g.cy+g.y01),S<T?c.arc(g.cx,g.cy,S,i_(g.y01,g.x01),i_(_.y01,_.x01),!m):(c.arc(g.cx,g.cy,S,i_(g.y01,g.x01),i_(g.y11,g.x11),!m),c.arc(0,0,A,i_(g.cy+g.y11,g.cx+g.x11),i_(_.cy+_.y11,_.cx+_.x11),!m),c.arc(_.cx,_.cy,S,i_(_.y11,_.x11),i_(_.y01,_.x01),!m))):(c.moveTo(P,L),c.arc(0,0,A,y,v,!m)):c.moveTo(P,L),h>c_&&b>c_?I>c_?(g=y_(D,U,z,R,h,-I,m),_=y_(P,L,O,Q,h,-I,m),c.lineTo(g.cx+g.x01,g.cy+g.y01),I<T?c.arc(g.cx,g.cy,I,i_(g.y01,g.x01),i_(_.y01,_.x01),!m):(c.arc(g.cx,g.cy,I,i_(g.y01,g.x01),i_(g.y11,g.x11),!m),c.arc(0,0,h,i_(g.cy+g.y11,g.cx+g.x11),i_(_.cy+_.y11,_.cx+_.x11),m),c.arc(_.cx,_.cy,I,i_(_.y11,_.x11),i_(_.y01,_.x01),!m))):c.arc(0,0,h,w,x,m):c.lineTo(D,U)}else c.moveTo(0,0);if(c.closePath(),t)return c=null,t+""||null}return h.centroid=function(){var t=(+r.apply(this,arguments)+ +i.apply(this,arguments))/2,e=(+a.apply(this,arguments)+ +s.apply(this,arguments))/2-u_/2;return[n_(e)*t,s_(e)*t]},h.innerRadius=function(t){return arguments.length?(r="function"==typeof t?t:e_(+t),h):r},h.outerRadius=function(t){return arguments.length?(i="function"==typeof t?t:e_(+t),h):i},h.cornerRadius=function(t){return arguments.length?(n="function"==typeof t?t:e_(+t),h):n},h.padRadius=function(t){return arguments.length?(o=null==t?null:"function"==typeof t?t:e_(+t),h):o},h.startAngle=function(t){return arguments.length?(a="function"==typeof t?t:e_(+t),h):a},h.endAngle=function(t){return arguments.length?(s="function"==typeof t?t:e_(+t),h):s},h.padAngle=function(t){return arguments.length?(l="function"==typeof t?t:e_(+t),h):l},h.context=function(t){return arguments.length?(c=null==t?null:t,h):c},h}function x_(t,e){return e<t?-1:e>t?1:e>=t?0:NaN}function w_(t){return t}function b_(){var t=w_,e=x_,r=null,i=e_(0),n=e_(A_),o=e_(0);function a(a){var s,l,c,u,h,A=(a=function(t){return"object"===Ze(t)&&"length"in t?t:Array.from(t)}(a)).length,p=0,d=new Array(A),f=new Array(A),m=+i.apply(this,arguments),g=Math.min(A_,Math.max(-A_,n.apply(this,arguments)-m)),_=Math.min(Math.abs(g)/A,o.apply(this,arguments)),y=_*(g<0?-1:1);for(s=0;s<A;++s)(h=f[d[s]=s]=+t(a[s],s,a))>0&&(p+=h);for(null!=e?d.sort((function(t,r){return e(f[t],f[r])})):null!=r&&d.sort((function(t,e){return r(a[t],a[e])})),s=0,c=p?(g-A*y)/p:0;s<A;++s,m=u)l=d[s],u=m+((h=f[l])>0?h*c:0)+y,f[l]={data:a[l],index:s,value:h,startAngle:m,endAngle:u,padAngle:_};return f}return a.value=function(e){return arguments.length?(t="function"==typeof e?e:e_(+e),a):t},a.sortValues=function(t){return arguments.length?(e=t,r=null,a):e},a.sort=function(t){return arguments.length?(r=t,e=null,a):r},a.startAngle=function(t){return arguments.length?(i="function"==typeof t?t:e_(+t),a):i},a.endAngle=function(t){return arguments.length?(n="function"==typeof t?t:e_(+t),a):n},a.padAngle=function(t){return arguments.length?(o="function"==typeof t?t:e_(+t),a):o},a}function B_(t){return C_.apply(this,arguments)}function C_(){return C_=ch(sh.mark((function t(e){var r;return sh.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Sd(e);case 2:return r=t.sent,t.abrupt("return",r);case 4:case"end":return t.stop()}}),t)}))),C_.apply(this,arguments)}function E_(){return E_=ch(sh.mark((function t(e){var r,i;return sh.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.map((function(t){return B_(t)})),t.next=3,Promise.all(r);case 3:return i=t.sent,t.abrupt("return",i);case 5:case"end":return t.stop()}}),t)}))),E_.apply(this,arguments)}function T_(){return T_=ch(sh.mark((function t(e){var r,i,n;return sh.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(e);case 2:return r=t.sent,t.next=5,r.text();case 5:return i=t.sent,t.next=8,Rh(i,Oh);case 8:return n=t.sent,t.abrupt("return",n);case 10:case"end":return t.stop()}}),t)}))),T_.apply(this,arguments)}function I_(){return(I_=ch(sh.mark((function t(e,r){var i,n,o;return sh.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(e);case 2:return i=t.sent,t.next=5,i.json();case 5:return n=t.sent,t.next=8,Vh(n,r);case 8:return o=t.sent,t.abrupt("return",o);case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function S_(){return(S_=ch(sh.mark((function t(e){var r,i;return sh.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(e);case 2:return r=t.sent,t.next=5,r.json();case 5:return i=t.sent,t.abrupt("return",i);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var M_={light:{text:"#222",muted:"#777",pale:"#f0f0f0",background:"#fff"},dark:{text:"#fff",muted:"#bbb",pale:"#333",background:"#222"},lightblue:{text:"#206095",muted:"#707070",pale:"#f0f0f0",background:"rgb(188, 207, 222)"}},F_=["rgb(234, 236, 177)","rgb(169, 216, 145)","rgb(0, 167, 186)","rgb(0, 78, 166)","rgb(0, 13, 84)"];function P_(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,i=Xe(t);if(e){var n=Xe(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return We(this,r)}}function L_(t){lu(t,"svelte-rxcmkl","nav.svelte-rxcmkl.svelte-rxcmkl{-webkit-box-sizing:border-box;box-sizing:border-box;position:relative;height:50px;margin-bottom:-49px;z-index:1}picture.svelte-rxcmkl.svelte-rxcmkl{position:relative;top:1px;left:1px}img.svelte-rxcmkl.svelte-rxcmkl{height:49px}a.svelte-rxcmkl img.svelte-rxcmkl:hover{cursor:pointer}")}function D_(t){var e,r,i,n;return{c:function(){e=Au("nav"),r=Au("div"),(i=Au("a")).innerHTML='<picture class="svelte-rxcmkl"><img src="./img/PeaceRep_nobg.png" alt="Office for National Statistics" class="svelte-rxcmkl"/></picture>',_u(i,"href","https://peacerep.org/"),_u(i,"class","svelte-rxcmkl"),xu(r,"width",t[1]+"px"),Bu(r,"center",t[0]),xu(e,"background-color","white"),_u(e,"class","svelte-rxcmkl"),Uu((function(){return t[2].call(e)}))},m:function(o,a){cu(o,e,a),su(e,r),su(r,i),n=bu(e,t[2].bind(e))},p:function(t,e){var i=tA(e,1)[0];2&i&&xu(r,"width",t[1]+"px"),1&i&&Bu(r,"center",t[0])},i:Kc,o:Kc,d:function(t){t&&uu(e),n()}}}function U_(t,e,r){var i,n=e.center,o=void 0===n||n;return t.$$set=function(t){"center"in t&&r(0,o=t.center)},[o,i,function(){i=this.clientWidth,r(1,i)}]}var k_=function(t){qe(r,t);var e=P_(r);function r(t){var i;return je(this,r),Yu(Ge(i=e.call(this)),t,U_,D_,$c,{center:0},L_),i}return r}(Ju);function z_(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,i=Xe(t);if(e){var n=Xe(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return We(this,r)}}function R_(t){lu(t,"svelte-19u0sv3",".short.svelte-19u0sv3{min-height:85vh}.v-padded.svelte-19u0sv3{box-sizing:border-box;padding:40px 0}")}function O_(t){var e,r,i,n,o,a=t[8].default,s=Jc(a,t,t[7],null);return{c:function(){e=Au("header"),r=Au("div"),i=Au("div"),s&&s.c(),Bu(i,"center",t[2]),_u(r,"class","v-padded col-wide middle svelte-19u0sv3"),xu(r,"position","relative"),Bu(r,"short",t[3]),Bu(r,"height-full",!t[3]),_u(e,"style",n="color: "+M_[t[0]].text+"; background-color: "+(t[1]?t[1]:M_[t[0]].background)+"; "+t[4]),_u(e,"class","svelte-19u0sv3"),Bu(e,"short",t[3])},m:function(t,n){cu(t,e,n),su(e,r),su(r,i),s&&s.m(i,null),o=!0},p:function(t,l){var c=tA(l,1)[0];s&&s.p&&(!o||128&c)&&ru(s,a,t,t[7],o?eu(a,t[7],c,null):iu(t[7]),null),(!o||4&c)&&Bu(i,"center",t[2]),(!o||8&c)&&Bu(r,"short",t[3]),(!o||8&c)&&Bu(r,"height-full",!t[3]),(!o||19&c&&n!==(n="color: "+M_[t[0]].text+"; background-color: "+(t[1]?t[1]:M_[t[0]].background)+"; "+t[4]))&&_u(e,"style",n),(!o||8&c)&&Bu(e,"short",t[3])},i:function(t){o||(Gu(s,t),o=!0)},o:function(t){Ku(s,t),o=!1},d:function(t){t&&uu(e),s&&s.d(t)}}}function Q_(t,e,r){var i=e.$$slots,n=void 0===i?{}:i,o=e.$$scope,a=e.theme,s=void 0===a?Iu("theme"):a,l=e.bgimage,c=void 0===l?null:l,u=e.bgcolor,h=void 0===u?null:u,A=e.bgfixed,p=void 0!==A&&A,d=e.center,f=void 0===d||d,m=e.short,g=void 0!==m&&m,_="";return _+=c?"background-image: url(".concat(c,");"):"background-image: none;",p&&(_+=" background-attachment: fixed;"),t.$$set=function(t){"theme"in t&&r(0,s=t.theme),"bgimage"in t&&r(5,c=t.bgimage),"bgcolor"in t&&r(1,h=t.bgcolor),"bgfixed"in t&&r(6,p=t.bgfixed),"center"in t&&r(2,f=t.center),"short"in t&&r(3,g=t.short),"$$scope"in t&&r(7,o=t.$$scope)},[s,h,f,g,_,c,p,o,n]}var N_=function(t){qe(r,t);var e=z_(r);function r(t){var i;return je(this,r),Yu(Ge(i=e.call(this)),t,Q_,O_,$c,{theme:0,bgimage:5,bgcolor:1,bgfixed:6,center:2,short:3},R_),i}return r}(Ju);function V_(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,i=Xe(t);if(e){var n=Xe(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return We(this,r)}}function H_(t){var e,r,i,n=t[2].default,o=Jc(n,t,t[1],null);return{c:function(){e=Au("section"),r=Au("div"),o&&o.c(),_u(r,"class","col-medium"),xu(e,"color",M_[t[0]].text),xu(e,"background-color",M_[t[0]].background)},m:function(t,n){cu(t,e,n),su(e,r),o&&o.m(r,null),i=!0},p:function(t,r){var a=tA(r,1)[0];o&&o.p&&(!i||2&a)&&ru(o,n,t,t[1],i?eu(n,t[1],a,null):iu(t[1]),null),(!i||1&a)&&xu(e,"color",M_[t[0]].text),(!i||1&a)&&xu(e,"background-color",M_[t[0]].background)},i:function(t){i||(Gu(o,t),i=!0)},o:function(t){Ku(o,t),i=!1},d:function(t){t&&uu(e),o&&o.d(t)}}}function j_(t,e,r){var i=e.$$slots,n=void 0===i?{}:i,o=e.$$scope,a=e.theme,s=void 0===a?Iu("theme"):a;return t.$$set=function(t){"theme"in t&&r(0,s=t.theme),"$$scope"in t&&r(1,o=t.$$scope)},[s,o,n]}var G_=function(t){qe(r,t);var e=V_(r);function r(t){var i;return je(this,r),Yu(Ge(i=e.call(this)),t,j_,H_,$c,{theme:0}),i}return r}(Ju);function K_(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,i=Xe(t);if(e){var n=Xe(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return We(this,r)}}kt({target:"Number",stat:!0},{isNaN:function(t){return t!=t}});var q_=au.window;function Z_(t){lu(t,"svelte-3stote","svelte-scroller-outer.svelte-3stote{display:block;position:relative;max-width:100%}svelte-scroller-background.svelte-3stote{display:block;position:relative;width:100%}svelte-scroller-foreground.svelte-3stote{display:block;position:relative;z-index:2}svelte-scroller-foreground.svelte-3stote::after{content:' ';display:block;clear:both}svelte-scroller-background-container.svelte-3stote{display:block;position:absolute;width:100%;max-width:100%;pointer-events:none;will-change:transform}")}var W_=function(t){return{}},X_=function(t){return{}},$_=function(t){return{}},Y_=function(t){return{}};function J_(t){var e,r,i,n,o,a,s,l,c;Uu(t[20]);var u=t[19].background,h=Jc(u,t,t[18],Y_),A=t[19].foreground,p=Jc(A,t,t[18],X_);return{c:function(){e=Au("svelte-scroller-outer"),r=Au("svelte-scroller-background-container"),i=Au("svelte-scroller-background"),h&&h.c(),n=fu(),o=Au("svelte-scroller-foreground"),p&&p.c(),yu(i,"class","svelte-3stote"),yu(r,"class","background-container svelte-3stote"),yu(o,"class","svelte-3stote"),yu(e,"class","svelte-3stote"),Uu((function(){return t[25].call(e)})),Bu(e,"splitscreen",t[0])},m:function(u,A){cu(u,e,A),su(e,r),su(r,i),h&&h.m(i,null),t[21](i),t[22](r),su(e,n),su(e,o),p&&p.m(o,null),t[23](o),t[24](e),a=bu(e,t[25].bind(e)),s=!0,l||(c=gu(q_,"resize",t[20]),l=!0)},p:function(t,r){h&&h.p&&(!s||262144&r[0])&&ru(h,u,t,t[18],s?eu(u,t[18],r,$_):iu(t[18]),Y_),p&&p.p&&(!s||262144&r[0])&&ru(p,A,t,t[18],s?eu(A,t[18],r,W_):iu(t[18]),X_),(!s||1&r[0])&&Bu(e,"splitscreen",t[0])},i:function(t){s||(Gu(h,t),Gu(p,t),s=!0)},o:function(t){Ku(h,t),Ku(p,t),s=!1},d:function(r){r&&uu(e),h&&h.d(r),t[21](null),t[22](null),p&&p.d(r),t[23](null),t[24](null),a(),l=!1,c()}}}var ty,ey=[];if("undefined"!=typeof window){var ry=function(){return ey.forEach((function(t){return t()}))};window.addEventListener("scroll",ry),window.addEventListener("resize",ry)}if("undefined"!=typeof IntersectionObserver){var iy=new Map,ny=new IntersectionObserver((function(t,e){t.forEach((function(t){var e=iy.get(t.target),r=ey.indexOf(e);t.isIntersecting?-1===r&&ey.push(e):(e(),-1!==r&&ey.splice(r,1))}))}),{rootMargin:"400px 0px"});ty={add:function(t){var e=t.outer,r=t.update,i=e.getBoundingClientRect(),n=i.top,o=i.bottom;n<window.innerHeight&&o>0&&ey.push(r),iy.set(e,r),ny.observe(e)},remove:function(t){var e=t.outer,r=t.update,i=ey.indexOf(r);-1!==i&&ey.splice(i,1),iy.delete(e),ny.unobserve(e)}}}else ty={add:function(t){var e=t.update;ey.push(e)},remove:function(t){var e=t.update,r=ey.indexOf(e);-1!==r&&ey.splice(r,1)}};function oy(t,e,r){var i,n,o,a,s,l,c,u,h,A,p=e.$$slots,d=void 0===p?{}:p,f=e.$$scope,m=e.top,g=void 0===m?0:m,_=e.bottom,y=void 0===_?1:_,v=e.threshold,x=void 0===v?.5:v,w=e.query,b=void 0===w?"section":w,B=e.parallax,C=void 0!==B&&B,E=e.index,T=void 0===E?0:E,I=e.count,S=void 0===I?0:I,M=e.offset,F=void 0===M?0:M,P=e.progress,L=void 0===P?0:P,D=e.visible,U=void 0!==D&&D,k=e.splitscreen,z=void 0!==k&&k,R=e.id,O=void 0===R?null:R,Q=0,N=1;function V(){if(s){var t="position: ".concat(h?"fixed":"absolute","; top: 0; transform: translate(0, ").concat(A,"px); width: 100%; z-index: ").concat(1,";");r(3,s.style.cssText=t,s)}}function H(){if(l){var t=a.getBoundingClientRect();t.left,r(6,N=t.right-t.left);var e=l.getBoundingClientRect(),s=c.getBoundingClientRect();r(11,U=e.top<Q&&e.bottom>0);var p=e.bottom-e.top,d=s.bottom-s.top,f=n-i;for(r(10,L=(i-e.top)/(p-f)),L<=0?(A=0,h&&(h=!1,V())):L>=1?(A=C?p-d:p-f,h&&(h=!1,V())):(A=C?Math.round(i-L*(d-f)):i,h||(h=!0,V())),r(7,T=0);T<u.length;r(7,T+=1)){var m=u[T],g=m.getBoundingClientRect().top,_=u[T+1],y=_?_.getBoundingClientRect().top:e.bottom;if(r(9,F=(o-g)/(y-g)),r(12,O=m.dataset.id?m.dataset.id:null),y>=o)break}}}return Tu((function(){u=l.querySelectorAll(b),r(8,S=u.length),H();var t={outer:a,update:H};return ty.add(t),function(){return ty.remove(t)}})),t.$$set=function(t){"top"in t&&r(13,g=t.top),"bottom"in t&&r(14,y=t.bottom),"threshold"in t&&r(15,x=t.threshold),"query"in t&&r(16,b=t.query),"parallax"in t&&r(17,C=t.parallax),"index"in t&&r(7,T=t.index),"count"in t&&r(8,S=t.count),"offset"in t&&r(9,F=t.offset),"progress"in t&&r(10,L=t.progress),"visible"in t&&r(11,U=t.visible),"splitscreen"in t&&r(0,z=t.splitscreen),"id"in t&&r(12,O=t.id),"$$scope"in t&&r(18,f=t.$$scope)},t.$$.update=function(){8194&t.$$.dirty[0]&&(i=Math.round(g*Q)),16386&t.$$.dirty[0]&&(n=Math.round(y*Q)),32770&t.$$.dirty[0]&&(o=Math.round(x*Q)),188416&t.$$.dirty[0]&&H()},[z,Q,a,s,l,c,N,T,S,F,L,U,O,g,y,x,b,C,f,d,function(){r(1,Q=q_.innerHeight)},function(t){Mu[t?"unshift":"push"]((function(){r(5,c=t)}))},function(t){Mu[t?"unshift":"push"]((function(){r(3,s=t)}))},function(t){Mu[t?"unshift":"push"]((function(){r(4,l=t)}))},function(t){Mu[t?"unshift":"push"]((function(){r(2,a=t)}))},function(){N=this.clientWidth,r(6,N)}]}var ay=function(t){qe(r,t);var e=K_(r);function r(t){var i;return je(this,r),Yu(Ge(i=e.call(this)),t,oy,J_,$c,{top:13,bottom:14,threshold:15,query:16,parallax:17,index:7,count:8,offset:9,progress:10,visible:11,splitscreen:0,id:12},Z_,[-1,-1]),i}return r}(Ju);function sy(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,i=Xe(t);if(e){var n=Xe(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return We(this,r)}}function ly(t){lu(t,"svelte-1odf9sx","section.svelte-1odf9sx{padding:36px 0}.short.svelte-1odf9sx{min-height:70vh}")}function cy(t){var e,r,i,n=t[5].default,o=Jc(n,t,t[4],null);return{c:function(){e=Au("section"),r=Au("div"),o&&o.c(),_u(r,"class","middle svelte-1odf9sx"),Bu(r,"center",t[1]),Bu(r,"col-medium",!t[2]),Bu(r,"col-wide",t[2]),Bu(r,"height-full",!t[3]),Bu(r,"short",t[3]),xu(e,"color",M_[t[0]].text),xu(e,"background-color",M_[t[0]].background),_u(e,"class","svelte-1odf9sx")},m:function(t,n){cu(t,e,n),su(e,r),o&&o.m(r,null),i=!0},p:function(t,a){var s=tA(a,1)[0];o&&o.p&&(!i||16&s)&&ru(o,n,t,t[4],i?eu(n,t[4],s,null):iu(t[4]),null),(!i||2&s)&&Bu(r,"center",t[1]),(!i||4&s)&&Bu(r,"col-medium",!t[2]),(!i||4&s)&&Bu(r,"col-wide",t[2]),(!i||8&s)&&Bu(r,"height-full",!t[3]),(!i||8&s)&&Bu(r,"short",t[3]),(!i||1&s)&&xu(e,"color",M_[t[0]].text),(!i||1&s)&&xu(e,"background-color",M_[t[0]].background)},i:function(t){i||(Gu(o,t),i=!0)},o:function(t){Ku(o,t),i=!1},d:function(t){t&&uu(e),o&&o.d(t)}}}function uy(t,e,r){var i=e.$$slots,n=void 0===i?{}:i,o=e.$$scope,a=e.theme,s=void 0===a?Iu("theme"):a,l=e.center,c=void 0===l||l,u=e.wide,h=void 0!==u&&u,A=e.short,p=void 0!==A&&A;return t.$$set=function(t){"theme"in t&&r(0,s=t.theme),"center"in t&&r(1,c=t.center),"wide"in t&&r(2,h=t.wide),"short"in t&&r(3,p=t.short),"$$scope"in t&&r(4,o=t.$$scope)},[s,c,h,p,o,n]}var hy=function(t){qe(r,t);var e=sy(r);function r(t){var i;return je(this,r),Yu(Ge(i=e.call(this)),t,uy,cy,$c,{theme:0,center:1,wide:2,short:3},ly),i}return r}(Ju);function Ay(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,i=Xe(t);if(e){var n=Xe(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return We(this,r)}}function py(t){lu(t,"svelte-1l2to1w","hr.svelte-1l2to1w{width:75px;border:none;border-top:2px solid;margin:40px auto -10px auto}")}function dy(t){var e;return{c:function(){xu(e=Au("hr"),"color",M_[t[0]].muted),xu(e,"border","none"),_u(e,"class","svelte-1l2to1w")},m:function(t,r){cu(t,e,r)},p:function(t,r){1&r&&xu(e,"color",M_[t[0]].muted)},d:function(t){t&&uu(e)}}}function fy(t){var e;return{c:function(){xu(e=Au("hr"),"color",M_[t[0]].muted),_u(e,"class","svelte-1l2to1w")},m:function(t,r){cu(t,e,r)},p:function(t,r){1&r&&xu(e,"color",M_[t[0]].muted)},d:function(t){t&&uu(e)}}}function my(t){var e,r;function i(t,e){return t[1]?fy:dy}var n=i(t),o=n(t);return{c:function(){e=Au("section"),r=Au("div"),o.c(),_u(r,"class","col-medium"),xu(e,"color",M_[t[0]].text),xu(e,"background-color",M_[t[0]].background)},m:function(t,i){cu(t,e,i),su(e,r),o.m(r,null)},p:function(t,a){var s=tA(a,1)[0];n===(n=i(t))&&o?o.p(t,s):(o.d(1),(o=n(t))&&(o.c(),o.m(r,null))),1&s&&xu(e,"color",M_[t[0]].text),1&s&&xu(e,"background-color",M_[t[0]].background)},i:Kc,o:Kc,d:function(t){t&&uu(e),o.d()}}}function gy(t,e,r){var i=e.theme,n=void 0===i?Iu("theme"):i,o=e.hr,a=void 0===o||o;return t.$$set=function(t){"theme"in t&&r(0,n=t.theme),"hr"in t&&r(1,a=t.hr)},[n,a]}var _y=function(t){qe(r,t);var e=Ay(r);function r(t){var i;return je(this,r),Yu(Ge(i=e.call(this)),t,gy,my,$c,{theme:0,hr:1},py),i}return r}(Ju),yy=yt.includes;function vy(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,i=Xe(t);if(e){var n=Xe(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return We(this,r)}}function xy(t){lu(t,"svelte-1prdo3z",".arrow.svelte-1prdo3z{width:48px;height:48px}.left.svelte-1prdo3z{margin-right:10px}.bounce.svelte-1prdo3z{-webkit-animation-duration:2s;animation-duration:2s;-webkit-animation-iteration-count:infinite;animation-iteration-count:infinite;-webkit-animation-name:svelte-1prdo3z-bounce;animation-name:svelte-1prdo3z-bounce;-webkit-animation-timing-function:ease;animation-timing-function:ease}@-webkit-keyframes svelte-1prdo3z-bounce{0%{-webkit-transform:translateY(10px);transform:translateY(10px)}30%{-webkit-transform:translateY(-10px);transform:translateY(-10px)}50%{-webkit-transform:translateY(10px);transform:translateY(10px)}100%{-webkit-transform:translateY(10px);transform:translateY(10px)}}@keyframes svelte-1prdo3z-bounce{0%{-webkit-transform:translateY(10px);transform:translateY(10px)}30%{-webkit-transform:translateY(-10px);transform:translateY(-10px)}50%{-webkit-transform:translateY(10px);transform:translateY(10px)}100%{-webkit-transform:translateY(10px);transform:translateY(10px)}}")}function wy(t){var e,r,i,n=t[4].default,o=Jc(n,t,t[3],null);return{c:function(){e=Au("img"),o&&o.c(),Yc(e.src,r="./img/scroll-down-"+t[0]+".svg")||_u(e,"src",r),_u(e,"class","arrow left svelte-1prdo3z"),_u(e,"alt",""),_u(e,"aria-hidden","true"),Bu(e,"bounce",t[1])},m:function(t,r){cu(t,e,r),o&&o.m(t,r),i=!0},p:function(t,a){(!i||1&a&&!Yc(e.src,r="./img/scroll-down-"+t[0]+".svg"))&&_u(e,"src",r),(!i||2&a)&&Bu(e,"bounce",t[1]),o&&o.p&&(!i||8&a)&&ru(o,n,t,t[3],i?eu(n,t[3],a,null):iu(t[3]),null)},i:function(t){i||(Gu(o,t),i=!0)},o:function(t){Ku(o,t),i=!1},d:function(t){t&&uu(e),o&&o.d(t)}}}function by(t){var e,r,i,n,o,a=t[4].default,s=Jc(a,t,t[3],null);return{c:function(){s&&s.c(),e=Au("br"),r=fu(),Yc((i=Au("img")).src,n="./img/scroll-down-"+t[0]+".svg")||_u(i,"src",n),_u(i,"class","arrow svelte-1prdo3z"),_u(i,"alt",""),_u(i,"aria-hidden","true"),Bu(i,"bounce",t[1])},m:function(t,n){s&&s.m(t,n),cu(t,e,n),cu(t,r,n),cu(t,i,n),o=!0},p:function(t,e){s&&s.p&&(!o||8&e)&&ru(s,a,t,t[3],o?eu(a,t[3],e,null):iu(t[3]),null),(!o||1&e&&!Yc(i.src,n="./img/scroll-down-"+t[0]+".svg"))&&_u(i,"src",n),(!o||2&e)&&Bu(i,"bounce",t[1])},i:function(t){o||(Gu(s,t),o=!0)},o:function(t){Ku(s,t),o=!1},d:function(t){s&&s.d(t),t&&uu(e),t&&uu(r),t&&uu(i)}}}function By(t){var e,r,i,n,o=[by,wy],a=[];function s(t,e){return t[2]?0:1}return e=s(t),r=a[e]=o[e](t),{c:function(){r.c(),i=mu()},m:function(t,r){a[e].m(t,r),cu(t,i,r),n=!0},p:function(t,n){var l=tA(n,1)[0],c=e;(e=s(t))===c?a[e].p(t,l):(Hu(),Ku(a[c],1,1,(function(){a[c]=null})),ju(),(r=a[e])?r.p(t,l):(r=a[e]=o[e](t)).c(),Gu(r,1),r.m(i.parentNode,i))},i:function(t){n||(Gu(r),n=!0)},o:function(t){Ku(r),n=!1},d:function(t){a[e].d(t),t&&uu(i)}}}function Cy(t,e,r){var i=e.$$slots,n=void 0===i?{}:i,o=e.$$scope,a=e.color,s=void 0===a?"black":a,l=e.animation,c=void 0===l||l,u=e.center,h=void 0===u||u;return s=["black","white"].includes(s)?s:"black",t.$$set=function(t){"color"in t&&r(0,s=t.color),"animation"in t&&r(1,c=t.animation),"center"in t&&r(2,h=t.center),"$$scope"in t&&r(3,o=t.$$scope)},[s,c,h,o,n]}kt({target:"Array",proto:!0},{includes:function(t){return yy(this,t,arguments.length>1?arguments[1]:void 0)}}),ve("includes");var Ey=function(t){qe(r,t);var e=vy(r);function r(t){var i;return je(this,r),Yu(Ge(i=e.call(this)),t,Cy,By,$c,{color:0,animation:1,center:2},xy),i}return r}(Ju),Ty={rgb2hsl:Iy,rgb2hsv:Sy,rgb2hwb:My,rgb2cmyk:Fy,rgb2keyword:Py,rgb2xyz:Ly,rgb2lab:Dy,rgb2lch:function(t){return Vy(Dy(t))},hsl2rgb:Uy,hsl2hsv:function(t){var e=t[0],r=t[1]/100,i=t[2]/100;if(0===i)return[0,0,0];return[e,100*(2*(r*=(i*=2)<=1?i:2-i)/(i+r)),100*((i+r)/2)]},hsl2hwb:function(t){return My(Uy(t))},hsl2cmyk:function(t){return Fy(Uy(t))},hsl2keyword:function(t){return Py(Uy(t))},hsv2rgb:ky,hsv2hsl:function(t){var e,r,i=t[0],n=t[1]/100,o=t[2]/100;return e=n*o,[i,100*(e=(e/=(r=(2-n)*o)<=1?r:2-r)||0),100*(r/=2)]},hsv2hwb:function(t){return My(ky(t))},hsv2cmyk:function(t){return Fy(ky(t))},hsv2keyword:function(t){return Py(ky(t))},hwb2rgb:zy,hwb2hsl:function(t){return Iy(zy(t))},hwb2hsv:function(t){return Sy(zy(t))},hwb2cmyk:function(t){return Fy(zy(t))},hwb2keyword:function(t){return Py(zy(t))},cmyk2rgb:Ry,cmyk2hsl:function(t){return Iy(Ry(t))},cmyk2hsv:function(t){return Sy(Ry(t))},cmyk2hwb:function(t){return My(Ry(t))},cmyk2keyword:function(t){return Py(Ry(t))},keyword2rgb:Gy,keyword2hsl:function(t){return Iy(Gy(t))},keyword2hsv:function(t){return Sy(Gy(t))},keyword2hwb:function(t){return My(Gy(t))},keyword2cmyk:function(t){return Fy(Gy(t))},keyword2lab:function(t){return Dy(Gy(t))},keyword2xyz:function(t){return Ly(Gy(t))},xyz2rgb:Oy,xyz2lab:Qy,xyz2lch:function(t){return Vy(Qy(t))},lab2xyz:Ny,lab2rgb:Hy,lab2lch:Vy,lch2lab:jy,lch2xyz:function(t){return Ny(jy(t))},lch2rgb:function(t){return Hy(jy(t))}};function Iy(t){var e,r,i=t[0]/255,n=t[1]/255,o=t[2]/255,a=Math.min(i,n,o),s=Math.max(i,n,o),l=s-a;return s==a?e=0:i==s?e=(n-o)/l:n==s?e=2+(o-i)/l:o==s&&(e=4+(i-n)/l),(e=Math.min(60*e,360))<0&&(e+=360),r=(a+s)/2,[e,100*(s==a?0:r<=.5?l/(s+a):l/(2-s-a)),100*r]}function Sy(t){var e,r,i=t[0],n=t[1],o=t[2],a=Math.min(i,n,o),s=Math.max(i,n,o),l=s-a;return r=0==s?0:l/s*1e3/10,s==a?e=0:i==s?e=(n-o)/l:n==s?e=2+(o-i)/l:o==s&&(e=4+(i-n)/l),(e=Math.min(60*e,360))<0&&(e+=360),[e,r,s/255*1e3/10]}function My(t){var e=t[0],r=t[1],i=t[2];return[Iy(t)[0],100*(1/255*Math.min(e,Math.min(r,i))),100*(i=1-1/255*Math.max(e,Math.max(r,i)))]}function Fy(t){var e,r=t[0]/255,i=t[1]/255,n=t[2]/255;return[100*((1-r-(e=Math.min(1-r,1-i,1-n)))/(1-e)||0),100*((1-i-e)/(1-e)||0),100*((1-n-e)/(1-e)||0),100*e]}function Py(t){return qy[JSON.stringify(t)]}function Ly(t){var e=t[0]/255,r=t[1]/255,i=t[2]/255;return[100*(.4124*(e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92)+.3576*(r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92)+.1805*(i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92)),100*(.2126*e+.7152*r+.0722*i),100*(.0193*e+.1192*r+.9505*i)]}function Dy(t){var e=Ly(t),r=e[0],i=e[1],n=e[2];return i/=100,n/=108.883,r=(r/=95.047)>.008856?Math.pow(r,1/3):7.787*r+16/116,[116*(i=i>.008856?Math.pow(i,1/3):7.787*i+16/116)-16,500*(r-i),200*(i-(n=n>.008856?Math.pow(n,1/3):7.787*n+16/116))]}function Uy(t){var e,r,i,n,o,a=t[0]/360,s=t[1]/100,l=t[2]/100;if(0==s)return[o=255*l,o,o];e=2*l-(r=l<.5?l*(1+s):l+s-l*s),n=[0,0,0];for(var c=0;c<3;c++)(i=a+1/3*-(c-1))<0&&i++,i>1&&i--,o=6*i<1?e+6*(r-e)*i:2*i<1?r:3*i<2?e+(r-e)*(2/3-i)*6:e,n[c]=255*o;return n}function ky(t){var e=t[0]/60,r=t[1]/100,i=t[2]/100,n=Math.floor(e)%6,o=e-Math.floor(e),a=255*i*(1-r),s=255*i*(1-r*o),l=255*i*(1-r*(1-o));i*=255;switch(n){case 0:return[i,l,a];case 1:return[s,i,a];case 2:return[a,i,l];case 3:return[a,s,i];case 4:return[l,a,i];case 5:return[i,a,s]}}function zy(t){var e,i,n,o,a=t[0]/360,s=t[1]/100,l=t[2]/100,c=s+l;switch(c>1&&(s/=c,l/=c),n=6*a-(e=Math.floor(6*a)),1&e&&(n=1-n),o=s+n*((i=1-l)-s),e){default:case 6:case 0:r=i,g=o,b=s;break;case 1:r=o,g=i,b=s;break;case 2:r=s,g=i,b=o;break;case 3:r=s,g=o,b=i;break;case 4:r=o,g=s,b=i;break;case 5:r=i,g=s,b=o}return[255*r,255*g,255*b]}function Ry(t){var e=t[0]/100,r=t[1]/100,i=t[2]/100,n=t[3]/100;return[255*(1-Math.min(1,e*(1-n)+n)),255*(1-Math.min(1,r*(1-n)+n)),255*(1-Math.min(1,i*(1-n)+n))]}function Oy(t){var e,r,i,n=t[0]/100,o=t[1]/100,a=t[2]/100;return r=-.9689*n+1.8758*o+.0415*a,i=.0557*n+-.204*o+1.057*a,e=(e=3.2406*n+-1.5372*o+-.4986*a)>.0031308?1.055*Math.pow(e,1/2.4)-.055:e*=12.92,r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:r*=12.92,i=i>.0031308?1.055*Math.pow(i,1/2.4)-.055:i*=12.92,[255*(e=Math.min(Math.max(0,e),1)),255*(r=Math.min(Math.max(0,r),1)),255*(i=Math.min(Math.max(0,i),1))]}function Qy(t){var e=t[0],r=t[1],i=t[2];return r/=100,i/=108.883,e=(e/=95.047)>.008856?Math.pow(e,1/3):7.787*e+16/116,[116*(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116)-16,500*(e-r),200*(r-(i=i>.008856?Math.pow(i,1/3):7.787*i+16/116))]}function Ny(t){var e,r,i,n,o=t[0],a=t[1],s=t[2];return o<=8?n=(r=100*o/903.3)/100*7.787+16/116:(r=100*Math.pow((o+16)/116,3),n=Math.pow(r/100,1/3)),[e=e/95.047<=.008856?e=95.047*(a/500+n-16/116)/7.787:95.047*Math.pow(a/500+n,3),r,i=i/108.883<=.008859?i=108.883*(n-s/200-16/116)/7.787:108.883*Math.pow(n-s/200,3)]}function Vy(t){var e,r=t[0],i=t[1],n=t[2];return(e=360*Math.atan2(n,i)/2/Math.PI)<0&&(e+=360),[r,Math.sqrt(i*i+n*n),e]}function Hy(t){return Oy(Ny(t))}function jy(t){var e,r=t[0],i=t[1];return e=t[2]/360*2*Math.PI,[r,i*Math.cos(e),i*Math.sin(e)]}function Gy(t){return Ky[t]}var Ky={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},qy={};for(var Zy in Ky)qy[JSON.stringify(Ky[Zy])]=Zy;var Wy=function(){return new tv};for(var Xy in Ty){Wy[Xy+"Raw"]=function(t){return function(e){return"number"==typeof e&&(e=Array.prototype.slice.call(arguments)),Ty[t](e)}}(Xy);var $y=/(\w+)2(\w+)/.exec(Xy),Yy=$y[1],Jy=$y[2];(Wy[Yy]=Wy[Yy]||{})[Jy]=Wy[Xy]=function(t){return function(e){"number"==typeof e&&(e=Array.prototype.slice.call(arguments));var r=Ty[t](e);if("string"==typeof r||void 0===r)return r;for(var i=0;i<r.length;i++)r[i]=Math.round(r[i]);return r}}(Xy)}var tv=function(){this.convs={}};function ev(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,i=Xe(t);if(e){var n=Xe(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return We(this,r)}}function rv(t){lu(t,"svelte-1jfo727",".wrapper.svelte-1jfo727.svelte-1jfo727{height:90vh}.tick.svelte-1jfo727.svelte-1jfo727{font-size:0.725em;font-weight:200}.tick.svelte-1jfo727 line.svelte-1jfo727{stroke:#888;stroke-dasharray:2}.tick.svelte-1jfo727 text.svelte-1jfo727{fill:#888;text-anchor:start}.tick.tick-0.svelte-1jfo727 line.svelte-1jfo727{stroke-dasharray:0}.x-axis.svelte-1jfo727 .tick text.svelte-1jfo727{text-anchor:middle}")}function iv(t,e,r){var i=t.slice();return i[14]=e[r],i}function nv(t,e,r){var i=t.slice();return i[17]=e[r],i}function ov(t){var e,r,i,n,o,a,s=(t[1]>380?t[17]:lv(t[17]))+"";return{c:function(){e=pu("g"),r=pu("line"),n=pu("text"),o=du(s),_u(r,"y1",i="-"+t[2]),_u(r,"y2","-"+t[7].bottom),_u(r,"x1","0"),_u(r,"x2","0"),_u(r,"class","svelte-1jfo727"),_u(n,"y","-2"),_u(n,"class","svelte-1jfo727"),_u(e,"class","tick tick-"+t[17]+" svelte-1jfo727"),_u(e,"transform",a="translate("+t[5](t[0](t[17]))+","+t[2]+")")},m:function(t,i){cu(t,e,i),su(e,r),su(e,n),su(n,o)},p:function(t,n){4&n&&i!==(i="-"+t[2])&&_u(r,"y1",i),2&n&&s!==(s=(t[1]>380?t[17]:lv(t[17]))+"")&&vu(o,s),37&n&&a!==(a="translate("+t[5](t[0](t[17]))+","+t[2]+")")&&_u(e,"transform",a)},d:function(t){t&&uu(e)}}}function av(t){var e,r,i;return{c:function(){_u(e=pu("circle"),"cx",r=t[14].x),_u(e,"cy",i=t[14].y),_u(e,"r",t[4]),_u(e,"fill","black")},m:function(t,r){cu(t,e,r)},p:function(t,n){8&n&&r!==(r=t[14].x)&&_u(e,"cx",r),8&n&&i!==(i=t[14].y)&&_u(e,"cy",i),16&n&&_u(e,"r",t[4])},d:function(t){t&&uu(e)}}}function sv(t){for(var e,r,i,n,o,a,s=t[6],l=[],c=0;c<s.length;c+=1)l[c]=ov(nv(t,s,c));for(var u=t[3].nodes(),h=[],A=0;A<u.length;A+=1)h[A]=av(iv(t,u,A));return{c:function(){e=Au("div"),r=pu("svg"),i=pu("g"),n=pu("g");for(var a=0;a<l.length;a+=1)l[a].c();o=mu();for(var s=0;s<h.length;s+=1)h[s].c();_u(n,"class","axis x-axis svelte-1jfo727"),_u(i,"class","inner_chart"),_u(i,"transform","translate("+t[7].left+", 0)"),_u(r,"width",t[1]),_u(r,"height",t[2]),_u(e,"class","wrapper svelte-1jfo727"),Uu((function(){return t[12].call(e)}))},m:function(s,c){cu(s,e,c),su(e,r),su(r,i),su(i,n);for(var u=0;u<l.length;u+=1)l[u]&&l[u].m(n,null);su(n,o);for(var A=0;A<h.length;A+=1)h[A]&&h[A].m(n,null);a=bu(e,t[12].bind(e))},p:function(t,e){var i=tA(e,1)[0];if(231&i){var a;for(s=t[6],a=0;a<s.length;a+=1){var c=nv(t,s,a);l[a]?l[a].p(c,i):(l[a]=ov(c),l[a].c(),l[a].m(n,o))}for(;a<l.length;a+=1)l[a].d(1);l.length=s.length}if(24&i){var A;for(u=t[3].nodes(),A=0;A<u.length;A+=1){var p=iv(t,u,A);h[A]?h[A].p(p,i):(h[A]=av(p),h[A].c(),h[A].m(n,null))}for(;A<h.length;A+=1)h[A].d(1);h.length=u.length}2&i&&_u(r,"width",t[1]),4&i&&_u(r,"height",t[2])},i:Kc,o:Kc,d:function(t){t&&uu(e),hu(l,t),hu(h,t),a()}}}function lv(t){return"'"+t.toString().slice(-2)}function cv(t,e,r){var i,n,o,a,s,l,c=e.beeswarm_data,u=e.just_year_parser,h=400,A=400,p={top:10,right:10,bottom:10,left:10};t_().range([10,n]).domain($h(c,(function(t){return t[1][0][0]})));return t.$$set=function(t){"beeswarm_data"in t&&r(8,c=t.beeswarm_data),"just_year_parser"in t&&r(0,u=t.just_year_parser)},t.$$.update=function(){if(2&t.$$.dirty&&r(10,i=h-p.left-p.right),4&t.$$.dirty&&r(9,n=A-p.top-p.bottom),3072&t.$$.dirty&&r(4,a=o(i)),1280&t.$$.dirty&&r(5,s=t_().range([0,i]).domain($h(c,(function(t){return t[1][0][0]})))),816&t.$$.dirty&&r(3,l=qd(c).force("x",function(t){var e,r,i,n=Rd(.1);function o(t){for(var n,o=0,a=e.length;o<a;++o)(n=e[o]).vx+=(i[o]-n.x)*r[o]*t}function a(){if(e){var o,a=e.length;for(r=new Array(a),i=new Array(a),o=0;o<a;++o)r[o]=isNaN(i[o]=+t(e[o],o,e))?0:+n(e[o],o,e)}}return"function"!=typeof t&&(t=Rd(null==t?0:+t)),o.initialize=function(t){e=t,a()},o.strength=function(t){return arguments.length?(n="function"==typeof t?t:Rd(+t),a(),o):n},o.x=function(e){return arguments.length?(t="function"==typeof e?e:Rd(+e),a(),o):t},o}((function(t){return s(t[1][0][0])})).strength(.95)).force("y",function(t){var e,r,i,n=Rd(.1);function o(t){for(var n,o=0,a=e.length;o<a;++o)(n=e[o]).vy+=(i[o]-n.y)*r[o]*t}function a(){if(e){var o,a=e.length;for(r=new Array(a),i=new Array(a),o=0;o<a;++o)r[o]=isNaN(i[o]=+t(e[o],o,e))?0:+n(e[o],o,e)}}return"function"!=typeof t&&(t=Rd(null==t?0:+t)),o.initialize=function(t){e=t,a()},o.strength=function(t){return arguments.length?(n="function"==typeof t?t:Rd(+t),a(),o):n},o.y=function(e){return arguments.length?(t="function"==typeof e?e:Rd(+e),a(),o):t},o}(n/2).strength(.03)).force("collide",function(t){var e,r,i,n=1,o=1;function a(){for(var t,a,l,c,u,h,A,p=e.length,d=0;d<o;++d)for(a=Dd(e,Qd,Nd).visitAfter(s),t=0;t<p;++t)l=e[t],h=r[l.index],A=h*h,c=l.x+l.vx,u=l.y+l.vy,a.visit(f);function f(t,e,r,o,a){var s=t.data,p=t.r,d=h+p;if(!s)return e>c+d||o<c-d||r>u+d||a<u-d;if(s.index>l.index){var f=c-s.x-s.vx,m=u-s.y-s.vy,g=f*f+m*m;g<d*d&&(0===f&&(g+=(f=Od(i))*f),0===m&&(g+=(m=Od(i))*m),g=(d-(g=Math.sqrt(g)))/g*n,l.vx+=(f*=g)*(d=(p*=p)/(A+p)),l.vy+=(m*=g)*d,s.vx-=f*(d=1-d),s.vy-=m*d)}}}function s(t){if(t.data)return t.r=r[t.data.index];for(var e=t.r=0;e<4;++e)t[e]&&t[e].r>t.r&&(t.r=t[e].r)}function l(){if(e){var i,n,o=e.length;for(r=new Array(o),i=0;i<o;++i)n=e[i],r[n.index]=+t(n,i,e)}}return"function"!=typeof t&&(t=Rd(null==t?1:+t)),a.initialize=function(t,r){e=t,i=r,l()},a.iterations=function(t){return arguments.length?(o=+t,a):o},a.strength=function(t){return arguments.length?(n=+t,a):n},a.radius=function(e){return arguments.length?(t="function"==typeof e?e:Rd(+e),l(),a):t},a}(a+2)).alpha(.3).alphaDecay(.001).stop()),8&t.$$.dirty)for(var e=0;e<200;++e)l.tick()},r(11,o=Of().domain([300,800]).range([4,7])),[u,h,A,l,a,s,[1995,2e3,2005,2010,2015,2020],p,c,n,i,o,function(){h=this.clientWidth,A=this.clientHeight,r(1,h),r(2,A)}]}tv.prototype.routeSpace=function(t,e){var r=e[0];return void 0===r?this.getValues(t):("number"==typeof r&&(r=Array.prototype.slice.call(e)),this.setValues(t,r))},tv.prototype.setValues=function(t,e){return this.space=t,this.convs={},this.convs[t]=e,this},tv.prototype.getValues=function(t){var e=this.convs[t];if(!e){var r=this.space,i=this.convs[r];e=Wy[r][t](i),this.convs[t]=e}return e},["rgb","hsl","hsv","cmyk","keyword"].forEach((function(t){tv.prototype[t]=function(e){return this.routeSpace(t,arguments)}}));var uv=function(t){qe(r,t);var e=ev(r);function r(t){var i;return je(this,r),Yu(Ge(i=e.call(this)),t,cv,sv,$c,{beeswarm_data:8,just_year_parser:0},rv),i}return r}(Ju);function hv(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,i=Xe(t);if(e){var n=Xe(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return We(this,r)}}function Av(t){lu(t,"svelte-1x4yzyc",".wrapper.svelte-1x4yzyc.svelte-1x4yzyc{height:90vh}.tick.svelte-1x4yzyc.svelte-1x4yzyc{font-size:0.725em;font-weight:200}.tick.svelte-1x4yzyc line.svelte-1x4yzyc{stroke:#888;stroke-dasharray:2}.tick.svelte-1x4yzyc text.svelte-1x4yzyc{fill:#888;text-anchor:start}.tick.tick-0.svelte-1x4yzyc line.svelte-1x4yzyc{stroke-dasharray:0}.x-axis.svelte-1x4yzyc .tick text.svelte-1x4yzyc{text-anchor:middle}.path-line.svelte-1x4yzyc.svelte-1x4yzyc{fill:none;stroke:rgb(0, 100, 100);stroke-linejoin:round;stroke-linecap:round;stroke-width:2}.path-area.svelte-1x4yzyc.svelte-1x4yzyc{fill:rgba(0, 100, 100, 0.2)}")}function pv(t,e,r){var i=t.slice();return i[16]=e[r],i}function dv(t,e,r){var i=t.slice();return i[16]=e[r],i}function fv(t){var e,r,i,n,o,a,s=t[16]+"",l=8===t[16]?" million sq km":"";return{c:function(){e=pu("g"),r=pu("line"),i=pu("text"),n=du(s),o=du(l),_u(r,"x2","100%"),_u(r,"class","svelte-1x4yzyc"),_u(i,"y","-4"),_u(i,"class","svelte-1x4yzyc"),_u(e,"class","tick tick-"+t[16]+" svelte-1x4yzyc"),_u(e,"transform",a="translate(0, "+(t[3](t[16])-t[9].bottom)+")")},m:function(t,a){cu(t,e,a),su(e,r),su(e,i),su(i,n),su(i,o)},p:function(t,r){8&r&&a!==(a="translate(0, "+(t[3](t[16])-t[9].bottom)+")")&&_u(e,"transform",a)},d:function(t){t&&uu(e)}}}function mv(t){var e,r,i,n,o,a,s=(t[1]>380?t[16]:_v(t[16]))+"";return{c:function(){e=pu("g"),r=pu("line"),n=pu("text"),o=du(s),_u(r,"y1",i="-"+t[2]),_u(r,"y2","-"+t[9].bottom),_u(r,"x1","0"),_u(r,"x2","0"),_u(r,"class","svelte-1x4yzyc"),_u(n,"y","-2"),_u(n,"class","svelte-1x4yzyc"),_u(e,"class","tick tick-"+t[16]+" svelte-1x4yzyc"),_u(e,"transform",a="translate("+t[4](t[0](t[16]))+","+t[2]+")")},m:function(t,i){cu(t,e,i),su(e,r),su(e,n),su(n,o)},p:function(t,n){4&n&&i!==(i="-"+t[2])&&_u(r,"y1",i),2&n&&s!==(s=(t[1]>380?t[16]:_v(t[16]))+"")&&vu(o,s),21&n&&a!==(a="translate("+t[4](t[0](t[16]))+","+t[2]+")")&&_u(e,"transform",a)},d:function(t){t&&uu(e)}}}function gv(t){for(var e,r,i,n,o,a,s,l=t[7],c=[],u=0;u<l.length;u+=1)c[u]=fv(dv(t,l,u));for(var h=t[8],A=[],p=0;p<h.length;p+=1)A[p]=mv(pv(t,h,p));return{c:function(){e=Au("div"),r=pu("svg"),i=pu("g");for(var s=0;s<c.length;s+=1)c[s].c();n=pu("g");for(var l=0;l<A.length;l+=1)A[l].c();o=pu("path"),a=pu("path"),_u(i,"class","axis y-axis"),_u(i,"transform","translate(0, "+t[9].top+")"),_u(n,"class","axis x-axis svelte-1x4yzyc"),_u(o,"class","path-area svelte-1x4yzyc"),_u(o,"d",t[6]),_u(a,"class","path-line svelte-1x4yzyc"),_u(a,"d",t[5]),_u(r,"width",t[1]),_u(r,"height",t[2]),_u(e,"class","wrapper svelte-1x4yzyc"),Uu((function(){return t[15].call(e)}))},m:function(l,u){cu(l,e,u),su(e,r),su(r,i);for(var h=0;h<c.length;h+=1)c[h]&&c[h].m(i,null);su(r,n);for(var p=0;p<A.length;p+=1)A[p]&&A[p].m(n,null);su(r,o),su(r,a),s=bu(e,t[15].bind(e))},p:function(t,e){var s=tA(e,1)[0];if(648&s){var u;for(l=t[7],u=0;u<l.length;u+=1){var p=dv(t,l,u);c[u]?c[u].p(p,s):(c[u]=fv(p),c[u].c(),c[u].m(i,null))}for(;u<c.length;u+=1)c[u].d(1);c.length=l.length}if(791&s){var d;for(h=t[8],d=0;d<h.length;d+=1){var f=pv(t,h,d);A[d]?A[d].p(f,s):(A[d]=mv(f),A[d].c(),A[d].m(n,null))}for(;d<A.length;d+=1)A[d].d(1);A.length=h.length}64&s&&_u(o,"d",t[6]),32&s&&_u(a,"d",t[5]),2&s&&_u(r,"width",t[1]),4&s&&_u(r,"height",t[2])},i:Kc,o:Kc,d:function(t){t&&uu(e),hu(c,t),hu(A,t),s()}}}function _v(t){return"'"+t.toString().slice(-2)}function yv(t,e,r){var i,n,o,a,s,l,c,u,h=e.areachart_data,A=e.just_year_parser;console.log(h);var p=400,d=800,f={top:10,right:10,bottom:10,left:10};return t.$$set=function(t){"areachart_data"in t&&r(10,h=t.areachart_data),"just_year_parser"in t&&r(0,A=t.just_year_parser)},t.$$.update=function(){2&t.$$.dirty&&r(14,i=p-f.left-f.right),4&t.$$.dirty&&r(13,n=d-f.top-f.bottom),17408&t.$$.dirty&&r(4,o=function(){return wf.apply(Jg(wm,bm,ym,gm,pm,am,nm,rm,tm,Lm).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}().domain($h(h,(function(t){return t.date}))).range([0,i])),8192&t.$$.dirty&&r(3,a=Of().domain([0,100]).range([n,0])),1024&t.$$.dirty&&r(11,s=h[0].date),1024&t.$$.dirty&&r(12,l=h[h.length-1].date),1048&t.$$.dirty&&r(5,c="M".concat(h.map((function(t){return"".concat(o(t.date),",").concat(a(t.value))})).join("L"))),6200&t.$$.dirty&&r(6,u="".concat(c,"L").concat(o(l),",").concat(a(0),"L").concat(o(s),",").concat(a(0),"Z"))},[A,p,d,a,o,c,u,[30,60,90],[1995,2e3,2005,2010,2015,2020],f,h,s,l,n,i,function(){p=this.clientWidth,d=this.clientHeight,r(1,p),r(2,d)}]}var vv=function(t){qe(r,t);var e=hv(r);function r(t){var i;return je(this,r),Yu(Ge(i=e.call(this)),t,yv,gv,$c,{areachart_data:10,just_year_parser:0},Av),i}return r}(Ju),xv=rd.entries;function wv(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,i=Xe(t);if(e){var n=Xe(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return We(this,r)}}function bv(t){lu(t,"svelte-yeisvh",".wrapper.svelte-yeisvh{height:90vh}")}function Bv(t,e,r){var i=t.slice();return i[13]=e[r],i}function Cv(t,e,r){var i=t.slice();return i[16]=e[r],i}function Ev(t){var e,r;return{c:function(){_u(e=pu("path"),"d",r=t[2](t[16])),_u(e,"stroke","white")},m:function(t,r){cu(t,e,r)},p:function(t,i){4&i&&r!==(r=t[2](t[16]))&&_u(e,"d",r)},d:function(t){t&&uu(e)}}}function Tv(t){var e,r;return{c:function(){_u(e=pu("polyline"),"fill","none"),_u(e,"stroke","black"),_u(e,"stroke-width","1"),_u(e,"points",r=t[3](t[13]))},m:function(t,r){cu(t,e,r)},p:function(t,i){8&i&&r!==(r=t[3](t[13]))&&_u(e,"points",r)},d:function(t){t&&uu(e)}}}function Iv(t){for(var e,r,i,n,o,a,s=t[4],l=[],c=0;c<s.length;c+=1)l[c]=Ev(Cv(t,s,c));for(var u=t[4],h=[],A=0;A<u.length;A+=1)h[A]=Tv(Bv(t,u,A));return{c:function(){e=Au("div"),r=pu("svg"),i=pu("g");for(var a=0;a<l.length;a+=1)l[a].c();n=mu();for(var s=0;s<h.length;s+=1)h[s].c();_u(i,"transform",o="translate("+t[0]/2+" "+t[1]/2+")"),_u(r,"width",t[0]),_u(r,"height",t[1]),_u(e,"class","wrapper svelte-yeisvh"),Uu((function(){return t[10].call(e)}))},m:function(o,s){cu(o,e,s),su(e,r),su(r,i);for(var c=0;c<l.length;c+=1)l[c]&&l[c].m(i,null);su(i,n);for(var u=0;u<h.length;u+=1)h[u]&&h[u].m(i,null);a=bu(e,t[10].bind(e))},p:function(t,e){var a=tA(e,1)[0];if(20&a){var c;for(s=t[4],c=0;c<s.length;c+=1){var A=Cv(t,s,c);l[c]?l[c].p(A,a):(l[c]=Ev(A),l[c].c(),l[c].m(i,n))}for(;c<l.length;c+=1)l[c].d(1);l.length=s.length}if(24&a){var p;for(u=t[4],p=0;p<u.length;p+=1){var d=Bv(t,u,p);h[p]?h[p].p(d,a):(h[p]=Tv(d),h[p].c(),h[p].m(i,null))}for(;p<h.length;p+=1)h[p].d(1);h.length=u.length}3&a&&o!==(o="translate("+t[0]/2+" "+t[1]/2+")")&&_u(i,"transform",o),1&a&&_u(r,"width",t[0]),2&a&&_u(r,"height",t[1])},i:Kc,o:Kc,d:function(t){t&&uu(e),hu(l,t),hu(h,t),a()}}}function Sv(t,e,r){var i,n,o,a,s,l,c=e.donut_data,u=400,h=800,A=10,p=10,d=10,f=10,m=b_().sort(null).value((function(t){return t[1][1].length}))(Object.entries(c));return t.$$set=function(t){"donut_data"in t&&r(5,c=t.donut_data)},t.$$.update=function(){1&t.$$.dirty&&r(9,i=u-f-p),2&t.$$.dirty&&r(8,n=h-A-d),768&t.$$.dirty&&r(6,o=Math.min(i,n)/2),64&t.$$.dirty&&r(2,a=v_().innerRadius(.5*o).outerRadius(.8*o)),64&t.$$.dirty&&r(7,s=v_().innerRadius(.9*o).outerRadius(.9*o)),196&t.$$.dirty&&r(3,l=function(t){var e=a.centroid(t),r=s.centroid(t),i=s.centroid(t),n=t.startAngle+(t.endAngle-t.startAngle)/2;return i[0]=.88*o*(n<Math.PI?1:-1),[e,r,i]})},[u,h,a,l,m,c,o,s,n,i,function(){u=this.clientWidth,h=this.clientHeight,r(0,u),r(1,h)}]}kt({target:"Object",stat:!0},{entries:function(t){return xv(t)}});var Mv=function(t){qe(r,t);var e=wv(r);function r(t){var i;return je(this,r),Yu(Ge(i=e.call(this)),t,Sv,Iv,$c,{donut_data:5},bv),i}return r}(Ju);function Fv(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,i=Xe(t);if(e){var n=Xe(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return We(this,r)}}function Pv(t){lu(t,"svelte-1wk4drw",".wrapper.svelte-1wk4drw.svelte-1wk4drw{height:90vh}.tick.svelte-1wk4drw.svelte-1wk4drw{font-size:0.725em;font-weight:200}.tick.svelte-1wk4drw line.svelte-1wk4drw{stroke:#888;stroke-dasharray:2}.tick.svelte-1wk4drw text.svelte-1wk4drw{fill:#888;text-anchor:start}.tick.tick-0.svelte-1wk4drw line.svelte-1wk4drw{stroke-dasharray:0}.x-axis.svelte-1wk4drw .tick text.svelte-1wk4drw{text-anchor:start}")}function Lv(t,e,r){var i=t.slice();return i[16]=e[r],i}function Dv(t,e,r){var i=t.slice();return i[19]=e[r],i}function Uv(t,e,r){var i=t.slice();return i[19]=e[r],i}function kv(t){var e,r,i,n,o=(t[0]>380?t[19]:Qv(t[19]))+"";return{c:function(){e=pu("g"),r=pu("text"),i=du(o),_u(r,"y","-2"),_u(r,"class","svelte-1wk4drw"),_u(e,"class","tick tick-"+t[19]+" svelte-1wk4drw"),_u(e,"transform",n="translate("+t[3](t[19])+","+t[1]+")")},m:function(t,n){cu(t,e,n),su(e,r),su(r,i)},p:function(t,r){1&r&&o!==(o=(t[0]>380?t[19]:Qv(t[19]))+"")&&vu(i,o),10&r&&n!==(n="translate("+t[3](t[19])+","+t[1]+")")&&_u(e,"transform",n)},d:function(t){t&&uu(e)}}}function zv(t){var e,r,i,n,o,a,s=t[19]+"",l=8===t[19]?" million sq km":"";return{c:function(){e=pu("g"),r=pu("line"),i=pu("text"),n=du(s),o=du(l),_u(r,"x2","100%"),_u(r,"class","svelte-1wk4drw"),_u(i,"y","-4"),_u(i,"class","svelte-1wk4drw"),_u(e,"class","tick tick-"+t[19]+" svelte-1wk4drw"),_u(e,"transform",a="translate(0, "+(t[2](t[19])-t[5].bottom)+")")},m:function(t,a){cu(t,e,a),su(e,r),su(e,i),su(i,n),su(i,o)},p:function(t,r){4&r&&a!==(a="translate(0, "+(t[2](t[19])-t[5].bottom)+")")&&_u(e,"transform",a)},d:function(t){t&&uu(e)}}}function Rv(t){var e,r,i,n,o;return{c:function(){_u(e=pu("rect"),"x",r=t[16].x),_u(e,"y",i=t[16].y),_u(e,"width",n=t[16].width),_u(e,"height",o=t[16].height)},m:function(t,r){cu(t,e,r)},p:function(t,a){16&a&&r!==(r=t[16].x)&&_u(e,"x",r),16&a&&i!==(i=t[16].y)&&_u(e,"y",i),16&a&&n!==(n=t[16].width)&&_u(e,"width",n),16&a&&o!==(o=t[16].height)&&_u(e,"height",o)},d:function(t){t&&uu(e)}}}function Ov(t){for(var e,r,i,n,o,a,s=t[7],l=[],c=0;c<s.length;c+=1)l[c]=kv(Uv(t,s,c));for(var u=t[6],h=[],A=0;A<u.length;A+=1)h[A]=zv(Dv(t,u,A));for(var p=t[4],d=[],f=0;f<p.length;f+=1)d[f]=Rv(Lv(t,p,f));return{c:function(){e=Au("div"),r=pu("svg"),i=pu("g"),n=pu("g");for(var a=0;a<l.length;a+=1)l[a].c();o=pu("g");for(var s=0;s<h.length;s+=1)h[s].c();for(var c=0;c<d.length;c+=1)d[c].c();_u(n,"class","axis x-axis svelte-1wk4drw"),_u(o,"class","axis y-axis"),_u(o,"transform","translate(0, "+t[5].top+")"),_u(r,"width",t[0]),_u(r,"height",t[1]),_u(e,"class","wrapper svelte-1wk4drw"),Uu((function(){return t[12].call(e)}))},m:function(s,c){cu(s,e,c),su(e,r),su(r,i),su(i,n);for(var u=0;u<l.length;u+=1)l[u]&&l[u].m(n,null);su(i,o);for(var A=0;A<h.length;A+=1)h[A]&&h[A].m(o,null);for(var p=0;p<d.length;p+=1)d[p]&&d[p].m(i,null);a=bu(e,t[12].bind(e))},p:function(t,e){var a=tA(e,1)[0];if(139&a){var c;for(s=t[7],c=0;c<s.length;c+=1){var A=Uv(t,s,c);l[c]?l[c].p(A,a):(l[c]=kv(A),l[c].c(),l[c].m(n,null))}for(;c<l.length;c+=1)l[c].d(1);l.length=s.length}if(100&a){var f;for(u=t[6],f=0;f<u.length;f+=1){var m=Dv(t,u,f);h[f]?h[f].p(m,a):(h[f]=zv(m),h[f].c(),h[f].m(o,null))}for(;f<h.length;f+=1)h[f].d(1);h.length=u.length}if(16&a){var g;for(p=t[4],g=0;g<p.length;g+=1){var _=Lv(t,p,g);d[g]?d[g].p(_,a):(d[g]=Rv(_),d[g].c(),d[g].m(i,null))}for(;g<d.length;g+=1)d[g].d(1);d.length=p.length}1&a&&_u(r,"width",t[0]),2&a&&_u(r,"height",t[1])},i:Kc,o:Kc,d:function(t){t&&uu(e),hu(l,t),hu(h,t),hu(d,t),a()}}}function Qv(t){return"'"+t.toString().slice(-2)}function Nv(t,e,r){var i,n,o,a,s,l,c=e.barchart_data;console.log(c);var u=400,h=800,A={top:10,right:10,bottom:10,left:10},p=["Pre-negotiation","Ceasefire","Partial","Comprehensive","Implementation","Renewal","Other"],d=["All"],f=Object.keys(c[0]);return d.push(f[2]),t.$$set=function(t){"barchart_data"in t&&r(8,c=t.barchart_data)},t.$$.update=function(){1&t.$$.dirty&&r(11,i=u-A.left-A.right),2&t.$$.dirty&&r(9,n=h-A.top-A.bottom),2048&t.$$.dirty&&r(3,o=Tf().domain(p).range([0,i]).padding([.2])),8&t.$$.dirty&&r(10,a=Tf().domain(d).range([0,o.bandwidth()]).padding([.05])),512&t.$$.dirty&&r(2,s=Of().domain([0,45]).range([n,0])),1804&t.$$.dirty&&r(4,l=c.map((function(t){return["All","Russia"].map((function(e){return{key:e,value:t[e],group:t.group,x:o(t.group)+a(e),y:s(t[e]),width:a.bandwidth(),height:n-s(t[e])}}))})).flat())},[u,h,s,o,l,A,[10,20,30,40],p,c,n,a,i,function(){u=this.clientWidth,h=this.clientHeight,r(0,u),r(1,h)}]}kt({target:"Array",proto:!0},{flat:function(){var t=arguments.length?arguments[0]:void 0,e=Ot(this),r=dt(e.length),i=Zt(e,0);return i.length=Jh(i,e,e,r,0,void 0===t?1:At(t)),i}}),ve("flat");var Vv=function(t){qe(r,t);var e=Fv(r);function r(t){var i;return je(this,r),Yu(Ge(i=e.call(this)),t,Nv,Ov,$c,{barchart_data:8},Pv),i}return r}(Ju),Hv=e((function(t,e){t.exports=function(){var t,e,r;function i(i,n){if(t)if(e){var o="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+t+")(sharedChunk); ("+e+")(sharedChunk); self.onerror = null;",a={};t(a),r=n(a),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(r.workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"})))}else e=n;else t=n}return i(["exports"],(function(t){var e="3.5.2";let r;const i={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==r){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{r=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):t}catch(e){r=t}}return r},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!i.API_URL)return null;try{const t=new URL(i.API_URL);return"api.mapbox.cn"===t.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===t.hostname?"https://events.mapbox.com/events/v2":null}catch(t){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function n(t){return i.API_URL_REGEX.test(t)}function o(t){return 0===t.indexOf("mapbox:")}function a(t){return i.API_CDN_URL_REGEX.test(t)}function s(t){return i.API_SPRITE_REGEX.test(t)}function l(t){return i.API_STYLE_REGEX.test(t)&&!s(t)}const c={create:"create",load:"load",fullLoad:"fullLoad"},u={mark(t){performance.mark(t)},measure(t,e,r){performance.measure(t,e,r)}};function h(t){const e=t.name.split("?")[0];return a(e)&&e.includes("mapbox-gl.js")?"javascript":a(e)&&e.includes("mapbox-gl.css")?"css":function(t){return i.API_FONTS_REGEX.test(t)}(e)?"fontRange":s(e)?"sprite":l(e)?"style":function(t){return i.API_TILEJSON_REGEX.test(t)}(e)?"tilejson":"other"}function A(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var p={},d={};Object.defineProperty(d,"__esModule",{value:!0}),d.setMatrixArrayType=function(t){d.ARRAY_TYPE=m=t},d.toRadian=function(t){return t*_},d.equals=function(t,e){return Math.abs(t-e)<=f*Math.max(1,Math.abs(t),Math.abs(e))},d.RANDOM=d.ARRAY_TYPE=d.EPSILON=void 0;var f=1e-6;d.EPSILON=f;var m="undefined"!=typeof Float32Array?Float32Array:Array;d.ARRAY_TYPE=m;var g=Math.random;d.RANDOM=g;var _=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var y={};function v(t){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v(t)}Object.defineProperty(y,"__esModule",{value:!0}),y.create=function(){var t=new x.ARRAY_TYPE(4);return x.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},y.clone=function(t){var e=new x.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},y.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},y.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},y.fromValues=function(t,e,r,i){var n=new x.ARRAY_TYPE(4);return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n},y.set=function(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t},y.transpose=function(t,e){if(t===e){var r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},y.invert=function(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],a=r*o-n*i;return a?(t[0]=o*(a=1/a),t[1]=-i*a,t[2]=-n*a,t[3]=r*a,t):null},y.adjoint=function(t,e){var r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t},y.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},y.multiply=b,y.rotate=function(t,e,r){var i=e[0],n=e[1],o=e[2],a=e[3],s=Math.sin(r),l=Math.cos(r);return t[0]=i*l+o*s,t[1]=n*l+a*s,t[2]=i*-s+o*l,t[3]=n*-s+a*l,t},y.scale=function(t,e,r){var i=e[1],n=e[2],o=e[3],a=r[0],s=r[1];return t[0]=e[0]*a,t[1]=i*a,t[2]=n*s,t[3]=o*s,t},y.fromRotation=function(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t},y.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},y.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},y.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},y.LDU=function(t,e,r,i){return t[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-t[2]*r[1],[t,e,r]},y.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},y.subtract=B,y.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},y.equals=function(t,e){var r=t[0],i=t[1],n=t[2],o=t[3],a=e[0],s=e[1],l=e[2],c=e[3];return Math.abs(r-a)<=x.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=x.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-l)<=x.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(o-c)<=x.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))},y.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},y.multiplyScalarAndAdd=function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t},y.sub=y.mul=void 0;var x=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==v(t)&&"function"!=typeof t)return{default:t};var e=w(void 0);if(e&&e.has(t))return e.get(t);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if("default"!==n&&Object.prototype.hasOwnProperty.call(t,n)){var o=i?Object.getOwnPropertyDescriptor(t,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=t[n]}return r.default=t,e&&e.set(t,r),r}(d);function w(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,r=new WeakMap;return(w=function(t){return t?r:e})(t)}function b(t,e,r){var i=e[0],n=e[1],o=e[2],a=e[3],s=r[0],l=r[1],c=r[2],u=r[3];return t[0]=i*s+o*l,t[1]=n*s+a*l,t[2]=i*c+o*u,t[3]=n*c+a*u,t}function B(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}y.mul=b,y.sub=B;var C={};function E(t){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},E(t)}Object.defineProperty(C,"__esModule",{value:!0}),C.create=function(){var t=new T.ARRAY_TYPE(6);return T.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},C.clone=function(t){var e=new T.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},C.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},C.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},C.fromValues=function(t,e,r,i,n,o){var a=new T.ARRAY_TYPE(6);return a[0]=t,a[1]=e,a[2]=r,a[3]=i,a[4]=n,a[5]=o,a},C.set=function(t,e,r,i,n,o,a){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=o,t[5]=a,t},C.invert=function(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],a=e[4],s=e[5],l=r*o-i*n;return l?(t[0]=o*(l=1/l),t[1]=-i*l,t[2]=-n*l,t[3]=r*l,t[4]=(n*s-o*a)*l,t[5]=(i*a-r*s)*l,t):null},C.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},C.multiply=S,C.rotate=function(t,e,r){var i=e[0],n=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=Math.sin(r),u=Math.cos(r);return t[0]=i*u+o*c,t[1]=n*u+a*c,t[2]=i*-c+o*u,t[3]=n*-c+a*u,t[4]=s,t[5]=l,t},C.scale=function(t,e,r){var i=e[1],n=e[2],o=e[3],a=e[4],s=e[5],l=r[0],c=r[1];return t[0]=e[0]*l,t[1]=i*l,t[2]=n*c,t[3]=o*c,t[4]=a,t[5]=s,t},C.translate=function(t,e,r){var i=e[0],n=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=r[0],u=r[1];return t[0]=i,t[1]=n,t[2]=o,t[3]=a,t[4]=i*c+o*u+s,t[5]=n*c+a*u+l,t},C.fromRotation=function(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t[4]=0,t[5]=0,t},C.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},C.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},C.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},C.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},C.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t},C.subtract=M,C.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t},C.multiplyScalarAndAdd=function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t},C.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},C.equals=function(t,e){var r=t[0],i=t[1],n=t[2],o=t[3],a=t[4],s=t[5],l=e[0],c=e[1],u=e[2],h=e[3],A=e[4],p=e[5];return Math.abs(r-l)<=T.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-c)<=T.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(n-u)<=T.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(o-h)<=T.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(a-A)<=T.EPSILON*Math.max(1,Math.abs(a),Math.abs(A))&&Math.abs(s-p)<=T.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))},C.sub=C.mul=void 0;var T=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==E(t)&&"function"!=typeof t)return{default:t};var e=I(void 0);if(e&&e.has(t))return e.get(t);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if("default"!==n&&Object.prototype.hasOwnProperty.call(t,n)){var o=i?Object.getOwnPropertyDescriptor(t,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=t[n]}return r.default=t,e&&e.set(t,r),r}(d);function I(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,r=new WeakMap;return(I=function(t){return t?r:e})(t)}function S(t,e,r){var i=e[0],n=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=r[0],u=r[1],h=r[2],A=r[3],p=r[4],d=r[5];return t[0]=i*c+o*u,t[1]=n*c+a*u,t[2]=i*h+o*A,t[3]=n*h+a*A,t[4]=i*p+o*d+s,t[5]=n*p+a*d+l,t}function M(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}C.mul=S,C.sub=M;var F={};function P(t){return P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},P(t)}Object.defineProperty(F,"__esModule",{value:!0}),F.create=function(){var t=new L.ARRAY_TYPE(9);return L.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},F.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},F.clone=function(t){var e=new L.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},F.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},F.fromValues=function(t,e,r,i,n,o,a,s,l){var c=new L.ARRAY_TYPE(9);return c[0]=t,c[1]=e,c[2]=r,c[3]=i,c[4]=n,c[5]=o,c[6]=a,c[7]=s,c[8]=l,c},F.set=function(t,e,r,i,n,o,a,s,l,c){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=o,t[5]=a,t[6]=s,t[7]=l,t[8]=c,t},F.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},F.transpose=function(t,e){if(t===e){var r=e[1],i=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=i,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},F.invert=function(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],a=e[4],s=e[5],l=e[6],c=e[7],u=e[8],h=u*a-s*c,A=-u*o+s*l,p=c*o-a*l,d=r*h+i*A+n*p;return d?(t[0]=h*(d=1/d),t[1]=(-u*i+n*c)*d,t[2]=(s*i-n*a)*d,t[3]=A*d,t[4]=(u*r-n*l)*d,t[5]=(-s*r+n*o)*d,t[6]=p*d,t[7]=(-c*r+i*l)*d,t[8]=(a*r-i*o)*d,t):null},F.adjoint=function(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],a=e[4],s=e[5],l=e[6],c=e[7],u=e[8];return t[0]=a*u-s*c,t[1]=n*c-i*u,t[2]=i*s-n*a,t[3]=s*l-o*u,t[4]=r*u-n*l,t[5]=n*o-r*s,t[6]=o*c-a*l,t[7]=i*l-r*c,t[8]=r*a-i*o,t},F.determinant=function(t){var e=t[3],r=t[4],i=t[5],n=t[6],o=t[7],a=t[8];return t[0]*(a*r-i*o)+t[1]*(-a*e+i*n)+t[2]*(o*e-r*n)},F.multiply=U,F.translate=function(t,e,r){var i=e[0],n=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=e[6],u=e[7],h=e[8],A=r[0],p=r[1];return t[0]=i,t[1]=n,t[2]=o,t[3]=a,t[4]=s,t[5]=l,t[6]=A*i+p*a+c,t[7]=A*n+p*s+u,t[8]=A*o+p*l+h,t},F.rotate=function(t,e,r){var i=e[0],n=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=e[6],u=e[7],h=e[8],A=Math.sin(r),p=Math.cos(r);return t[0]=p*i+A*a,t[1]=p*n+A*s,t[2]=p*o+A*l,t[3]=p*a-A*i,t[4]=p*s-A*n,t[5]=p*l-A*o,t[6]=c,t[7]=u,t[8]=h,t},F.scale=function(t,e,r){var i=r[0],n=r[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},F.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},F.fromRotation=function(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=-r,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},F.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},F.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},F.fromQuat=function(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],a=r+r,s=i+i,l=n+n,c=r*a,u=i*a,h=i*s,A=n*a,p=n*s,d=n*l,f=o*a,m=o*s,g=o*l;return t[0]=1-h-d,t[3]=u-g,t[6]=A+m,t[1]=u+g,t[4]=1-c-d,t[7]=p-f,t[2]=A-m,t[5]=p+f,t[8]=1-c-h,t},F.normalFromMat4=function(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],a=e[4],s=e[5],l=e[6],c=e[7],u=e[8],h=e[9],A=e[10],p=e[11],d=e[12],f=e[13],m=e[14],g=e[15],_=r*s-i*a,y=r*l-n*a,v=r*c-o*a,x=i*l-n*s,w=i*c-o*s,b=n*c-o*l,B=u*f-h*d,C=u*m-A*d,E=u*g-p*d,T=h*m-A*f,I=h*g-p*f,S=A*g-p*m,M=_*S-y*I+v*T+x*E-w*C+b*B;return M?(t[0]=(s*S-l*I+c*T)*(M=1/M),t[1]=(l*E-a*S-c*C)*M,t[2]=(a*I-s*E+c*B)*M,t[3]=(n*I-i*S-o*T)*M,t[4]=(r*S-n*E+o*C)*M,t[5]=(i*E-r*I-o*B)*M,t[6]=(f*b-m*w+g*x)*M,t[7]=(m*v-d*b-g*y)*M,t[8]=(d*w-f*v+g*_)*M,t):null},F.projection=function(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},F.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},F.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},F.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t},F.subtract=k,F.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t},F.multiplyScalarAndAdd=function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t},F.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},F.equals=function(t,e){var r=t[0],i=t[1],n=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8],h=e[0],A=e[1],p=e[2],d=e[3],f=e[4],m=e[5],g=e[6],_=e[7],y=e[8];return Math.abs(r-h)<=L.EPSILON*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(i-A)<=L.EPSILON*Math.max(1,Math.abs(i),Math.abs(A))&&Math.abs(n-p)<=L.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(o-d)<=L.EPSILON*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(a-f)<=L.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(s-m)<=L.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(l-g)<=L.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(c-_)<=L.EPSILON*Math.max(1,Math.abs(c),Math.abs(_))&&Math.abs(u-y)<=L.EPSILON*Math.max(1,Math.abs(u),Math.abs(y))},F.sub=F.mul=void 0;var L=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==P(t)&&"function"!=typeof t)return{default:t};var e=D(void 0);if(e&&e.has(t))return e.get(t);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if("default"!==n&&Object.prototype.hasOwnProperty.call(t,n)){var o=i?Object.getOwnPropertyDescriptor(t,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=t[n]}return r.default=t,e&&e.set(t,r),r}(d);function D(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,r=new WeakMap;return(D=function(t){return t?r:e})(t)}function U(t,e,r){var i=e[0],n=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=e[6],u=e[7],h=e[8],A=r[0],p=r[1],d=r[2],f=r[3],m=r[4],g=r[5],_=r[6],y=r[7],v=r[8];return t[0]=A*i+p*a+d*c,t[1]=A*n+p*s+d*u,t[2]=A*o+p*l+d*h,t[3]=f*i+m*a+g*c,t[4]=f*n+m*s+g*u,t[5]=f*o+m*l+g*h,t[6]=_*i+y*a+v*c,t[7]=_*n+y*s+v*u,t[8]=_*o+y*l+v*h,t}function k(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}F.mul=U,F.sub=k;var z={};function R(t){return R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},R(t)}Object.defineProperty(z,"__esModule",{value:!0}),z.create=function(){var t=new O.ARRAY_TYPE(16);return O.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},z.clone=function(t){var e=new O.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},z.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},z.fromValues=function(t,e,r,i,n,o,a,s,l,c,u,h,A,p,d,f){var m=new O.ARRAY_TYPE(16);return m[0]=t,m[1]=e,m[2]=r,m[3]=i,m[4]=n,m[5]=o,m[6]=a,m[7]=s,m[8]=l,m[9]=c,m[10]=u,m[11]=h,m[12]=A,m[13]=p,m[14]=d,m[15]=f,m},z.set=function(t,e,r,i,n,o,a,s,l,c,u,h,A,p,d,f,m){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=o,t[5]=a,t[6]=s,t[7]=l,t[8]=c,t[9]=u,t[10]=h,t[11]=A,t[12]=p,t[13]=d,t[14]=f,t[15]=m,t},z.identity=N,z.transpose=function(t,e){if(t===e){var r=e[1],i=e[2],n=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=o,t[11]=e[14],t[12]=n,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},z.invert=function(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],a=e[4],s=e[5],l=e[6],c=e[7],u=e[8],h=e[9],A=e[10],p=e[11],d=e[12],f=e[13],m=e[14],g=e[15],_=r*s-i*a,y=r*l-n*a,v=r*c-o*a,x=i*l-n*s,w=i*c-o*s,b=n*c-o*l,B=u*f-h*d,C=u*m-A*d,E=u*g-p*d,T=h*m-A*f,I=h*g-p*f,S=A*g-p*m,M=_*S-y*I+v*T+x*E-w*C+b*B;return M?(t[0]=(s*S-l*I+c*T)*(M=1/M),t[1]=(n*I-i*S-o*T)*M,t[2]=(f*b-m*w+g*x)*M,t[3]=(A*w-h*b-p*x)*M,t[4]=(l*E-a*S-c*C)*M,t[5]=(r*S-n*E+o*C)*M,t[6]=(m*v-d*b-g*y)*M,t[7]=(u*b-A*v+p*y)*M,t[8]=(a*I-s*E+c*B)*M,t[9]=(i*E-r*I-o*B)*M,t[10]=(d*w-f*v+g*_)*M,t[11]=(h*v-u*w-p*_)*M,t[12]=(s*C-a*T-l*B)*M,t[13]=(r*T-i*C+n*B)*M,t[14]=(f*y-d*x-m*_)*M,t[15]=(u*x-h*y+A*_)*M,t):null},z.adjoint=function(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],a=e[4],s=e[5],l=e[6],c=e[7],u=e[8],h=e[9],A=e[10],p=e[11],d=e[12],f=e[13],m=e[14],g=e[15];return t[0]=s*(A*g-p*m)-h*(l*g-c*m)+f*(l*p-c*A),t[1]=-(i*(A*g-p*m)-h*(n*g-o*m)+f*(n*p-o*A)),t[2]=i*(l*g-c*m)-s*(n*g-o*m)+f*(n*c-o*l),t[3]=-(i*(l*p-c*A)-s*(n*p-o*A)+h*(n*c-o*l)),t[4]=-(a*(A*g-p*m)-u*(l*g-c*m)+d*(l*p-c*A)),t[5]=r*(A*g-p*m)-u*(n*g-o*m)+d*(n*p-o*A),t[6]=-(r*(l*g-c*m)-a*(n*g-o*m)+d*(n*c-o*l)),t[7]=r*(l*p-c*A)-a*(n*p-o*A)+u*(n*c-o*l),t[8]=a*(h*g-p*f)-u*(s*g-c*f)+d*(s*p-c*h),t[9]=-(r*(h*g-p*f)-u*(i*g-o*f)+d*(i*p-o*h)),t[10]=r*(s*g-c*f)-a*(i*g-o*f)+d*(i*c-o*s),t[11]=-(r*(s*p-c*h)-a*(i*p-o*h)+u*(i*c-o*s)),t[12]=-(a*(h*m-A*f)-u*(s*m-l*f)+d*(s*A-l*h)),t[13]=r*(h*m-A*f)-u*(i*m-n*f)+d*(i*A-n*h),t[14]=-(r*(s*m-l*f)-a*(i*m-n*f)+d*(i*l-n*s)),t[15]=r*(s*A-l*h)-a*(i*A-n*h)+u*(i*l-n*s),t},z.determinant=function(t){var e=t[0],r=t[1],i=t[2],n=t[3],o=t[4],a=t[5],s=t[6],l=t[7],c=t[8],u=t[9],h=t[10],A=t[11],p=t[12],d=t[13],f=t[14],m=t[15];return(e*a-r*o)*(h*m-A*f)-(e*s-i*o)*(u*m-A*d)+(e*l-n*o)*(u*f-h*d)+(r*s-i*a)*(c*m-A*p)-(r*l-n*a)*(c*f-h*p)+(i*l-n*s)*(c*d-u*p)},z.multiply=V,z.translate=function(t,e,r){var i,n,o,a,s,l,c,u,h,A,p,d,f=r[0],m=r[1],g=r[2];return e===t?(t[12]=e[0]*f+e[4]*m+e[8]*g+e[12],t[13]=e[1]*f+e[5]*m+e[9]*g+e[13],t[14]=e[2]*f+e[6]*m+e[10]*g+e[14],t[15]=e[3]*f+e[7]*m+e[11]*g+e[15]):(n=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=e[6],u=e[7],h=e[8],A=e[9],p=e[10],d=e[11],t[0]=i=e[0],t[1]=n,t[2]=o,t[3]=a,t[4]=s,t[5]=l,t[6]=c,t[7]=u,t[8]=h,t[9]=A,t[10]=p,t[11]=d,t[12]=i*f+s*m+h*g+e[12],t[13]=n*f+l*m+A*g+e[13],t[14]=o*f+c*m+p*g+e[14],t[15]=a*f+u*m+d*g+e[15]),t},z.scale=function(t,e,r){var i=r[0],n=r[1],o=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},z.rotate=function(t,e,r,i){var n,o,a,s,l,c,u,h,A,p,d,f,m,g,_,y,v,x,w,b,B,C,E,T,I=i[0],S=i[1],M=i[2],F=Math.hypot(I,S,M);return F<O.EPSILON?null:(I*=F=1/F,S*=F,M*=F,n=Math.sin(r),o=Math.cos(r),l=e[1],c=e[2],u=e[3],A=e[5],p=e[6],d=e[7],m=e[9],g=e[10],_=e[11],y=I*I*(a=1-o)+o,w=I*S*a-M*n,b=S*S*a+o,B=M*S*a+I*n,C=I*M*a+S*n,E=S*M*a-I*n,T=M*M*a+o,t[0]=(s=e[0])*y+(h=e[4])*(v=S*I*a+M*n)+(f=e[8])*(x=M*I*a-S*n),t[1]=l*y+A*v+m*x,t[2]=c*y+p*v+g*x,t[3]=u*y+d*v+_*x,t[4]=s*w+h*b+f*B,t[5]=l*w+A*b+m*B,t[6]=c*w+p*b+g*B,t[7]=u*w+d*b+_*B,t[8]=s*C+h*E+f*T,t[9]=l*C+A*E+m*T,t[10]=c*C+p*E+g*T,t[11]=u*C+d*E+_*T,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},z.rotateX=function(t,e,r){var i=Math.sin(r),n=Math.cos(r),o=e[4],a=e[5],s=e[6],l=e[7],c=e[8],u=e[9],h=e[10],A=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*n+c*i,t[5]=a*n+u*i,t[6]=s*n+h*i,t[7]=l*n+A*i,t[8]=c*n-o*i,t[9]=u*n-a*i,t[10]=h*n-s*i,t[11]=A*n-l*i,t},z.rotateY=function(t,e,r){var i=Math.sin(r),n=Math.cos(r),o=e[0],a=e[1],s=e[2],l=e[3],c=e[8],u=e[9],h=e[10],A=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*n-c*i,t[1]=a*n-u*i,t[2]=s*n-h*i,t[3]=l*n-A*i,t[8]=o*i+c*n,t[9]=a*i+u*n,t[10]=s*i+h*n,t[11]=l*i+A*n,t},z.rotateZ=function(t,e,r){var i=Math.sin(r),n=Math.cos(r),o=e[0],a=e[1],s=e[2],l=e[3],c=e[4],u=e[5],h=e[6],A=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*n+c*i,t[1]=a*n+u*i,t[2]=s*n+h*i,t[3]=l*n+A*i,t[4]=c*n-o*i,t[5]=u*n-a*i,t[6]=h*n-s*i,t[7]=A*n-l*i,t},z.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},z.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},z.fromRotation=function(t,e,r){var i,n,o,a=r[0],s=r[1],l=r[2],c=Math.hypot(a,s,l);return c<O.EPSILON?null:(a*=c=1/c,s*=c,l*=c,i=Math.sin(e),n=Math.cos(e),t[0]=a*a*(o=1-n)+n,t[1]=s*a*o+l*i,t[2]=l*a*o-s*i,t[3]=0,t[4]=a*s*o-l*i,t[5]=s*s*o+n,t[6]=l*s*o+a*i,t[7]=0,t[8]=a*l*o+s*i,t[9]=s*l*o-a*i,t[10]=l*l*o+n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},z.fromXRotation=function(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},z.fromYRotation=function(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},z.fromZRotation=function(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},z.fromRotationTranslation=H,z.fromQuat2=function(t,e){var r=new O.ARRAY_TYPE(3),i=-e[0],n=-e[1],o=-e[2],a=e[3],s=e[4],l=e[5],c=e[6],u=e[7],h=i*i+n*n+o*o+a*a;return h>0?(r[0]=2*(s*a+u*i+l*o-c*n)/h,r[1]=2*(l*a+u*n+c*i-s*o)/h,r[2]=2*(c*a+u*o+s*n-l*i)/h):(r[0]=2*(s*a+u*i+l*o-c*n),r[1]=2*(l*a+u*n+c*i-s*o),r[2]=2*(c*a+u*o+s*n-l*i)),H(t,e,r),t},z.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},z.getScaling=j,z.getRotation=function(t,e){var r=new O.ARRAY_TYPE(3);j(r,e);var i=1/r[0],n=1/r[1],o=1/r[2],a=e[0]*i,s=e[1]*n,l=e[2]*o,c=e[4]*i,u=e[5]*n,h=e[6]*o,A=e[8]*i,p=e[9]*n,d=e[10]*o,f=a+u+d,m=0;return f>0?(m=2*Math.sqrt(f+1),t[3]=.25*m,t[0]=(h-p)/m,t[1]=(A-l)/m,t[2]=(s-c)/m):a>u&&a>d?(m=2*Math.sqrt(1+a-u-d),t[3]=(h-p)/m,t[0]=.25*m,t[1]=(s+c)/m,t[2]=(A+l)/m):u>d?(m=2*Math.sqrt(1+u-a-d),t[3]=(A-l)/m,t[0]=(s+c)/m,t[1]=.25*m,t[2]=(h+p)/m):(m=2*Math.sqrt(1+d-a-u),t[3]=(s-c)/m,t[0]=(A+l)/m,t[1]=(h+p)/m,t[2]=.25*m),t},z.fromRotationTranslationScale=function(t,e,r,i){var n=e[0],o=e[1],a=e[2],s=e[3],l=n+n,c=o+o,u=a+a,h=n*l,A=n*c,p=n*u,d=o*c,f=o*u,m=a*u,g=s*l,_=s*c,y=s*u,v=i[0],x=i[1],w=i[2];return t[0]=(1-(d+m))*v,t[1]=(A+y)*v,t[2]=(p-_)*v,t[3]=0,t[4]=(A-y)*x,t[5]=(1-(h+m))*x,t[6]=(f+g)*x,t[7]=0,t[8]=(p+_)*w,t[9]=(f-g)*w,t[10]=(1-(h+d))*w,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},z.fromRotationTranslationScaleOrigin=function(t,e,r,i,n){var o=e[0],a=e[1],s=e[2],l=e[3],c=o+o,u=a+a,h=s+s,A=o*c,p=o*u,d=o*h,f=a*u,m=a*h,g=s*h,_=l*c,y=l*u,v=l*h,x=i[0],w=i[1],b=i[2],B=n[0],C=n[1],E=n[2],T=(1-(f+g))*x,I=(p+v)*x,S=(d-y)*x,M=(p-v)*w,F=(1-(A+g))*w,P=(m+_)*w,L=(d+y)*b,D=(m-_)*b,U=(1-(A+f))*b;return t[0]=T,t[1]=I,t[2]=S,t[3]=0,t[4]=M,t[5]=F,t[6]=P,t[7]=0,t[8]=L,t[9]=D,t[10]=U,t[11]=0,t[12]=r[0]+B-(T*B+M*C+L*E),t[13]=r[1]+C-(I*B+F*C+D*E),t[14]=r[2]+E-(S*B+P*C+U*E),t[15]=1,t},z.fromQuat=function(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],a=r+r,s=i+i,l=n+n,c=r*a,u=i*a,h=i*s,A=n*a,p=n*s,d=n*l,f=o*a,m=o*s,g=o*l;return t[0]=1-h-d,t[1]=u+g,t[2]=A-m,t[3]=0,t[4]=u-g,t[5]=1-c-d,t[6]=p+f,t[7]=0,t[8]=A+m,t[9]=p-f,t[10]=1-c-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},z.frustum=function(t,e,r,i,n,o,a){var s=1/(r-e),l=1/(n-i),c=1/(o-a);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*l,t[6]=0,t[7]=0,t[8]=(r+e)*s,t[9]=(n+i)*l,t[10]=(a+o)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*c,t[15]=0,t},z.perspectiveNO=G,z.perspectiveZO=function(t,e,r,i,n){var o,a=1/Math.tan(e/2);return t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(t[10]=n*(o=1/(i-n)),t[14]=n*i*o):(t[10]=-1,t[14]=-i),t},z.perspectiveFromFieldOfView=function(t,e,r,i){var n=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),l=2/(a+s),c=2/(n+o);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(a-s)*l*.5,t[9]=(n-o)*c*.5,t[10]=i/(r-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*r/(r-i),t[15]=0,t},z.orthoNO=K,z.orthoZO=function(t,e,r,i,n,o,a){var s=1/(e-r),l=1/(i-n),c=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=c,t[11]=0,t[12]=(e+r)*s,t[13]=(n+i)*l,t[14]=o*c,t[15]=1,t},z.lookAt=function(t,e,r,i){var n,o,a,s,l,c,u,h,A,p,d=e[0],f=e[1],m=e[2],g=i[0],_=i[1],y=i[2],v=r[0],x=r[1],w=r[2];return Math.abs(d-v)<O.EPSILON&&Math.abs(f-x)<O.EPSILON&&Math.abs(m-w)<O.EPSILON?N(t):(u=d-v,h=f-x,A=m-w,n=_*(A*=p=1/Math.hypot(u,h,A))-y*(h*=p),o=y*(u*=p)-g*A,a=g*h-_*u,(p=Math.hypot(n,o,a))?(n*=p=1/p,o*=p,a*=p):(n=0,o=0,a=0),s=h*a-A*o,l=A*n-u*a,c=u*o-h*n,(p=Math.hypot(s,l,c))?(s*=p=1/p,l*=p,c*=p):(s=0,l=0,c=0),t[0]=n,t[1]=s,t[2]=u,t[3]=0,t[4]=o,t[5]=l,t[6]=h,t[7]=0,t[8]=a,t[9]=c,t[10]=A,t[11]=0,t[12]=-(n*d+o*f+a*m),t[13]=-(s*d+l*f+c*m),t[14]=-(u*d+h*f+A*m),t[15]=1,t)},z.targetTo=function(t,e,r,i){var n=e[0],o=e[1],a=e[2],s=i[0],l=i[1],c=i[2],u=n-r[0],h=o-r[1],A=a-r[2],p=u*u+h*h+A*A;p>0&&(u*=p=1/Math.sqrt(p),h*=p,A*=p);var d=l*A-c*h,f=c*u-s*A,m=s*h-l*u;return(p=d*d+f*f+m*m)>0&&(d*=p=1/Math.sqrt(p),f*=p,m*=p),t[0]=d,t[1]=f,t[2]=m,t[3]=0,t[4]=h*m-A*f,t[5]=A*d-u*m,t[6]=u*f-h*d,t[7]=0,t[8]=u,t[9]=h,t[10]=A,t[11]=0,t[12]=n,t[13]=o,t[14]=a,t[15]=1,t},z.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},z.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},z.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t},z.subtract=q,z.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t},z.multiplyScalarAndAdd=function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t[9]=e[9]+r[9]*i,t[10]=e[10]+r[10]*i,t[11]=e[11]+r[11]*i,t[12]=e[12]+r[12]*i,t[13]=e[13]+r[13]*i,t[14]=e[14]+r[14]*i,t[15]=e[15]+r[15]*i,t},z.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},z.equals=function(t,e){var r=t[0],i=t[1],n=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8],h=t[9],A=t[10],p=t[11],d=t[12],f=t[13],m=t[14],g=t[15],_=e[0],y=e[1],v=e[2],x=e[3],w=e[4],b=e[5],B=e[6],C=e[7],E=e[8],T=e[9],I=e[10],S=e[11],M=e[12],F=e[13],P=e[14],L=e[15];return Math.abs(r-_)<=O.EPSILON*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(i-y)<=O.EPSILON*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(n-v)<=O.EPSILON*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(o-x)<=O.EPSILON*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(a-w)<=O.EPSILON*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(s-b)<=O.EPSILON*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(l-B)<=O.EPSILON*Math.max(1,Math.abs(l),Math.abs(B))&&Math.abs(c-C)<=O.EPSILON*Math.max(1,Math.abs(c),Math.abs(C))&&Math.abs(u-E)<=O.EPSILON*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(h-T)<=O.EPSILON*Math.max(1,Math.abs(h),Math.abs(T))&&Math.abs(A-I)<=O.EPSILON*Math.max(1,Math.abs(A),Math.abs(I))&&Math.abs(p-S)<=O.EPSILON*Math.max(1,Math.abs(p),Math.abs(S))&&Math.abs(d-M)<=O.EPSILON*Math.max(1,Math.abs(d),Math.abs(M))&&Math.abs(f-F)<=O.EPSILON*Math.max(1,Math.abs(f),Math.abs(F))&&Math.abs(m-P)<=O.EPSILON*Math.max(1,Math.abs(m),Math.abs(P))&&Math.abs(g-L)<=O.EPSILON*Math.max(1,Math.abs(g),Math.abs(L))},z.sub=z.mul=z.ortho=z.perspective=void 0;var O=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==R(t)&&"function"!=typeof t)return{default:t};var e=Q(void 0);if(e&&e.has(t))return e.get(t);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if("default"!==n&&Object.prototype.hasOwnProperty.call(t,n)){var o=i?Object.getOwnPropertyDescriptor(t,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=t[n]}return r.default=t,e&&e.set(t,r),r}(d);function Q(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,r=new WeakMap;return(Q=function(t){return t?r:e})(t)}function N(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function V(t,e,r){var i=e[0],n=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=e[6],u=e[7],h=e[8],A=e[9],p=e[10],d=e[11],f=e[12],m=e[13],g=e[14],_=e[15],y=r[0],v=r[1],x=r[2],w=r[3];return t[0]=y*i+v*s+x*h+w*f,t[1]=y*n+v*l+x*A+w*m,t[2]=y*o+v*c+x*p+w*g,t[3]=y*a+v*u+x*d+w*_,t[4]=(y=r[4])*i+(v=r[5])*s+(x=r[6])*h+(w=r[7])*f,t[5]=y*n+v*l+x*A+w*m,t[6]=y*o+v*c+x*p+w*g,t[7]=y*a+v*u+x*d+w*_,t[8]=(y=r[8])*i+(v=r[9])*s+(x=r[10])*h+(w=r[11])*f,t[9]=y*n+v*l+x*A+w*m,t[10]=y*o+v*c+x*p+w*g,t[11]=y*a+v*u+x*d+w*_,t[12]=(y=r[12])*i+(v=r[13])*s+(x=r[14])*h+(w=r[15])*f,t[13]=y*n+v*l+x*A+w*m,t[14]=y*o+v*c+x*p+w*g,t[15]=y*a+v*u+x*d+w*_,t}function H(t,e,r){var i=e[0],n=e[1],o=e[2],a=e[3],s=i+i,l=n+n,c=o+o,u=i*s,h=i*l,A=i*c,p=n*l,d=n*c,f=o*c,m=a*s,g=a*l,_=a*c;return t[0]=1-(p+f),t[1]=h+_,t[2]=A-g,t[3]=0,t[4]=h-_,t[5]=1-(u+f),t[6]=d+m,t[7]=0,t[8]=A+g,t[9]=d-m,t[10]=1-(u+p),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function j(t,e){var r=e[4],i=e[5],n=e[6],o=e[8],a=e[9],s=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(r,i,n),t[2]=Math.hypot(o,a,s),t}function G(t,e,r,i,n){var o,a=1/Math.tan(e/2);return t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(t[10]=(n+i)*(o=1/(i-n)),t[14]=2*n*i*o):(t[10]=-1,t[14]=-2*i),t}function K(t,e,r,i,n,o,a){var s=1/(e-r),l=1/(i-n),c=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+r)*s,t[13]=(n+i)*l,t[14]=(a+o)*c,t[15]=1,t}function q(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}z.perspective=G,z.ortho=K,z.mul=V,z.sub=q;var Z={},W={};function X(t){return X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},X(t)}Object.defineProperty(W,"__esModule",{value:!0}),W.create=J,W.clone=function(t){var e=new $.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},W.length=tt,W.fromValues=function(t,e,r){var i=new $.ARRAY_TYPE(3);return i[0]=t,i[1]=e,i[2]=r,i},W.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},W.set=function(t,e,r,i){return t[0]=e,t[1]=r,t[2]=i,t},W.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t},W.subtract=et,W.multiply=rt,W.divide=it,W.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},W.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},W.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t},W.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t},W.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},W.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},W.scaleAndAdd=function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t},W.distance=nt,W.squaredDistance=ot,W.squaredLength=at,W.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},W.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},W.normalize=function(t,e){var r=e[0],i=e[1],n=e[2],o=r*r+i*i+n*n;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t},W.dot=st,W.cross=function(t,e,r){var i=e[0],n=e[1],o=e[2],a=r[0],s=r[1],l=r[2];return t[0]=n*l-o*s,t[1]=o*a-i*l,t[2]=i*s-n*a,t},W.lerp=function(t,e,r,i){var n=e[0],o=e[1],a=e[2];return t[0]=n+i*(r[0]-n),t[1]=o+i*(r[1]-o),t[2]=a+i*(r[2]-a),t},W.hermite=function(t,e,r,i,n,o){var a=o*o,s=a*(2*o-3)+1,l=a*(o-2)+o,c=a*(o-1),u=a*(3-2*o);return t[0]=e[0]*s+r[0]*l+i[0]*c+n[0]*u,t[1]=e[1]*s+r[1]*l+i[1]*c+n[1]*u,t[2]=e[2]*s+r[2]*l+i[2]*c+n[2]*u,t},W.bezier=function(t,e,r,i,n,o){var a=1-o,s=a*a,l=o*o,c=s*a,u=3*o*s,h=3*l*a,A=l*o;return t[0]=e[0]*c+r[0]*u+i[0]*h+n[0]*A,t[1]=e[1]*c+r[1]*u+i[1]*h+n[1]*A,t[2]=e[2]*c+r[2]*u+i[2]*h+n[2]*A,t},W.random=function(t,e){e=e||1;var r=2*$.RANDOM()*Math.PI,i=2*$.RANDOM()-1,n=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(r)*n,t[1]=Math.sin(r)*n,t[2]=i*e,t},W.transformMat4=function(t,e,r){var i=e[0],n=e[1],o=e[2],a=r[3]*i+r[7]*n+r[11]*o+r[15];return t[0]=(r[0]*i+r[4]*n+r[8]*o+r[12])/(a=a||1),t[1]=(r[1]*i+r[5]*n+r[9]*o+r[13])/a,t[2]=(r[2]*i+r[6]*n+r[10]*o+r[14])/a,t},W.transformMat3=function(t,e,r){var i=e[0],n=e[1],o=e[2];return t[0]=i*r[0]+n*r[3]+o*r[6],t[1]=i*r[1]+n*r[4]+o*r[7],t[2]=i*r[2]+n*r[5]+o*r[8],t},W.transformQuat=function(t,e,r){var i=r[0],n=r[1],o=r[2],a=e[0],s=e[1],l=e[2],c=n*l-o*s,u=o*a-i*l,h=i*s-n*a,A=n*h-o*u,p=o*c-i*h,d=i*u-n*c,f=2*r[3];return u*=f,h*=f,p*=2,d*=2,t[0]=a+(c*=f)+(A*=2),t[1]=s+u+p,t[2]=l+h+d,t},W.rotateX=function(t,e,r,i){var n=[],o=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],o[0]=n[0],o[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),o[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t},W.rotateY=function(t,e,r,i){var n=[],o=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],o[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),o[1]=n[1],o[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t},W.rotateZ=function(t,e,r,i){var n=[],o=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],o[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),o[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),o[2]=n[2],t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t},W.angle=function(t,e){var r=t[0],i=t[1],n=t[2],o=e[0],a=e[1],s=e[2],l=Math.sqrt(r*r+i*i+n*n)*Math.sqrt(o*o+a*a+s*s),c=l&&st(t,e)/l;return Math.acos(Math.min(Math.max(c,-1),1))},W.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},W.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},W.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},W.equals=function(t,e){var r=t[0],i=t[1],n=t[2],o=e[0],a=e[1],s=e[2];return Math.abs(r-o)<=$.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=$.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-s)<=$.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))},W.forEach=W.sqrLen=W.len=W.sqrDist=W.dist=W.div=W.mul=W.sub=void 0;var $=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==X(t)&&"function"!=typeof t)return{default:t};var e=Y(void 0);if(e&&e.has(t))return e.get(t);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if("default"!==n&&Object.prototype.hasOwnProperty.call(t,n)){var o=i?Object.getOwnPropertyDescriptor(t,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=t[n]}return r.default=t,e&&e.set(t,r),r}(d);function Y(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,r=new WeakMap;return(Y=function(t){return t?r:e})(t)}function J(){var t=new $.ARRAY_TYPE(3);return $.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function tt(t){return Math.hypot(t[0],t[1],t[2])}function et(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function rt(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function it(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function nt(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function ot(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return r*r+i*i+n*n}function at(t){var e=t[0],r=t[1],i=t[2];return e*e+r*r+i*i}function st(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}W.sub=et,W.mul=rt,W.div=it,W.dist=nt,W.sqrDist=ot,W.len=tt,W.sqrLen=at;var lt,ct=(lt=J(),function(t,e,r,i,n,o){var a,s;for(e||(e=3),r||(r=0),s=i?Math.min(i*e+r,t.length):t.length,a=r;a<s;a+=e)lt[0]=t[a],lt[1]=t[a+1],lt[2]=t[a+2],n(lt,lt,o),t[a]=lt[0],t[a+1]=lt[1],t[a+2]=lt[2];return t});W.forEach=ct;var ut={};function ht(t){return ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ht(t)}Object.defineProperty(ut,"__esModule",{value:!0}),ut.create=dt,ut.clone=function(t){var e=new At.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},ut.fromValues=function(t,e,r,i){var n=new At.ARRAY_TYPE(4);return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n},ut.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},ut.set=function(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t},ut.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},ut.subtract=ft,ut.multiply=mt,ut.divide=gt,ut.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},ut.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},ut.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t},ut.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t},ut.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},ut.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},ut.scaleAndAdd=function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t},ut.distance=_t,ut.squaredDistance=yt,ut.length=vt,ut.squaredLength=xt,ut.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},ut.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},ut.normalize=function(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],a=r*r+i*i+n*n+o*o;return a>0&&(a=1/Math.sqrt(a)),t[0]=r*a,t[1]=i*a,t[2]=n*a,t[3]=o*a,t},ut.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},ut.cross=function(t,e,r,i){var n=r[0]*i[1]-r[1]*i[0],o=r[0]*i[2]-r[2]*i[0],a=r[0]*i[3]-r[3]*i[0],s=r[1]*i[2]-r[2]*i[1],l=r[1]*i[3]-r[3]*i[1],c=r[2]*i[3]-r[3]*i[2],u=e[0],h=e[1],A=e[2],p=e[3];return t[0]=h*c-A*l+p*s,t[1]=-u*c+A*a-p*o,t[2]=u*l-h*a+p*n,t[3]=-u*s+h*o-A*n,t},ut.lerp=function(t,e,r,i){var n=e[0],o=e[1],a=e[2],s=e[3];return t[0]=n+i*(r[0]-n),t[1]=o+i*(r[1]-o),t[2]=a+i*(r[2]-a),t[3]=s+i*(r[3]-s),t},ut.random=function(t,e){var r,i,n,o,a,s;e=e||1;do{a=(r=2*At.RANDOM()-1)*r+(i=2*At.RANDOM()-1)*i}while(a>=1);do{s=(n=2*At.RANDOM()-1)*n+(o=2*At.RANDOM()-1)*o}while(s>=1);var l=Math.sqrt((1-a)/s);return t[0]=e*r,t[1]=e*i,t[2]=e*n*l,t[3]=e*o*l,t},ut.transformMat4=function(t,e,r){var i=e[0],n=e[1],o=e[2],a=e[3];return t[0]=r[0]*i+r[4]*n+r[8]*o+r[12]*a,t[1]=r[1]*i+r[5]*n+r[9]*o+r[13]*a,t[2]=r[2]*i+r[6]*n+r[10]*o+r[14]*a,t[3]=r[3]*i+r[7]*n+r[11]*o+r[15]*a,t},ut.transformQuat=function(t,e,r){var i=e[0],n=e[1],o=e[2],a=r[0],s=r[1],l=r[2],c=r[3],u=c*i+s*o-l*n,h=c*n+l*i-a*o,A=c*o+a*n-s*i,p=-a*i-s*n-l*o;return t[0]=u*c+p*-a+h*-l-A*-s,t[1]=h*c+p*-s+A*-a-u*-l,t[2]=A*c+p*-l+u*-s-h*-a,t[3]=e[3],t},ut.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},ut.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},ut.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},ut.equals=function(t,e){var r=t[0],i=t[1],n=t[2],o=t[3],a=e[0],s=e[1],l=e[2],c=e[3];return Math.abs(r-a)<=At.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=At.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-l)<=At.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(o-c)<=At.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))},ut.forEach=ut.sqrLen=ut.len=ut.sqrDist=ut.dist=ut.div=ut.mul=ut.sub=void 0;var At=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==ht(t)&&"function"!=typeof t)return{default:t};var e=pt(void 0);if(e&&e.has(t))return e.get(t);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if("default"!==n&&Object.prototype.hasOwnProperty.call(t,n)){var o=i?Object.getOwnPropertyDescriptor(t,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=t[n]}return r.default=t,e&&e.set(t,r),r}(d);function pt(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,r=new WeakMap;return(pt=function(t){return t?r:e})(t)}function dt(){var t=new At.ARRAY_TYPE(4);return At.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function ft(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function mt(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function gt(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function _t(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function yt(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],o=e[3]-t[3];return r*r+i*i+n*n+o*o}function vt(t){return Math.hypot(t[0],t[1],t[2],t[3])}function xt(t){var e=t[0],r=t[1],i=t[2],n=t[3];return e*e+r*r+i*i+n*n}ut.sub=ft,ut.mul=mt,ut.div=gt,ut.dist=_t,ut.sqrDist=yt,ut.len=vt,ut.sqrLen=xt;var wt=function(){var t=dt();return function(e,r,i,n,o,a){var s,l;for(r||(r=4),i||(i=0),l=n?Math.min(n*r+i,e.length):e.length,s=i;s<l;s+=r)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],o(t,t,a),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}();function bt(t){return bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bt(t)}ut.forEach=wt,Object.defineProperty(Z,"__esModule",{value:!0}),Z.create=Mt,Z.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},Z.setAxisAngle=Ft,Z.getAxisAngle=function(t,e){var r=2*Math.acos(e[3]),i=Math.sin(r/2);return i>Bt.EPSILON?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),r},Z.getAngle=function(t,e){var r=Rt(t,e);return Math.acos(2*r*r-1)},Z.multiply=Pt,Z.rotateX=function(t,e,r){r*=.5;var i=e[0],n=e[1],o=e[2],a=e[3],s=Math.sin(r),l=Math.cos(r);return t[0]=i*l+a*s,t[1]=n*l+o*s,t[2]=o*l-n*s,t[3]=a*l-i*s,t},Z.rotateY=function(t,e,r){r*=.5;var i=e[0],n=e[1],o=e[2],a=e[3],s=Math.sin(r),l=Math.cos(r);return t[0]=i*l-o*s,t[1]=n*l+a*s,t[2]=o*l+i*s,t[3]=a*l-n*s,t},Z.rotateZ=function(t,e,r){r*=.5;var i=e[0],n=e[1],o=e[2],a=e[3],s=Math.sin(r),l=Math.cos(r);return t[0]=i*l+n*s,t[1]=n*l-i*s,t[2]=o*l+a*s,t[3]=a*l-o*s,t},Z.calculateW=function(t,e){var r=e[0],i=e[1],n=e[2];return t[0]=r,t[1]=i,t[2]=n,t[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),t},Z.exp=Lt,Z.ln=Dt,Z.pow=function(t,e,r){return Dt(t,e),zt(t,t,r),Lt(t,t),t},Z.slerp=Ut,Z.random=function(t){var e=Bt.RANDOM(),r=Bt.RANDOM(),i=Bt.RANDOM(),n=Math.sqrt(1-e),o=Math.sqrt(e);return t[0]=n*Math.sin(2*Math.PI*r),t[1]=n*Math.cos(2*Math.PI*r),t[2]=o*Math.sin(2*Math.PI*i),t[3]=o*Math.cos(2*Math.PI*i),t},Z.invert=function(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],a=r*r+i*i+n*n+o*o,s=a?1/a:0;return t[0]=-r*s,t[1]=-i*s,t[2]=-n*s,t[3]=o*s,t},Z.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},Z.fromMat3=kt,Z.fromEuler=function(t,e,r,i){var n=.5*Math.PI/180;e*=n,r*=n,i*=n;var o=Math.sin(e),a=Math.cos(e),s=Math.sin(r),l=Math.cos(r),c=Math.sin(i),u=Math.cos(i);return t[0]=o*l*u-a*s*c,t[1]=a*s*u+o*l*c,t[2]=a*l*c-o*s*u,t[3]=a*l*u+o*s*c,t},Z.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Z.setAxes=Z.sqlerp=Z.rotationTo=Z.equals=Z.exactEquals=Z.normalize=Z.sqrLen=Z.squaredLength=Z.len=Z.length=Z.lerp=Z.dot=Z.scale=Z.mul=Z.add=Z.set=Z.copy=Z.fromValues=Z.clone=void 0;var Bt=St(d),Ct=St(F),Et=St(W),Tt=St(ut);function It(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,r=new WeakMap;return(It=function(t){return t?r:e})(t)}function St(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==bt(t)&&"function"!=typeof t)return{default:t};var r=It(e);if(r&&r.has(t))return r.get(t);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var a=n?Object.getOwnPropertyDescriptor(t,o):null;a&&(a.get||a.set)?Object.defineProperty(i,o,a):i[o]=t[o]}return i.default=t,r&&r.set(t,i),i}function Mt(){var t=new Bt.ARRAY_TYPE(4);return Bt.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Ft(t,e,r){r*=.5;var i=Math.sin(r);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(r),t}function Pt(t,e,r){var i=e[0],n=e[1],o=e[2],a=e[3],s=r[0],l=r[1],c=r[2],u=r[3];return t[0]=i*u+a*s+n*c-o*l,t[1]=n*u+a*l+o*s-i*c,t[2]=o*u+a*c+i*l-n*s,t[3]=a*u-i*s-n*l-o*c,t}function Lt(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],a=Math.sqrt(r*r+i*i+n*n),s=Math.exp(o),l=a>0?s*Math.sin(a)/a:0;return t[0]=r*l,t[1]=i*l,t[2]=n*l,t[3]=s*Math.cos(a),t}function Dt(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],a=Math.sqrt(r*r+i*i+n*n),s=a>0?Math.atan2(a,o)/a:0;return t[0]=r*s,t[1]=i*s,t[2]=n*s,t[3]=.5*Math.log(r*r+i*i+n*n+o*o),t}function Ut(t,e,r,i){var n,o,a,s,l,c=e[0],u=e[1],h=e[2],A=e[3],p=r[0],d=r[1],f=r[2],m=r[3];return(o=c*p+u*d+h*f+A*m)<0&&(o=-o,p=-p,d=-d,f=-f,m=-m),1-o>Bt.EPSILON?(n=Math.acos(o),a=Math.sin(n),s=Math.sin((1-i)*n)/a,l=Math.sin(i*n)/a):(s=1-i,l=i),t[0]=s*c+l*p,t[1]=s*u+l*d,t[2]=s*h+l*f,t[3]=s*A+l*m,t}function kt(t,e){var r,i=e[0]+e[4]+e[8];if(i>0)r=Math.sqrt(i+1),t[3]=.5*r,t[0]=(e[5]-e[7])*(r=.5/r),t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);var o=(n+1)%3,a=(n+2)%3;r=Math.sqrt(e[3*n+n]-e[3*o+o]-e[3*a+a]+1),t[n]=.5*r,t[3]=(e[3*o+a]-e[3*a+o])*(r=.5/r),t[o]=(e[3*o+n]+e[3*n+o])*r,t[a]=(e[3*a+n]+e[3*n+a])*r}return t}Z.clone=Tt.clone,Z.fromValues=Tt.fromValues,Z.copy=Tt.copy,Z.set=Tt.set,Z.add=Tt.add,Z.mul=Pt;var zt=Tt.scale;Z.scale=zt;var Rt=Tt.dot;Z.dot=Rt,Z.lerp=Tt.lerp;var Ot=Tt.length;Z.length=Ot,Z.len=Ot;var Qt=Tt.squaredLength;Z.squaredLength=Qt,Z.sqrLen=Qt;var Nt=Tt.normalize;Z.normalize=Nt,Z.exactEquals=Tt.exactEquals,Z.equals=Tt.equals;var Vt,Ht,jt,Gt=(Vt=Et.create(),Ht=Et.fromValues(1,0,0),jt=Et.fromValues(0,1,0),function(t,e,r){var i=Et.dot(e,r);return i<-.999999?(Et.cross(Vt,Ht,e),Et.len(Vt)<1e-6&&Et.cross(Vt,jt,e),Et.normalize(Vt,Vt),Ft(t,Vt,Math.PI),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Et.cross(Vt,e,r),t[0]=Vt[0],t[1]=Vt[1],t[2]=Vt[2],t[3]=1+i,Nt(t,t))});Z.rotationTo=Gt;var Kt,qt,Zt=(Kt=Mt(),qt=Mt(),function(t,e,r,i,n,o){return Ut(Kt,e,n,o),Ut(qt,r,i,o),Ut(t,Kt,qt,2*o*(1-o)),t});Z.sqlerp=Zt;var Wt,Xt=(Wt=Ct.create(),function(t,e,r,i){return Wt[0]=r[0],Wt[3]=r[1],Wt[6]=r[2],Wt[1]=i[0],Wt[4]=i[1],Wt[7]=i[2],Wt[2]=-e[0],Wt[5]=-e[1],Wt[8]=-e[2],Nt(t,kt(t,Wt))});Z.setAxes=Xt;var $t={};function Yt(t){return Yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yt(t)}Object.defineProperty($t,"__esModule",{value:!0}),$t.create=function(){var t=new Jt.ARRAY_TYPE(8);return Jt.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},$t.clone=function(t){var e=new Jt.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},$t.fromValues=function(t,e,r,i,n,o,a,s){var l=new Jt.ARRAY_TYPE(8);return l[0]=t,l[1]=e,l[2]=r,l[3]=i,l[4]=n,l[5]=o,l[6]=a,l[7]=s,l},$t.fromRotationTranslationValues=function(t,e,r,i,n,o,a){var s=new Jt.ARRAY_TYPE(8);s[0]=t,s[1]=e,s[2]=r,s[3]=i;var l=.5*n,c=.5*o,u=.5*a;return s[4]=l*i+c*r-u*e,s[5]=c*i+u*t-l*r,s[6]=u*i+l*e-c*t,s[7]=-l*t-c*e-u*r,s},$t.fromRotationTranslation=ne,$t.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},$t.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},$t.fromMat4=function(t,e){var r=te.create();ee.getRotation(r,e);var i=new Jt.ARRAY_TYPE(3);return ee.getTranslation(i,e),ne(t,r,i),t},$t.copy=oe,$t.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},$t.set=function(t,e,r,i,n,o,a,s,l){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=o,t[5]=a,t[6]=s,t[7]=l,t},$t.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},$t.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},$t.getTranslation=function(t,e){var r=e[4],i=e[5],n=e[6],o=e[7],a=-e[0],s=-e[1],l=-e[2],c=e[3];return t[0]=2*(r*c+o*a+i*l-n*s),t[1]=2*(i*c+o*s+n*a-r*l),t[2]=2*(n*c+o*l+r*s-i*a),t},$t.translate=function(t,e,r){var i=e[0],n=e[1],o=e[2],a=e[3],s=.5*r[0],l=.5*r[1],c=.5*r[2],u=e[4],h=e[5],A=e[6],p=e[7];return t[0]=i,t[1]=n,t[2]=o,t[3]=a,t[4]=a*s+n*c-o*l+u,t[5]=a*l+o*s-i*c+h,t[6]=a*c+i*l-n*s+A,t[7]=-i*s-n*l-o*c+p,t},$t.rotateX=function(t,e,r){var i=-e[0],n=-e[1],o=-e[2],a=e[3],s=e[4],l=e[5],c=e[6],u=e[7],h=s*a+u*i+l*o-c*n,A=l*a+u*n+c*i-s*o,p=c*a+u*o+s*n-l*i,d=u*a-s*i-l*n-c*o;return te.rotateX(t,e,r),t[4]=h*(a=t[3])+d*(i=t[0])+A*(o=t[2])-p*(n=t[1]),t[5]=A*a+d*n+p*i-h*o,t[6]=p*a+d*o+h*n-A*i,t[7]=d*a-h*i-A*n-p*o,t},$t.rotateY=function(t,e,r){var i=-e[0],n=-e[1],o=-e[2],a=e[3],s=e[4],l=e[5],c=e[6],u=e[7],h=s*a+u*i+l*o-c*n,A=l*a+u*n+c*i-s*o,p=c*a+u*o+s*n-l*i,d=u*a-s*i-l*n-c*o;return te.rotateY(t,e,r),t[4]=h*(a=t[3])+d*(i=t[0])+A*(o=t[2])-p*(n=t[1]),t[5]=A*a+d*n+p*i-h*o,t[6]=p*a+d*o+h*n-A*i,t[7]=d*a-h*i-A*n-p*o,t},$t.rotateZ=function(t,e,r){var i=-e[0],n=-e[1],o=-e[2],a=e[3],s=e[4],l=e[5],c=e[6],u=e[7],h=s*a+u*i+l*o-c*n,A=l*a+u*n+c*i-s*o,p=c*a+u*o+s*n-l*i,d=u*a-s*i-l*n-c*o;return te.rotateZ(t,e,r),t[4]=h*(a=t[3])+d*(i=t[0])+A*(o=t[2])-p*(n=t[1]),t[5]=A*a+d*n+p*i-h*o,t[6]=p*a+d*o+h*n-A*i,t[7]=d*a-h*i-A*n-p*o,t},$t.rotateByQuatAppend=function(t,e,r){var i=r[0],n=r[1],o=r[2],a=r[3],s=e[0],l=e[1],c=e[2],u=e[3];return t[0]=s*a+u*i+l*o-c*n,t[1]=l*a+u*n+c*i-s*o,t[2]=c*a+u*o+s*n-l*i,t[3]=u*a-s*i-l*n-c*o,t[4]=(s=e[4])*a+(u=e[7])*i+(l=e[5])*o-(c=e[6])*n,t[5]=l*a+u*n+c*i-s*o,t[6]=c*a+u*o+s*n-l*i,t[7]=u*a-s*i-l*n-c*o,t},$t.rotateByQuatPrepend=function(t,e,r){var i=e[0],n=e[1],o=e[2],a=e[3],s=r[0],l=r[1],c=r[2],u=r[3];return t[0]=i*u+a*s+n*c-o*l,t[1]=n*u+a*l+o*s-i*c,t[2]=o*u+a*c+i*l-n*s,t[3]=a*u-i*s-n*l-o*c,t[4]=i*(u=r[7])+a*(s=r[4])+n*(c=r[6])-o*(l=r[5]),t[5]=n*u+a*l+o*s-i*c,t[6]=o*u+a*c+i*l-n*s,t[7]=a*u-i*s-n*l-o*c,t},$t.rotateAroundAxis=function(t,e,r,i){if(Math.abs(i)<Jt.EPSILON)return oe(t,e);var n=Math.hypot(r[0],r[1],r[2]);i*=.5;var o=Math.sin(i),a=o*r[0]/n,s=o*r[1]/n,l=o*r[2]/n,c=Math.cos(i),u=e[0],h=e[1],A=e[2],p=e[3];t[0]=u*c+p*a+h*l-A*s,t[1]=h*c+p*s+A*a-u*l,t[2]=A*c+p*l+u*s-h*a,t[3]=p*c-u*a-h*s-A*l;var d=e[4],f=e[5],m=e[6],g=e[7];return t[4]=d*c+g*a+f*l-m*s,t[5]=f*c+g*s+m*a-d*l,t[6]=m*c+g*l+d*s-f*a,t[7]=g*c-d*a-f*s-m*l,t},$t.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t},$t.multiply=ae,$t.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t},$t.lerp=function(t,e,r,i){var n=1-i;return se(e,r)<0&&(i=-i),t[0]=e[0]*n+r[0]*i,t[1]=e[1]*n+r[1]*i,t[2]=e[2]*n+r[2]*i,t[3]=e[3]*n+r[3]*i,t[4]=e[4]*n+r[4]*i,t[5]=e[5]*n+r[5]*i,t[6]=e[6]*n+r[6]*i,t[7]=e[7]*n+r[7]*i,t},$t.invert=function(t,e){var r=ce(e);return t[0]=-e[0]/r,t[1]=-e[1]/r,t[2]=-e[2]/r,t[3]=e[3]/r,t[4]=-e[4]/r,t[5]=-e[5]/r,t[6]=-e[6]/r,t[7]=e[7]/r,t},$t.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},$t.normalize=function(t,e){var r=ce(e);if(r>0){r=Math.sqrt(r);var i=e[0]/r,n=e[1]/r,o=e[2]/r,a=e[3]/r,s=e[4],l=e[5],c=e[6],u=e[7],h=i*s+n*l+o*c+a*u;t[0]=i,t[1]=n,t[2]=o,t[3]=a,t[4]=(s-i*h)/r,t[5]=(l-n*h)/r,t[6]=(c-o*h)/r,t[7]=(u-a*h)/r}return t},$t.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},$t.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},$t.equals=function(t,e){var r=t[0],i=t[1],n=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=e[0],h=e[1],A=e[2],p=e[3],d=e[4],f=e[5],m=e[6],g=e[7];return Math.abs(r-u)<=Jt.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(i-h)<=Jt.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(n-A)<=Jt.EPSILON*Math.max(1,Math.abs(n),Math.abs(A))&&Math.abs(o-p)<=Jt.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(a-d)<=Jt.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(s-f)<=Jt.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(l-m)<=Jt.EPSILON*Math.max(1,Math.abs(l),Math.abs(m))&&Math.abs(c-g)<=Jt.EPSILON*Math.max(1,Math.abs(c),Math.abs(g))},$t.sqrLen=$t.squaredLength=$t.len=$t.length=$t.dot=$t.mul=$t.setReal=$t.getReal=void 0;var Jt=ie(d),te=ie(Z),ee=ie(z);function re(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,r=new WeakMap;return(re=function(t){return t?r:e})(t)}function ie(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==Yt(t)&&"function"!=typeof t)return{default:t};var r=re(e);if(r&&r.has(t))return r.get(t);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var a=n?Object.getOwnPropertyDescriptor(t,o):null;a&&(a.get||a.set)?Object.defineProperty(i,o,a):i[o]=t[o]}return i.default=t,r&&r.set(t,i),i}function ne(t,e,r){var i=.5*r[0],n=.5*r[1],o=.5*r[2],a=e[0],s=e[1],l=e[2],c=e[3];return t[0]=a,t[1]=s,t[2]=l,t[3]=c,t[4]=i*c+n*l-o*s,t[5]=n*c+o*a-i*l,t[6]=o*c+i*s-n*a,t[7]=-i*a-n*s-o*l,t}function oe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function ae(t,e,r){var i=e[0],n=e[1],o=e[2],a=e[3],s=r[4],l=r[5],c=r[6],u=r[7],h=e[4],A=e[5],p=e[6],d=e[7],f=r[0],m=r[1],g=r[2],_=r[3];return t[0]=i*_+a*f+n*g-o*m,t[1]=n*_+a*m+o*f-i*g,t[2]=o*_+a*g+i*m-n*f,t[3]=a*_-i*f-n*m-o*g,t[4]=i*u+a*s+n*c-o*l+h*_+d*f+A*g-p*m,t[5]=n*u+a*l+o*s-i*c+A*_+d*m+p*f-h*g,t[6]=o*u+a*c+i*l-n*s+p*_+d*g+h*m-A*f,t[7]=a*u-i*s-n*l-o*c+d*_-h*f-A*m-p*g,t}$t.getReal=te.copy,$t.setReal=te.copy,$t.mul=ae;var se=te.dot;$t.dot=se;var le=te.length;$t.length=le,$t.len=le;var ce=te.squaredLength;$t.squaredLength=ce,$t.sqrLen=ce;var ue={};function he(t){return he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},he(t)}Object.defineProperty(ue,"__esModule",{value:!0}),ue.create=de,ue.clone=function(t){var e=new Ae.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},ue.fromValues=function(t,e){var r=new Ae.ARRAY_TYPE(2);return r[0]=t,r[1]=e,r},ue.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},ue.set=function(t,e,r){return t[0]=e,t[1]=r,t},ue.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t},ue.subtract=fe,ue.multiply=me,ue.divide=ge,ue.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},ue.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},ue.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t},ue.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t},ue.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},ue.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t},ue.scaleAndAdd=function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t},ue.distance=_e,ue.squaredDistance=ye,ue.length=ve,ue.squaredLength=xe,ue.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},ue.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},ue.normalize=function(t,e){var r=e[0],i=e[1],n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t},ue.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},ue.cross=function(t,e,r){var i=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=i,t},ue.lerp=function(t,e,r,i){var n=e[0],o=e[1];return t[0]=n+i*(r[0]-n),t[1]=o+i*(r[1]-o),t},ue.random=function(t,e){e=e||1;var r=2*Ae.RANDOM()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t},ue.transformMat2=function(t,e,r){var i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n,t[1]=r[1]*i+r[3]*n,t},ue.transformMat2d=function(t,e,r){var i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n+r[4],t[1]=r[1]*i+r[3]*n+r[5],t},ue.transformMat3=function(t,e,r){var i=e[0],n=e[1];return t[0]=r[0]*i+r[3]*n+r[6],t[1]=r[1]*i+r[4]*n+r[7],t},ue.transformMat4=function(t,e,r){var i=e[0],n=e[1];return t[0]=r[0]*i+r[4]*n+r[12],t[1]=r[1]*i+r[5]*n+r[13],t},ue.rotate=function(t,e,r,i){var n=e[0]-r[0],o=e[1]-r[1],a=Math.sin(i),s=Math.cos(i);return t[0]=n*s-o*a+r[0],t[1]=n*a+o*s+r[1],t},ue.angle=function(t,e){var r=t[0],i=t[1],n=e[0],o=e[1],a=Math.sqrt(r*r+i*i)*Math.sqrt(n*n+o*o);return Math.acos(Math.min(Math.max(a&&(r*n+i*o)/a,-1),1))},ue.zero=function(t){return t[0]=0,t[1]=0,t},ue.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},ue.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},ue.equals=function(t,e){var r=t[0],i=t[1],n=e[0],o=e[1];return Math.abs(r-n)<=Ae.EPSILON*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-o)<=Ae.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))},ue.forEach=ue.sqrLen=ue.sqrDist=ue.dist=ue.div=ue.mul=ue.sub=ue.len=void 0;var Ae=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==he(t)&&"function"!=typeof t)return{default:t};var e=pe(void 0);if(e&&e.has(t))return e.get(t);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if("default"!==n&&Object.prototype.hasOwnProperty.call(t,n)){var o=i?Object.getOwnPropertyDescriptor(t,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=t[n]}return r.default=t,e&&e.set(t,r),r}(d);function pe(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,r=new WeakMap;return(pe=function(t){return t?r:e})(t)}function de(){var t=new Ae.ARRAY_TYPE(2);return Ae.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function fe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function me(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function ge(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function _e(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function ye(t,e){var r=e[0]-t[0],i=e[1]-t[1];return r*r+i*i}function ve(t){return Math.hypot(t[0],t[1])}function xe(t){var e=t[0],r=t[1];return e*e+r*r}ue.len=ve,ue.sub=fe,ue.mul=me,ue.div=ge,ue.dist=_e,ue.sqrDist=ye,ue.sqrLen=xe;var we=function(){var t=de();return function(e,r,i,n,o,a){var s,l;for(r||(r=2),i||(i=0),l=n?Math.min(n*r+i,e.length):e.length,s=i;s<l;s+=r)t[0]=e[s],t[1]=e[s+1],o(t,t,a),e[s]=t[0],e[s+1]=t[1];return e}}();function be(t){return be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},be(t)}ue.forEach=we,Object.defineProperty(p,"__esModule",{value:!0}),t.aA=p.vec4=t._=p.vec3=p.vec2=p.quat2=t.av=p.quat=t.ad=p.mat4=t.bC=p.mat3=p.mat2d=t.aC=p.mat2=p.glMatrix=void 0;var Be=Ue(d);p.glMatrix=Be;var Ce=Ue(y);t.aC=p.mat2=Ce;var Ee=Ue(C);p.mat2d=Ee;var Te=Ue(F);t.bC=p.mat3=Te;var Ie=Ue(z);t.ad=p.mat4=Ie;var Se=Ue(Z);t.av=p.quat=Se;var Me=Ue($t);p.quat2=Me;var Fe=Ue(ue);p.vec2=Fe;var Pe=Ue(W);t._=p.vec3=Pe;var Le=Ue(ut);function De(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,r=new WeakMap;return(De=function(t){return t?r:e})(t)}function Ue(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==be(t)&&"function"!=typeof t)return{default:t};var r=De(e);if(r&&r.has(t))return r.get(t);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var a=n?Object.getOwnPropertyDescriptor(t,o):null;a&&(a.get||a.set)?Object.defineProperty(i,o,a):i[o]=t[o]}return i.default=t,r&&r.set(t,i),i}t.aA=p.vec4=Le;var ke=ze;function ze(t,e,r,i){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(i-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=r,this.p2y=i}ze.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var r=t,i=0;i<8;i++){var n=this.sampleCurveX(r)-t;if(Math.abs(n)<e)return r;var o=this.sampleCurveDerivativeX(r);if(Math.abs(o)<1e-6)break;r-=n/o}var a=0,s=1;for(r=t,i=0;i<20&&(n=this.sampleCurveX(r),!(Math.abs(n-t)<e));i++)t>n?a=r:s=r,r=.5*(s-a)+a;return r},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var Re=A(ke),Oe=Qe;function Qe(t,e){this.x=t,this.y=e}Qe.prototype={clone:function(){return new Qe(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),i=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=i,this},_rotateAround:function(t,e){var r=Math.cos(t),i=Math.sin(t),n=e.y+i*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-i*(this.y-e.y),this.y=n,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Qe.convert=function(t){return t instanceof Qe?t:Array.isArray(t)?new Qe(t[0],t[1]):t};var Ne=A(Oe);const Ve=Math.PI/180,He=180/Math.PI;function je(t){return t*Ve}function Ge(t){return t*He}const Ke=[[0,0],[1,0],[1,1],[0,1]];function qe(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,r=e*t;return 4*(t<.5?r:3*(t-e)+r-.75)}function Ze(t,e,r,i){const n=new Re(t,e,r,i);return function(t){return n.solve(t)}}const We=Ze(.25,.1,.25,1);function Xe(t,e,r){return Math.min(r,Math.max(e,t))}function $e(t,e,r){return(r=Xe((r-t)/(e-t),0,1))*r*(3-2*r)}function Ye(t,e,r){const i=r-e,n=((t-e)%i+i)%i+e;return n===e?r:n}function Je(t,e,r){if(!t.length)return r(null,[]);let i=t.length;const n=new Array(t.length);let o=null;t.forEach(((t,a)=>{e(t,((t,e)=>{t&&(o=t),n[a]=e,0==--i&&r(o,n)}))}))}function tr(t){const e=[];for(const r in t)e.push(t[r]);return e}function er(t,...e){for(const r of e)for(const e in r)t[e]=r[e];return t}let rr=1;function ir(){return rr++}function nr(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function or(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function ar(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function sr(t,e){t.forEach((t=>{e[t]&&(e[t]=e[t].bind(e))}))}function lr(t,e){return-1!==t.indexOf(e,t.length-e.length)}function cr(t,e,r){const i={};for(const r in t)i[r]=e.call(this,t[r],r,t);return i}function ur(t,e,r){const i={};for(const r in t)e.call(this,t[r],r,t)&&(i[r]=t[r]);return i}function hr(t){return Array.isArray(t)?t.map(hr):"object"==typeof t&&t?cr(t,hr):t}const Ar={};function pr(t){Ar[t]||("undefined"!=typeof console&&console.warn(t),Ar[t]=!0)}function dr(t,e,r){return(r.y-t.y)*(e.x-t.x)>(e.y-t.y)*(r.x-t.x)}function fr(t){let e=0;for(let r,i,n=0,o=t.length,a=o-1;n<o;a=n++)r=t[n],i=t[a],e+=(i.x-r.x)*(r.y+i.y);return e}function mr([t,e,r]){const i=je(e+90),n=je(r);return{x:t*Math.cos(i)*Math.sin(n),y:t*Math.sin(i)*Math.sin(n),z:t*Math.cos(n),azimuthal:e,polar:r}}function gr(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function _r(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((t,r,i,n)=>{const o=i||n;return e[r]=!o||o.toLowerCase(),""})),e["max-age"]){const t=parseInt(e["max-age"],10);isNaN(t)?delete e["max-age"]:e["max-age"]=t}return e}let yr,vr,xr,wr,br,Br,Cr=null;function Er(t){try{const e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(t){return!1}}function Tr(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function Ir(t,e,r,i){for(;e<r;){const n=e+r>>1;t[n]<i?e=n+1:r=n}return e}function Sr(t,e,r,i){for(;e<r;){const n=e+r>>1;t[n]<=i?e=n+1:r=n}return e}function Mr(t){return t>0?1/(1.001-t):1+t}function Fr(t){return t>0?1-1/(1.001-t):-t}function Pr(){return null==yr&&(yr=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof self.createImageBitmap),yr}const Lr={now:()=>void 0!==wr?wr:performance.now(),setNow(t){wr=t},restoreNow(){wr=void 0},frame(t){const e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:r,height:i}=t;br||(br=document.createElement("canvas"));const n=br.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return(r>br.width||i>br.height)&&(br.width=r,br.height=i),n.clearRect(-e,-e,r+2*e,i+2*e),n.drawImage(t,0,0,r,i),n.getImageData(-e,-e,r+2*e,i+2*e)},resolveURL:t=>(vr||(vr=document.createElement("a")),vr.href=t,vr.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(null==xr&&(xr=window.matchMedia("(prefers-reduced-motion: reduce)")),xr.matches)},hasCanvasFingerprintNoise(){if(void 0!==Br)return Br;if(!Pr())return Br=!1,!1;const t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0});let r=0;for(let i=0;i<t.width;++i)e.fillStyle=`rgba(${r++},${r++},${r++}, 255)`,e.fillRect(i,0,1,1);const i=e.getImageData(0,0,t.width,t.height);r=0;for(let t=0;t<i.data.length;++t)if(t%4!=3&&r++!==i.data[t])return Br=!0,!0;return Br=!1,!1}};function Dr(t,e){const r=t.indexOf("?");if(r<0)return`${t}?${new URLSearchParams(e).toString()}`;const i=new URLSearchParams(t.slice(r));for(const t in e)i.set(t,e[t]);return`${t.slice(0,r)}?${i.toString()}`}function Ur(t,e={persistentParams:[]}){const r=t.indexOf("?");if(r<0)return t;const i=new URLSearchParams,n=new URLSearchParams(t.slice(r));for(const t of e.persistentParams){const e=n.get(t);e&&i.set(t,e)}const o=i.toString();return`${t.slice(0,r)}${o.length>0?`?${o}`:""}`}const kr="mapbox-tiles";let zr,Rr,Or=500,Qr=50;function Nr(){try{return caches}catch(t){}}function Vr(){const t=Nr();t&&!zr&&(zr=t.open(kr))}let Hr=1/0;const jr={supported:!1,testSupport:function(t){!qr&&Kr&&(Zr?Xr(t):Gr=t)}};let Gr,Kr,qr=!1,Zr=!1;const Wr="undefined"!=typeof self?self:{};function Xr(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Kr),t.isContextLost())return;jr.supported=!0}catch(t){}t.deleteTexture(e),qr=!0}Wr.document&&(Kr=Wr.document.createElement("img"),Kr.onload=function(){Gr&&Xr(Gr),Gr=null,Zr=!0},Kr.onerror=function(){qr=!0,Gr=null},Kr.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const $r={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze($r);class Yr extends Error{constructor(t,e,r){401===e&&n(r)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=e,this.url=r}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Jr=gr()?()=>self.worker&&self.worker.referrer:()=>("blob:"===location.protocol?parent:self).location.href,ti=function(t,e){if(!(/^file:/.test(r=t.url)||/^file:/.test(Jr())&&!/^\w+:/.test(r))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(t,e){const r=new AbortController,i=new Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:Jr(),referrerPolicy:t.referrerPolicy,signal:r.signal});let o=!1,a=!1;const s=(l=i.url).indexOf("sku=")>0&&n(l);var l;"json"===t.type&&i.headers.set("Accept","application/json");const c=(r,n,o)=>{if(a)return;if(r&&"SecurityError"!==r.message&&pr(r.toString()),n&&o)return u(n);const l=Date.now();fetch(i).then((r=>{if(r.ok){const t=s?r.clone():null;return u(r,t,l)}return e(new Yr(r.statusText,r.status,t.url))})).catch((r=>{"AbortError"!==r.name&&e(new Error(`${r.message} ${t.url}`))}))},u=(r,n,s)=>{("arrayBuffer"===t.type?r.arrayBuffer():"json"===t.type?r.json():r.text()).then((t=>{a||(n&&s&&function(t,e,r){if(Vr(),!zr)return;const i=_r(e.headers.get("Cache-Control")||"");if(i["no-store"])return;const n={status:e.status,statusText:e.statusText,headers:new Headers};e.headers.forEach(((t,e)=>n.headers.set(e,t))),i["max-age"]&&n.headers.set("Expires",new Date(r+1e3*i["max-age"]).toUTCString());const o=n.headers.get("Expires");if(!o)return;if(new Date(o).getTime()-r<42e4)return;let a=Ur(t.url,{persistentParams:["language","worldview"]});if(206===e.status){const e=t.headers.get("Range");if(!e)return;n.status=200,a=Dr(a,{range:e})}!function(t,e){if(void 0===Rr)try{new Response(new ReadableStream),Rr=!0}catch(t){Rr=!1}Rr?e(t.body):t.blob().then(e)}(e,(t=>{const r=new Response(200!==(i=e.status)&&404!==i&&[101,103,204,205,304].includes(i)?null:t,n);var i;Vr(),zr&&zr.then((t=>t.put(a,r))).catch((t=>pr(t.message)))}))}(i,n,s),o=!0,e(null,t,r.headers.get("Cache-Control"),r.headers.get("Expires")))})).catch((t=>{a||e(new Error(t.message))}))};return s?function(t,e){if(Vr(),!zr)return e(null);zr.then((r=>{let i=Ur(t.url,{persistentParams:["language","worldview"]});const n=t.headers.get("Range");n&&(i=Dr(i,{range:n})),r.match(i).then((t=>{const n=function(t){if(!t)return!1;const e=new Date(t.headers.get("Expires")||0),r=_r(t.headers.get("Cache-Control")||"");return e>Date.now()&&!r["no-cache"]}(t);r.delete(i),n&&r.put(i,t.clone()),e(null,t,n)})).catch(e)})).catch(e)}(i,c):c(null,null),{cancel:()=>{a=!0,o||r.abort()}}}(t,e);if(gr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var r;return function(t,e){const r=new XMLHttpRequest;r.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(r.responseType="arraybuffer");for(const e in t.headers)r.setRequestHeader(e,t.headers[e]);return"json"===t.type&&(r.responseType="text",r.setRequestHeader("Accept","application/json")),r.withCredentials="include"===t.credentials,r.onerror=()=>{e(new Error(r.statusText))},r.onload=()=>{if((r.status>=200&&r.status<300||0===r.status)&&null!==r.response){let i=r.response;if("json"===t.type)try{i=JSON.parse(r.response)}catch(t){return e(t)}e(null,i,r.getResponseHeader("Cache-Control"),r.getResponseHeader("Expires"))}else e(new Yr(r.statusText,r.status,t.url))},r.send(t.body),{cancel:()=>r.abort()}}(t,e)},ei=function(t,e){return ti(er(t,{type:"arrayBuffer"}),e)};function ri(t){const e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}const ii="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ni,oi;ni=[],oi=0;const ai=function(t,e){if(jr.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),oi>=i.MAX_PARALLEL_IMAGE_REQUESTS){const r={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return ni.push(r),r}oi++;let r=!1;const n=()=>{if(!r)for(r=!0,oi--;ni.length&&oi<i.MAX_PARALLEL_IMAGE_REQUESTS;){const t=ni.shift(),{requestParameters:e,callback:r,cancelled:i}=t;i||(t.cancel=ai(e,r).cancel)}},o=ei(t,((t,r,i,o)=>{n(),t?e(t):r&&(self.createImageBitmap?function(t,e){const r=new Blob([new Uint8Array(t)],{type:"image/png"});createImageBitmap(r).then((t=>{e(null,t)})).catch((t=>{e(new Error(`Could not load image because of ${t.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))}(r,((t,r)=>e(t,r,i,o))):function(t,e){const r=new Image;r.onload=()=>{e(null,r),URL.revokeObjectURL(r.src),r.onload=null,requestAnimationFrame((()=>{r.src=ii}))},r.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const i=new Blob([new Uint8Array(t)],{type:"image/png"});r.src=t.byteLength?URL.createObjectURL(i):ii}(r,((t,r)=>e(t,r,i,o))))}));return{cancel:()=>{o.cancel(),n()}}},si="01",li="NO_ACCESS_TOKEN",ci=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ui(t){const e=t.match(ci);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function hi(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}const Ai="mapbox.eventData";function pi(t){if(!t)return null;const e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map((t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2))).join("")))}catch(t){return null}}class di{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const e=pi(i.ACCESS_TOKEN);let r="";return r=e&&e.u?btoa(encodeURIComponent(e.u).replace(/%([0-9A-F]{2})/g,((t,e)=>String.fromCharCode(Number("0x"+e))))):i.ACCESS_TOKEN||"",t?`${Ai}.${t}:${r}`:`${Ai}:${r}`}fetchEventData(){const t=Er("localStorage"),e=this.getStorageKey(),r=this.getStorageKey("uuid");if(t)try{const t=localStorage.getItem(e);t&&(this.eventData=JSON.parse(t));const i=localStorage.getItem(r);i&&(this.anonId=i)}catch(t){pr("Unable to read from LocalStorage")}}saveEventData(){const t=Er("localStorage"),e=this.getStorageKey(),r=this.getStorageKey("uuid"),i=this.anonId;if(t&&i)try{localStorage.setItem(r,i),Object.keys(this.eventData).length>=1&&localStorage.setItem(e,JSON.stringify(this.eventData))}catch(t){pr("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,e,r,n){if(!i.EVENTS_URL)return;const o=ui(i.EVENTS_URL);o.params.push(`access_token=${n||i.ACCESS_TOKEN||""}`);const a={event:this.type,created:new Date(t).toISOString()},s=e?er(a,e):a,l={url:hi(o),headers:{"Content-Type":"text/plain"},body:JSON.stringify([s])};this.pendingRequest=function(t,e){return ti(er(t,{method:"POST"}),e)}(l,(t=>{this.pendingRequest=null,r(t),this.saveEventData(),this.processRequests(n)}))}queueRequest(t,e){this.queue.push(t),this.processRequests(e)}}const fi=new class extends di{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){i.EVENTS_URL&&i.ACCESS_TOKEN&&Array.isArray(t)&&t.some((t=>o(t)||n(t)))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=pi(i.ACCESS_TOKEN),n=r?r.u:i.ACCESS_TOKEN;let o=n!==this.eventData.tokenU;ar(this.anonId)||(this.anonId=nr(),o=!0);const a=this.queue.shift();if(this.eventData.lastSuccess){const t=new Date(this.eventData.lastSuccess),e=new Date(a),r=(a-this.eventData.lastSuccess)/864e5;o=o||r>=1||r<-1||t.getDate()!==e.getDate()}else o=!0;o?this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:e,skuId:si,"enabled.telemetry":!1,userId:this.anonId},(t=>{t||(this.eventData.lastSuccess=a,this.eventData.tokenU=n)}),t):this.processRequests()}},mi=fi.postTurnstileEvent.bind(fi),gi=new class extends di{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,r,n){this.skuToken=e,this.errorCb=n,i.EVENTS_URL&&(r||i.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},r):this.errorCb(new Error(li)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:i}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),ar(this.anonId)||(this.anonId=nr()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:e,skuId:si,skuToken:this.skuToken,userId:this.anonId},(t=>{t?this.errorCb(t):r&&(this.success[r]=!0)}),t))}remove(){this.errorCb=null}},_i=gi.postMapLoadEvent.bind(gi),yi=new class extends di{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(t){let e=this.mapInstanceIdMap.get(t);return e||(e=nr(),this.mapInstanceIdMap.set(t,e)),e}getEventId(t){const e=this.eventIdPerMapInstanceMap.get(t)||0;return this.eventIdPerMapInstanceMap.set(t,e+1),e}postStyleLoadEvent(t,e){const{map:r,style:n,importedStyles:o}=e;if(!i.EVENTS_URL||!t&&!i.ACCESS_TOKEN)return;const a=this.getMapInstanceId(r),s={mapInstanceId:a,eventId:this.getEventId(a),style:n};o.length&&(s.importedStyles=o),this.queueRequest({timestamp:Date.now(),payload:s},t)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:e,payload:r}=this.queue.shift();this.postEvent(e,r,(()=>{}),t)}},vi=yi.postStyleLoadEvent.bind(yi),xi=new class extends di{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){i.EVENTS_URL&&(t||i.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:r,performanceData:i}=this.queue.shift(),n=function(t){const r=performance.getEntriesByType("resource"),i=performance.getEntriesByType("mark"),n=function(t){const e={};if(t)for(const r in t)if("other"!==r)for(const i of t[r]){const t=`${r}ResolveRangeMin`,n=`${r}ResolveRangeMax`,o=`${r}RequestCount`,a=`${r}RequestCachedCount`;e[t]=Math.min(e[t]||1/0,i.startTime),e[n]=Math.max(e[n]||-1/0,i.responseEnd);const s=t=>{void 0===e[t]&&(e[t]=0),++e[t]};void 0!==i.transferSize&&0===i.transferSize&&s(a),s(o)}return e}(function(t,e){const r={};if(t)for(const i of t){const t=e(i);void 0===r[t]&&(r[t]=[]),r[t].push(i)}return r}(r,h)),o=window.devicePixelRatio,a=navigator.connection||navigator.mozConnection||navigator.webkitConnection,s=a?a.effectiveType:void 0,u={counters:[],metadata:[],attributes:[]},A=(t,e,r)=>{null!=r&&t.push({name:e,value:r.toString()})};for(const t in n)A(u.counters,t,n[t]);if(t.interactionRange[0]!==1/0&&t.interactionRange[1]!==-1/0&&(A(u.counters,"interactionRangeMin",t.interactionRange[0]),A(u.counters,"interactionRangeMax",t.interactionRange[1])),i)for(const t of Object.keys(c)){const e=c[t],r=i.find((t=>t.name===e));r&&A(u.counters,e,r.startTime)}return A(u.counters,"visibilityHidden",t.visibilityHidden),A(u.attributes,"style",function(t){if(t)for(const e of t){const t=e.name.split("?")[0];if(l(t)){const e=t.split("/").slice(-2);if(2===e.length)return`mapbox://styles/${e[0]}/${e[1]}`}}}(r)),A(u.attributes,"terrainEnabled",t.terrainEnabled?"true":"false"),A(u.attributes,"fogEnabled",t.fogEnabled?"true":"false"),A(u.attributes,"projection",t.projection),A(u.attributes,"zoom",t.zoom),A(u.metadata,"devicePixelRatio",o),A(u.metadata,"connectionEffectiveType",s),A(u.metadata,"navigatorUserAgent",navigator.userAgent),A(u.metadata,"screenWidth",window.screen.width),A(u.metadata,"screenHeight",window.screen.height),A(u.metadata,"windowWidth",window.innerWidth),A(u.metadata,"windowHeight",window.innerHeight),A(u.metadata,"mapWidth",t.width/o),A(u.metadata,"mapHeight",t.height/o),A(u.metadata,"webglRenderer",t.renderer),A(u.metadata,"webglVendor",t.vendor),A(u.metadata,"sdkVersion",e),A(u.metadata,"sdkIdentifier","mapbox-gl-js"),u}(i);for(const t of n.metadata);for(const t of n.counters);for(const t of n.attributes);this.postEvent(r,n,(()=>{}),t)}},wi=xi.postPerformanceEvent.bind(xi),bi=new class extends di{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,r,n){if(!i.API_URL||!i.SESSION_PATH)return;const o=ui(i.API_URL+i.SESSION_PATH);o.params.push(`sku=${e||""}`),o.params.push(`access_token=${n||i.ACCESS_TOKEN||""}`);const a={url:hi(o),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(t,e){return ti(er(t,{method:"GET"}),e)}(a,(t=>{this.pendingRequest=null,r(t),this.saveEventData(),this.processRequests(n)}))}getSessionAPI(t,e,r,n){this.skuToken=e,this.errorCb=n,i.SESSION_PATH&&i.API_URL&&(r||i.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},r):this.errorCb(new Error(li)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||this.getSession(r,this.skuToken,(t=>{t?this.errorCb(t):e&&(this.success[e]=!0)}),t)}remove(){this.errorCb=null}},Bi=bi.getSessionAPI.bind(bi),Ci=new Set;var Ei={exports:{}},Ti={exports:function(t,e){var r,i,n,o,a,s,l,c;for(i=t.length-(r=3&t.length),n=e,a=3432918353,s=461845907,c=0;c<i;)l=255&t.charCodeAt(c)|(255&t.charCodeAt(++c))<<8|(255&t.charCodeAt(++c))<<16|(255&t.charCodeAt(++c))<<24,++c,n=27492+(65535&(o=5*(65535&(n=(n^=l=(65535&(l=(l=(65535&l)*a+(((l>>>16)*a&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<13|n>>>19))+((5*(n>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,r){case 3:l^=(255&t.charCodeAt(c+2))<<16;case 2:l^=(255&t.charCodeAt(c+1))<<8;case 1:n^=l=(65535&(l=(l=(65535&(l^=255&t.charCodeAt(c)))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295}return n^=t.length,n=2246822507*(65535&(n^=n>>>16))+((2246822507*(n>>>16)&65535)<<16)&4294967295,n=3266489909*(65535&(n^=n>>>13))+((3266489909*(n>>>16)&65535)<<16)&4294967295,(n^=n>>>16)>>>0}},Ii={exports:function(t,e){for(var r,i=t.length,n=e^i,o=0;i>=4;)r=1540483477*(65535&(r=255&t.charCodeAt(o)|(255&t.charCodeAt(++o))<<8|(255&t.charCodeAt(++o))<<16|(255&t.charCodeAt(++o))<<24))+((1540483477*(r>>>16)&65535)<<16),n=1540483477*(65535&n)+((1540483477*(n>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),i-=4,++o;switch(i){case 3:n^=(255&t.charCodeAt(o+2))<<16;case 2:n^=(255&t.charCodeAt(o+1))<<8;case 1:n=1540483477*(65535&(n^=255&t.charCodeAt(o)))+((1540483477*(n>>>16)&65535)<<16)}return n=1540483477*(65535&(n^=n>>>13))+((1540483477*(n>>>16)&65535)<<16),(n^=n>>>15)>>>0}},Si=Ti.exports,Mi=Ii.exports;Ei.exports=Si,Ei.exports.murmur3=Si,Ei.exports.murmur2=Mi;var Fi=A(Ei.exports);class Pi{constructor(t,...e){er(this,e[0]||{}),this.type=t}}class Li extends Pi{constructor(t,e={}){super("error",er({error:t},e))}}function Di(t,e,r){r[t]&&-1!==r[t].indexOf(e)||(r[t]=r[t]||[],r[t].push(e))}function Ui(t,e,r){if(r&&r[t]){const i=r[t].indexOf(e);-1!==i&&r[t].splice(i,1)}}class ki{on(t,e){return this._listeners=this._listeners||{},Di(t,e,this._listeners),this}off(t,e){return Ui(t,e,this._listeners),Ui(t,e,this._oneTimeListeners),this}once(t,e){return e?(this._oneTimeListeners=this._oneTimeListeners||{},Di(t,e,this._oneTimeListeners),this):new Promise((e=>this.once(t,e)))}fire(t,e){const r="string"==typeof t?new Pi(t,e):t,i=r.type;if(this.listens(i)){r.target=this;const t=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(const e of t)e.call(this,r);const e=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];for(const t of e)Ui(i,t,this._oneTimeListeners),t.call(this,r);const n=this._eventedParent;n&&(er(r,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),n.fire(r))}else r instanceof Li&&console.error(r.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,e){return this._eventedParent=t,this._eventedParentData=e,this}}t.F=void 0;var zi={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Ri(t){return(t=Math.round(t))<0?0:t>255?255:t}function Oi(t){return Ri("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function Qi(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function Ni(t,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?t+(e-t)*r*6:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}try{t.F={}.parseCSSColor=function(t){var e,r=t.replace(/ /g,"").toLowerCase();if(r in zi)return zi[r].slice();if("#"===r[0])return 4===r.length?(e=parseInt(r.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===r.length&&(e=parseInt(r.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var i=r.indexOf("("),n=r.indexOf(")");if(-1!==i&&n+1===r.length){var o=r.substr(0,i),a=r.substr(i+1,n-(i+1)).split(","),s=1;switch(o){case"rgba":if(4!==a.length)return null;s=Qi(a.pop());case"rgb":return 3!==a.length?null:[Oi(a[0]),Oi(a[1]),Oi(a[2]),s];case"hsla":if(4!==a.length)return null;s=Qi(a.pop());case"hsl":if(3!==a.length)return null;var l=(parseFloat(a[0])%360+360)%360/360,c=Qi(a[1]),u=Qi(a[2]),h=u<=.5?u*(c+1):u+c-u*c,A=2*u-h;return[Ri(255*Ni(A,h,l+1/3)),Ri(255*Ni(A,h,l)),Ri(255*Ni(A,h,l-1/3)),s];default:return null}}return null}}catch(t){}class Vi{constructor(t,e,r,i=1){this.r=t,this.g=e,this.b=r,this.a=i}static parse(e){if(!e)return;if(e instanceof Vi)return e;if("string"!=typeof e)return;const r=t.F(e);return r?new Vi(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[t,e,r,i]=0===this.a?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(t)},${Math.round(e)},${Math.round(r)},${i})`}toRenderColor(t){const{r:e,g:r,b:i,a:n}=this;return new Hi(t,e,r,i,n)}}class Hi{constructor(t,e,r,i,n){if(t){const o=t.image.height,a=o*o;e=0===n?0:e/n*(o-1),r=0===n?0:r/n*(o-1),i=0===n?0:i/n*(o-1);const s=Math.floor(e),l=Math.floor(r),c=Math.floor(i),u=Math.ceil(e),h=Math.ceil(r),A=Math.ceil(i),p=e-s,d=r-l,f=i-c,m=t.image.data,g=4*(s+l*a+c*o),_=4*(s+l*a+A*o),y=4*(s+h*a+c*o),v=4*(s+h*a+A*o),x=4*(u+l*a+c*o),w=4*(u+l*a+A*o),b=4*(u+h*a+c*o),B=4*(u+h*a+A*o);if(g<0||B>=m.length)throw new Error("out of range");this.r=ji(ji(ji(m[g],m[_],f),ji(m[y],m[v],f),d),ji(ji(m[x],m[w],f),ji(m[b],m[B],f),d),p)/255*n,this.g=ji(ji(ji(m[g+1],m[_+1],f),ji(m[y+1],m[v+1],f),d),ji(ji(m[x+1],m[w+1],f),ji(m[b+1],m[B+1],f),d),p)/255*n,this.b=ji(ji(ji(m[g+2],m[_+2],f),ji(m[y+2],m[v+2],f),d),ji(ji(m[x+2],m[w+2],f),ji(m[b+2],m[B+2],f),d),p)/255*n,this.a=n}else this.r=e,this.g=r,this.b=i,this.a=n}toArray(){const{r:t,g:e,b:r,a:i}=this;return 0===i?[0,0,0,0]:[255*t/i,255*e/i,255*r/i,i]}toArray01(){const{r:t,g:e,b:r,a:i}=this;return 0===i?[0,0,0,0]:[t/i,e/i,r/i,i]}toArray01Scaled(t){const{r:e,g:r,b:i,a:n}=this;return 0===n?[0,0,0]:[e/n*t,r/n*t,i/n*t]}toArray01PremultipliedAlpha(){const{r:t,g:e,b:r,a:i}=this;return[t,e,r,i]}toArray01Linear(){const{r:t,g:e,b:r,a:i}=this;return 0===i?[0,0,0,0]:[Math.pow(t/i,2.2),Math.pow(e/i,2.2),Math.pow(r/i,2.2),i]}}function ji(t,e,r){return t*(1-r)+e*r}function Gi(t,e,r){return t.map(((t,i)=>ji(t,e[i],r)))}Vi.black=new Vi(0,0,0,1),Vi.white=new Vi(1,1,1,1),Vi.transparent=new Vi(0,0,0,0),Vi.red=new Vi(1,0,0,1),Vi.blue=new Vi(0,0,1,1);var Ki=Object.freeze({__proto__:null,array:Gi,color:function(t,e,r){return new Vi(ji(t.r,e.r,r),ji(t.g,e.g,r),ji(t.b,e.b,r),ji(t.a,e.a,r))},number:ji});function qi(t,...e){for(const r of e)for(const e in r)t[e]=r[e];return t}class Zi extends Error{constructor(t,e){super(e),this.message=e,this.key=t}}class Wi{constructor(t,e=[]){this.parent=t,this.bindings={};for(const[t,r]of e)this.bindings[t]=r}concat(t){return new Wi(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Xi={kind:"null"},$i={kind:"number"},Yi={kind:"string"},Ji={kind:"boolean"},tn={kind:"color"},en={kind:"object"},rn={kind:"value"},nn={kind:"collator"},on={kind:"formatted"},an={kind:"resolvedImage"};function sn(t,e){return{kind:"array",itemType:t,N:e}}function ln(t){if("array"===t.kind){const e=ln(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const cn=[Xi,$i,Yi,Ji,tn,on,en,sn(rn),an];function un(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!un(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const t of cn)if(!un(t,e))return null}return`Expected ${ln(t)} but found ${ln(e)} instead.`}function hn(t,e){return e.some((e=>e.kind===t.kind))}function An(t,e){return e.some((e=>"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t))}class pn{constructor(t,e,r){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,e){return this.collator.compare(t,e)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class dn{constructor(t,e,r,i,n){this.text=t.normalize?t.normalize():t,this.image=e,this.scale=r,this.fontStack=i,this.textColor=n}}class fn{constructor(t){this.sections=t}static fromString(t){return new fn([new dn(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((t=>0!==t.text.length||t.image&&0!==t.image.namePrimary.length))}static factory(t){return t instanceof fn?t:fn.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map((t=>t.text)).join("")}serialize(){const t=["format"];for(const e of this.sections){if(e.image){t.push(["image",e.image.namePrimary]);continue}t.push(e.text);const r={};e.fontStack&&(r["text-font"]=["literal",e.fontStack.split(",")]),e.scale&&(r["font-scale"]=e.scale),e.textColor&&(r["text-color"]=["rgba"].concat(e.textColor.toRenderColor(null).toArray())),t.push(r)}return t}}class mn{constructor(t){this.namePrimary=t.namePrimary,t.nameSecondary&&(this.nameSecondary=t.nameSecondary),this.available=t.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(t,e){return t?new mn({namePrimary:t,nameSecondary:e,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function gn(t,e,r,i){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof r&&r>=0&&r<=255?void 0===i||"number"==typeof i&&i>=0&&i<=1?null:`Invalid rgba value [${[t,e,r,i].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof i?[t,e,r,i]:[t,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function _n(t){if(null===t)return!0;if("string"==typeof t)return!0;if("boolean"==typeof t)return!0;if("number"==typeof t)return!0;if(t instanceof Vi)return!0;if(t instanceof pn)return!0;if(t instanceof fn)return!0;if(t instanceof mn)return!0;if(Array.isArray(t)){for(const e of t)if(!_n(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!_n(t[e]))return!1;return!0}return!1}function yn(t){if(null===t)return Xi;if("string"==typeof t)return Yi;if("boolean"==typeof t)return Ji;if("number"==typeof t)return $i;if(t instanceof Vi)return tn;if(t instanceof pn)return nn;if(t instanceof fn)return on;if(t instanceof mn)return an;if(Array.isArray(t)){const e=t.length;let r;for(const e of t){const t=yn(e);if(r){if(r===t)continue;r=rn;break}r=t}return sn(r||rn,e)}return en}function vn(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof Vi||t instanceof fn||t instanceof mn?t.toString():JSON.stringify(t)}class xn{constructor(t,e){this.type=t,this.value=e}static parse(t,e){if(2!==t.length)return e.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!_n(t[1]))return e.error("invalid value");const r=t[1];let i=yn(r);const n=e.expectedType;return"array"!==i.kind||0!==i.N||!n||"array"!==n.kind||"number"==typeof n.N&&0!==n.N||(i=n),new xn(i,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Vi?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof fn?this.value.serialize():this.value}}class wn{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const bn={string:Yi,number:$i,boolean:Ji,object:en};class Bn{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let r,i=1;const n=t[0];if("array"===n){let n,o;if(t.length>2){const r=t[1];if("string"!=typeof r||!(r in bn)||"object"===r)return e.error('The item type argument of "array" must be one of string, number, boolean',1);n=bn[r],i++}else n=rn;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);o=t[2],i++}r=sn(n,o)}else r=bn[n];const o=[];for(;i<t.length;i++){const r=e.parse(t[i],i,rn);if(!r)return null;o.push(r)}return new Bn(r,o)}evaluate(t){for(let e=0;e<this.args.length;e++){const r=this.args[e].evaluate(t);if(!un(this.type,yn(r)))return r;if(e===this.args.length-1)throw new wn(`Expected value to be of type ${ln(this.type)}, but found ${ln(yn(r))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){const t=this.type,e=[t.kind];if("array"===t.kind){const r=t.itemType;if("string"===r.kind||"number"===r.kind||"boolean"===r.kind){e.push(r.kind);const i=t.N;("number"==typeof i||this.args.length>1)&&e.push(i)}}return e.concat(this.args.map((t=>t.serialize())))}}class Cn{constructor(t){this.type=on,this.sections=t}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const r=t[1];if(!Array.isArray(r)&&"object"==typeof r)return e.error("First argument must be an image or text section.");const i=[];let n=!1;for(let r=1;r<=t.length-1;++r){const o=t[r];if(n&&"object"==typeof o&&!Array.isArray(o)){n=!1;let t=null;if(o["font-scale"]&&(t=e.parse(o["font-scale"],1,$i),!t))return null;let r=null;if(o["text-font"]&&(r=e.parse(o["text-font"],1,sn(Yi)),!r))return null;let a=null;if(o["text-color"]&&(a=e.parse(o["text-color"],1,tn),!a))return null;const s=i[i.length-1];s.scale=t,s.font=r,s.textColor=a}else{const o=e.parse(t[r],1,rn);if(!o)return null;const a=o.type.kind;if("string"!==a&&"value"!==a&&"null"!==a&&"resolvedImage"!==a)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");n=!0,i.push({content:o,scale:null,font:null,textColor:null})}}return new Cn(i)}evaluate(t){return new fn(this.sections.map((e=>{const r=e.content.evaluate(t);return yn(r)===an?new dn("",r,null,null,null):new dn(vn(r),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)})))}eachChild(t){for(const e of this.sections)t(e.content),e.scale&&t(e.scale),e.font&&t(e.font),e.textColor&&t(e.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const e of this.sections){t.push(e.content.serialize());const r={};e.scale&&(r["font-scale"]=e.scale.serialize()),e.font&&(r["text-font"]=e.font.serialize()),e.textColor&&(r["text-color"]=e.textColor.serialize()),t.push(r)}return t}}class En{constructor(t,e){this.type=an,this.inputPrimary=t,this.inputSecondary=e}static parse(t,e){if(t.length<2)return e.error("Expected two or more arguments.");const r=e.parse(t[1],1,Yi);if(!r)return e.error("No image name provided.");if(2===t.length)return new En(r);const i=e.parse(t[2],1,Yi);return i?new En(r,i):e.error("Secondary image variant is not a string.")}evaluate(t){const e=mn.fromString(this.inputPrimary.evaluate(t),this.inputSecondary?this.inputSecondary.evaluate(t):void 0);return e&&t.availableImages&&(e.available=t.availableImages.indexOf(e.namePrimary)>-1,e.nameSecondary&&e.available&&t.availableImages&&(e.available=t.availableImages.indexOf(e.nameSecondary)>-1)),e}eachChild(t){t(this.inputPrimary),this.inputSecondary&&t(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Tn(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}const In={"to-boolean":Ji,"to-color":tn,"to-number":$i,"to-string":Yi};class Sn{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const r=t[0],i=[];let n=Xi;if("to-array"===r){if(!Array.isArray(t[1]))return null;const r=t[1].length;if(e.expectedType){if("array"!==e.expectedType.kind)return e.error(`Expected ${e.expectedType.kind} but found array.`);n=sn(e.expectedType.itemType,r)}else{if(!(r>0&&_n(t[1][0])))return null;n=sn(yn(t[1][0]),r)}for(let o=0;o<r;o++){const r=t[1][o];let a;if("array"===Tn(r))a=e.parse(r,void 0,n.itemType);else{const t=Tn(r);if(t!==n.itemType.kind)return e.error(`Expected ${n.itemType.kind} but found ${t}.`);a=e.registry.literal.parse(["literal",void 0===r?null:r],e)}if(!a)return null;i.push(a)}}else{if(("to-boolean"===r||"to-string"===r)&&2!==t.length)return e.error("Expected one argument.");n=In[r];for(let r=1;r<t.length;r++){const n=e.parse(t[r],r,rn);if(!n)return null;i.push(n)}}return new Sn(n,i)}evaluate(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){let e,r;for(const i of this.args){if(e=i.evaluate(t),r=null,e instanceof Vi)return e;if("string"==typeof e){const r=t.parseColor(e);if(r)return r}else if(Array.isArray(e)&&(r=e.length<3||e.length>4?`Invalid rbga value ${JSON.stringify(e)}: expected an array containing either three or four numeric values.`:gn(e[0],e[1],e[2],e[3]),!r))return new Vi(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new wn(r||`Could not parse color from value '${"string"==typeof e?e:String(JSON.stringify(e))}'`)}if("number"===this.type.kind){let e=null;for(const r of this.args){if(e=r.evaluate(t),null===e)return 0;const i=Number(e);if(!isNaN(i))return i}throw new wn(`Could not convert ${JSON.stringify(e)} to number.`)}return"formatted"===this.type.kind?fn.fromString(vn(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?mn.fromString(vn(this.args[0].evaluate(t))):"array"===this.type.kind?this.args.map((e=>e.evaluate(t))):vn(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new Cn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new En(this.args[0]).serialize();const t="array"===this.type.kind?[]:[`to-${this.type.kind}`];return this.eachChild((e=>{t.push(e.serialize())})),t}}const Mn=["Unknown","Point","LineString","Polygon"];class Fn{constructor(t,e){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=t,this.options=e}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Mn[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:r,y:i}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*e-t[0])+this.featureDistanceData.bearing[1]*(i*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Vi.parse(t)),e}getConfig(t){return this.options?this.options.get(t):null}}class Pn{constructor(t,e,r,i,n){this.name=t,this.type=e,this._evaluate=r,this.args=i,this._overloadIndex=n}evaluate(t){if(!this._evaluate){const t=Pn.definitions[this.name];this._evaluate=Array.isArray(t)?t[2]:t.overloads[this._overloadIndex][1]}return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((t=>t.serialize())))}static parse(t,e){const r=t[0],i=Pn.definitions[r];if(!i)return e.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);const n=Array.isArray(i)?i[0]:i.type,o=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,a=[];let s=null,l=-1;for(const[i,c]of o){if(Array.isArray(i)&&i.length!==t.length-1)continue;a.push(i),l++,s=new Jo(e.registry,e.path,null,e.scope,void 0,e._scope,e.options);const o=[];let u=!1;for(let e=1;e<t.length;e++){const r=t[e],n=Array.isArray(i)?i[e-1]:i.type,a=s.parse(r,1+o.length,n);if(!a){u=!0;break}o.push(a)}if(!u)if(Array.isArray(i)&&i.length!==o.length)s.error(`Expected ${i.length} arguments, but found ${o.length} instead.`);else{for(let t=0;t<o.length;t++){const e=Array.isArray(i)?i[t]:i.type,r=o[t];s.concat(t+1).checkSubtype(e,r.type)}if(0===s.errors.length)return new Pn(r,n,c,o,l)}}if(1===a.length)e.errors.push(...s.errors);else{const r=(a.length?a:o.map((([t])=>t))).map(Ln).join(" | "),i=[];for(let r=1;r<t.length;r++){const n=e.parse(t[r],1+i.length);if(!n)return null;i.push(ln(n.type))}e.error(`Expected arguments of type ${r}, but found (${i.join(", ")}) instead.`)}return null}static register(t,e){Pn.definitions=e;for(const r in e)t[r]=Pn}}function Ln(t){return Array.isArray(t)?`(${t.map(ln).join(", ")})`:`(${ln(t.type)}...)`}class Dn{constructor(t,e,r){this.type=nn,this.locale=r,this.caseSensitive=t,this.diacriticSensitive=e}static parse(t,e){if(2!==t.length)return e.error("Expected one argument.");const r=t[1];if("object"!=typeof r||Array.isArray(r))return e.error("Collator options argument must be an object.");const i=e.parse(void 0!==r["case-sensitive"]&&r["case-sensitive"],1,Ji);if(!i)return null;const n=e.parse(void 0!==r["diacritic-sensitive"]&&r["diacritic-sensitive"],1,Ji);if(!n)return null;let o=null;return r.locale&&(o=e.parse(r.locale,1,Yi),!o)?null:new Dn(i,n,o)}evaluate(t){return new pn(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}function Un(t,e,r=0,i=t.length-1,n=zn){for(;i>r;){if(i-r>600){const o=i-r+1,a=e-r+1,s=Math.log(o),l=.5*Math.exp(2*s/3),c=.5*Math.sqrt(s*l*(o-l)/o)*(a-o/2<0?-1:1);Un(t,e,Math.max(r,Math.floor(e-a*l/o+c)),Math.min(i,Math.floor(e+(o-a)*l/o+c)),n)}const o=t[e];let a=r,s=i;for(kn(t,r,e),n(t[i],o)>0&&kn(t,r,i);a<s;){for(kn(t,a,s),a++,s--;n(t[a],o)<0;)a++;for(;n(t[s],o)>0;)s--}0===n(t[r],o)?kn(t,r,s):(s++,kn(t,s,i)),s<=e&&(r=s+1),e<=s&&(i=s-1)}}function kn(t,e,r){const i=t[e];t[e]=t[r],t[r]=i}function zn(t,e){return t<e?-1:t>e?1:0}function Rn(t){let e=0;for(let r,i,n=0,o=t.length,a=o-1;n<o;a=n++)r=t[n],i=t[a],e+=(i.x-r.x)*(r.y+i.y);return e}function On(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Qn(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Nn(t,e,r){const i=t[0]-e[0],n=t[1]-e[1],o=t[0]-r[0],a=t[1]-r[1];return i*a-o*n==0&&i*o<=0&&n*a<=0}function Vn(t,e,r=!1){let i=!1;for(let s=0,l=e.length;s<l;s++){const l=e[s];for(let e=0,s=l.length,c=s-1;e<s;c=e++){const s=l[c],u=l[e];if(Nn(t,s,u))return r;(o=s)[1]>(n=t)[1]!=(a=u)[1]>n[1]&&n[0]<(a[0]-o[0])*(n[1]-o[1])/(a[1]-o[1])+o[0]&&(i=!i)}}var n,o,a;return i}function Hn(t,e,r,i){const n=i[0]-r[0],o=i[1]-r[1],a=(t[0]-r[0])*o-n*(t[1]-r[1]),s=(e[0]-r[0])*o-n*(e[1]-r[1]);return a>0&&s<0||a<0&&s>0}function jn(t,e,r,i){return 0!=(n=[i[0]-r[0],i[1]-r[1]])[0]*(o=[e[0]-t[0],e[1]-t[1]])[1]-n[1]*o[0]&&!(!Hn(t,e,r,i)||!Hn(r,i,t,e));var n,o}const Gn=8192;function Kn(t,e){const r=(180+t[0])/360,i=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,n=Math.pow(2,e.z);return[Math.round(r*n*Gn),Math.round(i*n*Gn)]}function qn(t,e){for(let r=0;r<e.length;r++)if(Vn(t,e[r]))return!0;return!1}function Zn(t,e,r){for(const i of r)for(let r=0,n=i.length,o=n-1;r<n;o=r++)if(jn(t,e,i[o],i[r]))return!0;return!1}function Wn(t,e){for(let r=0;r<t.length;++r)if(!Vn(t[r],e))return!1;for(let r=0;r<t.length-1;++r)if(Zn(t[r],t[r+1],e))return!1;return!0}function Xn(t,e){for(let r=0;r<e.length;r++)if(Wn(t,e[r]))return!0;return!1}function $n(t,e,r){const i=[];for(let n=0;n<t.length;n++){const o=[];for(let i=0;i<t[n].length;i++){const a=Kn(t[n][i],r);On(e,a),o.push(a)}i.push(o)}return i}function Yn(t,e,r){const i=[];for(let n=0;n<t.length;n++){const o=$n(t[n],e,r);i.push(o)}return i}function Jn(t,e,r,i){if(t[0]<r[0]||t[0]>r[2]){const e=.5*i;let n=t[0]-r[0]>e?-i:r[0]-t[0]>e?i:0;0===n&&(n=t[0]-r[2]>e?-i:r[2]-t[0]>e?i:0),t[0]+=n}On(e,t)}function to(t,e,r,i){const n=Math.pow(2,i.z)*Gn,o=[i.x*Gn,i.y*Gn],a=[];if(!t)return a;for(const i of t)for(const t of i){const i=[t.x+o[0],t.y+o[1]];Jn(i,e,r,n),a.push(i)}return a}function eo(t,e,r,i){const n=Math.pow(2,i.z)*Gn,o=[i.x*Gn,i.y*Gn],a=[];if(!t)return a;for(const r of t){const t=[];for(const i of r){const r=[i.x+o[0],i.y+o[1]];On(e,r),t.push(r)}a.push(t)}if(e[2]-e[0]<=n/2){(s=e)[0]=s[1]=1/0,s[2]=s[3]=-1/0;for(const t of a)for(const i of t)Jn(i,e,r,n)}var s;return a}class ro{constructor(t,e){this.type=Ji,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(_n(t[1])){const e=t[1];if("FeatureCollection"===e.type)for(let t=0;t<e.features.length;++t){const r=e.features[t].geometry.type;if("Polygon"===r||"MultiPolygon"===r)return new ro(e,e.features[t].geometry)}else if("Feature"===e.type){const t=e.geometry.type;if("Polygon"===t||"MultiPolygon"===t)return new ro(e,e.geometry)}else if("Polygon"===e.type||"MultiPolygon"===e.type)return new ro(e,e)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const r=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],n=t.canonicalID();if(!n)return!1;if("Polygon"===e.type){const o=$n(e.coordinates,i,n),a=to(t.geometry(),r,i,n);if(!Qn(r,i))return!1;for(const t of a)if(!Vn(t,o))return!1}if("MultiPolygon"===e.type){const o=Yn(e.coordinates,i,n),a=to(t.geometry(),r,i,n);if(!Qn(r,i))return!1;for(const t of a)if(!qn(t,o))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const r=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],n=t.canonicalID();if(!n)return!1;if("Polygon"===e.type){const o=$n(e.coordinates,i,n),a=eo(t.geometry(),r,i,n);if(!Qn(r,i))return!1;for(const t of a)if(!Wn(t,o))return!1}if("MultiPolygon"===e.type){const o=Yn(e.coordinates,i,n),a=eo(t.geometry(),r,i,n);if(!Qn(r,i))return!1;for(const t of a)if(!Xn(t,o))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const io={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},no=1/298.257223563,oo=no*(2-no),ao=Math.PI/180;class so{static fromTile(t,e,r){const i=Math.PI*(1-2*(t+.5)/Math.pow(2,e)),n=Math.atan(.5*(Math.exp(i)-Math.exp(-i)))/ao;return new so(n,r)}static get units(){return io}constructor(t,e){if(void 0===t)throw new Error("No latitude given.");if(e&&!io[e])throw new Error(`Unknown unit ${e}. Use one of: ${Object.keys(io).join(", ")}`);const r=6378.137*ao*(e?io[e]:1),i=Math.cos(t*ao),n=1/(1-oo*(1-i*i)),o=Math.sqrt(n);this.kx=r*o*i,this.ky=r*o*n*(1-oo)}distance(t,e){const r=uo(t[0]-e[0])*this.kx,i=(t[1]-e[1])*this.ky;return Math.sqrt(r*r+i*i)}bearing(t,e){const r=uo(e[0]-t[0])*this.kx;return Math.atan2(r,(e[1]-t[1])*this.ky)/ao}destination(t,e,r){const i=r*ao;return this.offset(t,Math.sin(i)*e,Math.cos(i)*e)}offset(t,e,r){return[t[0]+e/this.kx,t[1]+r/this.ky]}lineDistance(t){let e=0;for(let r=0;r<t.length-1;r++)e+=this.distance(t[r],t[r+1]);return e}area(t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];for(let t=0,n=i.length,o=n-1;t<n;o=t++)e+=uo(i[t][0]-i[o][0])*(i[t][1]+i[o][1])*(r?-1:1)}return Math.abs(e)/2*this.kx*this.ky}along(t,e){let r=0;if(e<=0)return t[0];for(let i=0;i<t.length-1;i++){const n=t[i],o=t[i+1],a=this.distance(n,o);if(r+=a,r>e)return co(n,o,(e-(r-a))/a)}return t[t.length-1]}pointToSegmentDistance(t,e,r){let[i,n]=e,o=uo(r[0]-i)*this.kx,a=(r[1]-n)*this.ky;if(0!==o||0!==a){const e=(uo(t[0]-i)*this.kx*o+(t[1]-n)*this.ky*a)/(o*o+a*a);e>1?(i=r[0],n=r[1]):e>0&&(i+=o/this.kx*e,n+=a/this.ky*e)}return o=uo(t[0]-i)*this.kx,a=(t[1]-n)*this.ky,Math.sqrt(o*o+a*a)}pointOnLine(t,e){let r=1/0,i=t[0][0],n=t[0][1],o=0,a=0;for(let s=0;s<t.length-1;s++){let l=t[s][0],c=t[s][1],u=uo(t[s+1][0]-l)*this.kx,h=(t[s+1][1]-c)*this.ky,A=0;0===u&&0===h||(A=(uo(e[0]-l)*this.kx*u+(e[1]-c)*this.ky*h)/(u*u+h*h),A>1?(l=t[s+1][0],c=t[s+1][1]):A>0&&(l+=u/this.kx*A,c+=h/this.ky*A)),u=uo(e[0]-l)*this.kx,h=(e[1]-c)*this.ky;const p=u*u+h*h;p<r&&(r=p,i=l,n=c,o=s,a=A)}return{point:[i,n],index:o,t:Math.max(0,Math.min(1,a))}}lineSlice(t,e,r){let i=this.pointOnLine(r,t),n=this.pointOnLine(r,e);if(i.index>n.index||i.index===n.index&&i.t>n.t){const t=i;i=n,n=t}const o=[i.point],a=i.index+1,s=n.index;!lo(r[a],o[0])&&a<=s&&o.push(r[a]);for(let t=a+1;t<=s;t++)o.push(r[t]);return lo(r[s],n.point)||o.push(n.point),o}lineSliceAlong(t,e,r){let i=0;const n=[];for(let o=0;o<r.length-1;o++){const a=r[o],s=r[o+1],l=this.distance(a,s);if(i+=l,i>t&&0===n.length&&n.push(co(a,s,(t-(i-l))/l)),i>=e)return n.push(co(a,s,(e-(i-l))/l)),n;i>t&&n.push(s)}return n}bufferPoint(t,e){const r=e/this.ky,i=e/this.kx;return[t[0]-i,t[1]-r,t[0]+i,t[1]+r]}bufferBBox(t,e){const r=e/this.ky,i=e/this.kx;return[t[0]-i,t[1]-r,t[2]+i,t[3]+r]}insideBBox(t,e){return uo(t[0]-e[0])>=0&&uo(t[0]-e[2])<=0&&t[1]>=e[1]&&t[1]<=e[3]}}function lo(t,e){return t[0]===e[0]&&t[1]===e[1]}function co(t,e,r){const i=uo(e[0]-t[0]);return[t[0]+i*r,t[1]+(e[1]-t[1])*r]}function uo(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}class ho{constructor(t=[],e=(t,e)=>t<e?-1:t>e?1:0){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:r}=this,i=e[t];for(;t>0;){const n=t-1>>1,o=e[n];if(r(i,o)>=0)break;e[t]=o,t=n}e[t]=i}_down(t){const{data:e,compare:r}=this,i=this.length>>1,n=e[t];for(;t<i;){let i=1+(t<<1);const o=i+1;if(o<this.length&&r(e[o],e[i])<0&&(i=o),r(e[i],n)>=0)break;e[t]=e[i],t=i}e[t]=n}}var Ao=8192;function po(t,e){return e.dist-t.dist}const fo=100,mo=50;function go(t){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function _o(t){return t[1]-t[0]+1}function yo(t,e){const r=t[1]>=t[0]&&t[1]<e;return r||console.warn("Distance Expression: Index is out of range"),r}function vo(t,e){if(t[0]>t[1])return[null,null];const r=_o(t);if(e){if(2===r)return[t,null];const e=Math.floor(r/2);return[[t[0],t[0]+e],[t[0]+e,t[1]]]}{if(1===r)return[t,null];const e=Math.floor(r/2)-1;return[[t[0],t[0]+e],[t[0]+e+1,t[1]]]}}function xo(t,e){const r=[1/0,1/0,-1/0,-1/0];if(!yo(e,t.length))return r;for(let i=e[0];i<=e[1];++i)On(r,t[i]);return r}function wo(t){const e=[1/0,1/0,-1/0,-1/0];for(let r=0;r<t.length;++r)for(let i=0;i<t[r].length;++i)On(e,t[r][i]);return e}function bo(t,e,r){if(go(t)||go(e))return NaN;let i=0,n=0;return t[2]<e[0]&&(i=e[0]-t[2]),t[0]>e[2]&&(i=t[0]-e[2]),t[1]>e[3]&&(n=t[1]-e[3]),t[3]<e[1]&&(n=e[1]-t[3]),r.distance([0,0],[i,n])}function Bo(t){return 360*t-180}function Co(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Eo(t,e){const r=Math.pow(2,e.z),i=(t.y/Ao+e.y)/r;return[Bo((t.x/Ao+e.x)/r),Co(i)]}function To(t,e){const r=[];for(let i=0;i<t.length;++i)r.push(Eo(t[i],e));return r}function Io(t,e,r){const i=r.pointOnLine(e,t).point;return r.distance(t,i)}function So(t,e,r,i,n){const o=r.slice(i[0],i[1]+1);let a=1/0;for(let r=e[0];r<=e[1];++r)if(0===(a=Math.min(a,Io(t[r],o,n))))return 0;return a}function Mo(t,e,r,i,n){const o=Math.min(n.pointToSegmentDistance(t,r,i),n.pointToSegmentDistance(e,r,i)),a=Math.min(n.pointToSegmentDistance(r,t,e),n.pointToSegmentDistance(i,t,e));return Math.min(o,a)}function Fo(t,e,r,i,n){if(!yo(e,t.length)||!yo(i,r.length))return NaN;let o=1/0;for(let a=e[0];a<e[1];++a)for(let e=i[0];e<i[1];++e){if(jn(t[a],t[a+1],r[e],r[e+1]))return 0;o=Math.min(o,Mo(t[a],t[a+1],r[e],r[e+1],n))}return o}function Po(t,e,r,i,n){if(!yo(e,t.length)||!yo(i,r.length))return NaN;let o=1/0;for(let a=e[0];a<=e[1];++a)for(let e=i[0];e<=i[1];++e)if(0===(o=Math.min(o,n.distance(t[a],r[e]))))return o;return o}function Lo(t,e,r){if(Vn(t,e,!0))return 0;let i=1/0;for(const n of e){const e=n.length;if(e<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(n[0]!==n[e-1]&&0===(i=Math.min(i,r.pointToSegmentDistance(t,n[e-1],n[0]))))return i;if(0===(i=Math.min(i,Io(t,n,r))))return i}return i}function Do(t,e,r,i){if(!yo(e,t.length))return NaN;for(let i=e[0];i<=e[1];++i)if(Vn(t[i],r,!0))return 0;let n=1/0;for(let o=e[0];o<e[1];++o)for(const e of r)for(let r=0,a=e.length,s=a-1;r<a;s=r++){if(jn(t[o],t[o+1],e[s],e[r]))return 0;n=Math.min(n,Mo(t[o],t[o+1],e[s],e[r],i))}return n}function Uo(t,e){for(const r of t)for(let t=0;t<=r.length-1;++t)if(Vn(r[t],e,!0))return!0;return!1}function ko(t,e,r,i=1/0){const n=wo(t),o=wo(e);if(i!==1/0&&bo(n,o,r)>=i)return i;if(Qn(n,o)){if(Uo(t,e))return 0}else if(Uo(e,t))return 0;let a=i;for(const i of t)for(let t=0,n=i.length,o=n-1;t<n;o=t++)for(const n of e)for(let e=0,s=n.length,l=s-1;e<s;l=e++){if(jn(i[o],i[t],n[l],n[e]))return 0;a=Math.min(a,Mo(i[o],i[t],n[l],n[e],r))}return a}function zo(t,e,r,i,n,o,a){if(null===o||null===a)return;const s=bo(xo(i,o),xo(n,a),r);s<e&&t.push({dist:s,range1:o,range2:a})}function Ro(t,e,r,i,n=1/0){let o=Math.min(i.distance(t[0],r[0][0]),n);if(0===o)return o;const a=new ho([{dist:0,range1:[0,t.length-1],range2:[0,0]}],po),s=e?mo:fo,l=wo(r);for(;a.length;){const n=a.pop();if(n.dist>=o)continue;const c=n.range1;if(_o(c)<=s){if(!yo(c,t.length))return NaN;if(e){const e=Do(t,c,r,i);if(0===(o=Math.min(o,e)))return o}else for(let e=c[0];e<=c[1];++e){const n=Lo(t[e],r,i);if(0===(o=Math.min(o,n)))return o}}else{const r=vo(c,e);if(null!==r[0]){const e=bo(xo(t,r[0]),l,i);e<o&&a.push({dist:e,range1:r[0],range2:[0,0]})}if(null!==r[1]){const e=bo(xo(t,r[1]),l,i);e<o&&a.push({dist:e,range1:r[1],range2:[0,0]})}}}return o}function Oo(t,e,r,i,n,o=1/0){let a=Math.min(o,n.distance(t[0],r[0]));if(0===a)return a;const s=new ho([{dist:0,range1:[0,t.length-1],range2:[0,r.length-1]}],po),l=e?mo:fo,c=i?mo:fo;for(;s.length;){const o=s.pop();if(o.dist>=a)continue;const u=o.range1,h=o.range2;if(_o(u)<=l&&_o(h)<=c){if(!yo(u,t.length)||!yo(h,r.length))return NaN;if(e&&i?a=Math.min(a,Fo(t,u,r,h,n)):e||i?e&&!i?a=Math.min(a,So(r,h,t,u,n)):!e&&i&&(a=Math.min(a,So(t,u,r,h,n))):a=Math.min(a,Po(t,u,r,h,n)),0===a)return a}else{const o=vo(u,e),l=vo(h,i);zo(s,a,n,t,r,o[0],l[0]),zo(s,a,n,t,r,o[0],l[1]),zo(s,a,n,t,r,o[1],l[0]),zo(s,a,n,t,r,o[1],l[1])}}return a}function Qo(t,e,r,i,n=1/0){let o=n;const a=xo(t,[0,t.length-1]);for(const n of r)if(!(o!==1/0&&bo(a,xo(n,[0,n.length-1]),i)>=o)&&(o=Math.min(o,Oo(t,e,n,!0,i,o)),0===o))return o;return o}function No(t,e,r,i,n=1/0){let o=n;const a=xo(t,[0,t.length-1]);for(const n of r){if(o!==1/0&&bo(a,wo(n),i)>=o)continue;const r=Ro(t,e,n,i,o);if(isNaN(r))return r;if(0===(o=Math.min(o,r)))return o}return o}function Vo(t){return"Point"===t||"MultiPoint"===t||"LineString"===t||"MultiLineString"===t||"Polygon"===t||"MultiPolygon"===t}class Ho{constructor(t,e){this.type=$i,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error(`'distance' expression requires either one argument, but found ' ${t.length-1} instead.`);if(_n(t[1])){const e=t[1];if("FeatureCollection"===e.type){for(let t=0;t<e.features.length;++t)if(Vo(e.features[t].geometry.type))return new Ho(e,e.features[t].geometry)}else if("Feature"===e.type){if(Vo(e.geometry.type))return new Ho(e,e.geometry)}else if(Vo(e.type))return new Ho(e,e)}return e.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(t){const e=t.geometry(),r=t.canonicalID();if(null!=e&&null!=r){if("Point"===t.geometryType())return function(t,e,r){const i=[];for(const r of t)for(const t of r)i.push(Eo(t,e));const n=new so(i[0][1],"meters");return"Point"===r.type||"MultiPoint"===r.type||"LineString"===r.type?Oo(i,!1,"Point"===r.type?[r.coordinates]:r.coordinates,"LineString"===r.type,n):"MultiLineString"===r.type?Qo(i,!1,r.coordinates,n):"Polygon"===r.type||"MultiPolygon"===r.type?No(i,!1,"Polygon"===r.type?[r.coordinates]:r.coordinates,n):null}(e,r,this.geometries);if("LineString"===t.geometryType())return function(t,e,r){const i=[];for(const r of t){const t=[];for(const i of r)t.push(Eo(i,e));i.push(t)}const n=new so(i[0][0][1],"meters");if("Point"===r.type||"MultiPoint"===r.type||"LineString"===r.type)return Qo("Point"===r.type?[r.coordinates]:r.coordinates,"LineString"===r.type,i,n);if("MultiLineString"===r.type){let t=1/0;for(let e=0;e<r.coordinates.length;e++){const o=Qo(r.coordinates[e],!0,i,n,t);if(isNaN(o))return o;if(0===(t=Math.min(t,o)))return t}return t}if("Polygon"===r.type||"MultiPolygon"===r.type){let t=1/0;for(let e=0;e<i.length;e++){const o=No(i[e],!0,"Polygon"===r.type?[r.coordinates]:r.coordinates,n,t);if(isNaN(o))return o;if(0===(t=Math.min(t,o)))return t}return t}return null}(e,r,this.geometries);if("Polygon"===t.geometryType())return function(t,e,r){const i=[];for(const r of function(t){const e=t.length;if(e<=1)return[t];const r=[];let i,n;for(let o=0;o<e;o++){const e=Rn(t[o]);0!==e&&(t[o].area=Math.abs(e),void 0===n&&(n=e<0),n===e<0?(i&&r.push(i),i=[t[o]]):i.push(t[o]))}return i&&r.push(i),r}(t)){const t=[];for(let i=0;i<r.length;++i)t.push(To(r[i],e));i.push(t)}const n=new so(i[0][0][0][1],"meters");if("Point"===r.type||"MultiPoint"===r.type||"LineString"===r.type)return No("Point"===r.type?[r.coordinates]:r.coordinates,"LineString"===r.type,i,n);if("MultiLineString"===r.type){let t=1/0;for(let e=0;e<r.coordinates.length;e++){const o=No(r.coordinates[e],!0,i,n,t);if(isNaN(o))return o;if(0===(t=Math.min(t,o)))return t}return t}return"Polygon"===r.type||"MultiPolygon"===r.type?function(t,e,r){let i=1/0;for(const n of t)for(const t of e){const e=ko(n,t,r,i);if(isNaN(e))return e;if(0===(i=Math.min(i,e)))return i}return i}("Polygon"===r.type?[r.coordinates]:r.coordinates,i,n):null}(e,r,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function jo(t,e){switch(t){case"string":return vn(e);case"number":return+e;case"boolean":return!!e;case"color":return Vi.parse(e);case"formatted":return fn.fromString(vn(e));case"resolvedImage":return mn.fromString(vn(e))}return e}function Go(t,e,r,i){return void 0!==i&&(t=i*Math.round(t/i)),void 0!==e&&t<e&&(t=e),void 0!==r&&t>r&&(t=r),t}class Ko{constructor(t,e,r){this.type=t,this.key=e,this.scope=r}static parse(t,e){let r=e.expectedType;if(null==r&&(r=rn),t.length<2||t.length>3)return e.error("Invalid number of arguments for 'config' expression.");const i=e.parse(t[1],1);if(!(i instanceof xn))return e.error("Key name of 'config' expression must be a string literal.");if(t.length>=3){const n=e.parse(t[2],2);return n instanceof xn?new Ko(r,vn(i.value),vn(n.value)):e.error("Scope of 'config' expression must be a string literal.")}return new Ko(r,vn(i.value))}evaluate(t){const e=[this.key,this.scope,t.scope].filter(Boolean).join(""),r=t.getConfig(e);if(!r)return null;const{type:i,value:n,values:o,minValue:a,maxValue:s,stepValue:l}=r,c=r.default.evaluate(t);let u=c;if(n){const e=t.scope;t.scope=(e||"").split("").slice(1).join(""),u=n.evaluate(t),t.scope=e}return i&&(u=jo(i,u)),void 0===u||void 0===a&&void 0===s&&void 0===l||("number"==typeof u?u=Go(u,a,s,l):Array.isArray(u)&&(u=u.map((t=>"number"==typeof t?Go(t,a,s,l):t)))),void 0!==n&&void 0!==u&&o&&!o.includes(u)&&(u=c,i&&(u=jo(i,u))),(i&&i!==this.type||void 0!==u&&yn(u)!==this.type)&&(u=jo(this.type.kind,u)),u}eachChild(){}outputDefined(){return!1}serialize(){const t=["config",this.key];return this.scope&&t.concat(this.key),t}}function qo(t){if(t instanceof Pn){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof ro)return!1;if(t instanceof Ho)return!1;let e=!0;return t.eachChild((t=>{e&&!qo(t)&&(e=!1)})),e}function Zo(t){if(t instanceof Pn&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild((t=>{e&&!Zo(t)&&(e=!1)})),e}function Wo(t){if(t instanceof Ko)return!1;let e=!0;return t.eachChild((t=>{e&&!Wo(t)&&(e=!1)})),e}function Xo(t,e){if(t instanceof Pn&&e.indexOf(t.name)>=0)return!1;let r=!0;return t.eachChild((t=>{r&&!Xo(t,e)&&(r=!1)})),r}class $o{constructor(t,e){this.type=e.type,this.name=t,this.boundExpression=e}static parse(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");const r=t[1];return e.scope.has(r)?new $o(r,e.scope.get(r)):e.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Yo{constructor(t,e=[],r,i=new Wi,n=[],o,a){this.registry=t,this.path=e,this.key=e.map((t=>`[${t}]`)).join(""),this.scope=i,this.errors=n,this.expectedType=r,this._scope=o,this.options=a}parse(t,e,r,i,n={}){return e||r?this.concat(e,r,i)._parse(t,n):this._parse(t,n)}_parse(t,e){function r(t,e,r){return"assert"===r?new Bn(e,[t]):"coerce"===r?new Sn(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const i="string"==typeof t[0]?this.registry[t[0]]:void 0;if(i){let n=i.parse(t,this);if(!n)return null;if(this.expectedType){const t=this.expectedType,i=n.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==i.kind)if("color"!==t.kind&&"formatted"!==t.kind&&"resolvedImage"!==t.kind||"value"!==i.kind&&"string"!==i.kind){if(this.checkSubtype(t,i))return null}else n=r(n,t,e.typeAnnotation||"coerce");else n=r(n,t,e.typeAnnotation||"assert")}if(!(n instanceof xn)&&"resolvedImage"!==n.type.kind&&ta(n)){const e=new Fn(this._scope,this.options);try{n=new xn(n.type,n.evaluate(e))}catch(t){return this.error(t.message),null}}return n}return Sn.parse(["to-array",t],this)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,e,r){const i="number"==typeof t?this.path.concat(t):this.path,n=r?this.scope.concat(r):this.scope;return new Yo(this.registry,i,e||null,n,this.errors,this._scope,this.options)}error(t,...e){const r=`${this.key}${e.map((t=>`[${t}]`)).join("")}`;this.errors.push(new Zi(r,t))}checkSubtype(t,e){const r=un(t,e);return r&&this.error(r),r}}var Jo=Yo;function ta(t){if(t instanceof $o)return ta(t.boundExpression);if(t instanceof Pn&&"error"===t.name)return!1;if(t instanceof Dn)return!1;if(t instanceof ro)return!1;if(t instanceof Ho)return!1;if(t instanceof Ko)return!1;const e=t instanceof Sn||t instanceof Bn;let r=!0;return t.eachChild((t=>{r=e?r&&ta(t):r&&t instanceof xn})),!!r&&qo(t)&&Xo(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function ea(t,e){const r=t.length-1;let i,n,o=0,a=r,s=0;for(;o<=a;)if(s=Math.floor((o+a)/2),i=t[s],n=t[s+1],i<=e){if(s===r||e<n)return s;o=s+1}else{if(!(i>e))throw new wn("Input is not a number.");a=s-1}return 0}class ra{constructor(t,e,r){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(const[t,e]of r)this.labels.push(t),this.outputs.push(e)}static parse(t,e){if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");const r=e.parse(t[1],1,$i);if(!r)return null;const i=[];let n=null;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);for(let r=1;r<t.length;r+=2){const o=1===r?-1/0:t[r],a=t[r+1],s=r,l=r+1;if("number"!=typeof o)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',s);if(i.length&&i[i.length-1][0]>=o)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',s);const c=e.parse(a,l,n);if(!c)return null;n=n||c.type,i.push([o,c])}return new ra(n,r,i)}evaluate(t){const e=this.labels,r=this.outputs;if(1===e.length)return r[0].evaluate(t);const i=this.input.evaluate(t);if(i<=e[0])return r[0].evaluate(t);const n=e.length;return i>=e[n-1]?r[n-1].evaluate(t):r[ea(e,i)].evaluate(t)}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}serialize(){const t=["step",this.input.serialize()];for(let e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t}}const ia=.95047,na=1.08883,oa=4/29,aa=6/29,sa=3*aa*aa,la=aa*aa*aa,ca=Math.PI/180,ua=180/Math.PI;function ha(t){return t>la?Math.pow(t,1/3):t/sa+oa}function Aa(t){return t>aa?t*t*t:sa*(t-oa)}function pa(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function da(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function fa(t){const e=da(t.r),r=da(t.g),i=da(t.b),n=ha((.4124564*e+.3575761*r+.1804375*i)/ia),o=ha((.2126729*e+.7151522*r+.072175*i)/1);return{l:116*o-16,a:500*(n-o),b:200*(o-ha((.0193339*e+.119192*r+.9503041*i)/na)),alpha:t.a}}function ma(t){let e=(t.l+16)/116,r=isNaN(t.a)?e:e+t.a/500,i=isNaN(t.b)?e:e-t.b/200;return e=1*Aa(e),r=ia*Aa(r),i=na*Aa(i),new Vi(pa(3.2404542*r-1.5371385*e-.4985314*i),pa(-.969266*r+1.8760108*e+.041556*i),pa(.0556434*r-.2040259*e+1.0572252*i),t.alpha)}function ga(t,e,r){const i=e-t;return t+r*(i>180||i<-180?i-360*Math.round(i/360):i)}const _a={forward:fa,reverse:ma,interpolate:function(t,e,r){return{l:ji(t.l,e.l,r),a:ji(t.a,e.a,r),b:ji(t.b,e.b,r),alpha:ji(t.alpha,e.alpha,r)}}},ya={forward:function(t){const{l:e,a:r,b:i}=fa(t),n=Math.atan2(i,r)*ua;return{h:n<0?n+360:n,c:Math.sqrt(r*r+i*i),l:e,alpha:t.a}},reverse:function(t){const e=t.h*ca,r=t.c;return ma({l:t.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:t.alpha})},interpolate:function(t,e,r){return{h:ga(t.h,e.h,r),c:ji(t.c,e.c,r),l:ji(t.l,e.l,r),alpha:ji(t.alpha,e.alpha,r)}}};var va=Object.freeze({__proto__:null,hcl:ya,lab:_a});class xa{constructor(t,e,r,i,n){this.type=t,this.operator=e,this.interpolation=r,this.input=i,this.labels=[],this.outputs=[];for(const[t,e]of n)this.labels.push(t),this.outputs.push(e)}static interpolationFactor(t,e,r,i){let n=0;if("exponential"===t.name)n=wa(e,t.base,r,i);else if("linear"===t.name)n=wa(e,1,r,i);else if("cubic-bezier"===t.name){const o=t.controlPoints;n=new Re(o[0],o[1],o[2],o[3]).solve(wa(e,1,r,i))}return n}static parse(t,e){let[r,i,n,...o]=t;if(!Array.isArray(i)||0===i.length)return e.error("Expected an interpolation type expression.",1);if("linear"===i[0])i={name:"linear"};else if("exponential"===i[0]){const t=i[1];if("number"!=typeof t)return e.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:t}}else{if("cubic-bezier"!==i[0])return e.error(`Unknown interpolation type ${String(i[0])}`,1,0);{const t=i.slice(1);if(4!==t.length||t.some((t=>"number"!=typeof t||t<0||t>1)))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:t}}}if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(n=e.parse(n,2,$i),!n)return null;const a=[];let s=null;"interpolate-hcl"===r||"interpolate-lab"===r?s=tn:e.expectedType&&"value"!==e.expectedType.kind&&(s=e.expectedType);for(let t=0;t<o.length;t+=2){const r=o[t],i=o[t+1],n=t+3,l=t+4;if("number"!=typeof r)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',n);if(a.length&&a[a.length-1][0]>=r)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',n);const c=e.parse(i,l,s);if(!c)return null;s=s||c.type,a.push([r,c])}return"number"===s.kind||"color"===s.kind||"array"===s.kind&&"number"===s.itemType.kind&&"number"==typeof s.N?new xa(s,r,i,n,a):e.error(`Type ${ln(s)} is not interpolatable.`)}evaluate(t){const e=this.labels,r=this.outputs;if(1===e.length)return r[0].evaluate(t);const i=this.input.evaluate(t);if(i<=e[0])return r[0].evaluate(t);const n=e.length;if(i>=e[n-1])return r[n-1].evaluate(t);const o=ea(e,i),a=xa.interpolationFactor(this.interpolation,i,e[o],e[o+1]),s=r[o].evaluate(t),l=r[o+1].evaluate(t);return"interpolate"===this.operator?Ki[this.type.kind.toLowerCase()](s,l,a):"interpolate-hcl"===this.operator?ya.reverse(ya.interpolate(ya.forward(s),ya.forward(l),a)):_a.reverse(_a.interpolate(_a.forward(s),_a.forward(l),a))}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const e=[this.operator,t,this.input.serialize()];for(let t=0;t<this.labels.length;t++)e.push(this.labels[t],this.outputs[t].serialize());return e}}function wa(t,e,r,i){const n=i-r,o=t-r;return 0===n?0:1===e?o/n:(Math.pow(e,o)-1)/(Math.pow(e,n)-1)}class ba{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expectected at least one argument.");let r=null;const i=e.expectedType;i&&"value"!==i.kind&&(r=i);const n=[];for(const i of t.slice(1)){const t=e.parse(i,1+n.length,r,void 0,{typeAnnotation:"omit"});if(!t)return null;r=r||t.type,n.push(t)}const o=i&&n.some((t=>un(i,t.type)));return new ba(o?rn:r,n)}evaluate(t){let e,r=null,i=0;for(const n of this.args){if(i++,r=n.evaluate(t),r&&r instanceof mn&&!r.available&&(e||(e=r),r=null,i===this.args.length))return e;if(null!==r)break}return r}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){const t=["coalesce"];return this.eachChild((e=>{t.push(e.serialize())})),t}}class Ba{constructor(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const e of this.bindings)t(e[1]);t(this.result)}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const r=[];for(let i=1;i<t.length-1;i+=2){const n=t[i];if("string"!=typeof n)return e.error(`Expected string, but found ${typeof n} instead.`,i);if(/[^a-zA-Z0-9_]/.test(n))return e.error("Variable names must contain only alphanumeric characters or '_'.",i);const o=e.parse(t[i+1],i+1);if(!o)return null;r.push([n,o])}const i=e.parse(t[t.length-1],t.length-1,e.expectedType,r);return i?new Ba(r,i):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[e,r]of this.bindings)t.push(e,r.serialize());return t.push(this.result.serialize()),t}}class Ca{constructor(t,e,r){this.type=t,this.index=e,this.input=r}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const r=e.parse(t[1],1,$i),i=e.parse(t[2],2,sn(e.expectedType||rn));return r&&i?new Ca(i.type.itemType,r,i):null}evaluate(t){const e=this.index.evaluate(t),r=this.input.evaluate(t);if(e<0)throw new wn(`Array index out of bounds: ${e} < 0.`);if(e>=r.length)throw new wn(`Array index out of bounds: ${e} > ${r.length-1}.`);if(e!==Math.floor(e))throw new wn(`Array index must be an integer, but found ${e} instead.`);return r[e]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Ea{constructor(t,e){this.type=Ji,this.needle=t,this.haystack=e}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const r=e.parse(t[1],1,rn),i=e.parse(t[2],2,rn);return r&&i?hn(r.type,[Ji,Yi,$i,Xi,rn])?new Ea(r,i):e.error(`Expected first argument to be of type boolean, string, number or null, but found ${ln(r.type)} instead`):null}evaluate(t){const e=this.needle.evaluate(t),r=this.haystack.evaluate(t);if(null==r)return!1;if(!An(e,["boolean","string","number","null"]))throw new wn(`Expected first argument to be of type boolean, string, number or null, but found ${ln(yn(e))} instead.`);if(!An(r,["string","array"]))throw new wn(`Expected second argument to be of type array or string, but found ${ln(yn(r))} instead.`);return r.indexOf(e)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Ta{constructor(t,e,r){this.type=$i,this.needle=t,this.haystack=e,this.fromIndex=r}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const r=e.parse(t[1],1,rn),i=e.parse(t[2],2,rn);if(!r||!i)return null;if(!hn(r.type,[Ji,Yi,$i,Xi,rn]))return e.error(`Expected first argument to be of type boolean, string, number or null, but found ${ln(r.type)} instead`);if(4===t.length){const n=e.parse(t[3],3,$i);return n?new Ta(r,i,n):null}return new Ta(r,i)}evaluate(t){const e=this.needle.evaluate(t),r=this.haystack.evaluate(t);if(!An(e,["boolean","string","number","null"]))throw new wn(`Expected first argument to be of type boolean, string, number or null, but found ${ln(yn(e))} instead.`);if(!An(r,["string","array"]))throw new wn(`Expected second argument to be of type array or string, but found ${ln(yn(r))} instead.`);if(this.fromIndex){const i=this.fromIndex.evaluate(t);return r.indexOf(e,i)}return r.indexOf(e)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Ia{constructor(t,e,r,i,n,o){this.inputType=t,this.type=e,this.input=r,this.cases=i,this.outputs=n,this.otherwise=o}static parse(t,e){if(t.length<5)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return e.error("Expected an even number of arguments.");let r,i;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);const n={},o=[];for(let a=2;a<t.length-1;a+=2){let s=t[a];const l=t[a+1];Array.isArray(s)||(s=[s]);const c=e.concat(a);if(0===s.length)return c.error("Expected at least one branch label.");for(const t of s){if("number"!=typeof t&&"string"!=typeof t)return c.error("Branch labels must be numbers or strings.");if("number"==typeof t&&Math.abs(t)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof t&&Math.floor(t)!==t)return c.error("Numeric branch labels must be integer values.");if(r){if(c.checkSubtype(r,yn(t)))return null}else r=yn(t);if(void 0!==n[String(t)])return c.error("Branch labels must be unique.");n[String(t)]=o.length}const u=e.parse(l,a,i);if(!u)return null;i=i||u.type,o.push(u)}const a=e.parse(t[1],1,rn);if(!a)return null;const s=e.parse(t[t.length-1],t.length-1,i);return s?"value"!==a.type.kind&&e.concat(1).checkSubtype(r,a.type)?null:new Ia(r,i,a,n,o,s):null}evaluate(t){const e=this.input.evaluate(t);return(yn(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],e=Object.keys(this.cases).sort(),r=[],i={};for(const t of e){const e=i[this.cases[t]];void 0===e?(i[this.cases[t]]=r.length,r.push([this.cases[t],[t]])):r[e][1].push(t)}const n=t=>"number"===this.inputType.kind?Number(t):t;for(const[e,i]of r)t.push(1===i.length?n(i[0]):i.map(n)),t.push(this.outputs[e].serialize());return t.push(this.otherwise.serialize()),t}}class Sa{constructor(t,e,r){this.type=t,this.branches=e,this.otherwise=r}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return e.error("Expected an odd number of arguments.");let r;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);const i=[];for(let n=1;n<t.length-1;n+=2){const o=e.parse(t[n],n,Ji);if(!o)return null;const a=e.parse(t[n+1],n+1,r);if(!a)return null;i.push([o,a]),r=r||a.type}const n=e.parse(t[t.length-1],t.length-1,r);return n?new Sa(r,i,n):null}evaluate(t){for(const[e,r]of this.branches)if(e.evaluate(t))return r.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[e,r]of this.branches)t(e),t(r);t(this.otherwise)}outputDefined(){return this.branches.every((([t,e])=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild((e=>{t.push(e.serialize())})),t}}class Ma{constructor(t,e,r,i){this.type=t,this.input=e,this.beginIndex=r,this.endIndex=i}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const r=e.parse(t[1],1,rn),i=e.parse(t[2],2,$i);if(!r||!i)return null;if(!hn(r.type,[sn(rn),Yi,rn]))return e.error(`Expected first argument to be of type array or string, but found ${ln(r.type)} instead`);if(4===t.length){const n=e.parse(t[3],3,$i);return n?new Ma(r.type,r,i,n):null}return new Ma(r.type,r,i)}evaluate(t){const e=this.input.evaluate(t),r=this.beginIndex.evaluate(t);if(!An(e,["string","array"]))throw new wn(`Expected first argument to be of type array or string, but found ${ln(yn(e))} instead.`);if(this.endIndex){const i=this.endIndex.evaluate(t);return e.slice(r,i)}return e.slice(r)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Fa(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function Pa(t,e,r,i){return 0===i.compare(e,r)}function La(t,e,r){const i="=="!==t&&"!="!==t;return class n{constructor(t,e,r){this.type=Ji,this.lhs=t,this.rhs=e,this.collator=r,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}static parse(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");const r=t[0];let o=e.parse(t[1],1,rn);if(!o)return null;if(!Fa(r,o.type))return e.concat(1).error(`"${r}" comparisons are not supported for type '${ln(o.type)}'.`);let a=e.parse(t[2],2,rn);if(!a)return null;if(!Fa(r,a.type))return e.concat(2).error(`"${r}" comparisons are not supported for type '${ln(a.type)}'.`);if(o.type.kind!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return e.error(`Cannot compare types '${ln(o.type)}' and '${ln(a.type)}'.`);i&&("value"===o.type.kind&&"value"!==a.type.kind?o=new Bn(a.type,[o]):"value"!==o.type.kind&&"value"===a.type.kind&&(a=new Bn(o.type,[a])));let s=null;if(4===t.length){if("string"!==o.type.kind&&"string"!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return e.error("Cannot use collator to compare non-string types.");if(s=e.parse(t[3],3,nn),!s)return null}return new n(o,a,s)}evaluate(n){const o=this.lhs.evaluate(n),a=this.rhs.evaluate(n);if(i&&this.hasUntypedArgument){const e=yn(o),r=yn(a);if(e.kind!==r.kind||"string"!==e.kind&&"number"!==e.kind)throw new wn(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${e.kind}, ${r.kind}) instead.`)}if(this.collator&&!i&&this.hasUntypedArgument){const t=yn(o),r=yn(a);if("string"!==t.kind||"string"!==r.kind)return e(n,o,a)}return this.collator?r(n,o,a,this.collator.evaluate(n)):e(n,o,a)}eachChild(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)}outputDefined(){return!0}serialize(){const e=[t];return this.eachChild((t=>{e.push(t.serialize())})),e}}}const Da=La("==",(function(t,e,r){return e===r}),Pa),Ua=La("!=",(function(t,e,r){return e!==r}),(function(t,e,r,i){return!Pa(0,e,r,i)})),ka=La("<",(function(t,e,r){return e<r}),(function(t,e,r,i){return i.compare(e,r)<0})),za=La(">",(function(t,e,r){return e>r}),(function(t,e,r,i){return i.compare(e,r)>0})),Ra=La("<=",(function(t,e,r){return e<=r}),(function(t,e,r,i){return i.compare(e,r)<=0})),Oa=La(">=",(function(t,e,r){return e>=r}),(function(t,e,r,i){return i.compare(e,r)>=0}));class Qa{constructor(t,e,r,i,n,o){this.type=Yi,this.number=t,this.locale=e,this.currency=r,this.unit=i,this.minFractionDigits=n,this.maxFractionDigits=o}static parse(t,e){if(3!==t.length)return e.error("Expected two arguments.");const r=e.parse(t[1],1,$i);if(!r)return null;const i=t[2];if("object"!=typeof i||Array.isArray(i))return e.error("NumberFormat options argument must be an object.");let n=null;if(i.locale&&(n=e.parse(i.locale,1,Yi),!n))return null;let o=null;if(i.currency&&(o=e.parse(i.currency,1,Yi),!o))return null;let a=null;if(i.unit&&(a=e.parse(i.unit,1,Yi),!a))return null;let s=null;if(i["min-fraction-digits"]&&(s=e.parse(i["min-fraction-digits"],1,$i),!s))return null;let l=null;return i["max-fraction-digits"]&&(l=e.parse(i["max-fraction-digits"],1,$i),!l)?null:new Qa(r,n,o,a,s,l)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class Na{constructor(t){this.type=$i,this.input=t}static parse(t,e){if(2!==t.length)return e.error(`Expected 1 argument, but found ${t.length-1} instead.`);const r=e.parse(t[1],1);return r?"array"!==r.type.kind&&"string"!==r.type.kind&&"value"!==r.type.kind?e.error(`Expected argument of type string or array, but found ${ln(r.type)} instead.`):new Na(r):null}evaluate(t){const e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new wn(`Expected value to be of type string or array, but found ${ln(yn(e))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild((e=>{t.push(e.serialize())})),t}}function Va(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Ha={"==":Da,"!=":Ua,">":za,"<":ka,">=":Oa,"<=":Ra,array:Bn,at:Ca,boolean:Bn,case:Sa,coalesce:ba,collator:Dn,format:Cn,image:En,in:Ea,"index-of":Ta,interpolate:xa,"interpolate-hcl":xa,"interpolate-lab":xa,length:Na,let:Ba,literal:xn,match:Ia,number:Bn,"number-format":Qa,object:Bn,slice:Ma,step:ra,string:Bn,"to-boolean":Sn,"to-color":Sn,"to-number":Sn,"to-string":Sn,var:$o,within:ro,distance:Ho,config:Ko};function ja(t,[e,r,i,n]){e=e.evaluate(t),r=r.evaluate(t),i=i.evaluate(t);const o=n?n.evaluate(t):1,a=gn(e,r,i,o);if(a)throw new wn(a);return new Vi(e/255*o,r/255*o,i/255*o,o)}function Ga(t,[e,r,i,n]){e=e.evaluate(t),r=r.evaluate(t),i=i.evaluate(t);const o=n?n.evaluate(t):1,a=function(t,e,r,i){return"number"==typeof t&&t>=0&&t<=360?"number"==typeof e&&e>=0&&e<=100&&"number"==typeof r&&r>=0&&r<=100?void 0===i||"number"==typeof i&&i>=0&&i<=1?null:`Invalid hsla value [${[t,e,r,i].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${("number"==typeof i?[t,e,r,i]:[t,e,r]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${("number"==typeof i?[t,e,r,i]:[t,e,r]).join(", ")}]: 'h' must be between 0 and 360.`}(e,r,i,o);if(a)throw new wn(a);const s=`hsla(${e}, ${r}%, ${i}%, ${o})`,l=Vi.parse(s);if(!l)throw new wn(`Failed to parse HSLA color: ${s}`);return l}function Ka(t,e){return t in e}function qa(t,e){const r=e[t];return void 0===r?null:r}function Za(t){return{type:t}}function Wa(t){return{result:"success",value:t}}function Xa(t){return{result:"error",value:t}}function $a(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function Ya(t){return"data-driven"===t["property-type"]}function Ja(t){return $a(t.expression,"measure-light")}function ts(t){return $a(t.expression,"zoom")}function es(t){return!!t.expression&&t.expression.interpolated}function rs(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function is(t){return t}function ns(t,e){const r="color"===e.type,i=t.stops&&"object"==typeof t.stops[0][0],n=i||!(i||void 0!==t.property),o=t.type||(es(e)?"exponential":"interval");if(r&&((t=qi({},t)).stops&&(t.stops=t.stops.map((t=>[t[0],Vi.parse(t[1])]))),t.default=Vi.parse(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!va[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let a,s,l;if("exponential"===o)a=ls;else if("interval"===o)a=ss;else if("categorical"===o){a=as,s=Object.create(null);for(const e of t.stops)s[e[0]]=e[1];l=typeof t.stops[0][0]}else{if("identity"!==o)throw new Error(`Unknown function type "${o}"`);a=cs}if(i){const r={},i=[];for(let e=0;e<t.stops.length;e++){const n=t.stops[e],o=n[0].zoom;void 0===r[o]&&(r[o]={zoom:o,type:t.type,property:t.property,default:t.default,stops:[]},i.push(o)),r[o].stops.push([n[0].value,n[1]])}const n=[];for(const t of i)n.push([r[t].zoom,ns(r[t],e)]);const o={name:"linear"};return{kind:"composite",interpolationType:o,interpolationFactor:xa.interpolationFactor.bind(void 0,o),zoomStops:n.map((t=>t[0])),evaluate:({zoom:r},i)=>ls({stops:n,base:t.base},e,r).evaluate(r,i)}}if(n){const r="exponential"===o?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:r,interpolationFactor:xa.interpolationFactor.bind(void 0,r),zoomStops:t.stops.map((t=>t[0])),evaluate:({zoom:r})=>a(t,e,r,s,l)}}return{kind:"source",evaluate(r,i){const n=i&&i.properties?i.properties[t.property]:void 0;return void 0===n?os(t.default,e.default):a(t,e,n,s,l)}}}function os(t,e,r){return void 0!==t?t:void 0!==e?e:void 0!==r?r:void 0}function as(t,e,r,i,n){return os(typeof r===n?i[r]:void 0,t.default,e.default)}function ss(t,e,r){if("number"!==Tn(r))return os(t.default,e.default);const i=t.stops.length;if(1===i)return t.stops[0][1];if(r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[i-1][0])return t.stops[i-1][1];const n=ea(t.stops.map((t=>t[0])),r);return t.stops[n][1]}function ls(t,e,r){const i=void 0!==t.base?t.base:1;if("number"!==Tn(r))return os(t.default,e.default);const n=t.stops.length;if(1===n)return t.stops[0][1];if(r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[n-1][0])return t.stops[n-1][1];const o=ea(t.stops.map((t=>t[0])),r),a=function(t,e,r,i){const n=i-r,o=t-r;return 0===n?0:1===e?o/n:(Math.pow(e,o)-1)/(Math.pow(e,n)-1)}(r,i,t.stops[o][0],t.stops[o+1][0]),s=t.stops[o][1],l=t.stops[o+1][1];let c=Ki[e.type]||is;if(t.colorSpace&&"rgb"!==t.colorSpace){const e=va[t.colorSpace];c=(t,r)=>e.reverse(e.interpolate(e.forward(t),e.forward(r),a))}return"function"==typeof s.evaluate?{evaluate(...t){const e=s.evaluate.apply(void 0,t),r=l.evaluate.apply(void 0,t);if(void 0!==e&&void 0!==r)return c(e,r,a)}}:c(s,l,a)}function cs(t,e,r){return"color"===e.type?r=Vi.parse(r):"formatted"===e.type?r=fn.fromString(r.toString()):"resolvedImage"===e.type?r=mn.fromString(r.toString()):Tn(r)===e.type||"enum"===e.type&&e.values[r]||(r=void 0),os(r,t.default,e.default)}Pn.register(Ha,{error:[{kind:"error"},[Yi],(t,[e])=>{throw new wn(e.evaluate(t))}],typeof:[Yi,[rn],(t,[e])=>ln(yn(e.evaluate(t)))],"to-rgba":[sn($i,4),[tn],(t,[e])=>e.evaluate(t).toRenderColor(null).toArray()],rgb:[tn,[$i,$i,$i],ja],rgba:[tn,[$i,$i,$i,$i],ja],hsl:[tn,[$i,$i,$i],Ga],hsla:[tn,[$i,$i,$i,$i],Ga],has:{type:Ji,overloads:[[[Yi],(t,[e])=>Ka(e.evaluate(t),t.properties())],[[Yi,en],(t,[e,r])=>Ka(e.evaluate(t),r.evaluate(t))]]},get:{type:rn,overloads:[[[Yi],(t,[e])=>qa(e.evaluate(t),t.properties())],[[Yi,en],(t,[e,r])=>qa(e.evaluate(t),r.evaluate(t))]]},"feature-state":[rn,[Yi],(t,[e])=>qa(e.evaluate(t),t.featureState||{})],properties:[en,[],t=>t.properties()],"geometry-type":[Yi,[],t=>t.geometryType()],id:[rn,[],t=>t.id()],zoom:[$i,[],t=>t.globals.zoom],pitch:[$i,[],t=>t.globals.pitch||0],"distance-from-center":[$i,[],t=>t.distanceFromCenter()],"measure-light":[$i,[Yi],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[$i,[],t=>t.globals.heatmapDensity||0],"line-progress":[$i,[],t=>t.globals.lineProgress||0],"raster-value":[$i,[],t=>t.globals.rasterValue||0],"raster-particle-speed":[$i,[],t=>t.globals.rasterParticleSpeed||0],"sky-radial-progress":[$i,[],t=>t.globals.skyRadialProgress||0],accumulated:[rn,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[$i,Za($i),(t,e)=>{let r=0;for(const i of e)r+=i.evaluate(t);return r}],"*":[$i,Za($i),(t,e)=>{let r=1;for(const i of e)r*=i.evaluate(t);return r}],"-":{type:$i,overloads:[[[$i,$i],(t,[e,r])=>e.evaluate(t)-r.evaluate(t)],[[$i],(t,[e])=>-e.evaluate(t)]]},"/":[$i,[$i,$i],(t,[e,r])=>e.evaluate(t)/r.evaluate(t)],"%":[$i,[$i,$i],(t,[e,r])=>e.evaluate(t)%r.evaluate(t)],ln2:[$i,[],()=>Math.LN2],pi:[$i,[],()=>Math.PI],e:[$i,[],()=>Math.E],"^":[$i,[$i,$i],(t,[e,r])=>Math.pow(e.evaluate(t),r.evaluate(t))],sqrt:[$i,[$i],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[$i,[$i],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[$i,[$i],(t,[e])=>Math.log(e.evaluate(t))],log2:[$i,[$i],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[$i,[$i],(t,[e])=>Math.sin(e.evaluate(t))],cos:[$i,[$i],(t,[e])=>Math.cos(e.evaluate(t))],tan:[$i,[$i],(t,[e])=>Math.tan(e.evaluate(t))],asin:[$i,[$i],(t,[e])=>Math.asin(e.evaluate(t))],acos:[$i,[$i],(t,[e])=>Math.acos(e.evaluate(t))],atan:[$i,[$i],(t,[e])=>Math.atan(e.evaluate(t))],min:[$i,Za($i),(t,e)=>Math.min(...e.map((e=>e.evaluate(t))))],max:[$i,Za($i),(t,e)=>Math.max(...e.map((e=>e.evaluate(t))))],abs:[$i,[$i],(t,[e])=>Math.abs(e.evaluate(t))],round:[$i,[$i],(t,[e])=>{const r=e.evaluate(t);return r<0?-Math.round(-r):Math.round(r)}],floor:[$i,[$i],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[$i,[$i],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Ji,[Yi,rn],(t,[e,r])=>t.properties()[e.value]===r.value],"filter-id-==":[Ji,[rn],(t,[e])=>t.id()===e.value],"filter-type-==":[Ji,[Yi],(t,[e])=>t.geometryType()===e.value],"filter-<":[Ji,[Yi,rn],(t,[e,r])=>{const i=t.properties()[e.value],n=r.value;return typeof i==typeof n&&i<n}],"filter-id-<":[Ji,[rn],(t,[e])=>{const r=t.id(),i=e.value;return typeof r==typeof i&&r<i}],"filter->":[Ji,[Yi,rn],(t,[e,r])=>{const i=t.properties()[e.value],n=r.value;return typeof i==typeof n&&i>n}],"filter-id->":[Ji,[rn],(t,[e])=>{const r=t.id(),i=e.value;return typeof r==typeof i&&r>i}],"filter-<=":[Ji,[Yi,rn],(t,[e,r])=>{const i=t.properties()[e.value],n=r.value;return typeof i==typeof n&&i<=n}],"filter-id-<=":[Ji,[rn],(t,[e])=>{const r=t.id(),i=e.value;return typeof r==typeof i&&r<=i}],"filter->=":[Ji,[Yi,rn],(t,[e,r])=>{const i=t.properties()[e.value],n=r.value;return typeof i==typeof n&&i>=n}],"filter-id->=":[Ji,[rn],(t,[e])=>{const r=t.id(),i=e.value;return typeof r==typeof i&&r>=i}],"filter-has":[Ji,[rn],(t,[e])=>e.value in t.properties()],"filter-has-id":[Ji,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[Ji,[sn(Yi)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Ji,[sn(rn)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Ji,[Yi,sn(rn)],(t,[e,r])=>r.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Ji,[Yi,sn(rn)],(t,[e,r])=>function(t,e,r,i){for(;r<=i;){const n=r+i>>1;if(e[n]===t)return!0;e[n]>t?i=n-1:r=n+1}return!1}(t.properties()[e.value],r.value,0,r.value.length-1)],all:{type:Ji,overloads:[[[Ji,Ji],(t,[e,r])=>e.evaluate(t)&&r.evaluate(t)],[Za(Ji),(t,e)=>{for(const r of e)if(!r.evaluate(t))return!1;return!0}]]},any:{type:Ji,overloads:[[[Ji,Ji],(t,[e,r])=>e.evaluate(t)||r.evaluate(t)],[Za(Ji),(t,e)=>{for(const r of e)if(r.evaluate(t))return!0;return!1}]]},"!":[Ji,[Ji],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Ji,[Yi],(t,[e])=>{const r=t.globals&&t.globals.isSupportedScript;return!r||r(e.evaluate(t))}],upcase:[Yi,[Yi],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Yi,[Yi],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Yi,Za(rn),(t,e)=>e.map((e=>vn(e.evaluate(t)))).join("")],"resolved-locale":[Yi,[nn],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[$i,[$i,$i,rn],(t,e)=>{const[r,i,n]=e.map((e=>e.evaluate(t)));if(r>i)return r;if(r===i)return r;let o;if("string"==typeof n)o=function(t){let e=0;if(0===t.length)return e;for(let r=0;r<t.length;r++)e=(e<<5)-e+t.charCodeAt(r),e|=0;return e}(n);else{if("number"!=typeof n)throw new wn(`Invalid seed input: ${n}`);o=n}return r+Va(o)()*(i-r)}]});class us{constructor(t,e,r,i){this.expression=t,this._warningHistory={},this._evaluator=new Fn(r,i),this._defaultValue=e?function(t){return"color"===t.type&&(rs(t.default)||Array.isArray(t.default))?new Vi(0,0,0,0):"color"===t.type?Vi.parse(t.default)||null:void 0===t.default?null:t.default}(e):null,this._enumValues=e&&"enum"===e.type?e.values:null}evaluateWithoutErrorHandling(t,e,r,i,n,o,a,s){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=r,this._evaluator.canonical=i||null,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=s||null,this.expression.evaluate(this._evaluator)}evaluate(t,e,r,i,n,o,a,s){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=r||null,this._evaluator.canonical=i||null,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o||null,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=s||null;try{const t=this.expression.evaluate(this._evaluator);if(null==t||"number"==typeof t&&t!=t)return this._defaultValue;if(this._enumValues&&!(t in this._enumValues))throw new wn(`Expected value to be one of ${Object.keys(this._enumValues).map((t=>JSON.stringify(t))).join(", ")}, but found ${JSON.stringify(t)} instead.`);return t}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}}}function hs(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Ha}function As(t,e,r,i){const n=new Jo(Ha,[],e?function(t){const e={color:tn,string:Yi,number:$i,enum:Yi,boolean:Ji,formatted:on,resolvedImage:an};return"array"===t.type?sn(e[t.value]||rn,t.length):e[t.type]}(e):void 0,void 0,void 0,r,i),o=n.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return o?Wa(new us(o,e,r,i)):Xa(n.errors)}class ps{constructor(t,e,r){this.kind=t,this._styleExpression=e,this.isLightConstant=r,this.isStateDependent="constant"!==t&&!Zo(e.expression),this.isConfigDependent=!Wo(e.expression)}evaluateWithoutErrorHandling(t,e,r,i,n,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r,i,n,o)}evaluate(t,e,r,i,n,o){return this._styleExpression.evaluate(t,e,r,i,n,o)}}class ds{constructor(t,e,r,i,n){this.kind=t,this.zoomStops=r,this._styleExpression=e,this.isStateDependent="camera"!==t&&!Zo(e.expression),this.isLightConstant=n,this.isConfigDependent=!Wo(e.expression),this.interpolationType=i}evaluateWithoutErrorHandling(t,e,r,i,n,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r,i,n,o)}evaluate(t,e,r,i,n,o){return this._styleExpression.evaluate(t,e,r,i,n,o)}interpolationFactor(t,e,r){return this.interpolationType?xa.interpolationFactor(this.interpolationType,t,e,r):0}}function fs(t,e,r,i){if("error"===(t=As(t,e,r,i)).result)return t;const n=t.value.expression,o=qo(n);if(!o&&!Ya(e))return Xa([new Zi("","data expressions not supported")]);const a=Xo(n,["zoom","pitch","distance-from-center"]);if(!a&&!ts(e))return Xa([new Zi("","zoom expressions not supported")]);const s=Xo(n,["measure-light"]);if(!s&&!Ja(e))return Xa([new Zi("","measure-light expression not supported")]);const l=e.expression&&e.expression.relaxZoomRestriction,c=gs(n);return c||a||l?c instanceof Zi?Xa([c]):c instanceof xa&&!es(e)?Xa([new Zi("",'"interpolate" expressions cannot be used with this property')]):Wa(c?new ds(o?"camera":"composite",t.value,c.labels,c instanceof xa?c.interpolation:void 0,s):new ps(o?"constant":"source",t.value,s)):Xa([new Zi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class ms{constructor(t,e){this._parameters=t,this._specification=e,qi(this,ns(this._parameters,this._specification))}static deserialize(t){return new ms(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function gs(t){let e=null;if(t instanceof Ba)e=gs(t.result);else if(t instanceof ba){for(const r of t.args)if(e=gs(r),e)break}else(t instanceof ra||t instanceof xa)&&t.input instanceof Pn&&"zoom"===t.input.name&&(e=t);return e instanceof Zi||t.eachChild((t=>{const r=gs(t);r instanceof Zi?e=r:e&&r&&e!==r&&(e=new Zi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}var _s=vs,ys=3;function vs(t,e,r){var i=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var n=new Int32Array(this.arrayBuffer);t=n[0],this.d=(e=n[1])+2*(r=n[2]);for(var o=0;o<this.d*this.d;o++){var a=n[ys+o],s=n[ys+o+1];i.push(a===s?null:n.subarray(a,s))}var l=n[ys+i.length+1];this.keys=n.subarray(n[ys+i.length],l),this.bboxes=n.subarray(l),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var c=0;c<this.d*this.d;c++)i.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=r,this.scale=e/t,this.uid=0;var u=r/e*t;this.min=-u,this.max=t+u}vs.prototype.insert=function(t,e,r,i,n){this._forEachCell(e,r,i,n,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(i),this.bboxes.push(n)},vs.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},vs.prototype._insertCell=function(t,e,r,i,n,o){this.cells[n].push(o)},vs.prototype.query=function(t,e,r,i,n){var o=this.min,a=this.max;if(t<=o&&e<=o&&a<=r&&a<=i&&!n)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(t,e,r,i,this._queryCell,s,{},n),s},vs.prototype._queryCell=function(t,e,r,i,n,o,a,s){var l=this.cells[n];if(null!==l)for(var c=this.keys,u=this.bboxes,h=0;h<l.length;h++){var A=l[h];if(void 0===a[A]){var p=4*A;(s?s(u[p+0],u[p+1],u[p+2],u[p+3]):t<=u[p+2]&&e<=u[p+3]&&r>=u[p+0]&&i>=u[p+1])?(a[A]=!0,o.push(c[A])):a[A]=!1}}},vs.prototype._forEachCell=function(t,e,r,i,n,o,a,s){for(var l=this._convertToCellCoord(t),c=this._convertToCellCoord(e),u=this._convertToCellCoord(r),h=this._convertToCellCoord(i),A=l;A<=u;A++)for(var p=c;p<=h;p++){var d=this.d*p+A;if((!s||s(this._convertFromCellCoord(A),this._convertFromCellCoord(p),this._convertFromCellCoord(A+1),this._convertFromCellCoord(p+1)))&&n.call(this,t,e,r,i,d,o,a,s))return}},vs.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},vs.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},vs.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=ys+this.cells.length+1+1,r=0,i=0;i<this.cells.length;i++)r+=this.cells[i].length;var n=new Int32Array(e+r+this.keys.length+this.bboxes.length);n[0]=this.extent,n[1]=this.n,n[2]=this.padding;for(var o=e,a=0;a<t.length;a++){var s=t[a];n[ys+a]=o,n.set(s,o),o+=s.length}return n[ys+t.length]=o,n.set(this.keys,o),n[ys+t.length+1]=o+=this.keys.length,n.set(this.bboxes,o),o+=this.bboxes.length,n.buffer};var xs=A(_s);const ws={};function bs(t,e,r={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writable:!1}),ws[e]={klass:t,omit:r.omit||[]}}bs(Object,"Object"),xs.serialize=function(t,e){const r=t.toArrayBuffer();return e&&e.add(r),{buffer:r}},xs.deserialize=function(t){return new xs(t.buffer)},Object.defineProperty(xs,"name",{value:"Grid"}),bs(xs,"Grid"),bs(Vi,"Color"),bs(Error,"Error"),bs(fn,"Formatted"),bs(dn,"FormattedSection"),bs(Yr,"AJAXError"),bs(mn,"ResolvedImage"),bs(ms,"StylePropertyFunction"),bs(us,"StyleExpression",{omit:["_evaluator"]}),bs(ds,"ZoomDependentExpression"),bs(ps,"ZoomConstantExpression"),bs(Pn,"CompoundExpression",{omit:["_evaluate"]});for(const t in Ha)ws[Ha[t]._classRegistryKey]||bs(Ha[t],`Expression${t}`);function Bs(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function Cs(t){return self.ImageBitmap&&t instanceof ImageBitmap}function Es(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Bs(t)||Cs(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){const r=t;return e&&e.add(r.buffer),r}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){const r=[];for(const i of t)r.push(Es(i,e));return r}if(t instanceof Map){const e={$name:"Map"};for(const[r,i]of t.entries())e[r]=Es(i);return e}if("object"==typeof t){const r=t.constructor,i=r._classRegistryKey;if(!i)throw new Error(`can't serialize object of unregistered class ${i}`);const n=r.serialize?r.serialize(t,e):{};if(!r.serialize){for(const r in t)t.hasOwnProperty(r)&&(ws[i].omit.indexOf(r)>=0||(n[r]=Es(t[r],e)));t instanceof Error&&(n.message=t.message)}if(n.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==i&&(n.$name=i),n}throw new Error("can't serialize object of type "+typeof t)}function Ts(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Bs(t)||Cs(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(Ts);if("object"==typeof t){const e=t.$name||"Object";if("Map"===e){const e=new Map;for(const r of Object.keys(t))"$name"!==r&&e.set(r,Ts(t[r]));return e}const{klass:r}=ws[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(t);const i=Object.create(r.prototype);for(const e of Object.keys(t))"$name"!==e&&(i[e]=Ts(t[e]));return i}throw new Error("can't deserialize object of type "+typeof t)}const Is={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function Ss(t){for(const e of t)if(Ps(e.charCodeAt(0)))return!0;return!1}function Ms(t){for(const e of t)if(!Fs(e.charCodeAt(0)))return!1;return!0}function Fs(t){return!(Is.Arabic(t)||Is["Arabic Supplement"](t)||Is["Arabic Extended-A"](t)||Is["Arabic Presentation Forms-A"](t)||Is["Arabic Presentation Forms-B"](t))}function Ps(t){return!(746!==t&&747!==t&&(t<4352||!(Is["Bopomofo Extended"](t)||Is.Bopomofo(t)||Is["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Is["CJK Compatibility Ideographs"](t)||Is["CJK Compatibility"](t)||Is["CJK Radicals Supplement"](t)||Is["CJK Strokes"](t)||!(!Is["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||Is["CJK Unified Ideographs Extension A"](t)||Is["CJK Unified Ideographs"](t)||Is["Enclosed CJK Letters and Months"](t)||Is["Hangul Compatibility Jamo"](t)||Is["Hangul Jamo Extended-A"](t)||Is["Hangul Jamo Extended-B"](t)||Is["Hangul Jamo"](t)||Is["Hangul Syllables"](t)||Is.Hiragana(t)||Is["Ideographic Description Characters"](t)||Is.Kanbun(t)||Is["Kangxi Radicals"](t)||Is["Katakana Phonetic Extensions"](t)||Is.Katakana(t)&&12540!==t||!(!Is["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!Is["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Is["Unified Canadian Aboriginal Syllabics"](t)||Is["Unified Canadian Aboriginal Syllabics Extended"](t)||Is["Vertical Forms"](t)||Is["Yijing Hexagram Symbols"](t)||Is["Yi Syllables"](t)||Is["Yi Radicals"](t))))}function Ls(t){return!(Ps(t)||function(t){return!!(Is["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||Is["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||Is["Letterlike Symbols"](t)||Is["Number Forms"](t)||Is["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||Is["Control Pictures"](t)&&9251!==t||Is["Optical Character Recognition"](t)||Is["Enclosed Alphanumerics"](t)||Is["Geometric Shapes"](t)||Is["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Is["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Is["CJK Symbols and Punctuation"](t)||Is.Katakana(t)||Is["Private Use Area"](t)||Is["CJK Compatibility Forms"](t)||Is["Small Form Variants"](t)||Is["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function Ds(t){return t>=1424&&t<=2303||Is["Arabic Presentation Forms-A"](t)||Is["Arabic Presentation Forms-B"](t)}function Us(t,e){return!(!e&&Ds(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Is.Khmer(t))}function ks(t){for(const e of t)if(Ds(e.charCodeAt(0)))return!0;return!1}const zs="deferred",Rs="loading",Os="loaded";let Qs=null,Ns="unavailable",Vs=null;const Hs=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(Ns="error"),Qs&&Qs(t)};function js(){Gs.fire(new Pi("pluginStateChange",{pluginStatus:Ns,pluginURL:Vs}))}const Gs=new ki,Ks=function(){return Ns},qs=function(){if(Ns!==zs||!Vs)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ns=Rs,js(),Vs&&ei({url:Vs},(t=>{t?Hs(t):(Ns=Os,js())}))},Zs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ns===Os||null!=Zs.applyArabicShaping,isLoading:()=>Ns===Rs,setState(t){Ns=t.pluginStatus,Vs=t.pluginURL},isParsed:()=>null!=Zs.applyArabicShaping&&null!=Zs.processBidirectionalText&&null!=Zs.processStyledBidirectionalText,getPluginURL:()=>Vs};class Ws{constructor(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.transition=e.transition,this.pitch=e.pitch,this.brightness=e.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(t){return function(t,e){for(const r of t)if(!Us(r.charCodeAt(0),e))return!1;return!0}(t,Zs.isLoaded())}}class Xs{constructor(t,e,r,i){this.property=t,this.value=e,this.expression=function(t,e,r,i){if(rs(t))return new ms(t,e);if(hs(t)||Array.isArray(t)&&t.length>0){const n=fs(t,e,r,i);if("error"===n.result)throw new Error(n.value.map((t=>`${t.key}: ${t.message}`)).join(", "));return n.value}{let r=t;return"string"==typeof t&&"color"===e.type&&(r=Vi.parse(t)),{kind:"constant",isConfigDependent:!1,evaluate:()=>r}}}(void 0===e?t.specification.default:e,t.specification,r,i)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,e,r){return this.property.possiblyEvaluate(this,t,e,r)}}class $s{constructor(t,e,r){this.property=t,this.value=new Xs(t,void 0,e,r)}transitioned(t,e){return new Js(this.property,this.value,e,er({},t.transition,this.transition),t.now)}untransitioned(){return new Js(this.property,this.value,null,{},0)}}class Ys{constructor(t,e,r){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._scope=e,this._options=r,this.isConfigDependent=!1}getValue(t){return hr(this._values[t].value.value)}setValue(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new $s(this._values[t].property,this._scope,this._options)),this._values[t].value=new Xs(this._values[t].property,null===e?void 0:hr(e),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].value.expression.isConfigDependent}setTransitionOrValue(t,e){e&&(this._options=e);const r=this._properties.properties;if(t)for(const e in t){const i=t[e];if(lr(e,"-transition")){const t=e.slice(0,-11);r[t]&&this.setTransition(t,i)}else r.hasOwnProperty(e)&&this.setValue(e,i)}}getTransition(t){return hr(this._values[t].transition)}setTransition(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new $s(this._values[t].property)),this._values[t].transition=hr(e)||void 0}serialize(){const t={};for(const e of Object.keys(this._values)){const r=this.getValue(e);void 0!==r&&(t[e]=r);const i=this.getTransition(e);void 0!==i&&(t[`${e}-transition`]=i)}return t}transitioned(t,e){const r=new tl(this._properties);for(const i of Object.keys(this._values))r._values[i]=this._values[i].transitioned(t,e._values[i]);return r}untransitioned(){const t=new tl(this._properties);for(const e of Object.keys(this._values))t._values[e]=this._values[e].untransitioned();return t}}class Js{constructor(t,e,r,i,n){const o=i.delay||0,a=i.duration||0;n=n||0,this.property=t,this.value=e,this.begin=n+o,this.end=this.begin+a,t.specification.transition&&(i.delay||i.duration)&&(this.prior=r)}possiblyEvaluate(t,e,r){const i=t.now||0,n=this.value.possiblyEvaluate(t,e,r),o=this.prior;if(o){if(i>this.end)return this.prior=null,n;if(this.value.isDataDriven())return this.prior=null,n;if(i<this.begin)return o.possiblyEvaluate(t,e,r);{const a=(i-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(t,e,r),n,qe(a))}}return n}}class tl{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,e,r){const i=new il(this._properties);for(const n of Object.keys(this._values))i._values[n]=this._values[n].possiblyEvaluate(t,e,r);return i}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class el{constructor(t,e,r){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._scope=e,this._options=r,this.isConfigDependent=!1}getValue(t){return hr(this._values[t].value)}setValue(t,e){this._values[t]=new Xs(this._values[t].property,null===e?void 0:hr(e),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].expression.isConfigDependent}serialize(){const t={};for(const e of Object.keys(this._values)){const r=this.getValue(e);void 0!==r&&(t[e]=r)}return t}possiblyEvaluate(t,e,r){const i=new il(this._properties);for(const n of Object.keys(this._values))i._values[n]=this._values[n].possiblyEvaluate(t,e,r);return i}}class rl{constructor(t,e,r){this.property=t,this.value=e,this.parameters=r}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,e,r,i){return this.property.evaluate(this.value,this.parameters,t,e,r,i)}}class il{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class nl{constructor(t){this.specification=t}possiblyEvaluate(t,e){return t.expression.evaluate(e)}interpolate(t,e,r){const i=Ki[this.specification.type];return i?i(t,e,r):t}}class ol{constructor(t,e){this.specification=t,this.overrides=e}possiblyEvaluate(t,e,r,i){return new rl(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},r,i)}:t.expression,e)}interpolate(t,e,r){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new rl(this,{kind:"constant",value:void 0},t.parameters);const i=Ki[this.specification.type];return i?new rl(this,{kind:"constant",value:i(t.value.value,e.value.value,r)},t.parameters):t}evaluate(t,e,r,i,n,o){return"constant"===t.kind?t.value:t.evaluate(e,r,i,n,o)}}class al{constructor(t){this.specification=t}possiblyEvaluate(t,e,r,i){return!!t.expression.evaluate(e,null,{},r,i)}interpolate(){return!1}}class sl{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const e=new Ws(0,{});for(const r in t){const i=t[r];i.specification.overridable&&this.overridableProperties.push(r);const n=this.defaultPropertyValues[r]=new Xs(i,void 0),o=this.defaultTransitionablePropertyValues[r]=new $s(i);this.defaultTransitioningPropertyValues[r]=o.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=n.possiblyEvaluate(e)}}}bs(ol,"DataDrivenProperty"),bs(nl,"DataConstantProperty"),bs(al,"ColorRampProperty");var ll=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{"experimental":true}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function cl(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function ul(t){if(Array.isArray(t))return t.map(ul);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const r in t)e[r]=ul(t[r]);return e}return cl(t)}function hl(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!hl(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function Al(t,e="fill"){if(null==t)return{filter:()=>!0,needGeometry:!1,needFeature:!1};hl(t)||(t=yl(t));const r=t;let i=!0;try{i=function(t){if(!fl(t))return t;let e=ul(t);return dl(e),e=pl(e),e}(r)}catch(t){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(r,null,2)}\n        `)}const n=ll[`filter_${e}`],o=As(i,n);let a=null;if("error"===o.result)throw new Error(o.value.map((t=>`${t.key}: ${t.message}`)).join(", "));a=(t,e,r)=>o.value.evaluate(t,e,{},r);let s=null,l=null;if(i!==r){const t=As(r,n);if("error"===t.result)throw new Error(t.value.map((t=>`${t.key}: ${t.message}`)).join(", "));s=(e,r,i,n,o)=>t.value.evaluate(e,r,{},i,void 0,void 0,n,o),l=!qo(t.value.expression)}return{filter:a,dynamicFilter:s||void 0,needGeometry:_l(i),needFeature:!!l}}function pl(t){if(!Array.isArray(t))return t;const e=function(t){if(ml.has(t[0]))for(let e=1;e<t.length;e++)if(fl(t[e]))return!0;return t}(t);return!0===e?e:e.map((t=>pl(t)))}function dl(t){let e=!1;const r=[];if("case"===t[0]){for(let i=1;i<t.length-1;i+=2)e=e||fl(t[i]),r.push(t[i+1]);r.push(t[t.length-1])}else if("match"===t[0]){e=e||fl(t[1]);for(let e=2;e<t.length-1;e+=2)r.push(t[e+1]);r.push(t[t.length-1])}else if("step"===t[0]){e=e||fl(t[1]);for(let e=1;e<t.length-1;e+=2)r.push(t[e+1])}e&&(t.length=0,t.push("any",...r));for(let e=1;e<t.length;e++)dl(t[e])}function fl(t){if(!Array.isArray(t))return!1;if("pitch"===(e=t[0])||"distance-from-center"===e)return!0;var e;for(let e=1;e<t.length;e++)if(fl(t[e]))return!0;return!1}const ml=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function gl(t,e){return t<e?-1:t>e?1:0}function _l(t){if(!Array.isArray(t))return!1;if("within"===t[0]||"distance"===t[0])return!0;for(let e=1;e<t.length;e++)if(_l(t[e]))return!0;return!1}function yl(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?vl(t[1],t[2],"=="):"!="===e?bl(vl(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?vl(t[1],t[2],e):"any"===e?(r=t.slice(1),["any"].concat(r.map(yl))):"all"===e?["all"].concat(t.slice(1).map(yl)):"none"===e?["all"].concat(t.slice(1).map(yl).map(bl)):"in"===e?xl(t[1],t.slice(2)):"!in"===e?bl(xl(t[1],t.slice(2))):"has"===e?wl(t[1]):"!has"!==e||bl(wl(t[1]));var r}function vl(t,e,r){switch(t){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,t,e]}}function xl(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((t=>typeof t!=typeof e[0]))?["filter-in-large",t,["literal",e.sort(gl)]]:["filter-in-small",t,["literal",e]]}}function wl(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function bl(t){return["!",t]}const Bl="";function Cl(t,e){return e?`${t}${Bl}${e}`:t}const El="-transition",Tl=new Set(["fill","line","background","hillshade","raster"]);class Il extends ki{constructor(t,e,r,i,n){if(super(),this.id=t.id,this.fqid=Cl(this.id,r),this.type=t.type,this.scope=r,this.lut=i,this.options=n,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,"custom"!==t.type&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&"sky"!==t.type&&"slot"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),t.slot&&(this.slot=t.slot),e.layout&&(this._unevaluatedLayout=new el(e.layout,this.scope,n),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),e.paint)){this._transitionablePaint=new Ys(e.paint,this.scope,n);for(const e in t.paint)this.setPaintProperty(e,t.paint[e]);for(const e in t.layout)this.setLayoutProperty(e,t.layout[e]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new il(e.paint)}}onAdd(t){}onRemove(t){}isDraped(t){return Tl.has(this.type)}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,e){if("custom"===this.type&&"visibility"===t)return void(this.visibility=e);const r=this._unevaluatedLayout;r._properties.properties[t]&&(r.setValue(t,e),this.isConfigDependent=this.isConfigDependent||r.isConfigDependent,"visibility"===t&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(t){return lr(t,El)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,e){const r=this._transitionablePaint,i=r._properties.properties;if(lr(t,El)){const n=t.slice(0,-11);return i[n]&&r.setTransition(n,e||void 0),!1}if(!i[t])return!1;const n=r._values[t],o=n.value.isDataDriven(),a=n.value;r.setValue(t,e),this.isConfigDependent=this.isConfigDependent||r.isConfigDependent,this._handleSpecialPaintPropertyUpdate(t);const s=r._values[t].value,l=s.isDataDriven(),c=lr(t,"pattern")||"line-dasharray"===t;return l||o||c||this._handleOverridablePaintPropertyUpdate(t,a,s)}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getDefaultProgramParams(t,e,r){return null}_handleOverridablePaintPropertyUpdate(t,e,r){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,e){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,e)}serialize(){return ur({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},((t,e)=>!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const t in this.paint._values){const e=this.paint.get(t);if(e instanceof rl&&Ya(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Al(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(t){this._stats&&("shadow"===t.renderPass?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(t){}queryIntersectsFeature(t,e,r,i,n,o,a,s,l){}queryIntersectsMatchingFeature(t,e,r,i){}}const Sl={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ml{constructor(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Fl{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,e){return t._trim(),e&&(t.isTransferred=!0,e.add(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...t){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...t){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Pl(t,e=1){let r=0,i=0;return{members:t.map((t=>{const n=Sl[t.type].BYTES_PER_ELEMENT,o=r=Ll(r,Math.max(e,n)),a=t.components||1;return i=Math.max(i,n),r+=n*a,{name:t.name,type:t.type,components:a,offset:o}})),size:Ll(r,Math.max(i,e)),alignment:e}}function Ll(t,e){return Math.ceil(t/e)*e}class Dl extends Fl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e){const r=this.length;return this.resize(r+1),this.emplace(r,t,e)}emplace(t,e,r){const i=2*t;return this.int16[i+0]=e,this.int16[i+1]=r,t}}Dl.prototype.bytesPerElement=4,bs(Dl,"StructArrayLayout2i4");class Ul extends Fl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,r){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,r)}emplace(t,e,r,i){const n=3*t;return this.int16[n+0]=e,this.int16[n+1]=r,this.int16[n+2]=i,t}}Ul.prototype.bytesPerElement=6,bs(Ul,"StructArrayLayout3i6");class kl extends Fl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,r,i){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,r,i)}emplace(t,e,r,i,n){const o=4*t;return this.int16[o+0]=e,this.int16[o+1]=r,this.int16[o+2]=i,this.int16[o+3]=n,t}}kl.prototype.bytesPerElement=8,bs(kl,"StructArrayLayout4i8");class zl extends Fl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,r,i,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,r,i,n)}emplace(t,e,r,i,n,o){const a=5*t;return this.int16[a+0]=e,this.int16[a+1]=r,this.int16[a+2]=i,this.int16[a+3]=n,this.int16[a+4]=o,t}}zl.prototype.bytesPerElement=10,bs(zl,"StructArrayLayout5i10");class Rl extends Fl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,r,i,n,o,a){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,r,i,n,o,a)}emplace(t,e,r,i,n,o,a,s){const l=6*t,c=12*t,u=3*t;return this.int16[l+0]=e,this.int16[l+1]=r,this.uint8[c+4]=i,this.uint8[c+5]=n,this.uint8[c+6]=o,this.uint8[c+7]=a,this.float32[u+2]=s,t}}Rl.prototype.bytesPerElement=12,bs(Rl,"StructArrayLayout2i4ub1f12");class Ol extends Fl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,r,i){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,r,i)}emplace(t,e,r,i,n){const o=4*t;return this.float32[o+0]=e,this.float32[o+1]=r,this.float32[o+2]=i,this.float32[o+3]=n,t}}Ol.prototype.bytesPerElement=16,bs(Ol,"StructArrayLayout4f16");class Ql extends Fl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,r){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,r)}emplace(t,e,r,i){const n=3*t;return this.float32[n+0]=e,this.float32[n+1]=r,this.float32[n+2]=i,t}}Ql.prototype.bytesPerElement=12,bs(Ql,"StructArrayLayout3f12");class Nl extends Fl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,r,i,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,r,i,n)}emplace(t,e,r,i,n,o){const a=6*t,s=3*t;return this.uint16[a+0]=e,this.uint16[a+1]=r,this.uint16[a+2]=i,this.uint16[a+3]=n,this.float32[s+2]=o,t}}Nl.prototype.bytesPerElement=12,bs(Nl,"StructArrayLayout4ui1f12");class Vl extends Fl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,r,i){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,r,i)}emplace(t,e,r,i,n){const o=4*t;return this.uint16[o+0]=e,this.uint16[o+1]=r,this.uint16[o+2]=i,this.uint16[o+3]=n,t}}Vl.prototype.bytesPerElement=8,bs(Vl,"StructArrayLayout4ui8");class Hl extends Fl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,r,i,n,o){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,r,i,n,o)}emplace(t,e,r,i,n,o,a){const s=6*t;return this.int16[s+0]=e,this.int16[s+1]=r,this.int16[s+2]=i,this.int16[s+3]=n,this.int16[s+4]=o,this.int16[s+5]=a,t}}Hl.prototype.bytesPerElement=12,bs(Hl,"StructArrayLayout6i12");class jl extends Fl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,r,i,n,o,a,s,l,c,u,h){const A=this.length;return this.resize(A+1),this.emplace(A,t,e,r,i,n,o,a,s,l,c,u,h)}emplace(t,e,r,i,n,o,a,s,l,c,u,h,A){const p=12*t;return this.int16[p+0]=e,this.int16[p+1]=r,this.int16[p+2]=i,this.int16[p+3]=n,this.uint16[p+4]=o,this.uint16[p+5]=a,this.uint16[p+6]=s,this.uint16[p+7]=l,this.int16[p+8]=c,this.int16[p+9]=u,this.int16[p+10]=h,this.int16[p+11]=A,t}}jl.prototype.bytesPerElement=24,bs(jl,"StructArrayLayout4i4ui4i24");class Gl extends Fl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,r,i,n,o){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,r,i,n,o)}emplace(t,e,r,i,n,o,a){const s=10*t,l=5*t;return this.int16[s+0]=e,this.int16[s+1]=r,this.int16[s+2]=i,this.float32[l+2]=n,this.float32[l+3]=o,this.float32[l+4]=a,t}}Gl.prototype.bytesPerElement=20,bs(Gl,"StructArrayLayout3i3f20");class Kl extends Fl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint32[1*t+0]=e,t}}Kl.prototype.bytesPerElement=4,bs(Kl,"StructArrayLayout1ul4");class ql extends Fl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.float32[1*t+0]=e,t}}ql.prototype.bytesPerElement=4,bs(ql,"StructArrayLayout1f4");class Zl extends Fl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e){const r=this.length;return this.resize(r+1),this.emplace(r,t,e)}emplace(t,e,r){const i=2*t;return this.uint16[i+0]=e,this.uint16[i+1]=r,t}}Zl.prototype.bytesPerElement=4,bs(Zl,"StructArrayLayout2ui4");class Wl extends Fl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,r,i,n,o,a,s,l,c,u,h,A){const p=this.length;return this.resize(p+1),this.emplace(p,t,e,r,i,n,o,a,s,l,c,u,h,A)}emplace(t,e,r,i,n,o,a,s,l,c,u,h,A,p){const d=20*t,f=10*t;return this.int16[d+0]=e,this.int16[d+1]=r,this.int16[d+2]=i,this.int16[d+3]=n,this.int16[d+4]=o,this.float32[f+3]=a,this.float32[f+4]=s,this.float32[f+5]=l,this.float32[f+6]=c,this.int16[d+14]=u,this.uint32[f+8]=h,this.uint16[d+18]=A,this.uint16[d+19]=p,t}}Wl.prototype.bytesPerElement=40,bs(Wl,"StructArrayLayout5i4f1i1ul2ui40");class Xl extends Fl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,r,i,n,o,a){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,r,i,n,o,a)}emplace(t,e,r,i,n,o,a,s){const l=8*t;return this.int16[l+0]=e,this.int16[l+1]=r,this.int16[l+2]=i,this.int16[l+4]=n,this.int16[l+5]=o,this.int16[l+6]=a,this.int16[l+7]=s,t}}Xl.prototype.bytesPerElement=16,bs(Xl,"StructArrayLayout3i2i2i16");class $l extends Fl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,r,i,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,r,i,n)}emplace(t,e,r,i,n,o){const a=4*t,s=8*t;return this.float32[a+0]=e,this.float32[a+1]=r,this.float32[a+2]=i,this.int16[s+6]=n,this.int16[s+7]=o,t}}$l.prototype.bytesPerElement=16,bs($l,"StructArrayLayout2f1f2i16");class Yl extends Fl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,r,i){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,r,i)}emplace(t,e,r,i,n){const o=12*t,a=3*t;return this.uint8[o+0]=e,this.uint8[o+1]=r,this.float32[a+1]=i,this.float32[a+2]=n,t}}Yl.prototype.bytesPerElement=12,bs(Yl,"StructArrayLayout2ub2f12");class Jl extends Fl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,r){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,r)}emplace(t,e,r,i){const n=3*t;return this.uint16[n+0]=e,this.uint16[n+1]=r,this.uint16[n+2]=i,t}}Jl.prototype.bytesPerElement=6,bs(Jl,"StructArrayLayout3ui6");class tc extends Fl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,e,r,i,n,o,a,s,l,c,u,h,A,p,d,f,m,g,_,y,v){const x=this.length;return this.resize(x+1),this.emplace(x,t,e,r,i,n,o,a,s,l,c,u,h,A,p,d,f,m,g,_,y,v)}emplace(t,e,r,i,n,o,a,s,l,c,u,h,A,p,d,f,m,g,_,y,v,x){const w=30*t,b=15*t,B=60*t;return this.int16[w+0]=e,this.int16[w+1]=r,this.int16[w+2]=i,this.float32[b+2]=n,this.float32[b+3]=o,this.uint16[w+8]=a,this.uint16[w+9]=s,this.uint32[b+5]=l,this.uint32[b+6]=c,this.uint32[b+7]=u,this.uint16[w+16]=h,this.uint16[w+17]=A,this.uint16[w+18]=p,this.float32[b+10]=d,this.float32[b+11]=f,this.uint8[B+48]=m,this.uint8[B+49]=g,this.uint8[B+50]=_,this.uint32[b+13]=y,this.int16[w+28]=v,this.uint8[B+58]=x,t}}tc.prototype.bytesPerElement=60,bs(tc,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ec extends Fl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,e,r,i,n,o,a,s,l,c,u,h,A,p,d,f,m,g,_,y,v,x,w,b,B,C,E,T,I,S,M,F,P,L){const D=this.length;return this.resize(D+1),this.emplace(D,t,e,r,i,n,o,a,s,l,c,u,h,A,p,d,f,m,g,_,y,v,x,w,b,B,C,E,T,I,S,M,F,P,L)}emplace(t,e,r,i,n,o,a,s,l,c,u,h,A,p,d,f,m,g,_,y,v,x,w,b,B,C,E,T,I,S,M,F,P,L,D){const U=22*t,k=44*t,z=88*t;return this.float32[U+0]=e,this.float32[U+1]=r,this.int16[k+4]=i,this.int16[k+5]=n,this.int16[k+6]=o,this.int16[k+7]=a,this.int16[k+8]=s,this.int16[k+9]=l,this.int16[k+10]=c,this.int16[k+11]=u,this.int16[k+12]=h,this.uint16[k+13]=A,this.uint16[k+14]=p,this.uint16[k+15]=d,this.uint16[k+16]=f,this.uint16[k+17]=m,this.uint16[k+18]=g,this.uint16[k+19]=_,this.uint16[k+20]=y,this.uint16[k+21]=v,this.uint16[k+22]=x,this.uint16[k+23]=w,this.uint16[k+24]=b,this.uint16[k+25]=B,this.uint16[k+26]=C,this.uint16[k+27]=E,this.uint32[U+14]=T,this.float32[U+15]=I,this.float32[U+16]=S,this.float32[U+17]=M,this.float32[U+18]=F,this.float32[U+19]=P,this.float32[U+20]=L,this.uint8[z+84]=D,t}}ec.prototype.bytesPerElement=88,bs(ec,"StructArrayLayout2f9i15ui1ul6f1ub88");class rc extends Fl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,r,i,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,r,i,n)}emplace(t,e,r,i,n,o){const a=5*t;return this.float32[a+0]=e,this.float32[a+1]=r,this.float32[a+2]=i,this.float32[a+3]=n,this.float32[a+4]=o,t}}rc.prototype.bytesPerElement=20,bs(rc,"StructArrayLayout5f20");class ic extends Fl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,r,i,n,o,a){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,r,i,n,o,a)}emplace(t,e,r,i,n,o,a,s){const l=7*t;return this.float32[l+0]=e,this.float32[l+1]=r,this.float32[l+2]=i,this.float32[l+3]=n,this.float32[l+4]=o,this.float32[l+5]=a,this.float32[l+6]=s,t}}ic.prototype.bytesPerElement=28,bs(ic,"StructArrayLayout7f28");class nc extends Fl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e){const r=this.length;return this.resize(r+1),this.emplace(r,t,e)}emplace(t,e,r){const i=2*t;return this.float32[i+0]=e,this.float32[i+1]=r,t}}nc.prototype.bytesPerElement=8,bs(nc,"StructArrayLayout2f8");class oc extends Fl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,r,i){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,r,i)}emplace(t,e,r,i,n){const o=6*t;return this.uint32[3*t+0]=e,this.uint16[o+2]=r,this.uint16[o+3]=i,this.uint16[o+4]=n,t}}oc.prototype.bytesPerElement=12,bs(oc,"StructArrayLayout1ul3ui12");class ac extends Fl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint16[1*t+0]=e,t}}ac.prototype.bytesPerElement=2,bs(ac,"StructArrayLayout1ui2");class sc extends Fl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,r,i,n,o,a,s,l,c,u,h,A,p,d,f){const m=this.length;return this.resize(m+1),this.emplace(m,t,e,r,i,n,o,a,s,l,c,u,h,A,p,d,f)}emplace(t,e,r,i,n,o,a,s,l,c,u,h,A,p,d,f,m){const g=16*t;return this.float32[g+0]=e,this.float32[g+1]=r,this.float32[g+2]=i,this.float32[g+3]=n,this.float32[g+4]=o,this.float32[g+5]=a,this.float32[g+6]=s,this.float32[g+7]=l,this.float32[g+8]=c,this.float32[g+9]=u,this.float32[g+10]=h,this.float32[g+11]=A,this.float32[g+12]=p,this.float32[g+13]=d,this.float32[g+14]=f,this.float32[g+15]=m,t}}sc.prototype.bytesPerElement=64,bs(sc,"StructArrayLayout16f64");class lc extends Fl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,r,i,n,o,a){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,r,i,n,o,a)}emplace(t,e,r,i,n,o,a,s){const l=10*t,c=5*t;return this.uint16[l+0]=e,this.uint16[l+1]=r,this.uint16[l+2]=i,this.uint16[l+3]=n,this.float32[c+2]=o,this.float32[c+3]=a,this.float32[c+4]=s,t}}lc.prototype.bytesPerElement=20,bs(lc,"StructArrayLayout4ui3f20");class cc extends Fl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.int16[1*t+0]=e,t}}cc.prototype.bytesPerElement=2,bs(cc,"StructArrayLayout1i2");class uc extends Fl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint8[1*t+0]=e,t}}uc.prototype.bytesPerElement=1,bs(uc,"StructArrayLayout1ub1");class hc extends Ml{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}hc.prototype.size=40;class Ac extends Wl{get(t){return new hc(this,t)}}bs(Ac,"CollisionBoxArray");class pc extends Ml{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}pc.prototype.size=60;class dc extends tc{get(t){return new pc(this,t)}}bs(dc,"PlacedSymbolArray");class fc extends Ml{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(t){this._structArray.uint32[this._pos4+14]=t}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(t){this._structArray.float32[this._pos4+18]=t}get occlusionState(){return this._structArray.float32[this._pos4+19]}set occlusionState(t){this._structArray.float32[this._pos4+19]=t}get occlusionOpacity(){return this._structArray.float32[this._pos4+20]}set occlusionOpacity(t){this._structArray.float32[this._pos4+20]=t}get hasIconTextFit(){return this._structArray.uint8[this._pos1+84]}}fc.prototype.size=88;class mc extends ec{get(t){return new fc(this,t)}}bs(mc,"SymbolInstanceArray");class gc extends ql{getoffsetX(t){return this.float32[1*t+0]}}bs(gc,"GlyphOffsetArray");class _c extends Dl{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}bs(_c,"SymbolLineVertexArray");class yc extends Ml{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}yc.prototype.size=12;class vc extends oc{get(t){return new yc(this,t)}}bs(vc,"FeatureIndexArray");class xc extends Zl{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}bs(xc,"FillExtrusionCentroidArray");const wc=Pl([{name:"a_pos",components:2,type:"Int16"}],4),bc=Pl([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Bc{constructor(t=[]){this.segments=t}_prepareSegment(t,e,r,i){let n=this.segments[this.segments.length-1];return t>Bc.MAX_VERTEX_ARRAY_LENGTH&&pr(`Max vertices per segment is ${Bc.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!n||n.vertexLength+t>Bc.MAX_VERTEX_ARRAY_LENGTH||n.sortKey!==i)&&(n={vertexOffset:e,primitiveOffset:r,vertexLength:0,primitiveLength:0},void 0!==i&&(n.sortKey=i),this.segments.push(n)),n}prepareSegment(t,e,r,i){return this._prepareSegment(t,e.length,r.length,i)}get(){return this.segments}destroy(){for(const t of this.segments)for(const e in t.vaos)t.vaos[e].destroy()}static simpleSegment(t,e,r,i){return new Bc([{vertexOffset:t,primitiveOffset:e,vertexLength:r,primitiveLength:i,vaos:{},sortKey:0}])}}function Cc(t,e){return 256*(t=Xe(Math.floor(t),0,255))+Xe(Math.floor(e),0,255)}Bc.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,bs(Bc,"SegmentVector");const Ec=Pl([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Tc=Pl([{name:"a_dash",components:4,type:"Uint16"}]);class Ic{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(t,e,r,i){this.ids.push(Sc(t)),this.positions.push(e,r,i)}eachPosition(t,e){const r=Sc(t);let i=0,n=this.ids.length-1;for(;i<n;){const t=i+n>>1;this.ids[t]>=r?n=t:i=t+1}for(;this.ids[i]===r;)e(this.positions[3*i],this.positions[3*i+1],this.positions[3*i+2]),i++}static serialize(t,e){const r=new Float64Array(t.ids),i=new Uint32Array(t.positions);return Mc(r,i,0,r.length-1),e&&(e.add(r.buffer),e.add(i.buffer)),{ids:r,positions:i}}static deserialize(t){const e=new Ic;let r;e.ids=t.ids,e.positions=t.positions;for(const t of e.ids)t!==r&&e.uniqueIds.push(t),r=t;return e.indexed=!0,e}}function Sc(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Fi(String(t))}function Mc(t,e,r,i){for(;r<i;){const n=t[r+i>>1];let o=r-1,a=i+1;for(;;){do{o++}while(t[o]<n);do{a--}while(t[a]>n);if(o>=a)break;Fc(t,o,a),Fc(e,3*o,3*a),Fc(e,3*o+1,3*a+1),Fc(e,3*o+2,3*a+2)}a-r<i-a?(Mc(t,e,r,a),r=a+1):(Mc(t,e,a+1,i),i=a)}}function Fc(t,e,r){const i=t[e];t[e]=t[r],t[r]=i}bs(Ic,"FeaturePositionMap");class Pc{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,e){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,e),this.initialized=!0),!!this.location}set(t,e,r){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Lc extends Pc{constructor(t){super(t),this.current=0}set(t,e,r){this.fetchUniformLocation(t,e)&&this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}}class Dc extends Pc{constructor(t){super(t),this.current=0}set(t,e,r){this.fetchUniformLocation(t,e)&&this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class Uc extends Pc{constructor(t){super(t),this.current=[0,0]}set(t,e,r){this.fetchUniformLocation(t,e)&&(r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1])))}}class kc extends Pc{constructor(t){super(t),this.current=[0,0,0]}set(t,e,r){this.fetchUniformLocation(t,e)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2])))}}class zc extends Pc{constructor(t){super(t),this.current=[0,0,0,0]}set(t,e,r){this.fetchUniformLocation(t,e)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3])))}}class Rc extends Pc{constructor(t){super(t),this.current=Vi.transparent.toRenderColor(null)}set(t,e,r){this.fetchUniformLocation(t,e)&&(r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a)))}}const Oc=new Float32Array(16);class Qc extends Pc{constructor(t){super(t),this.current=Oc}set(t,e,r){if(this.fetchUniformLocation(t,e)){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let t=1;t<16;t++)if(r[t]!==this.current[t]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}}}const Nc=new Float32Array(9),Vc=new Float32Array(4);class Hc extends Pc{constructor(t){super(t),this.current=Vc}set(t,e,r){if(this.fetchUniformLocation(t,e))for(let t=0;t<4;t++)if(r[t]!==this.current[t]){this.current=r,this.gl.uniformMatrix2fv(this.location,!1,r);break}}}function jc(t){return[Cc(255*t.r,255*t.g),Cc(255*t.b,255*t.a)]}class Gc{constructor(t,e,r,i){this.value=t,this.uniformNames=e.map((t=>`u_${t}`)),this.type=r,this.context=i}setUniform(t,e,r,i,n){const o=i.constantOr(this.value);e.set(t,n,o instanceof Vi?o.toRenderColor(this.context.lut):o)}getBinding(t,e){return"color"===this.type?new Rc(t):new Dc(t)}}class Kc{constructor(t,e){this.uniformNames=e.map((t=>`u_${t}`)),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,e,r,i,n){const o="u_pattern"===n||"u_dash"===n?this.pattern:"u_pixel_ratio"===n?this.pixelRatio:null;o&&e.set(t,n,o)}getBinding(t,e){return"u_pattern"===e||"u_dash"===e?new zc(t):new Dc(t)}}class qc{constructor(t,e,r,i){this.expression=t,this.type=r,this.maxValue=0,this.paintVertexAttributes=e.map((t=>({name:`a_${t}`,type:"Float32",components:"color"===r?2:1,offset:0}))),this.paintVertexArray=new i}populatePaintArray(t,e,r,i,n,o,a){const s=this.paintVertexArray.length,l=this.expression.evaluate(new Ws(0,{brightness:o}),e,{},n,i,a);this.paintVertexArray.resize(t),this._setPaintValue(s,t,l,this.context)}updatePaintArray(t,e,r,i,n,o,a){const s=this.expression.evaluate({zoom:0,brightness:a},r,i,void 0,n);this._setPaintValue(t,e,s,this.context)}_setPaintValue(t,e,r,i){if("color"===this.type){const n=jc(r.toRenderColor(i.lut));for(let r=t;r<e;r++)this.paintVertexArray.emplace(r,n[0],n[1])}else{for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Zc{constructor(t,e,r,i,n,o){this.expression=t,this.uniformNames=e.map((t=>`u_${t}_t`)),this.type=r,this.useIntegerZoom=i,this.context=n,this.maxValue=0,this.paintVertexAttributes=e.map((t=>({name:`a_${t}`,type:"Float32",components:"color"===r?4:2,offset:0}))),this.paintVertexArray=new o}populatePaintArray(t,e,r,i,n,o,a){const s=this.expression.evaluate(new Ws(this.context.zoom,{brightness:o}),e,{},n,i,a),l=this.expression.evaluate(new Ws(this.context.zoom+1,{brightness:o}),e,{},n,i,a),c=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(c,t,s,l,this.context)}updatePaintArray(t,e,r,i,n,o,a){const s=this.expression.evaluate({zoom:this.context.zoom,brightness:a},r,i,void 0,n),l=this.expression.evaluate({zoom:this.context.zoom+1,brightness:a},r,i,void 0,n);this._setPaintValue(t,e,s,l,this.context)}_setPaintValue(t,e,r,i,n){if("color"===this.type){const i=jc(r.toRenderColor(n.lut)),o=jc(r.toRenderColor(n.lut));for(let r=t;r<e;r++)this.paintVertexArray.emplace(r,i[0],i[1],o[0],o[1])}else{for(let n=t;n<e;n++)this.paintVertexArray.emplace(n,r,i);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(i))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,e,r,i,n){const o=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,a=Xe(this.expression.interpolationFactor(o,this.context.zoom,this.context.zoom+1),0,1);e.set(t,n,a)}getBinding(t,e){return new Dc(t)}}class Wc{constructor(t,e,r,i,n){this.expression=t,this.layerId=n,this.paintVertexAttributes=("array"===r?Tc:Ec).members;for(let t=0;t<e.length;++t);this.paintVertexArray=new i}populatePaintArray(t,e,r,i){const n=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(n,t,e.patterns&&e.patterns[this.layerId],r)}updatePaintArray(t,e,r,i,n,o,a){this._setPaintValues(t,e,r.patterns&&r.patterns[this.layerId],o)}_setPaintValues(t,e,r,i){if(!i||!r)return;const n=i[r];if(!n)return;const{tl:o,br:a,pixelRatio:s}=n;for(let r=t;r<e;r++)this.paintVertexArray.emplace(r,o[0],o[1],a[0],a[1],s)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Xc{constructor(t,e,r=()=>!0){this.binders={},this._buffers=[],this.context=e;const i=[];for(const n in t.paint._values){const o=t.paint.get(n);if(!r(n))continue;if(!(o instanceof rl&&Ya(o.property.specification)))continue;const a=Jc(n,t.type),s=o.value,l=o.property.specification.type,c=!!o.property.useIntegerZoom,u="line-dasharray"===n||n.endsWith("pattern"),h="line-dasharray"===n&&"constant"!==t.layout.get("line-cap").value.kind;if("constant"!==s.kind||h)if("source"===s.kind||h||u){const e=ru(n,l,"source");this.binders[n]=u?new Wc(s,a,l,e,t.id):new qc(s,a,l,e),i.push(`/a_${n}`)}else{const t=ru(n,l,"composite");this.binders[n]=new Zc(s,a,l,c,e,t),i.push(`/z_${n}`)}else this.binders[n]=u?new Kc(s.value,a):new Gc(s.value,a,l,e),i.push(`/u_${n}`)}this.cacheKey=i.sort().join("")}getMaxValue(t){const e=this.binders[t];return e instanceof qc||e instanceof Zc?e.maxValue:0}populatePaintArrays(t,e,r,i,n,o,a){for(const s in this.binders){const l=this.binders[s];l.context=this.context,(l instanceof qc||l instanceof Zc||l instanceof Wc)&&l.populatePaintArray(t,e,r,i,n,o,a)}}setConstantPatternPositions(t){for(const e in this.binders){const r=this.binders[e];r instanceof Kc&&r.setConstantPatternPositions(t)}}updatePaintArrays(t,e,r,i,n,o,a,s){let l=!1;const c=Object.keys(t),u=0!==c.length,h=u?c:e.uniqueIds;this.context.lut=n.lut;for(const c in this.binders){const A=this.binders[c];if(A.context=this.context,(A instanceof qc||A instanceof Zc||A instanceof Wc)&&(!0===A.expression.isStateDependent||!1===A.expression.isLightConstant)){const p=n.paint.get(c);A.expression=p.value;for(const r of h){const n=t[r.toString()];e.eachPosition(r,((t,e,r)=>{const l=i.feature(t);A.updatePaintArray(e,r,l,n,o,a,s)}))}if(!u)for(const e of r.uniqueIds){const n=t[e.toString()];r.eachPosition(e,((t,e,r)=>{const l=i.feature(t);A.updatePaintArray(e,r,l,n,o,a,s)}))}l=!0}}return l}defines(){const t=[];for(const e in this.binders){const r=this.binders[e];(r instanceof Gc||r instanceof Kc)&&t.push(...r.uniformNames.map((t=>`#define HAS_UNIFORM_${t}`)))}return t}getBinderAttributes(){const t=[];for(const e in this.binders){const r=this.binders[e];if(r instanceof qc||r instanceof Zc||r instanceof Wc)for(let e=0;e<r.paintVertexAttributes.length;e++)t.push(r.paintVertexAttributes[e].name)}return t}getBinderUniforms(){const t=[];for(const e in this.binders){const r=this.binders[e];if(r instanceof Gc||r instanceof Kc||r instanceof Zc)for(const e of r.uniformNames)t.push(e)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const e=[];for(const r in this.binders){const i=this.binders[r];if(i instanceof Gc||i instanceof Kc||i instanceof Zc)for(const n of i.uniformNames)e.push({name:n,property:r,binding:i.getBinding(t,n)})}return e}setUniforms(t,e,r,i,n){for(const{name:e,property:o,binding:a}of r)this.binders[o].setUniform(t,a,n,i.get(o),e)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const e=this.binders[t];(e instanceof qc||e instanceof Zc||e instanceof Wc)&&e.paintVertexBuffer&&this._buffers.push(e.paintVertexBuffer)}}upload(t){for(const e in this.binders){const r=this.binders[e];(r instanceof qc||r instanceof Zc||r instanceof Wc)&&r.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const e=this.binders[t];(e instanceof qc||e instanceof Zc||e instanceof Wc)&&e.destroy()}}}class $c{constructor(t,e,r=()=>!0){this.programConfigurations={};for(const i of t)this.programConfigurations[i.id]=new Xc(i,e,r);this.needsUpload=!1,this._featureMap=new Ic,this._featureMapWithoutIds=new Ic,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(t,e,r,i,n,o,a,s){for(const r in this.programConfigurations)this.programConfigurations[r].populatePaintArrays(t,e,i,n,o,a,s);void 0!==e.id?this._featureMap.add(e.id,r,this._bufferOffset,t):(this._featureMapWithoutIds.add(this._idlessCounter,r,this._bufferOffset,t),this._idlessCounter+=1),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,e,r,i,n,o){for(const a of r)this.needsUpload=this.programConfigurations[a.id].updatePaintArrays(t,this._featureMap,this._featureMapWithoutIds,e,a,i,n,o||0)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const Yc={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Jc(t,e){return Yc[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const tu={"line-pattern":{source:Nl,composite:Nl},"fill-pattern":{source:Nl,composite:Nl},"fill-extrusion-pattern":{source:Nl,composite:Nl},"line-dasharray":{source:Vl,composite:Vl}},eu={color:{source:nc,composite:Ol},number:{source:ql,composite:nc}};function ru(t,e,r){const i=tu[t];return i&&i[r]||eu[e][r]}bs(Gc,"ConstantBinder"),bs(Kc,"PatternConstantBinder"),bs(qc,"SourceExpressionBinder"),bs(Wc,"PatternCompositeBinder"),bs(Zc,"CompositeExpressionBinder"),bs(Xc,"ProgramConfiguration",{omit:["_buffers"]}),bs($c,"ProgramConfigurationSet");const iu=Ao/Math.PI/2,nu=5,ou=6,au=16383,su=64,lu=[su,32,16],cu=-iu,uu=iu;function hu(t,e,r,i=iu){return r=je(r),[t*Math.sin(r)*i,-e*i,t*Math.cos(r)*i]}function Au(t,e,r){return hu(Math.cos(je(t)),Math.sin(je(t)),e,r)}const pu=6371008.8,du=2*Math.PI*pu;class fu{constructor(t,e){if(isNaN(t)||isNaN(e))throw new Error(`Invalid LngLat object: (${t}, ${e})`);if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new fu(Ye(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const e=Math.PI/180,r=this.lat*e,i=t.lat*e,n=Math.sin(r)*Math.sin(i)+Math.cos(r)*Math.cos(i)*Math.cos((t.lng-this.lng)*e);return pu*Math.acos(Math.min(n,1))}toBounds(t=0){const e=360*t/40075017,r=e/Math.cos(Math.PI/180*this.lat);return new mu({lng:this.lng-r,lat:this.lat-e},{lng:this.lng+r,lat:this.lat+e})}toEcef(t){return Au(this.lat,this.lng,iu+t*iu/pu)}static convert(t){if(t instanceof fu)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new fu(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new fu(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class mu{constructor(t,e){if(t)if(e)this.setSouthWest(t).setNorthEast(e);else if(4===t.length){const e=t;this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]])}else{const e=t;this.setSouthWest(e[0]).setNorthEast(e[1])}}setNorthEast(t){return this._ne=t instanceof fu?new fu(t.lng,t.lat):fu.convert(t),this}setSouthWest(t){return this._sw=t instanceof fu?new fu(t.lng,t.lat):fu.convert(t),this}extend(t){const e=this._sw,r=this._ne;let i,n;if(t instanceof fu)i=t,n=t;else{if(!(t instanceof mu))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(mu.convert(t)):this.extend(fu.convert(t)):"object"==typeof t&&null!==t&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(fu.convert(t)):this;if(i=t._sw,n=t._ne,!i||!n)return this}return e||r?(e.lng=Math.min(i.lng,e.lng),e.lat=Math.min(i.lat,e.lat),r.lng=Math.max(n.lng,r.lng),r.lat=Math.max(n.lat,r.lat)):(this._sw=new fu(i.lng,i.lat),this._ne=new fu(n.lng,n.lat)),this}getCenter(){return new fu((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new fu(this.getWest(),this.getNorth())}getSouthEast(){return new fu(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:e,lat:r}=fu.convert(t);let i=this._sw.lng<=e&&e<=this._ne.lng;return this._sw.lng>this._ne.lng&&(i=this._sw.lng>=e&&e>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&i}static convert(t){return!t||t instanceof mu?t:new mu(t)}}var gu={};!function(t,e){!function(t){function e(t,e,i){var n=r(256*t,256*(e=Math.pow(2,i)-e-1),i),o=r(256*(t+1),256*(e+1),i);return n[0]+","+n[1]+","+o[0]+","+o[1]}function r(t,e,r){var i=2*Math.PI*6378137/256/Math.pow(2,r);return[t*i-2*Math.PI*6378137/2,e*i-2*Math.PI*6378137/2]}t.getURL=function(t,r,i,n,o,a){return a=a||{},t+"?"+["bbox="+e(i,n,o),"format="+(a.format||"image/png"),"service="+(a.service||"WMS"),"version="+(a.version||"1.1.1"),"request="+(a.request||"GetMap"),"srs="+(a.srs||"EPSG:3857"),"width="+(a.width||256),"height="+(a.height||256),"layers="+r].join("&")},t.getTileBBox=e,t.getMercCoords=r,Object.defineProperty(t,"__esModule",{value:!0})}(e)}(0,gu);var _u=gu;class yu{constructor(t,e,r){this.z=t,this.x=e,this.y=r,this.key=wu(0,t,t,e,r)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,e){const r=_u.getTileBBox(this.x,this.y,this.z),i=function(t,e,r){let i,n="";for(let o=t;o>0;o--)i=1<<o-1,n+=(e&i?1:0)+(r&i?2:0);return n}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",i).replace("{bbox-epsg-3857}",r)}toString(){return`${this.z}/${this.x}/${this.y}`}}class vu{constructor(t,e){this.wrap=t,this.canonical=e,this.key=wu(t,e.z,e.z,e.x,e.y)}}class xu{constructor(t,e,r,i,n){this.overscaledZ=t,this.wrap=e,this.canonical=new yu(r,+i,+n),this.key=0===e&&t===r?this.canonical.key:wu(e,t,r,i,n)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const e=this.canonical.z-t;return t>this.canonical.z?new xu(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new xu(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)}calculateScaledKey(t,e=!0){if(this.overscaledZ===t&&e)return this.key;if(t>this.canonical.z)return wu(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y);{const r=this.canonical.z-t;return wu(this.wrap*+e,t,t,this.canonical.x>>r,this.canonical.y>>r)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.z<this.canonical.z&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e}children(t){if(this.overscaledZ>=t)return[new xu(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const e=this.canonical.z+1,r=2*this.canonical.x,i=2*this.canonical.y;return[new xu(e,this.wrap,e,r,i),new xu(e,this.wrap,e,r+1,i),new xu(e,this.wrap,e,r,i+1),new xu(e,this.wrap,e,r+1,i+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new xu(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new xu(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new vu(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function wu(t,e,r,i,n){const o=1<<Math.min(r,22);let a=o*(n%o)+i%o;return t&&r<22&&(a+=o*o*((t<0?-2*t-1:2*t)%(1<<2*(22-r)))),16*(32*a+r)+(e-r)}const bu=[t=>{let e=t.canonical.x-1,r=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,r--),new xu(t.overscaledZ,r,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,r=t.wrap;return e===1<<t.canonical.z&&(e=0,r++),new xu(t.overscaledZ,r,t.canonical.z,e,t.canonical.y)},t=>new xu(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(0===t.canonical.y?1<<t.canonical.z:t.canonical.y)-1),t=>new xu(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];bs(yu,"CanonicalTileID"),bs(xu,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Bu=0,Cu=25.5;function Eu(t){return du*Math.cos(t*Math.PI/180)}function Tu(t){return(180+t)/360}function Iu(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Su(t,e){return t/Eu(e)}function Mu(t){return 360*t-180}function Fu(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Pu(t,e){return t*Eu(Fu(e))}const Lu=85.051129;function Du(t){return Math.cos(je(Xe(t,-Lu,Lu)))}function Uu(t,e){const r=Xe(e,Bu,Cu),i=Math.pow(2,r);return Du(t)*du/(512*i)}function ku(t){return 1/Math.cos(t*Math.PI/180)}function zu(t,e=0){const r=Math.exp(Math.PI*(1-(t.y+e/Ao)/(1<<t.z)*2));return 80150034*r/(r*r+1)/Ao/(1<<t.z)}class Ru{constructor(t,e,r=0){this.x=+t,this.y=+e,this.z=+r}static fromLngLat(t,e=0){const r=fu.convert(t);return new Ru(Tu(r.lng),Iu(r.lat),Su(e,r.lat))}toLngLat(){return new fu(Mu(this.x),Fu(this.y))}toAltitude(){return Pu(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/du*ku(Fu(this.y))}}function Ou(t,e,r,i,n,o,a,s,l){const c=(e+i)/2,u=(r+n)/2,h=new Ne(c,u);s(h),function(t,e,r,i,n,o){const a=r-n,s=i-o;return Math.abs((i-e)*a-(r-t)*s)/Math.hypot(a,s)}(h.x,h.y,o.x,o.y,a.x,a.y)>=l?(Ou(t,e,r,c,u,o,h,s,l),Ou(t,c,u,i,n,h,a,s,l)):t.push(a)}function Qu(t,e,r){let i=t[0],n=i.x,o=i.y;e(i);const a=[i];for(let s=1;s<t.length;s++){const l=t[s],{x:c,y:u}=l;e(l),Ou(a,n,o,c,u,i,l,e,r),n=c,o=u,i=l}return a}function Nu(t,e,r,i){if(i(e,r)){const n=e.add(r)._mult(.5);Nu(t,e,n,i),Nu(t,n,r,i)}else t.push(r)}function Vu(t,e){let r=t[0];const i=[r];for(let n=1;n<t.length;n++){const o=t[n];Nu(i,r,o,e),r=o}return i}const Hu=Math.pow(2,14)-1,ju=-Hu-1;function Gu(t,e){const r=Math.round(t.x*e),i=Math.round(t.y*e);return t.x=Xe(r,ju,Hu),t.y=Xe(i,ju,Hu),(r<t.x||r>t.x+1||i<t.y||i>t.y+1)&&pr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Ku(t,e,r){const i=t.loadGeometry(),n=t.extent,o=Ao/n;if(e&&r&&r.projection.isReprojectedInTileSpace){const o=1<<e.z,{scale:a,x:s,y:l,projection:c}=r,u=t=>{const r=Mu((e.x+t.x/n)/o),i=Fu((e.y+t.y/n)/o),u=c.project(r,i);t.x=(u.x*a-s)*n,t.y=(u.y*a-l)*n};for(let e=0;e<i.length;e++)if(1!==t.type)i[e]=Qu(i[e],u,1);else{const t=[];for(const r of i[e])r.x<0||r.x>=n||r.y<0||r.y>=n||(u(r),t.push(r));i[e]=t}}for(const t of i)for(const e of t)Gu(e,o);return i}function qu(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Ku(t):[]}}function Zu(t,e,r,i,n){t.emplaceBack(2*e+(i+1)/2,2*r+(n+1)/2)}function Wu(t,e,r){const i=16384;t.emplaceBack(e.x,e.y,e.z,r[0]*i,r[1]*i,r[2]*i)}class Xu{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new Dl,this.indexArray=new Jl,this.segments=new Bc,this.programConfigurations=new $c(t.layers,{zoom:t.zoom,lut:t.lut}),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}updateFootprints(t,e){}populate(t,e,r,i){const n=this.layers[0],o=[];let a=null;"circle"===n.type&&(a=n.layout.get("circle-sort-key"));for(const{feature:e,id:n,index:s,sourceLayerIndex:l}of t){const t=this.layers[0]._featureFilter.needGeometry,c=qu(e,t);if(!this.layers[0]._featureFilter.filter(new Ws(this.zoom),c,r))continue;const u=a?a.evaluate(c,{},r):void 0,h={id:n,properties:e.properties,type:e.type,sourceLayerIndex:l,index:s,geometry:t?c.geometry:Ku(e,r,i),patterns:{},sortKey:u};o.push(h)}a&&o.sort(((t,e)=>t.sortKey-e.sortKey));let s=null;"globe"===i.projection.name&&(this.globeExtVertexArray=new Hl,s=i.projection);for(const i of o){const{geometry:n,index:o,sourceLayerIndex:a}=i,l=t[o].feature;this.addFeature(i,n,o,e.availableImages,r,s,e.brightness),e.featureIndex.insert(l,n,o,a,this.index)}}update(t,e,r,i,n){const o=0!==Object.keys(t).length;o&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,e,o?this.stateDependentLayers:this.layers,r,i,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,wc.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,bc.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,e,r,i,n,o,a){for(const r of e)for(const e of r){const r=e.x,i=e.y;if(r<0||r>=Ao||i<0||i>=Ao)continue;if(o){const t=o.projectTilePoint(r,i,n),e=o.upVector(n,r,i),a=this.globeExtVertexArray;Wu(a,t,e),Wu(a,t,e),Wu(a,t,e),Wu(a,t,e)}const a=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),s=a.vertexLength;Zu(this.layoutVertexArray,r,i,-1,-1),Zu(this.layoutVertexArray,r,i,1,-1),Zu(this.layoutVertexArray,r,i,1,1),Zu(this.layoutVertexArray,r,i,-1,1),this.indexArray.emplaceBack(s,s+1,s+2),this.indexArray.emplaceBack(s,s+2,s+3),a.vertexLength+=4,a.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,{},i,n,a)}}function $u(t,e){for(let r=0;r<t.length;r++)if(ah(e,t[r]))return!0;for(let r=0;r<e.length;r++)if(ah(t,e[r]))return!0;return!!eh(t,e)}function Yu(t,e,r){return!!ah(t,e)||!!ih(e,t,r)}function Ju(t,e){if(1===t.length)return oh(e,t[0]);for(let r=0;r<e.length;r++){const i=e[r];for(let e=0;e<i.length;e++)if(ah(t,i[e]))return!0}for(let r=0;r<t.length;r++)if(oh(e,t[r]))return!0;for(let r=0;r<e.length;r++)if(eh(t,e[r]))return!0;return!1}function th(t,e,r){if(t.length>1){if(eh(t,e))return!0;for(let i=0;i<e.length;i++)if(ih(e[i],t,r))return!0}for(let i=0;i<t.length;i++)if(ih(t[i],e,r))return!0;return!1}function eh(t,e){if(0===t.length||0===e.length)return!1;for(let r=0;r<t.length-1;r++){const i=t[r],n=t[r+1];for(let t=0;t<e.length-1;t++)if(rh(i,n,e[t],e[t+1]))return!0}return!1}function rh(t,e,r,i){return dr(t,r,i)!==dr(e,r,i)&&dr(t,e,r)!==dr(t,e,i)}function ih(t,e,r){const i=r*r;if(1===e.length)return t.distSqr(e[0])<i;for(let r=1;r<e.length;r++)if(nh(t,e[r-1],e[r])<i)return!0;return!1}function nh(t,e,r){const i=e.distSqr(r);if(0===i)return t.distSqr(e);const n=((t.x-e.x)*(r.x-e.x)+(t.y-e.y)*(r.y-e.y))/i;return t.distSqr(n<0?e:n>1?r:r.sub(e)._mult(n)._add(e))}function oh(t,e){let r,i,n,o=!1;for(let a=0;a<t.length;a++){r=t[a];for(let t=0,a=r.length-1;t<r.length;a=t++)i=r[t],n=r[a],i.y>e.y!=n.y>e.y&&e.x<(n.x-i.x)*(e.y-i.y)/(n.y-i.y)+i.x&&(o=!o)}return o}function ah(t,e){let r=!1;for(let i=0,n=t.length-1;i<t.length;n=i++){const o=t[i],a=t[n];o.y>e.y!=a.y>e.y&&e.x<(a.x-o.x)*(e.y-o.y)/(a.y-o.y)+o.x&&(r=!r)}return r}function sh(t,e,r,i,n){for(const o of t)if(e<=o.x&&r<=o.y&&i>=o.x&&n>=o.y)return!0;const o=[new Ne(e,r),new Ne(e,n),new Ne(i,n),new Ne(i,r)];if(t.length>2)for(const e of o)if(ah(t,e))return!0;for(let e=0;e<t.length-1;e++)if(lh(t[e],t[e+1],o))return!0;return!1}function lh(t,e,r){const i=r[0],n=r[2];if(t.x<i.x&&e.x<i.x||t.x>n.x&&e.x>n.x||t.y<i.y&&e.y<i.y||t.y>n.y&&e.y>n.y)return!1;const o=dr(t,e,r[0]);return o!==dr(t,e,r[1])||o!==dr(t,e,r[2])||o!==dr(t,e,r[3])}function ch(t,e,r,i,n,o){let a=e.y-t.y,s=t.x-e.x;if(o=o||0){const t=a*a+s*s;if(0===t)return!0;const e=Math.sqrt(t);a/=e,s/=e}return!((r.x-t.x)*a+(r.y-t.y)*s-o<0||(i.x-t.x)*a+(i.y-t.y)*s-o<0||(n.x-t.x)*a+(n.y-t.y)*s-o<0)}function uh(t,e,r,i,n,o,a){return!(ch(t,e,i,n,o,a)||ch(e,r,i,n,o,a)||ch(r,t,i,n,o,a)||ch(i,n,t,e,r,a)||ch(n,o,t,e,r,a)||ch(o,i,t,e,r,a))}function hh(t,e,r){const i=e.paint.get(t).value;return"constant"===i.kind?i.value:r.programConfigurations.get(e.id).getMaxValue(t)}function Ah(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function ph(t,e,r,i,n){if(!e[0]&&!e[1])return t;const o=Ne.convert(e)._mult(n);"viewport"===r&&o._rotate(-i);const a=[];for(let e=0;e<t.length;e++)a.push(t[e].sub(o));return a}function dh(t,e,r,i){const n=Ne.convert(t)._mult(i);return"viewport"===e&&n._rotate(-r),n}bs(Xu,"CircleBucket",{omit:["layers"]});const fh=new sl({"circle-sort-key":new ol(ll.layout_circle["circle-sort-key"]),visibility:new nl(ll.layout_circle.visibility)});var mh={paint:new sl({"circle-radius":new ol(ll.paint_circle["circle-radius"]),"circle-color":new ol(ll.paint_circle["circle-color"]),"circle-blur":new ol(ll.paint_circle["circle-blur"]),"circle-opacity":new ol(ll.paint_circle["circle-opacity"]),"circle-translate":new nl(ll.paint_circle["circle-translate"]),"circle-translate-anchor":new nl(ll.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new nl(ll.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new nl(ll.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ol(ll.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ol(ll.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ol(ll.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new nl(ll.paint_circle["circle-emissive-strength"])}),layout:fh};class gh{constructor(t,e){this.pos=t,this.dir=e}intersectsPlane(e,r,i){const n=t._.dot(r,this.dir);if(Math.abs(n)<1e-6)return!1;const o=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1]+(e[2]-this.pos[2])*r[2])/n;return i[0]=this.pos[0]+this.dir[0]*o,i[1]=this.pos[1]+this.dir[1]*o,i[2]=this.pos[2]+this.dir[2]*o,!0}closestPointOnSphere(e,r,i){if(t._.equals(this.pos,e)||0===r)return i[0]=i[1]=i[2]=0,!1;const[n,o,a]=this.dir,s=this.pos[0]-e[0],l=this.pos[1]-e[1],c=this.pos[2]-e[2],u=n*n+o*o+a*a,h=2*(s*n+l*o+c*a),A=h*h-4*u*(s*s+l*l+c*c-r*r);if(A<0){const t=Math.max(-h/2,0),e=s+n*t,u=l+o*t,A=c+a*t,p=Math.hypot(e,u,A);return i[0]=e*r/p,i[1]=u*r/p,i[2]=A*r/p,!1}{const t=(-h-Math.sqrt(A))/(2*u);if(t<0){const t=Math.hypot(s,l,c);return i[0]=s*r/t,i[1]=l*r/t,i[2]=c*r/t,!1}return i[0]=s+n*t,i[1]=l+o*t,i[2]=c+a*t,!0}}}class _h{constructor(t,e,r,i,n){this.TL=t,this.TR=e,this.BR=r,this.BL=i,this.horizon=n}static fromInvProjectionMatrix(e,r,i){const n=[-1,1,1],o=[1,1,1],a=[1,-1,1],s=[-1,-1,1],l=t._.transformMat4(n,n,e),c=t._.transformMat4(o,o,e),u=t._.transformMat4(a,a,e),h=t._.transformMat4(s,s,e);return new _h(l,c,u,h,r/i)}}function yh(e,r,i){let n=1/0,o=-1/0;const a=[];for(const s of e){t._.sub(a,s,r);const e=t._.dot(a,i);n=Math.min(n,e),o=Math.max(o,e)}return[n,o]}function vh(e,r){let i=!0;for(let n=0;n<e.planes.length;n++){const o=e.planes[n];let a=0;for(let e=0;e<r.length;e++)a+=t._.dot(o,r[e])+o[3]>=0;if(0===a)return 0;a!==r.length&&(i=!1)}return i?2:1}function xh(t,e){for(const r of t.projections){const i=yh(e,t.points[0],r.axis);if(r.projection[1]<i[0]||r.projection[0]>i[1])return 0}return 1}function wh(e,r){let i=0;const n=[0,0,0,0];for(let o=0;o<e.length;o++)n[0]=e[o][0],n[1]=e[o][1],n[2]=e[o][2],n[3]=1,t.aA.dot(n,r)>=0&&i++;return i}class bh{constructor(e,r){this.points=e||new Array(8).fill([0,0,0]),this.planes=r||new Array(6).fill([0,0,0,0]),this.bounds=Bh.fromPoints(this.points),this.projections=[],this.frustumEdges=[t._.sub([],this.points[2],this.points[3]),t._.sub([],this.points[0],this.points[3]),t._.sub([],this.points[4],this.points[0]),t._.sub([],this.points[5],this.points[1]),t._.sub([],this.points[6],this.points[2]),t._.sub([],this.points[7],this.points[3])];for(const t of this.frustumEdges){const e=[0,-t[2],t[1]],r=[t[2],0,-t[0]];this.projections.push({axis:e,projection:yh(this.points,this.points[0],e)}),this.projections.push({axis:r,projection:yh(this.points,this.points[0],r)})}}static fromInvProjectionMatrix(e,r,i,n){const o=Math.pow(2,i),a=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((i=>{const a=t.aA.transformMat4([],i,e),s=1/a[3]/r*o;return t.aA.mul(a,a,[s,s,n?1/a[3]:s,s])})),s=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((e=>{const r=t._.sub([],a[e[0]],a[e[1]]),i=t._.sub([],a[e[2]],a[e[1]]),n=t._.normalize([],t._.cross([],r,i)),o=-t._.dot(n,a[e[1]]);return n.concat(o)})),l=[];for(let t=0;t<a.length;t++)l.push([a[t][0],a[t][1],a[t][2]]);return new bh(l,s)}intersectsPrecise(e,r,i){for(let t=0;t<r.length;t++)if(!wh(e,r[t]))return 0;for(let t=0;t<this.planes.length;t++)if(!wh(e,this.planes[t]))return 0;for(const r of i)for(const i of this.frustumEdges){const n=t._.cross([],r,i),o=t._.length(n);if(0===o)continue;t._.scale(n,n,1/o);const a=yh(this.points,this.points[0],n),s=yh(e,this.points[0],n);if(a[0]>s[1]||s[0]>a[1])return 0}return 1}}class Bh{static fromPoints(e){const r=[1/0,1/0,1/0],i=[-1/0,-1/0,-1/0];for(const n of e)t._.min(r,r,n),t._.max(i,i,n);return new Bh(r,i)}static fromTileIdAndHeight(t,e,r){const i=1<<t.canonical.z,n=t.canonical.x,o=t.canonical.y;return new Bh([n/i,o/i,e],[(n+1)/i,(o+1)/i,r])}static applyTransform(e,r){const i=e.getCorners();for(let e=0;e<i.length;++e)t._.transformMat4(i[e],i[e],r);return Bh.fromPoints(i)}static applyTransformFast(t,e){const r=[e[12],e[13],e[14]],i=[...r];for(let n=0;n<3;n++)for(let o=0;o<3;o++){const a=e[4*o+n],s=a*t.min[o],l=a*t.max[o];r[n]+=Math.min(s,l),i[n]+=Math.max(s,l)}return new Bh(r,i)}static projectAabbCorners(e,r){const i=e.getCorners();for(let e=0;e<i.length;++e)t._.transformMat4(i[e],i[e],r);return i}constructor(e,r){this.min=e,this.max=r,this.center=t._.scale([],t._.add([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],i=t._.clone(this.min),n=t._.clone(this.max);for(let t=0;t<r.length;t++)i[t]=r[t]?this.min[t]:this.center[t],n[t]=r[t]?this.center[t]:this.max[t];return n[2]=this.max[2],new Bh(i,n)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,e=this.max;return[[t[0],t[1],t[2]],[e[0],t[1],t[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],e[2]],[t[0],e[1],e[2]]]}intersects(t){return this.intersectsAabb(t.bounds)?vh(t,this.getCorners()):0}intersectsFlat(t){return this.intersectsAabb(t.bounds)?vh(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(t,e){return e||this.intersects(t)?xh(t,this.getCorners()):0}intersectsPreciseFlat(t,e){return e||this.intersectsFlat(t)?xh(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let e=0;e<3;++e)if(this.min[e]>t.max[e]||t.min[e]>this.max[e])return!1;return!0}intersectsAabbXY(t){return!(this.min[0]>t.max[0]||t.min[0]>this.max[0]||this.min[1]>t.max[1]||t.min[1]>this.max[1])}encapsulate(t){for(let e=0;e<3;e++)this.min[e]=Math.min(this.min[e],t.min[e]),this.max[e]=Math.max(this.max[e],t.max[e])}encapsulatePoint(t){for(let e=0;e<3;e++)this.min[e]=Math.min(this.min[e],t[e]),this.max[e]=Math.max(this.max[e],t[e])}closestPoint(t){return[Math.max(Math.min(this.max[0],t[0]),this.min[0]),Math.max(Math.min(this.max[1],t[1]),this.min[1]),Math.max(Math.min(this.max[2],t[2]),this.min[2])]}}bs(Bh,"Aabb");const Ch=Pl([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Eh}=Ch,Th=Pl([{name:"a_pos_3",components:3,type:"Int16"}]);var Ih=Pl([{name:"a_pos",type:"Int16",components:2}]);function Sh(t){return t*iu/pu}const Mh=[new Bh([cu,cu,cu],[uu,uu,uu]),new Bh([cu,cu,cu],[0,0,uu]),new Bh([0,cu,cu],[uu,0,uu]),new Bh([cu,0,cu],[0,uu,uu]),new Bh([0,0,cu],[uu,uu,uu])];function Fh(e,r,i,n=!0){const o=t._.scale([],e._camera.position,e.worldSize),a=[r,i,1,1];t.aA.transformMat4(a,a,e.pixelMatrixInverse),t.aA.scale(a,a,1/a[3]);const s=t._.sub([],a,o),l=t._.normalize([],s),c=e.globeMatrix,u=[c[12],c[13],c[14]],h=t._.sub([],u,o),A=t._.length(h),p=t._.normalize([],h),d=e.worldSize/(2*Math.PI),f=t._.dot(p,l),m=Math.asin(d/A);if(m<Math.acos(f)){if(!n)return null;const e=[],r=[];t._.scale(e,l,A/f),t._.normalize(r,t._.sub(r,e,h)),t._.normalize(l,t._.add(l,h,t._.scale(l,r,Math.tan(m)*A)))}const g=[];new gh(o,l).closestPointOnSphere(u,d,g);const _=t._.normalize([],Tr(c,0)),y=t._.normalize([],Tr(c,1)),v=t._.normalize([],Tr(c,2)),x=t._.dot(_,g),w=t._.dot(y,g),b=t._.dot(v,g),B=Ge(Math.asin(-w/d));let C=Ge(Math.atan2(x,b));C=e.center.lng+function(t,e){const r=(e-t+180)%360-180;return r<-180?r+360:r}(e.center.lng,C);const E=Tu(C),T=Xe(Iu(B),0,1);return new Ru(E,T)}class Ph{constructor(e,r,i){this.a=t._.sub([],e,i),this.b=t._.sub([],r,i),this.center=i;const n=t._.normalize([],this.a),o=t._.normalize([],this.b);this.angle=Math.acos(t._.dot(n,o))}}function Lh(t,e){if(0===t.angle)return null;let r;return r=0===t.a[e]?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),r<0||r>1?null:function(t,e,r,i){const n=Math.sin(r);return t*(Math.sin((1-i)*r)/n)+e*(Math.sin(i*r)/n)}(t.a[e],t.b[e],t.angle,Xe(r,0,1))+t.center[e]}function Dh(t){if(t.z<=1)return Mh[t.z+2*t.y+t.x];const e=Qh(Oh(t));return Bh.fromPoints(e)}function Uh(e,r,i){return t._.scale(e,e,1-i),t._.scaleAndAdd(e,e,r,i)}function kh(e,r){const i=Wh(r.zoom);if(0===i)return Dh(e);const n=Oh(e),o=Qh(n),a=Tu(n.getWest())*r.worldSize,s=Tu(n.getEast())*r.worldSize,l=Iu(n.getNorth())*r.worldSize,c=Iu(n.getSouth())*r.worldSize,u=[a,l,0],h=[s,l,0],A=[a,c,0],p=[s,c,0],d=t.ad.invert([],r.globeMatrix);return t._.transformMat4(u,u,d),t._.transformMat4(h,h,d),t._.transformMat4(A,A,d),t._.transformMat4(p,p,d),o[0]=Uh(o[0],A,i),o[1]=Uh(o[1],p,i),o[2]=Uh(o[2],h,i),o[3]=Uh(o[3],u,i),Bh.fromPoints(o)}function zh(e,r,i){for(const n of e)t._.transformMat4(n,n,r),t._.scale(n,n,i)}function Rh(e,r,i,n){const o=r/e.worldSize,a=e.globeMatrix;if(i.z<=1){const t=Dh(i).getCorners();return zh(t,a,o),Bh.fromPoints(t)}const s=Oh(i,n),l=Qh(s,iu+Sh(e._tileCoverLift));zh(l,a,o);const c=Number.MAX_VALUE,u=[-c,-c,-c],h=[c,c,c];if(s.contains(e.center)){for(const e of l)t._.min(h,h,e),t._.max(u,u,e);u[2]=0;const r=e.point,i=[r.x*o,r.y*o,0];return t._.min(h,h,i),t._.max(u,u,i),new Bh(h,u)}if(e._tileCoverLift>0){for(const e of l)t._.min(h,h,e),t._.max(u,u,e);return new Bh(h,u)}const A=[a[12]*o,a[13]*o,a[14]*o],p=s.getCenter(),d=Xe(e.center.lat,-Lu,Lu),f=Xe(p.lat,-Lu,Lu),m=Tu(e.center.lng),g=Iu(d);let _=m-Tu(p.lng);const y=g-Iu(f);_>.5?_-=1:_<-.5&&(_+=1);let v=0;if(Math.abs(_)>Math.abs(y))v=_>=0?1:3;else{v=y>=0?0:2;const e=[a[4]*o,a[5]*o,a[6]*o],r=-Math.sin(je(y>=0?s.getSouth():s.getNorth()))*iu;t._.scaleAndAdd(A,A,e,r)}const x=l[v],w=l[(v+1)%4],b=new Ph(x,w,A),B=[Lh(b,0)||x[0],Lh(b,1)||x[1],Lh(b,2)||x[2]],C=Wh(e.zoom);if(C>0){const n=function({x:t,y:e,z:r},i,n,o,a){const s=1/(1<<r);let l=t*s,c=l+s,u=e*s,h=u+s,A=0;const p=(l+c)/2-o;return p>.5?A=-1:p<-.5&&(A=1),l=((l+A)*i-(o*=i))*n+o,c=((c+A)*i-o)*n+o,u=(u*i-(a*=i))*n+a,h=(h*i-a)*n+a,[[l,h,0],[c,h,0],[c,u,0],[l,u,0]]}(i,r,e._pixelsPerMercatorPixel,m,g);for(let t=0;t<l.length;t++)Uh(l[t],n[t],C);const o=t._.add([],n[v],n[(v+1)%4]);t._.scale(o,o,.5),Uh(B,o,C)}for(const e of l)t._.min(h,h,e),t._.max(u,u,e);return h[2]=Math.min(x[2],w[2]),t._.min(h,h,B),t._.max(u,u,B),new Bh(h,u)}function Oh({x:t,y:e,z:r},i=!1){const n=1/(1<<r),o=new fu(Mu(t*n),e===(1<<r)-1&&i?-90:Fu((e+1)*n)),a=new fu(Mu((t+1)*n),0===e&&i?90:Fu(e*n));return new mu(o,a)}function Qh(t,e=iu){const r=je(t.getNorth()),i=je(t.getSouth()),n=Math.cos(r),o=Math.cos(i),a=Math.sin(r),s=Math.sin(i),l=t.getWest(),c=t.getEast();return[hu(o,s,l,e),hu(o,s,c,e),hu(n,a,c,e),hu(n,a,l,e)]}function Nh(t,e,r,i){const n=1<<r.z,o=(t/Ao+r.x)/n;return Au(Fu((e/Ao+r.y)/n),Mu(o),i)}function Vh({min:t,max:e}){return au/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const Hh=new Float64Array(16);function jh(e){const r=Vh(e),i=t.ad.fromScaling(Hh,[r,r,r]);return t.ad.translate(i,i,t._.negate([],e.min))}function Gh(e){const r=t.ad.fromTranslation(Hh,e.min),i=1/Vh(e);return t.ad.scale(r,r,[i,i,i])}function Kh(t){const e=Ao/(2*Math.PI);return t/(2*Math.PI)/e}function qh(t,e){return Ao/(512*Math.pow(2,t))*Vh(Dh(e))}function Zh(e,r,i,n,o){const a=Kh(i),s=[e,r,-i/(2*Math.PI)],l=t.ad.identity(new Float64Array(16));return t.ad.translate(l,l,s),t.ad.scale(l,l,[a,a,a]),t.ad.rotateX(l,l,je(-o)),t.ad.rotateY(l,l,je(-n)),l}function Wh(t){return $e(nu,ou,t)}function Xh(e,r){const i=Au(r.lat,r.lng),n=function(e){const r=Au(e._center.lat,e._center.lng),i=t._.fromValues(0,1,0);let n=t._.cross([],i,r);const o=t.ad.fromRotation([],-e.angle,r);n=t._.transformMat4(n,n,o),t.ad.fromRotation(o,-e._pitch,n);const a=t._.normalize([],r);return t._.scale(a,a,Sh(e.cameraToCenterDistance/e.pixelsPerMeter)),t._.transformMat4(a,a,o),t._.add([],r,a)}(e),o=t._.subtract([],n,i);return t._.angle(o,i)}function $h(t,e){return Xh(t,e)>Math.PI/2*1.01}const Yh=je(85),Jh=Math.cos(Yh),tA=Math.sin(Yh),eA=t.ad.create(),rA=t=>{const e=[];return"map"===t.paint.get("circle-pitch-alignment")&&e.push("PITCH_WITH_MAP"),"map"===t.paint.get("circle-pitch-scale")&&e.push("SCALE_WITH_MAP"),e};function iA(e,r,i,n,o,a,s,l,c){if(a&&e.queryGeometry.isAboveHorizon)return!1;a&&(c*=e.pixelToTileUnitsFactor);const u=e.tileID.canonical,h=i.projection.upVectorScale(u,i.center.lat,i.worldSize).metersToTile;for(const A of r)for(const r of A){const A=r.add(l),p=o&&i.elevation?i.elevation.exaggeration()*o.getElevationAt(A.x,A.y,!0):0,d=i.projection.projectTilePoint(A.x,A.y,u);if(p>0){const t=i.projection.upVector(u,A.x,A.y);d.x+=t[0]*h*p,d.y+=t[1]*h*p,d.z+=t[2]*h*p}const f=a?A:nA(d.x,d.y,d.z,n),m=a?e.tilespaceRays.map((t=>sA(t,p))):e.queryGeometry.screenGeometry,g=t.aA.transformMat4([],[d.x,d.y,d.z,1],n);if(!s&&a?c*=g[3]/i.cameraToCenterDistance:s&&!a&&(c*=i.cameraToCenterDistance/g[3]),a){const t=Fu((r.y/Ao+u.y)/(1<<u.z));c/=i.projection.pixelsPerMeter(t,1)/Su(1,t)}if(Yu(m,f,c))return!0}return!1}function nA(e,r,i,n){const o=t.aA.transformMat4([],[e,r,i,1],n);return new Ne(o[0]/o[3],o[1]/o[3])}const oA=t._.fromValues(0,0,0),aA=t._.fromValues(0,0,1);function sA(e,r){const i=t._.create();return oA[2]=r,e.intersectsPlane(oA,aA,i),new Ne(i[0],i[1])}class lA extends Xu{}function cA(t,{width:e,height:r},i,n){if(n){if(n instanceof Uint8ClampedArray)n=new Uint8Array(n.buffer);else if(n.length!==e*r*i)throw new RangeError("mismatched image size")}else n=new Uint8Array(e*r*i);return t.width=e,t.height=r,t.data=n,t}function uA(t,e,r){const{width:i,height:n}=e;i===t.width&&n===t.height||(hA(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,i),height:Math.min(t.height,n)},r,null),t.width=i,t.height=n,t.data=e.data)}function hA(t,e,r,i,n,o,a,s){if(0===n.width||0===n.height)return e;if(n.width>t.width||n.height>t.height||r.x>t.width-n.width||r.y>t.height-n.height)throw new RangeError("out of range source coordinates for image copy");if(n.width>e.width||n.height>e.height||i.x>e.width-n.width||i.y>e.height-n.height)throw new RangeError("out of range destination coordinates for image copy");const l=t.data,c=e.data,u=4===o&&s;for(let s=0;s<n.height;s++){const h=((r.y+s)*t.width+r.x)*o,A=((i.y+s)*e.width+i.x)*o;if(u)for(let t=0;t<n.width;t++){const e=h+t*o+3,r=A+t*o;c[r+0]=255,c[r+1]=255,c[r+2]=255,c[r+3]=l[e]}else if(a)for(let t=0;t<n.width;t++){const e=h+t*o,r=A+t*o,i=l[e+3],n=new Vi(l[e+0]/255*i,l[e+1]/255*i,l[e+2]/255*i,i).toRenderColor(a).toArray();c[r+0]=n[0],c[r+1]=n[1],c[r+2]=n[2],c[r+3]=n[3]}else for(let t=0;t<n.width*o;t++)c[A+t]=l[h+t]}return e}bs(lA,"HeatmapBucket",{omit:["layers"]});class AA{constructor(t,e){cA(this,t,1,e)}resize(t){uA(this,new AA(t),1)}clone(){return new AA({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,r,i,n){hA(t,e,r,i,n,1,null)}}class pA{constructor(t,e){cA(this,t,4,e)}resize(t){uA(this,new pA(t),4)}replace(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new pA({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,r,i,n,o,a){hA(t,e,r,i,n,4,o,a)}}class dA{constructor(t,e){this.width=t.width,this.height=t.height,this.data=e instanceof Uint8Array?new Float32Array(e.buffer):e}}bs(AA,"AlphaImage"),bs(pA,"RGBAImage");const fA=new sl({visibility:new nl(ll.layout_heatmap.visibility)});var mA={paint:new sl({"heatmap-radius":new ol(ll.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ol(ll.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new nl(ll.paint_heatmap["heatmap-intensity"]),"heatmap-color":new al(ll.paint_heatmap["heatmap-color"]),"heatmap-opacity":new nl(ll.paint_heatmap["heatmap-opacity"])}),layout:fA};function gA(t){const e={},r=t.resolution||256,i=t.clips?t.clips.length:1,n=t.image||new pA({width:r,height:i}),o=(r,i,o)=>{e[t.evaluationKey]=o;const a=t.expression.evaluate(e);a&&(n.data[r+i+0]=Math.floor(255*a.r/a.a),n.data[r+i+1]=Math.floor(255*a.g/a.a),n.data[r+i+2]=Math.floor(255*a.b/a.a),n.data[r+i+3]=Math.floor(255*a.a))};if(t.clips)for(let e=0,n=0;e<i;++e,n+=4*r)for(let i=0,a=0;i<r;i++,a+=4){const s=i/(r-1),{start:l,end:c}=t.clips[e];o(n,a,l*(1-s)+c*s)}else for(let t=0,e=0;t<r;t++,e+=4)o(0,e,t/(r-1));return n}const _A=new sl({visibility:new nl(ll.layout_hillshade.visibility)});var yA={paint:new sl({"hillshade-illumination-direction":new nl(ll.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new nl(ll.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new nl(ll.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new nl(ll.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new nl(ll.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new nl(ll.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new nl(ll.paint_hillshade["hillshade-emissive-strength"])}),layout:_A};const vA=Pl([{name:"a_pos",components:2,type:"Int16"}],4),{members:xA}=vA;function wA(t,e,r=2){const i=e&&e.length,n=i?e[0]*r:t.length;let o=bA(t,0,n,r,!0);const a=[];if(!o||o.next===o.prev)return a;let s,l,c;if(i&&(o=function(t,e,r,i){const n=[];for(let r=0,o=e.length;r<o;r++){const a=bA(t,e[r]*i,r<o-1?e[r+1]*i:t.length,i,!1);a===a.next&&(a.steiner=!0),n.push(DA(a))}n.sort(MA);for(let t=0;t<n.length;t++)r=FA(n[t],r);return r}(t,e,o,r)),t.length>80*r){s=1/0,l=1/0;let e=-1/0,i=-1/0;for(let o=r;o<n;o+=r){const r=t[o],n=t[o+1];r<s&&(s=r),n<l&&(l=n),r>e&&(e=r),n>i&&(i=n)}c=Math.max(e-s,i-l),c=0!==c?32767/c:0}return CA(o,a,r,s,l,c,0),a}function bA(t,e,r,i,n){let o;if(n===function(t,e,r,i){let n=0;for(let o=e,a=r-i;o<r;o+=i)n+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return n}(t,e,r,i)>0)for(let n=e;n<r;n+=i)o=jA(n/i|0,t[n],t[n+1],o);else for(let n=r-i;n>=e;n-=i)o=jA(n/i|0,t[n],t[n+1],o);return o&&RA(o,o.next)&&(GA(o),o=o.next),o}function BA(t,e){if(!t)return t;e||(e=t);let r,i=t;do{if(r=!1,i.steiner||!RA(i,i.next)&&0!==zA(i.prev,i,i.next))i=i.next;else{if(GA(i),i=e=i.prev,i===i.next)break;r=!0}}while(r||i!==e);return e}function CA(t,e,r,i,n,o,a){if(!t)return;!a&&o&&function(t,e,r,i){let n=t;do{0===n.z&&(n.z=LA(n.x,n.y,e,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){let e,r=1;do{let i,n=t;t=null;let o=null;for(e=0;n;){e++;let a=n,s=0;for(let t=0;t<r&&(s++,a=a.nextZ,a);t++);let l=r;for(;s>0||l>0&&a;)0!==s&&(0===l||!a||n.z<=a.z)?(i=n,n=n.nextZ,s--):(i=a,a=a.nextZ,l--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=a}o.nextZ=null,r*=2}while(e>1)}(n)}(t,i,n,o);let s=t;for(;t.prev!==t.next;){const l=t.prev,c=t.next;if(o?TA(t,i,n,o):EA(t))e.push(l.i,t.i,c.i),GA(t),t=c.next,s=c.next;else if((t=c)===s){a?1===a?CA(t=IA(BA(t),e),e,r,i,n,o,2):2===a&&SA(t,e,r,i,n,o):CA(BA(t),e,r,i,n,o,1);break}}}function EA(t){const e=t.prev,r=t,i=t.next;if(zA(e,r,i)>=0)return!1;const n=e.x,o=r.x,a=i.x,s=e.y,l=r.y,c=i.y,u=n<o?n<a?n:a:o<a?o:a,h=s<l?s<c?s:c:l<c?l:c,A=n>o?n>a?n:a:o>a?o:a,p=s>l?s>c?s:c:l>c?l:c;let d=i.next;for(;d!==e;){if(d.x>=u&&d.x<=A&&d.y>=h&&d.y<=p&&UA(n,s,o,l,a,c,d.x,d.y)&&zA(d.prev,d,d.next)>=0)return!1;d=d.next}return!0}function TA(t,e,r,i){const n=t.prev,o=t,a=t.next;if(zA(n,o,a)>=0)return!1;const s=n.x,l=o.x,c=a.x,u=n.y,h=o.y,A=a.y,p=s<l?s<c?s:c:l<c?l:c,d=u<h?u<A?u:A:h<A?h:A,f=s>l?s>c?s:c:l>c?l:c,m=u>h?u>A?u:A:h>A?h:A,g=LA(p,d,e,r,i),_=LA(f,m,e,r,i);let y=t.prevZ,v=t.nextZ;for(;y&&y.z>=g&&v&&v.z<=_;){if(y.x>=p&&y.x<=f&&y.y>=d&&y.y<=m&&y!==n&&y!==a&&UA(s,u,l,h,c,A,y.x,y.y)&&zA(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,v.x>=p&&v.x<=f&&v.y>=d&&v.y<=m&&v!==n&&v!==a&&UA(s,u,l,h,c,A,v.x,v.y)&&zA(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;y&&y.z>=g;){if(y.x>=p&&y.x<=f&&y.y>=d&&y.y<=m&&y!==n&&y!==a&&UA(s,u,l,h,c,A,y.x,y.y)&&zA(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;v&&v.z<=_;){if(v.x>=p&&v.x<=f&&v.y>=d&&v.y<=m&&v!==n&&v!==a&&UA(s,u,l,h,c,A,v.x,v.y)&&zA(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function IA(t,e){let r=t;do{const i=r.prev,n=r.next.next;!RA(i,n)&&OA(i,r,r.next,n)&&VA(i,n)&&VA(n,i)&&(e.push(i.i,r.i,n.i),GA(r),GA(r.next),r=t=n),r=r.next}while(r!==t);return BA(r)}function SA(t,e,r,i,n,o){let a=t;do{let t=a.next.next;for(;t!==a.prev;){if(a.i!==t.i&&kA(a,t)){let s=HA(a,t);return a=BA(a,a.next),s=BA(s,s.next),CA(a,e,r,i,n,o,0),void CA(s,e,r,i,n,o,0)}t=t.next}a=a.next}while(a!==t)}function MA(t,e){return t.x-e.x}function FA(t,e){const r=function(t,e){let r=e;const i=t.x,n=t.y;let o,a=-1/0;do{if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){const t=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(t<=i&&t>a&&(a=t,o=r.x<r.next.x?r:r.next,t===i))return o}r=r.next}while(r!==e);if(!o)return null;const s=o,l=o.x,c=o.y;let u=1/0;r=o;do{if(i>=r.x&&r.x>=l&&i!==r.x&&UA(n<c?i:a,n,l,c,n<c?a:i,n,r.x,r.y)){const e=Math.abs(n-r.y)/(i-r.x);VA(r,t)&&(e<u||e===u&&(r.x>o.x||r.x===o.x&&PA(o,r)))&&(o=r,u=e)}r=r.next}while(r!==s);return o}(t,e);if(!r)return e;const i=HA(r,t);return BA(i,i.next),BA(r,r.next)}function PA(t,e){return zA(t.prev,t,e.prev)<0&&zA(e.next,t,t.next)<0}function LA(t,e,r,i,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function DA(t){let e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function UA(t,e,r,i,n,o,a,s){return(n-a)*(e-s)>=(t-a)*(o-s)&&(t-a)*(i-s)>=(r-a)*(e-s)&&(r-a)*(o-s)>=(n-a)*(i-s)}function kA(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&OA(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(VA(t,e)&&VA(e,t)&&function(t,e){let r=t,i=!1;const n=(t.x+e.x)/2,o=(t.y+e.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&n<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==t);return i}(t,e)&&(zA(t.prev,t,e.prev)||zA(t,e.prev,e))||RA(t,e)&&zA(t.prev,t,t.next)>0&&zA(e.prev,e,e.next)>0)}function zA(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function RA(t,e){return t.x===e.x&&t.y===e.y}function OA(t,e,r,i){const n=NA(zA(t,e,r)),o=NA(zA(t,e,i)),a=NA(zA(r,i,t)),s=NA(zA(r,i,e));return n!==o&&a!==s||!(0!==n||!QA(t,r,e))||!(0!==o||!QA(t,i,e))||!(0!==a||!QA(r,t,i))||!(0!==s||!QA(r,e,i))}function QA(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function NA(t){return t>0?1:t<0?-1:0}function VA(t,e){return zA(t.prev,t,t.next)<0?zA(t,e,t.next)>=0&&zA(t,t.prev,e)>=0:zA(t,e,t.prev)<0||zA(t,t.next,e)<0}function HA(t,e){const r=KA(t.i,t.x,t.y),i=KA(e.i,e.x,e.y),n=t.next,o=e.prev;return t.next=e,e.prev=t,r.next=n,n.prev=r,i.next=r,r.prev=i,o.next=i,i.prev=o,i}function jA(t,e,r,i){const n=KA(t,e,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function GA(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function KA(t,e,r){return{i:t,x:e,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function qA(t,e){const r=t.length;if(r<=1)return[t];const i=[];let n,o;for(let e=0;e<r;e++){const r=fr(t[e]);0!==r&&(t[e].area=Math.abs(r),void 0===o&&(o=r<0),o===r<0?(n&&i.push(n),n=[t[e]]):n.push(t[e]))}if(n&&i.push(n),e>1)for(let t=0;t<i.length;t++)i[t].length<=e||(Un(i[t],e,1,i[t].length-1,ZA),i[t]=i[t].slice(0,e));return i}function ZA(t,e){return e.area-t.area}function WA(t,e,r){const i=r.patternDependencies;let n=!1;for(const r of e){const e=r.paint.get(`${t}-pattern`);e.isConstant()||(n=!0);const o=e.constantOr(null);o&&(n=!0,i[o]=!0)}return n}function XA(t,e,r,i,n){const o=n.patternDependencies;for(const a of e){const e=a.paint.get(`${t}-pattern`).value;if("constant"!==e.kind){let t=e.evaluate({zoom:i},r,{},n.availableImages);t=t&&t.name?t.name:t,o[t]=!0,r.patterns[a.id]=t}}return r}class $A{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Dl,this.indexArray=new Jl,this.indexArray2=new Zl,this.programConfigurations=new $c(t.layers,{zoom:t.zoom,lut:t.lut}),this.segments=new Bc,this.segments2=new Bc,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.projection=t.projection}updateFootprints(t,e){}populate(t,e,r,i){this.hasPattern=WA("fill",this.layers,e);const n=this.layers[0].layout.get("fill-sort-key"),o=[];for(const{feature:a,id:s,index:l,sourceLayerIndex:c}of t){const t=this.layers[0]._featureFilter.needGeometry,u=qu(a,t);if(!this.layers[0]._featureFilter.filter(new Ws(this.zoom),u,r))continue;const h=n?n.evaluate(u,{},r,e.availableImages):void 0,A={id:s,properties:a.properties,type:a.type,sourceLayerIndex:c,index:l,geometry:t?u.geometry:Ku(a,r,i),patterns:{},sortKey:h};o.push(A)}n&&o.sort(((t,e)=>t.sortKey-e.sortKey));for(const i of o){const{geometry:n,index:o,sourceLayerIndex:a}=i;if(this.hasPattern){const t=XA("fill",this.layers,i,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(i,n,o,r,{},e.availableImages,e.brightness);e.featureIndex.insert(t[o].feature,n,o,a,this.index)}}update(t,e,r,i,n){const o=0!==Object.keys(t).length;o&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,e,o?this.stateDependentLayers:this.layers,r,i,n)}addFeatures(t,e,r,i,n,o){for(const t of this.patternFeatures)this.addFeature(t,t.geometry,t.index,e,r,i,o)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,xA),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,e,r,i,n,o=[],a){for(const t of qA(e,500)){let e=0;for(const r of t)e+=r.length;const r=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray),i=r.vertexLength,n=[],o=[];for(const e of t){if(0===e.length)continue;e!==t[0]&&o.push(n.length/2);const r=this.segments2.prepareSegment(e.length,this.layoutVertexArray,this.indexArray2),i=r.vertexLength;this.layoutVertexArray.emplaceBack(e[0].x,e[0].y),this.indexArray2.emplaceBack(i+e.length-1,i),n.push(e[0].x),n.push(e[0].y);for(let t=1;t<e.length;t++)this.layoutVertexArray.emplaceBack(e[t].x,e[t].y),this.indexArray2.emplaceBack(i+t-1,i+t),n.push(e[t].x),n.push(e[t].y);r.vertexLength+=e.length,r.primitiveLength+=e.length}const a=wA(n,o);for(let t=0;t<a.length;t+=3)this.indexArray.emplaceBack(i+a[t],i+a[t+1],i+a[t+2]);r.vertexLength+=e,r.primitiveLength+=a.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,n,o,i,a)}}bs($A,"FillBucket",{omit:["layers","patternFeatures"]});const YA=new sl({"fill-sort-key":new ol(ll.layout_fill["fill-sort-key"]),visibility:new nl(ll.layout_fill.visibility)});var JA={paint:new sl({"fill-antialias":new nl(ll.paint_fill["fill-antialias"]),"fill-opacity":new ol(ll.paint_fill["fill-opacity"]),"fill-color":new ol(ll.paint_fill["fill-color"]),"fill-outline-color":new ol(ll.paint_fill["fill-outline-color"]),"fill-translate":new nl(ll.paint_fill["fill-translate"]),"fill-translate-anchor":new nl(ll.paint_fill["fill-translate-anchor"]),"fill-pattern":new ol(ll.paint_fill["fill-pattern"]),"fill-emissive-strength":new nl(ll.paint_fill["fill-emissive-strength"])}),layout:YA};class tp{constructor(t,e,r,i){if(this.triangleCount=e.length/3,this.min=new Ne(0,0),this.max=new Ne(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===t.length)return;const[n,o]=[t[0].clone(),t[0].clone()];for(let e=1;e<t.length;++e){const r=t[e];n.x=Math.min(n.x,r.x),n.y=Math.min(n.y,r.y),o.x=Math.max(o.x,r.x),o.y=Math.max(o.y,r.y)}if(i){const t=Math.ceil(Math.max(o.x-n.x,o.y-n.y)/i);r=Math.max(r,t)}if(0===r)return;this.min=n,this.max=o;const a=this.max.sub(this.min);a.x=Math.max(a.x,1),a.y=Math.max(a.y,1);const s=Math.max(a.x,a.y)/r;this.cellsX=Math.max(1,Math.ceil(a.x/s)),this.cellsY=Math.max(1,Math.ceil(a.y/s)),this.xScale=1/s,this.yScale=1/s;const l=[];for(let r=0;r<this.triangleCount;r++){const i=t[e[3*r+0]].sub(this.min),n=t[e[3*r+1]].sub(this.min),o=t[e[3*r+2]].sub(this.min),a=ep(Math.floor(Math.min(i.x,n.x,o.x)),this.xScale,this.cellsX),c=ep(Math.floor(Math.max(i.x,n.x,o.x)),this.xScale,this.cellsX),u=ep(Math.floor(Math.min(i.y,n.y,o.y)),this.yScale,this.cellsY),h=ep(Math.floor(Math.max(i.y,n.y,o.y)),this.yScale,this.cellsY),A=new Ne(0,0),p=new Ne(0,0),d=new Ne(0,0),f=new Ne(0,0);for(let t=u;t<=h;++t){A.y=p.y=t*s,d.y=f.y=(t+1)*s;for(let e=a;e<=c;++e)A.x=d.x=e*s,p.x=f.x=(e+1)*s,(uh(i,n,o,A,p,f)||uh(i,n,o,A,f,d))&&l.push({cellIdx:t*this.cellsX+e,triIdx:r})}}if(0===l.length)return;l.sort(((t,e)=>t.cellIdx-e.cellIdx||t.triIdx-e.triIdx));let c=0;for(;c<l.length;){const t=l[c].cellIdx,e={start:this.payload.length,len:0};for(;c<l.length&&l[c].cellIdx===t;)++e.len,this.payload.push(l[c++].triIdx);this.cells[t]=e}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(t,e){if(0===this.triangleCount||0===this.cells.length)return;if(t.x>this.max.x||this.min.x>t.x||t.y>this.max.y||this.min.y>t.y)return;const r=ep(t.x-this.min.x,this.xScale,this.cellsX),i=ep(t.y-this.min.y,this.yScale,this.cellsY),n=this.cells[i*this.cellsX+r];if(n){this._lazyInitLookup();for(let t=0;t<n.len;t++){const r=this.payload[n.start+t],i=Math.floor(r/8),o=1<<r%8;if(!(this.lookup[i]&o)&&(this.lookup[i]|=o,e.push(r),e.length===this.triangleCount))return}}}query(t,e,r){if(0===this.triangleCount||0===this.cells.length)return;if(t.x>this.max.x||this.min.x>e.x)return;if(t.y>this.max.y||this.min.y>e.y)return;this._lazyInitLookup();const i=ep(t.x-this.min.x,this.xScale,this.cellsX),n=ep(e.x-this.min.x,this.xScale,this.cellsX),o=ep(t.y-this.min.y,this.yScale,this.cellsY),a=ep(e.y-this.min.y,this.yScale,this.cellsY);for(let t=o;t<=a;t++)for(let e=i;e<=n;e++){const i=this.cells[t*this.cellsX+e];if(i)for(let t=0;t<i.len;t++){const e=this.payload[i.start+t],n=Math.floor(e/8),o=1<<e%8;if(!(this.lookup[n]&o)&&(this.lookup[n]|=o,r.push(e),r.length===this.triangleCount))return}}}}function ep(t,e,r){return Math.max(0,Math.min(r-1,Math.floor(t*e)))}bs(tp,"TriangleGridIndex");class rp{constructor(t){this.zoom=t.zoom,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.index=t.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.footprints=[]}updateFootprints(t,e){for(const r of this.footprints)e.push({footprint:r,id:t})}populate(t,e,r,i){const n=[];for(const{feature:e,id:o,index:a,sourceLayerIndex:s}of t){const t=this.layers[0]._featureFilter.needGeometry,l=qu(e,t);if(!this.layers[0]._featureFilter.filter(new Ws(this.zoom),l,r))continue;const c={id:o,properties:e.properties,type:e.type,sourceLayerIndex:s,index:a,geometry:t?l.geometry:Ku(e,r,i),patterns:{}};n.push(c)}for(const i of n){const{geometry:n,index:o,sourceLayerIndex:a}=i;this.addFeature(i,n,o,r,{},e.availableImages,e.brightness),e.featureIndex.insert(t[o].feature,n,o,a,this.index)}}isEmpty(){return 0===this.footprints.length}uploadPending(){return!1}upload(t){}update(t,e,r,i,n){}destroy(){}addFeature(t,e,r,i,n,o=[],a){for(const t of qA(e,2)){const e=[],r=[],i=[],n=new Ne(1/0,1/0),o=new Ne(-1/0,-1/0);for(const a of t)if(0!==a.length){a!==t[0]&&i.push(r.length/2);for(let t=0;t<a.length;t++)r.push(a[t].x),r.push(a[t].y),e.push(a[t]),n.x=Math.min(n.x,a[t].x),n.y=Math.min(n.y,a[t].y),o.x=Math.max(o.x,a[t].x),o.y=Math.max(o.y,a[t].y)}const a=wA(r,i),s=new tp(e,a,8,256);this.footprints.push({vertices:e,indices:a,grid:s,min:n,max:o})}}}bs(rp,"ClipBucket",{omit:["layers"]});const ip=new sl({"clip-layer-types":new nl(ll.layout_clip["clip-layer-types"])});var np={paint:new sl({}),layout:ip};const op=Pl([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),ap=Pl([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),sp=Pl([{name:"a_centroid_pos",components:2,type:"Uint16"}]),lp=Pl([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),cp=Pl([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:up}=op;var hp={},Ap=Oe,pp=dp;function dp(t,e,r,i,n){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=i,this._values=n,t.readFields(fp,this,e)}function fp(t,e,r){1==t?e.id=r.readVarint():2==t?function(t,e){for(var r=t.readVarint()+t.pos;t.pos<r;){var i=e._keys[t.readVarint()],n=e._values[t.readVarint()];e.properties[i]=n}}(r,e):3==t?e.type=r.readVarint():4==t&&(e._geometry=r.pos)}function mp(t){for(var e,r,i=0,n=0,o=t.length,a=o-1;n<o;a=n++)i+=((r=t[a]).x-(e=t[n]).x)*(e.y+r.y);return i}dp.types=["Unknown","Point","LineString","Polygon"],dp.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,i=1,n=0,o=0,a=0,s=[];t.pos<r;){if(n<=0){var l=t.readVarint();i=7&l,n=l>>3}if(n--,1===i||2===i)o+=t.readSVarint(),a+=t.readSVarint(),1===i&&(e&&s.push(e),e=[]),e.push(new Ap(o,a));else{if(7!==i)throw new Error("unknown command "+i);e&&e.push(e[0].clone())}}return e&&s.push(e),s},dp.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,i=0,n=0,o=0,a=1/0,s=-1/0,l=1/0,c=-1/0;t.pos<e;){if(i<=0){var u=t.readVarint();r=7&u,i=u>>3}if(i--,1===r||2===r)(n+=t.readSVarint())<a&&(a=n),n>s&&(s=n),(o+=t.readSVarint())<l&&(l=o),o>c&&(c=o);else if(7!==r)throw new Error("unknown command "+r)}return[a,l,s,c]},dp.prototype.toGeoJSON=function(t,e,r){var i,n,o=this.extent*Math.pow(2,r),a=this.extent*t,s=this.extent*e,l=this.loadGeometry(),c=dp.types[this.type];function u(t){for(var e=0;e<t.length;e++){var r=t[e];t[e]=[360*(r.x+a)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(r.y+s)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(i=0;i<l.length;i++)h[i]=l[i][0];u(l=h);break;case 2:for(i=0;i<l.length;i++)u(l[i]);break;case 3:for(l=function(t){var e=t.length;if(e<=1)return[t];for(var r,i,n=[],o=0;o<e;o++){var a=mp(t[o]);0!==a&&(void 0===i&&(i=a<0),i===a<0?(r&&n.push(r),r=[t[o]]):r.push(t[o]))}return r&&n.push(r),n}(l),i=0;i<l.length;i++)for(n=0;n<l[i].length;n++)u(l[i][n])}1===l.length?l=l[0]:c="Multi"+c;var A={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(A.id=this.id),A};var gp=pp,_p=yp;function yp(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(vp,this,e),this.length=this._features.length}function vp(t,e,r){15===t?e.version=r.readVarint():1===t?e.name=r.readString():5===t?e.extent=r.readVarint():2===t?e._features.push(r.pos):3===t?e._keys.push(r.readString()):4===t&&e._values.push(function(t){for(var e=null,r=t.readVarint()+t.pos;t.pos<r;){var i=t.readVarint()>>3;e=1===i?t.readString():2===i?t.readFloat():3===i?t.readDouble():4===i?t.readVarint64():5===i?t.readVarint():6===i?t.readSVarint():7===i?t.readBoolean():null}return e}(r))}yp.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new gp(this._pbf,e,this.extent,this._keys,this._values)};var xp=_p;function wp(t,e,r){if(3===t){var i=new xp(r,r.readVarint()+r.pos);i.length&&(e[i.name]=i)}}var bp=hp.VectorTile=function(t,e){this.layers=t.readFields(wp,{},e)},Bp=hp.VectorTileFeature=pp;hp.VectorTileLayer=_p;class Cp extends Ne{constructor(t,e,r){super(t,e),this.z=r}}class Ep extends Cp{constructor(t,e,r,i){super(t,e,r),this.w=i}}function Tp(t,e,r,i){const n=[],o=0===i?(t,e,r,i,n,o)=>{t.push(new Ne(o,r+(o-e)/(i-e)*(n-r)))}:(t,e,r,i,n,o)=>{t.push(new Ne(e+(o-r)/(n-r)*(i-e),o))};for(const a of t){const t=[];for(const n of a){if(n.length<=2)continue;const a=[];for(let t=0;t<n.length-1;t++){const s=n[t].x,l=n[t].y,c=n[t+1].x,u=n[t+1].y,h=0===i?s:l,A=0===i?c:u;h<e?A>e&&o(a,s,l,c,u,e):h>r?A<r&&o(a,s,l,c,u,r):a.push(n[t]),A<e&&h>=e&&o(a,s,l,c,u,e),A>r&&h<=r&&o(a,s,l,c,u,r)}let s=n[n.length-1];const l=0===i?s.x:s.y;l>=e&&l<=r&&a.push(s),a.length&&(s=a[a.length-1],a[0].x===s.x&&a[0].y===s.y||a.push(a[0]),t.push(a))}t.length&&n.push(t)}return n}function Ip(t,e,r,i){const n="x"===r?"y":"x",o=(i-t[r])/(e[r]-t[r]);t[n]=t[n]+(e[n]-t[n])*o,t[r]=i,t.hasOwnProperty("z")&&(t.z=ji(t.z,e.z,o)),t.hasOwnProperty("w")&&(t.w=ji(t.w,e.w,o))}function Sp(t,e,r,i){const n=r,o=i;for(const r of["x","y"]){let i=t,a=e;i[r]>=a[r]&&(i=e,a=t),i[r]<n&&a[r]>n&&Ip(i,a,r,n),i[r]<o&&a[r]>o&&Ip(a,i,r,o)}}function Mp(t,e){return t.x-e.x||t.y-e.y}function Fp(t,e){return 0===Mp(t.min,e.min)&&0===Mp(t.max,e.max)}function Pp(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function Lp(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r].sourceId!==e[r].sourceId||!Fp(t[r],e[r])||t[r].order!==e[r].order||t[r].clipMask!==e[r].clipMask)return!1;return!0}function Dp(t,e,r){const i=1/Ao,n=1/(1<<r.canonical.z),o=(e.x*i+r.canonical.x)*n+r.wrap,a=(e.y*i+r.canonical.y)*n;return{min:new Ne((t.x*i+r.canonical.x)*n+r.wrap,(t.y*i+r.canonical.y)*n),max:new Ne(o,a)}}function Up(t,e,r){const i=1<<r.canonical.z,n=((e.x-r.wrap)*i-r.canonical.x)*Ao,o=(e.y*i-r.canonical.y)*Ao;return{min:new Ne(((t.x-r.wrap)*i-r.canonical.x)*Ao,(t.y*i-r.canonical.y)*Ao),max:new Ne(n,o)}}function kp(t,e,r,i,n,o,a){const s=t.indices,l=t.vertices,c=[];for(let u=i;u<i+n;u+=3){const i=e[r[u+0]+o],n=e[r[u+1]+o],h=e[r[u+2]+o],A=Math.min(i.x,n.x,h.x),p=Math.max(i.x,n.x,h.x),d=Math.min(i.y,n.y,h.y),f=Math.max(i.y,n.y,h.y);c.length=0,t.grid.query(new Ne(A,d),new Ne(p,f),c);for(let t=0;t<c.length;t++){const e=c[t];if(uh(l[s[3*e+0]],l[s[3*e+1]],l[s[3*e+2]],i,n,h,a))return!0}}return!1}function zp(t,e,r,i){if(!t||!r)return!1;let n=t.vertices;if(!e.canonical.equals(i.canonical)||e.wrap!==i.wrap){if(r.vertices.length<t.vertices.length)return zp(r,i,t,e);const o=e.canonical,a=i.canonical,s=Math.pow(2,a.z-o.z);n=t.vertices.map((t=>new Ne((t.x+o.x*Ao)*s-a.x*Ao,(t.y+o.y*Ao)*s-a.y*Ao)))}return kp(r,n,t.indices,0,t.indices.length,0,0)}function Rp(t,e,r,i){const n=Math.pow(2,i.z-r.z);return new Ne((t+r.x*Ao)*n-i.x*Ao,(e+r.y*Ao)*n-i.y*Ao)}function Op(t,e){const r=[];e.footprint.grid.queryPoint(t,r);const i=e.footprint.indices,n=e.footprint.vertices;for(let e=0;e<r.length;e++){const o=r[e];if(ah([n[i[3*o+0]],n[i[3*o+1]],n[i[3*o+2]]],t))return!0}return!1}class Qp{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,e){const r=this.toIdx(t,e);return{min:this.minimums[r],max:this.maximums[r]}}isLeaf(t,e){return this.leaves[this.toIdx(t,e)]}toIdx(t,e){return e*this.size+t}}function Np(t,e,r,i){let n=0,o=Number.MAX_VALUE;for(let a=0;a<3;a++)if(Math.abs(i[a])<1e-15){if(r[a]<t[a]||r[a]>e[a])return null}else{const s=1/i[a];let l=(t[a]-r[a])*s,c=(e[a]-r[a])*s;if(l>c){const t=l;l=c,c=t}if(l>n&&(n=l),c<o&&(o=c),n>o)return null}return n}function Vp(t,e,r,i,n,o,a,s,l,c,u){const h=i-t,A=n-e,p=o-r,d=a-t,f=s-e,m=l-r,g=u[1]*m-u[2]*f,_=u[2]*d-u[0]*m,y=u[0]*f-u[1]*d,v=h*g+A*_+p*y;if(Math.abs(v)<1e-15)return null;const x=1/v,w=c[0]-t,b=c[1]-e,B=c[2]-r,C=(w*g+b*_+B*y)*x;if(C<0||C>1)return null;const E=b*p-B*A,T=B*h-w*p,I=w*A-b*h,S=(u[0]*E+u[1]*T+u[2]*I)*x;return S<0||C+S>1?null:(d*E+f*T+m*I)*x}function Hp(t,e,r){return(t-e)/(r-e)}function jp(t,e,r,i,n,o,a,s,l){const c=1<<r,u=o-i,h=a-n,A=(t+1)/c*u+i,p=(e+0)/c*h+n,d=(e+1)/c*h+n;s[0]=(t+0)/c*u+i,s[1]=p,l[0]=A,l[1]=d}class Gp{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const e=function(t){const e=Math.ceil(Math.log2(t.dim/8)),r=[];let i=Math.ceil(Math.pow(2,e));const n=1/i,o=(t,e,r,i,n)=>{const o=i?1:0,a=(t+1)*r-o,s=e*r,l=(e+1)*r-o;n[0]=t*r,n[1]=s,n[2]=a,n[3]=l};let a=new Qp(i);const s=[];for(let e=0;e<i*i;e++){o(e%i,Math.floor(e/i),n,!1,s);const r=qp(s[0],s[1],t),l=qp(s[2],s[1],t),c=qp(s[2],s[3],t),u=qp(s[0],s[3],t);a.minimums.push(Math.min(r,l,c,u)),a.maximums.push(Math.max(r,l,c,u)),a.leaves.push(1)}for(r.push(a),i/=2;i>=1;i/=2){const t=r[r.length-1];a=new Qp(i);for(let e=0;e<i*i;e++){o(e%i,Math.floor(e/i),2,!0,s);const r=t.getElevation(s[0],s[1]),n=t.getElevation(s[2],s[1]),l=t.getElevation(s[2],s[3]),c=t.getElevation(s[0],s[3]),u=t.isLeaf(s[0],s[1]),h=t.isLeaf(s[2],s[1]),A=t.isLeaf(s[2],s[3]),p=t.isLeaf(s[0],s[3]),d=Math.min(r.min,n.min,l.min,c.min),f=Math.max(r.max,n.max,l.max,c.max),m=u&&h&&A&&p;a.maximums.push(f),a.minimums.push(d),a.leaves.push(f-d<=5&&m?1:0)}r.push(a)}return r}(this.dem),r=e.length-1,i=e[r];this._addNode(i.minimums[0],i.maximums[0],i.leaves[0]),this._construct(e,0,0,r,0)}raycastRoot(t,e,r,i,n,o,a=1){return Np([t,e,-100],[r,i,this.maximums[0]*a],n,o)}raycast(e,r,i,n,o,a,s=1){if(!this.nodeCount)return null;const l=this.raycastRoot(e,r,i,n,o,a,s);if(null==l)return null;const c=[],u=[],h=[],A=[],p=[{idx:0,t:l,nodex:0,nodey:0,depth:0}];for(;p.length>0;){const{idx:l,t:d,nodex:f,nodey:m,depth:g}=p.pop();if(this.leaves[l]){jp(f,m,g,e,r,i,n,h,A);const l=1<<g,c=(f+0)/l,u=(f+1)/l,p=(m+0)/l,_=(m+1)/l,y=qp(c,p,this.dem)*s,v=qp(u,p,this.dem)*s,x=qp(u,_,this.dem)*s,w=qp(c,_,this.dem)*s,b=Vp(h[0],h[1],y,A[0],h[1],v,A[0],A[1],x,o,a),B=Vp(A[0],A[1],x,h[0],A[1],w,h[0],h[1],y,o,a),C=Math.min(null!==b?b:Number.MAX_VALUE,null!==B?B:Number.MAX_VALUE);if(C!==Number.MAX_VALUE)return C;{const e=t._.scaleAndAdd([],o,a,d);if(Kp(y,v,w,x,Hp(e[0],h[0],A[0]),Hp(e[1],h[1],A[1]))>=e[2])return d}continue}let _=0;for(let t=0;t<this._siblingOffset.length;t++){jp((f<<1)+this._siblingOffset[t][0],(m<<1)+this._siblingOffset[t][1],g+1,e,r,i,n,h,A),h[2]=-100,A[2]=this.maximums[this.childOffsets[l]+t]*s;const p=Np(h,A,o,a);if(null!=p){const e=p;c[t]=e;let r=!1;for(let i=0;i<_&&!r;i++)e>=c[u[i]]&&(u.splice(i,0,t),r=!0);r||(u[_]=t),_++}}for(let t=0;t<_;t++){const e=u[t];p.push({idx:this.childOffsets[l]+e,t:c[e],nodex:(f<<1)+this._siblingOffset[e][0],nodey:(m<<1)+this._siblingOffset[e][1],depth:g+1})}}return null}_addNode(t,e,r){return this.minimums.push(t),this.maximums.push(e),this.leaves.push(r),this.childOffsets.push(0),this.nodeCount++}_construct(t,e,r,i,n){if(1===t[i].isLeaf(e,r))return;this.childOffsets[n]||(this.childOffsets[n]=this.nodeCount);const o=i-1,a=t[o];let s=0,l=0;for(let t=0;t<this._siblingOffset.length;t++){const i=2*e+this._siblingOffset[t][0],n=2*r+this._siblingOffset[t][1],o=a.getElevation(i,n),c=a.isLeaf(i,n),u=this._addNode(o.min,o.max,c);c&&(s|=1<<t),l||(l=u)}for(let i=0;i<this._siblingOffset.length;i++)s&1<<i||this._construct(t,2*e+this._siblingOffset[i][0],2*r+this._siblingOffset[i][1],o,l+i)}}function Kp(t,e,r,i,n,o){return ji(ji(t,r,o),ji(e,i,o),n)}function qp(t,e,r){const i=r.dim,n=Xe(t*i-.5,0,i-1),o=Xe(e*i-.5,0,i-1),a=Math.floor(n),s=Math.floor(o),l=Math.min(a+1,i-1),c=Math.min(s+1,i-1);return Kp(r.get(a,s),r.get(l,s),r.get(a,c),r.get(l,c),n-a,o-s)}const Zp={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Wp(t,e,r){return(256*t*256+256*e+r)/10-1e4}function Xp(t,e,r){return 256*t+e+r/256-32768}class $p{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,e,r,i=!1){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(r&&"mapbox"!==r&&"terrarium"!==r)return pr(`"${r}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=e.height;const n=this.dim=e.height-2,o=new Uint32Array(e.data.buffer);if(this.pixels=new Uint8Array(e.data.buffer),this.floatView=new Float32Array(e.data.buffer),this.borderReady=i,this._modifiedForSources={},!i){for(let t=0;t<n;t++)o[this._idx(-1,t)]=o[this._idx(0,t)],o[this._idx(n,t)]=o[this._idx(n-1,t)],o[this._idx(t,-1)]=o[this._idx(t,0)],o[this._idx(t,n)]=o[this._idx(t,n-1)];o[this._idx(-1,-1)]=o[this._idx(0,0)],o[this._idx(n,-1)]=o[this._idx(n-1,0)],o[this._idx(-1,n)]=o[this._idx(0,n-1)],o[this._idx(n,n)]=o[this._idx(n-1,n-1)]}const a="terrarium"===r?Xp:Wp;for(let t=0;t<o.length;++t){const e=4*t;this.floatView[t]=a(this.pixels[e],this.pixels[e+1],this.pixels[e+2])}this._timestamp=Lr.now()}_buildQuadTree(){this._tree=new Gp(this)}get(t,e,r=!1){r&&(t=Xe(t,-1,this.dim),e=Xe(e,-1,this.dim));const i=this._idx(t,e);return this.floatView[i]}set(t,e,r){const i=this._idx(t,e),n=this.floatView[i];return this.floatView[i]=r,r-n}static getUnpackVector(t){return Zp[t]}_idx(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)}static pack(t,e){const r=[0,0,0,0],i=$p.getUnpackVector(e);let n=Math.floor((t+i[3])/i[2]);return r[2]=n%256,n=Math.floor(n/256),r[1]=n%256,n=Math.floor(n/256),r[0]=n,r}getPixels(){return new dA({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,e,r){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let i=e*this.dim,n=e*this.dim+this.dim,o=r*this.dim,a=r*this.dim+this.dim;switch(e){case-1:i=n-1;break;case 1:n=i+1}switch(r){case-1:o=a-1;break;case 1:a=o+1}const s=-e*this.dim,l=-r*this.dim;for(let e=o;e<a;e++)for(let r=i;r<n;r++){const i=4*this._idx(r,e),n=4*this._idx(r+s,e+l);this.pixels[i+0]=t.pixels[n+0],this.pixels[i+1]=t.pixels[n+1],this.pixels[i+2]=t.pixels[n+2],this.pixels[i+3]=t.pixels[n+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}bs($p,"DEMData"),bs(Gp,"DemMinMaxQuadTree",{omit:["dem"]});class Yp{constructor(t,e,r){this._demTile=t,this._dem=this._demTile.dem,this._scale=e,this._offset=r}static create(t,e,r){const i=r||t.findDEMTileFor(e);if(!i||!i.dem)return;const n=i.dem,o=i.tileID,a=1<<e.canonical.z-o.canonical.z;return new Yp(i,n.dim/Ao/a,[(e.canonical.x/a-o.canonical.x)*n.dim,(e.canonical.y/a-o.canonical.y)*n.dim])}tileCoordToPixel(t,e){const r=e*this._scale+this._offset[1],i=Math.floor(t*this._scale+this._offset[0]),n=Math.floor(r);return new Ne(i,n)}getElevationAt(t,e,r,i){const n=t*this._scale+this._offset[0],o=e*this._scale+this._offset[1],a=Math.floor(n),s=Math.floor(o),l=this._dem;return i=!!i,r?ji(ji(l.get(a,s,i),l.get(a,s+1,i),o-s),ji(l.get(a+1,s,i),l.get(a+1,s+1,i),o-s),n-a):l.get(a,s,i)}getElevationAtPixel(t,e,r){return this._dem.get(t,e,!!r)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*Su(1,t)*this._dem.stride}}const Jp={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7},td=Bp.types,ed=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],rd=["fill-extrusion-flood-light-ground-radius"],id=Math.pow(2,13),nd=Math.pow(2,15)-1,od=new Ne(0,1),ad=2147483648;function sd(t,e,r,i,n,o,a,s){t.emplaceBack((e<<1)+a,(r<<1)+o,(Math.floor(i*id)<<1)+n,Math.round(s))}function ld(t,e,r,i,n,o){t.emplaceBack(e.x,e.y,(r.x<<1)+i,(r.y<<1)+n,o)}function cd(t,e,r){const i=16384;t.emplaceBack(e.x,e.y,e.z,r[0]*i,r[1]*i,r[2]*i)}class ud{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class hd{constructor(){this.centroidXY=new Ne(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ne(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ne(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Ne(this.max.x-this.min.x,this.max.y-this.min.y)}}class Ad{constructor(){this.acc=new Ne(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(t,e){t.min.x===Number.MAX_VALUE&&(t.min.x=t.max.x=e.x,t.min.y=t.max.y=e.y)}appendEdge(t,e,r){this.accCount++,this.acc._add(e);let i=!!this.borders;e.x<t.min.x?(t.min.x=e.x,i=!0):e.x>t.max.x&&(t.max.x=e.x,i=!0),e.y<t.min.y?(t.min.y=e.y,i=!0):e.y>t.max.y&&(t.max.y=e.y,i=!0),((0===e.x||e.x===Ao)&&e.x===r.x)!=((0===e.y||e.y===Ao)&&e.y===r.y)&&this.processBorderOverlap(e,r),i&&this.checkBorderIntersection(e,r)}checkBorderIntersection(t,e){e.x<0!=t.x<0&&this.addBorderIntersection(0,ji(e.y,t.y,(0-e.x)/(t.x-e.x))),e.x>Ao!=t.x>Ao&&this.addBorderIntersection(1,ji(e.y,t.y,(Ao-e.x)/(t.x-e.x))),e.y<0!=t.y<0&&this.addBorderIntersection(2,ji(e.x,t.x,(0-e.y)/(t.y-e.y))),e.y>Ao!=t.y>Ao&&this.addBorderIntersection(3,ji(e.x,t.x,(Ao-e.y)/(t.y-e.y)))}addBorderIntersection(t,e){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const r=this.borders[t];e<r[0]&&(r[0]=e),e>r[1]&&(r[1]=e)}processBorderOverlap(t,e){if(t.x===e.x){if(t.y===e.y)return;const r=0===t.x?0:1;this.addBorderIntersection(r,e.y),this.addBorderIntersection(r,t.y)}else{const r=0===t.y?2:3;this.addBorderIntersection(r,e.x),this.addBorderIntersection(r,t.x)}}centroid(){return 0===this.accCount?new Ne(0,0):new Ne(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((t,e)=>t+ +(e[0]!==Number.MAX_VALUE)),0):0}}function pd(t,e){const r=t.add(e)._unit(),i=Xe(t.x*r.x+t.y*r.y,-1,1);var n,o,a;return n=Math.acos(i),Math.min(4,Math.max(-4,Math.tan(n)))/4*nd*((o=t).x*(a=e).y-o.y*a.x<0?-1:1)}const dd=[t=>t.x<0,t=>t.x>Ao,t=>t.y<0,t=>t.y>Ao];function fd(t,e,r,i){const n=[4];if(0===i)return n;r._mult(i);const o=t.sub(r),a=e.sub(r),s=[t,e,o,a];for(let t=0;t<4;t++)for(const e of s)if(dd[t](e)){n.push(t);break}return n}class md{constructor(t){this.vertexArray=new zl,this.indexArray=new Jl,this.programConfigurations=new $c(t.layers,{zoom:t.zoom,lut:t.lut},(t=>rd.includes(t))),this._segments=new Bc,this.hiddenByLandmarkVertexArray=new uc,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Bc}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(t,e,r,i=!1){const n=t.length;if(n>2){let o=Math.max(0,this._segments.get().length-1);const a=this._segments._prepareSegment(4*n,this.vertexArray.length,2*this._segmentToGroundQuads[o].length);let s;o!==this._segments.get().length-1&&(o++,this._segmentToGroundQuads[o]=[],this._segmentToRegionTriCounts[o]=[0,0,0,0,0]);{const e=t[0],r=t[1];s=pd(e.sub(t[n-1])._perp()._unit(),r.sub(e)._perp()._unit())}for(let l=0;l<n;l++){const c=l===n-1?0:l+1,u=t[l],h=t[c],A=t[c===n-1?0:c+1],p=h.sub(u)._perp()._unit(),d=pd(p,A.sub(h)._perp()._unit()),f=s,m=d;if(xd(u,h,e)||i&&wd(u,e)&&wd(h,e)){s=d;continue}const g=a.vertexLength;ld(this.vertexArray,u,h,1,1,f),ld(this.vertexArray,u,h,1,0,f),ld(this.vertexArray,u,h,0,1,m),ld(this.vertexArray,u,h,0,0,m),a.vertexLength+=4;const _=fd(u,h,p,r);for(const t of _)this._segmentToGroundQuads[o].push({id:g,region:t}),this._segmentToRegionTriCounts[o][t]+=2,a.primitiveLength+=2;s=d}}}prepareBorderSegments(){if(!this.hasData())return;const t=this._segments.get(),e=t.length;for(let t=0;t<e;t++)this._segmentToGroundQuads[t].sort(((t,e)=>t.region-e.region));for(let r=0;r<e;r++){const e=this._segmentToGroundQuads[r],i=t[r],n=this._segmentToRegionTriCounts[r];n.reduce(((t,e)=>t+e),0);let o=0;for(let t=0;t<=4;t++){const e=n[t];if(0!==e){let r=this.regionSegments[t];r||(r=this.regionSegments[t]=new Bc);const n={vertexOffset:i.vertexOffset,primitiveOffset:i.primitiveOffset+o,vertexLength:i.vertexLength,primitiveLength:e};r.get().push(n)}o+=e}for(let t=0;t<e.length;t++){const r=e[t].id;this.indexArray.emplaceBack(r,r+1,r+3),this.indexArray.emplaceBack(r,r+3,r+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(t,e,r,i,n,o){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,t,e,r,i,n,o)}upload(t){this.hasData()&&(this.vertexBuffer=t.createVertexBuffer(this.vertexArray,ap.members),this.indexBuffer=t.createIndexBuffer(this.indexArray))}uploadPaintProperties(t){this.hasData()&&this.programConfigurations.upload(t)}update(t,e,r,i,n,o){this.hasData()&&this.programConfigurations.updatePaintArrays(t,e,r,i,n,o)}updateHiddenByLandmark(t){if(!this.hasData())return;const e=t.groundVertexCount+t.groundVertexArrayOffset;if(0===t.groundVertexCount)return;const r=t.flags&ad?1:0;for(let i=t.groundVertexArrayOffset;i<e;++i)this.hiddenByLandmarkVertexArray.emplace(i,r);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(t){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=t.createVertexBuffer(this.hiddenByLandmarkVertexArray,lp.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let t=0;t<=4;t++){const e=this.regionSegments[t];e&&e.destroy()}}}}class gd{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Jl,this.footprintVertices=new Dl,this.footprintSegments=[],this.layoutVertexArray=new kl,this.centroidVertexArray=new xc,this.indexArray=new Jl,this.programConfigurations=new $c(t.layers,{zoom:t.zoom,lut:t.lut},(t=>ed.includes(t))),this.segments=new Bc,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.groundEffect=new md(t),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(t,e){}populate(t,e,r,i){this.features=[],this.hasPattern=WA("fill-extrusion",this.layers,e),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=zu(r),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:n,id:o,index:a,sourceLayerIndex:s}of t){const t=this.layers[0]._featureFilter.needGeometry,l=qu(n,t);if(!this.layers[0]._featureFilter.filter(new Ws(this.zoom),l,r))continue;const c={id:o,sourceLayerIndex:s,index:a,geometry:t?l.geometry:Ku(n,r,i),properties:n.properties,type:n.type,patterns:{}},u=this.layoutVertexArray.length;this.hasPattern?this.features.push(XA("fill-extrusion",this.layers,c,this.zoom,e)):this.addFeature(c,c.geometry,a,r,{},e.availableImages,i,e.brightness),e.featureIndex.insert(n,c.geometry,a,s,this.index,u)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(t,e,r,i,n,o){for(const t of this.features){const{geometry:a}=t;this.addFeature(t,a,t.index,e,r,i,n,o)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles()}update(t,e,r,i,n){const o=0!==Object.keys(t).length;if(o&&!this.stateDependentLayers.length)return;const a=o?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(t,e,a,r,i,n),this.groundEffect.update(t,e,a,r,i,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,up),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,cp.members,!0)),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.groundEffect.uploadHiddenByLandmark(t),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,sp.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,e,r,i,n,o,a,s){const l=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(t,{})/this.tileToMeter,c=[new Ne(0,0),new Ne(Ao,Ao)],u=a.projection,h="globe"===u.name,A="Polygon"===td[t.type],p=new Ad;p.centroidDataIndex=this.centroidData.length;const d=new hd,f=this.layers[0].paint.get("fill-extrusion-base").evaluate(t,{},i)<=0,m=this.layers[0].paint.get("fill-extrusion-height").evaluate(t,{},i);d.height=m,d.vertexArrayOffset=this.layoutVertexArray.length,d.groundVertexArrayOffset=this.groundEffect.vertexArray.length,h&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Hl);const g=qA(e,500);for(let t=g.length-1;t>=0;t--){const e=g[t];(0===e.length||(_=e[0]).every((t=>t.x<=0))||_.every((t=>t.x>=Ao))||_.every((t=>t.y<=0))||_.every((t=>t.y>=Ao)))&&g.splice(t,1)}var _;let y;if(h)y=Ed(g,c,i);else{y=[];for(const t of g)y.push({polygon:t,bounds:c})}const v=A?this.edgeRadius:0,x=v>0&&this.zoom<17,w=(t,e)=>{if(0===t.length)return!1;const r=t[t.length-1];return e.x===r.x&&e.y===r.y};for(const{polygon:t,bounds:e}of y){let r=0,n=0;for(const e of t)A&&!e[0].equals(e[e.length-1])&&e.push(e[0]),n+=A?e.length-1:e.length;const o=this.segments.prepareSegment((A?5:4)*n,this.layoutVertexArray,this.indexArray);d.footprintSegIdx<0&&(d.footprintSegIdx=this.footprintSegments.length),d.polygonSegIdx<0&&(d.polygonSegIdx=this.polygonSegments.length);const a={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},s=new ud;if(s.vertexOffset=this.footprintVertices.length,s.indexOffset=3*this.footprintIndices.length,s.ringIndices=[],A){const n=[],a=[];r=o.vertexLength;for(let r=0;r<t.length;r++){const c=t[r];c.length&&0!==r&&a.push(n.length/2);const A=[];let p,d;p=c[1].sub(c[0])._perp()._unit(),s.ringIndices.push(c.length-1);for(let t=1;t<c.length;t++){const e=c[t],r=c[t===c.length-1?1:t+1],a=e.clone();if(v){d=r.sub(e)._perp()._unit();const t=p.add(d)._unit(),i=v*Math.min(4,1/(p.x*t.x+p.y*t.y));a.x+=i*t.x,a.y+=i*t.y,a.x=Math.round(a.x),a.y=Math.round(a.y),p=d}!f||0!==v&&!x||w(A,a)||A.push(a),sd(this.layoutVertexArray,a.x,a.y,0,0,1,1,0),o.vertexLength++,this.footprintVertices.emplaceBack(e.x,e.y),n.push(e.x,e.y),h&&cd(this.layoutVertexExtArray,u.projectTilePoint(a.x,a.y,i),u.upVector(i,a.x,a.y))}f&&(0===v||x)&&(0!==A.length&&w(A,A[0])&&A.pop(),this.groundEffect.addData(A,e,l))}const c=wA(n,a);for(let t=0;t<c.length;t+=3)this.footprintIndices.emplaceBack(s.vertexOffset+c[t+0],s.vertexOffset+c[t+1],s.vertexOffset+c[t+2]),this.indexArray.emplaceBack(r+c[t],r+c[t+2],r+c[t+1]),o.primitiveLength++;s.indexCount+=c.length,s.vertexCount+=this.footprintVertices.length-s.vertexOffset}for(let n=0;n<t.length;n++){const a=t[n];p.startRing(d,a[0]);let s=a.length>4&&bd(a[a.length-2],a[0],a[1]),c=v?yd(a[a.length-2],a[0],a[1],v):0;const m=[];let g,_,y;_=a[1].sub(a[0])._perp()._unit();let x=!0;for(let t=1,n=0;t<a.length;t++){let l=a[t-1],A=a[t];const b=a[t===a.length-1?1:t+1];if(p.appendEdge(d,A,l),xd(A,l,e)){v&&(_=b.sub(A)._perp()._unit(),x=!x);continue}const B=A.sub(l)._perp(),C=B.x/(Math.abs(B.x)+Math.abs(B.y)),E=B.y>0?1:0,T=l.dist(A);if(n+T>32768&&(n=0),v){y=b.sub(A)._perp()._unit();let t=vd(l,A,b,_d(_,y),v);isNaN(t)&&(t=0);const e=A.sub(l)._unit();l=l.add(e.mult(c))._round(),A=A.add(e.mult(-t))._round(),c=t,_=y,f&&this.zoom>=17&&(w(m,l)||m.push(l),w(m,A)||m.push(A))}const I=o.vertexLength,S=a.length>4&&bd(l,A,b);let M=Bd(n,s,x);if(sd(this.layoutVertexArray,l.x,l.y,C,E,0,0,M),sd(this.layoutVertexArray,l.x,l.y,C,E,0,1,M),n+=T,M=Bd(n,S,!x),s=S,sd(this.layoutVertexArray,A.x,A.y,C,E,0,0,M),sd(this.layoutVertexArray,A.x,A.y,C,E,0,1,M),o.vertexLength+=4,this.indexArray.emplaceBack(I+0,I+1,I+2),this.indexArray.emplaceBack(I+1,I+3,I+2),o.primitiveLength+=2,v){const i=r+(1===t?a.length-2:t-2),n=1===t?r:i+1;if(this.indexArray.emplaceBack(I+1,i,I+3),this.indexArray.emplaceBack(i,n,I+3),o.primitiveLength+=2,void 0===g&&(g=I),!xd(b,a[t],e)){const e=t===a.length-1?g:o.vertexLength;this.indexArray.emplaceBack(I+2,I+3,e),this.indexArray.emplaceBack(I+3,e+1,e),this.indexArray.emplaceBack(I+3,n,e+1),o.primitiveLength+=3}x=!x}if(h){const t=this.layoutVertexExtArray,e=u.projectTilePoint(l.x,l.y,i),r=u.projectTilePoint(A.x,A.y,i),n=u.upVector(i,l.x,l.y),o=u.upVector(i,A.x,A.y);cd(t,e,n),cd(t,e,n),cd(t,r,o),cd(t,r,o)}}A&&(r+=a.length-1),f&&v&&this.zoom>=17&&(0!==m.length&&w(m,m[0])&&m.pop(),this.groundEffect.addData(m,e,l,v>0))}this.footprintSegments.push(s),a.triangleCount=this.indexArray.length-a.triangleArrayOffset,this.polygonSegments.push(a),++d.footprintSegLen,++d.polygonSegLen}if(d.vertexCount=this.layoutVertexArray.length-d.vertexArrayOffset,d.groundVertexCount=this.groundEffect.vertexArray.length-d.groundVertexArrayOffset,0!==d.vertexCount){if(d.centroidXY=p.borders?od:this.encodeCentroid(p,d),this.centroidData.push(d),p.borders){this.featuresOnBorder.push(p);const t=this.featuresOnBorder.length-1;for(let e=0;e<p.borders.length;e++)p.borders[e][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[e].push(t)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,n,o,i,s),this.groundEffect.addPaintPropertiesData(t,r,n,o,i,s),this.maxHeight=Math.max(this.maxHeight,m)}}sortBorders(){for(let t=0;t<this.borderFeatureIndices.length;t++)this.borderFeatureIndices[t].sort(((e,r)=>this.featuresOnBorder[e].borders[t][0]-this.featuresOnBorder[r].borders[t][0]))}splitToSubtiles(){const t=[];for(let e=0;e<this.centroidData.length;e++){const r=this.centroidData[e],i=+(r.min.y+r.max.y>Ao),n=2*i+(+(r.min.x+r.max.x>Ao)^i);for(let i=0;i<r.polygonSegLen;i++){const o=r.polygonSegIdx+i;t.push({centroidIdx:e,subtile:n,polygonSegmentIdx:o,triangleSegmentIdx:this.polygonSegments[o].triangleSegIdx})}}const e=new Jl;t.sort(((t,e)=>t.triangleSegmentIdx===e.triangleSegmentIdx?t.subtile-e.subtile:t.triangleSegmentIdx-e.triangleSegmentIdx));let r=0,i=0,n=0;for(const e of t){if(e.triangleSegmentIdx!==r)break;n++}const o=t.length;for(;i!==t.length;){r=t[i].triangleSegmentIdx;let a=0,s=i,l=i;for(let e=s;e<n&&t[e].subtile===a;e++)l++;for(;s!==n;){const i=t[s];a=i.subtile;const o=this.centroidData[i.centroidIdx].min.clone(),c=this.centroidData[i.centroidIdx].max.clone(),u={vertexOffset:this.segments.segments[r].vertexOffset,primitiveOffset:e.length,vertexLength:this.segments.segments[r].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let r=s;r<l;r++){const i=t[r],n=this.polygonSegments[i.polygonSegmentIdx],a=this.centroidData[i.centroidIdx].min,s=this.centroidData[i.centroidIdx].max,l=this.indexArray.uint16;for(let t=n.triangleArrayOffset;t<n.triangleArrayOffset+n.triangleCount;t++)e.emplaceBack(l[3*t],l[3*t+1],l[3*t+2]);u.primitiveLength+=n.triangleCount,o.x=Math.min(o.x,a.x),o.y=Math.min(o.y,a.y),c.x=Math.max(c.x,s.x),c.y=Math.max(c.y,s.y)}u.primitiveLength>0&&this.triangleSubSegments.push({segment:u,min:o,max:c}),s=l;for(let e=s;e<n&&t[e].subtile===t[s].subtile;e++)l++}i=n;for(let e=i;e<o&&t[e].triangleSegmentIdx===t[i].triangleSegmentIdx;e++)n++}e._trim(),this.indexArray=e}getVisibleSegments(t,e,r){let i=0,n=0;const o=1<<t.canonical.z;if(e){const r=e.getMinMaxForTile(t);r&&(i=r.min,n=r.max)}n+=this.maxHeight;const a=t.toUnwrapped();let s;const l=[a.canonical.x/o+a.wrap,a.canonical.y/o],c=[(a.canonical.x+1)/o+a.wrap,(a.canonical.y+1)/o],u=new Bc,h=(t,e,r)=>[t[0]*(1-r[0])+e[0]*r[0],t[1]*(1-r[1])+e[1]*r[1]],A=[],p=[];for(const t of this.triangleSubSegments){A[0]=t.min.x/Ao,A[1]=t.min.y/Ao,p[0]=t.max.x/Ao,p[1]=t.max.y/Ao;const e=h(l,c,A),o=h(l,c,p);if(0===new Bh([e[0],e[1],i],[o[0],o[1],n]).intersectsPrecise(r)){s&&(u.segments.push(s),s=void 0);continue}const a=t.segment;s&&s.vertexOffset!==a.vertexOffset&&(u.segments.push(s),s=void 0),s?(s.vertexLength+=a.vertexLength,s.primitiveLength+=a.primitiveLength):s={vertexOffset:a.vertexOffset,primitiveLength:a.primitiveLength,vertexLength:a.vertexLength,primitiveOffset:a.primitiveOffset,sortKey:void 0,vaos:{}}}return s&&u.segments.push(s),u}encodeCentroid(t,e){const r=t.centroid(),i=e.span(),n=Math.min(7,Math.round(i.x*this.tileToMeter/10)),o=Math.min(7,Math.round(i.y*this.tileToMeter/10));return new Ne(Xe(r.x,1,Ao-1)<<3|n,Xe(r.y,1,Ao-1)<<3|o)}encodeBorderCentroid(t){if(!t.borders)return new Ne(0,0);const e=t.borders,r=Number.MAX_VALUE;if(e[0][0]!==r||e[1][0]!==r){const t=e[0][0]!==r?0:1;return new Ne(6|(e[0][0]!==r?0:65528),(e[t][0]+e[t][1])/2<<3|6)}{const t=e[2][0]!==r?2:3;return new Ne((e[t][0]+e[t][1])/2<<3|6,6|(e[2][0]!==r?0:65528))}}showCentroid(t){const e=this.centroidData[t.centroidDataIndex];e.flags&=ad,e.centroidXY.x=0,e.centroidXY.y=0,this.writeCentroidToBuffer(e)}writeCentroidToBuffer(t){this.groundEffect.updateHiddenByLandmark(t);const e=t.vertexArrayOffset,r=t.vertexCount+t.vertexArrayOffset,i=t.flags&ad?od:t.centroidXY,n=this.centroidVertexArray.geta_centroid_pos0(e);if(this.centroidVertexArray.geta_centroid_pos1(e)!==i.y||n!==i.x){for(let t=e;t<r;++t)this.centroidVertexArray.emplace(t,i.x,i.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const t of this.centroidData)this.writeCentroidToBuffer(t)}updateReplacement(t,e,r){if(e.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=e.updateTime;const i=e.getReplacementRegionsForTile(t.toUnwrapped());if(Lp(this.activeReplacements,i))return;if(this.activeReplacements=i,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const t of this.centroidData)t.flags&=2147483647;const n=[];for(const e of this.activeReplacements){if(e.order<r)continue;const i=Math.pow(2,e.footprintTileId.canonical.z-t.canonical.z);for(const r of this.centroidData)if(!(r.flags&ad||e.min.x>r.max.x||r.min.x>e.max.x||e.min.y>r.max.y||r.min.y>e.max.y))for(let o=0;o<r.footprintSegLen;o++){const a=this.footprintSegments[r.footprintSegIdx+o];if(n.length=0,Td(this.footprintVertices,a.vertexOffset,a.vertexCount,e.footprintTileId.canonical,t.canonical,n),kp(e.footprint,n,this.footprintIndices.uint16,a.indexOffset,a.indexCount,-a.vertexOffset,-i)){r.flags|=ad;break}}}for(const t of this.centroidData)this.writeCentroidToBuffer(t);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(t,e,r){let i=!1;for(let n=0;n<r.footprintSegLen;n++){const o=this.footprintSegments[r.footprintSegIdx+n];let a=0;for(const r of o.ringIndices){for(let n=a,s=r+a-1;n<r+a;s=n++){const r=this.footprintVertices.int16[2*(n+o.vertexOffset)+0],a=this.footprintVertices.int16[2*(n+o.vertexOffset)+1],l=this.footprintVertices.int16[2*(s+o.vertexOffset)+1];a>e!=l>e&&t<(this.footprintVertices.int16[2*(s+o.vertexOffset)+0]-r)*(e-a)/(l-a)+r&&(i=!i)}a=r}}return i}getHeightAtTileCoord(t,e){let r=Number.NEGATIVE_INFINITY,i=!0;const n=4*(t+Ao)*Ao+(e+Ao);if(this.partLookup.hasOwnProperty(n)){const t=this.partLookup[n];return t?{height:t.height,hidden:!!(t.flags&ad)}:void 0}for(const o of this.centroidData)t>o.max.x||o.min.x>t||e>o.max.y||o.min.y>e||this.footprintContainsPoint(t,e,o)&&o&&o.height>r&&(r=o.height,this.partLookup[n]=o,i=!!(o.flags&ad));if(r!==Number.NEGATIVE_INFINITY)return{height:r,hidden:i};this.partLookup[n]=void 0}}function _d(t,e){const r=t.add(e)._unit();return t.x*r.x+t.y*r.y}function yd(t,e,r,i){const n=e.sub(t)._perp()._unit(),o=r.sub(e)._perp()._unit();return vd(t,e,r,_d(n,o),i)}function vd(t,e,r,i,n){const o=Math.sqrt(1-i*i);return Math.min(t.dist(e)/3,e.dist(r)/3,n*o/i)}function xd(t,e,r){return t.x<r[0].x&&e.x<r[0].x||t.x>r[1].x&&e.x>r[1].x||t.y<r[0].y&&e.y<r[0].y||t.y>r[1].y&&e.y>r[1].y}function wd(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function bd(t,e,r){if(t.x<0||t.x>=Ao||e.x<0||e.x>=Ao||r.x<0||r.x>=Ao)return!1;const i=r.sub(e),n=i.perp(),o=t.sub(e);return(i.x*o.x+i.y*o.y)/Math.sqrt((i.x*i.x+i.y*i.y)*(o.x*o.x+o.y*o.y))>-.866&&n.x*o.x+n.y*o.y<0}function Bd(t,e,r){const i=e?2|t:-3&t;return r?1|i:-2&i}function Cd(){const t=Math.PI/32,e=Math.tan(t),r=pu;return r*Math.sqrt(1+2*e*e)-r}function Ed(t,e,r){const i=1<<r.z,n=Mu(r.x/i),o=Mu((r.x+1)/i),a=Fu(r.y/i),s=Fu((r.y+1)/i);return function(t,e,r,i,n=0,o){const a=[];if(!t.length||!r||!i)return a;const s=(t,e)=>{for(const r of t)a.push({polygon:r,bounds:e})},l=Math.ceil(Math.log2(r)),c=Math.ceil(Math.log2(i)),u=l-c,h=[];for(let t=0;t<Math.abs(u);t++)h.push(u>0?0:1);for(let t=0;t<Math.min(l,c);t++)h.push(0),h.push(1);let A=t;if(A=Tp(A,e[0].y-n,e[1].y+n,1),A=Tp(A,e[0].x-n,e[1].x+n,0),!A.length)return a;const p=[];for(h.length?p.push({polygons:A,bounds:e,depth:0}):s(A,e);p.length;){const t=p.pop(),e=t.depth,r=h[e],i=t.bounds[0],a=t.bounds[1],l=0===r?i.x:i.y,c=0===r?a.x:a.y,u=o?o(r,l,c):.5*(l+c),A=Tp(t.polygons,l-n,u+n,r),d=Tp(t.polygons,u-n,c+n,r);if(A.length){const t=[i,new Ne(0===r?u:a.x,1===r?u:a.y)];h.length>e+1?p.push({polygons:A,bounds:t,depth:e+1}):s(A,t)}if(d.length){const t=[new Ne(0===r?u:i.x,1===r?u:i.y),a];h.length>e+1?p.push({polygons:d,bounds:t,depth:e+1}):s(d,t)}}return a}(t,e,Math.ceil((o-n)/11.25),Math.ceil((a-s)/11.25),1,((t,e,n)=>{if(0===t)return.5*(e+n);{const t=Fu((r.y+e/Ao)/i);return(Iu(.5*(Fu((r.y+n/Ao)/i)+t))*i-r.y)*Ao}}))}function Td(t,e,r,i,n,o){const a=Math.pow(2,i.z-n.z);for(let s=0;s<r;s++){let r=t.int16[2*(s+e)+0],l=t.int16[2*(s+e)+1];r=(r+n.x*Ao)*a-i.x*Ao,l=(l+n.y*Ao)*a-i.y*Ao,o.push(new Ne(r,l))}}bs(gd,"FillExtrusionBucket",{omit:["layers","features"]}),bs(hd,"PartData"),bs(ud,"FootprintSegment"),bs(Ad,"BorderCentroidData"),bs(md,"GroundEffect");const Id=new sl({visibility:new nl(ll["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new nl(ll["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Sd={paint:new sl({"fill-extrusion-opacity":new nl(ll["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ol(ll["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new nl(ll["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new nl(ll["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ol(ll["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ol(ll["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ol(ll["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new nl(ll["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new nl(ll["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new nl(ll["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new nl(ll["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new nl(ll["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new nl(ll["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new nl(ll["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new nl(ll["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new ol(ll["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new ol(ll["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new nl(ll["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new nl(ll["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new nl(ll["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new nl(ll["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new nl(ll["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:Id};function Md(t,e){return t.x*e.x+t.y*e.y}function Fd(t,e){if(1===t.length){let r=0;const i=e[r++];let n;for(;!n||i.equals(n);)if(n=e[r++],!n)return 1/0;for(;r<e.length;r++){const o=e[r],a=t[0],s=n.sub(i),l=o.sub(i),c=a.sub(i),u=Md(s,s),h=Md(s,l),A=Md(l,l),p=Md(c,s),d=Md(c,l),f=u*A-h*h,m=(A*p-h*d)/f,g=(u*d-h*p)/f,_=i.z*(1-m-g)+n.z*m+o.z*g;if(isFinite(_))return _}return 1/0}{let t=1/0;for(const r of e)t=Math.min(t,r.z);return t}}function Pd(t,e,r,i,n,o,a,s){const l=a*n.getElevationAt(t,e,!0,!0),c=0!==o[0],u=c?0===o[1]?a*(o[0]/7-450):a*function(t,e,r){const i=Math.floor(e[0]/8),n=Math.floor(e[1]/8),o=10*(e[0]-8*i),a=10*(e[1]-8*n),s=t.getElevationAt(i,n,!0,!0),l=t.getMeterToDEM(r),c=Math.floor(.5*(o*l-1)),u=Math.floor(.5*(a*l-1)),h=t.tileCoordToPixel(i,n),A=2*c+1,p=2*u+1,d=function(t,e,r,i,n){return[t.getElevationAtPixel(e,r,!0),t.getElevationAtPixel(e+n,r,!0),t.getElevationAtPixel(e,r+n,!0),t.getElevationAtPixel(e+i,r+n,!0)]}(t,h.x-c,h.y-u,A,p),f=Math.abs(d[0]-d[1]),m=Math.abs(d[2]-d[3]),g=Math.abs(d[0]-d[2])+Math.abs(d[1]-d[3]),_=Math.min(.25,.5*l*(f+m)/A),y=Math.min(.25,.5*l*g/p);return s+Math.max(_*o,y*a)}(n,o,s):l;return{base:l+(0===r)?-1:r,top:c?Math.max(u+i,l+r+2):l+i}}const Ld=Pl([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Dd}=Ld,Ud=Pl([{name:"a_packed",components:4,type:"Float32"}]),{members:kd}=Ud,zd=Pl([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Rd}=zd,Od=Pl([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Qd=Pl([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Nd=Pl([{name:"a_projected_pos",components:4,type:"Float32"}],4);Pl([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Vd=Pl([{name:"a_occlusion_query_opacity",components:1,type:"Float32"}],4),Hd=Pl([{name:"a_z_offset",components:1,type:"Float32"}],4),jd=Pl([{name:"a_texb",components:2,type:"Uint16"}]),Gd=Pl([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Kd=Pl([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);Pl([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const qd=Pl([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Zd=Pl([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Pl([{name:"triangle",components:3,type:"Uint16"}]),Pl([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Pl([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Float32",name:"occlusionState"},{type:"Float32",name:"occlusionOpacity"},{type:"Uint8",name:"hasIconTextFit"}]),Pl([{type:"Float32",name:"offsetX"}]),Pl([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);class Wd{constructor(t,e){this.width=t,this.height=e,this.nextRow=0,this.image=new AA({width:t,height:e}),this.positions={},this.uploaded=!1}getDash(t,e){const r=this.getKey(t,e);return this.positions[r]}trim(){const t=this.width,e=this.height=or(this.nextRow);this.image.resize({width:t,height:e})}getKey(t,e){return t.join(",")+e}getDashRanges(t,e,r){const i=[];let n=t.length%2==1?-t[t.length-1]*r:0,o=t[0]*r,a=!0;i.push({left:n,right:o,isDash:a,zeroLength:0===t[0]});let s=t[0];for(let e=1;e<t.length;e++){a=!a;const l=t[e];n=s*r,s+=l,o=s*r,i.push({left:n,right:o,isDash:a,zeroLength:0===l})}return i}addRoundDash(t,e,r){const i=e/2;for(let e=-r;e<=r;e++){const n=this.width*(this.nextRow+r+e);let o=0,a=t[o];for(let s=0;s<this.width;s++){s/a.right>1&&(a=t[++o]);const l=Math.abs(s-a.left),c=Math.abs(s-a.right),u=Math.min(l,c);let h;const A=e/r*(i+1);if(a.isDash){const t=i-Math.abs(A);h=Math.sqrt(u*u+t*t)}else h=i-Math.sqrt(u*u+A*A);this.image.data[n+s]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(t,e){for(let e=t.length-1;e>=0;--e){const r=t[e],i=t[e+1];r.zeroLength?t.splice(e,1):i&&i.isDash===r.isDash&&(i.left=r.left,t.splice(e,1))}const r=t[0],i=t[t.length-1];r.isDash===i.isDash&&(r.left=i.left-this.width,i.right=r.right+this.width);const n=this.width*this.nextRow;let o=0,a=t[o];for(let r=0;r<this.width;r++){r/a.right>1&&(a=t[++o]);const i=Math.abs(r-a.left),s=Math.abs(r-a.right),l=Math.min(i,s);this.image.data[n+r]=Math.max(0,Math.min(255,(a.isDash?l:-l)+e+128))}}addDash(t,e){const r=this.getKey(t,e);if(this.positions[r])return this.positions[r];const i="round"===e,n=i?7:0,o=2*n+1;if(this.nextRow+o>this.height)return pr("LineAtlas out of space"),null;0===t.length&&t.push(1);let a=0;for(let e=0;e<t.length;e++)t[e]<0&&(pr("Negative value is found in line dasharray, replacing values with 0"),t[e]=0),a+=t[e];if(0!==a){const r=this.width/a,o=this.getDashRanges(t,this.width,r);i?this.addRoundDash(o,r,n):this.addRegularDash(o,"square"===e?.5*r:0)}const s=this.nextRow+n;this.nextRow+=o;const l={tl:[s,n],br:[a,0]};return this.positions[r]=l,l}}bs(Wd,"LineAtlas");const Xd=Bp.types,$d=Math.cos(Math.PI/180*37.5),Yd=Math.cos(Math.PI/180*5);class Jd{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((t=>{this.gradients[t.id]={}})),this.layoutVertexArray=new Rl,this.layoutVertexArray2=new Ol,this.patternVertexArray=new Ql,this.indexArray=new Jl,this.programConfigurations=new $c(t.layers,{zoom:t.zoom,lut:t.lut}),this.segments=new Bc,this.maxLineLength=0,this.zOffsetVertexArray=new ql,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.tessellationStep=t.tessellationStep?t.tessellationStep:Ao/64}updateFootprints(t,e){}populate(t,e,r,i){this.hasPattern=WA("line",this.layers,e);const n=this.layers[0].layout.get("line-sort-key"),o=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!o.isConstant()||!!o.constantOr(0);const a=[];for(const{feature:e,id:o,index:s,sourceLayerIndex:l}of t){const t=this.layers[0]._featureFilter.needGeometry,c=qu(e,t);if(!this.layers[0]._featureFilter.filter(new Ws(this.zoom),c,r))continue;const u=n?n.evaluate(c,{},r):void 0,h={id:o,properties:e.properties,type:e.type,sourceLayerIndex:l,index:s,geometry:t?c.geometry:Ku(e,r,i),patterns:{},sortKey:u};a.push(h)}n&&a.sort(((t,e)=>t.sortKey-e.sortKey));const{lineAtlas:s,featureIndex:l}=e,c=this.addConstantDashes(s);for(const i of a){const{geometry:n,index:o,sourceLayerIndex:a}=i;if(c&&this.addFeatureDashes(i,s),this.hasPattern){const t=XA("line",this.layers,i,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(i,n,o,r,s.positions,e.availableImages,e.brightness);l.insert(t[o].feature,n,o,a,this.index)}}addConstantDashes(t){let e=!1;for(const r of this.layers){const i=r.paint.get("line-dasharray").value,n=r.layout.get("line-cap").value;if("constant"!==i.kind||"constant"!==n.kind)e=!0;else{const e=n.value,r=i.value;if(!r)continue;t.addDash(r,e)}}return e}addFeatureDashes(t,e){const r=this.zoom;for(const i of this.layers){const n=i.paint.get("line-dasharray").value,o=i.layout.get("line-cap").value;if("constant"===n.kind&&"constant"===o.kind)continue;let a,s;if("constant"===n.kind){if(a=n.value,!a)continue}else a=n.evaluate({zoom:r},t);s="constant"===o.kind?o.value:o.evaluate({zoom:r},t),e.addDash(a,s),t.patterns[i.id]=e.getKey(a,s)}}update(t,e,r,i,n){const o=0!==Object.keys(t).length;o&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,e,o?this.stateDependentLayers:this.layers,r,i,n)}addFeatures(t,e,r,i,n,o){for(const t of this.patternFeatures)this.addFeature(t,t.geometry,t.index,e,r,i,o)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,kd)),0!==this.patternVertexArray.length&&(this.patternVertexBuffer=t.createVertexBuffer(this.patternVertexArray,Rd)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,Hd.members,!0)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Dd),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,e,r,i,n,o,a){const s=this.layers[0].layout,l=s.get("line-join").evaluate(t,{}),c=s.get("line-cap").evaluate(t,{}),u=s.get("line-miter-limit"),h=s.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const r of e)this.addLine(r,t,i,l,c,u,h);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,n,o,i,a)}addLine(t,e,r,i,n,o,a){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;const s={zoom:this.zoom,lineProgress:void 0},l=this.layers[0].layout,c="none"===i;if(this.patternJoinNone=this.hasPattern&&c,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let e=0;e<t.length-1;e++)this.totalDistance+=t[e].dist(t[e+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const u="Polygon"===Xd[e.type];let h=t.length;for(;h>=2&&t[h-1].equals(t[h-2]);)h--;let A=0;for(;A<h-1&&t[A].equals(t[A+1]);)A++;if(h<(u?3:2))return;"bevel"===i&&(o=1.05);const p=this.overscaling<=16?15*Ao/(512*this.overscaling):0,d=this.segments.prepareSegment(10*h,this.layoutVertexArray,this.indexArray);let f,m,g,_,y,v;this.e1=this.e2=-1,u&&(f=t[h-2],y=t[A].sub(f)._unit()._perp());for(let r=A;r<h;r++){if(g=r===h-1?u?t[A+1]:void 0:t[r+1],g&&t[r].equals(g))continue;if(y&&(_=y),f&&(m=f),f=t[r],this.hasZOffset){const t=l.get("line-z-offset").value;if("constant"===t.kind)v=t.value;else{if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);s.lineProgress=(t*this.lineClips.start+this.distance+(m?m.dist(f):0))/t}else pr(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),s.lineProgress=0;v=t.evaluate(s,e)}v=v||0}y=g?g.sub(f)._unit()._perp():_,_=_||y;const x=m&&g;let w=x?i:u||c?"butt":n;const b=_.x*y.x+_.y*y.y;if(c){const t=function(t){if(t.patternJoinNone){const e=t.segmentPoints.length/2,r=t.lineSoFar-t.segmentStart;for(let i=0;i<e;++i){const e=t.segmentPoints[2*i+1],n=Math.round(t.segmentPoints[2*i])+.5+.25*e;t.patternVertexArray.emplaceBack(n,r,t.segmentStart),t.patternVertexArray.emplaceBack(n,r,t.segmentStart)}t.segmentPoints.length=0}t.e1=t.e2=-1};if(x&&b<Yd){this.updateDistance(m,f),this.addCurrentVertex(f,_,1,1,d,v),t(this),this.addCurrentVertex(f,y,-1,-1,d,v);continue}if(m){if(!g){this.updateDistance(m,f),this.addCurrentVertex(f,_,1,1,d,v),t(this);continue}w="miter"}}let B=_.add(y);0===B.x&&0===B.y||B._unit();const C=B.x*y.x+B.y*y.y,E=0!==C?1/C:1/0,T=2*Math.sqrt(2-2*C),I=C<$d&&m&&g,S=_.x*y.y-_.y*y.x>0;if(I&&r>A){const t=f.dist(m);if(t>2*p){const e=f.sub(f.sub(m)._mult(p/t)._round());this.updateDistance(m,e),this.addCurrentVertex(e,_,0,0,d,v),m=e}}if(x&&"round"===w&&(E<a?w="miter":E<=2&&(w="fakeround")),"miter"===w&&E>o&&(w="bevel"),"bevel"===w&&(E>2&&(w="flipbevel"),E<o&&(w="miter")),m&&this.updateDistance(m,f),"miter"===w)B._mult(E),this.addCurrentVertex(f,B,0,0,d,v);else if("flipbevel"===w){if(E>100)B=y.mult(-1);else{const t=E*_.add(y).mag()/_.sub(y).mag();B._perp()._mult(t*(S?-1:1))}this.addCurrentVertex(f,B,0,0,d,v),this.addCurrentVertex(f,B.mult(-1),0,0,d,v)}else if("bevel"===w||"fakeround"===w){const t=-Math.sqrt(E*E-1),e=S?t:0,r=S?0:t;if(m&&this.addCurrentVertex(f,_,e,r,d,v),"fakeround"===w){const t=Math.round(180*T/Math.PI/20);for(let e=1;e<t;e++){let r=e/t;if(.5!==r){const t=r-.5;r+=r*t*(r-1)*((1.0904+b*(b*(3.55645-1.43519*b)-3.2452))*t*t+(.848013+b*(.215638*b-1.06021)))}const i=y.sub(_)._mult(r)._add(_)._unit()._mult(S?-1:1);this.addHalfVertex(f,i.x,i.y,!1,S,0,d,v)}}g&&this.addCurrentVertex(f,y,-e,-r,d,v)}else"butt"===w?this.addCurrentVertex(f,B,0,0,d,v):"square"===w?(m||this.addCurrentVertex(f,B,-1,-1,d,v),this.addCurrentVertex(f,B,0,0,d,v),m&&this.addCurrentVertex(f,B,1,1,d,v)):"round"===w&&(m&&(this.addCurrentVertex(f,_,0,0,d,v),this.addCurrentVertex(f,_,1,1,d,v,!0)),g&&(this.addCurrentVertex(f,y,-1,-1,d,v,!0),this.addCurrentVertex(f,y,0,0,d,v)));if(I&&r<h-1){const t=f.dist(g);if(t>2*p){const e=f.add(g.sub(f)._mult(p/t)._round());this.updateDistance(f,e),this.addCurrentVertex(e,y,0,0,d,v),f=e}}}}addVerticesTo(t,e,r,i,n,o,a,s,l,c){const u=(e.w-t.w)/this.tessellationStep|0;if(u>1){this.lineSoFar=t.w;const h=(e.x-t.x)/u,A=(e.y-t.y)/u,p=(e.z-t.z)/u,d=(e.w-t.w)/u;for(let e=1;e<u;++e)t.x+=h,t.y+=A,t.z+=p,this.lineSoFar+=d,this.addHalfVertex(t,r,i,c,!1,a,l,t.z),this.addHalfVertex(t,n,o,c,!0,-s,l,t.z)}this.lineSoFar=e.w,this.addHalfVertex(e,r,i,c,!1,a,l,e.z),this.addHalfVertex(e,n,o,c,!0,-s,l,e.z)}addCurrentVertex(t,e,r,i,n,o,a=!1){const s=e.x+e.y*r,l=e.y-e.x*r,c=e.y*i-e.x,u=-e.y-e.x*i;if(null!=o){const e=-10,h=Ao+10,A=o,p=new Ep(t.x,t.y,A,this.lineSoFar),d=tf(t,e,h),f=this.lineSoFar;if(this.currentVertex)if(d){const o=this.currentVertexIsOutside,p=this.currentVertex,d=new Ep(t.x,t.y,A,this.lineSoFar);Sp(p,d,e,h),tf(d,e,h)||(o&&(this.e1=this.e2=-1,this.lineSoFar=p.w,this.addHalfVertex(p,s,l,a,!1,r,n,p.z),this.addHalfVertex(p,c,u,a,!0,-i,n,p.z)),this.addVerticesTo(p,d,s,l,c,u,r,i,n,a))}else{const t=this.currentVertex;this.currentVertexIsOutside&&(Sp(t,p,e,h),this.e1=this.e2=-1,this.lineSoFar=t.w,this.addHalfVertex(t,s,l,a,!1,r,n,t.z),this.addHalfVertex(t,c,u,a,!0,-i,n,t.z)),this.addVerticesTo(t,p,s,l,c,u,r,i,n,a)}else d||(this.addHalfVertex(t,s,l,a,!1,r,n,o),this.addHalfVertex(t,c,u,a,!0,-i,n,o));this.currentVertex=p,this.currentVertexIsOutside=d,this.lineSoFar=f}else this.addHalfVertex(t,s,l,a,!1,r,n,o),this.addHalfVertex(t,c,u,a,!0,-i,n,o)}addHalfVertex({x:t,y:e},r,i,n,o,a,s,l){this.patternJoinNone&&(0===this.segmentPoints.length&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),o||this.segmentPoints.push(this.lineSoFar-this.segmentStart,a)),this.layoutVertexArray.emplaceBack((t<<1)+(n?1:0),(e<<1)+(o?1:0),Math.round(63*r)+128,Math.round(63*i)+128,1+(0===a?0:a<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const c=s.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,c),s.primitiveLength++),o?this.e2=c:this.e1=c,null!=l&&this.zOffsetVertexArray.emplaceBack(l)}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,e){this.distance+=t.dist(e),this.updateScaledDistance()}}function tf(t,e,r){return t.x<e||t.x>r||t.y<e||t.y>r}bs(Jd,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const ef=new sl({"line-cap":new ol(ll.layout_line["line-cap"]),"line-join":new ol(ll.layout_line["line-join"]),"line-miter-limit":new nl(ll.layout_line["line-miter-limit"]),"line-round-limit":new nl(ll.layout_line["line-round-limit"]),"line-sort-key":new ol(ll.layout_line["line-sort-key"]),"line-z-offset":new ol(ll.layout_line["line-z-offset"]),visibility:new nl(ll.layout_line.visibility)});var rf={paint:new sl({"line-opacity":new ol(ll.paint_line["line-opacity"]),"line-color":new ol(ll.paint_line["line-color"]),"line-translate":new nl(ll.paint_line["line-translate"]),"line-translate-anchor":new nl(ll.paint_line["line-translate-anchor"]),"line-width":new ol(ll.paint_line["line-width"]),"line-gap-width":new ol(ll.paint_line["line-gap-width"]),"line-offset":new ol(ll.paint_line["line-offset"]),"line-blur":new ol(ll.paint_line["line-blur"]),"line-dasharray":new ol(ll.paint_line["line-dasharray"]),"line-pattern":new ol(ll.paint_line["line-pattern"]),"line-gradient":new al(ll.paint_line["line-gradient"]),"line-trim-offset":new nl(ll.paint_line["line-trim-offset"]),"line-trim-fade-range":new nl(ll.paint_line["line-trim-fade-range"]),"line-trim-color":new nl(ll.paint_line["line-trim-color"]),"line-emissive-strength":new nl(ll.paint_line["line-emissive-strength"]),"line-border-width":new ol(ll.paint_line["line-border-width"]),"line-border-color":new ol(ll.paint_line["line-border-color"]),"line-occlusion-opacity":new nl(ll.paint_line["line-occlusion-opacity"])}),layout:ef};function nf(t,e,r){return e*(Ao/(t.tileSize*Math.pow(2,r-t.tileID.overscaledZ)))}function of(t,e){return 1/nf(t,1,e.tileZoom)}function af(t,e,r,i){return t.translatePosMatrix(i||e.tileID.projMatrix,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const sf=t=>{const e=[];lf(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const r=t.paint.get("line-trim-offset");0===r[0]&&0===r[1]||e.push("RENDER_LINE_TRIM_OFFSET"),0!==t.paint.get("line-border-width").constantOr(1)&&e.push("RENDER_LINE_BORDER");const i="none"===t.layout.get("line-join").constantOr("miter"),n=!!t.paint.get("line-pattern").constantOr(1);return i&&n&&e.push("LINE_JOIN_NONE"),e};function lf(t){const e=t.paint.get("line-dasharray").value;return e.value||"constant"!==e.kind}class cf{constructor(t){this._stringToNumber={},this._numberToString=[];for(let e=0;e<t.length;e++){const r=t[e];this._stringToNumber[r]=e,this._numberToString[e]=r}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}var uf={
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
read:function(t,e,r,i,n){var o,a,s=8*n-i-1,l=(1<<s)-1,c=l>>1,u=-7,h=r?n-1:0,A=r?-1:1,p=t[e+h];for(h+=A,o=p&(1<<-u)-1,p>>=-u,u+=s;u>0;o=256*o+t[e+h],h+=A,u-=8);for(a=o&(1<<-u)-1,o>>=-u,u+=i;u>0;a=256*a+t[e+h],h+=A,u-=8);if(0===o)o=1-c;else{if(o===l)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,i),o-=c}return(p?-1:1)*a*Math.pow(2,o-i)},write:function(t,e,r,i,n,o){var a,s,l,c=8*o-n-1,u=(1<<c)-1,h=u>>1,A=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:o-1,d=i?1:-1,f=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=u):(a=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-a))<1&&(a--,l*=2),(e+=a+h>=1?A/l:A*Math.pow(2,1-h))*l>=2&&(a++,l/=2),a+h>=u?(s=0,a=u):a+h>=1?(s=(e*l-1)*Math.pow(2,n),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,n),a=0));n>=8;t[r+p]=255&s,p+=d,s/=256,n-=8);for(a=a<<n|s,c+=n;c>0;t[r+p]=255&a,p+=d,a/=256,c-=8);t[r+p-d]|=128*f}},hf=pf,Af=uf;function pf(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}pf.Varint=0,pf.Fixed64=1,pf.Bytes=2,pf.Fixed32=5;var df=4294967296,ff=1/df,mf="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function gf(t){return t.type===pf.Bytes?t.readVarint()+t.pos:t.pos+1}function _f(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function yf(t,e,r){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(i);for(var n=r.pos-1;n>=t;n--)r.buf[n+i]=r.buf[n]}function vf(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function xf(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function wf(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function bf(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function Bf(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function Cf(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function Ef(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function Tf(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function If(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function Sf(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Mf(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function Ff(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}pf.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var i=this.readVarint(),n=i>>3,o=this.pos;this.type=7&i,t(n,e,this),this.pos===o&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Sf(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Ff(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Sf(this.buf,this.pos)+Sf(this.buf,this.pos+4)*df;return this.pos+=8,t},readSFixed64:function(){var t=Sf(this.buf,this.pos)+Ff(this.buf,this.pos+4)*df;return this.pos+=8,t},readFloat:function(){var t=Af.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Af.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,i=this.buf;return e=127&(r=i[this.pos++]),r<128?e:(e|=(127&(r=i[this.pos++]))<<7,r<128?e:(e|=(127&(r=i[this.pos++]))<<14,r<128?e:(e|=(127&(r=i[this.pos++]))<<21,r<128?e:function(t,e,r){var i,n,o=r.buf;if(i=(112&(n=o[r.pos++]))>>4,n<128)return _f(t,i,e);if(i|=(127&(n=o[r.pos++]))<<3,n<128)return _f(t,i,e);if(i|=(127&(n=o[r.pos++]))<<10,n<128)return _f(t,i,e);if(i|=(127&(n=o[r.pos++]))<<17,n<128)return _f(t,i,e);if(i|=(127&(n=o[r.pos++]))<<24,n<128)return _f(t,i,e);if(i|=(1&(n=o[r.pos++]))<<31,n<128)return _f(t,i,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=i[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&mf?function(t,e,r){return mf.decode(t.subarray(e,r))}(this.buf,e,t):function(t,e,r){for(var i="",n=e;n<r;){var o,a,s,l=t[n],c=null,u=l>239?4:l>223?3:l>191?2:1;if(n+u>r)break;1===u?l<128&&(c=l):2===u?128==(192&(o=t[n+1]))&&(c=(31&l)<<6|63&o)<=127&&(c=null):3===u?(a=t[n+2],128==(192&(o=t[n+1]))&&128==(192&a)&&((c=(15&l)<<12|(63&o)<<6|63&a)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(a=t[n+2],s=t[n+3],128==(192&(o=t[n+1]))&&128==(192&a)&&128==(192&s)&&((c=(15&l)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,i+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),i+=String.fromCharCode(c),n+=u}return i}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==pf.Bytes)return t.push(this.readVarint(e));var r=gf(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==pf.Bytes)return t.push(this.readSVarint());var e=gf(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==pf.Bytes)return t.push(this.readBoolean());var e=gf(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==pf.Bytes)return t.push(this.readFloat());var e=gf(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==pf.Bytes)return t.push(this.readDouble());var e=gf(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==pf.Bytes)return t.push(this.readFixed32());var e=gf(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==pf.Bytes)return t.push(this.readSFixed32());var e=gf(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==pf.Bytes)return t.push(this.readFixed64());var e=gf(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==pf.Bytes)return t.push(this.readSFixed64());var e=gf(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===pf.Varint)for(;this.buf[this.pos++]>127;);else if(e===pf.Bytes)this.pos=this.readVarint()+this.pos;else if(e===pf.Fixed32)this.pos+=4;else{if(e!==pf.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Mf(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Mf(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Mf(this.buf,-1&t,this.pos),Mf(this.buf,Math.floor(t*ff),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Mf(this.buf,-1&t,this.pos),Mf(this.buf,Math.floor(t*ff),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var r,i;if(t>=0?(r=t%4294967296|0,i=t/4294967296|0):(i=~(-t/4294967296),4294967295^(r=~(-t%4294967296))?r=r+1|0:(r=0,i=i+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,r){r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,r.buf[r.pos]=127&(t>>>=7)}(r,0,e),function(t,e){var r=(7&t)<<4;e.buf[e.pos++]|=r|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(i,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,r){for(var i,n,o=0;o<e.length;o++){if((i=e.charCodeAt(o))>55295&&i<57344){if(!n){i>56319||o+1===e.length?(t[r++]=239,t[r++]=191,t[r++]=189):n=i;continue}if(i<56320){t[r++]=239,t[r++]=191,t[r++]=189,n=i;continue}i=n-55296<<10|i-56320|65536,n=null}else n&&(t[r++]=239,t[r++]=191,t[r++]=189,n=null);i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:(i<65536?t[r++]=i>>12|224:(t[r++]=i>>18|240,t[r++]=i>>12&63|128),t[r++]=i>>6&63|128),t[r++]=63&i|128)}return r}(this.buf,t,this.pos);var r=this.pos-e;r>=128&&yf(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),Af.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Af.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var i=this.pos-r;i>=128&&yf(r,i,this),this.pos=r-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,r){this.writeTag(t,pf.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,vf,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,xf,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Bf,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,wf,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,bf,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Cf,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,Ef,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,Tf,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,If,e)},writeBytesField:function(t,e){this.writeTag(t,pf.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,pf.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,pf.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,pf.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,pf.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,pf.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,pf.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,pf.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,pf.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,pf.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var Pf=A(hf);const Lf=["id","tile","layer","source","sourceLayer","state"];class Df{constructor(t,e,r,i,n){this.type="Feature",this._vectorTileFeature=t,this._z=e,this._x=r,this._y=i,this.properties=t.properties,this.id=n}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const e of Lf)void 0!==this[e]&&(t[e]=this[e]);return t}}class Uf{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,e,r){const i=String(e);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][i]=this.stateChanges[t][i]||{},er(this.stateChanges[t][i],r),null===this.deletedStates[t]){this.deletedStates[t]={};for(const e in this.state[t])e!==i&&(this.deletedStates[t][e]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][i]){this.deletedStates[t][i]={};for(const e in this.state[t][i])r[e]||(this.deletedStates[t][i][e]=null)}else for(const e in r)this.deletedStates[t]&&this.deletedStates[t][i]&&null===this.deletedStates[t][i][e]&&delete this.deletedStates[t][i][e]}removeFeatureState(t,e,r){if(null===this.deletedStates[t])return;const i=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},r&&void 0!==e)null!==this.deletedStates[t][i]&&(this.deletedStates[t][i]=this.deletedStates[t][i]||{},this.deletedStates[t][i][r]=null);else if(void 0!==e)if(this.stateChanges[t]&&this.stateChanges[t][i])for(r in this.deletedStates[t][i]={},this.stateChanges[t][i])this.deletedStates[t][i][r]=null;else this.deletedStates[t][i]=null;else this.deletedStates[t]=null}getState(t,e){const r=String(e),i=er({},(this.state[t]||{})[r],(this.stateChanges[t]||{})[r]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){const r=this.deletedStates[t][e];if(null===r)return{};for(const t in r)delete i[t]}return i}initializeTileState(t,e){t.setFeatureState(this.state,e)}coalesceChanges(t,e){const r={};for(const t in this.stateChanges){this.state[t]=this.state[t]||{};const e={};for(const r in this.stateChanges[t])this.state[t][r]||(this.state[t][r]={}),er(this.state[t][r],this.stateChanges[t][r]),e[r]=this.state[t][r];r[t]=e}for(const t in this.deletedStates){this.state[t]=this.state[t]||{};const e={};if(null===this.deletedStates[t])for(const r in this.state[t])e[r]={},this.state[t][r]={};else for(const r in this.deletedStates[t]){if(null===this.deletedStates[t][r])this.state[t][r]={};else if(this.state[t][r])for(const e of Object.keys(this.deletedStates[t][r]))delete this.state[t][r][e];e[r]=this.state[t][r]}r[t]=r[t]||{},er(r[t],e)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(r).length)for(const i in t)t[i].setFeatureState(r,e)}}class kf{constructor(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new xs(Ao,16,0),this.featureIndexArray=new vc,this.promoteId=e,this.is3DTile=!1}insert(t,e,r,i,n,o=0,a=0){const s=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,i,n,o);const l=this.grid;for(let t=0;t<e.length;t++){const r=e[t],i=[1/0,1/0,-1/0,-1/0];for(let t=0;t<r.length;t++){const e=r[t];i[0]=Math.min(i[0],e.x),i[1]=Math.min(i[1],e.y),i[2]=Math.max(i[2],e.x),i[3]=Math.max(i[3],e.y)}0!==a&&(i[0]-=a,i[1]-=a,i[2]+=a,i[3]+=a),i[0]<Ao&&i[1]<Ao&&i[2]>=0&&i[3]>=0&&l.insert(s,i[0],i[1],i[2],i[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new bp(new Pf(this.rawTileData)).layers,this.sourceLayerCoder=new cf(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,e,r,i){this.loadVTLayers();const n=t.params||{},o=Al(n.filter),a=t.tileResult,s=t.transform,l=a.bufferedTilespaceBounds,c=this.grid.query(l.min.x,l.min.y,l.max.x,l.max.y,((t,e,r,i)=>sh(a.bufferedTilespaceGeometry,t,e,r,i)));c.sort(Rf);let u=null;s.elevation&&c.length>0&&(u=Yp.create(s.elevation,this.tileID));const h={};let A;for(let l=0;l<c.length;l++){const p=c[l];if(p===A)continue;A=p;const d=this.featureIndexArray.get(p);let f=null;if(this.is3DTile){const t=this.bucketLayerIDs[0][0],r=e[t];if("model"!==r.type)continue;const{queryFeature:i,intersectionZ:n}=r.queryIntersectsMatchingFeature(a,d.featureIndex,o,s);i&&this.appendToResult(h,t,d.featureIndex,i,n)}else this.loadMatchingFeature(h,d,o,n.layers,n.availableImages,e,r,i,((e,r,i,n=0)=>(f||(f=Ku(e,this.tileID.canonical,t.tileTransform)),r.queryIntersectsFeature(a,e,i,f,this.z,t.transform,t.pixelPosMatrix,u,n))))}return h}loadMatchingFeature(t,e,r,i,n,o,a,s,l){const{featureIndex:c,bucketIndex:u,sourceLayerIndex:h,layoutVertexArrayOffset:A}=e,p=this.bucketLayerIDs[u];if(i&&!function(t,e){for(let r=0;r<t.length;r++)if(e.indexOf(t[r])>=0)return!0;return!1}(i,p))return;const d=this.sourceLayerCoder.decode(h),f=this.vtLayers[d].feature(c);if(r.needGeometry){const t=qu(f,!0);if(!r.filter(new Ws(this.tileID.overscaledZ),t,this.tileID.canonical))return}else if(!r.filter(new Ws(this.tileID.overscaledZ),f))return;const m=this.getId(f,d);for(let e=0;e<p.length;e++){const r=p[e];if(i&&i.indexOf(r)<0)continue;const u=o[r];if(!u)continue;let h={};void 0!==m&&s&&(h=s.getState(u.sourceLayer||"_geojsonTileLayer",m));const d=!l||l(f,u,h,A);if(!d)continue;const g=new Df(f,this.z,this.x,this.y,m),_=er({},a[r]);_.paint=zf(_.paint,u.paint,f,h,n),_.layout=zf(_.layout,u.layout,f,h,n),g.layer=_,this.appendToResult(t,r,c,g,d)}}appendToResult(t,e,r,i,n){let o=t[e];void 0===o&&(o=t[e]=[]),o.push({featureIndex:r,feature:i,intersectionZ:n})}lookupSymbolFeatures(t,e,r,i,n,o,a,s){const l={};this.loadVTLayers();const c=Al(n);for(const n of t)this.loadMatchingFeature(l,{bucketIndex:r,sourceLayerIndex:i,featureIndex:n,layoutVertexArrayOffset:0},c,o,a,s,e);return l}loadFeature(t){const{featureIndex:e,sourceLayerIndex:r}=t;this.loadVTLayers();const i=this.sourceLayerCoder.decode(r),n=this.vtFeatures[i];if(n[e])return n[e];const o=this.vtLayers[i].feature(e);return n[e]=o,o}hasLayer(t){for(const e of this.bucketLayerIDs)for(const r of e)if(t===r)return!0;return!1}getId(t,e){let r=t.id;if(this.promoteId){const i="string"==typeof this.promoteId?this.promoteId:this.promoteId[e];null!=i&&(r=t.properties[i]),"boolean"==typeof r&&(r=Number(r))}return r}}function zf(t,e,r,i,n){return cr(t,((t,o)=>{const a=e instanceof il?e.get(o):null;return a&&a.evaluate?a.evaluate(r,i,n):a}))}function Rf(t,e){return e-t}bs(kf,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});var Of=24;const Qf=128;function Nf(t,e){const{expression:r}=e;if("constant"===r.kind)return{kind:"constant",layoutSize:r.evaluate(new Ws(t+1))};if("source"===r.kind)return{kind:"source"};{const{zoomStops:e,interpolationType:i}=r;let n=0;for(;n<e.length&&e[n]<=t;)n++;n=Math.max(0,n-1);let o=n;for(;o<e.length&&e[o]<t+1;)o++;o=Math.min(e.length-1,o);const a=e[n],s=e[o];return"composite"===r.kind?{kind:"composite",minZoom:a,maxZoom:s,interpolationType:i}:{kind:"camera",minZoom:a,maxZoom:s,minSize:r.evaluate(new Ws(a)),maxSize:r.evaluate(new Ws(s)),interpolationType:i}}}function Vf(t,{uSize:e,uSizeT:r},{lowerSize:i,upperSize:n}){return"source"===t.kind?i/Qf:"composite"===t.kind?ji(i/Qf,n/Qf,r):e}function Hf(t,e){let r=0,i=0;if("constant"===t.kind)i=t.layoutSize;else if("source"!==t.kind){const{interpolationType:n,minZoom:o,maxZoom:a}=t,s=n?Xe(xa.interpolationFactor(n,e,o,a),0,1):0;"camera"===t.kind?i=ji(t.minSize,t.maxSize,s):r=s}return{uSizeT:r,uSize:i}}var jf=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Qf,evaluateSizeForFeature:Vf,evaluateSizeForZoom:Hf,getSizeData:Nf});function Gf(t,e,r){return t.sections.forEach((t=>{t.text=function(t,e,r){const i=e.layout.get("text-transform").evaluate(r,{});return"uppercase"===i?t=t.toLocaleUpperCase():"lowercase"===i&&(t=t.toLocaleLowerCase()),Zs.applyArabicShaping&&(t=Zs.applyArabicShaping(t)),t}(t.text,e,r)})),t}const Kf={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function qf(t){return"︶"===t||"﹈"===t||"︸"===t||"﹄"===t||"﹂"===t||"︾"===t||"︼"===t||"︺"===t||"︘"===t||"﹀"===t||"︐"===t||"︓"===t||"︔"===t||"｀"===t||"￣"===t||"︑"===t||"︒"===t}function Zf(t){return"︵"===t||"﹇"===t||"︷"===t||"﹃"===t||"﹁"===t||"︽"===t||"︻"===t||"︹"===t||"︗"===t||"︿"===t}const Wf=3;function Xf(t,e,r){e.glyphs=[],1===t&&r.readMessage($f,e)}function $f(t,e,r){if(3===t){const{id:t,bitmap:i,width:n,height:o,left:a,top:s,advance:l}=r.readMessage(Yf,{});e.glyphs.push({id:t,bitmap:new AA({width:n+2*Wf,height:o+2*Wf},i),metrics:{width:n,height:o,left:a,top:s,advance:l}})}else 4===t?e.ascender=r.readSVarint():5===t&&(e.descender=r.readSVarint())}function Yf(t,e,r){1===t?e.id=r.readVarint():2===t?e.bitmap=r.readBytes():3===t?e.width=r.readVarint():4===t?e.height=r.readVarint():5===t?e.left=r.readSVarint():6===t?e.top=r.readSVarint():7===t&&(e.advance=r.readVarint())}const Jf=Wf,tm={horizontal:1,vertical:2,horizontalOnly:3};class em{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,e){const r=new em;return r.scale=t||1,r.fontStack=e,r}static forImage(t){const e=new em;return e.imageName=t,e}}class rm{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,e){const r=new rm;for(let i=0;i<t.sections.length;i++){const n=t.sections[i];n.image?r.addImageSection(n):r.addTextSection(n,e)}return r}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCodePoint(t){return this.text.codePointAt(t)}verticalizePunctuation(t){this.text=function(t,e){let r="";for(let i=0;i<t.length;i++){const n=t.charCodeAt(i+1)||null,o=t.charCodeAt(i-1)||null;r+=!e&&(n&&Ls(n)&&!Kf[t[i+1]]||o&&Ls(o)&&!Kf[t[i-1]])||!Kf[t[i]]?t[i]:Kf[t[i]]}return r}(this.text,t)}trim(){let t=0;for(let e=0;e<this.text.length&&nm[this.text.charCodeAt(e)];e++)t++;let e=this.text.length;for(let r=this.text.length-1;r>=0&&r>=t&&nm[this.text.charCodeAt(r)];r--)e--;this.text=this.text.substring(t,e),this.sectionIndex=this.sectionIndex.slice(t,e)}substring(t,e){const r=new rm;return r.text=this.text.substring(t,e),r.sectionIndex=this.sectionIndex.slice(t,e),r.sections=this.sections,r}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,e)=>Math.max(t,this.sections[e].scale)),0)}addTextSection(t,e){this.text+=t.text,this.sections.push(em.forText(t.scale,t.fontStack||e));const r=this.sections.length-1;for(let e=0;e<t.text.length;++e)this.sectionIndex.push(r)}addImageSection(t){const e=t.image?t.image.namePrimary:"";if(0===e.length)return void pr("Can't add FormattedSection with an empty image.");const r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCodePoint(r),this.sections.push(em.forImage(e)),this.sectionIndex.push(this.sections.length-1)):pr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function im(t,e,r,i,n,o,a,s,l,c,u,h,A,p,d){const f=rm.fromFeature(t,n);h===tm.vertical&&f.verticalizePunctuation(A);let m=[];const g=function(t,e,r,i,n,o){if(!t)return[];const a=[],s=function(t,e,r,i,n,o){let a=0;for(let r=0;r<t.length();r++){const s=t.getSection(r);a+=am(t.getCodePoint(r),s,i,n,e,o)}return a/Math.max(1,Math.ceil(a/r))}(t,e,r,i,n,o),l=t.text.indexOf("​")>=0;let c=0;for(let r=0;r<t.length();r++){const h=t.getSection(r),A=t.getCodePoint(r);if(nm[A]||(c+=am(A,h,i,n,e,o)),r<t.length()-1){const e=!((u=A)<11904||!(Is["Bopomofo Extended"](u)||Is.Bopomofo(u)||Is["CJK Compatibility Forms"](u)||Is["CJK Compatibility Ideographs"](u)||Is["CJK Compatibility"](u)||Is["CJK Radicals Supplement"](u)||Is["CJK Strokes"](u)||Is["CJK Symbols and Punctuation"](u)||Is["CJK Unified Ideographs Extension A"](u)||Is["CJK Unified Ideographs"](u)||Is["Enclosed CJK Letters and Months"](u)||Is["Halfwidth and Fullwidth Forms"](u)||Is.Hiragana(u)||Is["Ideographic Description Characters"](u)||Is["Kangxi Radicals"](u)||Is["Katakana Phonetic Extensions"](u)||Is.Katakana(u)||Is["Vertical Forms"](u)||Is["Yi Radicals"](u)||Is["Yi Syllables"](u)));(om[A]||e||h.imageName)&&a.push(cm(r+1,c,s,a,lm(A,t.getCodePoint(r+1),e&&l),!1))}}var u;return um(cm(t.length(),c,s,a,0,!0))}(f,c,o,e,i,p),{processBidirectionalText:_,processStyledBidirectionalText:y}=Zs;if(_&&1===f.sections.length){const t=_(f.toString(),g);for(const e of t){const t=new rm;t.text=e,t.sections=f.sections;for(let r=0;r<e.length;r++)t.sectionIndex.push(0);m.push(t)}}else if(y){const t=y(f.text,f.sectionIndex,g);for(const e of t){const t=new rm;t.text=e[0],t.sectionIndex=e[1],t.sections=f.sections,m.push(t)}}else m=function(t,e){const r=[],i=t.text;let n=0;for(const i of e)r.push(t.substring(n,i)),n=i;return n<i.length&&r.push(t.substring(n,i.length)),r}(f,g);const v=[],x={positionedLines:v,text:f.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:h,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(t,e,r,i,n,o,a,s,l,c,u,h){let A=0,p=0,d=0;const f="right"===s?1:"left"===s?0:.5;let m=!1;for(const t of n){const r=t.getSections();for(const t of r){if(t.imageName)continue;const r=e[t.fontStack];if(r&&(m=void 0!==r.ascender&&void 0!==r.descender,!m))break}if(!m)break}let g=0;for(const a of n){a.trim();const n=a.getMaxScale(),s=(n-1)*Of,y={positionedGlyphs:[],lineOffset:0};t.positionedLines[g]=y;const v=y.positionedGlyphs;let x=0;if(!a.length()){p+=o,++g;continue}let w=0,b=0;for(let o=0;o<a.length();o++){const s=a.getSection(o),d=a.getSectionIndex(o),f=a.getCodePoint(o);let g=s.scale,y=null,B=null,C=null,E=Of,T=0;const I=!(l===tm.horizontal||!u&&!Ps(f)||u&&(nm[f]||(_=f,Is.Arabic(_)||Is["Arabic Supplement"](_)||Is["Arabic Extended-A"](_)||Is["Arabic Presentation Forms-A"](_)||Is["Arabic Presentation Forms-B"](_))));if(s.imageName){const e=i[s.imageName];if(!e)continue;C=s.imageName,t.iconsInText=t.iconsInText||!0,B=e.paddedRect;const r=e.displaySize;g=g*Of/h,y={width:r[0],height:r[1],left:0,top:-Jf,advance:I?r[1]:r[0],localGlyph:!1},T=m?-y.height*g:n*Of-17-r[1]*g,E=y.advance;const o=(I?r[0]:r[1])*g-Of*n;o>0&&o>x&&(x=o)}else{const t=r[s.fontStack];if(!t)continue;t[f]&&(B=t[f]);const i=e[s.fontStack];if(!i)continue;const o=i.glyphs[f];if(!o)continue;if(y=o.metrics,E=8203!==f?Of:0,m){const t=void 0!==i.ascender?Math.abs(i.ascender):0,e=void 0!==i.descender?Math.abs(i.descender):0,r=(t+e)*g;w<r&&(w=r,b=(t-e)/2*g),T=-t*g}else T=(n-g)*Of-17}I?(t.verticalizable=!0,v.push({glyph:f,imageName:C,x:A,y:p+T,vertical:I,scale:g,localGlyph:y.localGlyph,fontStack:s.fontStack,sectionIndex:d,metrics:y,rect:B}),A+=E*g+c):(v.push({glyph:f,imageName:C,x:A,y:p+T,vertical:I,scale:g,localGlyph:y.localGlyph,fontStack:s.fontStack,sectionIndex:d,metrics:y,rect:B}),A+=y.advance*g+c)}0!==v.length&&(d=Math.max(A-c,d),m?Am(v,f,x,b,o*n/2):Am(v,f,x,0,o/2)),A=0;const B=o*n+x;y.lineOffset=Math.max(x,s),p+=B,++g}var _;const y=p,{horizontalAlign:v,verticalAlign:x}=hm(a);(function(t,e,r,i,n,o){const a=(e-r)*n,s=-o*i;for(const e of t)for(const t of e.positionedGlyphs)t.x+=a,t.y+=s})(t.positionedLines,f,v,x,d,y),t.top+=-x*y,t.bottom=t.top+y,t.left+=-v*d,t.right=t.left+d,t.hasBaseline=m}(x,e,r,i,m,a,s,l,h,c,A,d),!function(t){for(const e of t)if(0!==e.positionedGlyphs.length)return!1;return!0}(v)&&x}const nm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},om={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function am(t,e,r,i,n,o){if(e.imageName){const t=i[e.imageName];return t?t.displaySize[0]*e.scale*Of/o+n:0}{const i=r[e.fontStack],o=i&&i.glyphs[t];return o?o.metrics.advance*e.scale+n:0}}function sm(t,e,r,i){const n=Math.pow(t-e,2);return i?t<e?n/2:2*n:n+Math.abs(r)*r}function lm(t,e,r){let i=0;return 10===t&&(i-=1e4),r&&(i+=150),40!==t&&65288!==t||(i+=50),41!==e&&65289!==e||(i+=50),i}function cm(t,e,r,i,n,o){let a=null,s=sm(e,r,n,o);for(const t of i){const i=sm(e-t.x,r,n,o)+t.badness;i<=s&&(a=t,s=i)}return{index:t,x:e,priorBreak:a,badness:s}}function um(t){return t?um(t.priorBreak).concat(t.index):[]}function hm(t){let e=.5,r=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Am(t,e,r,i,n){if(!(e||r||i||n))return;const o=t.length-1,a=t[o],s=(a.x+a.metrics.advance*a.scale)*e;for(let e=0;e<=o;e++)t[e].x-=s,t[e].y+=r+i+n}function pm(t,e,r,i){const{horizontalAlign:n,verticalAlign:o}=hm(i),a=r[0]-t.displaySize[0]*n,s=r[1]-t.displaySize[1]*o;return{imagePrimary:t,imageSecondary:e,top:s,bottom:s+t.displaySize[1],left:a,right:a+t.displaySize[0]}}function dm(t,e,r,i,n,o){const a=t.imagePrimary;let s;if(a.content){const t=a.content,e=a.pixelRatio||1;s=[t[0]/e,t[1]/e,a.displaySize[0]-t[2]/e,a.displaySize[1]-t[3]/e]}const l=e.left*o,c=e.right*o;let u,h,A,p;"width"===r||"both"===r?(p=n[0]+l-i[3],h=n[0]+c+i[1]):(p=n[0]+(l+c-a.displaySize[0])/2,h=p+a.displaySize[0]);const d=e.top*o,f=e.bottom*o;return"height"===r||"both"===r?(u=n[1]+d-i[0],A=n[1]+f+i[2]):(u=n[1]+(d+f-a.displaySize[1])/2,A=u+a.displaySize[1]),{imagePrimary:a,imageSecondary:void 0,top:u,right:h,bottom:A,left:p,collisionPadding:s}}class fm extends Ne{constructor(t,e,r,i,n){super(t,e),this.angle=i,this.z=r,void 0!==n&&(this.segment=n)}clone(){return new fm(this.x,this.y,this.z,this.angle,this.segment)}}function mm(t,e,r,i,n){if(void 0===e.segment)return!0;let o=e,a=e.segment+1,s=0;for(;s>-r/2;){if(a--,a<0)return!1;s-=t[a].dist(o),o=t[a]}s+=t[a].dist(t[a+1]),a++;const l=[];let c=0;for(;s<r/2;){const e=t[a],r=t[a+1];if(!r)return!1;let o=t[a-1].angleTo(e)-e.angleTo(r);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:s,angleDelta:o}),c+=o;s-l[0].distance>i;)c-=l.shift().angleDelta;if(c>n)return!1;a++,s+=e.dist(r)}return!0}function gm(t){let e=0;for(let r=0;r<t.length-1;r++)e+=t[r].dist(t[r+1]);return e}function _m(t,e,r){return t?.6*e*r:0}function ym(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function vm(t,e,r,i,n,o){const a=_m(r,n,o),s=ym(r,i)*o;let l=0;const c=gm(t)/2;for(let r=0;r<t.length-1;r++){const i=t[r],n=t[r+1],o=i.dist(n);if(l+o>c){const u=(c-l)/o,h=ji(i.x,n.x,u),A=ji(i.y,n.y,u),p=new fm(h,A,0,n.angleTo(i),r);return!a||mm(t,p,s,a,e)?p:void 0}l+=o}}function xm(t,e,r,i,n,o,a,s,l){const c=_m(i,o,a),u=ym(i,n),h=u*a,A=0===t[0].x||t[0].x===l||0===t[0].y||t[0].y===l;return e-h<e/4&&(e=h+e/4),wm(t,A?e/2*s%e:(u/2+2*o)*a*s%e,e,c,r,h,A,!1,l)}function wm(t,e,r,i,n,o,a,s,l){const c=o/2,u=gm(t);let h=0,A=e-r,p=[];for(let e=0;e<t.length-1;e++){const a=t[e],s=t[e+1],d=a.dist(s),f=s.angleTo(a);for(;A+r<h+d;){A+=r;const m=(A-h)/d,g=ji(a.x,s.x,m),_=ji(a.y,s.y,m);if(g>=0&&g<l&&_>=0&&_<l&&A-c>=0&&A+c<=u){const r=new fm(g,_,0,f,e);i&&!mm(t,r,o,i,n)||p.push(r)}}h+=d}return s||p.length||a||(p=wm(t,h/2,r,i,n,o,a,!0,l)),p}function bm(t,e,r,i,n){const o=[];for(let a=0;a<t.length;a++){const s=t[a];let l;for(let t=0;t<s.length-1;t++){let a=s[t],c=s[t+1];a.x<e&&c.x<e||(a.x<e?a=new Ne(e,a.y+(e-a.x)/(c.x-a.x)*(c.y-a.y))._round():c.x<e&&(c=new Ne(e,a.y+(e-a.x)/(c.x-a.x)*(c.y-a.y))._round()),a.y<r&&c.y<r||(a.y<r?a=new Ne(a.x+(r-a.y)/(c.y-a.y)*(c.x-a.x),r)._round():c.y<r&&(c=new Ne(a.x+(r-a.y)/(c.y-a.y)*(c.x-a.x),r)._round()),a.x>=i&&c.x>=i||(a.x>=i?a=new Ne(i,a.y+(i-a.x)/(c.x-a.x)*(c.y-a.y))._round():c.x>=i&&(c=new Ne(i,a.y+(i-a.x)/(c.x-a.x)*(c.y-a.y))._round()),a.y>=n&&c.y>=n||(a.y>=n?a=new Ne(a.x+(n-a.y)/(c.y-a.y)*(c.x-a.x),n)._round():c.y>=n&&(c=new Ne(a.x+(n-a.y)/(c.y-a.y)*(c.x-a.x),n)._round()),l&&a.equals(l[l.length-1])||(l=[a],o.push(l)),l.push(c)))))}}return o}function Bm(t){let e=0,r=0;for(const i of t)e+=i.w*i.h,r=Math.max(r,i.w);t.sort(((t,e)=>e.h-t.h));const i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let n=0,o=0;for(const e of t)for(let t=i.length-1;t>=0;t--){const r=i[t];if(!(e.w>r.w||e.h>r.h)){if(e.x=r.x,e.y=r.y,o=Math.max(o,e.y+e.h),n=Math.max(n,e.x+e.w),e.w===r.w&&e.h===r.h){const e=i.pop();t<i.length&&(i[t]=e)}else e.h===r.h?(r.x+=e.w,r.w-=e.w):e.w===r.w?(r.y+=e.h,r.h-=e.h):(i.push({x:r.x+e.w,y:r.y,w:r.w-e.w,h:e.h}),r.y+=e.h,r.h-=e.h);break}}return{w:n,h:o,fill:e/(n*o)||0}}bs(fm,"Anchor");const Cm=1;class Em{constructor(t,{pixelRatio:e,version:r,stretchX:i,stretchY:n,content:o}){this.paddedRect=t,this.pixelRatio=e,this.stretchX=i,this.stretchY=n,this.content=o,this.version=r}get tl(){return[this.paddedRect.x+Cm,this.paddedRect.y+Cm]}get br(){return[this.paddedRect.x+this.paddedRect.w-Cm,this.paddedRect.y+this.paddedRect.h-Cm]}get displaySize(){return[(this.paddedRect.w-2*Cm)/this.pixelRatio,(this.paddedRect.h-2*Cm)/this.pixelRatio]}}class Tm{constructor(t,e,r){const i={},n={};this.haveRenderCallbacks=[];const o=[];this.addImages(t,i,o),this.addImages(e,n,o);const{w:a,h:s}=Bm(o),l=new pA({width:a||1,height:s||1});for(const e in t){const n=t[e],o=i[e].paddedRect;pA.copy(n.data,l,{x:0,y:0},{x:o.x+Cm,y:o.y+Cm},n.data,r,n.sdf)}for(const t in e){const i=e[t],o=n[t].paddedRect,a=o.x+Cm,s=o.y+Cm,c=i.data.width,u=i.data.height;pA.copy(i.data,l,{x:0,y:0},{x:a,y:s},i.data,r),pA.copy(i.data,l,{x:0,y:u-1},{x:a,y:s-1},{width:c,height:1},r),pA.copy(i.data,l,{x:0,y:0},{x:a,y:s+u},{width:c,height:1},r),pA.copy(i.data,l,{x:c-1,y:0},{x:a-1,y:s},{width:1,height:u},r),pA.copy(i.data,l,{x:0,y:0},{x:a+c,y:s},{width:1,height:u},r)}this.image=l,this.iconPositions=i,this.patternPositions=n}addImages(t,e,r){for(const i in t){const n=t[i],o={x:0,y:0,w:n.data.width+2*Cm,h:n.data.height+2*Cm};r.push(o),e[i]=new Em(o,n),n.hasRenderCallback&&this.haveRenderCallbacks.push(i)}}patchUpdatedImages(t,e,r){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((e=>t.hasImage(e,r))),t.dispatchRenderCallbacks(this.haveRenderCallbacks,r);for(const i in t.getUpdatedImages(r))this.patchUpdatedImage(this.iconPositions[i],t.getImage(i,r),e),this.patchUpdatedImage(this.patternPositions[i],t.getImage(i,r),e)}patchUpdatedImage(t,e,r){if(!t||!e)return;if(t.version===e.version)return;t.version=e.version;const[i,n]=t.tl,o=!!Object.keys(this.patternPositions).length;r.update(e.data,{useMipmap:o},{x:i,y:n})}}bs(Em,"ImagePosition"),bs(Tm,"ImageAtlas");const Im=1e20;function Sm(t,e,r,i,n,o,a,s,l){for(let c=e;c<e+i;c++)Mm(t,r*o+c,o,n,a,s,l);for(let c=r;c<r+n;c++)Mm(t,c*o+e,1,i,a,s,l)}function Mm(t,e,r,i,n,o,a){o[0]=0,a[0]=-Im,a[1]=Im,n[0]=t[e];for(let s=1,l=0,c=0;s<i;s++){n[s]=t[e+s*r];const i=s*s;do{const t=o[l];c=(n[s]-n[t]+i-t*t)/(s-t)/2}while(c<=a[l]&&--l>-1);l++,o[l]=s,a[l]=c,a[l+1]=Im}for(let s=0,l=0;s<i;s++){for(;a[l+1]<s;)l++;const i=o[l],c=s-i;t[e+s*r]=n[i]+c*c}}const Fm=2,Pm={none:0,ideographs:1,all:2};class Lm{constructor(t,e,r){this.requestManager=t,this.localGlyphMode=e,this.localFontFamily=r,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t,e){this.urls[e]=t}getGlyphs(t,e,r){const n=[],o=this.urls[e]||i.GLYPHS_URL;for(const e in t)for(const r of t[e])n.push({stack:e,id:r});Je(n,(({stack:t,id:e},r)=>{let i=this.entries[t];i||(i=this.entries[t]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let n=i.glyphs[e];if(void 0!==n)return void r(null,{stack:t,id:e,glyph:n});if(n=this._tinySDF(i,t,e),n)return i.glyphs[e]=n,void r(null,{stack:t,id:e,glyph:n});const a=Math.floor(e/256);if(256*a>65535)return void r(new Error("glyphs > 65535 not supported"));if(i.ranges[a])return void r(null,{stack:t,id:e,glyph:n});let s=i.requests[a];s||(s=i.requests[a]=[],Lm.loadGlyphRange(t,a,o,this.requestManager,((t,e)=>{if(e){i.ascender=e.ascender,i.descender=e.descender;for(const t in e.glyphs)this._doesCharSupportLocalGlyph(+t)||(i.glyphs[+t]=e.glyphs[+t]);i.ranges[a]=!0}for(const r of s)r(t,e);delete i.requests[a]}))),s.push(((i,n)=>{i?r(i):n&&r(null,{stack:t,id:e,glyph:n.glyphs[e]||null})}))}),((t,e)=>{if(t)r(t);else if(e){const t={};for(const{stack:r,id:i,glyph:n}of e)void 0===t[r]&&(t[r]={}),void 0===t[r].glyphs&&(t[r].glyphs={}),t[r].glyphs[i]=n&&{id:n.id,bitmap:n.bitmap.clone(),metrics:n.metrics},t[r].ascender=this.entries[r].ascender,t[r].descender=this.entries[r].descender;r(null,t)}}))}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==Pm.none&&(this.localGlyphMode===Pm.all?!!this.localFontFamily:!!this.localFontFamily&&(Is["CJK Unified Ideographs"](t)||Is["Hangul Syllables"](t)||Is.Hiragana(t)||Is.Katakana(t)||Is["CJK Symbols and Punctuation"](t)||Is["CJK Unified Ideographs Extension A"](t)||Is["CJK Unified Ideographs Extension B"](t)))}_tinySDF(t,e,r){const i=this.localFontFamily;if(!i||!this._doesCharSupportLocalGlyph(r))return;let n=t.tinySDF;if(!n){let r="400";/bold/i.test(e)?r="900":/medium/i.test(e)?r="500":/light/i.test(e)&&(r="200"),n=t.tinySDF=new Lm.TinySDF({fontFamily:i,fontWeight:r,fontSize:24*Fm,buffer:3*Fm,radius:8*Fm}),n.fontWeight=r}if(this.localGlyphs[n.fontWeight][r])return this.localGlyphs[n.fontWeight][r];const o=String.fromCodePoint(r),{data:a,width:s,height:l,glyphWidth:c,glyphHeight:u,glyphLeft:h,glyphTop:A,glyphAdvance:p}=n.draw(o);return this.localGlyphs[n.fontWeight][r]={id:r,bitmap:new AA({width:s,height:l},a),metrics:{width:c/Fm,height:u/Fm,left:h/Fm,top:A/Fm-27,advance:p/Fm,localGlyph:!0}}}}Lm.loadGlyphRange=function(t,e,r,i,n){const o=256*e,a=o+255,s=i.transformRequest(i.normalizeGlyphsURL(r).replace("{fontstack}",t).replace("{range}",`${o}-${a}`),$r.Glyphs);ei(s,((t,e)=>{if(t)n(t);else if(e){const t={},r=function(t){return new Pf(t).readFields(Xf,{})}(e);for(const e of r.glyphs)t[e.id]=e;n(null,{glyphs:t,ascender:r.ascender,descender:r.descender})}}))},Lm.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:r=8,cutoff:i=.25,fontFamily:n="sans-serif",fontWeight:o="normal",fontStyle:a="normal"}={}){this.buffer=e,this.cutoff=i,this.radius=r;const s=this.size=t+4*e,l=this._createCanvas(s),c=this.ctx=l.getContext("2d",{willReadFrequently:!0});c.font=`${a} ${o} ${t}px ${n}`,c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(s*s),this.gridInner=new Float64Array(s*s),this.f=new Float64Array(s),this.z=new Float64Array(s+1),this.v=new Uint16Array(s)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:i,actualBoundingBoxLeft:n,actualBoundingBoxRight:o}=this.ctx.measureText(t),a=Math.ceil(r),s=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-n))),l=Math.min(this.size-this.buffer,a+Math.ceil(i)),c=s+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),A=new Uint8ClampedArray(h),p={data:A,width:c,height:u,glyphWidth:s,glyphHeight:l,glyphTop:a,glyphLeft:0,glyphAdvance:e};if(0===s||0===l)return p;const{ctx:d,buffer:f,gridInner:m,gridOuter:g}=this;d.clearRect(f,f,s,l),d.fillText(t,f,f+a);const _=d.getImageData(f,f,s,l);g.fill(Im,0,h),m.fill(0,0,h);for(let t=0;t<l;t++)for(let e=0;e<s;e++){const r=_.data[4*(t*s+e)+3]/255;if(0===r)continue;const i=(t+f)*c+e+f;if(1===r)g[i]=0,m[i]=Im;else{const t=.5-r;g[i]=t>0?t*t:0,m[i]=t<0?t*t:0}}Sm(g,0,0,c,u,c,this.f,this.v,this.z),Sm(m,f,f,s,l,c,this.f,this.v,this.z);for(let t=0;t<h;t++){const e=Math.sqrt(g[t])-Math.sqrt(m[t]);A[t]=Math.round(255-255*(e/this.radius+this.cutoff))}return p}};const Dm=Cm;function Um(t,e,r,i){const n=[],o=t.imagePrimary,a=o.pixelRatio,s=o.paddedRect.w-2*Dm,l=o.paddedRect.h-2*Dm,c=t.right-t.left,u=t.bottom-t.top,h=o.stretchX||[[0,s]],A=o.stretchY||[[0,l]],p=(t,e)=>t+e[1]-e[0],d=h.reduce(p,0),f=A.reduce(p,0),m=s-d,g=l-f;let _=0,y=d,v=0,x=f,w=0,b=m,B=0,C=g;if(o.content&&i){const t=o.content;_=km(h,0,t[0]),v=km(A,0,t[1]),y=km(h,t[0],t[2]),x=km(A,t[1],t[3]),w=t[0]-_,B=t[1]-v,b=t[2]-t[0]-y,C=t[3]-t[1]-x}const E=(i,n,s,l)=>{const h=Rm(i.stretch-_,y,c,t.left),A=Om(i.fixed-w,b,i.stretch,d),p=Rm(n.stretch-v,x,u,t.top),m=Om(n.fixed-B,C,n.stretch,f),g=Rm(s.stretch-_,y,c,t.left),E=Om(s.fixed-w,b,s.stretch,d),T=Rm(l.stretch-v,x,u,t.top),I=Om(l.fixed-B,C,l.stretch,f),S=new Ne(h,p),M=new Ne(g,p),F=new Ne(g,T),P=new Ne(h,T),L=new Ne(A/a,m/a),D=new Ne(E/a,I/a),U=e*Math.PI/180;if(U){const t=Math.sin(U),e=Math.cos(U),r=[e,-t,t,e];S._matMult(r),M._matMult(r),P._matMult(r),F._matMult(r)}const k=i.stretch+i.fixed,z=s.stretch+s.fixed,R=n.stretch+n.fixed,O=l.stretch+l.fixed,Q=t.imageSecondary;return{tl:S,tr:M,bl:P,br:F,texPrimary:{x:o.paddedRect.x+Dm+k,y:o.paddedRect.y+Dm+R,w:z-k,h:O-R},texSecondary:Q?{x:Q.paddedRect.x+Dm+k,y:Q.paddedRect.y+Dm+R,w:z-k,h:O-R}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:L,pixelOffsetBR:D,minFontScaleX:b/a/c,minFontScaleY:C/a/u,isSDF:r}};if(i&&(o.stretchX||o.stretchY)){const t=zm(h,m,d),e=zm(A,g,f);for(let r=0;r<t.length-1;r++){const i=t[r],o=t[r+1];for(let t=0;t<e.length-1;t++)n.push(E(i,e[t],o,e[t+1]))}}else n.push(E({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:s+1},{fixed:0,stretch:l+1}));return n}function km(t,e,r){let i=0;for(const n of t)i+=Math.max(e,Math.min(r,n[1]))-Math.max(e,Math.min(r,n[0]));return i}function zm(t,e,r){const i=[{fixed:-Dm,stretch:0}];for(const[e,r]of t){const t=i[i.length-1];i.push({fixed:e-t.stretch,stretch:t.stretch}),i.push({fixed:e-t.stretch,stretch:t.stretch+(r-e)})}return i.push({fixed:e+Dm,stretch:r}),i}function Rm(t,e,r,i){return t/e*r+i}function Om(t,e,r,i){return t-e*r/i}function Qm(t,e,r,i){const n=e+t.positionedLines[i].lineOffset;return 0===i?r+n/2:r+(n+(e+t.positionedLines[i-1].lineOffset))/2}function Nm(t,e=1,r=!1){let i=1/0,n=1/0,o=-1/0,a=-1/0;const s=t[0];for(let t=0;t<s.length;t++){const e=s[t];(!t||e.x<i)&&(i=e.x),(!t||e.y<n)&&(n=e.y),(!t||e.x>o)&&(o=e.x),(!t||e.y>a)&&(a=e.y)}const l=Math.min(o-i,a-n);let c=l/2;const u=new ho([],Vm);if(0===l)return new Ne(i,n);for(let e=i;e<o;e+=l)for(let r=n;r<a;r+=l)u.push(new Hm(e+c,r+c,c,t));let h=function(t){let e=0,r=0,i=0;const n=t[0];for(let t=0,o=n.length,a=o-1;t<o;a=t++){const o=n[t],s=n[a],l=o.x*s.y-s.x*o.y;r+=(o.x+s.x)*l,i+=(o.y+s.y)*l,e+=3*l}return new Hm(r/e,i/e,0,t)}(t),A=u.length;for(;u.length;){const i=u.pop();(i.d>h.d||!h.d)&&(h=i,r&&console.log("found best %d after %d probes",Math.round(1e4*i.d)/1e4,A)),i.max-h.d<=e||(c=i.h/2,u.push(new Hm(i.p.x-c,i.p.y-c,c,t)),u.push(new Hm(i.p.x+c,i.p.y-c,c,t)),u.push(new Hm(i.p.x-c,i.p.y+c,c,t)),u.push(new Hm(i.p.x+c,i.p.y+c,c,t)),A+=4)}return r&&(console.log(`num probes: ${A}`),console.log(`best distance: ${h.d}`)),h.p}function Vm(t,e){return e.max-t.max}class Hm{constructor(t,e,r,i){this.p=new Ne(t,e),this.h=r,this.d=function(t,e){let r=!1,i=1/0;for(let n=0;n<e.length;n++){const o=e[n];for(let e=0,n=o.length,a=n-1;e<n;a=e++){const n=o[e],s=o[a];n.y>t.y!=s.y>t.y&&t.x<(s.x-n.x)*(t.y-n.y)/(s.y-n.y)+n.x&&(r=!r),i=Math.min(i,nh(t,n,s))}}return(r?1:-1)*Math.sqrt(i)}(this.p,i),this.max=this.d+this.h*Math.SQRT2}}const jm=Number.POSITIVE_INFINITY,Gm=Math.sqrt(2);function Km(t,[e,r]){let i=0,n=0;if(r===jm){e<0&&(e=0);const r=e/Gm;switch(t){case"top-right":case"top-left":n=r-7;break;case"bottom-right":case"bottom-left":n=7-r;break;case"bottom":n=7-e;break;case"top":n=e-7}switch(t){case"top-right":case"bottom-right":i=-r;break;case"top-left":case"bottom-left":i=r;break;case"left":i=e;break;case"right":i=-e}}else{switch(e=Math.abs(e),r=Math.abs(r),t){case"top-right":case"top-left":case"top":n=r-7;break;case"bottom-right":case"bottom-left":case"bottom":n=7-r}switch(t){case"top-right":case"bottom-right":case"right":i=-e;break;case"top-left":case"bottom-left":case"left":i=e}}return[i,n]}function qm(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Zm(t,e,r,i,n,o,a,s,l,c,u,h,A,p,d){let f=o.textMaxSize.evaluate(e,{},h);void 0===f&&(f=a);const m=t.layers[0].layout,g=m.get("icon-offset").evaluate(e,{},h),_=Ym(r.horizontal)||r.vertical,y="globe"===A.name,v=Of,x=a/v,w=t.tilePixelRatio*f/v,b=(F=t.overscaling,t.zoom>18&&F>2&&(F>>=1),Math.max(Ao/(512*F),1)*m.get("symbol-spacing")),B=m.get("text-padding")*t.tilePixelRatio,C=m.get("icon-padding")*t.tilePixelRatio,E=je(m.get("text-max-angle")),T="map"===m.get("text-rotation-alignment")&&"point"!==m.get("symbol-placement"),I="map"===m.get("icon-rotation-alignment")&&"point"!==m.get("symbol-placement"),S=m.get("symbol-placement"),M=b/2;var F;const P=m.get("icon-text-fit").evaluate(e,{},h),L=m.get("icon-text-fit-padding").evaluate(e,{},h),D="none"!==P;let U;!1===t.hasAnyIconTextFit&&D&&(t.hasAnyIconTextFit=!0),i&&D&&(t.allowVerticalPlacement&&r.vertical&&(U=dm(i,r.vertical,P,L,g,x)),_&&(i=dm(i,_,P,L,g,x)));const k=(a,s,f)=>{if(s.x<0||s.x>=Ao||s.y<0||s.y>=Ao)return;let m=null;if(y){const{x:t,y:e,z:r}=A.projectTilePoint(s.x,s.y,f);m={anchor:new fm(t,e,r,0,void 0),up:A.upVector(f,s.x,s.y)}}!function(t,e,r,i,n,o,a,s,l,c,u,h,A,p,d,f,m,g,_,y,v,x,w,b,B,C,E){const T=t.addToLineVertexArray(e,i);let I,S,M,F,P,L,D,U=0,k=0,z=0,R=0,O=-1,Q=-1;const N={};let V=Fi("");const H=r?r.anchor:e,j="none"!==l.layout.get("icon-text-fit").evaluate(v,{},B);let G=0,K=0;if(void 0===l._unevaluatedLayout.getValue("text-radial-offset")?[G,K]=l.layout.get("text-offset").evaluate(v,{},B).map((t=>t*Of)):(G=l.layout.get("text-radial-offset").evaluate(v,{},B)*Of,K=jm),t.allowVerticalPlacement&&n.vertical){const t=n.vertical;if(d)L=tg(t),s&&(D=tg(s));else{const r=l.layout.get("text-rotate").evaluate(v,{},B)+90;M=Jm(c,H,e,u,h,A,t,p,r,f),s&&(F=Jm(c,H,e,u,h,A,s,g,r))}}if(o){const i=l.layout.get("icon-rotate").evaluate(v,{},B),n=Um(o,i,w,j),a=s?Um(s,i,w,j):void 0;S=Jm(c,H,e,u,h,A,o,g,i),U=4*n.length;const p=t.iconSizeData;let d=null;"source"===p.kind?(d=[Qf*l.layout.get("icon-size").evaluate(v,{},B)],d[0]>Xm&&pr(`${t.layerIds[0]}: Value for "icon-size" is >= ${Wm}. Reduce your "icon-size".`)):"composite"===p.kind&&(d=[Qf*x.compositeIconSizes[0].evaluate(v,{},B),Qf*x.compositeIconSizes[1].evaluate(v,{},B)],(d[0]>Xm||d[1]>Xm)&&pr(`${t.layerIds[0]}: Value for "icon-size" is >= ${Wm}. Reduce your "icon-size".`)),t.addSymbols(t.icon,n,d,y,_,v,!1,r,e,T.lineStartIndex,T.lineLength,-1,b,B,C,E),O=t.icon.placedSymbolArray.length-1,a&&(k=4*a.length,t.addSymbols(t.icon,a,d,y,_,v,tm.vertical,r,e,T.lineStartIndex,T.lineLength,-1,b,B,C,E),Q=t.icon.placedSymbolArray.length-1)}for(const i in n.horizontal){const o=n.horizontal[i];I||(V=Fi(o.text),d?P=tg(o):I=Jm(c,H,e,u,h,A,o,p,l.layout.get("text-rotate").evaluate(v,{},B),f));const s=1===o.positionedLines.length;if(z+=$m(t,r,e,o,a,l,d,v,f,T,n.vertical?tm.horizontal:tm.horizontalOnly,s?Object.keys(n.horizontal):[i],N,O,x,b,B,C),s)break}n.vertical&&(R+=$m(t,r,e,n.vertical,a,l,d,v,f,T,tm.vertical,["vertical"],N,Q,x,b,B,C));let q=-1;const Z=(t,e)=>t?Math.max(t,e):e;q=Z(P,q),q=Z(L,q),q=Z(D,q);const W=q>-1?1:0;t.glyphOffsetArray.length>=65535&&pr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==v.sortKey&&t.addToSortKeyRanges(t.symbolInstances.length,v.sortKey),t.symbolInstances.emplaceBack(e.x,e.y,H.x,H.y,H.z,N.right>=0?N.right:-1,N.center>=0?N.center:-1,N.left>=0?N.left:-1,N.vertical>=0?N.vertical:-1,O,Q,V,void 0!==I?I:t.collisionBoxArray.length,void 0!==I?I+1:t.collisionBoxArray.length,void 0!==M?M:t.collisionBoxArray.length,void 0!==M?M+1:t.collisionBoxArray.length,void 0!==S?S:t.collisionBoxArray.length,void 0!==S?S+1:t.collisionBoxArray.length,F||t.collisionBoxArray.length,F?F+1:t.collisionBoxArray.length,u,z,R,U,k,W,0,G,K,q,0,1,1,j?1:0)}(t,s,m,a,r,i,n,U,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,B,T,l,0,C,I,g,e,o,c,u,h,p,d)};if("line"===S)for(const n of bm(e.geometry,0,0,Ao,Ao)){const e=xm(n,b,E,r.vertical||_,i,v,w,t.overscaling,Ao);for(const r of e)_&&eg(t,_.text,M,r)||k(n,r,h)}else if("line-center"===S){for(const t of e.geometry)if(t.length>1){const e=vm(t,E,r.vertical||_,i,v,w);e&&k(t,e,h)}}else if("Polygon"===e.type)for(const t of qA(e.geometry,0)){const e=Nm(t,16);k(t[0],new fm(e.x,e.y,0,0,void 0),h)}else if("LineString"===e.type)for(const t of e.geometry)k(t,new fm(t[0].x,t[0].y,0,0,void 0),h);else if("Point"===e.type)for(const t of e.geometry)for(const e of t)k([e],new fm(e.x,e.y,0,0,void 0),h)}const Wm=255,Xm=Wm*Qf;function $m(t,e,r,i,n,o,a,s,l,c,u,h,A,p,d,f,m,g){const _=function(t,e,r,i,n,o,a,s){const l=[];if(0===e.positionedLines.length)return l;const c=i.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,u=function(t){const e=t[0],r=t[1],i=e*r;return i>0?[e,-r]:i<0?[-e,r]:0===e?[r,e]:[r,-e]}(r);let h=Math.abs(e.top-e.bottom);for(const t of e.positionedLines)h-=t.lineOffset;const A=e.positionedLines.length,p=h/A;let d=e.top-r[1];for(let t=0;t<A;++t){const i=e.positionedLines[t];d=Qm(e,p,d,t);for(const t of i.positionedGlyphs){if(!t.rect)continue;const i=t.rect||{};let o=Jf+1,h=!0,A=1,p=0;if(t.imageName){const e=a[t.imageName];if(!e)continue;if(e.sdf){pr("SDF images are not supported in formatted text and will be ignored.");continue}h=!1,A=e.pixelRatio,o=Cm/A}const f=(n||s)&&t.vertical,m=t.metrics.advance*t.scale/2,g=t.metrics,_=t.rect;if(null===_)continue;s&&e.verticalizable&&(p=t.imageName?m-t.metrics.width*t.scale/2:0);const y=n?[t.x+m,t.y]:[0,0];let v=[0,0],x=[0,0],w=!1;n||(f?(x=[t.x+m+u[0],t.y+u[1]-p],w=!0):v=[t.x+m+r[0],t.y+r[1]-p]);const b=_.w*t.scale/(A*(t.localGlyph?Fm:1)),B=_.h*t.scale/(A*(t.localGlyph?Fm:1));let C,E,T,I;if(f){const e=t.y-d,r=new Ne(-m,m-e),i=-Math.PI/2,n=new Ne(...x);C=new Ne(-m+v[0],v[1]),C._rotateAround(i,r)._add(n),C.x+=-e+m,C.y-=(g.left-o)*t.scale;const a=t.imageName?g.advance*t.scale:Of*t.scale,s=String.fromCodePoint(t.glyph);qf(s)?C.x+=(1-o)*t.scale:Zf(s)?C.x+=a-g.height*t.scale+(-o-1)*t.scale:C.x+=t.imageName||g.width+2*o===_.w&&g.height+2*o===_.h?(a-B)/2:(a-(g.height+2*o)*t.scale)/2,E=new Ne(C.x,C.y-b),T=new Ne(C.x+B,C.y),I=new Ne(C.x+B,C.y-b)}else{const e=(g.left-o)*t.scale-m+v[0],r=(-g.top-o)*t.scale+v[1],i=e+b,n=r+B;C=new Ne(e,r),E=new Ne(i,r),T=new Ne(e,n),I=new Ne(i,n)}if(c){let t;t=n?new Ne(0,0):w?new Ne(u[0],u[1]):new Ne(r[0],r[1]),C._rotateAround(c,t),E._rotateAround(c,t),T._rotateAround(c,t),I._rotateAround(c,t)}const S=new Ne(0,0),M=new Ne(0,0);l.push({tl:C,tr:E,bl:T,br:I,texPrimary:i,texSecondary:void 0,writingMode:e.writingMode,glyphOffset:y,sectionIndex:t.sectionIndex,isSDF:h,pixelOffsetTL:S,pixelOffsetBR:M,minFontScaleX:0,minFontScaleY:0})}}return l}(0,i,l,o,a,s,n,t.allowVerticalPlacement),y=t.textSizeData;let v=null;"source"===y.kind?(v=[Qf*o.layout.get("text-size").evaluate(s,{},m)],v[0]>Xm&&pr(`${t.layerIds[0]}: Value for "text-size" is >= ${Wm}. Reduce your "text-size".`)):"composite"===y.kind&&(v=[Qf*d.compositeTextSizes[0].evaluate(s,{},m),Qf*d.compositeTextSizes[1].evaluate(s,{},m)],(v[0]>Xm||v[1]>Xm)&&pr(`${t.layerIds[0]}: Value for "text-size" is >= ${Wm}. Reduce your "text-size".`)),t.addSymbols(t.text,_,v,l,a,s,u,e,r,c.lineStartIndex,c.lineLength,p,f,m,g,!1);for(const e of h)A[e]=t.text.placedSymbolArray.length-1;return 4*_.length}function Ym(t){for(const e in t)return t[e];return null}function Jm(t,e,r,i,n,o,a,s,l,c){let u=a.top,h=a.bottom,A=a.left,p=a.right;const d=a.collisionPadding;if(d&&(A-=d[0],u-=d[1],p+=d[2],h+=d[3]),l){const t=new Ne(A,u),e=new Ne(p,u),r=new Ne(A,h),i=new Ne(p,h),n=je(l);let o=new Ne(0,0);c&&(o=new Ne(c[0],c[1])),t._rotateAround(n,o),e._rotateAround(n,o),r._rotateAround(n,o),i._rotateAround(n,o),A=Math.min(t.x,e.x,r.x,i.x),p=Math.max(t.x,e.x,r.x,i.x),u=Math.min(t.y,e.y,r.y,i.y),h=Math.max(t.y,e.y,r.y,i.y)}return t.emplaceBack(e.x,e.y,e.z,r.x,r.y,A,u,p,h,s,i,n,o),t.length-1}function tg(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function eg(t,e,r,i){const n=t.compareText;if(e in n){const t=n[e];for(let e=t.length-1;e>=0;e--)if(i.dist(t[e])<r)return!0}else n[e]=[];return n[e].push(i),!1}function rg(t,e){const r=t.fovAboveCenter,i=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,n=(t._camera.position[2]*t.worldSize-i)/Math.cos(t._pitch),o=Math.sin(r)*n/Math.sin(Math.max(Math.PI/2-t._pitch-r,.01)),a=Math.sin(t._pitch)*o+n;return Math.min(1.01*a,n*(1/t._horizonShift))}function ig(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const r=Math.pow(2,-t.z),i=t.x*r,n=(t.x+1)*r,o=t.y*r,a=(t.y+1)*r,s=Mu(i),l=Mu(n),c=Fu(o),u=Fu(a),h=e.project(s,c),A=e.project(l,c),p=e.project(l,u),d=e.project(s,u);let f=Math.min(h.x,A.x,p.x,d.x),m=Math.min(h.y,A.y,p.y,d.y),g=Math.max(h.x,A.x,p.x,d.x),_=Math.max(h.y,A.y,p.y,d.y);const y=r/16;function v(t,r,i,n,o,a){const s=(i+o)/2,l=(n+a)/2,c=e.project(Mu(s),Fu(l)),u=Math.max(0,f-c.x,m-c.y,c.x-g,c.y-_);f=Math.min(f,c.x),g=Math.max(g,c.x),m=Math.min(m,c.y),_=Math.max(_,c.y),u>y&&(v(t,c,i,n,s,l),v(c,r,s,l,o,a))}v(h,A,i,o,n,o),v(A,p,n,o,n,a),v(p,d,n,a,i,a),v(d,h,i,a,i,o),f-=y,m-=y,g+=y,_+=y;const x=1/Math.max(g-f,_-m);return{scale:x,x:f*x,y:m*x,x2:g*x,y2:_*x,projection:e}}function ng(t,{x:e,y:r},i=0){return new Ne(((e-i)*t.scale-t.x)*Ao,(r*t.scale-t.y)*Ao)}const og=t.ad.identity(new Float32Array(16));class ag{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,e){return{x:0,y:0,z:0}}unproject(t,e){return new fu(0,0)}projectTilePoint(t,e,r){return{x:t,y:e,z:0}}locationPoint(t,e,r=!0){return t._coordinatePoint(t.locationCoordinate(e),r)}pixelsPerMeter(t,e){return Su(1,t)*e}pixelSpaceConversion(t,e,r){return 1}farthestPixelDistance(t){return rg(t,t.pixelsPerMeter)}pointCoordinate(t,e,r,i){const n=t.horizonLineFromTop(!1),o=new Ne(e,Math.max(n,r));return t.rayIntersectionCoordinate(t.pointRayIntersection(o,i))}pointCoordinate3D(t,e,r){const i=new Ne(e,r);if(t.elevation)return t.elevation.pointCoordinate(i);{const e=this.pointCoordinate(t,i.x,i.y,0);return[e.x,e.y,e.z]}}isPointAboveHorizon(t,e){if(t.elevation&&t.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(t,e.x,e.y);const r=t.horizonLineFromTop();return e.y<r}createInversionMatrix(t,e){return og}createTileMatrix(e,r,i){let n,o,a;const s=i.canonical,l=t.ad.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const c=ig(s,this);n=1,o=c.x+i.wrap*c.scale,a=c.y,t.ad.scale(l,l,[n/c.scale,n/c.scale,e.pixelsPerMeter/r])}else n=r/e.zoomScale(s.z),o=(s.x+Math.pow(2,s.z)*i.wrap)*n,a=s.y*n;return t.ad.translate(l,l,[o,a,0]),t.ad.scale(l,l,[n/Ao,n/Ao,1]),l}upVector(t,e,r){return[0,0,1]}upVectorScale(t,e,r){return{metersToTile:1}}}class sg extends ag{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[e,r]=this.parallels=t.parallels||[29.5,45.5],i=Math.sin(je(e));this.n=(i+Math.sin(je(r)))/2,this.c=1+i*(2*this.n-i),this.r0=Math.sqrt(this.c)/this.n}project(t,e){const{n:r,c:i,r0:n}=this,o=je(t-this.center[0]),a=je(e),s=Math.sqrt(i-2*r*Math.sin(a))/r;return{x:s*Math.sin(o*r),y:s*Math.cos(o*r)-n,z:0}}unproject(t,e){const{n:r,c:i,r0:n}=this,o=n+e;let a=Math.atan2(t,Math.abs(o))*Math.sign(o);o*r<0&&(a-=Math.PI*Math.sign(t)*Math.sign(o));const s=je(this.center[0])*r;a=Ye(a,-Math.PI-s,Math.PI-s);const l=Xe(Ge(a/r)+this.center[0],-180,180),c=Math.asin(Xe((i-(t*t+o*o)*r*r)/(2*r),-1,1)),u=Xe(Ge(c),-Lu,Lu);return new fu(l,u)}}const lg=1.340264,cg=-.081106,ug=893e-6,hg=.003796,Ag=Math.sqrt(3)/2;class pg extends ag{project(t,e){e=e/180*Math.PI,t=t/180*Math.PI;const r=Math.asin(Ag*Math.sin(e)),i=r*r,n=i*i*i;return{x:.5*(t*Math.cos(r)/(Ag*(lg+3*cg*i+n*(7*ug+9*hg*i)))/Math.PI+.5),y:1-.5*(r*(lg+cg*i+n*(ug+hg*i))/Math.PI+1),z:0}}unproject(t,e){t=(2*t-.5)*Math.PI;let r=e=(2*(1-e)-1)*Math.PI,i=r*r,n=i*i*i;for(let t,o,a,s=0;s<12&&(o=r*(lg+cg*i+n*(ug+hg*i))-e,a=lg+3*cg*i+n*(7*ug+9*hg*i),t=o/a,r=Xe(r-t,-Math.PI/3,Math.PI/3),i=r*r,n=i*i*i,!(Math.abs(t)<1e-12));++s);const o=Ag*t*(lg+3*cg*i+n*(7*ug+9*hg*i))/Math.cos(r),a=Math.asin(Math.sin(r)/Ag),s=Xe(180*o/Math.PI,-180,180),l=Xe(180*a/Math.PI,-Lu,Lu);return new fu(s,l)}}class dg extends ag{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,e){return{x:.5+t/360,y:.5-e/360,z:0}}unproject(t,e){const r=360*(t-.5),i=Xe(360*(.5-e),-Lu,Lu);return new fu(r,i)}}const fg=Math.PI/2;function mg(t){return Math.tan((fg+t)/2)}class gg extends ag{constructor(t){super(t),this.center=t.center||[0,30];const[e,r]=this.parallels=t.parallels||[30,30];let i=je(e),n=je(r);this.southernCenter=i+n<0,this.southernCenter&&(i=-i,n=-n);const o=Math.cos(i),a=mg(i);this.n=i===n?Math.sin(i):Math.log(o/Math.cos(n))/Math.log(mg(n)/a),this.f=o*Math.pow(mg(i),this.n)/this.n}project(t,e){e=je(e),this.southernCenter&&(e=-e),t=je(t-this.center[0]);const r=1e-6,{n:i,f:n}=this;n>0?e<-fg+r&&(e=-fg+r):e>fg-r&&(e=fg-r);const o=n/Math.pow(mg(e),i);let a=o*Math.sin(i*t),s=n-o*Math.cos(i*t);return a=.5*(a/Math.PI+.5),s=.5*(s/Math.PI+.5),{x:a,y:this.southernCenter?s:1-s,z:0}}unproject(t,e){t=(2*t-.5)*Math.PI,this.southernCenter&&(e=1-e),e=(2*(1-e)-.5)*Math.PI;const{n:r,f:i}=this,n=i-e,o=Math.sign(n),a=Math.sign(r)*Math.sqrt(t*t+n*n);let s=Math.atan2(t,Math.abs(n))*o;n*r<0&&(s-=Math.PI*Math.sign(t)*o);const l=Xe(Ge(s/r)+this.center[0],-180,180),c=Xe(Ge(2*Math.atan(Math.pow(i/a,1/r))-fg),-Lu,Lu);return new fu(l,this.southernCenter?-c:c)}}class _g extends ag{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,e){return{x:Tu(t),y:Iu(e),z:0}}unproject(t,e){const r=Mu(t),i=Fu(e);return new fu(r,i)}}const yg=je(Lu);class vg extends ag{project(t,e){const r=(e=je(e))*e,i=r*r;return{x:.5*((t=je(t))*(.8707-.131979*r+i*(i*(.003971*r-.001529*i)-.013791))/Math.PI+.5),y:1-.5*(e*(1.007226+r*(.015085+i*(.028874*r-.044475-.005916*i)))/Math.PI+1),z:0}}unproject(t,e){t=(2*t-.5)*Math.PI;let r=e=(2*(1-e)-1)*Math.PI,i=25,n=0,o=r*r;do{o=r*r;const t=o*o;n=(r*(1.007226+o*(.015085+t*(.028874*o-.044475-.005916*t)))-e)/(1.007226+o*(.045255+t*(.259866*o-.311325-.005916*11*t))),r=Xe(r-n,-yg,yg)}while(Math.abs(n)>1e-6&&--i>0);o=r*r;const a=Xe(Ge(t/(.8707+o*(o*(o*o*o*(.003971-.001529*o)-.013791)-.131979))),-180,180),s=Ge(r);return new fu(a,s)}}const xg=je(Lu);class wg extends ag{project(t,e){e=je(e),t=je(t);const r=Math.cos(e),i=2/Math.PI,n=Math.acos(r*Math.cos(t/2)),o=Math.sin(n)/n,a=.5*(t*i+2*r*Math.sin(t/2)/o)||0,s=.5*(e+Math.sin(e)/o)||0;return{x:.5*(a/Math.PI+.5),y:1-.5*(s/Math.PI+1),z:0}}unproject(t,e){let r=t=(2*t-.5)*Math.PI,i=e=(2*(1-e)-1)*Math.PI,n=25;const o=1e-6;let a=0,s=0;do{const n=Math.cos(i),o=Math.sin(i),l=2*o*n,c=o*o,u=n*n,h=Math.cos(r/2),A=Math.sin(r/2),p=2*h*A,d=A*A,f=1-u*h*h,m=f?1/f:0,g=f?Math.acos(n*h)*Math.sqrt(1/f):0,_=.5*(2*g*n*A+2*r/Math.PI)-t,y=.5*(g*o+i)-e,v=.5*m*(u*d+g*n*h*c)+1/Math.PI,x=m*(p*l/4-g*o*A),w=.125*m*(l*A-g*o*u*p),b=.5*m*(c*h+g*d*n)+.5,B=x*w-b*v;a=(y*x-_*b)/B,s=(_*w-y*v)/B,r=Xe(r-a,-Math.PI,Math.PI),i=Xe(i-s,-xg,xg)}while((Math.abs(a)>o||Math.abs(s)>o)&&--n>0);return new fu(Ge(r),Ge(i))}}class bg extends ag{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(je(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,e){const{scale:r,cosPhi:i}=this;return{x:je(t)*i*r+.5,y:-Math.sin(je(e))/i*r+.5,z:0}}unproject(t,e){const{scale:r,cosPhi:i}=this,n=-(e-.5)/r,o=Xe(Ge((t-.5)/r)/i,-180,180),a=Math.asin(Xe(n*i,-1,1)),s=Xe(Ge(a),-Lu,Lu);return new fu(o,s)}}class Bg extends _g{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,r,i){const n=Nh(e,r,i),o=jh(Dh(i));return t._.transformMat4(n,n,o),{x:n[0],y:n[1],z:n[2]}}locationPoint(e,r){const i=Au(r.lat,r.lng),n=t._.normalize([],i),o=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(r),e._centerAltitude):e._centerAltitude,a=Su(1,0)*Ao*o;t._.scaleAndAdd(i,i,n,a);const s=t.ad.identity(new Float64Array(16));return t.ad.multiply(s,e.pixelMatrix,e.globeMatrix),t._.transformMat4(i,i,s),new Ne(i[0],i[1])}pixelsPerMeter(t,e){return Su(1,0)*e}pixelSpaceConversion(t,e,r){const i=Su(1,t)*e,n=ji(Su(1,45)*e,i,r);return this.pixelsPerMeter(t,e)/n}createTileMatrix(e,r,i){const n=Gh(Dh(i.canonical));return t.ad.multiply(new Float64Array(16),e.globeMatrix,n)}createInversionMatrix(e,r){const{center:i}=e,n=jh(Dh(r));return t.ad.rotateY(n,n,je(i.lng)),t.ad.rotateX(n,n,je(i.lat)),t.ad.scale(n,n,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(n)}pointCoordinate(t,e,r,i){return Fh(t,e,r,!0)||new Ru(0,0)}pointCoordinate3D(t,e,r){const i=this.pointCoordinate(t,e,r,0);return[i.x,i.y,i.z]}isPointAboveHorizon(t,e){return!Fh(t,e.x,e.y,!1)}farthestPixelDistance(e){const r=function(e,r){const i=e.cameraToCenterDistance,n=e._centerAltitude*r,o=e._camera,a=e._camera.forward(),s=t._.add([],t._.scale([],a,-i),[0,0,n]),l=e.worldSize/(2*Math.PI),c=[0,0,-l],u=e.width/e.height,h=Math.tan(e.fovAboveCenter),A=t._.scale([],o.up(),h),p=t._.scale([],o.right(),h*u),d=t._.normalize([],t._.add([],t._.add([],a,A),p)),f=[];let m;if(new gh(s,d).closestPointOnSphere(c,l,f)){const r=t._.add([],f,c),i=t._.sub([],r,s);m=Math.cos(e.fovAboveCenter)*t._.length(i)}else{const e=t._.sub([],s,c),r=t._.sub([],c,s);t._.normalize(r,r);const i=t._.length(e)-l;m=Math.sqrt(i*(i+2*l));const n=Math.acos(m/(l+i))-Math.acos(t._.dot(a,r));m*=Math.cos(n)}return 1.01*m}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),i=Wh(e.zoom);if(i>0){const t=rg(e,Su(1,e.center.lat)*e.worldSize),n=e.worldSize/(2*Math.PI),o=Math.max(e.width,e.height)/e.worldSize*Math.PI;return ji(r,t+n*(1-Math.cos(o)),Math.pow(i,10))}return r}upVector(t,e,r){return Nh(e,r,t,1)}upVectorScale(t){return{metersToTile:Sh(Vh(Dh(t)))}}}function Cg(t){const e=t.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new _g(t);case"equirectangular":return new dg(t);case"naturalEarth":return new vg(t);case"equalEarth":return new pg(t);case"winkelTripel":return new wg(t);case"albers":return r?new bg(t):new sg(t);case"lambertConformalConic":return r?new bg(t):new gg(t);case"globe":return new Bg(t)}throw new Error(`Invalid projection name: ${t.name}`)}class Eg{constructor(t,e,r,i){this.id=Eg.uniqueIdxCounter,Eg.uniqueIdxCounter++,this.context=t;const n=t.gl;this.buffer=n.createBuffer(),this.dynamicDraw=Boolean(r),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||i||e.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=Eg.uniqueIdxCounter,Eg.uniqueIdxCounter++;const e=this.context.gl;this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Eg.uniqueIdxCounter=0;class Tg{constructor(t,e,r){this.func=t,this.mask=e,this.range=r}}Tg.ReadOnly=!1,Tg.ReadWrite=!0,Tg.disabled=new Tg(519,Tg.ReadOnly,[0,1]);const Ig=7680;class Sg{constructor(t,e,r,i,n,o){this.test=t,this.ref=e,this.mask=r,this.fail=i,this.depthFail=n,this.pass=o}}Sg.disabled=new Sg({func:519,mask:0},0,0,Ig,Ig,Ig);const Mg=771;class Fg{constructor(t,e,r,i){this.blendFunction=t,this.blendColor=e,this.mask=r,this.blendEquation=i}}Fg.Replace=[1,0,1,0],Fg.disabled=new Fg(Fg.Replace,Vi.transparent,[!1,!1,!1,!1]),Fg.unblended=new Fg(Fg.Replace,Vi.transparent,[!0,!0,!0,!0]),Fg.alphaBlended=new Fg([1,Mg,1,Mg],Vi.transparent,[!0,!0,!0,!0]),Fg.alphaBlendedNonPremultiplied=new Fg([770,Mg,770,Mg],Vi.transparent,[!0,!0,!0,!0]),Fg.multiply=new Fg([774,0,774,0],Vi.transparent,[!0,!0,!0,!0]);const Pg=1029,Lg=2305;class Dg{constructor(t,e,r){this.enable=t,this.mode=e,this.frontFace=r}}Dg.disabled=new Dg(!1,Pg,Lg),Dg.backCCW=new Dg(!0,Pg,Lg),Dg.backCW=new Dg(!0,Pg,2304),Dg.frontCW=new Dg(!0,1028,2304),Dg.frontCCW=new Dg(!0,1028,Lg);const Ug=Bp.types,kg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function zg(t,e,r,i,n,o,a,s,l,c,u,h,A){const p=s?Math.min(Xm,Math.round(s[0])):0,d=s?Math.min(Xm,Math.round(s[1])):0;t.emplaceBack(e,r,Math.round(32*i),Math.round(32*n),o,a,(p<<1)+(l?1:0),d,16*c,16*u,256*h,256*A)}function Rg(t,e,r){t.emplaceBack(e,r)}function Og(t,e,r,i,n,o,a){t.emplaceBack(e,r,i,n,o,a)}function Qg(t,e,r,i,n){t.emplaceBack(e,r,i,n),t.emplaceBack(e,r,i,n),t.emplaceBack(e,r,i,n),t.emplaceBack(e,r,i,n)}function Ng(t){for(const e of t.sections)if(ks(e.text))return!0;return!1}class Vg{constructor(t){this.layoutVertexArray=new jl,this.indexArray=new Jl,this.programConfigurations=t,this.segments=new Bc,this.dynamicLayoutVertexArray=new Ol,this.opacityVertexArray=new Kl,this.occlusionQueryOpacityVertexArray=new ql,this.placedSymbolArray=new dc,this.iconTransitioningVertexArray=new Zl,this.globeExtVertexArray=new Gl,this.zOffsetVertexArray=new ql}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(t,e,r,i,n){this.isEmpty()||(r&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Od.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Nd.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,kg,!0),this.occlusionQueryOpacityVertexBuffer=t.createVertexBuffer(this.occlusionQueryOpacityVertexArray,Vd.members,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=t.createVertexBuffer(this.iconTransitioningVertexArray,jd.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,Qd.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||n)&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,Hd.members,!0)),this.opacityVertexBuffer.itemSize=1),(r||i)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.occlusionQueryOpacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}bs(Vg,"SymbolBuffers");class Hg{constructor(t,e,r){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new r,this.segments=new Bc,this.collisionVertexArray=new Yl,this.collisionVertexArrayExt=new Ol}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Gd.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,Kd.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}bs(Hg,"CollisionBuffers");class jg{constructor(e){this.queries=new Map,this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=t.ad.identity([]),this.placementViewportMatrix=t.ad.identity([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Nf(this.zoom,r["text-size"]),this.iconSizeData=Nf(this.zoom,r["icon-size"]);const i=this.layers[0].layout,n=i.get("symbol-sort-key"),o=i.get("symbol-z-order");this.canOverlap=i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==o&&void 0!==n.constantOr(1),this.sortFeaturesByY=("viewport-y"===o||"auto"===o&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=i.get("text-writing-mode").map((t=>tm[t])),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=i.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new Vg(new $c(this.layers,{zoom:this.zoom,lut:this.lut},(t=>/^text/.test(t)))),this.icon=new Vg(new $c(this.layers,{zoom:this.zoom,lut:this.lut},(t=>/^icon/.test(t)))),this.glyphOffsetArray=new gc,this.lineVertexArray=new _c,this.symbolInstances=new mc}calculateGlyphDependencies(t,e,r,i,n){for(let r=0;r<t.length;r++){const o=t.codePointAt(r);if(void 0===o)break;if(e[o]=!0,i&&n&&o<=65535){const i=Kf[t.charAt(r)];i&&(e[i.charCodeAt(0)]=!0)}}}updateFootprints(t,e){}updateReplacement(t,e){if(e.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=e.updateTime;const r=e.getReplacementRegionsForTile(t.toUnwrapped(),!0);return!Lp(this.activeReplacements,r)&&(this.activeReplacements=r,!0)}populate(e,r,i,n){const o=this.layers[0],a=o.layout,s="globe"===this.projection.name,l=a.get("text-font"),c=a.get("text-field"),u=a.get("icon-image"),h=("constant"!==c.value.kind||c.value.value instanceof fn&&!c.value.value.isEmpty()||c.value.value.toString().length>0)&&("constant"!==l.value.kind||l.value.value.length>0),A="constant"!==u.value.kind||!!u.value.value||Object.keys(u.parameters).length>0,p=a.get("symbol-sort-key");if(this.features=[],!h&&!A)return;const d=r.iconDependencies,f=r.glyphDependencies,m=r.availableImages,g=new Ws(this.zoom);for(const{feature:r,id:c,index:u,sourceLayerIndex:_}of e){const e=o._featureFilter.needGeometry,y=qu(r,e);if(!o._featureFilter.filter(g,y,i))continue;if(e||(y.geometry=Ku(r,i,n)),s&&1!==r.type&&i.z<=5){const e=y.geometry,r=.98078528056,n=(e,n)=>{const o=Nh(e.x,e.y,i,1),a=Nh(n.x,n.y,i,1);return t._.dot(o,a)<r};for(let t=0;t<e.length;t++)e[t]=Vu(e[t],n)}let v,x;if(h){const t=o.getValueAndResolveTokens("text-field",y,i,m),e=fn.factory(t);Ng(e)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Ks()||this.hasRTLText&&Zs.isParsed())&&(v=Gf(e,o,y))}if(A){const t=o.getValueAndResolveTokens("icon-image",y,i,m);x=t instanceof mn?t:mn.fromString(t)}if(!v&&!x)continue;const w=this.sortFeaturesByKey?p.evaluate(y,{},i):void 0;if(this.features.push({id:c,text:v,icon:x,index:u,sourceLayerIndex:_,geometry:y.geometry,properties:r.properties,type:Ug[r.type],sortKey:w}),x&&(d[x.namePrimary]=!0,x.nameSecondary&&(d[x.nameSecondary]=!0)),v){const t=l.evaluate(y,{},i).join(","),e="map"===a.get("text-rotation-alignment")&&"point"!==a.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(tm.vertical)>=0;for(const r of v.sections)if(r.image)d[r.image.namePrimary]=!0;else{const i=Ss(v.toString()),n=r.fontStack||t,o=f[n]=f[n]||{};this.calculateGlyphDependencies(r.text,o,e,this.allowVerticalPlacement,i)}}}"line"===a.get("symbol-placement")&&(this.features=function(t){const e={},r={},i=[];let n=0;function o(e){i.push(t[e]),n++}function a(t,e,n){const o=r[t];return delete r[t],r[e]=o,i[o].geometry[0].pop(),i[o].geometry[0]=i[o].geometry[0].concat(n[0]),o}function s(t,r,n){const o=e[r];return delete e[r],e[t]=o,i[o].geometry[0].shift(),i[o].geometry[0]=n[0].concat(i[o].geometry[0]),o}function l(t,e,r){const i=r?e[0][e[0].length-1]:e[0][0];return`${t}:${i.x}:${i.y}`}for(let c=0;c<t.length;c++){const u=t[c],h=u.geometry,A=u.text?u.text.toString():null;if(!A){o(c);continue}const p=l(A,h),d=l(A,h,!0);if(p in r&&d in e&&r[p]!==e[d]){const t=s(p,d,h),n=a(p,d,i[t].geometry);delete e[p],delete r[d],r[l(A,i[n].geometry,!0)]=n,i[t].geometry=null}else p in r?a(p,d,h):d in e?s(p,d,h):(o(c),e[p]=n-1,r[d]=n-1)}return i.filter((t=>t.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((t,e)=>t.sortKey-e.sortKey))}update(t,e,r,i,n){const o=0!==Object.keys(t).length;if(o&&!this.stateDependentLayers.length)return;const a=o?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(t,e,a,r,i,n),this.icon.programConfigurations.updatePaintArrays(t,e,a,r,i,n)}updateOcclusionOpacities(t,e,r){if(!e.useOcclusionQueries)return!1;const i=this;if("globe"===i.projection.name)return!1;let n=!1;i.hasTextData()&&(n=n||0!==i.text.occlusionQueryOpacityVertexArray.length),i.hasIconData()&&(n=n||0!==i.icon.occlusionQueryOpacityVertexArray.length);const o=i.layers[0].paint,a=o.get("icon-occlusion-opacity").constantOr(0),s=o.get("text-occlusion-opacity").constantOr(0);if(!i.layers[0].hasInitialOcclusionOpacityProperties||1===a&&1===s)return!1;let l=!n;for(let t=0;t<i.symbolInstances.length;t++){const n=i.symbolInstances.get(t),o=n.occlusionOpacity;n.occlusionOpacity+=(n.occlusionState>.5?1:-1)*e.fadeSpeed*r*.001,n.occlusionOpacity=Xe(n.occlusionOpacity,0,1),l=l||n.occlusionOpacity!==o}if(!l)return!1;let c=0,u=0;const h=(t,e,r,i)=>{let n=0,o=0;r?(n=u,u+=i,o=u):(n=c,c+=i,o=c),o>e.occlusionQueryOpacityVertexArray.length&&e.occlusionQueryOpacityVertexArray.resize(o);const a=t.occlusionOpacity;for(let t=0;t<i;t++)e.occlusionQueryOpacityVertexArray.emplace(t+n,a)};for(let t=0;t<i.symbolInstances.length;t++){const e=i.symbolInstances.get(t),{numHorizontalGlyphVertices:r,numVerticalGlyphVertices:n,numIconVertices:o}=e,a=o>0;if((r>0||n>0)&&(h(e,i.text,!1,r),h(e,i.text,!1,n)),a){const{placedIconSymbolIndex:t,verticalPlacedIconSymbolIndex:r}=e;t>=0&&h(e,i.icon,!0,o),r>=0&&h(e,i.icon,!0,e.numVerticalIconVertices)}}return i.hasTextData()&&i.text.occlusionQueryOpacityVertexBuffer&&(i.text.occlusionQueryOpacityVertexBuffer.length<i.text.occlusionQueryOpacityVertexArray.length?i.text.occlusionQueryOpacityVertexBuffer=t.createVertexBuffer(i.text.occlusionQueryOpacityVertexArray,Vd.members,!0):i.text.occlusionQueryOpacityVertexBuffer.updateData(i.text.occlusionQueryOpacityVertexArray)),i.hasIconData()&&i.icon.occlusionQueryOpacityVertexBuffer&&(i.icon.occlusionQueryOpacityVertexBuffer.length<i.icon.occlusionQueryOpacityVertexArray.length?i.icon.occlusionQueryOpacityVertexBuffer=t.createVertexBuffer(i.icon.occlusionQueryOpacityVertexArray,Vd.members,!0):i.icon.occlusionQueryOpacityVertexBuffer.updateData(i.icon.occlusionQueryOpacityVertexArray)),!0}updateZOffset(){const t=(t,e,i)=>{r+=e,r>t.length&&t.resize(r);for(let n=-e;n<0;n++)t.emplace(n+r,i)},e=(t,e,r)=>{i+=e,i>t.length&&t.resize(i);for(let n=-e;n<0;n++)t.emplace(n+i,r)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let r=0,i=0;for(let r=0;r<this.symbolInstances.length;r++){const i=this.symbolInstances.get(r),{numHorizontalGlyphVertices:n,numVerticalGlyphVertices:o,numIconVertices:a}=i,s=i.zOffset,l=a>0;if((n>0||o>0)&&(t(this.text.zOffsetVertexArray,n,s),t(this.text.zOffsetVertexArray,o,s)),l){const{placedIconSymbolIndex:t,verticalPlacedIconSymbolIndex:r}=i;t>=0&&e(this.icon.zOffsetVertexArray,a,s),r>=0&&e(this.icon.zOffsetVertexArray,i.numVerticalIconVertices,s)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Cg(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData();for(const t of this.queries.values())t.destroy()}addToLineVertexArray(t,e){const r=this.lineVertexArray.length;if(void 0!==t.segment)for(const{x:t,y:r}of e)this.lineVertexArray.emplaceBack(t,r);return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}}addSymbols(t,e,r,i,n,o,a,s,l,c,u,h,A,p,d,f){const m=t.indexArray,g=t.layoutVertexArray,_=t.globeExtVertexArray,y=t.segments.prepareSegment(4*e.length,g,m,this.canOverlap?o.sortKey:void 0),v=this.glyphOffsetArray.length,x=y.vertexLength,w=this.allowVerticalPlacement&&a===tm.vertical?Math.PI/2:0,b=o.text&&o.text.sections;for(let i=0;i<e.length;i++){const{tl:n,tr:a,bl:c,br:u,texPrimary:h,texSecondary:v,pixelOffsetTL:x,pixelOffsetBR:B,minFontScaleX:C,minFontScaleY:E,glyphOffset:T,isSDF:I,sectionIndex:S}=e[i],M=y.vertexLength,F=T[1];if(zg(g,l.x,l.y,n.x,F+n.y,h.x,h.y,r,I,x.x,x.y,C,E),zg(g,l.x,l.y,a.x,F+a.y,h.x+h.w,h.y,r,I,B.x,x.y,C,E),zg(g,l.x,l.y,c.x,F+c.y,h.x,h.y+h.h,r,I,x.x,B.y,C,E),zg(g,l.x,l.y,u.x,F+u.y,h.x+h.w,h.y+h.h,r,I,B.x,B.y,C,E),s){const{x:e,y:r,z:i}=s.anchor,[n,o,a]=s.up;Og(_,e,r,i,n,o,a),Og(_,e,r,i,n,o,a),Og(_,e,r,i,n,o,a),Og(_,e,r,i,n,o,a),Qg(t.dynamicLayoutVertexArray,e,r,i,w)}else Qg(t.dynamicLayoutVertexArray,l.x,l.y,l.z,w);if(f){const e=v||h;Rg(t.iconTransitioningVertexArray,e.x,e.y),Rg(t.iconTransitioningVertexArray,e.x+e.w,e.y),Rg(t.iconTransitioningVertexArray,e.x,e.y+e.h),Rg(t.iconTransitioningVertexArray,e.x+e.w,e.y+e.h)}m.emplaceBack(M,M+1,M+2),m.emplaceBack(M+1,M+2,M+3),y.vertexLength+=4,y.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(T[0]),i!==e.length-1&&S===e[i+1].sectionIndex||t.programConfigurations.populatePaintArrays(g.length,o,o.index,{},A,p,d,b&&b[S])}const B=s?s.anchor:l;t.placedSymbolArray.emplaceBack(B.x,B.y,B.z,l.x,l.y,v,this.glyphOffsetArray.length-v,x,c,u,l.segment,r?r[0]:0,r?r[1]:0,i[0],i[1],a,0,!1,0,h,0)}_commitLayoutVertex(t,e,r,i,n,o,a){t.emplaceBack(e,r,i,n,o,Math.round(a.x),Math.round(a.y))}_addCollisionDebugVertices(t,e,r,i,n,o,a){const s=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),l=s.vertexLength,c=a.tileAnchorX,u=a.tileAnchorY;for(let t=0;t<4;t++)r.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(r.collisionVertexArrayExt,e,t.padding,a.zOffset),this._commitLayoutVertex(r.layoutVertexArray,i,n,o,c,u,new Ne(t.x1,t.y1)),this._commitLayoutVertex(r.layoutVertexArray,i,n,o,c,u,new Ne(t.x2,t.y1)),this._commitLayoutVertex(r.layoutVertexArray,i,n,o,c,u,new Ne(t.x2,t.y2)),this._commitLayoutVertex(r.layoutVertexArray,i,n,o,c,u,new Ne(t.x1,t.y2)),s.vertexLength+=4;const h=r.indexArray;h.emplaceBack(l,l+1),h.emplaceBack(l+1,l+2),h.emplaceBack(l+2,l+3),h.emplaceBack(l+3,l),s.primitiveLength+=4}_addTextDebugCollisionBoxes(t,e,r,i,n,o){for(let a=i;a<n;a++){const i=r.get(a),n=this.getSymbolInstanceTextSize(t,o,e,a);this._addCollisionDebugVertices(i,n,this.textCollisionBox,i.projectedAnchorX,i.projectedAnchorY,i.projectedAnchorZ,o)}}_addIconDebugCollisionBoxes(t,e,r,i,n,o){for(let a=i;a<n;a++){const i=r.get(a),n=this.getSymbolInstanceIconSize(t,e,o.placedIconSymbolIndex);this._addCollisionDebugVertices(i,n,this.iconCollisionBox,i.projectedAnchorX,i.projectedAnchorY,i.projectedAnchorZ,o)}}generateCollisionDebugBuffers(t,e){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Hg(Xl,qd.members,Zl),this.iconCollisionBox=new Hg(Xl,qd.members,Zl);const r=Hf(this.iconSizeData,t),i=Hf(this.textSizeData,t);for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this._addTextDebugCollisionBoxes(i,t,e,o.textBoxStartIndex,o.textBoxEndIndex,o),this._addTextDebugCollisionBoxes(i,t,e,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._addIconDebugCollisionBoxes(r,t,e,o.iconBoxStartIndex,o.iconBoxEndIndex,o),this._addIconDebugCollisionBoxes(r,t,e,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o)}}getSymbolInstanceTextSize(t,e,r,i){const n=this.text.placedSymbolArray.get(e.rightJustifiedTextSymbolIndex>=0?e.rightJustifiedTextSymbolIndex:e.centerJustifiedTextSymbolIndex>=0?e.centerJustifiedTextSymbolIndex:e.leftJustifiedTextSymbolIndex>=0?e.leftJustifiedTextSymbolIndex:e.verticalPlacedTextSymbolIndex>=0?e.verticalPlacedTextSymbolIndex:i),o=Vf(this.textSizeData,t,n)/Of;return this.tilePixelRatio*o}getSymbolInstanceIconSize(t,e,r){const i=this.icon.placedSymbolArray.get(r),n=Vf(this.iconSizeData,t,i);return this.tilePixelRatio*n}_commitDebugCollisionVertexUpdate(t,e,r,i){t.emplaceBack(e,-r,-r,i),t.emplaceBack(e,r,-r,i),t.emplaceBack(e,r,r,i),t.emplaceBack(e,-r,r,i)}_updateTextDebugCollisionBoxes(t,e,r,i,n,o){for(let a=i;a<n;a++){const i=r.get(a),n=this.getSymbolInstanceTextSize(t,o,e,a);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,n,i.padding,o.zOffset)}}_updateIconDebugCollisionBoxes(t,e,r,i,n,o){for(let a=i;a<n;a++){const i=r.get(a),n=this.getSymbolInstanceIconSize(t,e,o.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,n,i.padding,o.zOffset)}}updateCollisionDebugBuffers(t,e){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const r=Hf(this.iconSizeData,t),i=Hf(this.textSizeData,t);for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this._updateTextDebugCollisionBoxes(i,t,e,o.textBoxStartIndex,o.textBoxEndIndex,o),this._updateTextDebugCollisionBoxes(i,t,e,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._updateIconDebugCollisionBoxes(r,t,e,o.iconBoxStartIndex,o.iconBoxEndIndex,o),this._updateIconDebugCollisionBoxes(r,t,e,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,e,r,i,n,o,a,s,l){const c={};if(e<r){const{x1:r,y1:i,x2:n,y2:o,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:A,featureIndex:p}=t.get(e);c.textBox={x1:r,y1:i,x2:n,y2:o,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:A},c.textFeatureIndex=p}if(i<n){const{x1:e,y1:r,x2:n,y2:o,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:A,featureIndex:p}=t.get(i);c.verticalTextBox={x1:e,y1:r,x2:n,y2:o,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:A},c.verticalTextFeatureIndex=p}if(o<a){const{x1:e,y1:r,x2:i,y2:n,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:A,featureIndex:p}=t.get(o);c.iconBox={x1:e,y1:r,x2:i,y2:n,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:A},c.iconFeatureIndex=p}if(s<l){const{x1:e,y1:r,x2:i,y2:n,padding:o,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:A,featureIndex:p}=t.get(s);c.verticalIconBox={x1:e,y1:r,x2:i,y2:n,padding:o,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:A},c.verticalIconFeatureIndex=p}return c}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,e){const r=t.placedSymbolArray.get(e),i=r.vertexStartIndex+4*r.numGlyphs;for(let e=r.vertexStartIndex;e<i;e+=4)t.indexArray.emplaceBack(e,e+1,e+2),t.indexArray.emplaceBack(e+1,e+2,e+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const e=Math.sin(t),r=Math.cos(t),i=[],n=[],o=[];for(let t=0;t<this.symbolInstances.length;++t){o.push(t);const a=this.symbolInstances.get(t);i.push(0|Math.round(e*a.tileAnchorX+r*a.tileAnchorY)),n.push(a.featureIndex)}return o.sort(((t,e)=>i[t]-i[e]||n[e]-n[t])),o}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let t=0;t<this.symbolInstances.length;++t)this.symbolInstanceIndexesSortedZOffset.push(t)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((t,e)=>this.symbolInstances.get(e).zOffset-this.symbolInstances.get(t).zOffset))}addToSortKeyRanges(t,e){const r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===e?r.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const e=this.symbolInstances.get(t);this.featureSortOrder.push(e.featureIndex);const{rightJustifiedTextSymbolIndex:r,centerJustifiedTextSymbolIndex:i,leftJustifiedTextSymbolIndex:n,verticalPlacedTextSymbolIndex:o,placedIconSymbolIndex:a,verticalPlacedIconSymbolIndex:s}=e;r>=0&&this.addIndicesForPlacedSymbol(this.text,r),i>=0&&i!==r&&this.addIndicesForPlacedSymbol(this.text,i),n>=0&&n!==i&&n!==r&&this.addIndicesForPlacedSymbol(this.text,n),o>=0&&this.addIndicesForPlacedSymbol(this.text,o),a>=0&&this.addIndicesForPlacedSymbol(this.icon,a),s>=0&&this.addIndicesForPlacedSymbol(this.icon,s)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}bs(jg,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),jg.addDynamicAttributes=Qg;class Gg{constructor(t,e,r,i){this.context=t,this.format=r,this.texture=t.gl.createTexture(),this.update(e,i)}update(t,e,r){const{width:i,height:n}=t,{context:o}=this,{gl:a}=o;if(a.bindTexture(a.TEXTURE_2D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(this.format===a.RGBA&&(!e||!1!==e.premultiply)),this.useMipmap=Boolean(e&&e.useMipmap),r||this.size&&this.size[0]===i&&this.size[1]===n){const{x:e,y:o}=r||{x:0,y:0};if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ImageBitmap&&t instanceof ImageBitmap)a.texSubImage2D(a.TEXTURE_2D,0,e,o,a.RGBA,a.UNSIGNED_BYTE,t);else{let r=this.format,s=a.UNSIGNED_BYTE;this.format===a.R32F&&(r=a.RED,s=a.FLOAT),a.texSubImage2D(a.TEXTURE_2D,0,e,o,i,n,r,s,t.data)}}else if(this.size=[i,n],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ImageBitmap&&t instanceof ImageBitmap){let e=this.format;this.format===a.R8&&(e=a.RED),a.texImage2D(a.TEXTURE_2D,0,this.format,e,a.UNSIGNED_BYTE,t)}else{let e=this.format,r=this.format,o=a.UNSIGNED_BYTE,s=!1;this.format===a.DEPTH_COMPONENT&&(e=a.DEPTH_COMPONENT16,o=a.UNSIGNED_SHORT),this.format===a.DEPTH_STENCIL&&(e=a.DEPTH24_STENCIL8,o=a.UNSIGNED_INT_24_8,s=!0),this.format===a.R8&&(r=a.RED),this.format===a.R32F&&(o=a.FLOAT,r=a.RED),!this.useMipmap&&s?a.texStorage2D(a.TEXTURE_2D,1,e,i,n):a.texImage2D(a.TEXTURE_2D,0,e,i,n,0,r,o,t.data)}this.useMipmap&&a.generateMipmap(a.TEXTURE_2D)}bind(t,e,r=!1){const{context:i}=this,{gl:n}=i;n.bindTexture(n.TEXTURE_2D,this.texture),t!==this.minFilter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,this.useMipmap&&!r?t===n.NEAREST?n.NEAREST_MIPMAP_NEAREST:n.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),e!==this.wrapS&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,e),this.wrapS=e)}bindExtraParam(t,e,r,i){const{context:n}=this,{gl:o}=n;o.bindTexture(o.TEXTURE_2D,this.texture),e!==this.magFilter&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,e),this.magFilter=e),t!==this.minFilter&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,this.useMipmap?t===o.NEAREST?o.NEAREST_MIPMAP_NEAREST:o.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),r!==this.wrapS&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,r),this.wrapS=r),i!==this.wrapT&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,i),this.wrapT=i)}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Kg{constructor(t,e){this.context=t,this.texture=e}bind(t,e){const{context:r}=this,{gl:i}=r;i.bindTexture(i.TEXTURE_2D,this.texture),t!==this.minFilter&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,t),this.minFilter=t),e!==this.wrapS&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,e),this.wrapS=e)}}const qg=32,Zg=33,Wg=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,r=0,i=0,n=0,o=0,a=0,s=0;for(1&e?n=o=a=qg:r=i=s=qg;(e>>=1)>1;){const t=r+n>>1,l=i+o>>1;1&e?(n=r,o=i,r=a,i=s):(r=n,i=o,n=a,o=s),a=t,s=l}const l=4*t;Wg[l+0]=r,Wg[l+1]=i,Wg[l+2]=n,Wg[l+3]=o}const Xg=new Uint16Array(2178),$g=new Uint8Array(1089),Yg=new Uint16Array(1089);function Jg(t){return 0===t?-.03125:32===t?.03125:0}var t_=Pl([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),e_=Pl([{name:"a_index",type:"Int16",components:1}]);const r_={type:2,extent:Ao,loadGeometry:()=>[[new Ne(0,0),new Ne(Ao+1,0),new Ne(Ao+1,Ao+1),new Ne(0,Ao+1),new Ne(0,0)]]};class i_{constructor(t,e,r,i,n){this.tileID=t,this.uid=ir(),this.uses=0,this.tileSize=e,this.tileZoom=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=n,i&&i.style&&(this._lastUpdatedBrightness=i.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",i&&i.transform&&(this.projection=i.transform.projection)}registerFadeDuration(t){const e=t+this.timeAdded;e<Lr.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=ig(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,e,r){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,e){const r={};if(!e)return r;for(const i of t){const t=i.layerIds.map((t=>e.getLayer(t))).filter(Boolean);if(0!==t.length){i.layers=t,i.stateDependentLayerIds&&(i.stateDependentLayers=i.stateDependentLayerIds.map((e=>t.filter((t=>t.id===e))[0])));for(const e of t)r[e.fqid]=i}}return r}(t.buckets,e.style),this.hasSymbolBuckets=!1;for(const t in this.buckets){const e=this.buckets[t];if(e instanceof jg){if(this.hasSymbolBuckets=!0,!r)break;e.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const t in this.buckets){const e=this.buckets[t];if(e instanceof jg&&e.hasRTLText){this.hasRTLText=!0,Zs.isLoading()||Zs.isLoaded()||"deferred"!==Ks()||qs();break}}this.queryPadding=0;for(const t in this.buckets){const r=this.buckets[t],i=e.style.getOwnLayer(t);if(!i)continue;const n=i.queryRadius(r);this.queryPadding=Math.max(this.queryPadding,n)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new Ac}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const e in this.buckets){const r=this.buckets[e];r.uploadPending()&&r.upload(t)}const e=t.gl,r=this.imageAtlas;if(r&&!r.uploaded){const i=!!Object.keys(r.patternPositions).length;this.imageAtlasTexture=new Gg(t,r.image,e.RGBA,{useMipmap:i}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new Gg(t,this.glyphAtlasImage,e.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Gg(t,this.lineAtlas.image,e.R8),this.lineAtlas.uploaded=!0)}prepare(t,e,r){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,r),!e||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const i=e.style.getBrightness();(this._lastUpdatedBrightness||i)&&(this._lastUpdatedBrightness&&i&&Math.abs(this._lastUpdatedBrightness-i)<.001||(this._lastUpdatedBrightness=i,this.updateBuckets(void 0,e)))}queryRenderedFeatures(t,e,r,i,n,o,a,s){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:i,pixelPosMatrix:a,transform:o,params:n,tileTransform:this.tileTransform},t,e,r):{}}querySourceFeatures(t,e){const r=this.latestFeatureIndex;if(!r||!r.rawTileData)return;const i=r.loadVTLayers(),n=e?e.sourceLayer:"",o=i._geojsonTileLayer||i[n];if(!o)return;const a=Al(e&&e.filter),{z:s,x:l,y:c}=this.tileID.canonical,u={z:s,x:l,y:c};for(let e=0;e<o.length;e++){const i=o.feature(e);if(a.needGeometry){const t=qu(i,!0);if(!a.filter(new Ws(this.tileID.overscaledZ),t,this.tileID.canonical))continue}else if(!a.filter(new Ws(this.tileID.overscaledZ),i))continue;const h=r.getId(i,n),A=new Df(i,s,l,c,h);A.tile=u,t.push(A)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}bucketsLoaded(){for(const t in this.buckets)if(this.buckets[t].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const e=this.expirationTime;if(t.cacheControl){const e=_r(t.cacheControl);e["max-age"]&&(this.expirationTime=Date.now()+1e3*e["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const t=Date.now();let r=!1;if(this.expirationTime>t)r=!1;else if(e)if(this.expirationTime<e)r=!0;else{const i=this.expirationTime-e;i?this.expirationTime=t+Math.max(i,3e4):r=!0}else r=!0;r?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(t,e){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(t).length&&e&&this.updateBuckets(t,e)}updateBuckets(t,e){if(!this.latestFeatureIndex)return;const r=this.latestFeatureIndex.loadVTLayers(),i=e.style.listImages(),n=e.style.getBrightness();for(const o in this.buckets){if(!e.style.hasLayer(o))continue;const a=this.buckets[o],s=a.layers[0].sourceLayer||"_geojsonTileLayer",l=r[s];let c={};if(t&&(c=t[s],!l||!c||0===Object.keys(c).length))continue;if(a.update(c,l,i,this.imageAtlas&&this.imageAtlas.patternPositions||{},n),a instanceof Jd||a instanceof $A){const t=e.style.getOwnSourceCache(a.layers[0].source);e._terrain&&e._terrain.enabled&&t&&a.programConfigurations.needsUpload&&e._terrain._clearRenderCacheForTile(t.id,this.tileID)}const u=e&&e.style&&e.style.getOwnLayer(o);u&&(this.queryPadding=Math.max(this.queryPadding,u.queryRadius(a)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Lr.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=Lr.now()+t}setTexture(t,e){const r=e.context,i=r.gl;this.texture=this.texture||e.getTileTexture(t.width),this.texture&&this.texture instanceof Gg?this.texture.update(t,{useMipmap:!0}):(this.texture=new Gg(r,t,i.RGBA,{useMipmap:!0}),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE))}setDependencies(t,e){const r={};for(const t of e)r[t]=!0;this.dependencies[t]=r}hasDependency(t,e){for(const r of t){const t=this.dependencies[r];if(t)for(const r of e)if(t[r])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,e){if(!e||"mercator"===e.name||this._tileDebugBuffer)return;const r=Ku(r_,this.tileID.canonical,this.tileTransform)[0],i=new Dl,n=new ac;for(let t=0;t<r.length;t++){const{x:e,y:o}=r[t];i.emplaceBack(e,o),n.emplaceBack(t)}n.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(n),this._tileDebugBuffer=t.createVertexBuffer(i,Ih.members),this._tileDebugSegments=Bc.simpleSegment(0,0,i.length,n.length)}_makeTileBoundsBuffers(t,e){if(this._tileBoundsBuffer||!e||"mercator"===e.name)return;const r=Ku(r_,this.tileID.canonical,this.tileTransform)[0];let i,n;if(this.isRaster){const t=function(t,e){const r=ig(t,e),i=Math.pow(2,t.z);for(let n=0;n<Zg;n++)for(let o=0;o<Zg;o++){const a=Mu((t.x+(o+Jg(o))/qg)/i),s=Fu((t.y+(n+Jg(n))/qg)/i),l=e.project(a,s),c=n*Zg+o;Xg[2*c+0]=Math.round((l.x*r.scale-r.x)*Ao),Xg[2*c+1]=Math.round((l.y*r.scale-r.y)*Ao)}$g.fill(0),Yg.fill(0);for(let t=2045;t>=0;t--){const e=4*t,r=Wg[e+0],i=Wg[e+1],n=Wg[e+2],o=Wg[e+3],a=r+n>>1,s=i+o>>1,l=a+s-i,c=s+r-a,u=i*Zg+r,h=o*Zg+n,A=s*Zg+a,p=Math.hypot((Xg[2*u+0]+Xg[2*h+0])/2-Xg[2*A+0],(Xg[2*u+1]+Xg[2*h+1])/2-Xg[2*A+1])>=16;$g[A]=$g[A]||(p?1:0),t<1022&&($g[A]=$g[A]||$g[(i+c>>1)*Zg+(r+l>>1)]||$g[(o+c>>1)*Zg+(n+l>>1)])}const n=new kl,o=new Jl;let a=0;function s(t,e){const r=e*Zg+t;return 0===Yg[r]&&(n.emplaceBack(Xg[2*r+0],Xg[2*r+1],t*Ao/qg,e*Ao/qg),Yg[r]=++a),Yg[r]-1}function l(t,e,r,i,n,a){const c=t+r>>1,u=e+i>>1;if(Math.abs(t-n)+Math.abs(e-a)>1&&$g[u*Zg+c])l(n,a,t,e,c,u),l(r,i,n,a,c,u);else{const l=s(t,e),c=s(r,i),u=s(n,a);o.emplaceBack(l,c,u)}}return l(0,0,qg,qg,qg,0),l(qg,qg,0,0,0,qg),{vertices:n,indices:o}}(this.tileID.canonical,e);i=t.vertices,n=t.indices}else{i=new kl,n=new Jl;for(const{x:t,y:e}of r)i.emplaceBack(t,e,0,0);const t=wA(i.int16,void 0,4);for(let e=0;e<t.length;e+=3)n.emplaceBack(t[e],t[e+1],t[e+2])}this._tileBoundsBuffer=t.createVertexBuffer(i,t_.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(n),this._tileBoundsSegments=Bc.simpleSegment(0,0,i.length,n.length)}_makeGlobeTileDebugBuffers(e,r){const i=r.projection;if(!i||"globe"!==i.name||r.freezeTileCoverage)return;const n=this.tileID.canonical,o=jh(kh(n,r)),a=Wh(r.zoom);let s;a>0&&(s=t.ad.invert(new Float64Array(16),r.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,n,r,o,s,a),this._makeGlobeTileDebugTextBuffer(e,n,r,o,s,a)}_globePoint(e,r,i,n,o,a,s){let l=Nh(e,r,i);if(a){const o=1<<i.z,c=Tu(n.center.lng),u=Iu(n.center.lat),h=(i.x+.5)/o-c;let A=0;h>.5?A=-1:h<-.5&&(A=1);let p=(e/Ao+i.x)/o+A,d=(r/Ao+i.y)/o;p=(p-c)*n._pixelsPerMercatorPixel+c,d=(d-u)*n._pixelsPerMercatorPixel+u;const f=[p*n.worldSize,d*n.worldSize,0];t._.transformMat4(f,f,a),l=Uh(l,f,s)}return t._.transformMat4(l,l,o)}_makeGlobeTileDebugBorderBuffer(t,e,r,i,n,o){const a=new Dl,s=new ac,l=new Ul,c=(t,c,u,h,A)=>{const p=(u-t)/(A-1),d=(h-c)/(A-1),f=a.length;for(let u=0;u<A;u++){const h=t+u*p,A=c+u*d;a.emplaceBack(h,A);const m=this._globePoint(h,A,e,r,i,n,o);l.emplaceBack(m[0],m[1],m[2]),s.emplaceBack(f+u)}},u=Ao;c(0,0,u,0,16),c(u,0,u,u,16),c(u,u,0,u,16),c(0,u,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(s),this._tileDebugBuffer=t.createVertexBuffer(a,Ih.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(l,Th.members),this._tileDebugSegments=Bc.simpleSegment(0,0,a.length,s.length)}_makeGlobeTileDebugTextBuffer(t,e,r,i,n,o){const a=Ao/4,s=new Dl,l=new Jl,c=new Ul,u=25;l.reserve(32),s.reserve(u),c.reserve(u);const h=(t,e)=>u*t+e;for(let t=0;t<u;t++){const l=t*a;for(let t=0;t<u;t++){const u=t*a;s.emplaceBack(u,l);const h=this._globePoint(u,l,e,r,i,n,o);c.emplaceBack(h[0],h[1],h[2])}}for(let t=0;t<4;t++)for(let e=0;e<4;e++){const r=h(t,e),i=h(t,e+1),n=h(t+1,e),o=h(t+1,e+1);l.emplaceBack(r,i,n),l.emplaceBack(n,i,o)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(l),this._tileDebugTextBuffer=t.createVertexBuffer(s,Ih.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(c,Th.members),this._tileDebugTextSegments=Bc.simpleSegment(0,0,u,32)}destroy(t=!1){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof Gg&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}function n_(t,e,r){1===t?e.header_length=r.readFixed32():2===t?e.x=r.readVarint():3===t?e.y=r.readVarint():4===t?e.z=r.readVarint():5===t&&e.layers.push(function(t,e){return t.readFields(c_,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},e)}(r,r.readVarint()+r.pos))}function o_(t,e,r){1===t?(e.delta_filter=function(t,e){return t.readFields(a_,{block_size:0},e)}(r,r.readVarint()+r.pos),e.filter="delta_filter"):2===t?(r.readVarint(),e.filter="zigzag_filter"):3===t?(r.readVarint(),e.filter="bitshuffle_filter"):4===t&&(r.readVarint(),e.filter="byteshuffle_filter")}function a_(t,e,r){1===t&&(e.block_size=r.readVarint())}function s_(t,e,r){1===t?(r.readVarint(),e.codec="gzip_data"):2===t?(r.readVarint(),e.codec="jpeg_image"):3===t?(r.readVarint(),e.codec="webp_image"):4===t&&(r.readVarint(),e.codec="png_image")}function l_(t,e,r){1===t?e.first_byte=r.readFixed64():2===t?e.last_byte=r.readFixed64():3===t?e.filters.push(function(t,e){return t.readFields(o_,{},e)}(r,r.readVarint()+r.pos)):4===t?e.codec=function(t,e){return t.readFields(s_,{},e)}(r,r.readVarint()+r.pos):5===t?e.offset=r.readFloat():6===t?e.scale=r.readFloat():7===t&&e.bands.push(r.readString())}function c_(t,e,r){1===t?e.version=r.readVarint():2===t?e.name=r.readString():3===t?e.units=r.readString():4===t?e.tilesize=r.readVarint():5===t?e.buffer=r.readVarint():6===t?e.pixel_format=r.readVarint():7===t&&e.data_index.push(function(t,e){return t.readFields(l_,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},e)}(r,r.readVarint()+r.pos))}function u_(t,e,r){if(2===t)!function(t,e,r){t.readFields(h_,r,e)}(r,r.readVarint()+r.pos,e);else if(3===t)throw new Error("Not implemented")}function h_(t,e,r){if(1===t){let t=0;const i=r.readVarint()+r.pos;for(;r.pos<i;)e[t++]=r.readVarint()}}
/**
	 * tiny-lru
	 *
	 * @copyright 2024 Jason Mulligan <jason.mulligan@avoidwork.com>
	 * @license BSD-3-Clause
	 * @version 11.2.11
	 */class A_{constructor(t=0,e=0,r=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=t,this.resetTtl=r,this.size=0,this.ttl=e}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(t){if(this.has(t)){const e=this.items[t];delete this.items[t],this.size--,null!==e.prev&&(e.prev.next=e.next),null!==e.next&&(e.next.prev=e.prev),this.first===e&&(this.first=e.next),this.last===e&&(this.last=e.prev)}return this}entries(t=this.keys()){return t.map((t=>[t,this.get(t)]))}evict(t=!1){if(t||this.size>0){const t=this.first;delete this.items[t.key],0==--this.size?(this.first=null,this.last=null):(this.first=t.next,this.first.prev=null)}return this}expiresAt(t){let e;return this.has(t)&&(e=this.items[t].expiry),e}get(t){let e;if(this.has(t)){const r=this.items[t];this.ttl>0&&r.expiry<=Date.now()?this.delete(t):(e=r.value,this.set(t,e,!0))}return e}has(t){return t in this.items}keys(){const t=[];let e=this.first;for(;null!==e;)t.push(e.key),e=e.next;return t}set(t,e,r=!1,i=this.resetTtl){let n;if(r||this.has(t)){if(n=this.items[t],n.value=e,!1===r&&i&&(n.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==n){const t=this.last,e=n.next,r=n.prev;this.first===n&&(this.first=n.next),n.next=null,n.prev=this.last,t.next=n,null!==r&&(r.next=e),null!==e&&(e.prev=r)}}else this.max>0&&this.size===this.max&&this.evict(!0),n=this.items[t]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:e},1==++this.size?this.first=n:this.last.next=n;return this.last=n,this}values(t=this.keys()){return t.map((t=>this.get(t)))}}function p_(t,e){if(4!==e.length)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let r=e[3];for(let i=2;i>=1;i--){const n=1===i?1:0,o=2===i?1:0;for(let i=0;i<e[0];i++){const a=e[1]*i;for(let i=n;i<e[1];i++){const n=e[2]*(i+a);for(let i=o;i<e[2];i++){const o=e[3]*(i+n);for(let i=0;i<e[3];i++){const e=o+i;t[e]+=t[e-r]}}}}r*=e[i]}return t}function d_(t){for(let e=0,r=t.length;e<r;e++)t[e]=t[e]>>>1^-(1&t[e]);return t}function f_(t,e){switch(e){case"uint32":return t;case"uint16":for(let e=0;e<t.length;e+=2){const r=t[e],i=t[e+1];t[e]=(240&r)>>4|(61440&r)>>8|(240&i)<<4|61440&i,t[e+1]=15&r|(3840&r)>>4|(15&i)<<8|(3840&i)<<4}return t;case"uint8":for(let e=0;e<t.length;e+=4){const r=t[e],i=t[e+1],n=t[e+2],o=t[e+3];t[e+0]=(192&r)>>6|(192&i)>>4|(192&n)>>2|192&o,t[e+1]=(48&r)>>4|(48&i)>>2|48&n|(48&o)<<2,t[e+2]=(12&r)>>2|12&i|(12&n)<<2|(12&o)<<4,t[e+3]=3&r|(3&i)<<2|(3&n)<<4|(3&o)<<6}return t;default:throw new Error(`Invalid pixel format, "${e}"`)}}class m_ extends Error{constructor(t){super(t),this.name="MRTError"}}var g_=Uint8Array,__=Uint16Array,y_=Int32Array,v_=new g_([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),x_=new g_([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),w_=new g_([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),b_=function(t,e){for(var r=new __(31),i=0;i<31;++i)r[i]=e+=1<<t[i-1];var n=new y_(r[30]);for(i=1;i<30;++i)for(var o=r[i];o<r[i+1];++o)n[o]=o-r[i]<<5|i;return{b:r,r:n}},B_=b_(v_,2),C_=B_.b,E_=B_.r;C_[28]=258,E_[258]=28;for(var T_=b_(x_,0).b,I_=new __(32768),S_=0;S_<32768;++S_){var M_=(43690&S_)>>1|(21845&S_)<<1;I_[S_]=((65280&(M_=(61680&(M_=(52428&M_)>>2|(13107&M_)<<2))>>4|(3855&M_)<<4))>>8|(255&M_)<<8)>>1}var F_=function(t,e,r){for(var i=t.length,n=0,o=new __(e);n<i;++n)t[n]&&++o[t[n]-1];var a,s=new __(e);for(n=1;n<e;++n)s[n]=s[n-1]+o[n-1]<<1;if(r){a=new __(1<<e);var l=15-e;for(n=0;n<i;++n)if(t[n])for(var c=n<<4|t[n],u=e-t[n],h=s[t[n]-1]++<<u,A=h|(1<<u)-1;h<=A;++h)a[I_[h]>>l]=c}else for(a=new __(i),n=0;n<i;++n)t[n]&&(a[n]=I_[s[t[n]-1]++]>>15-t[n]);return a},P_=new g_(288);for(S_=0;S_<144;++S_)P_[S_]=8;for(S_=144;S_<256;++S_)P_[S_]=9;for(S_=256;S_<280;++S_)P_[S_]=7;for(S_=280;S_<288;++S_)P_[S_]=8;var L_=new g_(32);for(S_=0;S_<32;++S_)L_[S_]=5;var D_=F_(P_,9,1),U_=F_(L_,5,1),k_=function(t){for(var e=t[0],r=1;r<t.length;++r)t[r]>e&&(e=t[r]);return e},z_=function(t,e,r){var i=e/8|0;return(t[i]|t[i+1]<<8)>>(7&e)&r},R_=function(t,e){var r=e/8|0;return(t[r]|t[r+1]<<8|t[r+2]<<16)>>(7&e)},O_=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Q_=function(t,e,r){var i=new Error(e||O_[t]);if(i.code=t,Error.captureStackTrace&&Error.captureStackTrace(i,Q_),!r)throw i;return i},N_=new g_(0),V_="undefined"!=typeof TextDecoder&&new TextDecoder;try{V_.decode(N_,{stream:!0})}catch(t){}const H_={gzip_data:"gzip"},j_={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},G_={uint32:1,uint16:2,uint8:4},K_={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class q_{constructor(t=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=t}getLayer(t){return this.layers[t]}getHeaderLength(t){const e=new Uint8Array(t),r=new DataView(t);if(13!==e[0])throw new m_("File is not a valid MRT.");return r.getUint32(1,!0)}parseHeader(t){const e=new Uint8Array(t),r=this.getHeaderLength(t);if(e.length<r)throw new m_(`Expected header with length >= ${r} but got buffer of length ${e.length}`);const i=function(t){return t.readFields(n_,{header_length:0,x:0,y:0,z:0,layers:[]},void 0)}(new Pf(e.subarray(0,r)));if(!isNaN(this.x)&&(this.x!==i.x||this.y!==i.y||this.z!==i.z))throw new m_(`Invalid attempt to parse header ${i.z}/${i.x}/${i.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=i.x,this.y=i.y,this.z=i.z;for(const t of i.layers)this.layers[t.name]=new Z_(t,{cacheSize:this._cacheSize});return this}createDecodingTask(t){const e=[],r=this.getLayer(t.layerName);for(let i=0;i<r.dataIndex.length;i++){const n=r.dataIndex[i],o=n.first_byte-t.firstByte,a=n.last_byte+1-t.firstByte;if(i<t.firstBlock||i>t.lastBlock)continue;if(r._blocksInProgress.has(i))continue;const s={layerName:r.name,firstByte:o,lastByte:a,pixelFormat:r.pixelFormat,blockIndex:i,blockShape:[n.bands.length].concat(r.bandShape),buffer:r.buffer,codec:n.codec.codec,filters:n.filters.map((t=>t.filter))};r._blocksInProgress.add(i),e.push(s)}return new W_(e,(()=>{e.forEach((t=>r._blocksInProgress.delete(t.blockIndex)))}),((t,i)=>{if(e.forEach((t=>r._blocksInProgress.delete(t.blockIndex))),t)throw t;i.forEach((t=>{this.getLayer(t.layerName).processDecodedData(t)}))}))}}class Z_{constructor({version:t,name:e,units:r,tilesize:i,pixel_format:n,buffer:o,data_index:a},s){if(this.version=t,1!==this.version)throw new m_(`Cannot parse raster layer encoded with MRT version ${t}`);this.name=e,this.units=r,this.tileSize=i,this.buffer=o,this.pixelFormat=j_[n],this.dataIndex=a,this.bandShape=[i+2*o,i+2*o,G_[this.pixelFormat]],this._decodedBlocks=function(t=1e3,e=0,r=!1){if(isNaN(t)||t<0)throw new TypeError("Invalid max value");if(isNaN(e)||e<0)throw new TypeError("Invalid ttl value");if("boolean"!=typeof r)throw new TypeError("Invalid resetTtl value");return new A_(t,e,r)}(s?s.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(t){const e=t.blockIndex.toString();this._decodedBlocks.get(e)||this._decodedBlocks.set(e,t.data)}getBlockForBand(t){let e=0;switch(typeof t){case"string":for(const[r,i]of this.dataIndex.entries()){for(const[n,o]of i.bands.entries())if(o===t)return{bandIndex:e+n,blockIndex:r,blockBandIndex:n};e+=i.bands.length}break;case"number":for(const[r,i]of this.dataIndex.entries()){if(t>=e&&t<e+i.bands.length)return{bandIndex:t,blockIndex:r,blockBandIndex:t-e};e+=i.bands.length}break;default:throw new m_(`Invalid band \`${JSON.stringify(t)}\`. Expected string or integer.`)}throw new m_(`Band not found: ${JSON.stringify(t)}`)}getDataRange(t){let e=1/0,r=-1/0,i=1/0,n=-1/0;for(const o of t){const{blockIndex:t}=this.getBlockForBand(o);if(t<0)throw new m_(`Invalid band: ${JSON.stringify(o)}`);const a=this.dataIndex[t];i=Math.min(i,t),n=Math.max(n,t),e=Math.min(e,a.first_byte),r=Math.max(r,a.last_byte)}return{layerName:this.name,firstByte:e,lastByte:r,firstBlock:i,lastBlock:n}}hasBand(t){const{blockIndex:e}=this.getBlockForBand(t);return e>=0}hasDataForBand(t){const{blockIndex:e}=this.getBlockForBand(t);return e>=0&&!!this._decodedBlocks.get(e.toString())}getBandView(t){const{blockIndex:e,blockBandIndex:r}=this.getBlockForBand(t),i=this._decodedBlocks.get(e.toString());if(!i)throw new m_(`Data for band ${JSON.stringify(t)} of layer "${this.name}" not decoded.`);const n=this.dataIndex[e],o=this.bandShape.reduce(((t,e)=>t*e),1),a=r*o,s=i.subarray(a,a+o);return{data:s,bytes:new Uint8Array(s.buffer).subarray(s.byteOffset,s.byteOffset+s.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:n.offset,scale:n.scale}}}class W_{constructor(t,e,r){this.tasks=t,this._onCancel=e,this._onComplete=r,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(t,e){this._finalized||(this._onComplete(t,e),this._finalized=!0)}}q_.performDecoding=function(t,e){return Promise.all(e.tasks.map((e=>{const{layerName:r,firstByte:i,lastByte:n,pixelFormat:o,blockShape:a,blockIndex:s,filters:l,codec:c}=e,u=new Uint8Array(t).subarray(i,n+1),h=new Uint32Array(a[0]*a[1]*a[2]);let A;if("gzip_data"!==c)throw new Error(`Unhandled codec: ${c}`);return A=function(t,e){if(!globalThis.DecompressionStream&&"gzip_data"===e)return Promise.resolve(((o=function(t){31==t[0]&&139==t[1]&&8==t[2]||Q_(6,"invalid gzip data");var e=t[3],r=10;4&e&&(r+=2+(t[10]|t[11]<<8));for(var i=(e>>3&1)+(e>>4&1);i>0;i-=!t[r++]);return r+(2&e)}(n=t))+8>n.length&&Q_(6,"invalid gzip data"),function(t,e,r){var i=t.length;if(!i||e.f&&!e.l)return r||new g_(0);var n=!r,o=n||2!=e.i,a=e.i;n&&(r=new g_(3*i));var s,l,c=function(t){var e=r.length;if(t>e){var i=new g_(Math.max(2*e,t));i.set(r),r=i}},u=e.f||0,h=e.p||0,A=e.b||0,p=e.l,d=e.d,f=e.m,m=e.n,g=8*i;do{if(!p){u=z_(t,h,1);var _=z_(t,h+1,3);if(h+=3,!_){var y=t[(M=4+((h+7)/8|0))-4]|t[M-3]<<8,v=M+y;if(v>i){a&&Q_(0);break}o&&c(A+y),r.set(t.subarray(M,v),A),e.b=A+=y,e.p=h=8*v,e.f=u;continue}if(1==_)p=D_,d=U_,f=9,m=5;else if(2==_){var x=z_(t,h,31)+257,w=z_(t,h+10,15)+4,b=x+z_(t,h+5,31)+1;h+=14;for(var B=new g_(b),C=new g_(19),E=0;E<w;++E)C[w_[E]]=z_(t,h+3*E,7);h+=3*w;var T=k_(C),I=(1<<T)-1,S=F_(C,T,1);for(E=0;E<b;){var M,F=S[z_(t,h,I)];if(h+=15&F,(M=F>>4)<16)B[E++]=M;else{var P=0,L=0;for(16==M?(L=3+z_(t,h,3),h+=2,P=B[E-1]):17==M?(L=3+z_(t,h,7),h+=3):18==M&&(L=11+z_(t,h,127),h+=7);L--;)B[E++]=P}}var D=B.subarray(0,x),U=B.subarray(x);f=k_(D),m=k_(U),p=F_(D,f,1),d=F_(U,m,1)}else Q_(1);if(h>g){a&&Q_(0);break}}o&&c(A+131072);for(var k=(1<<f)-1,z=(1<<m)-1,R=h;;R=h){var O=(P=p[R_(t,h)&k])>>4;if((h+=15&P)>g){a&&Q_(0);break}if(P||Q_(2),O<256)r[A++]=O;else{if(256==O){R=h,p=null;break}var Q=O-254;O>264&&(Q=z_(t,h,(1<<(H=v_[E=O-257]))-1)+C_[E],h+=H);var N=d[R_(t,h)&z],V=N>>4;if(N||Q_(3),h+=15&N,U=T_[V],V>3){var H=x_[V];U+=R_(t,h)&(1<<H)-1,h+=H}if(h>g){a&&Q_(0);break}o&&c(A+131072);var j=A+Q;if(A<U){var G=0-U,K=Math.min(U,j);for(G+A<0&&Q_(3);A<K;++A)r[A]=(void 0)[G+A]}for(;A<j;++A)r[A]=r[A-U]}}e.l=p,e.p=R,e.b=A,e.f=u,p&&(u=1,e.m=f,e.d=d,e.n=m)}while(!u);return A!=r.length&&n?(s=r,(null==(l=A)||l>s.length)&&(l=s.length),new g_(s.subarray(0,l))):r.subarray(0,A)}(n.subarray(o,-8),{i:2},new g_(((r=n)[(i=r.length)-4]|r[i-3]<<8|r[i-2]<<16|r[i-1]<<24)>>>0))));var r,i,n,o;const a=H_[e];if(!a)throw new Error(`Unhandled codec: ${e}`);const s=new globalThis.DecompressionStream(a);return new Response(new Blob([t]).stream().pipeThrough(s)).arrayBuffer().then((t=>new Uint8Array(t)))}(u,c).then((t=>(function(t,e){t.readFields(u_,e)}(new Pf(t),h),new K_[o](h.buffer)))),A.then((t=>{for(let e=l.length-1;e>=0;e--)switch(l[e]){case"delta_filter":p_(t,a);break;case"zigzag_filter":d_(t);break;case"bitshuffle_filter":f_(t,o);break;default:throw new Error(`Unhandled filter "${l[e]}"`)}return{layerName:r,blockIndex:s,data:t}})).catch((t=>{throw t}))})))};class X_ extends i_{constructor(t,e,r,i,n){super(t,e,r,i,n),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(t,e){const r=e.context,i=r.gl;this.texture=this.texture||e.getTileTexture(t.width),this.texture&&this.texture instanceof Gg?this.texture.update(t,{useMipmap:!1,premultiply:!1}):this.texture=new Gg(r,t,i.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,e){const r=this._mrt=new q_(30),i=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=ei(i,((i,n,o,a)=>{if(i)e(i);else try{const i=r.getHeaderLength(n);if(i>t)return void(this.request=this.fetchHeader(i,e));r.parseHeader(n),this._isHeaderLoaded=!0;let s=0;for(const t of Object.values(r.layers))s=Math.max(s,t.dataIndex[t.dataIndex.length-1].last_byte);n.byteLength>=s&&(this.entireBuffer=n),e(null,this.entireBuffer||n,o,a)}catch(t){e(t)}})),this.request}fetchBand(t,e,r){const i=this._mrt;if(!this._isHeaderLoaded||!i)return void r(new Error("Tile header is not ready"));const n=this.actor;if(!n)return void r(new Error("Can't fetch tile band without an actor"));let o;const a=(i,n)=>{o.complete(i,n),i?r(i):(this.updateTextureDescriptor(t,e),r(null,this.textureDescriptor&&this.textureDescriptor.img))},s=(t,e)=>{if(t)return r(t);const i=n.send("decodeRasterArray",{buffer:e,task:o},a,void 0,!0);this._workQueue.push((()=>{i&&i.cancel(),o.cancel()}))},l=i.getLayer(t);if(!l)return void r(new Error(`Unknown sourceLayer "${t}"`));if(l.hasDataForBand(e))return this.updateTextureDescriptor(t,e),void r(null,this.textureDescriptor?this.textureDescriptor.img:null);const c=l.getDataRange([e]);if(o=i.createDecodingTask(c),!o||o.tasks.length)if(this.flushQueues(),this.entireBuffer)s(null,this.entireBuffer.slice(c.firstByte,c.lastByte+1));else{const t=Object.assign({},this.requestParams,{headers:{Range:`bytes=${c.firstByte}-${c.lastByte}`}}),e=ei(t,s);this._fetchQueue.push((()=>{e.cancel(),o.cancel()}))}else r(null)}updateNeeded(t,e){return(!this.textureDescriptor||this.textureDescriptor.band!==e||this.textureDescriptor.layer!==t)&&"errored"!==this.state}updateTextureDescriptor(t,e){if(!this._mrt)return;const r=this._mrt.getLayer(t);if(!r||!r.hasBand(e)||!r.hasDataForBand(e))return;const{bytes:i,tileSize:n,buffer:o,offset:a,scale:s}=r.getBandView(e),l=n+2*o,c={data:i,width:l,height:l},u=this.texture;u&&u instanceof Gg&&u.update(c,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:t,band:e,img:c,buffer:o,offset:a,tileSize:n,format:r.pixelFormat,mix:[s,256*s,65536*s,16777216*s]}}}class $_{constructor(t,e){this.max=t,this.onRemove=e,this.reset()}reset(){for(const t in this.data)for(const e of this.data[t])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(t,e,r){const i=t.wrapped().key;void 0===this.data[i]&&(this.data[i]=[]);const n={value:e,timeout:void 0};if(void 0!==r&&(n.timeout=setTimeout((()=>{this.remove(t,n)}),r)),this.data[i].push(n),this.order.push(i),this.order.length>this.max){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value}getByKey(t){const e=this.data[t];return e?e[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,e){if(!this.has(t))return this;const r=t.wrapped().key,i=void 0===e?0:this.data[r].indexOf(e),n=this.data[r][i];return this.data[r].splice(i,1),n.timeout&&clearTimeout(n.timeout),0===this.data[r].length&&delete this.data[r],this.onRemove(n.value),this.order.splice(this.order.indexOf(r),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(t){const e=[];for(const r in this.data)for(const i of this.data[r])t(i.value)||e.push(i);for(const t of e)this.remove(t.value.tileID,t)}}class Y_ extends ki{constructor(t,e,r){super(),this.id=t,this._onlySymbols=r,e.on("data",(t=>{"source"===t.dataType&&"metadata"===t.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))})),e.on("error",(()=>{this._sourceErrored=!0})),this._source=e,this._tiles={},this._cache=new $_(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=e.minTileCacheSize,this._maxTileCacheSize=e.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Uf,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"raster-array"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(t){this.map=t,this._minTileCacheSize=void 0===this._minTileCacheSize&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const t in this._tiles){const e=this._tiles[t];if("errored"!==e.state&&("loaded"!==e.state||!e.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,e){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,e)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const e in this._tiles){const r=this._tiles[e];r.upload(t),r.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return tr(this._tiles).map((t=>t.tileID)).sort(J_).map((t=>t.key))}getRenderableIds(t,e){const r=[];for(const i in this._tiles)this._isIdRenderable(+i,t,e)&&r.push(this._tiles[i]);return t?r.sort(((t,e)=>{const r=t.tileID,i=e.tileID,n=new Ne(r.canonical.x,r.canonical.y)._rotate(this.transform.angle),o=new Ne(i.canonical.x,i.canonical.y)._rotate(this.transform.angle);return r.overscaledZ-i.overscaledZ||o.y-n.y||o.x-n.x})).map((t=>t.tileID.key)):r.map((t=>t.tileID)).sort(J_).map((t=>t.key))}hasRenderableParent(t){const e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)}_isIdRenderable(t,e,r){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())&&(r||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(+t,"reloading")}}_reloadTile(t,e){const r=this._tiles[t];r&&("loading"!==r.state&&(r.state=e),this._loadTile(r,this._tileLoaded.bind(this,r,t,e)))}_tileLoaded(t,e,r,i){if(i)if(t.state="errored",404!==i.status)this._source.fire(new Li(i,{tile:t}));else{if(!(t.tileID.key in this._loadedParentTiles))return void this._source.fire(new Pi("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const t=this.map.painter.terrain;this.update(this.transform,t.getScaledDemTileSize(),!0),t.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=Lr.now(),"expired"===r&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(e,t),"raster-dem"===this._source.type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new Pi("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const e=this.getRenderableIds();for(let i=0;i<e.length;i++){const n=e[i];if(t.neighboringTiles&&t.neighboringTiles[n]){const e=this.getTileByID(n);r(t,e),r(e,t)}}function r(t,e){if(!t.dem||t.dem.borderReady)return;t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0;let r=e.tileID.canonical.x-t.tileID.canonical.x;const i=e.tileID.canonical.y-t.tileID.canonical.y,n=Math.pow(2,t.tileID.canonical.z),o=e.tileID.key;0===r&&0===i||Math.abs(i)>1||(Math.abs(r)>1&&(1===Math.abs(r+n)?r+=n:1===Math.abs(r-n)&&(r-=n)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,r,i),t.neighboringTiles&&t.neighboringTiles[o]&&(t.neighboringTiles[o].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,e,r,i){for(const n in this._tiles){let o=this._tiles[n];if(i[n]||!o.hasData()||o.tileID.overscaledZ<=e||o.tileID.overscaledZ>r)continue;let a=o.tileID;for(;o&&o.tileID.overscaledZ>e+1;){const t=o.tileID.scaledTo(o.tileID.overscaledZ-1);o=this._tiles[t.key],o&&o.hasData()&&(a=t)}let s=a;for(;s.overscaledZ>e;)if(s=s.scaledTo(s.overscaledZ-1),t[s.key]){i[a.key]=a;break}}}findLoadedParent(t,e){if(t.key in this._loadedParentTiles){const r=this._loadedParentTiles[t.key];return r&&r.tileID.overscaledZ>=e?r:null}for(let r=t.overscaledZ-1;r>=e;r--){const e=t.scaledTo(r),i=this._getLoadedTile(e);if(i)return i}}_getLoadedTile(t){const e=this._tiles[t.key];return e&&e.hasData()?e:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,e){e=e||this._source.tileSize;const r=Math.ceil(t.width/e)+1,i=Math.ceil(t.height/e)+1,n=Math.floor(r*i*5),o="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,n):n,a="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,o):o;this._cache.setMaxSize(a)}handleWrapJump(t){const e=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,e){const t={};for(const r in this._tiles){const i=this._tiles[r];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+e),t[i.tileID.key]=i}this._tiles=t;for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t in this._tiles)this._setTileReloadTimer(+t,this._tiles[t])}}update(t,e,r,i){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!r)return;let n;if(this.updateCacheSize(t,e),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain){if(this._source.tileID)n=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((t=>new xu(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y)));else if(0!==this.tileCoverLift){const i=t.clone();i.tileCoverLift=this.tileCoverLift,n=i.coveringTiles({tileSize:e||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!r,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&"globe"===t.projection.name&&(n.push(new xu(1,0,1,0,0)),n.push(new xu(1,0,1,1,0)),n.push(new xu(1,0,1,0,1)),n.push(new xu(1,0,1,1,1)))}else if(n=t.coveringTiles({tileSize:e||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!r,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile){const t=this._source.hasTile.bind(this._source);n=n.filter((e=>t(e)))}}else n=[];if(n.length>0&&this.castsShadows&&i&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!ty(this._source.type)){const o=t.coveringZoomLevel({tileSize:e||this._source.tileSize,roundZoom:this._source.roundZoom&&!r}),a=Math.min(o,this._source.maxzoom),s=t.extendTileCoverForShadows(n,i,a);for(const t of s)this._shadowCasterTiles[t.key]=!0,n.push(t)}const o=this._updateRetainedTiles(n);if(ty(this._source.type)&&0!==n.length){const t={},e={},r=Object.keys(o);for(const i of r){const r=o[i],n=this._tiles[i];if(!n||n.fadeEndTime&&n.fadeEndTime<=Lr.now())continue;const a=this.findLoadedParent(r,Math.max(r.overscaledZ-Y_.maxOverzooming,this._source.minzoom));a&&(this._addTile(a.tileID),t[a.tileID.key]=a.tileID),e[i]=r}const i=n[n.length-1].overscaledZ;for(const t in this._tiles){const r=this._tiles[t];if(o[t]||!r.hasData())continue;let n=r.tileID;for(;n.overscaledZ>i;){n=n.scaledTo(n.overscaledZ-1);const i=this._tiles[n.key];if(i&&i.hasData()&&e[n.key]){o[t]=r.tileID;break}}}for(const e in t)o[e]||(this._coveredTiles[e]=!0,o[e]=t[e])}for(const t in o)this._tiles[t].clearFadeHold();const a=function(t,e){const r=[];for(const i in t)i in e||r.push(i);return r}(this._tiles,o);for(const t of a){const e=this._tiles[t];e.hasSymbolBuckets&&!e.holdingForFade()?e.setHoldDuration(this.map._fadeDuration):e.hasSymbolBuckets&&!e.symbolFadeFinished()||this._removeTile(+t)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const e={};if(0===t.length)return e;const r={},i=t.reduce(((t,e)=>Math.min(t,e.overscaledZ)),1/0),n=t[0].overscaledZ,o=Math.max(n-Y_.maxOverzooming,this._source.minzoom),a=Math.max(n+Y_.maxUnderzooming,this._source.minzoom),s={};for(const r of t){const t=this._addTile(r);e[r.key]=r,t.hasData()||i<this._source.maxzoom&&(s[r.key]=r)}this._retainLoadedChildren(s,i,a,e);for(const i of t){let t=this._tiles[i.key];if(t.hasData())continue;if(i.canonical.z>=this._source.maxzoom){const t=i.children(this._source.maxzoom)[0],r=this.getTile(t);if(r&&r.hasData()){e[t.key]=t;continue}}else{const t=i.children(this._source.maxzoom);if(e[t[0].key]&&e[t[1].key]&&e[t[2].key]&&e[t[3].key])continue}let n=t.wasRequested();for(let a=i.overscaledZ-1;a>=o;--a){const o=i.scaledTo(a);if(r[o.key])break;if(r[o.key]=!0,t=this.getTile(o),!t&&n&&(t=this._addTile(o)),t&&(e[o.key]=o,n=t.wasRequested(),t.hasData()))break}}return e}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const e=[];let r,i=this._tiles[t].tileID;for(;i.overscaledZ>0;){if(i.key in this._loadedParentTiles){r=this._loadedParentTiles[i.key];break}e.push(i.key);const t=i.scaledTo(i.overscaledZ-1);if(r=this._getLoadedTile(t),r)break;i=t}for(const t of e)this._loadedParentTiles[t]=r}}_addTile(t){let e=this._tiles[t.key];if(e)return!0!==e.isExtraShadowCaster||!!this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),e;e=this._cache.getAndRemove(t),e&&(this._setTileReloadTimer(t.key,e),e.tileID=t,this._state.initializeTileState(e,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,e)));const r=Boolean(e);if(!r){const r=this.map?this.map.painter:null,i=this._source.tileSize*t.overscaleFactor();e="raster-array"===this._source.type?new X_(t,i,this.transform.tileZoom,r,this._isRaster):new i_(t,i,this.transform.tileZoom,r,this._isRaster),this._loadTile(e,this._tileLoaded.bind(this,e,t.key,e.state))}return e?(e.uses++,this._tiles[t.key]=e,r||this._source.fire(new Pi("dataloading",{tile:e,coord:e.tileID,dataType:"source"})),e):null}_setTileReloadTimer(t,e){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const r=e.getExpiryTimeout();r&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),r))}_removeTile(t){const e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()&&"reloading"!==e.state||"empty"===e.state?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,e,r){const i=[],n=this.transform;if(!n)return i;const o="globe"===n.projection.name,a=Tu(n.center.lng);for(const s in this._tiles){const l=this._tiles[s];if(r&&l.clearQueryDebugViz(),l.holdingForFade())continue;let c;if(o){const t=l.tileID.canonical;if(0===t.z){const e=[Math.abs(Xe(a,...ey(t,-1))-a),Math.abs(Xe(a,...ey(t,1))-a)];c=[0,2*e.indexOf(Math.min(...e))-1]}else{const e=[Math.abs(Xe(a,...ey(t,-1))-a),Math.abs(Xe(a,...ey(t,0))-a),Math.abs(Xe(a,...ey(t,1))-a)];c=[e.indexOf(Math.min(...e))-1]}}else c=[0];for(const r of c){const o=t.containsTile(l,n,e,r);o&&i.push(o)}}return i}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,e){const r=this.getRenderableIds(t,e).map((t=>this._tiles[t].tileID)),i="globe"===this.transform.projection.name;for(const t of r)t.projMatrix=this.transform.calculateProjMatrix(t.toUnwrapped()),t.expandedProjMatrix=i?this.transform.calculateProjMatrix(t.toUnwrapped(),!1,!0):t.projMatrix;return r}sortCoordinatesByDistance(t){const e=t.slice(),r=this.transform._camera.position,i=this.transform._camera.forward(),n={};for(const t of e){const e=1/(1<<t.canonical.z);n[t.key]=((t.canonical.x+.5)*e+t.wrap-r[0])*i[0]+((t.canonical.y+.5)*e-r[1])*i[1]-r[2]*i[2]}return e.sort(((t,e)=>n[t.key]-n[e.key])),e}hasTransition(){if(this._source.hasTransition())return!0;if(ty(this._source.type))for(const t in this._tiles){const e=this._tiles[t];if(void 0!==e.fadeEndTime&&e.fadeEndTime>=Lr.now())return!0}return!1}setFeatureState(t,e,r){this._state.updateState(t=t||"_geojsonTileLayer",e,r)}removeFeatureState(t,e,r){this._state.removeFeatureState(t=t||"_geojsonTileLayer",e,r)}getFeatureState(t,e){return this._state.getState(t=t||"_geojsonTileLayer",e)}setDependencies(t,e,r){const i=this._tiles[t];i&&i.setDependencies(e,r)}reloadTilesForDependencies(t,e){for(const r in this._tiles)this._tiles[r].hasDependency(t,e)&&this._reloadTile(+r,"reloading");this._cache.filter((r=>!r.hasDependency(t,e)))}_preloadTiles(t,e){if(!this._sourceLoaded){const r=()=>{this._sourceLoaded&&(this._source.off("data",r),this._preloadTiles(t,e))};return void this._source.on("data",r)}const r=new Map,i=Array.isArray(t)?t:[t],n=this.map.painter.terrain,o=this.usedForTerrain&&n?n.getScaledDemTileSize():this._source.tileSize;for(const t of i){const e=t.coveringTiles({tileSize:o,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const t of e)r.set(t.key,t);this.usedForTerrain&&t.updateElevation(!1)}Je(Array.from(r.values()),((t,e)=>{const r=new i_(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(r,(t=>{"raster-dem"===this._source.type&&r.dem&&this._backfillDEM(r),e(t,r)}))}),e)}}function J_(t,e){const r=Math.abs(2*t.wrap)-+(t.wrap<0),i=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||i-r||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function ty(t){return"raster"===t||"image"===t||"video"===t||"custom"===t}function ey(t,e){const r=1<<t.z;return[t.x/r+e,(t.x+1)/r+e]}Y_.maxOverzooming=10,Y_.maxUnderzooming=3;const ry=new class extends ol{possiblyEvaluate(t,e){return e=new Ws(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,r,i){return e=er({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,r,i)}}(rf.paint.properties["line-width"].specification);function iy(t,e){return e>0?e+2*t:t}ry.useIntegerZoom=!0;const ny=new sl({"symbol-placement":new nl(ll.layout_symbol["symbol-placement"]),"symbol-spacing":new nl(ll.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new nl(ll.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ol(ll.layout_symbol["symbol-sort-key"]),"symbol-z-order":new nl(ll.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new nl(ll.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new nl(ll.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new nl(ll.layout_symbol["icon-ignore-placement"]),"icon-optional":new nl(ll.layout_symbol["icon-optional"]),"icon-rotation-alignment":new nl(ll.layout_symbol["icon-rotation-alignment"]),"icon-size":new ol(ll.layout_symbol["icon-size"]),"icon-text-fit":new ol(ll.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ol(ll.layout_symbol["icon-text-fit-padding"]),"icon-image":new ol(ll.layout_symbol["icon-image"]),"icon-rotate":new ol(ll.layout_symbol["icon-rotate"]),"icon-padding":new nl(ll.layout_symbol["icon-padding"]),"icon-keep-upright":new nl(ll.layout_symbol["icon-keep-upright"]),"icon-offset":new ol(ll.layout_symbol["icon-offset"]),"icon-anchor":new ol(ll.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new nl(ll.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new nl(ll.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new nl(ll.layout_symbol["text-rotation-alignment"]),"text-field":new ol(ll.layout_symbol["text-field"]),"text-font":new ol(ll.layout_symbol["text-font"]),"text-size":new ol(ll.layout_symbol["text-size"]),"text-max-width":new ol(ll.layout_symbol["text-max-width"]),"text-line-height":new ol(ll.layout_symbol["text-line-height"]),"text-letter-spacing":new ol(ll.layout_symbol["text-letter-spacing"]),"text-justify":new ol(ll.layout_symbol["text-justify"]),"text-radial-offset":new ol(ll.layout_symbol["text-radial-offset"]),"text-variable-anchor":new nl(ll.layout_symbol["text-variable-anchor"]),"text-anchor":new ol(ll.layout_symbol["text-anchor"]),"text-max-angle":new nl(ll.layout_symbol["text-max-angle"]),"text-writing-mode":new nl(ll.layout_symbol["text-writing-mode"]),"text-rotate":new ol(ll.layout_symbol["text-rotate"]),"text-padding":new nl(ll.layout_symbol["text-padding"]),"text-keep-upright":new nl(ll.layout_symbol["text-keep-upright"]),"text-transform":new ol(ll.layout_symbol["text-transform"]),"text-offset":new ol(ll.layout_symbol["text-offset"]),"text-allow-overlap":new nl(ll.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new nl(ll.layout_symbol["text-ignore-placement"]),"text-optional":new nl(ll.layout_symbol["text-optional"]),visibility:new nl(ll.layout_symbol.visibility)});var oy={paint:new sl({"icon-opacity":new ol(ll.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new ol(ll.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new ol(ll.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new ol(ll.paint_symbol["text-emissive-strength"]),"icon-color":new ol(ll.paint_symbol["icon-color"]),"icon-halo-color":new ol(ll.paint_symbol["icon-halo-color"]),"icon-halo-width":new ol(ll.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ol(ll.paint_symbol["icon-halo-blur"]),"icon-translate":new nl(ll.paint_symbol["icon-translate"]),"icon-translate-anchor":new nl(ll.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new ol(ll.paint_symbol["icon-image-cross-fade"]),"text-opacity":new ol(ll.paint_symbol["text-opacity"]),"text-occlusion-opacity":new ol(ll.paint_symbol["text-occlusion-opacity"]),"text-color":new ol(ll.paint_symbol["text-color"],{runtimeType:tn,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new ol(ll.paint_symbol["text-halo-color"]),"text-halo-width":new ol(ll.paint_symbol["text-halo-width"]),"text-halo-blur":new ol(ll.paint_symbol["text-halo-blur"]),"text-translate":new nl(ll.paint_symbol["text-translate"]),"text-translate-anchor":new nl(ll.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new nl(ll.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new nl(ll.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new nl(ll.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new nl(ll.paint_symbol["icon-color-brightness-max"])}),layout:ny};class ay{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Xi,this.defaultValue=t}evaluate(t){if(t.formattedSection){const e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}bs(ay,"FormatSectionOverride",{omit:["defaultValue"]});class sy extends Il{constructor(e,r,i,n){super(e,oy,r,i,n),this._colorAdjustmentMatrix=t.ad.identity([]),this.hasInitialOcclusionOpacityProperties=void 0!==e.paint&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(t,e){super.recalculate(t,e),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const r=this.layout.get("text-writing-mode");if(r){const t=[];for(const e of r)t.indexOf(e)<0&&t.push(e);this.layout._values["text-writing-mode"]=t}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,r,i,n){return this._saturation===e&&this._contrast===r&&this._brightnessMin===i&&this._brightnessMax===n||(this._colorAdjustmentMatrix=function(e,r,i,n){e=Fr(e),r=Mr(r);const o=t.ad.create(),a=e/3,s=1-2*a,l=[s,a,a,0,a,s,a,0,a,a,s,0,0,0,0,1],c=.5-.5*r,u=n-i;return t.ad.multiply(o,[u,0,0,0,0,u,0,0,0,0,u,0,i,i,i,1],[r,0,0,0,0,r,0,0,0,0,r,0,c,c,c,1]),t.ad.multiply(o,o,l),o}(e,r,i,n),this._saturation=e,this._contrast=r,this._brightnessMin=i,this._brightnessMax=n),this._colorAdjustmentMatrix}getValueAndResolveTokens(t,e,r,i){const n=this.layout.get(t).evaluate(e,{},r,i),o=this._unevaluatedLayout._values[t];return o.isDataDriven()||hs(o.value)||!n?n:function(t,e){return e.replace(/{([^{}]+)}/g,((e,r)=>r in t?String(t[r]):""))}(e.properties,n)}createBucket(t){return new jg(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of oy.paint.overridableProperties){if(!sy.hasPaintOverride(this.layout,t))continue;const e=this.paint.get(t),r=new ay(e),i=new us(r,e.property.specification,this.scope,this.options);let n=null;n="constant"===e.value.kind||"source"===e.value.kind?new ps("source",i):new ds("composite",i,e.value.zoomStops,e.value._interpolationType),this.paint._values[t]=new rl(e.property,n,e.parameters)}}_handleOverridablePaintPropertyUpdate(t,e,r){return!(!this.layout||e.isDataDriven()||r.isDataDriven())&&sy.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,e){const r=t.get("text-field"),i=oy.paint.properties[e];let n=!1;const o=t=>{for(const e of t)if(i.overrides&&i.overrides.hasOverride(e))return void(n=!0)};if("constant"===r.value.kind&&r.value.value instanceof fn)o(r.value.value.sections);else if("source"===r.value.kind){const t=e=>{n||(e instanceof xn&&yn(e.value)===on?o(e.value.sections):e instanceof Cn?o(e.sections):e.eachChild(t))},e=r.value;e._styleExpression&&t(e._styleExpression.expression)}return n}getProgramIds(){const t=0!==this.paint.get("icon-opacity").constantOr(1),e=0!==this.paint.get("text-opacity").constantOr(1),r=[];return t&&r.push("symbolIcon"),e&&r.push("symbolSDF"),r}getDefaultProgramParams(t,e,r){return{config:new Xc(this,{zoom:e,lut:r}),overrideFog:!1}}}const ly=new sl({visibility:new nl(ll.layout_background.visibility)});var cy={paint:new sl({"background-color":new nl(ll.paint_background["background-color"]),"background-pattern":new nl(ll.paint_background["background-pattern"]),"background-opacity":new nl(ll.paint_background["background-opacity"]),"background-emissive-strength":new nl(ll.paint_background["background-emissive-strength"])}),layout:ly};const uy=new sl({visibility:new nl(ll.layout_raster.visibility)});var hy={paint:new sl({"raster-opacity":new nl(ll.paint_raster["raster-opacity"]),"raster-color":new al(ll.paint_raster["raster-color"]),"raster-color-mix":new nl(ll.paint_raster["raster-color-mix"]),"raster-color-range":new nl(ll.paint_raster["raster-color-range"]),"raster-hue-rotate":new nl(ll.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new nl(ll.paint_raster["raster-brightness-min"]),"raster-brightness-max":new nl(ll.paint_raster["raster-brightness-max"]),"raster-saturation":new nl(ll.paint_raster["raster-saturation"]),"raster-contrast":new nl(ll.paint_raster["raster-contrast"]),"raster-resampling":new nl(ll.paint_raster["raster-resampling"]),"raster-fade-duration":new nl(ll.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new nl(ll.paint_raster["raster-emissive-strength"]),"raster-array-band":new nl(ll.paint_raster["raster-array-band"]),"raster-elevation":new nl(ll.paint_raster["raster-elevation"])}),layout:uy};function Ay(e,r,i,n,o,a,s,l){const c=[e,r,1,i,n,1,o,a,1],u=[s,l,1],h=t.bC.adjoint([],c),[A,p,d]=t._.transformMat3(u,u,h);return t.bC.multiply(c,c,[A,0,0,0,p,0,0,0,d])}function py(e,r,i,n,o,a,s,l){const c=function(e,r,i,n,o,a,s,l){const c=Ay(0,0,1,0,1,1,0,1),u=Ay(e,r,i,n,o,a,s,l),h=t.bC.adjoint([],c);return t.bC.multiply(u,u,h)}(e,r,i,n,o,a,s,l);return[c[2]/c[8]/Ao,c[5]/c[8]/Ao]}function dy(t){return[t[0],Math.min(Math.max(t[1],-Lu),Lu)]}class fy extends ki{constructor(t,e,r,i){super(),this.id=t,this.dispatcher=r,this.coordinates=e.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(i),this.options=e,this._dirty=!1}load(t,e){if(this._loaded=e||!1,this.fire(new Pi("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return t&&(this.coordinates=t),this._loaded=!0,void this._finishLoading();this._imageRequest=ai(this.map._requestManager.transformRequest(this.url,$r.Image),((e,r)=>{this._imageRequest=null,this._loaded=!0,e?this.fire(new Li(e)):r&&(this.image=r instanceof HTMLImageElement?Lr.getImageData(r):r,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading())}))}loaded(){return this._loaded}updateImage(t){return t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}setTexture(t){if(!(t.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Kg(this.map.painter.context,t.handle),this.width=t.dimensions[0],this.height=t.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Pi("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(t){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Kg||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(t){if(this.coordinates=t,this._boundsArray=void 0,this._unsupportedCoords=!1,!t.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let e=t[0][1],r=t[0][1];for(const i of t)i[1]>r&&(r=i[1]),i[1]<e&&(e=i[1]);const i=(r+e)/2;if(i>Lu?this.onNorthPole=!0:i<-Lu&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const e=t.map(Ru.fromLngLat);this.tileID=function(t){let e=1/0,r=1/0,i=-1/0,n=-1/0;for(const o of t)e=Math.min(e,o.x),r=Math.min(r,o.y),i=Math.max(i,o.x),n=Math.max(n,o.y);const o=Math.max(i-e,n-r),a=Math.max(0,Math.floor(-Math.log(o)/Math.LN2)),s=Math.pow(2,a);let l=Math.floor((e+i)/2*s);return l>1&&(l-=1),new yu(a,l,Math.floor((r+n)/2*s))}(e),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Pi("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const r=ig(new yu(0,0,0),this.map.transform.projection),i=[r.projection.project(this.coordinates[0][0],this.coordinates[0][1]),r.projection.project(this.coordinates[1][0],this.coordinates[1][1]),r.projection.project(this.coordinates[2][0],this.coordinates[2][1]),r.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(t){const e=t[1].x-t[0].x,r=t[1].y-t[0].y,i=t[2].x-t[1].x,n=t[2].y-t[1].y,o=t[3].x-t[2].x,a=t[3].y-t[2].y,s=t[0].x-t[3].x,l=t[0].y-t[3].y,c=e*n-i*r,u=i*a-o*n,h=o*l-s*a,A=s*r-e*l;return c>0&&u>0&&h>0&&A>0||c<0&&u<0&&h<0&&A<0}(i))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const n=ig(this.tileID,this.map.transform.projection),[o,a,s,l]=this.coordinates.map((t=>{const e=n.projection.project(t[0],t[1]);return ng(n,e)._round()}));this.perspectiveTransform=py(o.x,o.y,a.x,a.y,s.x,s.y,l.x,l.y);const c=this._boundsArray=new kl;c.emplaceBack(o.x,o.y,0,0),c.emplaceBack(a.x,a.y,Ao,0),c.emplaceBack(l.x,l.y,0,Ao),c.emplaceBack(s.x,s.y,Ao,Ao),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(c,t_.members),this.boundsSegments=Bc.simpleSegment(0,0,4,2);const u=[],h=function(t){return[dy(t[0]),dy(t[1]),dy(t[2]),dy(t[3])]}(this.coordinates),[A,p,d,f]=function(t){let e=t[0][0],r=e,i=t[0][1],n=i;for(let o=1;o<t.length;o++)t[o][0]<e?e=t[o][0]:t[o][0]>r&&(r=t[o][0]),t[o][1]<i?i=t[o][1]:t[o][1]>n&&(n=t[o][1]);return[e,i,r-e,n-i]}(h);{const n=new kl,[o,a,s,l]=function(t){let e=t[0].x,r=e,i=t[0].y,n=i;for(let o=1;o<t.length;o++)t[o].x<e?e=t[o].x:t[o].x>r&&(r=t[o].x),t[o].y<i?i=t[o].y:t[o].y>n&&(n=t[o].y);return[e,i,r-e,n-i]}(i),c=t=>[(t.x-o)/s,(t.y-a)/l],[h,m,g,_]=i.map(c),y=function(e,r,i,n,o,a,s,l){const c=Ay(0,0,1,0,1,1,0,1),u=Ay(e,r,i,n,o,a,s,l),h=t.bC.adjoint([],u);return t.bC.multiply(c,c,h)}(h[0],h[1],m[0],m[1],g[0],g[1],_[0],_[1]);this.elevatedGlobePerspectiveTransform=py(h[0],h[1],m[0],m[1],g[0],g[1],_[0],_[1]);const v=(e,r)=>{u.push(e.lng);const i=Math.round((e.lng-A)/d*Ao),o=Math.round((e.lat-p)/f*Ao),a=c(r),s=t._.transformMat3([],[a[0],a[1],1],y),l=Math.round(s[0]/s[2]*Ao),h=Math.round(s[1]/s[2]*Ao);n.emplaceBack(i,o,l,h)},x=i[3].x-i[0].x,w=i[3].y-i[0].y,b=i[2].x-i[1].x,B=i[2].y-i[1].y;for(let t=0;t<65;t++){const e=t/64,n=[i[0].x+e*x,i[0].y+e*w],o=[i[1].x+e*b,i[1].y+e*B],a=o[0]-n[0],s=o[1]-n[1];for(let t=0;t<65;t++){const e=t/64,i={x:n[0]+a*e,y:n[1]+s*e,z:0};v(r.projection.unproject(i.x,i.y),i)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(n,t_.members)}{this.maxLongitudeTriangleSize=0;let t=[],r=new Jl;const i=(e,i,n)=>{r.emplaceBack(e,i,n);const o=u[e],a=u[i],s=u[n],l=Math.min(Math.min(o,a),s),c=Math.max(Math.max(o,a),s)-l;c>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=c),t.push(l+c/2)};for(let t=0;t<64;t++)for(let e=0;e<64;e++){const r=65*t+e,n=r+1,o=r+65,a=o+1;i(r,o,n),i(n,o,a)}[t,r]=function(t,e){const r=Array.from({length:t.length},((t,e)=>e));r.sort(((e,r)=>t[e]-t[r]));const i=[],n=new Jl;for(let o=0;o<r.length;o++){const a=r[o];i.push(t[a]);const s=3*a,l=s+1;n.emplaceBack(e.uint16[s],e.uint16[l],e.uint16[l+1])}return[i,n]}(t,r),this.elevatedGlobeTrianglesCenterLongitudes=t,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(r)}this.elevatedGlobeSegments=Bc.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,d/Ao,0,f/Ao,0,0,p,A,0])}prepare(){const t=0!==Object.keys(this.tiles).length;if(this.tileID&&!t)return;const e=this.map.painter.context,r=e.gl;!this._dirty||this.texture instanceof Kg||(this.texture?this.texture.update(this.image):(this.texture=new Gg(e,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE)),this._dirty=!1),t&&this._prepareData(e)}loadTile(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(t){const e=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!e)return null;const r=this.elevatedGlobeTrianglesCenterLongitudes;let i=(n=t+180)+360*Math.round((r[0]-n)/360);var n;const o=new Bc,a=(t,r)=>{o.segments.push({vertexOffset:0,primitiveOffset:t,vertexLength:e.segments[0].vertexLength,primitiveLength:r,sortKey:void 0,vaos:{}})},s=.51*this.maxLongitudeTriangleSize;if(Math.abs(r[0]-i)<=s){const t=Sr(r,0,r.length,i+s);return t===r.length||a(t,Ir(r,t+1,r.length,i+360-s)-t),o}i<r[0]&&(i+=360);const l=Ir(r,0,r.length,i-s);if(l===r.length)return a(0,r.length),o;a(0,l-0);const c=Sr(r,l+1,r.length,i+s);return c!==r.length&&a(c,r.length-c),o}}const my=(Math.pow(256,2)-1)/16907520;class gy extends Il{constructor(t,e,r,i){super(t,hy,e,r,i),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(t){return!(t&&t._source instanceof fy&&(t._source.onNorthPole||t._source.onSouthPole))&&0===this.paint.get("raster-elevation")}_handleSpecialPaintPropertyUpdate(t){"raster-color"!==t&&"raster-color-range"!==t||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(t){if(!this.hasColorMap())return;if(!this._curRampRange)return;const e=this._transitionablePaint._values["raster-color"].value.expression,[r,i]=t||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(r)&&isNaN(i)||r===this._curRampRange[0]&&i===this._curRampRange[1]||(this.colorRamp=gA({expression:e,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:r,end:i}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[r,i])}}const _y=new sl({visibility:new nl(ll["layout_raster-particle"].visibility)});var yy={paint:new sl({"raster-particle-array-band":new nl(ll["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new nl(ll["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new al(ll["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new nl(ll["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new nl(ll["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new nl(ll["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new nl(ll["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:_y};class vy extends Il{constructor(t,e,r,i){super(t,yy,e,r,i),this._updateColorRamp(),this.lastInvalidatedAt=Lr.now()}onRemove(t){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return"none"!==this.visibility}isDraped(t){return!1}_handleSpecialPaintPropertyUpdate(t){"raster-particle-color"!==t&&"raster-particle-max-speed"!==t||(this._updateColorRamp(),this._invalidateAnimationState()),"raster-particle-count"===t&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const t=this._transitionablePaint._values["raster-particle-color"].value.expression,e=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=gA({expression:t,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:e}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Lr.now()}}class xy extends Il{constructor(t,e){super(t,{},e,null),this.implementation=t,t.slot&&(this.slot=t.slot)}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isDraped(t){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}const wy=new sl({visibility:new nl(ll.layout_sky.visibility)});var by={paint:new sl({"sky-type":new nl(ll.paint_sky["sky-type"]),"sky-atmosphere-sun":new nl(ll.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new nl(ll.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new nl(ll.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new nl(ll.paint_sky["sky-gradient-radius"]),"sky-gradient":new al(ll.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new nl(ll.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new nl(ll.paint_sky["sky-atmosphere-color"]),"sky-opacity":new nl(ll.paint_sky["sky-opacity"])}),layout:wy};function By(e,r,i){const n=[0,0,1],o=t.av.identity([]);return t.av.rotateY(o,o,i?-je(e)+Math.PI:je(e)),t.av.rotateX(o,o,-je(r)),t._.transformQuat(n,n,o),t._.normalize(n,n)}var Cy={paint:new sl({})};function Ey(e,r){const i=Iy(e.projection,e.zoom,e.width,e.height),n=function(e,r,i,n,o){const a=new fu(i.lng-180*Sy,i.lat),s=new fu(i.lng+180*Sy,i.lat),l=e.project(a.lng,a.lat),c=e.project(s.lng,s.lat),u=-Math.atan2(c.y-l.y,c.x-l.x),h=Ru.fromLngLat(i);h.y=Xe(h.y,-1+Sy,1-Sy);const A=h.toLngLat(),p=e.project(A.lng,A.lat),d=Ru.fromLngLat(A);d.x+=Sy;const f=d.toLngLat(),m=e.project(f.lng,f.lat),g=Fy(m.x-p.x,m.y-p.y,u),_=Ru.fromLngLat(A);_.y+=Sy;const y=_.toLngLat(),v=e.project(y.lng,y.lat),x=Fy(v.x-p.x,v.y-p.y,u),w=Math.abs(g.x)/Math.abs(x.y),b=t.ad.identity([]);t.ad.rotateZ(b,b,-u*(1-(o?0:n)));const B=t.ad.identity([]);return t.ad.scale(B,B,[1,1-(1-w)*n,1]),B[4]=-x.x/x.y*n,t.ad.rotateZ(B,B,u),t.ad.multiply(B,b,B),B}(e.projection,0,e.center,i,r),o=Ty(e);return t.ad.scale(n,n,[o,o,1]),n}function Ty(t){const e=t.projection,r=Iy(t.projection,t.zoom,t.width,t.height),i=My(e,t.center),n=My(e,fu.convert(e.center));return Math.pow(2,i*r+(1-r)*n)}function Iy(t,e,r,i,n=1/0){const o=t.range;if(!o)return 0;const a=Math.min(n,Math.max(r,i)),s=Math.log(a/1024)/Math.LN2;return $e(o[0]+s,o[1]+s,e)}const Sy=1/4e4;function My(t,e){const r=Xe(e.lat,-Lu,Lu),i=new fu(e.lng-180*Sy,r),n=new fu(e.lng+180*Sy,r),o=t.project(i.lng,r),a=t.project(n.lng,r),s=Ru.fromLngLat(i),l=Ru.fromLngLat(n),c=a.x-o.x,u=a.y-o.y,h=l.x-s.x,A=l.y-s.y,p=Math.sqrt((h*h+A*A)/(c*c+u*u));return Math.log(p)/Math.LN2}function Fy(t,e,r){const i=Math.cos(r),n=Math.sin(r);return{x:t*i-e*n,y:t*n+e*i}}function Py(e,r,i){t.ad.identity(e),t.ad.rotateZ(e,e,je(r[2])),t.ad.rotateX(e,e,je(r[0])),t.ad.rotateY(e,e,je(r[1])),t.ad.scale(e,e,i),t.ad.multiply(e,e,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Ly(e,r,i,n,o,a,s,l){const c=[i[0]-r[0],i[1]-r[1],0],u=[n[0]-r[0],n[1]-r[1],0];if(t._.length(c)<1e-12||t._.length(u)<1e-12)return t.av.identity(e);const h=t._.cross([],c,u);t._.normalize(h,h),t._.subtract(u,n,r),c[2]=(a-o)*l,u[2]=(s-o)*l;const A=c;return t._.cross(A,c,u),t._.normalize(A,A),t.av.rotationTo(e,h,A)}function Dy(e,r,i=!1){const n=Wh(r.zoom),o=function(e,r,i){const n=r.worldSize,o=[e[12],e[13],e[14]],a=Fu(o[1]/n),s=Mu(o[0]/n),l=t.ad.identity([]),c=Su(1,a)*n,u=Su(1,0)*n*Uu(a,r.zoom),h=1/Kh(n);let A=u*h;if(i){const t=Iy(r.projection,r.zoom,r.width,r.height,1024);A=h*r.projection.pixelSpaceConversion(r.center.lat,n,t)}const p=Au(a,s);t._.add(p,p,t._.scale([],t._.normalize([],p),c*A*o[2]));const d=function(e){const r=[e[0],e[1],e[2]];let i=[0,1,0];const n=t._.cross([],i,r);return t._.cross(i,r,n),0===t._.squaredLength(i)&&(i=[0,1,0],t._.cross(n,r,i)),t._.normalize(n,n),t._.normalize(i,i),t._.normalize(r,r),[n[0],n[1],n[2],0,i[0],i[1],i[2],0,r[0],r[1],r[2],0,e[0],e[1],e[2],1]}(p);t.ad.scale(l,l,[A,A,A*c]),t.ad.translate(l,l,[-o[0],-o[1],-o[2]]);const f=t.ad.multiply([],r.globeMatrix,d);return t.ad.multiply(f,f,l),t.ad.multiply(f,f,e),f}(e,r,i);if(n>0){const i=function(e,r){const i=r.worldSize,n=Su(1,0)*i*Uu(r.center.lat,r.zoom)/Kh(i),o=Su(1,r.center.lat)*i,a=t.ad.identity([]);return t.ad.rotateY(a,a,je(r.center.lng)),t.ad.rotateX(a,a,je(r.center.lat)),t.ad.translate(a,a,[0,0,iu]),t.ad.scale(a,a,[n,n,n*o]),t.ad.translate(a,a,[r.point.x-.5*i,r.point.y-.5*i,0]),t.ad.multiply(a,a,e),t.ad.multiply(a,r.globeMatrix,a)}(e,r);return function(e,r,i){const n=(e,r,i)=>{const n=t._.length(e),o=t._.length(r),a=Uh(e,r,i);return t._.scale(a,a,1/t._.length(a)*ji(n,o,i))},o=n([e[0],e[1],e[2]],[r[0],r[1],r[2]],i),a=n([e[4],e[5],e[6]],[r[4],r[5],r[6]],i),s=n([e[8],e[9],e[10]],[r[8],r[9],r[10]],i),l=Uh([e[12],e[13],e[14]],[r[12],r[13],r[14]],i);return[o[0],o[1],o[2],0,a[0],a[1],a[2],0,s[0],s[1],s[2],0,l[0],l[1],l[2],1]}(o,i,n)}return o}function Uy(t,e,r,i){const n=Bh.projectAabbCorners(i,r);let o=Number.MAX_VALUE,a=-1;for(let t=0;t<n.length;++t){const r=n[t];r[0]=(.5*r[0]+.5)*e.width,r[1]=(.5-.5*r[1])*e.height,r[2]<o&&(a=t,o=r[2])}const s=t=>new Ne(n[t][0],n[t][1]);let l;switch(a){case 0:case 6:l=[s(1),s(5),s(4),s(7),s(3),s(2),s(1)];break;case 1:case 7:l=[s(0),s(4),s(5),s(6),s(2),s(3),s(0)];break;case 3:case 5:l=[s(1),s(0),s(4),s(7),s(6),s(2),s(1)];break;default:l=[s(1),s(5),s(6),s(7),s(3),s(0),s(1)]}if($u(t,l))return o}const ky=Pl([{name:"a_pos_3f",components:3,type:"Float32"}]),zy=Pl([{name:"a_color_3f",components:3,type:"Float32"}]),Ry=Pl([{name:"a_color_4f",components:4,type:"Float32"}]),Oy=Pl([{name:"a_uv_2f",components:2,type:"Float32"}]),Qy=Pl([{name:"a_normal_3f",components:3,type:"Float32"}]),Ny=Pl([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),Vy=Pl([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class Hy{constructor(t,e,r,i){this.message=(t?`${t}: `:"")+r,i&&(this.identifier=i),null!=e&&e.__line__&&(this.line=e.__line__)}}function jy(t,e){const r=-1===t.indexOf("://");try{return new URL(t,r&&e?"http://example.com":void 0),!0}catch(t){return!1}}class Gy{constructor(t,e){this.feature=t,this.instancedDataOffset=e,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Ky{constructor(){this.instancedDataArray=new sc,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class qy{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.projection=t.projection,this.index=t.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(t,e){}populate(t,e,r,i){this.tileToMeter=zu(r);const n=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:o,id:a,index:s,sourceLayerIndex:l}of t){const t=null!=a?a:o.properties&&o.properties.hasOwnProperty("id")?o.properties.id:void 0,c=qu(o,n);if(!this.layers[0]._featureFilter.filter(new Ws(this.zoom),c,r))continue;const u={id:t,sourceLayerIndex:l,index:s,geometry:n?c.geometry:Ku(o,r,i),properties:o.properties,type:o.type,patterns:{}},h=this.addFeature(u,u.geometry,c);h&&e.featureIndex.insert(o,u.geometry,s,l,this.index,this.instancesPerModel[h].instancedDataArray.length,Ao/32)}this.lookup=null}update(t,e,r,i){for(const e in this.instancesPerModel){const r=this.instancesPerModel[e];for(const e in t)r.idToFeaturesIndex.hasOwnProperty(e)&&(this.evaluate(r.features[r.idToFeaturesIndex[e]],t[e],r,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const r in this.instancesPerModel){const i=this.instancesPerModel[r];for(const r of i.features){const n=this.layers[0],o=r.feature,a=this.canonical,s=n.paint.get("model-rotation").evaluate(o,{},a),l=n.paint.get("model-scale").evaluate(o,{},a),c=n.paint.get("model-translation").evaluate(o,{},a);t._.exactEquals(r.rotation,s)&&t._.exactEquals(r.scale,l)&&t._.exactEquals(r.translation,c)||(this.evaluate(r,r.featureStates,i,!0),e=!0)}}return e}updateReplacement(t,e,r){if(e.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=e.updateTime;const i=e.getReplacementRegionsForTile(t.toUnwrapped(),!0);if(Lp(this.activeReplacements,i))return!1;this.activeReplacements=i;let n=!1;for(const e in this.instancesPerModel){const i=this.instancesPerModel[e],o=i.instancedDataArray;for(const e of i.features){const i=e.instancedDataOffset,a=e.instancedDataCount;for(let e=0;e<a;e++){const a=16*(e+i);let s=o.float32[a+0];s=s>Ao?s-Ao:s;const l=Math.floor(s),c=o.float32[a+1];let u=!1;for(const e of this.activeReplacements)if(!(e.order<r||e.order===1/0)&&e.clipMask&Jp.Model&&!(e.min.x>l||l>e.max.x||e.min.y>c||c>e.max.y)&&(u=Op(Rp(l,c,t.canonical,e.footprintTileId.canonical),e),u))break;o.float32[a]=u?s+Ao:s,n=n||u}}}return n}isEmpty(){for(const t in this.instancesPerModel)if(0!==this.instancesPerModel[t].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(t){if(!this.uploaded)for(const e in this.instancesPerModel){const r=this.instancesPerModel[e];r.instancedDataArray.length<0||0===r.instancedDataArray.length||(r.instancedDataBuffer?r.instancedDataBuffer.updateData(r.instancedDataArray):r.instancedDataBuffer=t.createVertexBuffer(r.instancedDataArray,Ny.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const t in this.instancesPerModel){const e=this.instancesPerModel[t];0!==e.instancedDataArray.length&&e.instancedDataBuffer&&e.instancedDataBuffer.destroy()}const t=this.layers[0].modelManager;if(t&&this.modelUris)for(const e of this.modelUris)t.removeModel(e,"")}addFeature(t,e,r){const i=this.layers[0],n=i.layout.get("model-id").evaluate(r,{},this.canonical);if(!n)return pr(`modelId is not evaluated for layer ${i.id} and it is not going to get rendered.`),n;jy(n,!1)&&(this.modelUris.includes(n)||this.modelUris.push(n)),this.instancesPerModel[n]||(this.instancesPerModel[n]=new Ky);const o=this.instancesPerModel[n],a=o.instancedDataArray,s=new Gy(r,a.length);for(const t of e)for(const e of t){if(e.x<0||e.x>=Ao||e.y<0||e.y>=Ao)continue;const t=(this.lookupDim-1)/Ao,r=this.lookupDim*(e.y*t|0)+e.x*t|0;if(this.lookup){if(0!==this.lookup[r])continue;this.lookup[r]=1}this.instanceCount++;const i=a.length;a.resize(i+1),o.instancesEvaluatedElevation.push(0),a.float32[16*i]=e.x,a.float32[16*i+1]=e.y}return s.instancedDataCount=o.instancedDataArray.length-s.instancedDataOffset,s.instancedDataCount>0&&(t.id&&(o.idToFeaturesIndex[t.id]=o.features.length),o.features.push(s),this.evaluate(s,{},o,!1)),n}getModelUris(){return this.modelUris}evaluate(t,e,r,i){const n=this.layers[0],o=t.feature,a=this.canonical,s=t.rotation=n.paint.get("model-rotation").evaluate(o,e,a),l=t.scale=n.paint.get("model-scale").evaluate(o,e,a),c=t.translation=n.paint.get("model-translation").evaluate(o,e,a),u=n.paint.get("model-color").evaluate(o,e,a);u.a=n.paint.get("model-color-mix-intensity").evaluate(o,e,a);const h=[];this.maxVerticalOffset<c[2]&&(this.maxVerticalOffset=c[2]),this.maxScale=Math.max(Math.max(this.maxScale,l[0]),Math.max(l[1],l[2])),Py(h,s,l);const A=Math.round(100*u.a)+u.b/1.05;for(let e=0;e<t.instancedDataCount;++e){const n=t.instancedDataOffset+e,o=16*n,s=r.instancedDataArray.float32;let l=0;i&&(l=s[o+6]-r.instancesEvaluatedElevation[n]);const p=0|s[o+1];s[o]=(0|s[o])+u.r/1.05,s[o+1]=p+u.g/1.05,s[o+2]=A,s[o+3]=1/(a.z>10?this.tileToMeter:zu(a,p)),s[o+4]=c[0],s[o+5]=c[1],s[o+6]=c[2]+l,s[o+7]=h[0],s[o+8]=h[1],s[o+9]=h[2],s[o+10]=h[4],s[o+11]=h[5],s[o+12]=h[6],s[o+13]=h[8],s[o+14]=h[9],s[o+15]=h[10],r.instancesEvaluatedElevation[n]=c[2]}}}bs(qy,"ModelBucket",{omit:["layers"]}),bs(Ky,"PerModelAttributes"),bs(Gy,"ModelFeature");const Zy=new sl({visibility:new nl(ll.layout_model.visibility),"model-id":new ol(ll.layout_model["model-id"])});var Wy={paint:new sl({"model-opacity":new nl(ll.paint_model["model-opacity"]),"model-rotation":new ol(ll.paint_model["model-rotation"]),"model-scale":new ol(ll.paint_model["model-scale"]),"model-translation":new ol(ll.paint_model["model-translation"]),"model-color":new ol(ll.paint_model["model-color"]),"model-color-mix-intensity":new ol(ll.paint_model["model-color-mix-intensity"]),"model-type":new nl(ll.paint_model["model-type"]),"model-cast-shadows":new nl(ll.paint_model["model-cast-shadows"]),"model-receive-shadows":new nl(ll.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new nl(ll.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new ol(ll.paint_model["model-emissive-strength"]),"model-roughness":new ol(ll.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new ol(ll.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new nl(ll.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new nl(ll.paint_model["model-front-cutoff"])}),layout:Zy};const Xy=64,$y={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Yy(e,r,i,n,o,a,s,l,c,u=!1){const h=i.zoom,A=i.project(n),p=Uu(n.lat,h),d=1/p;t.ad.identity(e),t.ad.translate(e,e,[A.x+s[0]*d,A.y+s[1]*d,s[2]]);let f=1,m=1;const g=i.worldSize;if(u){if("mercator"===i.projection.name){let e=0;i.elevation&&(e=i.elevation.getAtPointOrZero(new Ru(A.x/g,A.y/g),0));const r=t.aA.transformMat4([],[A.x,A.y,e,1],i.projMatrix)[3]/i.cameraToCenterDistance;f=r,m=r*Uu(i.center.lat,h)}else if("globe"===i.projection.name){const r=Dy(e,i),o=t.ad.multiply([],i.projMatrix,r),a=[0,0,0,1];t.aA.transformMat4(a,a,o);const s=a[3]/i.cameraToCenterDistance,l=Wh(h),c=i.projection.pixelsPerMeter(n.lat,g)*Uu(n.lat,h),u=i.projection.pixelsPerMeter(i.center.lat,g)*Uu(i.center.lat,h);f=s/ji(c,Du(i.center.lat),l),m=s*p/c,f*=u,m*=u}}else f=d;t.ad.scale(e,e,[f,f,m]);const _=[...e],y=r.orientation,v=[];if(Py(v,[y[0]+o[0],y[1]+o[1],y[2]+o[2]],a),t.ad.multiply(e,_,v),l&&i.elevation){let o=0;const a=[];if(c&&i.elevation){o=function(e,r,i,n,o){const a=r.elevation;if(!a)return 0;const s=Bh.projectAabbCorners(i,n),l=Su(1,o.lat)*r.worldSize,c=function(e,r){const i=[0,0,1],n=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const o of n){const n=e[o.corners[0]],a=e[o.corners[1]],s=e[o.corners[2]],l=[a[0]-n[0],a[1]-n[1],r*(a[2]-n[2])],c=t._.cross(l,l,[s[0]-n[0],s[1]-n[1],r*(s[2]-n[2])]);t._.normalize(c,c),o.dotProductWithUp=t._.dot(c,i)}return n.sort(((t,e)=>t.dotProductWithUp-e.dotProductWithUp)),n[0].corners}(s,l),u=s[c[0]],h=s[c[1]],A=s[c[2]],p=s[c[3]],d=a.getAtPointOrZero(new Ru(u[0]/r.worldSize,u[1]/r.worldSize),0),f=a.getAtPointOrZero(new Ru(h[0]/r.worldSize,h[1]/r.worldSize),0),m=a.getAtPointOrZero(new Ru(A[0]/r.worldSize,A[1]/r.worldSize),0),g=a.getAtPointOrZero(new Ru(p[0]/r.worldSize,p[1]/r.worldSize),0),_=(d+g)/2,y=(f+m)/2;return _>y?f<m?Ly(e,h,p,u,f,g,d,l):Ly(e,A,u,p,m,d,g,l):d<g?Ly(e,u,h,A,d,f,m,l):Ly(e,p,A,h,g,m,f,l),Math.max(_,y)}(a,i,r.aabb,e,n);const s=t.ad.fromQuat([],a),l=t.ad.multiply([],s,v);t.ad.multiply(e,_,l)}else o=i.elevation.getAtPointOrZero(new Ru(A.x/g,A.y/g),0);0!==o&&(e[14]+=o)}}function Jy(t,e,r=!1){t.uploaded||(t.gfxTexture=new Gg(e,t.image,r?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function tv(t,e,r){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,ky.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,Qy.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,Oy.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(12===t.colorArray.bytesPerElement?zy:Ry).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,Vy.members,!0)),t.segments=Bc.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);const i=t.material;i.pbrMetallicRoughness.baseColorTexture&&Jy(i.pbrMetallicRoughness.baseColorTexture,e),i.pbrMetallicRoughness.metallicRoughnessTexture&&Jy(i.pbrMetallicRoughness.metallicRoughnessTexture,e),i.normalTexture&&Jy(i.normalTexture,e),i.occlusionTexture&&Jy(i.occlusionTexture,e,r),i.emissionTexture&&Jy(i.emissionTexture,e)}function ev(t,e,r){if(t.meshes)for(const i of t.meshes)tv(i,e,r);if(t.children)for(const i of t.children)ev(i,e,r)}function rv(t){if(t.meshes)for(const e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(const e of t.children)rv(e)}function iv(t){if(t.meshes)for(const r of t.meshes)r.vertexBuffer&&(r.vertexBuffer.destroy(),r.indexBuffer.destroy(),r.normalBuffer&&r.normalBuffer.destroy(),r.texcoordBuffer&&r.texcoordBuffer.destroy(),r.colorBuffer&&r.colorBuffer.destroy(),r.pbrBuffer&&r.pbrBuffer.destroy(),r.segments.destroy(),r.material&&((e=r.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(const e of t.children)iv(e)}class nv{constructor(t){this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class ov{constructor(){this.tasks={},this.taskQueue=[],sr(["process"],this),this.invoker=new nv(this.process),this.nextId=0}add(t,e){const r=this.nextId++,i=function({type:t,isSymbolTile:e,zoom:r}){return r=r||0,"message"===t?0:"maybePrepare"!==t||e?"parseTile"!==t||e?"parseTile"===t&&e?300-r:"maybePrepare"===t&&e?400-r:500:200-r:100-r}(e);if(0===i){try{t()}finally{}return null}return this.tasks[r]={fn:t,metadata:e,priority:i,id:r},this.taskQueue.push(r),this.invoker.trigger(),{cancel:()=>{delete this.tasks[r]}}}process(){try{if(this.taskQueue=this.taskQueue.filter((t=>!!this.tasks[t])),!this.taskQueue.length)return;const t=this.pick();if(null===t)return;const e=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!e)return;e.fn()}finally{}}pick(){let t=null,e=1/0;for(let r=0;r<this.taskQueue.length;r++){const i=this.tasks[this.taskQueue[r]];i.priority<e&&(e=i.priority,t=r)}if(null===t)return null;const r=this.taskQueue[t];return this.taskQueue.splice(t,1),r}remove(){this.invoker.remove()}}class av{constructor(t,e,r){this.target=t,this.parent=e,this.mapId=r,this.callbacks={},this.cancelCallbacks={},sr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new ov}send(t,e,r,i,n=!1,o){const a=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=o,this.callbacks[a]=r);const s=new Set;return this.target.postMessage({id:a,type:t,hasCallback:!!r,targetMapId:i,mustQueue:n,sourceMapId:this.mapId,data:Es(e,s)},s),{cancel:()=>{r&&delete this.callbacks[a],this.target.postMessage({id:a,type:"<cancel>",targetMapId:i,sourceMapId:this.mapId})}}}receive(t){const e=t.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const t=this.cancelCallbacks[r];delete this.cancelCallbacks[r],t&&t.cancel()}else if(e.mustQueue||gr()){const t=this.callbacks[r],i=this.scheduler.add((()=>this.processTask(r,e)),t&&t.metadata||{type:"message"});i&&(this.cancelCallbacks[r]=i)}else this.processTask(r,e)}processTask(t,e){if(delete this.cancelCallbacks[t],"<response>"===e.type){const r=this.callbacks[t];delete this.callbacks[t],r&&(e.error?r(Ts(e.error)):r(null,Ts(e.data)))}else{const r=new Set,i=e.hasCallback?(e,i)=>{this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:e?Es(e):null,data:Es(i,r)},r)}:t=>{},n=Ts(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,n,i);else if(this.parent.getWorkerSource){const t=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,t[0],n.source,n.scope)[t[1]](n,i)}else i(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class sv{constructor(t,e){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=ir();const r=this.workerPool.acquire(this.id);for(let t=0;t<r.length;t++){const i=new sv.Actor(r[t],e,this.id);i.name=`Worker ${t}`,this.actors.push(i)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(t,e,r){Je(this.actors,((r,i)=>{r.send(t,e,i)}),r=r||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((t=>{t.remove()})),this.actors=[],this.workerPool.release(this.id)}}sv.Actor=av;var lv={workerUrl:"",workerClass:null,workerParams:void 0};function cv(){return null!=lv.workerClass?new lv.workerClass:new self.Worker(lv.workerUrl,lv.workerParams)}const uv="mapboxgl_preloaded_worker_pool";class hv{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<hv.workerCount;)this.workers.push(new cv);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.workers&&0===this.numActive()&&(this.workers.forEach((t=>{t.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[uv]}numActive(){return Object.keys(this.active).length}}let Av;function pv(){return Av||(Av=new hv),Av}hv.workerCount=2;let dv,fv,mv,gv,_v,yv=null;function vv(){return gr()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:fv||i.DRACO_URL}function xv(){if(gr()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(gv)return gv;const t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if("object"!=typeof WebAssembly)throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return gv=WebAssembly.validate(t)?i.MESHOPT_SIMD_URL:i.MESHOPT_URL,gv}const wv={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},bv={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Bv={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Cv(t,e,r){const i=r.json.bufferViews.length,n=r.buffers.length;e.bufferView=i,r.json.bufferViews[i]={buffer:n,byteLength:t.byteLength},r.buffers[n]=t}const Ev="KHR_draco_mesh_compression";function Tv(t,e){const r=t.extensions&&t.extensions[Ev];if(!r)return;const i=new mv.Decoder,n=Dv(e,r.bufferView),o=new mv.Mesh;if(!i.DecodeArrayToMesh(n,n.byteLength,o))throw new Error("Failed to decode Draco mesh");const a=e.json.accessors[t.indices],s=wv[a.componentType],l=a.count*s.BYTES_PER_ELEMENT,c=mv._malloc(l);s===Uint16Array?i.GetTrianglesUInt16Array(o,l,c):i.GetTrianglesUInt32Array(o,l,c),Cv(mv.memory.buffer.slice(c,c+l),a,e),mv._free(c);for(const n of Object.keys(r.attributes)){const a=i.GetAttributeByUniqueId(o,r.attributes[n]),s=e.json.accessors[t.attributes[n]],l=bv[s.componentType],c=s.count*Bv[s.type]*wv[s.componentType].BYTES_PER_ELEMENT,u=mv._malloc(c);i.GetAttributeDataArrayForAllPoints(o,a,mv[l],c,u),Cv(mv.memory.buffer.slice(u,u+c),s,e),mv._free(u)}i.destroy(),o.destroy(),delete t.extensions[Ev]}const Iv="EXT_meshopt_compression";function Sv(t,e){if(!t.extensions||!t.extensions[Iv])return;const r=t.extensions[Iv],i=new Uint8Array(e.buffers[r.buffer],r.byteOffset||0,r.byteLength||0),n=new Uint8Array(r.count*r.byteStride);_v.decodeGltfBuffer(n,r.count,r.byteStride,i,r.mode,r.filter),t.buffer=e.buffers.length,t.byteOffset=0,e.buffers[t.buffer]=n.buffer,delete t.extensions[Iv]}const Mv=1179937895,Fv=new TextDecoder("utf8");function Pv(t,e){return new URL(t,e).href}function Lv(t,e,r,i){return fetch(Pv(t.uri,i)).then((t=>t.arrayBuffer())).then((t=>{e.buffers[r]=t}))}function Dv(t,e){const r=t.json.bufferViews[e];return new Uint8Array(t.buffers[r.buffer],r.byteOffset||0,r.byteLength)}function Uv(t,e,r,i){if(t.uri){const n=Pv(t.uri,i);return fetch(n).then((t=>t.blob())).then((t=>createImageBitmap(t))).then((t=>{e.images[r]=t}))}if(void 0!==t.bufferView){const i=Dv(e,t.bufferView),n=new Blob([i],{type:t.mimeType});return createImageBitmap(n).then((t=>{e.images[r]=t}))}}function kv(t,e=0,r){const i={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===Mv){const r=new Uint32Array(t,e);let n=2;const o=(r[n++]>>2)-3,a=r[n++]>>2;if(n++,i.json=JSON.parse(Fv.decode(r.subarray(n,n+a))),n+=a,n<o){const o=r[n++];n++;const a=e+(n<<2);i.buffers[0]=t.slice(a,a+o)}}else i.json=JSON.parse(Fv.decode(new Uint8Array(t,e)));const{buffers:n,images:o,meshes:a,extensionsUsed:s,bufferViews:l}=i.json;let c=Promise.resolve();if(n){const t=[];for(let e=0;e<n.length;e++){const o=n[e];o.uri?t.push(Lv(o,i,e,r)):i.buffers[e]||(i.buffers[e]=null)}c=Promise.all(t)}return c.then((()=>{const t=[],e=s&&s.includes(Ev),n=s&&s.includes(Iv);if(e&&t.push(function(){if(!mv)return dv||(dv=function(t){let e,r=null;function i(){e=new Uint8Array(r.buffer)}function n(){throw new Error("Unexpected Draco error.")}const o={a:{a:n,d:function(t,r,i){return e.copyWithin(t,r,r+i)},c:function(t){const n=e.length,o=Math.max(t>>>0,Math.ceil(1.2*n)),a=Math.ceil((o-n)/65536);try{return r.grow(a),i(),!0}catch(t){return!1}},b:n}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(t,o):t.then((t=>t.arrayBuffer())).then((t=>WebAssembly.instantiate(t,o)))).then((t=>{const{Rb:n,Qb:o,P:a,T:s,X:l,Ja:c,La:u,Qa:h,Va:A,Wa:p,eb:d,jb:f,f:m,e:g,yb:_,zb:y,Ab:v,Bb:x,Db:w,Gb:b}=t.instance.exports;r=g;const B=(()=>{let t=0,r=0,i=0,a=0;return s=>{i&&(n(a),n(t),r+=i,i=t=0),t||(r+=128,t=o(r));const l=s.length+7&-8;let c=t;l>=r&&(i=l,c=a=o(l));for(let t=0;t<s.length;t++)e[c+t]=s[t];return c}})();return i(),m(),{memory:g,_free:n,_malloc:o,Mesh:class{constructor(){this.ptr=a()}destroy(){s(this.ptr)}},Decoder:class{constructor(){this.ptr=c()}destroy(){f(this.ptr)}DecodeArrayToMesh(t,e,r){const i=B(t),n=u(this.ptr,i,e,r.ptr);return!!l(n)}GetAttributeByUniqueId(t,e){return{ptr:h(this.ptr,t.ptr,e)}}GetTrianglesUInt16Array(t,e,r){A(this.ptr,t.ptr,e,r)}GetTrianglesUInt32Array(t,e,r){p(this.ptr,t.ptr,e,r)}GetAttributeDataArrayForAllPoints(t,e,r,i,n){d(this.ptr,t.ptr,e.ptr,r,i,n)}},DT_INT8:_(),DT_UINT8:y(),DT_INT16:v(),DT_UINT16:x(),DT_UINT32:w(),DT_FLOAT32:b()}}))}(fetch(vv())),dv.then((t=>{mv=t,dv=void 0})))}()),n&&t.push(function(){if(_v)return;const t=function(t){let e;const r=WebAssembly.instantiateStreaming(t,{}).then((t=>{e=t.instance,e.exports.__wasm_call_ctors()})),i={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},n={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:r,supported:!0,decodeGltfBuffer(t,r,o,a,s,l){!function(t,e,r,i,n,o,a){const s=t.exports.sbrk,l=i+3&-4,c=s(l*n),u=s(o.length),h=new Uint8Array(t.exports.memory.buffer);h.set(o,u);const A=e(c,i,n,u,o.length);if(0===A&&a&&a(c,l,n),r.set(h.subarray(c,c+i*n)),s(c-s(0)),0!==A)throw new Error(`Malformed buffer data: ${A}`)}(e,e.exports[n[s]],t,r,o,a,e.exports[i[l]])}}}(fetch(xv()));return t.ready.then((()=>{_v=t}))}()),o)for(let e=0;e<o.length;e++)t.push(Uv(o[e],i,e,r));return(t.length?Promise.all(t):Promise.resolve()).then((()=>{if(e&&a)for(const{primitives:t}of a)for(const e of t)Tv(e,i);if(n&&a&&l)for(const t of l)Sv(t,i);return i}))}))}function zv(t,e){const r=t.json.bufferViews[e.bufferView],i=wv[e.componentType];return new i(t.buffers[r.buffer],(e.byteOffset||0)+(r.byteOffset||0),e.count*(r.byteStride&&r.byteStride!==Bv[e.type]*i.BYTES_PER_ELEMENT?r.byteStride/i.BYTES_PER_ELEMENT:Bv[e.type]))}function Rv(t,e,r,i){const n=wv[e.componentType],o=function(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(n),a=t.json.bufferViews[e.bufferView],s=a.byteStride?a.byteStride/n.BYTES_PER_ELEMENT:Bv[e.type],l=r.float32,c=l.length/r.capacity;for(let t=0,r=0;t<e.count*s;t+=s,r+=c)for(let e=0;e<c;e++)l[r+e]=i[t+e]*o;r._trim()}function Ov(t,e,r){const i=t.indices,n=t.attributes,o={};o.indexArray=new Jl;const a=e.json.accessors[i],s=a.count/3;o.indexArray.reserve(s);const l=zv(e,a);for(let t=0;t<s;t++)o.indexArray.emplaceBack(l[3*t],l[3*t+1],l[3*t+2]);o.indexArray._trim(),o.vertexArray=new Ql;const c=e.json.accessors[n.POSITION];o.vertexArray.reserve(c.count);const u=zv(e,c);for(let t=0;t<c.count;t++)o.vertexArray.emplaceBack(u[3*t],u[3*t+1],u[3*t+2]);if(o.vertexArray._trim(),o.aabb=new Bh(c.min,c.max),o.centroid=function(t,e){const r=[0,0,0],i=t.length;if(i>0){for(let n=0;n<i;n++){const i=3*t[n];r[0]+=e[i],r[1]+=e[i+1],r[2]+=e[i+2]}r[0]/=i,r[1]/=i,r[2]/=i}return r}(l,u),void 0!==n.COLOR_0){const t=e.json.accessors[n.COLOR_0],r=Bv[t.type],i=zv(e,t);o.colorArray=3===r?new Ql:new Ol,o.colorArray.resize(t.count),Rv(e,t,o.colorArray,i)}if(void 0!==n.NORMAL){o.normalArray=new Ql;const t=e.json.accessors[n.NORMAL];o.normalArray.resize(t.count);const r=zv(e,t);Rv(e,t,o.normalArray,r)}if(void 0!==n.TEXCOORD_0&&r.length>0){o.texcoordArray=new nc;const t=e.json.accessors[n.TEXCOORD_0];o.texcoordArray.resize(t.count);const r=zv(e,t);Rv(e,t,o.texcoordArray,r)}if(void 0!==n._FEATURE_ID_RGBA4444){const t=e.json.accessors[n._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(o.featureData=zv(e,t))}void 0!==n._FEATURE_RGBA4444&&(o.featureData=new Uint32Array(zv(e,e.json.accessors[n._FEATURE_RGBA4444]).buffer));const h=t.material;return o.material=function(t,e){const{emissiveFactor:r=[0,0,0],alphaMode:i="OPAQUE",alphaCutoff:n=.5,normalTexture:o,occlusionTexture:a,emissiveTexture:s,doubleSided:l}=t,{baseColorFactor:c=[1,1,1,1],metallicFactor:u=1,roughnessFactor:h=1,baseColorTexture:A,metallicRoughnessTexture:p}=t.pbrMetallicRoughness||{},d=a?e[a.index]:void 0;if(a&&a.extensions&&a.extensions.KHR_texture_transform&&d){const t=a.extensions.KHR_texture_transform;d.offsetScale=[t.offset[0],t.offset[1],t.scale[0],t.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Vi(...c),metallicFactor:u,roughnessFactor:h,baseColorTexture:A?e[A.index]:void 0,metallicRoughnessTexture:p?e[p.index]:void 0},doubleSided:l,emissiveFactor:r,alphaMode:i,alphaCutoff:n,normalTexture:o?e[o.index]:void 0,occlusionTexture:d,emissionTexture:s?e[s.index]:void 0,defined:void 0===t.defined}}(void 0!==h?e.json.materials[h]:{defined:!1},r),o}function Qv(e,r,i){const{matrix:n,rotation:o,translation:a,scale:s,mesh:l,extras:c,children:u}=e,h={};if(h.matrix=n||t.ad.fromRotationTranslationScale([],o||[0,0,0,1],a||[0,0,0],s||[1,1,1]),void 0!==l){h.meshes=i[l];const t=h.anchor=[0,0];for(const e of h.meshes){const{min:r,max:i}=e.aabb;t[0]+=r[0]+i[0],t[1]+=r[1]+i[1]}t[0]=Math.floor(t[0]/h.meshes.length/2),t[1]=Math.floor(t[1]/h.meshes.length/2)}if(c&&(c.id&&(h.id=c.id),c.lights&&(h.lights=function(t){if(!t.length)return[];const e=function(t){const e=atob(t),r=new Uint8Array(e.length);for(let t=0;t<e.length;t++)r[t]=e.codePointAt(t);return r}(t),r=[],i=e.length/24,n=new Uint16Array(e.buffer),o=new Float32Array(e.buffer);for(let t=0;t<i;t++){const e=n[2*t*6]/30,i=n[2*t*6+1]/30,a=n[2*t*6+10]/100,s=o[6*t+1],l=o[6*t+2],c=o[6*t+3],u=o[6*t+4],h=c-s,A=u-l,p=Math.hypot(h,A);r.push({pos:[s+.5*h,l+.5*A,i],normal:[A/p,-h/p,0],width:p,height:e,depth:a,points:[s,l,c,u]})}return r}(c.lights))),u){const t=[];for(const e of u)t.push(Qv(r.json.nodes[e],r,i));h.children=t}return h}function Nv(t){if(0===t.vertices.length||0===t.indices.length)return null;const e=new tp(t.vertices,t.indices,8,256),[r,i]=[e.min.clone(),e.max.clone()];return{vertices:t.vertices,indices:t.indices,grid:e,min:r,max:i}}function Vv(t){if(!t.extras||!t.extras.ground)return null;const e=t.extras.ground;if(!e||!Array.isArray(e)||0===e.length)return null;const r=e[0];if(!r||!Array.isArray(r)||0===r.length)return null;const i=[];for(const t of r){if(!Array.isArray(t)||2!==t.length)continue;const e=t[0],r=t[1];"number"==typeof e&&"number"==typeof r&&i.push(new Ne(e,r))}if(i.length<3)return null;i.length>1&&i[i.length-1].equals(i[0])&&i.pop();let n=0;for(let t=0;t<i.length;t++){const e=i[t],r=i[(t+1)%i.length],o=i[(t+2)%i.length];n+=(e.x-r.x)*(o.y-r.y)-(o.x-r.x)*(e.y-r.y)}n>0&&i.reverse();const o=wA(i.flatMap((t=>[t.x,t.y])),[]);return 0===o.length?null:{vertices:i,indices:o}}function Hv(e,r){const i=[],n=[];let o=0;const a=[];for(const s of e){o=i.length;const e=s.vertexArray.float32,l=s.indexArray.uint16;for(let n=0;n<s.vertexArray.length;n++)a[0]=e[3*n+0],a[1]=e[3*n+1],a[2]=e[3*n+2],t._.transformMat4(a,a,r),i.push(new Ne(a[0],a[1]));for(let t=0;t<3*s.indexArray.length;t++)n.push(l[t]+o)}if(n.length%3!=0)return null;for(let t=0;t<n.length;t+=3){const e=i[n[t+0]],r=i[n[t+1]],o=i[n[t+2]];(e.x-r.x)*(o.y-r.y)-(o.x-r.x)*(e.y-r.y)>0&&([n[t+1],n[t+2]]=[n[t+2],n[t+1]])}return{vertices:i,indices:n}}function jv(t){const e=function(t,e){const r=[],i=WebGL2RenderingContext;if(t.json.textures)for(const n of t.json.textures){const o={magFilter:i.LINEAR,minFilter:i.NEAREST,wrapS:i.REPEAT,wrapT:i.REPEAT};void 0!==n.sampler&&Object.assign(o,t.json.samplers[n.sampler]),r.push({image:e[n.source],sampler:o,uploaded:!1})}return r}(t,t.images),r=function(t,e){const r=[];for(const i of t.json.meshes){const n=[];for(const r of i.primitives)n.push(Ov(r,t,e));r.push(n)}return r}(t,e),{scenes:i,scene:n,nodes:o}=t.json,a=i?i[n||0].nodes:o,s=[];for(const e of a)s.push(Qv(o[e],t,r));return function(t,e,r){const i={},n=new Set;for(let o=0;o<t.length;o++){const t=r[e[o]];if(!t.extras)continue;const a=t.extras["mapbox:footprint:version"],s=t.extras["mapbox:footprint:id"];(a||s)&&n.add(o),"1.0.0"===a&&s&&(i[s]=o)}for(let o=0;o<t.length;o++){if(n.has(o))continue;const a=t[o],s=r[e[o]];if(!s.extras)continue;let l=null;a.id in i&&(l=Hv(t[i[a.id]].meshes,a.matrix)),l||(l=Vv(s)),l&&(a.footprint=Nv(l))}if(n.size>0){const e=Array.from(n.values()).sort(((t,e)=>t-e));for(let r=e.length-1;r>=0;r--)t.splice(e[r],1)}}(s,a,t.json.nodes),s}function Gv(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);const e=t.vertexArray.float32,r=t.aabb.min[0]-1,i=t.aabb.min[1]-1,n=Xy/(t.aabb.max[0]-r+2),o=Xy/(t.aabb.max[1]-i+2);for(let a=0;a<e.length;a+=3){const s=e[a+2],l=(e[a+0]-r)*n|0,c=(e[a+1]-i)*o|0;s>t.heightmap[c*Xy+l]&&(t.heightmap[c*Xy+l]=s)}}function Kv(e,r){const i={};i.indexArray=new Jl,i.indexArray.reserve(4*e.length),i.vertexArray=new Ql,i.vertexArray.reserve(10*e.length),i.colorArray=new Ol,i.vertexArray.reserve(10*e.length);let n=0;for(const o of e){const e=Math.min(10,Math.max(4,1.3*o.height))*r,a=[-o.normal[1],o.normal[0],0],s=Math.min(.29,.1*o.width/o.depth),l=o.width-2*o.depth*r*(s+.01),c=t._.scaleAndAdd([],o.pos,a,l/2),u=t._.scaleAndAdd([],o.pos,a,-l/2),h=[c[0],c[1],c[2]+o.height],A=[u[0],u[1],u[2]+o.height],p=t._.scaleAndAdd([],o.normal,a,s);t._.scale(p,p,e);const d=t._.scaleAndAdd([],o.normal,a,-s);t._.scale(d,d,e),t._.add(p,c,p),t._.add(d,u,d),c[2]+=.1,u[2]+=.1,i.vertexArray.emplaceBack(p[0],p[1],p[2]),i.vertexArray.emplaceBack(d[0],d[1],d[2]),i.vertexArray.emplaceBack(c[0],c[1],c[2]),i.vertexArray.emplaceBack(u[0],u[1],u[2]),i.vertexArray.emplaceBack(h[0],h[1],h[2]),i.vertexArray.emplaceBack(A[0],A[1],A[2]),i.vertexArray.emplaceBack(c[0],c[1],c[2]),i.vertexArray.emplaceBack(u[0],u[1],u[2]),i.vertexArray.emplaceBack(p[0],p[1],p[2]),i.vertexArray.emplaceBack(d[0],d[1],d[2]);const f=l/e/2;i.colorArray.emplaceBack(-f-s,-1,f,.8),i.colorArray.emplaceBack(f+s,-1,f,.8),i.colorArray.emplaceBack(-f,0,f,1.3),i.colorArray.emplaceBack(f,0,f,1.3),i.colorArray.emplaceBack(f+s,-.8,f,.7),i.colorArray.emplaceBack(f+s,-.8,f,.7),i.colorArray.emplaceBack(0,0,f,1.3),i.colorArray.emplaceBack(0,0,f,1.3),i.colorArray.emplaceBack(f+s,-1.2,f,.8),i.colorArray.emplaceBack(f+s,-1.2,f,.8),i.indexArray.emplaceBack(6+n,4+n,8+n),i.indexArray.emplaceBack(7+n,9+n,5+n),i.indexArray.emplaceBack(0+n,1+n,2+n),i.indexArray.emplaceBack(1+n,3+n,2+n),n+=10}const o={defined:!0,emissiveFactor:[0,0,0]},a={};return a.baseColorFactor=Vi.white,o.pbrMetallicRoughness=a,i.material=o,i.aabb=new Bh([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}const qv=new Float32Array(262144),Zv=new Uint8Array(262144);function Wv(t){let e=0;if(t.meshes)for(const r of t.meshes)e=Math.max(e,r.aabb.max[2]);if(t.children)for(const r of t.children)e=Math.max(e,Wv(r));return e}function Xv(t,e,r){if(t.meshes)for(const i of t.meshes)i.aabb.min[0]!==1/0&&r.insert(e,i.aabb.min[0],i.aabb.min[1],i.aabb.max[0],i.aabb.max[1]);if(t.children)for(const i of t.children)Xv(i,e,r)}const $v=["","wall","door","roof","window","lamp","logo"];class Yv{constructor(t){this.node=t,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:t.id,geometry:[],properties:{height:Wv(t)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new Bh([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let t=0;const e=new Bh([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const r of this.node.meshes)this.node.lightMeshIndex!==t&&(r.transformedAabb=Bh.applyTransformFast(r.aabb,this.node.matrix),e.encapsulate(r.transformedAabb)),t++;this.aabb=e}return this.aabb}}class Jv{constructor(t,e,r,i,n,o){this.id=e,this.modelTraits|=$y.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,r&&(this.modelTraits|=$y.HasMapboxMeshFeatures),i&&(this.modelTraits|=$y.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=n,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const e of t)this.nodesInfo.push(new Yv(e)),Xv(e,o.featureIndexArray.length,o.grid),o.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,o.bucketLayerIDs.length-1,0)}updateFootprints(t,e){for(const r of this.getNodesInfo()){const i=r.node;i.footprint&&e.push({footprint:i.footprint,id:t})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(t){if(!this.needsUpload)return;const e=this.getNodesInfo();for(const r of e){const e=r.node;this.uploaded?this.updatePbrBuffer(e):ev(e,t,!0)}for(const t of e)rv(t.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(t){let e=!1;if(!t.meshes)return e;for(const r of t.meshes)r.pbrBuffer&&(r.pbrBuffer.updateData(r.featureArray),e=!0);return e}needsReEvaluation(t,e,r){const i=t.transform.projectionOptions,n=t.style.getBrightness(),o=this.brightness!==n;return!!(!this.uploaded||this.dirty||i.name!==this.projection.name||tx(r.paint.get("model-color").value,o)||tx(r.paint.get("model-color-mix-intensity").value,o)||tx(r.paint.get("model-roughness").value,o)||tx(r.paint.get("model-emissive-strength").value,o)||tx(r.paint.get("model-height-based-emissive-strength-multiplier").value,o))&&(this.projection=i,this.brightness=n,!0)}evaluateScale(t,e){if(t.transform.zoom===this.zoom)return;this.zoom=t.transform.zoom;const r=this.getNodesInfo(),i=this.id.canonical;for(const t of r){const r=t.feature;t.evaluatedScale=e.paint.get("model-scale").evaluate(r,{},i)}}evaluate(t){const e=this.getNodesInfo();for(const r of e){if(!r.node.meshes)continue;const e=r.feature,i=r.node.meshes&&r.node.meshes[0].featureData,n=r.evaluatedColor[2],o=r.evaluatedRMEA[2],a=this.id.canonical;if(r.hasTranslucentParts=!1,i){for(let i=0;i<$v.length;i++){const n=$v[i];n.length&&(e.properties.part=n);const o=t.paint.get("model-color").evaluate(e,{},a).toRenderColor(null),s=t.paint.get("model-color-mix-intensity").evaluate(e,{},a);r.evaluatedColor[i]=[o.r,o.g,o.b,s],r.evaluatedRMEA[i][0]=t.paint.get("model-roughness").evaluate(e,{},a),r.evaluatedRMEA[i][2]=t.paint.get("model-emissive-strength").evaluate(e,{},a),r.evaluatedRMEA[i][3]=o.a,r.emissionHeightBasedParams[i]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(e,{},a),!r.hasTranslucentParts&&o.a<1&&(r.hasTranslucentParts=!0)}delete e.properties.part,rx(r,n!==r.evaluatedColor[2]||o!==r.evaluatedRMEA[2],this.modelTraits)}else r.evaluatedRMEA[0][2]=t.paint.get("model-emissive-strength").evaluate(e,{},a);r.evaluatedScale=t.paint.get("model-scale").evaluate(e,{},a),this.updatePbrBuffer(r.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(t,e,r,i){const n=t.findDEMTileFor(r);if(n&&(n.tileID.canonical!==this.terrainTile||e!==this.terrainExaggeration)){if(n.dem&&n.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=n.tileID.overscaledZ;const e=Yp.create(t,r,n);if(!e)return;this.modelTraits&$y.HasMapboxMeshFeatures&&this.updateDEM(t,e,r,i);for(const t of this.getNodesInfo()){const r=t.node;if(!r.footprint||!r.footprint.vertices||!r.footprint.vertices.length)continue;const i=r.footprint.vertices;let n=e.getElevationAt(i[0].x,i[0].y,!0,!0);for(let t=1;t<i.length;t++)n=Math.min(n,e.getElevationAt(i[t].x,i[t].y,!0,!0));r.elevation=n}}this.terrainTile=n.tileID.canonical,this.terrainExaggeration=e}}updateDEM(t,e,r,i){let n=e._dem._modifiedForSources[i];if(void 0===n&&(e._dem._modifiedForSources[i]=[],n=e._dem._modifiedForSources[i]),n.includes(r.canonical))return;const o=e._dem.dim;n.push(r.canonical);let a=!1;for(const t of this.getNodesInfo()){const r=t.node;if(!r.footprint||!r.footprint.grid)continue;const i=r.footprint.grid,n=e.tileCoordToPixel(i.min.x,i.min.y),s=e.tileCoordToPixel(i.max.x,i.max.y),l=Math.min(Math.min(o-s.y,n.x),Math.min(n.y,o-s.x));if(l<0)continue;const c=Xe(l,2,5);let u=Math.max(0,n.x-c),h=Math.max(0,n.y-c),A=Math.min(s.x+c,o-1),p=Math.min(s.y+c,o-1);for(let t=h;t<=p;++t)for(let e=u;e<=A;++e)Zv[t*o+e]=255;let d=0,f=0;for(let t=0;t<i.cellsY;++t)for(let r=0;r<i.cellsX;++r){if(!i.cells[t*i.cellsX+r])continue;const n=e.tileCoordToPixel(i.min.x+r/i.xScale,i.min.y+t/i.yScale),a=e.tileCoordToPixel(i.min.x+(r+1)/i.xScale,i.min.y+(t+1)/i.yScale);for(let t=n.y;t<=Math.min(a.y+1,o-1);++t)for(let r=n.x;r<=Math.min(a.x+1,o-1);++r)255===Zv[t*o+r]&&(Zv[t*o+r]=0,d+=e.getElevationAtPixel(r,t),f++)}const m=d/f;u=Math.max(1,n.x-c),h=Math.max(1,n.y-c),A=Math.min(s.x+c,o-2),p=Math.min(s.y+c,o-2),a=!0;for(let t=h;t<=p;++t)for(let r=u;r<=A;++r)0===Zv[t*o+r]&&(qv[t*o+r]=e._dem.set(r,t,m));for(let t=1;t<c;++t){u=Math.max(1,n.x-t),h=Math.max(1,n.y-t),A=Math.min(s.x+t,o-2),p=Math.min(s.y+t,o-2);for(let r=h;r<=p;++r)for(let i=u;i<=A;++i){const n=r*o+i;if(255===Zv[n]){let a=0,s=0,l=-1,u=-1;for(let e=-1;e<=1;++e)for(let n=-1;n<=1;++n){const c=(r+e)*o+i+n;if(Zv[c]>=t)continue;const h=qv[c],A=Math.abs(h);A>s&&(a=h,s=A,l=n,u=e)}if(s>.1){const o=1-(t+.5*Math.abs(l*u))/c;let s=e._dem.get(i,r)+a*o;const h=e._dem.get(i+l,r+u),A=e._dem.get(i-l,r-u,!0);(s-h)*(s-A)>0&&(s=(h+A)/2),qv[n]=e._dem.set(i,r,s),Zv[n]=t}}}}}a&&(e._demTile.needsDEMTextureUpload=!0,e._dem._timestamp=Lr.now())}getNodesInfo(){return this.nodesInfo}destroy(){const t=this.getNodesInfo();for(const e of t)rv(e.node),iv(e.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(t,e){if(e.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=e.updateTime;const r=e.getReplacementRegionsForTile(t.toUnwrapped()),i=this.getNodesInfo();for(let t=0;t<this.nodesInfo.length;t++){const e=i[t].node;i[t].hiddenByReplacement=!!e.footprint&&!r.find((t=>t.footprint===e.footprint))}}getHeightAtTileCoord(e,r){const i=this.getNodesInfo(),n=[],o=[0,0,0],a=t.ad.identity([]);for(let s=0;s<this.nodesInfo.length;s++){const l=i[s],c=l.node.meshes[0],u=c.transformedAabb;if(e<u.min[0]||r<u.min[1]||e>u.max[0]||r>u.max[1])continue;if(!0===l.node.hidden)return{height:0,maxHeight:l.feature.properties.height,hidden:!1,verticalScale:l.evaluatedScale[2]};t.ad.invert(a,l.node.matrix),o[0]=e,o[1]=r,t._.transformMat4(o,o,a);const h=(o[0]-c.aabb.min[0])/(c.aabb.max[0]-c.aabb.min[0])*Xy|0,A=Math.min(63,(o[1]-c.aabb.min[1])/(c.aabb.max[1]-c.aabb.min[1])*Xy|0)*Xy+Math.min(63,h),p=c.heightmap[A];if(!(p<0&&l.node.footprint)){if(l.hiddenByReplacement)return;return{height:p,maxHeight:l.feature.properties.height,hidden:!1,verticalScale:l.evaluatedScale[2]}}if(l.node.footprint.grid.query(new Ne(e,r),new Ne(e,r),n),n.length>0)return{height:void 0,maxHeight:l.feature.properties.height,hidden:l.hiddenByReplacement,verticalScale:l.evaluatedScale[2]}}}}function tx(t,e){return!t.isLightConstant&&e}function ex(t,e,r,i,n,o,a,s){let l=(61440&e|(61440&e)>>4)>>8,c=(3840&e|(3840&e)>>4)>>4,u=240&e|(240&e)>>4;r[3]>0&&(l=ji(l,255*r[0],r[3]),c=ji(c,255*r[1],r[3]),u=ji(u,255*r[2],r[3]));const h=l<<8|c,A=u<<8|Math.floor(255*i[3]),p=function(t){const e=Xe(t,0,2);return Math.min(Math.round(.5*e*255),255)}(i[2])<<8|15*i[0]<<4|15*i[1],d=Xe(n[0],0,1),f=Xe(n[1],0,1),m=Xe(n[2],0,1),g=Xe(n[3],0,1);let _,y,v,x;if(d!==f&&a!==o&&f!==d){const t=a-o;y=1/(t*(f-d)),v=-(o+t*d)/(t*(f-d));const e=Xe(n[4],-1,1);x=Math.pow(10,e),_=255*m<<8|255*g}else _=65535,y=0,v=1,x=1;if(t.emplaceBack(h,A,p,_,y,v,x),s){const t=s.length;s.clear();for(let e=0;e<t;e++)s.emplaceBack(h,A,p,_,y,v,x)}}function rx(t,e,r){const i=t.node;let n=0;const o=r&$y.HasMeshoptCompression;for(const r of i.meshes){if(i.lights&&i.lightMeshIndex===n)continue;if(!r.featureData)continue;r.featureArray=new lc,r.featureArray.reserve(r.featureData.length);let a=e;for(const e of r.featureData){const n=o?65535&e:e>>16&65535,s=o?e>>16&65535:65535&e,l=(15&s)<8?15&s:0,c=t.evaluatedRMEA[l],u=t.evaluatedColor[l],h=t.emissionHeightBasedParams[l];let A;if(a&&2===l&&i.lights&&(A=new lc,A.resize(10*i.lights.length)),ex(r.featureArray,n,u,c,h,r.aabb.min[2],r.aabb.max[2],A),A&&a){a=!1;const t=i.meshes[i.lightMeshIndex];t.featureArray=A,t.featureArray._trim()}}r.featureArray._trim(),n++}}function ix(t,e,r,i){const n=1<<t.z;e.lat=Fu((i/Ao+t.y)/n),e.lng=Mu((r/Ao+t.x)/n)}bs(Jv,"Tiled3dModelBucket",{omit:["layers"]}),bs(Yv,"Tiled3dModelFeature");const nx={circle:class extends Il{constructor(t,e,r,i){super(t,mh,e,r,i)}createBucket(t){return new Xu(t)}queryRadius(t){const e=t;return hh("circle-radius",this,e)+hh("circle-stroke-width",this,e)+Ah(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,r,i,n,o,a,s){const l=dh(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),c=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return iA(t,i,o,a,s,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),l,c)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e,r){const i=rA(this);return{config:new Xc(this,{zoom:e,lut:r}),defines:i,overrideFog:!1}}},heatmap:class extends Il{createBucket(t){return new lA(t)}constructor(t,e,r,i){super(t,mA,e,r,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=gA({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return hh("heatmap-radius",this,t)}queryIntersectsFeature(t,e,r,i,n,o,a,s){const l=this.paint.get("heatmap-radius").evaluate(e,r);return iA(t,i,o,a,s,!0,!0,new Ne(0,0),l)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e,r){return"heatmap"===t?{config:new Xc(this,{zoom:e,lut:r}),overrideFog:!1}:{}}},hillshade:class extends Il{constructor(t,e,r,i){super(t,yA,e,r,i)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e,r){return{overrideFog:!1}}},fill:class extends Il{constructor(t,e,r,i){super(t,JA,e,r,i)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getDefaultProgramParams(t,e,r){return{config:new Xc(this,{zoom:e,lut:r}),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);const r=this.paint._values["fill-outline-color"];"constant"===r.value.kind&&void 0===r.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new $A(t)}queryRadius(){return Ah(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,r,i,n,o){return!t.queryGeometry.isAboveHorizon&&Ju(ph(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),i)}isTileClipped(){return!0}},"fill-extrusion":class extends Il{constructor(t,e,r,i){super(t,Sd,e,r,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new gd(t)}queryRadius(){return Ah(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(e,r,i,n,o,a,s,l,c){const u=dh(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),h=this.paint.get("fill-extrusion-height").evaluate(r,i),A=this.paint.get("fill-extrusion-base").evaluate(r,i),p=[0,0],d=l&&a.elevation,f=a.elevation?a.elevation.exaggeration():1,m=e.tile.getBucket(this);if(d&&m instanceof gd){const t=m.centroidVertexArray,e=c+1;e<t.length&&(p[0]=t.geta_centroid_pos0(e),p[1]=t.geta_centroid_pos1(e))}if(0===p[0]&&1===p[1])return!1;"globe"===a.projection.name&&(n=Ed([n],[new Ne(0,0),new Ne(Ao,Ao)],e.tileID.canonical).map((t=>t.polygon)).flat());const g=d?l:null,[_,y]=function(e,r,i,n,o,a,s,l,c,u,h){return"globe"===e.projection.name?function(e,r,i,n,o,a,s,l,c,u,h){const A=[],p=[],d=e.projection.upVectorScale(h,e.center.lat,e.worldSize).metersToTile,f=[0,0,0,1],m=[0,0,0,1],g=(t,e,r,i)=>{t[0]=e,t[1]=r,t[2]=i,t[3]=1},_=Cd();i>0&&(i+=_),n+=_;for(const _ of r){const r=[],y=[];for(const A of _){const p=A.x+o.x,_=A.y+o.y,v=e.projection.projectTilePoint(p,_,h),x=e.projection.upVector(h,A.x,A.y);let w=i,b=n;if(s){const t=Pd(p,_,i,n,s,l,c,u);w+=t.base,b+=t.top}0!==i?g(f,v.x+x[0]*d*w,v.y+x[1]*d*w,v.z+x[2]*d*w):g(f,v.x,v.y,v.z),g(m,v.x+x[0]*d*b,v.y+x[1]*d*b,v.z+x[2]*d*b),t._.transformMat4(f,f,a),t._.transformMat4(m,m,a),r.push(new Cp(f[0],f[1],f[2])),y.push(new Cp(m[0],m[1],m[2]))}A.push(r),p.push(y)}return[A,p]}(e,r,i,n,o,a,s,l,c,u,h):s?function(e,r,i,n,o,a,s,l,c){const u=[],h=[],A=[0,0,0,1];for(const p of e){const e=[],d=[];for(const u of p){const h=u.x+n.x,p=u.y+n.y,f=Pd(h,p,r,i,a,s,l,c);A[0]=h,A[1]=p,A[2]=f.base,A[3]=1,t.aA.transformMat4(A,A,o),A[3]=Math.max(A[3],1e-5);const m=new Cp(A[0]/A[3],A[1]/A[3],A[2]/A[3]);A[0]=h,A[1]=p,A[2]=f.top,A[3]=1,t.aA.transformMat4(A,A,o),A[3]=Math.max(A[3],1e-5);const g=new Cp(A[0]/A[3],A[1]/A[3],A[2]/A[3]);e.push(m),d.push(g)}u.push(e),h.push(d)}return[u,h]}(r,i,n,o,a,s,l,c,u):function(t,e,r,i,n){const o=[],a=[],s=n[8]*e,l=n[9]*e,c=n[10]*e,u=n[11]*e,h=n[8]*r,A=n[9]*r,p=n[10]*r,d=n[11]*r;for(const e of t){const t=[],r=[];for(const o of e){const e=o.x+i.x,a=o.y+i.y,f=n[0]*e+n[4]*a+n[12],m=n[1]*e+n[5]*a+n[13],g=n[2]*e+n[6]*a+n[14],_=n[3]*e+n[7]*a+n[15],y=f+s,v=m+l,x=g+c,w=Math.max(_+u,1e-5),b=f+h,B=m+A,C=g+p,E=Math.max(_+d,1e-5);t.push(new Cp(y/w,v/w,x/w)),r.push(new Cp(b/E,B/E,C/E))}o.push(t),a.push(r)}return[o,a]}(r,i,n,o,a)}(a,n,A,h,u,s,g,p,f,a.center.lat,e.tileID.canonical),v=e.queryGeometry;return function(t,e,r){let i=1/0;Ju(r,e)&&(i=Fd(r,e[0]));for(let n=0;n<e.length;n++){const o=e[n],a=t[n];for(let t=0;t<o.length-1;t++){const e=o[t],n=[e,o[t+1],a[t+1],a[t],e];$u(r,n)&&(i=Math.min(i,Fd(r,n)))}}return i!==1/0&&i}(_,y,v.isPointQuery()?v.screenBounds:v.screenGeometry)}},line:class extends Il{constructor(t,e,r,i){super(t,rf,e,r,i),rf.layout&&(this.layout=new il(rf.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof ra,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=ry.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Jd(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e,r){const i=sf(this);return{config:new Xc(this,{zoom:e,lut:r}),defines:i,overrideFog:!1}}queryRadius(t){const e=t,r=iy(hh("line-width",this,e),hh("line-gap-width",this,e)),i=hh("line-offset",this,e);return r/2+Math.abs(i)+Ah(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,r,i,n,o){if(t.queryGeometry.isAboveHorizon)return!1;const a=ph(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),s=t.pixelToTileUnitsFactor/2*iy(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),l=this.paint.get("line-offset").evaluate(e,r);return l&&(i=function(t,e){const r=[],i=new Ne(0,0);for(let n=0;n<t.length;n++){const o=t[n],a=[];for(let t=0;t<o.length;t++){const r=o[t],n=o[t+1],s=0===t?i:r.sub(o[t-1])._unit()._perp(),l=t===o.length-1?i:n.sub(r)._unit()._perp(),c=s._add(l)._unit();c._mult(1/(c.x*l.x+c.y*l.y)),a.push(c._mult(e)._add(r))}r.push(a)}return r}(i,l*t.pixelToTileUnitsFactor)),function(t,e,r){for(let i=0;i<e.length;i++){const n=e[i];if(t.length>=3)for(let e=0;e<n.length;e++)if(ah(t,n[e]))return!0;if(th(t,n,r))return!0}return!1}(a,i,s)}isTileClipped(){return!0}isDraped(t){const e=this.layout.get("line-z-offset");return e.isConstant()&&!e.constantOr(0)}},symbol:sy,background:class extends Il{constructor(t,e,r,i){super(t,cy,e,r,i)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e,r){return{overrideFog:!1}}},raster:gy,"raster-particle":vy,sky:class extends Il{constructor(t,e,r,i){super(t,by,e,r,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"sky-gradient"===t?this._updateColorRamp():"sky-atmosphere-sun"!==t&&"sky-atmosphere-halo-color"!==t&&"sky-atmosphere-color"!==t&&"sky-atmosphere-sun-intensity"!==t||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=gA({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if("atmosphere"===this.paint.get("sky-type")){const r=this.paint.get("sky-atmosphere-sun"),i=!r,n=t.style.light,o=n.properties.get("position");return i&&"viewport"===n.properties.get("anchor")&&pr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),i?By(o.azimuthal,90-o.polar,e):By(r[0],90-r[1],e)}const r=this.paint.get("sky-gradient-center");return By(r[0],90-r[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return"atmosphere"===t?["skyboxCapture","skybox"]:"gradient"===t?["skyboxGradient"]:null}},slot:class extends Il{constructor(t,e,r,i){super(t,Cy,e,null)}},model:class extends Il{constructor(t,e,r,i){super(t,Wy,e,r,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new qy(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(t){return t instanceof Jv?Ao-1:0}queryIntersectsFeature(e,r,i,n,o,a){if(!this.modelManager)return!1;const s=this.modelManager,l=e.tile.getBucket(this);if(!(l&&l instanceof qy))return!1;const c=l;for(const i in c.instancesPerModel){const n=c.instancesPerModel[i],o=void 0!==r.id?r.id:r.properties&&r.properties.hasOwnProperty("id")?r.properties.id:void 0;if(n.idToFeaturesIndex.hasOwnProperty(o)){const r=n.features[n.idToFeaturesIndex[o]],l=s.getModel(i,this.scope);if(!l)return!1;let u=t.ad.create();const h=new fu(0,0),A=c.canonical;let p=Number.MAX_VALUE;for(let i=0;i<r.instancedDataCount;++i){const o=16*(r.instancedDataOffset+i),s=n.instancedDataArray.float32,c=[s[o+4],s[o+5],s[o+6]];ix(A,h,s[o],0|s[o+1]),Yy(u,l,a,h,r.rotation,r.scale,c,!1,!1,!1),"globe"===a.projection.name&&(u=Dy(u,a));const d=t.ad.multiply([],a.projMatrix,u),f=e.queryGeometry,m=Uy(f.isPointQuery()?f.screenBounds:f.screenGeometry,a,d,l.aabb);null!=m&&(p=Math.min(m,p))}return p!==Number.MAX_VALUE&&p}}return!1}_handleOverridablePaintPropertyUpdate(t,e,r){return!(!this.layout||e.isDataDriven()||r.isDataDriven()||"model-color"!==t&&"model-color-mix-intensity"!==t&&"model-rotation"!==t&&"model-scale"!==t&&"model-translation"!==t&&"model-emissive-strength"!==t)}_isPropertyZoomDependent(t){const e=this._transitionablePaint._values[t];return null!=e&&null!=e.value&&null!=e.value.expression&&e.value.expression instanceof ds}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(e,r,i,n){const o=e.tile,a=o.getBucket(this);let s=null,l=Number.MAX_VALUE;if(!(a&&a instanceof Jv))return{queryFeature:s,intersectionZ:l};const c=a.getNodesInfo()[r];if(c.hiddenByReplacement||!c.node.meshes||!i.filter(new Ws(o.tileID.overscaledZ),c.feature,o.tileID.canonical))return{queryFeature:s,intersectionZ:l};const u=c.node,h=n.calculatePosMatrix(o.tileID.toUnwrapped(),n.worldSize),A=c.evaluatedScale;let p=0;n.elevation&&u.elevation&&(p=u.elevation*n.elevation.exaggeration()),t.ad.translate(h,h,[(u.anchor?u.anchor[0]:0)*(A[0]-1),(u.anchor?u.anchor[1]:0)*(A[1]-1),p]),t.ad.scale(h,h,A),t.ad.multiply(h,h,u.matrix);const d=e.queryGeometry,f=d.isPointQuery()?d.screenBounds:d.screenGeometry,m=function(e){const r=t.ad.multiply([],h,e.matrix),i=t.ad.multiply(r,n.expandedFarZProjMatrix,r);for(let t=0;t<e.meshes.length;++t){const r=e.meshes[t];if(t===e.lightMeshIndex)continue;const o=Uy(f,n,i,r.aabb);null!=o&&(l=Math.min(o,l))}if(e.children)for(const t of e.children)m(t)};if(m(u),l===Number.MAX_VALUE)return{queryFeature:s,intersectionZ:l};const g=new fu(0,0);return ix(o.tileID.canonical,g,c.node.anchor[0],c.node.anchor[1]),s={type:"Feature",geometry:{type:"Point",coordinates:[g.lng,g.lat]},properties:c.feature.properties,id:c.feature.id,state:{},layer:this.serialize()},{queryFeature:s,intersectionZ:l}}},clip:class extends Il{constructor(t,e,r,i){super(t,np,e,r,i)}recalculate(t,e){super.recalculate(t,e)}createBucket(t){return new rp(t)}isTileClipped(){return!0}is3D(){return!0}}};bs(W_,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});const ox=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class ax{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[e,r]=new Uint8Array(t,0,2);if(219!==e)throw new Error("Data does not appear to be in a KDBush format.");const i=r>>4;if(1!==i)throw new Error(`Got v${i} data when expected v1.`);const n=ox[15&r];if(!n)throw new Error("Unrecognized array type.");const[o]=new Uint16Array(t,2,1),[a]=new Uint32Array(t,4,1);return new ax(a,o,n,t)}constructor(t,e=64,r=Float64Array,i){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+e,2),65535),this.ArrayType=r,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const n=ox.indexOf(this.ArrayType),o=2*t*this.ArrayType.BYTES_PER_ELEMENT,a=t*this.IndexArrayType.BYTES_PER_ELEMENT,s=(8-a%8)%8;if(n<0)throw new Error(`Unexpected typed array class: ${r}.`);i&&i instanceof ArrayBuffer?(this.data=i,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+a+s,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+o+a+s),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+a+s,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+n]),new Uint16Array(this.data,2,1)[0]=e,new Uint32Array(this.data,4,1)[0]=t)}add(t,e){const r=this._pos>>1;return this.ids[r]=r,this.coords[this._pos++]=t,this.coords[this._pos++]=e,r}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return sx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,e,r,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:n,coords:o,nodeSize:a}=this,s=[0,n.length-1,0],l=[];for(;s.length;){const c=s.pop()||0,u=s.pop()||0,h=s.pop()||0;if(u-h<=a){for(let a=h;a<=u;a++){const s=o[2*a],c=o[2*a+1];s>=t&&s<=r&&c>=e&&c<=i&&l.push(n[a])}continue}const A=h+u>>1,p=o[2*A],d=o[2*A+1];p>=t&&p<=r&&d>=e&&d<=i&&l.push(n[A]),(0===c?t<=p:e<=d)&&(s.push(h),s.push(A-1),s.push(1-c)),(0===c?r>=p:i>=d)&&(s.push(A+1),s.push(u),s.push(1-c))}return l}within(t,e,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:i,coords:n,nodeSize:o}=this,a=[0,i.length-1,0],s=[],l=r*r;for(;a.length;){const c=a.pop()||0,u=a.pop()||0,h=a.pop()||0;if(u-h<=o){for(let r=h;r<=u;r++)hx(n[2*r],n[2*r+1],t,e)<=l&&s.push(i[r]);continue}const A=h+u>>1,p=n[2*A],d=n[2*A+1];hx(p,d,t,e)<=l&&s.push(i[A]),(0===c?t-r<=p:e-r<=d)&&(a.push(h),a.push(A-1),a.push(1-c)),(0===c?t+r>=p:e+r>=d)&&(a.push(A+1),a.push(u),a.push(1-c))}return s}}function sx(t,e,r,i,n,o){if(n-i<=r)return;const a=i+n>>1;lx(t,e,a,i,n,o),sx(t,e,r,i,a-1,1-o),sx(t,e,r,a+1,n,1-o)}function lx(t,e,r,i,n,o){for(;n>i;){if(n-i>600){const a=n-i+1,s=r-i+1,l=Math.log(a),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(a-c)/a)*(s-a/2<0?-1:1);lx(t,e,r,Math.max(i,Math.floor(r-s*c/a+u)),Math.min(n,Math.floor(r+(a-s)*c/a+u)),o)}const a=e[2*r+o];let s=i,l=n;for(cx(t,e,i,r),e[2*n+o]>a&&cx(t,e,i,n);s<l;){for(cx(t,e,s,l),s++,l--;e[2*s+o]<a;)s++;for(;e[2*l+o]>a;)l--}e[2*i+o]===a?cx(t,e,i,l):(l++,cx(t,e,l,n)),l<=r&&(i=l+1),r<=l&&(n=l-1)}}function cx(t,e,r,i){ux(t,r,i),ux(e,2*r,2*i),ux(e,2*r+1,2*i+1)}function ux(t,e,r){const i=t[e];t[e]=t[r],t[r]=i}function hx(t,e,r,i){const n=t-r,o=e-i;return n*n+o*o}t.$=$e,t.A=Xo,t.B=qo,t.C=Vi,t.D=Pn,t.E=ki,t.G=hl,t.H=rs,t.I=Eg,t.J=Ja,t.K=function(t){const e=t.value;let r=[];if(!e)return r;const i=Tn(e);return"string"!==i?(r=r.concat([new Hy(t.key,e,`string expected, "${i}" found`)]),r):(jy(e,!0)||(r=r.concat([new Hy(t.key,e,`invalid url "${e}"`)])),r)},t.L=ll,t.M=class{constructor(t,e,r,i){this.id=t,this.position=null!=e?new fu(e[0],e[1]):new fu(0,0),this.orientation=null!=r?r:[0,0,0],this.nodes=i,this.uploaded=!1,this.aabb=new Bh([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,r){if(t.ad.multiply(e.matrix,r,e.matrix),e.meshes)for(const t of e.meshes){const r=Bh.applyTransformFast(t.aabb,e.matrix);this.aabb.encapsulate(r)}if(e.children)for(const t of e.children)this._applyTransformations(t,e.matrix)}computeBoundsAndApplyParent(){const e=t.ad.identity([]);for(const t of this.nodes)this._applyTransformations(t,e)}computeModelMatrix(t,e,r,i,n,o,a=!1){Yy(this.matrix,this,t.transform,this.position,e,r,i,n,o,a)}upload(t){if(!this.uploaded){for(const e of this.nodes)ev(e,t);for(const t of this.nodes)rv(t);this.uploaded=!0}}destroy(){for(const t of this.nodes)iv(t)}},t.N=sl,t.O=nl,t.P=Ne,t.Q=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return mr(t.expression.evaluate(e))}interpolate(t,e,r){return{x:ji(t.x,e.x,r),y:ji(t.y,e.y,r),z:ji(t.z,e.z,r),azimuthal:ji(t.azimuthal,e.azimuthal,r),polar:ji(t.polar,e.polar,r)}}},t.R=$r,t.S=cc,t.T=Gg,t.U=Ys,t.V=Hy,t.W=er,t.X=Ws,t.Y=Ru,t.Z=ds,t.a=Fg,t.a$=function(t){const{x:e,y:r}=t.point,{lng:i,lat:n}=t._center;return Zh(e,r,t.worldSize,i,n)},t.a0=il,t.a1=Wh,t.a2=ji,t.a3=Ao,t.a4=Gi,t.a5=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([t,e]){const r=mr([1,t,e]);return{x:r.x,y:r.y,z:r.z}}(t.expression.evaluate(e))}interpolate(t,e,r){return{x:ji(t.x,e.x,r),y:ji(t.y,e.y,r),z:ji(t.z,e.z,r)}}},t.a6=Qc,t.a7=Lc,t.a8=Uc,t.a9=Rc,t.aB=function(e,r){const{x:i,y:n}=e.point,o=Zh(i,n,e.worldSize/e._pixelsPerMercatorPixel,0,0);return t.ad.multiply(o,o,Gh(Dh(r)))},t.aD=Hf,t.aE=tm,t.aF=Vf,t.aG=function(t,e,r,i,n){const o=5*e+2;t.float32[o+0]=r,t.float32[o+1]=i,t.float32[o+2]=n},t.aH=Qg,t.aI=fu,t.aJ=Cg,t.aK=vu,t.aL=xu,t.aM=bh,t.aN=Ty,t.aO=yu,t.aP=Rh,t.aQ=function(t,e,r,i,n,o,a,s,l){if("globe"===l.name)return Rh(t,e,new yu(r,i,n),!1);const c=ig({z:r,x:i,y:n},l);return new Bh([(o+c.x/c.scale)*e,e*(c.y/c.scale),a],[(o+c.x2/c.scale)*e,e*(c.y2/c.scale),s])},t.aR=function(t,e,r){let i=0;for(let r=0;r<2;++r){const n=0;t[r]>n&&(i+=(t[r]-n)*(t[r]-n)),e[r]<n&&(i+=(n-e[r])*(n-e[r]))}return i},t.aS=Lu,t.aT=gh,t.aU=ou,t.aV=function(e){const r=t.ad.identity(new Float64Array(16));t.ad.multiply(r,e.pixelMatrix,e.globeMatrix);const i=[0,cu,0],n=[0,uu,0];return t._.transformMat4(i,i,r),t._.transformMat4(n,n,r),[i[0]>0&&i[0]<=e.width&&i[1]>0&&i[1]<=e.height&&!$h(e,new fu(e.center.lat,90)),n[0]>0&&n[0]<=e.width&&n[1]>0&&n[1]<=e.height&&!$h(e,new fu(e.center.lat,-90))]},t.aW=function(e,r){const{scale:i}=e.tileTransform,n=i*Ao/(e.tileSize*Math.pow(2,r.zoom-e.tileID.overscaledZ+e.tileID.canonical.z));return t.aC.scale(new Float32Array(4),r.inverseAdjustmentMatrix,[n,n])},t.aX=Iy,t.aY=Ey,t.aZ=function(e){const r=Ey(e,!0);return t.aC.invert([],[r[0],r[1],r[4],r[5]])},t.a_=_h,t.aa=Dc,t.ab=je,t.ac=function(t,e,r){const i=Math.sqrt(t*t+e*e+r*r),n=i>0?Math.acos(r/i)*He:0;let o=0!==t||0!==e?Math.atan2(-e,-t)*He+90:0;return o<0&&(o+=360),[i,o,n]},t.ae=Tg,t.af=Dg,t.ag=Sg,t.ah=function(t,e){const r={};for(let i=0;i<e.length;i++){const n=e[i];n in t&&(r[n]=t[n])}return r},t.ai=mu,t.aj=Tu,t.ak=Iu,t.al=Cl,t.am=function(t){Hr++,Hr>Qr&&(t.getActor().send("enforceCacheSizeLimit",Or),Hr=0)},t.an=mi,t.ao=class{constructor(t){this.entries={},this.scheduler=t}request(t,e,r,i){const n=this.entries[t]=this.entries[t]||{callbacks:[]};if(n.result){const[t,r]=n.result;return this.scheduler?this.scheduler.add((()=>{i(t,r)}),e):i(t,r),()=>{}}return n.callbacks.push(i),n.cancel||(n.cancel=r(((r,i)=>{n.result=[r,i];for(const t of n.callbacks)this.scheduler?this.scheduler.add((()=>{t(r,i)}),e):t(r,i);setTimeout((()=>delete this.entries[t]),3e3)}))),()=>{n.result||(n.callbacks=n.callbacks.filter((t=>t!==i)),n.callbacks.length||(n.cancel(),delete this.entries[t]))}}},t.ap=function(t,e,r){const i=JSON.stringify(t.request);return t.data&&(this.deduped.entries[i]={result:[null,t.data]}),this.deduped.request(i,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},(e=>{const i=ei(t.request,((t,i,n,o)=>{t?e(t):i&&e(null,{vectorTile:r?void 0:new bp(new Pf(i)),rawData:i,cacheControl:n,expires:o})}));return()=>{i.cancel(),e()}}),e)},t.aq=kc,t.ar=class extends Pc{constructor(t){super(t),this.current=Nc}set(t,e,r){if(this.fetchUniformLocation(t,e))for(let t=0;t<9;t++)if(r[t]!==this.current[t]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}},t.as=zc,t.at=Xe,t.au=Ye,t.aw=Tr,t.ax=Su,t.ay=Fu,t.az=function(t,e,r){t[4*e+0]=r[0],t[4*e+1]=r[1],t[4*e+2]=r[2],t[4*e+3]=r[3]},t.b=Bc,t.b$=ad,t.b0=Ge,t.b1=nu,t.b2=function(t){const e=Math.round((t+45+360)%360/90)%4;return Ke[e]},t.b3=45,t.b4=Eu,t.b5=zu,t.b6=Bh,t.b7=mr,t.b8=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},t.b9=qe,t.bA=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},t.bB=nf,t.bD=qh,t.bE=Fr,t.bF=Mr,t.bG=256,t.bH=function(e,r){const i=[0,0,0],n=jh(Dh(r.canonical));return t._.transformMat4(i,i,n),t._.transformMat4(i,i,e),i},t.bI=t=>({u_camera_to_center_distance:new Dc(t),u_extrude_scale:new Hc(t),u_device_pixel_ratio:new Dc(t),u_matrix:new Qc(t),u_inv_rot_matrix:new Qc(t),u_merc_center:new Uc(t),u_tile_id:new kc(t),u_zoom_transition:new Dc(t),u_up_dir:new kc(t),u_emissive_strength:new Dc(t)}),t.bJ=t=>({u_matrix:new Qc(t),u_pixels_to_tile_units:new Hc(t),u_device_pixel_ratio:new Dc(t),u_units_to_pixels:new Uc(t),u_dash_image:new Lc(t),u_gradient_image:new Lc(t),u_image_height:new Dc(t),u_texsize:new Uc(t),u_tile_units_to_pixels:new Dc(t),u_alpha_discard_threshold:new Dc(t),u_trim_offset:new Uc(t),u_trim_fade_range:new Uc(t),u_trim_color:new zc(t),u_emissive_strength:new Dc(t)}),t.bK=t=>({u_matrix:new Qc(t),u_texsize:new Uc(t),u_pixels_to_tile_units:new Hc(t),u_device_pixel_ratio:new Dc(t),u_image:new Lc(t),u_units_to_pixels:new Uc(t),u_tile_units_to_pixels:new Dc(t),u_alpha_discard_threshold:new Dc(t),u_trim_offset:new Uc(t)}),t.bL=$l,t.bM=Zd,t.bN=Of,t.bO=jf,t.bP=Km,t.bQ=hm,t.bR=rA,t.bS=(t,e,r,i,n,o)=>{const a=t.transform,s="globe"===a.projection.name;let l;if("map"===o.paint.get("circle-pitch-alignment"))if(s){const t=qh(a.zoom,e.canonical)*a._pixelsPerMercatorPixel;l=Float32Array.from([t,0,0,t])}else l=a.calculatePixelsToTileUnitsMatrix(r);else l=new Float32Array([a.pixelsToGLUnits[0],0,0,a.pixelsToGLUnits[1]]);const c={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(a.projection),u_matrix:t.translatePosMatrix(e.projMatrix,r,o.paint.get("circle-translate"),o.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Lr.devicePixelRatio,u_extrude_scale:l,u_inv_rot_matrix:eA,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:o.paint.get("circle-emissive-strength")};if(s){c.u_inv_rot_matrix=i,c.u_merc_center=n,c.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],c.u_zoom_transition=Wh(a.zoom);const t=n[0]*Ao,r=n[1]*Ao;c.u_up_dir=a.projection.upVector(new yu(0,0,0),t,r)}return c},t.bT=sf,t.bU=(t,e,r,i,n,o)=>{const a=t.transform;return{u_matrix:af(t,e,r,i),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:a.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:n,u_image:0,u_tile_units_to_pixels:of(e,a),u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:o}},t.bV=(t,e,r,i,n,o,a)=>{const s=t.transform,l=s.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:af(t,e,r,i),u_pixels_to_tile_units:l,u_device_pixel_ratio:o,u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:n,u_texsize:lf(r)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:of(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:a,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_color:r.paint.get("line-trim-color").toRenderColor(r.lut).toArray01(),u_emissive_strength:r.paint.get("line-emissive-strength")}},t.bW=or,t.bX=gA,t.bY=Cd,t.bZ=bu,t.b_=gd,t.ba=function(t,e,r){const i=Wh(r.zoom),n=t.style.map._antialias,o=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return 0===i&&!n&&!o},t.bb=function(e){const r=e.pixelsPerMeter,i=r/Su(1,e.center.lat),n=t.ad.identity(new Float64Array(16));return t.ad.translate(n,n,[e.point.x,e.point.y,0]),t.ad.scale(n,n,[i,i,r]),Float32Array.from(n)},t.bc=Oh,t.bd=function(t){const e=Lu-5;t=Xe(t,-e,e)/e*90;const r=Math.pow(Math.abs(Math.sin(je(t))),3);return Math.round(r*(lu.length-1))},t.be=function(e,r,i,n){const o=r.getNorth(),a=r.getSouth(),s=r.getWest(),l=r.getEast(),c=1<<e.z,u=l-s,h=o-a,A=u/su,p=-h/lu[i],d=[0,A,0,p,0,0,o,s,0];if(e.z>0){const e=180/n;t.bC.multiply(d,d,[e/u+1,0,0,0,e/h+1,0,-.5*e/A,.5*e/p,1])}return d[2]=c,d[5]=e.x,d[8]=e.y,d},t.bf=jh,t.bg=Dh,t.bh=function(e,r,i){const n=t.ad.identity(new Float64Array(16)),o=(r/(1<<e)-.5)*Math.PI*2;return t.ad.rotateY(n,i.globeMatrix,o),Float32Array.from(n)},t.bi=Pr,t.bj=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},t.bk=gy,t.bl=vy,t.bm=fy,t.bn=function(t,e){const r=document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let e=0;e<t.length;e++){const i=document.createElement("source");ri(t[e])||(r.crossOrigin="Anonymous"),i.src=t[e],r.appendChild(i)}return{cancel:()=>{}}},t.bo=Kg,t.bp=sr,t.bq=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const r=e.getSource().maxzoom,i=1<<r,n=Math.floor(t.x),o=Math.floor((t.x-n)*i),a=Math.floor(t.y*i),s=this.findDEMTileFor(new xu(r,n,r,o,a));return!(!s||!s.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,r=!0){if(this.isUsingMockSource())return null;null==e&&(e=null);const i=this._source();if(!i)return e;if(t.y<0||t.y>1)return e;const n=i.getSource().maxzoom,o=1<<n,a=Math.floor(t.x),s=t.x-a,l=new xu(n,a,n,Math.floor(s*o),Math.floor(t.y*o)),c=this.findDEMTileFor(l);if(!c||!c.dem)return e;const u=c.dem,h=1<<c.tileID.canonical.z,A=(s*h-c.tileID.canonical.x)*u.dim,p=(t.y*h-c.tileID.canonical.y)*u.dim,d=Math.floor(A),f=Math.floor(p);return(r?this.exaggeration():1)*ji(ji(u.get(d,f),u.get(d,f+1),p-f),ji(u.get(d+1,f),u.get(d+1,f+1),p-f),A-d)}getAtTileOffset(t,e,r){const i=1<<t.canonical.z;return this.getAtPointOrZero(new Ru(t.wrap+(t.canonical.x+e/Ao)/i,(t.canonical.y+r/Ao)/i))}getAtTileOffsetFunc(e,r,i,n){return o=>{const a=this.getAtTileOffset(e,o.x,o.y),s=n.upVector(e.canonical,o.x,o.y),l=n.upVectorScale(e.canonical,r,i).metersToTile;return t._.scale(s,s,a*l),s}}getForTilePoints(t,e,r,i){if(this.isUsingMockSource())return!1;const n=Yp.create(this,t,i);return!!n&&(e.forEach((t=>{t[2]=this.exaggeration()*n.getElevationAt(t[0],t[1],r)})),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const r=e.dem.tree,i=e.tileID,n=1<<t.canonical.z-i.canonical.z;let o=t.canonical.x/n-i.canonical.x,a=t.canonical.y/n-i.canonical.y,s=0;for(let e=0;e<t.canonical.z-i.canonical.z&&!r.leaves[s];e++){o*=2,a*=2;const t=2*Math.floor(a)+Math.floor(o);s=r.childOffsets[s]+t,o%=1,a%=1}return{min:this.exaggeration()*r.minimums[s],max:this.exaggeration()*r.maximums[s]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const t=this.visibleDemTiles;if(0===t.length)return null;let e=!1,r=Number.MAX_VALUE,i=Number.MIN_VALUE;for(const n of t){const t=this.getMinMaxForTile(n.tileID);t&&(r=Math.min(r,t.min),i=Math.max(i,t.max),e=!0)}return e?{min:r,max:i}:null}},t.br=Ih,t.bs=Sh,t.bt=Dl,t.bu=Jl,t.bv=Y_,t.bw=sv,t.bx=pv,t.by=i_,t.bz=dA,t.c=jv,t.c$=ti,t.c0=450,t.c1=7,t.c2=my,t.c3=X_,t.c4=256,t.c5=kh,t.c6=Gh,t.c7=Pl,t.c8=Ql,t.c9=rc,t.cA=function(t){let e=1/0,r=1/0,i=-1/0,n=-1/0;for(const o of t)e=Math.min(e,o.x),r=Math.min(r,o.y),i=Math.max(i,o.x),n=Math.max(n,o.y);return{min:new Ne(e,r),max:new Ne(i,n)}},t.cB=ah,t.cC=Qu,t.cD=iu,t.cE=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.cF=bm,t.cG=$u,t.cH=Rp,t.cI=Op,t.cJ=qm,t.cK=ax,t.cL=function(t){return t({pluginStatus:Ns,pluginURL:Vs}),Gs.on("pluginStateChange",t),t},t.cM=Lm,t.cN=Pm,t.cO=Jr,t.cP=Hs,t.cQ=o,t.cR=Ur,t.cS=Fi,t.cT=hr,t.cU=function(t){const e=t.indexOf(Bl);return e>=0?t.slice(0,e):t},t.cV=function(t){return t.indexOf(Bl)>=0},t.cW=function(t){const e=t.indexOf(Bl);return e>=0?t.slice(e+1):""},t.cX=function(t){const e=[],r=t.id;return void 0===r&&e.push({message:`layers.${r}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${r}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},t.cY=function(t,e,r,i){return"custom"===t.type?new xy(t,e):new nx[t.type](t,e,r,i)},t.cZ=ur,t.c_=Gs,t.ca=1,t.cb=Mg,t.cc=0,t.cd=ic,t.ce=function(t,e,r,i,n){return Xe((t-e)/(r-e)*(n-i)+i,i,n)},t.cf=Va,t.cg=Uu,t.ch=class{constructor(t,e,r,i){this.context=t,this.format=i,this.size=r,this.texture=t.gl.createTexture();const[n,o,a]=this.size,{gl:s}=t;s.bindTexture(s.TEXTURE_3D,this.texture),t.pixelStoreUnpackFlipY.set(!1),t.pixelStoreUnpack.set(1),t.pixelStoreUnpackPremultiplyAlpha.set(!1);let l=this.format,c=s.UNSIGNED_BYTE;this.format===s.DEPTH_COMPONENT&&(l=s.DEPTH_COMPONENT16,c=s.UNSIGNED_SHORT),this.format===s.R8&&(i=s.RED),this.format===s.R32F&&(c=s.FLOAT,i=s.RED),s.texImage3D(s.TEXTURE_3D,0,l,n,o,a,0,i,c,e.data)}bind(t,e){const{context:r}=this,{gl:i}=r;i.bindTexture(i.TEXTURE_3D,this.texture),t!==this.minFilter&&(i.texParameteri(i.TEXTURE_3D,i.TEXTURE_MAG_FILTER,t),i.texParameteri(i.TEXTURE_3D,i.TEXTURE_MIN_FILTER,t),this.minFilter=t),e!==this.wrapS&&(i.texParameteri(i.TEXTURE_3D,i.TEXTURE_WRAP_S,e),i.texParameteri(i.TEXTURE_3D,i.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}},t.ci=Dy,t.cj=[1,1,1],t.ck=Yp,t.cl=$y,t.cm=Zl,t.cn=nc,t.co=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Ne(1/0,1/0),max:new Ne(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t,e=!1){const r=Dp(new Ne(0,0),new Ne(Ao,Ao),t),i=[];if(e&&!Pp(r,this._globalClipBounds))return i;for(const e of this._activeRegions){if(e.hiddenByOverlap)continue;if(!Pp(r,e))continue;const n=Up(e.min,e.max,t);i.push({min:n.min,max:n.max,sourceId:this._sourceIds[e.priority],footprint:e.footprint,footprintTileId:e.tileId,order:e.order,clipMask:e.clipMask})}return i}setSources(t){this._setSources(t.map((t=>({getSourceId:()=>t.cache.id,getFootprints:()=>{const e=[];for(const r of t.cache.getVisibleCoordinates()){const i=t.cache.getTile(r).buckets[t.layer];i&&i.updateFootprints(r.toUnwrapped(),e)}return e},getOrder:()=>t.order,getClipMask:()=>t.clipMask}))))}_addSource(t){const e=t.getFootprints();if(0===e.length)return;const r=t.getOrder(),i=t.getClipMask();for(const t of e){if(!t.footprint)continue;const e=Dp(t.footprint.min,t.footprint.max,t.id);this._activeRegions.push({min:e.min,max:e.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:t.id,footprint:t.footprint,order:r,clipMask:i})}this._sourceIds.push(t.getSourceId())}_computeReplacement(){this._activeRegions.sort(((t,e)=>t.priority-e.priority||Mp(t.min,e.min)||Mp(t.max,e.max)));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0;for(;!t&&e!==this._activeRegions.length;){const r=this._activeRegions[e],i=this._prevRegions[e];t=r.priority!==i.priority||!Fp(r,i)||r.order!==i.order||r.clipMask!==i.clipMask,++e}}if(t){++this._updateTime;for(const t of this._activeRegions)t.order!==1/0&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,t.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,t.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,t.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,t.max.y));const t=t=>{const e=this._activeRegions;if(t>=e.length)return t;const r=e[t].priority;for(;t<e.length&&e[t].priority===r;)++t;return t};if(this._sourceIds.length>1){let e=0,r=t(e);for(;e!==r;){let i=e;const n=e;for(;i!==r;){const t=this._activeRegions[i];t.hiddenByOverlap=!1;for(let e=0;e<n;e++){const r=this._activeRegions[e];if(!r.hiddenByOverlap&&t.order===1/0&&Pp(t,r)&&(t.hiddenByOverlap=zp(t.footprint,t.tileId,r.footprint,r.tileId),t.hiddenByOverlap))break}++i}e=r,r=t(e)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},t.cp=kl,t.cq=t_,t.cr=ac,t.cs=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){const r=new Dl,i=new Jl,n=[],o=t+1+2,a=e[0]+1,s=e[0]+1+(1+e.length),l=(t,e,r)=>{let i=t===o-1?t-2:0===t?t:t-1;return i+=r?24575:0,[i,e]};for(let t=0;t<o;++t)r.emplaceBack(...l(t,0,!0));for(let t=0;t<a;++t)for(let e=0;e<o;++e)r.emplaceBack(...l(e,t,(0===e||e===o-1)&&!0));for(let t=0;t<e.length;++t){const i=e[t];for(let t=0;t<o;++t)r.emplaceBack(...l(t,i,!0))}for(let t=0;t<e.length;++t){const a=i.length,l=e[t]+1+2,c=new Jl;for(let r=0;r<l-1;r++){const n=r===l-2,a=n?o*(s-e.length+t-r):o;for(let t=0;t<o-1;t++){const e=r*o+t;0===r||n||0===t||t===o-2?(c.emplaceBack(e+1,e,e+a),c.emplaceBack(e+a,e+a+1,e+1)):(i.emplaceBack(e+1,e,e+a),i.emplaceBack(e+a,e+a+1,e+1))}}const u=Bc.simpleSegment(0,a,r.length,i.length-a);for(let t=0;t<c.uint16.length;t+=3)i.emplaceBack(c.uint16[t],c.uint16[t+1],c.uint16[t+2]);const h=Bc.simpleSegment(0,a,r.length,i.length-a);n.push({withoutSkirts:u,withSkirts:h})}return{vertices:r,indices:i,segments:n}}_createGrid(t){const e=this._fillGridMeshWithLods(su,lu);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,Ih.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new Jl;for(let t=0;t<=su;t++)e.emplaceBack(0,t+1,t+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const r=new rc,i=new rc,n=new rc,o=new rc;this._poleSegments=[];for(let t=0,e=0;t<nu;t++){const a=360/(1<<t);r.emplaceBack(0,-iu,0,.5,0),i.emplaceBack(0,-iu,0,.5,1),n.emplaceBack(0,-iu,0,.5,.5),o.emplaceBack(0,-iu,0,.5,.5);for(let t=0;t<=su;t++){let e=t/su,s=0;const l=ji(0,a,e),[c,u,h]=hu(Jh,tA,l,iu);r.emplaceBack(c,u,h,e,s),i.emplaceBack(c,u,h,e,1-s);const A=je(l);e=.5+.5*Math.sin(A),s=.5+.5*Math.cos(A),n.emplaceBack(c,u,h,e,s),o.emplaceBack(c,u,h,e,1-s)}this._poleSegments.push(Bc.simpleSegment(e,0,66,64)),e+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(r,Eh,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(i,Eh,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(n,Eh,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(o,Eh,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},t.ct=function(t){return Ci.has(t)},t.cu=Jp,t.cv=function(t,e,r=0,i=!0){const n=new Ne(r,r),o=t.sub(n),a=e.add(n),s=[o,new Ne(a.x,o.y),a,new Ne(o.x,a.y)];return i&&s.push(o.clone()),s},t.cw=function(t,e){const r=[];for(let i=0;i<t.length;i++){const n=Ye(i-1,-1,t.length-1),o=Ye(i+1,-1,t.length-1),a=t[i],s=t[o],l=t[n].sub(a).unit(),c=s.sub(a).unit(),u=c.angleWithSep(l.x,l.y),h=l.add(c).unit().mult(-1*e/Math.sin(u/2));r.push(a.add(h))}return r},t.cx=ng,t.cy=sh,t.cz=function(e,r,i=0){return t._.fromValues(((r.x-i)*e.scale-e.x)*Ao,(r.y*e.scale-e.y)*Ao,Pu(r.z,r.y))},t.d=Li,t.d$=Oe,t.d0=Ze,t.d1=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},t.d2=We,t.d3=ku,t.d4=Au,t.d5=function([t,e,r]){const i=Math.hypot(t,e,r),n=Math.atan2(t,r),o=.5*Math.PI-Math.acos(-e/i);return new fu(Ge(n),Ge(o))},t.d6=Mu,t.d7=pu,t.d8=i,t.d9=$h,t.dA=function(t){const e=Nr();if(!e)return;const r=e.delete(kr);t&&r.catch(t).then((()=>t()))},t.dB=lv,t.dC=vv,t.dD=function(t){fv=Lr.resolveURL(t),yv||(yv=new sv(pv(),new ki)),yv.broadcast("setDracoUrl",fv)},t.dE=xv,t.dF=function(t){gv=Lr.resolveURL(t),yv||(yv=new sv(pv(),new ki)),yv.broadcast("setMeshoptUrl",gv)},t.dG=tr,t.dH=bs,t.dI=AA,t.dJ=Fm,t.dK=ig,t.dL=Ac,t.dM=cf,t.dN=kf,t.dO=Wd,t.dP=cr,t.dQ=Tm,t.dR=jg,t.dS=function(t,e,r,i,n,o,a,s,l,c,u){t.createArrays(),t.tilePixelRatio=Ao/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const h=t.layers[0].layout,A=t.layers[0]._unevaluatedLayout._values,p={};if("composite"===t.textSizeData.kind){const{minZoom:e,maxZoom:r}=t.textSizeData;p.compositeTextSizes=[A["text-size"].possiblyEvaluate(new Ws(e),s),A["text-size"].possiblyEvaluate(new Ws(r),s)]}if("composite"===t.iconSizeData.kind){const{minZoom:e,maxZoom:r}=t.iconSizeData;p.compositeIconSizes=[A["icon-size"].possiblyEvaluate(new Ws(e),s),A["icon-size"].possiblyEvaluate(new Ws(r),s)]}p.layoutTextSize=A["text-size"].possiblyEvaluate(new Ws(l+1),s),p.layoutIconSize=A["icon-size"].possiblyEvaluate(new Ws(l+1),s),p.textMaxSize=A["text-size"].possiblyEvaluate(new Ws(18),s);const d="map"===h.get("text-rotation-alignment")&&"point"!==h.get("symbol-placement"),f=h.get("text-size");let m=!1;for(const e of t.features)if(e.icon&&e.icon.nameSecondary){m=!0;break}for(const o of t.features){const l=h.get("text-font").evaluate(o,{},s).join(","),A=f.evaluate(o,{},s),g=p.layoutTextSize.evaluate(o,{},s),_=(p.layoutIconSize.evaluate(o,{},s),{horizontal:{},vertical:void 0}),y=o.text;let v,x=[0,0];if(y){const i=y.toString(),a=h.get("text-letter-spacing").evaluate(o,{},s)*Of,c=h.get("text-line-height").evaluate(o,{},s)*Of,u=Ms(i)?a:0,p=h.get("text-anchor").evaluate(o,{},s),f=h.get("text-variable-anchor");if(!f){const t=h.get("text-radial-offset").evaluate(o,{},s);x=t?Km(p,[t*Of,jm]):h.get("text-offset").evaluate(o,{},s).map((t=>t*Of))}let m=d?"center":h.get("text-justify").evaluate(o,{},s);const v="point"===h.get("symbol-placement"),w=v?h.get("text-max-width").evaluate(o,{},s)*Of:1/0,b=o=>{t.allowVerticalPlacement&&Ss(i)&&(_.vertical=im(y,e,r,n,l,w,c,p,o,u,x,tm.vertical,!0,g,A))};if(!d&&f){const t="auto"===m?f.map((t=>qm(t))):[m];let i=!1;for(let o=0;o<t.length;o++){const a=t[o];if(!_.horizontal[a])if(i)_.horizontal[a]=_.horizontal[0];else{const t=im(y,e,r,n,l,w,c,"center",a,u,x,tm.horizontal,!1,g,A);t&&(_.horizontal[a]=t,i=1===t.positionedLines.length)}}b("left")}else{if("auto"===m&&(m=qm(p)),v||h.get("text-writing-mode").indexOf("horizontal")>=0||!Ss(i)){const t=im(y,e,r,n,l,w,c,p,m,u,x,tm.horizontal,!1,g,A);t&&(_.horizontal[m]=t)}b(v?"left":m)}}let w=!1;if(o.icon&&o.icon.namePrimary){const e=i[o.icon.namePrimary];e&&(v=pm(n[o.icon.namePrimary],o.icon.nameSecondary?n[o.icon.nameSecondary]:void 0,h.get("icon-offset").evaluate(o,{},s),h.get("icon-anchor").evaluate(o,{},s)),w=e.sdf,void 0===t.sdfIcons?t.sdfIcons=e.sdf:t.sdfIcons!==e.sdf&&pr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(e.pixelRatio!==t.pixelRatio||0!==h.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}const b=Ym(_.horizontal)||_.vertical;t.iconsInText||(t.iconsInText=!!b&&b.iconsInText),(b||v)&&Zm(t,o,_,v,i,p,g,0,x,w,a,s,c,u,m)}o&&t.generateCollisionDebugBuffers(l,t.collisionBoxArray)},t.dT=Jd,t.dU=$A,t.dV=bp,t.dW=Pf,t.dX=$p,t.dY=q_,t.dZ=Bp,t.d_=hp,t.da=Xh,t.db=function(e){const r=[0,0,0],i=t.ad.identity(new Float64Array(16));return t.ad.multiply(i,e.pixelMatrix,e.globeMatrix),t._.transformMat4(r,r,i),new Ne(r[0],r[1])},t.dc=u,t.dd=c,t.de=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!function(t){if(null==Cr){const e=t.navigator?t.navigator.userAgent:null;Cr=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Cr}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},t.df=ir,t.dg=class{constructor(t,e,r){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const t=function(){let t="";for(let e=0;e<10;e++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",si,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,r){if(!o(t))return t;const i=ui(t);return i.params.push(`sdk=js-${e}`),i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||r)}normalizeGlyphsURL(t,e){if(!o(t))return t;const r=ui(t);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeModelURL(t,e){if(!o(t))return t;const r=ui(t);return r.path=`/models/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeSourceURL(t,e,r,i){if(!o(t))return t;const n=ui(t);return n.path=`/v4/${n.authority}.json`,n.params.push("secure"),r&&n.params.push(`language=${r}`),i&&n.params.push(`worldview=${i}`),this._makeAPIURL(n,this._customAccessToken||e)}normalizeSpriteURL(t,e,r,i){const n=ui(t);return o(t)?(n.path=`/styles/v1${n.path}/sprite${e}${r}`,this._makeAPIURL(n,this._customAccessToken||i)):(n.path+=`${e}${r}`,hi(n))}normalizeTileURL(t,e,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!o(t))return t;const n=ui(t);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||r&&"raster"!==n.authority&&512===r?"@2x":""}${jr.supported?".webp":"$1"}`),"raster"===n.authority?n.path=`/${i.RASTER_URL_PREFIX}${n.path}`:"rasterarrays"===n.authority?n.path=`/${i.RASTERARRAYS_URL_PREFIX}${n.path}`:"3dtiles"===n.authority?n.path=`/${i.TILES3D_URL_PREFIX}${n.path}`:(n.path=n.path.replace(/^.+\/v4\//,"/"),n.path=`/${i.TILE_URL_VERSION}${n.path}`);const a=this._customAccessToken||function(t){for(const e of t){const t=e.match(/^access_token=(.*)$/);if(t)return t[1]}return null}(n.params)||i.ACCESS_TOKEN;return i.REQUIRE_ACCESS_TOKEN&&a&&this._skuToken&&n.params.push(`sku=${this._skuToken}`),this._makeAPIURL(n,a)}canonicalizeTileURL(t,e){const r=ui(t);if(!r.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!r.path.match(/\.[\w]+$/))return t;let n="mapbox://";r.path.match(/^\/raster\/v1\//)?n+=`raster/${r.path.replace(`/${i.RASTER_URL_PREFIX}/`,"")}`:r.path.match(/^\/rasterarrays\/v1\//)?n+=`rasterarrays/${r.path.replace(`/${i.RASTERARRAYS_URL_PREFIX}/`,"")}`:n+=`tiles/${r.path.replace(`/${i.TILE_URL_VERSION}/`,"")}`;let o=r.params;return e&&(o=o.filter((t=>!t.match(/^access_token=/)))),o.length&&(n+=`?${o.join("&")}`),n}canonicalizeTileset(t,e){const r=!!e&&o(e),i=[];for(const e of t.tiles||[])n(e)?i.push(this.canonicalizeTileURL(e,r)):i.push(e);return i}_makeAPIURL(t,e){const r="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",n=ui(i.API_URL);if(t.protocol=n.protocol,t.authority=n.authority,"http"===t.protocol){const e=t.params.indexOf("secure");e>=0&&t.params.splice(e,1)}if("/"!==n.path&&(t.path=`${n.path}${t.path}`),!i.REQUIRE_ACCESS_TOKEN)return hi(t);if(e=e||i.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return t.params=t.params.filter((t=>-1===t.indexOf("access_token"))),t.params.push(`access_token=${e||""}`),hi(t)}},t.dh=function(t,e){e?Ci.add(t):Ci.delete(t)},t.di=jr,t.dj=wi,t.dk=Bi,t.dl=li,t.dm=_i,t.dn=vi,t.dp=function(t){Ci.delete(t)},t.dq=bi,t.dr=gi,t.ds=Je,t.dt=e,t.du=function(t,e){Or=t,Qr=e},t.dv=function(t,e,r=!1){if(Ns===zs||Ns===Rs||Ns===Os)throw new Error("setRTLTextPlugin cannot be called multiple times.");Vs=Lr.resolveURL(t),Ns=zs,Qs=e,js(),r||qs()},t.dw=Ks,t.dx=function(){pv().acquire(uv)},t.dy=function(){const t=Av;t&&(t.isPreloaded()&&1===t.numActive()?(t.release(uv),Av=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},t.dz=hv,t.e=Lr,t.e0=hf,t.e1=A,t.e2=ei,t.e3=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==Mv){const r=new Uint32Array(t,0,7),[,,i,n,o,a]=r;e=r.byteLength+n+o+a+o,(i!==t.byteLength||e>=t.byteLength)&&pr("Invalid b3dm header information.")}return kv(t,e)},t.e4=function(t,e){const r=jv(t);for(const t of r){for(const e of t.meshes)Gv(e);t.lights&&(t.lightMeshIndex=t.meshes.length,t.meshes.push(Kv(t.lights,e)))}return r},t.e5=Jv,t.e6=av,t.e7=Zs,t.e8=function(t){Vr(),zr&&zr.then((e=>{e.keys().then((r=>{for(let i=0;i<r.length-t;i++)e.delete(r[i])}))}))},t.f=Pi,t.g=function(t,e){return ti(er(t,{type:"json"}),e)},t.h=ai,t.i=pA,t.j=Bm,t.k=Em,t.l=function(t){return fetch(t).then((t=>t.arrayBuffer())).then((e=>kv(e,0,t)))},t.m=class extends Hy{},t.n=Tn,t.o=qi,t.p=e_,t.q=Ya,t.r=ts,t.s=es,t.t=hs,t.u=cl,t.v=ul,t.w=pr,t.x=fs,t.y=As,t.z=Zo})),i(["./shared"],(function(t){function e(t){const e=t?t.url.toString():void 0;return e?performance.getEntriesByName(e):[]}function r(t){if("number"==typeof t||"boolean"==typeof t||"string"==typeof t||null==t)return JSON.stringify(t);if(Array.isArray(t)){let e="[";for(const i of t)e+=`${r(i)},`;return`${e}]`}let e="{";for(const i of Object.keys(t).sort())e+=`${i}:${r(t[i])},`;return`${e}}`}function i(e){let i="";for(const n of t.cE)i+=`/${r(e[n])}`;return i}class n{constructor(t){this.keyCache={},this._layers={},this._layerConfigs={},t&&this.replace(t)}replace(t,e){this._layerConfigs={},this._layers={},this.update(t,[],e)}update(e,r,n){this._options=n;for(const r of e)this._layerConfigs[r.id]=r,(this._layers[r.id]=t.cY(r,this.scope,null,this._options)).compileFilter(),this.keyCache[r.id]&&delete this.keyCache[r.id];for(const t of r)delete this.keyCache[t],delete this._layerConfigs[t],delete this._layers[t];this.familiesBySource={};const o=function(t,e){const r={};for(let n=0;n<t.length;n++){const o=e&&e[t[n].id]||i(t[n]);e&&(e[t[n].id]=o);let a=r[o];a||(a=r[o]=[]),a.push(t[n])}const n=[];for(const t in r)n.push(r[t]);return n}(t.dG(this._layerConfigs),this.keyCache);for(const t of o){const e=t.map((t=>this._layers[t.id])),r=e[0];if("none"===r.visibility)continue;const i=r.source||"";let n=this.familiesBySource[i];n||(n=this.familiesBySource[i]={});const o=r.sourceLayer||"_geojsonTileLayer";let a=n[o];a||(a=n[o]=[]),a.push(e)}}}const o=1*t.dJ;class a{constructor(e){const r={},i=[];for(const t in e){const n=e[t],a=r[t]={};for(const t in n.glyphs){const e=n.glyphs[+t];if(!e||0===e.bitmap.width||0===e.bitmap.height)continue;const r=e.metrics.localGlyph?o:1,s={x:0,y:0,w:e.bitmap.width+2*r,h:e.bitmap.height+2*r};i.push(s),a[t]=s}}const{w:n,h:a}=t.j(i),s=new t.dI({width:n||1,height:a||1});for(const i in e){const n=e[i];for(const e in n.glyphs){const a=n.glyphs[+e];if(!a||0===a.bitmap.width||0===a.bitmap.height)continue;const l=r[i][e],c=a.metrics.localGlyph?o:1;t.dI.copy(a.bitmap,s,{x:0,y:0},{x:l.x+c,y:l.y+c},a.bitmap)}}this.image=s,this.positions=r}}t.dH(a,"GlyphAtlas");class s{constructor(e){this.tileID=new t.aL(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.lut=e.lut,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.scope=e.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.promoteId=e.promoteId,this.isSymbolTile=e.isSymbolTile,this.tileTransform=t.dK(e.tileID.canonical,e.projection),this.projection=e.projection,this.brightness=e.brightness,this.extraShadowCaster=!!e.extraShadowCaster,this.tessellationStep=e.tessellationStep}parse(e,r,i,n,o){this.status="parsing",this.data=e,this.collisionBoxArray=new t.dL;const s=new t.dM(Object.keys(e.layers).sort()),c=new t.dN(this.tileID,this.promoteId);c.bucketLayerIDs=[];const u={},h=new t.dO(256,256),A={featureIndex:c,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:h,availableImages:i,brightness:this.brightness},p=r.familiesBySource[this.source];for(const r in p){const n=e.layers[r];if(!n)continue;let o=!1,a=!1,h=!1;for(const t of p[r])"symbol"===t[0].type?o=!0:a=!0,t[0].is3D()&&"model"!==t[0].type&&(h=!0);if(this.extraShadowCaster&&!h)continue;if(!0===this.isSymbolTile&&!o)continue;if(!1===this.isSymbolTile&&!a)continue;1===n.version&&t.w(`Vector tile source "${this.source}" layer "${r}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const d=s.encode(r),f=[];for(let t=0;t<n.length;t++){const e=n.feature(t),i=c.getId(e,r);f.push({feature:e,id:i,index:t,sourceLayerIndex:d})}for(const t of p[r]){const e=t[0];(!this.extraShadowCaster||e.is3D()&&"model"!==e.type)&&(void 0!==this.isSymbolTile&&"symbol"===e.type!==this.isSymbolTile||e.minzoom&&this.zoom<Math.floor(e.minzoom)||e.maxzoom&&this.zoom>=e.maxzoom||"none"!==e.visibility&&(l(t,this.zoom,A.brightness,i),(u[e.id]=e.createBucket({index:c.bucketLayerIDs.length,layers:t,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:d,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(f,A,this.tileID.canonical,this.tileTransform),c.bucketLayerIDs.push(t.map((t=>t.id)))))}}let d,f,m,g;h.trim();const _={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},y=()=>{if(d)return this.status="done",o(d);if(this.extraShadowCaster)this.status="done",o(null,{buckets:t.dG(u).filter((t=>!t.isEmpty())),featureIndex:c,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:A.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(f&&m&&g){const e=new a(f),r=new t.dQ(m,g,this.lut);for(const n in u){const o=u[n];o instanceof t.dR?(l(o.layers,this.zoom,A.brightness,i),t.dS(o,f,e.positions,m,r.iconPositions,this.showCollisionBoxes,i,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):o.hasPattern&&(o instanceof t.dT||o instanceof t.dU||o instanceof t.b_)&&(l(o.layers,this.zoom,A.brightness,i),o.addFeatures(A,this.tileID.canonical,r.patternPositions,i,this.tileTransform,this.brightness))}this.status="done",o(null,{buckets:t.dG(u).filter((t=>!t.isEmpty())),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,lineAtlas:h,imageAtlas:r,brightness:A.brightness})}};if(!this.extraShadowCaster){const e=t.dP(A.glyphDependencies,(t=>Object.keys(t).map(Number)));Object.keys(e).length?n.send("getGlyphs",{uid:this.uid,stacks:e,scope:this.scope},((t,e)=>{d||(d=t,f=e,y())}),void 0,!1,_):f={};const r=Object.keys(A.iconDependencies);r.length?n.send("getImages",{icons:r,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((t,e)=>{d||(d=t,m=e,y())}),void 0,!1,_):m={};const i=Object.keys(A.patternDependencies);i.length?n.send("getImages",{icons:i,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((t,e)=>{d||(d=t,g=e,y())}),void 0,!1,_):g={}}y()}}function l(e,r,i,n){const o=new t.X(r,{brightness:i});for(const t of e)t.recalculate(o,n)}class c extends t.E{constructor(e,r,i,n,o,a){super(),this.actor=e,this.layerIndex=r,this.availableImages=i,this.loadVectorData=o||t.ap,this.loading={},this.loaded={},this.deduped=new t.ao(e.scheduler),this.isSpriteLoaded=n,this.scheduler=e.scheduler,this.brightness=a}loadTile(r,i){const n=r.uid,o=r&&r.request,a=o&&o.collectResourceTiming,l=this.loading[n]=new s(r);l.abort=this.loadVectorData(r,((s,c)=>{const u=!this.loading[n];if(delete this.loading[n],u||s||!c)return l.status="done",u||(this.loaded[n]=l),i(s);const h=c.rawData,A={};c.expires&&(A.expires=c.expires),c.cacheControl&&(A.cacheControl=c.cacheControl),l.vectorTile=c.vectorTile||new t.dV(new t.dW(h));const p=()=>{l.parse(l.vectorTile,this.layerIndex,this.availableImages,this.actor,((r,n)=>{if(r||!n)return i(r);const s={};if(a){const t=e(o);t.length>0&&(s.resourceTiming=JSON.parse(JSON.stringify(t)))}i(null,t.W({rawTileData:h.slice(0)},n,A,s))}))};this.isSpriteLoaded?p():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(p,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom}):p()})),this.loaded=this.loaded||{},this.loaded[n]=l}))}reloadTile(e,r){const i=this.loaded,n=e.uid;if(i&&i[n]){const o=i[n];o.showCollisionBoxes=e.showCollisionBoxes,o.projection=e.projection,o.brightness=e.brightness,o.tileTransform=t.dK(e.tileID.canonical,e.projection),o.extraShadowCaster=e.extraShadowCaster,o.lut=e.lut;const a=(t,e)=>{const i=o.reloadCallback;i&&(delete o.reloadCallback,o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,i)),r(t,e)};"parsing"===o.status?o.reloadCallback=a:"done"===o.status&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,a):a())}else r(null,void 0)}abortTile(t,e){const r=t.uid,i=this.loading[r];i&&(i.abort&&i.abort(),delete this.loading[r]),e()}removeTile(t,e){const r=this.loaded,i=t.uid;r&&r[i]&&delete r[i],e()}}class u{loadTile(e,r){const{uid:i,encoding:n,rawImageData:o,padding:a}=e,s=ImageBitmap&&o instanceof ImageBitmap?this.getImageData(o,a):o;r(null,new t.dX(i,s,n,a<1))}getImageData(t,e){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(t.width,t.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=t.width,this.offscreenCanvas.height=t.height,this.offscreenCanvasContext.drawImage(t,0,0,t.width,t.height);const r=this.offscreenCanvasContext.getImageData(-e,-e,t.width+2*e,t.height+2*e);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),r}}class h{decodeRasterArray({task:e,buffer:r},i){t.dY.performDecoding(r,e).then((t=>{i(null,t)}),(t=>{i(t)}))}}const A=t.dZ.prototype.toGeoJSON;let p=class{constructor(e){this._feature=e,this.extent=t.a3,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))}loadGeometry(){if(1===this._feature.type){const e=[];for(const r of this._feature.geometry)e.push([new t.P(r[0],r[1])]);return e}{const e=[];for(const r of this._feature.geometry){const i=[];for(const e of r)i.push(new t.P(e[0],e[1]));e.push(i)}return e}}toGeoJSON(t,e,r){return A.call(this,t,e,r)}},d=class{constructor(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.a3,this.length=e.length,this._features=e}feature(t){return new p(this._features[t])}};const f=64/4096;class m{constructor(){this.features=new Map}clear(){this.features.clear()}load(t=[],e){for(const r of t){const t=r.id;if(null==t)continue;let i=this.features.get(t);i&&this.updateCache(i,e),r.geometry?(i=_(r),this.updateCache(i,e),this.features.set(t,i)):this.features.delete(t),this.updateCache(i,e)}}updateCache(t,e){for(const{canonical:r,uid:i}of Object.values(e)){const{z:n,x:o,y:a}=r;g(t,Math.pow(2,n),o,a)&&delete e[i]}}getTile(t,e,r){const i=Math.pow(2,t),n=[];for(const t of this.features.values())g(t,i,e,r)&&n.push(w(t,i,e,r));return{features:n}}getFeatures(){return[...this.features.values()]}}function g({minX:t,minY:e,maxX:r,maxY:i},n,o,a){return t<(o+1+f)/n&&e<(a+1+f)/n&&r>(o-f)/n&&i>(a-f)/n}function _(t){const{id:e,geometry:r,properties:i}=t;if(!r)return;if("GeometryCollection"===r.type)throw new Error("GeometryCollection not supported in dynamic mode.");const{type:n,coordinates:o}=r,a={id:e,type:1,geometry:[],tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},s=a.geometry;if("Point"===n)y(o,s,a);else if("MultiPoint"===n)for(const t of o)y(t,s,a);else if("LineString"===n)a.type=2,v(o,s,a);else if("MultiLineString"===n)a.type=2,x(o,s,a);else if("Polygon"===n)a.type=3,x(o,s,a,!0);else{if("MultiPolygon"!==n)throw new Error("Input data is not a valid GeoJSON object.");a.type=3;for(const t of o)x(t,s,a,!0)}return a}function y([e,r],i,n){const o=t.aj(e);let a=t.ak(r);a=a<0?0:a>1?1:a,i.push(o,a),n.minX=Math.min(n.minX,o),n.minY=Math.min(n.minY,a),n.maxX=Math.max(n.maxX,o),n.maxY=Math.max(n.maxY,a)}function v(t,e,r,i=!1,n=!1){const o=[];for(const e of t)y(e,o,r);e.push(o),i&&function(t,e){let r=0;for(let e=0,i=t.length,n=i-2;e<i;n=e,e+=2)r+=(t[e]-t[n])*(t[e+1]+t[n+1]);if(r>0===e)for(let e=0,r=t.length;e<r/2;e+=2){const i=t[e],n=t[e+1];t[e]=t[r-2-e],t[e+1]=t[r-1-e],t[r-2-e]=i,t[r-1-e]=n}}(o,n)}function x(t,e,r,i=!1){for(let n=0;n<t.length;n++)v(t[n],e,r,i,0===n)}function w(t,e,r,i){const{id:n,type:o,geometry:a,tags:s}=t,l=[];if(1===o)b(a,e,r,i,l);else for(const t of a)l.push(b(t,e,r,i));return{id:n,type:o,geometry:l,tags:s}}function b(t,e,r,i,n=[]){for(let o=0;o<t.length;o+=2)n.push(B(t[o],t[o+1],e,r,i));return n}function B(e,r,i,n,o){return[Math.round(t.a3*(e*i-n)),Math.round(t.a3*(r*i-o))]}var C={exports:{}},E=t.d$,T=t.d_.VectorTileFeature,I=S;function S(t,e){this.options=e||{},this.features=t,this.length=t.length}function M(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}S.prototype.feature=function(t){return new M(this.features[t],this.options.extent)},M.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var e=0;e<t.length;e++){for(var r=t[e],i=[],n=0;n<r.length;n++)i.push(new E(r[n][0],r[n][1]));this.geometry.push(i)}return this.geometry},M.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,r=-1/0,i=1/0,n=-1/0,o=0;o<t.length;o++)for(var a=t[o],s=0;s<a.length;s++){var l=a[s];e=Math.min(e,l.x),r=Math.max(r,l.x),i=Math.min(i,l.y),n=Math.max(n,l.y)}return[e,i,r,n]},M.prototype.toGeoJSON=T.prototype.toGeoJSON;var F=t.e0,P=I;function L(t){var e=new F;return function(t,e){for(var r in t.layers)e.writeMessage(3,D,t.layers[r])}(t,e),e.finish()}function D(t,e){var r;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var i={keys:[],values:[],keycache:{},valuecache:{}};for(r=0;r<t.length;r++)i.feature=t.feature(r),e.writeMessage(2,U,i);var n=i.keys;for(r=0;r<n.length;r++)e.writeStringField(3,n[r]);var o=i.values;for(r=0;r<o.length;r++)e.writeMessage(4,Q,o[r])}function U(t,e){var r=t.feature;void 0!==r.id&&e.writeVarintField(1,r.id),e.writeMessage(2,k,t),e.writeVarintField(3,r.type),e.writeMessage(4,O,r)}function k(t,e){var r=t.feature,i=t.keys,n=t.values,o=t.keycache,a=t.valuecache;for(var s in r.properties){var l=r.properties[s],c=o[s];if(null!==l){void 0===c&&(i.push(s),o[s]=c=i.length-1),e.writeVarint(c);var u=typeof l;"string"!==u&&"boolean"!==u&&"number"!==u&&(l=JSON.stringify(l));var h=u+":"+l,A=a[h];void 0===A&&(n.push(l),a[h]=A=n.length-1),e.writeVarint(A)}}}function z(t,e){return(e<<3)+(7&t)}function R(t){return t<<1^t>>31}function O(t,e){for(var r=t.loadGeometry(),i=t.type,n=0,o=0,a=r.length,s=0;s<a;s++){var l=r[s],c=1;1===i&&(c=l.length),e.writeVarint(z(1,c));for(var u=3===i?l.length-1:l.length,h=0;h<u;h++){1===h&&1!==i&&e.writeVarint(z(2,u-1));var A=l[h].x-n,p=l[h].y-o;e.writeVarint(R(A)),e.writeVarint(R(p)),n+=A,o+=p}3===i&&e.writeVarint(z(7,1))}}function Q(t,e){var r=typeof t;"string"===r?e.writeStringField(1,t):"boolean"===r?e.writeBooleanField(7,t):"number"===r&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}C.exports=L,C.exports.fromVectorTileJs=L,C.exports.fromGeojsonVt=function(t,e){e=e||{};var r={};for(var i in t)r[i]=new P(t[i].features,e),r[i].name=i,r[i].version=e.version,r[i].extent=e.extent;return L({layers:r})},C.exports.GeoJSONWrapper=P;var N=t.e1(C.exports);const V={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:t=>t},H=Math.fround||(j=new Float32Array(1),t=>(j[0]=+t,j[0]));var j;const G=3,K=5,q=6;class Z{constructor(t){this.options=Object.assign(Object.create(V),t),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(t){const{log:e,minZoom:r,maxZoom:i}=this.options;e&&console.time("total time");const n=`prepare ${t.length} points`;e&&console.time(n),this.points=t;const o=[];for(let e=0;e<t.length;e++){const r=t[e];if(!r.geometry)continue;const[i,n]=r.geometry.coordinates,a=H($(i)),s=H(Y(n));o.push(a,s,1/0,e,-1,1),this.options.reduce&&o.push(0)}let a=this.trees[i+1]=this._createTree(o);e&&console.timeEnd(n);for(let t=i;t>=r;t--){const r=+Date.now();a=this.trees[t]=this._createTree(this._cluster(a,t)),e&&console.log("z%d: %d clusters in %dms",t,a.numItems,+Date.now()-r)}return e&&console.timeEnd("total time"),this}getClusters(t,e){let r=((t[0]+180)%360+360)%360-180;const i=Math.max(-90,Math.min(90,t[1]));let n=180===t[2]?180:((t[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)r=-180,n=180;else if(r>n){const t=this.getClusters([r,i,180,o],e),a=this.getClusters([-180,i,n,o],e);return t.concat(a)}const a=this.trees[this._limitZoom(e)],s=a.range($(r),Y(o),$(n),Y(i)),l=a.data,c=[];for(const t of s){const e=this.stride*t;c.push(l[e+K]>1?W(l,e,this.clusterProps):this.points[l[e+G]])}return c}getChildren(t){const e=this._getOriginId(t),r=this._getOriginZoom(t),i="No cluster with the specified id.",n=this.trees[r];if(!n)throw new Error(i);const o=n.data;if(e*this.stride>=o.length)throw new Error(i);const a=this.options.radius/(this.options.extent*Math.pow(2,r-1)),s=n.within(o[e*this.stride],o[e*this.stride+1],a),l=[];for(const e of s){const r=e*this.stride;o[r+4]===t&&l.push(o[r+K]>1?W(o,r,this.clusterProps):this.points[o[r+G]])}if(0===l.length)throw new Error(i);return l}getLeaves(t,e,r){const i=[];return this._appendLeaves(i,t,e=e||10,r=r||0,0),i}getTile(t,e,r){const i=this.trees[this._limitZoom(t)],n=Math.pow(2,t),{extent:o,radius:a}=this.options,s=a/o,l=(r-s)/n,c=(r+1+s)/n,u={features:[]};return this._addTileFeatures(i.range((e-s)/n,l,(e+1+s)/n,c),i.data,e,r,n,u),0===e&&this._addTileFeatures(i.range(1-s/n,l,1,c),i.data,n,r,n,u),e===n-1&&this._addTileFeatures(i.range(0,l,s/n,c),i.data,-1,r,n,u),u.features.length?u:null}getClusterExpansionZoom(t){let e=this._getOriginZoom(t)-1;for(;e<=this.options.maxZoom;){const r=this.getChildren(t);if(e++,1!==r.length)break;t=r[0].properties.cluster_id}return e}_appendLeaves(t,e,r,i,n){const o=this.getChildren(e);for(const e of o){const o=e.properties;if(o&&o.cluster?n+o.point_count<=i?n+=o.point_count:n=this._appendLeaves(t,o.cluster_id,r,i,n):n<i?n++:t.push(e),t.length===r)break}return n}_createTree(e){const r=new t.cK(e.length/this.stride|0,this.options.nodeSize,Float32Array);for(let t=0;t<e.length;t+=this.stride)r.add(e[t],e[t+1]);return r.finish(),r.data=e,r}_addTileFeatures(t,e,r,i,n,o){for(const a of t){const t=a*this.stride,s=e[t+K]>1;let l,c,u;if(s)l=X(e,t,this.clusterProps),c=e[t],u=e[t+1];else{const r=this.points[e[t+G]];l=r.properties;const[i,n]=r.geometry.coordinates;c=$(i),u=Y(n)}const h={type:1,geometry:[[Math.round(this.options.extent*(c*n-r)),Math.round(this.options.extent*(u*n-i))]],tags:l};let A;A=s||this.options.generateId?e[t+G]:this.points[e[t+G]].id,void 0!==A&&(h.id=A),o.features.push(h)}}_limitZoom(t){return Math.max(this.options.minZoom,Math.min(Math.floor(+t),this.options.maxZoom+1))}_cluster(t,e){const{radius:r,extent:i,reduce:n,minPoints:o}=this.options,a=r/(i*Math.pow(2,e)),s=t.data,l=[],c=this.stride;for(let r=0;r<s.length;r+=c){if(s[r+2]<=e)continue;s[r+2]=e;const i=s[r],u=s[r+1],h=t.within(s[r],s[r+1],a),A=s[r+K];let p=A;for(const t of h){const r=t*c;s[r+2]>e&&(p+=s[r+K])}if(p>A&&p>=o){let t,o=i*A,a=u*A,d=-1;const f=(r/c<<5)+(e+1)+this.points.length;for(const i of h){const l=i*c;if(s[l+2]<=e)continue;s[l+2]=e;const u=s[l+K];o+=s[l]*u,a+=s[l+1]*u,s[l+4]=f,n&&(t||(t=this._map(s,r,!0),d=this.clusterProps.length,this.clusterProps.push(t)),n(t,this._map(s,l)))}s[r+4]=f,l.push(o/p,a/p,1/0,f,-1,p),n&&l.push(d)}else{for(let t=0;t<c;t++)l.push(s[r+t]);if(p>1)for(const t of h){const r=t*c;if(!(s[r+2]<=e)){s[r+2]=e;for(let t=0;t<c;t++)l.push(s[r+t])}}}}return l}_getOriginId(t){return t-this.points.length>>5}_getOriginZoom(t){return(t-this.points.length)%32}_map(t,e,r){if(t[e+K]>1){const i=this.clusterProps[t[e+q]];return r?Object.assign({},i):i}const i=this.points[t[e+G]].properties,n=this.options.map(i);return r&&n===i?Object.assign({},n):n}}function W(t,e,r){return{type:"Feature",id:t[e+G],properties:X(t,e,r),geometry:{type:"Point",coordinates:[(i=t[e],360*(i-.5)),J(t[e+1])]}};var i}function X(t,e,r){const i=t[e+K],n=i>=1e4?`${Math.round(i/1e3)}k`:i>=1e3?Math.round(i/100)/10+"k":i,o=t[e+q],a=-1===o?{}:Object.assign({},r[o]);return Object.assign(a,{cluster:!0,cluster_id:t[e+G],point_count:i,point_count_abbreviated:n})}function $(t){return t/360+.5}function Y(t){const e=Math.sin(t*Math.PI/180),r=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return r<0?0:r>1?1:r}function J(t){const e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function tt(t,e,r,i){let n=i;const o=e+(r-e>>1);let a,s=r-e;const l=t[e],c=t[e+1],u=t[r],h=t[r+1];for(let i=e+3;i<r;i+=3){const e=et(t[i],t[i+1],l,c,u,h);if(e>n)a=i,n=e;else if(e===n){const t=Math.abs(i-o);t<s&&(a=i,s=t)}}n>i&&(a-e>3&&tt(t,e,a,i),t[a+2]=n,r-a>3&&tt(t,a,r,i))}function et(t,e,r,i,n,o){let a=n-r,s=o-i;if(0!==a||0!==s){const l=((t-r)*a+(e-i)*s)/(a*a+s*s);l>1?(r=n,i=o):l>0&&(r+=a*l,i+=s*l)}return a=t-r,s=e-i,a*a+s*s}function rt(t,e,r,i){const n={id:t??null,type:e,geometry:r,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===e||"MultiPoint"===e||"LineString"===e)it(n,r);else if("Polygon"===e)it(n,r[0]);else if("MultiLineString"===e)for(const t of r)it(n,t);else if("MultiPolygon"===e)for(const t of r)it(n,t[0]);return n}function it(t,e){for(let r=0;r<e.length;r+=3)t.minX=Math.min(t.minX,e[r]),t.minY=Math.min(t.minY,e[r+1]),t.maxX=Math.max(t.maxX,e[r]),t.maxY=Math.max(t.maxY,e[r+1])}function nt(t,e,r,i){if(!e.geometry)return;const n=e.geometry.coordinates;if(n&&0===n.length)return;const o=e.geometry.type,a=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2);let s=[],l=e.id;if(r.promoteId?l=e.properties[r.promoteId]:r.generateId&&(l=i||0),"Point"===o)ot(n,s);else if("MultiPoint"===o)for(const t of n)ot(t,s);else if("LineString"===o)at(n,s,a,!1);else if("MultiLineString"===o){if(r.lineMetrics){for(const r of n)s=[],at(r,s,a,!1),t.push(rt(l,"LineString",s,e.properties));return}st(n,s,a,!1)}else if("Polygon"===o)st(n,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(const n of e.geometry.geometries)nt(t,{id:l,geometry:n,properties:e.properties},r,i);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const t of n){const e=[];st(t,e,a,!0),s.push(e)}}t.push(rt(l,o,s,e.properties))}function ot(t,e){e.push(lt(t[0]),ct(t[1]),0)}function at(t,e,r,i){let n,o,a=0;for(let r=0;r<t.length;r++){const s=lt(t[r][0]),l=ct(t[r][1]);e.push(s,l,0),r>0&&(a+=i?(n*l-s*o)/2:Math.sqrt(Math.pow(s-n,2)+Math.pow(l-o,2))),n=s,o=l}const s=e.length-3;e[2]=1,tt(e,0,s,r),e[s+2]=1,e.size=Math.abs(a),e.start=0,e.end=e.size}function st(t,e,r,i){for(let n=0;n<t.length;n++){const o=[];at(t[n],o,r,i),e.push(o)}}function lt(t){return t/360+.5}function ct(t){const e=Math.sin(t*Math.PI/180),r=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return r<0?0:r>1?1:r}function ut(t,e,r,i,n,o,a,s){if(i/=e,o>=(r/=e)&&a<i)return t;if(a<r||o>=i)return null;const l=[];for(const e of t){const t=e.geometry;let o=e.type;const a=0===n?e.minX:e.minY,c=0===n?e.maxX:e.maxY;if(a>=r&&c<i){l.push(e);continue}if(c<r||a>=i)continue;let u=[];if("Point"===o||"MultiPoint"===o)ht(t,u,r,i,n);else if("LineString"===o)At(t,u,r,i,n,!1,s.lineMetrics);else if("MultiLineString"===o)dt(t,u,r,i,n,!1);else if("Polygon"===o)dt(t,u,r,i,n,!0);else if("MultiPolygon"===o)for(const e of t){const t=[];dt(e,t,r,i,n,!0),t.length&&u.push(t)}if(u.length){if(s.lineMetrics&&"LineString"===o){for(const t of u)l.push(rt(e.id,o,t,e.tags));continue}"LineString"!==o&&"MultiLineString"!==o||(1===u.length?(o="LineString",u=u[0]):o="MultiLineString"),"Point"!==o&&"MultiPoint"!==o||(o=3===u.length?"Point":"MultiPoint"),l.push(rt(e.id,o,u,e.tags))}}return l.length?l:null}function ht(t,e,r,i,n){for(let o=0;o<t.length;o+=3){const a=t[o+n];a>=r&&a<=i&&ft(e,t[o],t[o+1],t[o+2])}}function At(t,e,r,i,n,o,a){let s=pt(t);const l=0===n?mt:gt;let c,u,h=t.start;for(let A=0;A<t.length-3;A+=3){const p=t[A],d=t[A+1],f=t[A+2],m=t[A+3],g=t[A+4],_=0===n?p:d,y=0===n?m:g;let v=!1;a&&(c=Math.sqrt(Math.pow(p-m,2)+Math.pow(d-g,2))),_<r?y>r&&(u=l(s,p,d,m,g,r),a&&(s.start=h+c*u)):_>i?y<i&&(u=l(s,p,d,m,g,i),a&&(s.start=h+c*u)):ft(s,p,d,f),y<r&&_>=r&&(u=l(s,p,d,m,g,r),v=!0),y>i&&_<=i&&(u=l(s,p,d,m,g,i),v=!0),!o&&v&&(a&&(s.end=h+c*u),e.push(s),s=pt(t)),a&&(h+=c)}let A=t.length-3;const p=t[A],d=t[A+1],f=0===n?p:d;f>=r&&f<=i&&ft(s,p,d,t[A+2]),A=s.length-3,o&&A>=3&&(s[A]!==s[0]||s[A+1]!==s[1])&&ft(s,s[0],s[1],s[2]),s.length&&e.push(s)}function pt(t){const e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function dt(t,e,r,i,n,o){for(const a of t)At(a,e,r,i,n,o,!1)}function ft(t,e,r,i){t.push(e,r,i)}function mt(t,e,r,i,n,o){const a=(o-e)/(i-e);return ft(t,o,r+(n-r)*a,1),a}function gt(t,e,r,i,n,o){const a=(o-r)/(n-r);return ft(t,e+(i-e)*a,o,1),a}function _t(t,e){const r=[];for(let i=0;i<t.length;i++){const n=t[i],o=n.type;let a;if("Point"===o||"MultiPoint"===o||"LineString"===o)a=yt(n.geometry,e);else if("MultiLineString"===o||"Polygon"===o){a=[];for(const t of n.geometry)a.push(yt(t,e))}else if("MultiPolygon"===o){a=[];for(const t of n.geometry){const r=[];for(const i of t)r.push(yt(i,e));a.push(r)}}r.push(rt(n.id,o,a,n.tags))}return r}function yt(t,e){const r=[];r.size=t.size,void 0!==t.start&&(r.start=t.start,r.end=t.end);for(let i=0;i<t.length;i+=3)r.push(t[i]+e,t[i+1],t[i+2]);return r}function vt(t,e){if(t.transformed)return t;const r=1<<t.z,i=t.x,n=t.y;for(const o of t.features){const t=o.geometry,a=o.type;if(o.geometry=[],1===a)for(let a=0;a<t.length;a+=2)o.geometry.push(xt(t[a],t[a+1],e,r,i,n));else for(let a=0;a<t.length;a++){const s=[];for(let o=0;o<t[a].length;o+=2)s.push(xt(t[a][o],t[a][o+1],e,r,i,n));o.geometry.push(s)}}return t.transformed=!0,t}function xt(t,e,r,i,n,o){return[Math.round(r*(t*i-n)),Math.round(r*(e*i-o))]}function wt(t,e,r,i,n){const o=e===n.maxZoom?0:n.tolerance/((1<<e)*n.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:t.length,source:null,x:r,y:i,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const e of t)bt(a,e,o,n);return a}function bt(t,e,r,i){const n=e.geometry,o=e.type,a=[];if(t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),"Point"===o||"MultiPoint"===o)for(let e=0;e<n.length;e+=3)a.push(n[e],n[e+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)Bt(a,n,t,r,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(let e=0;e<n.length;e++)Bt(a,n[e],t,r,"Polygon"===o,0===e);else if("MultiPolygon"===o)for(let e=0;e<n.length;e++){const i=n[e];for(let e=0;e<i.length;e++)Bt(a,i[e],t,r,!0,0===e)}if(a.length){let r=e.tags||null;if("LineString"===o&&i.lineMetrics){r={};for(const t in e.tags)r[t]=e.tags[t];r.mapbox_clip_start=n.start/n.size,r.mapbox_clip_end=n.end/n.size}const s={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:r};null!==e.id&&(s.id=e.id),t.features.push(s)}}function Bt(t,e,r,i,n,o){const a=i*i;if(i>0&&e.size<(n?a:i))return void(r.numPoints+=e.length/3);const s=[];for(let t=0;t<e.length;t+=3)(0===i||e[t+2]>a)&&(r.numSimplified++,s.push(e[t],e[t+1])),r.numPoints++;n&&function(t,e){let r=0;for(let e=0,i=t.length,n=i-2;e<i;n=e,e+=2)r+=(t[e]-t[n])*(t[e+1]+t[n+1]);if(r>0===e)for(let e=0,r=t.length;e<r/2;e+=2){const i=t[e],n=t[e+1];t[e]=t[r-2-e],t[e+1]=t[r-1-e],t[r-2-e]=i,t[r-1-e]=n}}(s,o),t.push(s)}const Ct={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Et{constructor(t,e){const r=(e=this.options=function(t,e){for(const r in e)t[r]=e[r];return t}(Object.create(Ct),e)).debug;if(r&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");let i=function(t,e){const r=[];if("FeatureCollection"===t.type)for(let i=0;i<t.features.length;i++)nt(r,t.features[i],e,i);else nt(r,"Feature"===t.type?t:{geometry:t},e);return r}(t,e);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),i=function(t,e){const r=e.buffer/e.extent;let i=t;const n=ut(t,1,-1-r,r,0,-1,2,e),o=ut(t,1,1-r,2+r,0,-1,2,e);return(n||o)&&(i=ut(t,1,-r,1+r,0,-1,2,e)||[],n&&(i=_t(n,1).concat(i)),o&&(i=i.concat(_t(o,-1)))),i}(i,e),i.length&&this.splitTile(i,0,0,0),r&&(i.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(t,e,r,i,n,o,a){const s=[t,e,r,i],l=this.options,c=l.debug;for(;s.length;){i=s.pop(),r=s.pop(),e=s.pop(),t=s.pop();const u=1<<e,h=Tt(e,r,i);let A=this.tiles[h];if(!A&&(c>1&&console.time("creation"),A=this.tiles[h]=wt(t,e,r,i,l),this.tileCoords.push({z:e,x:r,y:i}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,r,i,A.numFeatures,A.numPoints,A.numSimplified),console.timeEnd("creation"));const t=`z${e}`;this.stats[t]=(this.stats[t]||0)+1,this.total++}if(A.source=t,null==n){if(e===l.indexMaxZoom||A.numPoints<=l.indexMaxPoints)continue}else{if(e===l.maxZoom||e===n)continue;if(null!=n){const t=n-e;if(r!==o>>t||i!==a>>t)continue}}if(A.source=null,0===t.length)continue;c>1&&console.time("clipping");const p=.5*l.buffer/l.extent,d=.5-p,f=.5+p,m=1+p;let g=null,_=null,y=null,v=null,x=ut(t,u,r-p,r+f,0,A.minX,A.maxX,l),w=ut(t,u,r+d,r+m,0,A.minX,A.maxX,l);t=null,x&&(g=ut(x,u,i-p,i+f,1,A.minY,A.maxY,l),_=ut(x,u,i+d,i+m,1,A.minY,A.maxY,l),x=null),w&&(y=ut(w,u,i-p,i+f,1,A.minY,A.maxY,l),v=ut(w,u,i+d,i+m,1,A.minY,A.maxY,l),w=null),c>1&&console.timeEnd("clipping"),s.push(g||[],e+1,2*r,2*i),s.push(_||[],e+1,2*r,2*i+1),s.push(y||[],e+1,2*r+1,2*i),s.push(v||[],e+1,2*r+1,2*i+1)}}getTile(t,e,r){t=+t,e=+e,r=+r;const i=this.options,{extent:n,debug:o}=i;if(t<0||t>24)return null;const a=1<<t,s=Tt(t,e=e+a&a-1,r);if(this.tiles[s])return vt(this.tiles[s],n);o>1&&console.log("drilling down to z%d-%d-%d",t,e,r);let l,c=t,u=e,h=r;for(;!l&&c>0;)c--,u>>=1,h>>=1,l=this.tiles[Tt(c,u,h)];return l&&l.source?(o>1&&(console.log("found parent tile z%d-%d-%d",c,u,h),console.time("drilling down")),this.splitTile(l.source,c,u,h,t,e,r),o>1&&console.timeEnd("drilling down"),this.tiles[s]?vt(this.tiles[s],n):null):null}}function Tt(t,e,r){return 32*((1<<t)*r+e)+t}function It(t,e){const r=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);const i=this._geoJSONIndex.getTile(r.z,r.x,r.y);if(!i)return e(null,null);const n=new d(i.features);let o=N(n);0===o.byteOffset&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),e(null,{vectorTile:n,rawData:o.buffer})}class St extends c{constructor(t,e,r,i,n,o){super(t,e,r,i,It,o),n&&(this.loadGeoJSON=n),this._dynamicIndex=new m}loadData(r,i){const n=r&&r.request,o=n&&n.collectResourceTiming;this.loadGeoJSON(r,((a,s)=>{if(a||!s)return i(a);if("object"!=typeof s)return i(new Error(`Input data given to '${r.source}' is not a valid GeoJSON object.`));{try{if(r.filter){const e=t.y(r.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===e.result)throw new Error(e.value.map((t=>`${t.key}: ${t.message}`)).join(", "));s.features=s.features.filter((t=>e.value.evaluate({zoom:0},t)))}r.dynamic?("Feature"===s.type&&(s={type:"FeatureCollection",features:[s]}),r.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(s.features,this.loaded),r.cluster&&(s.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=r.cluster?new Z(function({superclusterOptions:e,clusterProperties:r}){if(!r||!e)return e;const i={},n={},o={accumulated:null,zoom:0},a={properties:null},s=Object.keys(r);for(const e of s){const[o,a]=r[e],s=t.y(a),l=t.y("string"==typeof o?[o,["accumulated"],["get",e]]:o);i[e]=s.value,n[e]=l.value}return e.map=t=>{a.properties=t;const e={};for(const t of s)e[t]=i[t].evaluate(o,a);return e},e.reduce=(t,e)=>{a.properties=e;for(const e of s)o.accumulated=t[e],t[e]=n[e].evaluate(o,a)},e}(r)).load(s.features):r.dynamic?this._dynamicIndex:function(t,e){return new Et(t,e)}(s,r.geojsonVtOptions)}catch(t){return i(t)}const a={};if(o){const t=e(n);t&&(a.resourceTiming={},a.resourceTiming[r.source]=JSON.parse(JSON.stringify(t)))}i(null,a)}}))}reloadTile(t,e){const r=this.loaded;return r&&r[t.uid]?t.partial?e(null,void 0):super.reloadTile(t,e):this.loadTile(t,e)}loadGeoJSON(e,r){if(e.request)t.g(e.request,r);else{if("string"!=typeof e.data)return r(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`));try{return r(null,JSON.parse(e.data))}catch(t){return r(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(t,e){try{e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId))}catch(t){e(t)}}getClusterChildren(t,e){try{e(null,this._geoJSONIndex.getChildren(t.clusterId))}catch(t){e(t)}}getClusterLeaves(t,e){try{e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset))}catch(t){e(t)}}}class Mt{constructor(e,r){this.tileID=new t.aL(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=e.projection,this.brightness=r}parse(e,r,i,n){this.status="parsing";const o=new t.aL(i.tileID.overscaledZ,i.tileID.wrap,i.tileID.canonical.z,i.tileID.canonical.x,i.tileID.canonical.y),a={},s=r.familiesBySource[i.source],l=new t.dN(o,i.promoteId);return l.bucketLayerIDs=[],l.is3DTile=!0,t.e3(e).then((e=>{if(!e)return n(new Error("Could not parse tile"));const r=t.e4(e,1/t.b5(i.tileID.canonical)),c=e.json.extensionsUsed&&e.json.extensionsUsed.includes("MAPBOX_mesh_features")||e.json.asset.extras&&e.json.asset.extras.MAPBOX_mesh_features,u=e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression"),h=new t.X(this.zoom,{brightness:this.brightness});for(const e in s)for(const i of s[e]){const e=i[0];l.bucketLayerIDs.push(i.map((t=>t.id))),e.recalculate(h,[]);const n=new t.e5(r,o,c,u,this.brightness,l);c||(n.needsUpload=!0),a[e.fqid]=n,n.evaluate(e)}this.status="done",n(null,{buckets:a,featureIndex:l})})).catch((t=>n(new Error(t.message))))}}class Ft{constructor(t,e,r,i,n,o){this.actor=t,this.layerIndex=e,this.brightness=o,this.loading={},this.loaded={}}loadTile(e,r){const i=e.uid,n=this.loading[i]=new Mt(e,this.brightness);t.e2(e.request,((t,o)=>{const a=!this.loading[i];return delete this.loading[i],a||t?(n.status="done",a||(this.loaded[i]=n),r(t)):o&&0!==o.byteLength?void n.parse(o,this.layerIndex,e,((t,e)=>{n.status="done",this.loaded=this.loaded||{},this.loaded[i]=n,t||!e?r(t):r(null,e)})):(n.status="done",this.loaded[i]=n,r())}))}reloadTile(t,e){const r=this.loaded,i=t.uid;if(r&&r[i]){const n=r[i];n.projection=t.projection,n.brightness=t.brightness;const o=(r,i)=>{n.reloadCallback&&(delete n.reloadCallback,this.loadTile(t,e)),e(r,i)};"parsing"===n.status?n.reloadCallback=o:"done"===n.status&&this.loadTile(t,e)}}abortTile(t,e){const r=t.uid;this.loading[r]&&delete this.loading[r],e()}removeTile(t,e){const r=this.loaded,i=t.uid;r&&r[i]&&delete r[i],e()}}class Pt{constructor(e){this.self=e,this.actor=new t.e6(e,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=t.aJ({name:"mercator"}),this.workerSourceTypes={vector:c,geojson:St,"batched-model":Ft},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(t,e)=>{if(this.workerSourceTypes[t])throw new Error(`Worker source with name "${t}" already registered.`);this.workerSourceTypes[t]=e},this.self.registerRTLTextPlugin=e=>{if(t.e7.isParsed())throw new Error("RTL text plugin already registered.");t.e7.applyArabicShaping=e.applyArabicShaping,t.e7.processBidirectionalText=e.processBidirectionalText,t.e7.processStyledBidirectionalText=e.processStyledBidirectionalText}}clearCaches(t,e,r){delete this.layerIndexes[t],delete this.availableImages[t],delete this.workerSources[t],delete this.demWorkerSources[t],delete this.rasterArrayWorkerSource,r()}checkIfReady(t,e,r){r()}setReferrer(t,e){this.referrer=e}spriteLoaded(e,{scope:r,isLoaded:i}){if(this.isSpriteLoaded[e]||(this.isSpriteLoaded[e]={}),this.isSpriteLoaded[e][r]=i,this.workerSources[e]&&this.workerSources[e][r])for(const n in this.workerSources[e][r]){const o=this.workerSources[e][r][n];for(const e in o){const r=o[e];r instanceof c&&(r.isSpriteLoaded=i,r.fire(new t.f("isSpriteLoaded")))}}}setImages(t,{scope:e,images:r},i){if(this.availableImages[t]||(this.availableImages[t]={}),this.availableImages[t][e]=r,this.workerSources[t]&&this.workerSources[t][e]){for(const i in this.workerSources[t][e]){const n=this.workerSources[t][e][i];for(const t in n)n[t].availableImages=r}i()}else i()}setProjection(e,r){this.projections[e]=t.aJ(r)}setBrightness(t,e,r){this.brightness=e,r()}setLayers(t,e,r){this.getLayerIndex(t,e.scope).replace(e.layers,e.options),r()}updateLayers(t,e,r){this.getLayerIndex(t,e.scope).update(e.layers,e.removedIds,e.options),r()}loadTile(t,e,r){e.projection=this.projections[t]||this.defaultProjection,this.getWorkerSource(t,e.type,e.source,e.scope).loadTile(e,r)}loadDEMTile(t,e,r){this.getDEMWorkerSource(t,e.source,e.scope).loadTile(e,r)}decodeRasterArray(t,e,r){this.getRasterArrayWorkerSource().decodeRasterArray(e,r)}reloadTile(t,e,r){e.projection=this.projections[t]||this.defaultProjection,this.getWorkerSource(t,e.type,e.source,e.scope).reloadTile(e,r)}abortTile(t,e,r){this.getWorkerSource(t,e.type,e.source,e.scope).abortTile(e,r)}removeTile(t,e,r){this.getWorkerSource(t,e.type,e.source,e.scope).removeTile(e,r)}removeSource(t,e,r){if(!(this.workerSources[t]&&this.workerSources[t][e.scope]&&this.workerSources[t][e.scope][e.type]&&this.workerSources[t][e.scope][e.type][e.source]))return;const i=this.workerSources[t][e.scope][e.type][e.source];delete this.workerSources[t][e.scope][e.type][e.source],void 0!==i.removeSource?i.removeSource(e,r):r()}loadWorkerSource(t,e,r){try{this.self.importScripts(e.url),r()}catch(t){r(t.toString())}}syncRTLPluginState(e,r,i){try{t.e7.setState(r);const e=t.e7.getPluginURL();if(t.e7.isLoaded()&&!t.e7.isParsed()&&null!=e){this.self.importScripts(e);const r=t.e7.isParsed();i(r?void 0:new Error(`RTL Text Plugin failed to import scripts from ${e}`),r)}}catch(t){i(t.toString())}}setDracoUrl(t,e){this.dracoUrl=e}getAvailableImages(t,e){this.availableImages[t]||(this.availableImages[t]={});let r=this.availableImages[t][e];return r||(r=[]),r}getLayerIndex(t,e){this.layerIndexes[t]||(this.layerIndexes[t]={});let r=this.layerIndexes[t][e];return r||(r=this.layerIndexes[t][e]=new n,r.scope=e),r}getWorkerSource(t,e,r,i){return this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][i]||(this.workerSources[t][i]={}),this.workerSources[t][i][e]||(this.workerSources[t][i][e]={}),this.isSpriteLoaded[t]||(this.isSpriteLoaded[t]={}),this.workerSources[t][i][e][r]||(this.workerSources[t][i][e][r]=new this.workerSourceTypes[e]({send:(e,r,i,n,o,a)=>{this.actor.send(e,r,i,t,o,a)},scheduler:this.actor.scheduler},this.getLayerIndex(t,i),this.getAvailableImages(t,i),this.isSpriteLoaded[t][i],void 0,this.brightness)),this.workerSources[t][i][e][r]}getDEMWorkerSource(t,e,r){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][r]||(this.demWorkerSources[t][r]={}),this.demWorkerSources[t][r][e]||(this.demWorkerSources[t][r][e]=new u),this.demWorkerSources[t][r][e]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new h),this.rasterArrayWorkerSource}enforceCacheSizeLimit(e,r){t.e8(r)}getWorkerPerformanceMetrics(t,e,r){r(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new Pt(self)),Pt})),i(["./shared"],(function(t){function e(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(!e(t[i],r[i]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==r){if("object"!=typeof r)return!1;if(Object.keys(t).length!==Object.keys(r).length)return!1;for(const i in t)if(!e(t[i],r[i]))return!1;return!0}return t===r}var r=i;function i(t){return!function(t){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var t,e,r=new Blob([""],{type:"text/javascript"}),i=URL.createObjectURL(r);try{e=new Worker(i),t=!0}catch(e){t=!1}return e&&e.terminate(),URL.revokeObjectURL(i),t}()?function(){var t=document.createElement("canvas");t.width=t.height=1;var e=t.getContext("2d");if(!e)return!1;var r=e.getImageData(0,0,1,1);return r&&r.width===t.width}()?(void 0===n[e=t&&t.failIfMajorPerformanceCaveat]&&(n[e]=function(t){var e,r=function(t){var e=document.createElement("canvas"),r=Object.create(i.webGLContextAttributes);return r.failIfMajorPerformanceCaveat=t,e.getContext("webgl2",r)}(t);if(!r)return!1;try{e=r.createShader(r.VERTEX_SHADER)}catch(t){return!1}return!(!e||r.isContextLost())&&(r.shaderSource(e,"void main() {}"),r.compileShader(e),!0===r.getShaderParameter(e,r.COMPILE_STATUS))}(e)),n[e]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var e}(t)}var n={};function o(t,e,r){const i=document.createElement(t);return null!=e&&(i.className=e),r&&r.appendChild(i),i}function a(t,e,r){const i=document.createElementNS("http://www.w3.org/2000/svg",t);for(const t of Object.keys(e))i.setAttributeNS(null,t,String(e[t]));return r&&r.appendChild(i),i}i.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const s="undefined"!=typeof document?document.documentElement&&document.documentElement.style:null,l=s&&void 0!==s.userSelect?"userSelect":"WebkitUserSelect";let c;function u(){s&&l&&(c=s[l],s[l]="none")}function h(){s&&l&&(s[l]=c)}function A(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",A,!0)}function p(){window.addEventListener("click",A,!0),window.setTimeout((()=>{window.removeEventListener("click",A,!0)}),0)}function d(t,e){const r=t.getBoundingClientRect();return g(t,r,e)}function f(t,e){const r=t.getBoundingClientRect(),i=[];for(let n=0;n<e.length;n++)i.push(g(t,r,e[n]));return i}function m(t){return void 0!==window.InstallTrigger&&2===t.button&&t.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:t.button}function g(e,r,i){const n=e.offsetWidth===r.width?1:e.offsetWidth/r.width;return new t.P((i.clientX-r.left)*n,(i.clientY-r.top)*n)}class _{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,e){this._updatedSourceCaches[t]=e,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const e=t.scope;this._updatedLayers[e]=this._updatedLayers[e]||new Set,this._updatedLayers[e].add(t.id),this.setDirty()}removeLayer(t){const e=t.scope;this._removedLayers[e]=this._removedLayers[e]||{},this._updatedLayers[e]=this._updatedLayers[e]||new Set,this._removedLayers[e][t.id]=t,this._updatedLayers[e].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const e in this._updatedLayers)t[e]=t[e]||{},t[e].updatedIds=Array.from(this._updatedLayers[e].values());for(const e in this._removedLayers)t[e]=t[e]||{},t[e].removedIds=Object.keys(this._removedLayers[e]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(t){this._updatedImages.add(t),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}const y={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class v{constructor(t,e,r,i,n,o){this.length=e.length,this.attributes=r,this.itemSize=e.bytesPerElement,this.dynamicDraw=i,this.instanceCount=o,this.context=t;const a=t.gl;this.buffer=a.createBuffer(),t.bindVertexBuffer.set(this.buffer),a.bufferData(a.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?a.DYNAMIC_DRAW:a.STATIC_DRAW),this.dynamicDraw||n||e.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,e){for(let r=0;r<this.attributes.length;r++){const i=e.attributes[this.attributes[r].name];void 0!==i&&t.enableVertexAttribArray(i)}}setVertexAttribPointers(t,e,r){for(let i=0;i<this.attributes.length;i++){const n=this.attributes[i],o=e.attributes[n.name];void 0!==o&&t.vertexAttribPointer(o,n.components,t[y[n.type]],!1,this.itemSize,n.offset+this.itemSize*(r||0))}}setVertexAttribDivisor(t,e,r){for(let i=0;i<this.attributes.length;i++){const n=e.attributes[this.attributes[i].name];void 0!==n&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(n,r)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class x{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class w extends x{getDefault(){return t.C.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class b extends x{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class B extends x{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class C extends x{getDefault(){return[!0,!0,!0,!0]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class E extends x{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class T extends x{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class I extends x{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class S extends x{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class M extends x{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}}class F extends x{getDefault(){return[0,1]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class P extends x{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}}class L extends x{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class D extends x{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}}class U extends x{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class k extends x{getDefault(){return t.C.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class z extends x{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class R extends x{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}}class O extends x{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Q extends x{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let N=class extends x{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}};class V extends x{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class H extends x{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class j extends x{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class G extends x{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class K extends x{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class q extends x{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Z extends x{getDefault(){return null}set(t){const e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class W extends x{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class X extends x{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class $ extends x{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Y extends x{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class J extends x{constructor(t,e){super(t),this.context=t,this.parent=e}getDefault(){return null}}class tt extends J{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class et extends J{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,this.attachment(),e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class rt extends J{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,this.attachment(),e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class it extends et{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class nt{constructor(t,e,r,i,n){this.context=t,this.width=e,this.height=r;const o=this.framebuffer=t.gl.createFramebuffer();i&&(this.colorAttachment=new tt(t,o)),n&&(this.depthAttachmentType=n,this.depthAttachment="renderbuffer"===n?new et(t,o):new rt(t,o))}destroy(){const t=this.context.gl;if(this.colorAttachment){const e=this.colorAttachment.get();e&&t.deleteTexture(e)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const e=this.depthAttachment.get();e&&t.deleteRenderbuffer(e)}else{const e=this.depthAttachment.get();e&&t.deleteTexture(e)}t.deleteFramebuffer(this.framebuffer)}}class ot{constructor(t,e){this.gl=t,this.clearColor=new w(this),this.clearDepth=new b(this),this.clearStencil=new B(this),this.colorMask=new C(this),this.depthMask=new E(this),this.stencilMask=new T(this),this.stencilFunc=new I(this),this.stencilOp=new S(this),this.stencilTest=new M(this),this.depthRange=new F(this),this.depthTest=new P(this),this.depthFunc=new L(this),this.blend=new D(this),this.blendFunc=new U(this),this.blendColor=new k(this),this.blendEquation=new z(this),this.cullFace=new R(this),this.cullFaceSide=new O(this),this.frontFace=new Q(this),this.program=new N(this),this.activeTexture=new V(this),this.viewport=new H(this),this.bindFramebuffer=new j(this),this.bindRenderbuffer=new G(this),this.bindTexture=new K(this),this.bindVertexBuffer=new q(this),this.bindElementBuffer=new Z(this),this.bindVertexArrayOES=new W(this),this.pixelStoreUnpack=new X(this),this.pixelStoreUnpackPremultiplyAlpha=new $(this),this.pixelStoreUnpackFlipY=new Y(this),this.options=e?{...e}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,r,i){return new t.I(this,e,r,i)}createVertexBuffer(t,e,r,i,n){return new v(this,t,e,r,i,n)}createRenderbuffer(t,e,r){const i=this.gl,n=i.createRenderbuffer();return this.bindRenderbuffer.set(n),i.renderbufferStorage(i.RENDERBUFFER,t,e,r),this.bindRenderbuffer.set(null),n}createFramebuffer(t,e,r,i){return new nt(this,t,e,r,i)}clear({color:t,depth:e,stencil:r,colorMask:i}){const n=this.gl;let o=0;t&&(o|=n.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(i||[!0,!0,!0,!0])),void 0!==e&&(o|=n.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(e),this.depthMask.set(!0)),void 0!==r&&(o|=n.STENCIL_BUFFER_BIT,this.clearStencil.set(r),this.stencilMask.set(255)),n.clear(o)}setCullFace(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(r){e(r.blendFunction,t.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor),r.blendEquation?this.blendEquation.set(r.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(r.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class at{constructor(t){this._gl=t.gl,this._query=this._gl.createQuery(),this._isFree=!0}begin(){this._gl.beginQuery(this._gl.ANY_SAMPLES_PASSED,this._query),this._isFree=!1}end(){this._gl.endQuery(this._gl.ANY_SAMPLES_PASSED)}isResultAvailable(){return this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT_AVAILABLE)}consumeResult(){const t=this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT);return this._isFree=!0,t}isFree(){return this._isFree}destroy(){this._gl.deleteQuery(this._query)}}class st{constructor(t){this.useOcclusionQueries=!0,this.visualizeOcclusions="none",this.occlusionQueryFrameWindow=5,this.occluderSize=32,this.fadeSpeed=7,this.depthOffset=-1e-4,t.registerParameter(this,["Symbols"],"useOcclusionQueries"),t.registerParameter(this,["Symbols"],"visualizeOcclusions",{options:{none:"none",zPass:"zPass",zTest:"zTest"}}),t.registerParameter(this,["Symbols"],"occlusionQueryFrameWindow",{min:1,max:30,step:1}),t.registerParameter(this,["Symbols"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Symbols"],"fadeSpeed",{min:.1,max:50,step:.1}),t.registerParameter(this,["Symbols"],"depthOffset",{min:-.001,max:0,step:1e-4})}}class lt{constructor(e,r,i,n){const o={width:i[0],height:i[1],data:null},a=e.gl;this.targetColorTexture=new t.T(e,o,a.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new t.T(e,o,a.RGBA,{useMipmap:!1}),this.context=e,this.updateParticleTexture(r,n),this.lastInvalidatedAt=0}updateParticleTexture(e,r){if(this.particleTextureDimension===r.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const i=this.context.gl,n=r.width*r.height;this.particleTexture0=new t.T(this.context,r,i.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new t.T(this.context,r,i.RGBA,{premultiply:!1,useMipmap:!1});const o=new t.S;o.reserve(n);for(let t=0;t<n;t++)o.emplaceBack(t);this.particleIndexBuffer=this.context.createVertexBuffer(o,t.p.members,!0),this.particleSegment=t.b.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=r.width}update(e){return!(this.lastInvalidatedAt<e&&(this.lastInvalidatedAt=t.e.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}class ct extends t.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.numModelsLoading={}}loadModel(e,r){return t.l(this.requestManager.transformRequest(r,t.R.Model).url).then((r=>{if(!r)return;const i=t.c(r),n=new t.M(e,void 0,void 0,i);return n.computeBoundsAndApplyParent(),n})).catch((i=>{if(i&&404===i.status)return null;this.fire(new t.d(new Error(`Could not load model ${e} from ${r}: ${i.message}`)))}))}load(e,r){this.models[r]||(this.models[r]={});const i=Object.keys(e);this.numModelsLoading[r]=(this.numModelsLoading[r]||0)+i.length;const n=[];for(const t of i)n.push(this.loadModel(t,e[t]));Promise.allSettled(n).then((e=>{for(let t=0;t<e.length;t++){const{status:n,value:o}=e[t];"fulfilled"===n&&o&&(this.models[r][i[t]]={model:o,numReferences:1})}this.numModelsLoading[r]-=i.length,this.fire(new t.f("data",{dataType:"style"}))})).catch((e=>{this.fire(new t.d(new Error(`Could not load models: ${e.message}`)))}))}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,e){return!!this.getModel(t,e)}getModel(t,e){return this.models[e]||(this.models[e]={}),this.models[e][t]?this.models[e][t].model:void 0}addModel(t,e,r){this.models[r]||(this.models[r]={}),this.hasModel(t,r)&&this.models[r][t].numReferences++,this.load({[t]:this.requestManager.normalizeModelURL(e)},r)}addModels(t,e){this.models[e]||(this.models[e]={});const r={};for(const i in t)this.models[e][i]={},r[i]=this.requestManager.normalizeModelURL(t[i]);this.load(r,e)}addModelsFromBucket(t,e){this.models[e]||(this.models[e]={});const r={};for(const i of t)this.hasModel(i,e)?this.models[e][i].numReferences++:r[i]=this.requestManager.normalizeModelURL(i);this.load(r,e)}removeModel(t,e){if(this.models[e]&&this.models[e][t]&&(this.models[e][t].numReferences--,0===this.models[e][t].numReferences)){const r=this.models[e][t].model;delete this.models[e][t],r.destroy()}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,e){this.models[e]||(this.models[e]={});for(const r in this.models[e])this.models[e][r].model&&this.models[e][r].model.upload(t.context)}}function ut(t){const{userImage:e}=t;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}class ht extends t.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(e){this.images[e]={},this.loaded[e]=!1,this.updatedImages[e]={},this.patterns[e]={},this.callbackDispatchedThisFrame[e]={},this.atlasImage[e]=new t.i({width:1,height:1})}isLoaded(){for(const t in this.loaded)if(!this.loaded[t])return!1;return!0}setLoaded(t,e){if(this.loaded[e]!==t&&(this.loaded[e]=t,t)){for(const{ids:t,callback:r}of this.requestors)this._notify(t,e,r);this.requestors=[]}}hasImage(t,e){return!!this.getImage(t,e)}getImage(t,e){return this.images[e][t]}addImage(t,e,r){this._validate(t,r)&&(this.images[e][t]=r)}_validate(e,r){let i=!0;return this._validateStretch(r.stretchX,r.data&&r.data.width)||(this.fire(new t.d(new Error(`Image "${e}" has invalid "stretchX" value`))),i=!1),this._validateStretch(r.stretchY,r.data&&r.data.height)||(this.fire(new t.d(new Error(`Image "${e}" has invalid "stretchY" value`))),i=!1),this._validateContent(r.content,r)||(this.fire(new t.d(new Error(`Image "${e}" has invalid "content" value`))),i=!1),i}_validateStretch(t,e){if(!t)return!0;let r=0;for(const i of t){if(i[0]<r||i[1]<i[0]||e<i[1])return!1;r=i[1]}return!0}_validateContent(t,e){return!(t&&(4!==t.length||t[0]<0||e.data.width<t[0]||t[1]<0||e.data.height<t[1]||t[2]<0||e.data.width<t[2]||t[3]<0||e.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,e,r){r.version=this.images[e][t].version+1,this.images[e][t]=r,this.updatedImages[e][t]=!0}removeImage(t,e){const r=this.images[e][t];delete this.images[e][t],delete this.patterns[e][t],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(t){return Object.keys(this.images[t])}getImages(t,e,r){let i=!0;const n=!!this.loaded[e];if(!n)for(const r of t)this.images[e][r]||(i=!1);n||i?this._notify(t,e,r):this.requestors.push({ids:t,scope:e,callback:r})}getUpdatedImages(t){return this.updatedImages[t]}_notify(e,r,i){const n={};for(const i of e){this.images[r][i]||this.fire(new t.f("styleimagemissing",{id:i}));const e=this.images[r][i];e?n[i]={data:e.data.clone(),pixelRatio:e.pixelRatio,sdf:e.sdf,version:e.version,stretchX:e.stretchX,stretchY:e.stretchY,content:e.content,hasRenderCallback:Boolean(e.userImage&&e.userImage.render)}:t.w(`Image "${i}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}i(null,n)}getPixelSize(t){const{width:e,height:r}=this.atlasImage[t];return{width:e,height:r}}getPattern(e,r,i){const n=this.patterns[r][e],o=this.getImage(e,r);if(!o)return null;if(n&&n.position.version===o.version)return n.position;if(n)n.position.version=o.version;else{const i={w:o.data.width+2,h:o.data.height+2,x:0,y:0},n=new t.k(i,o);this.patterns[r][e]={bin:i,position:n}}return this._updatePatternAtlas(r,i),this.patterns[r][e].position}bind(e,r){const i=e.gl;let n=this.atlasTexture[r];n?this.dirty&&(n.update(this.atlasImage[r]),this.dirty=!1):(n=new t.T(e,this.atlasImage[r],i.RGBA),this.atlasTexture[r]=n),n.bind(i.LINEAR,i.CLAMP_TO_EDGE)}_updatePatternAtlas(e,r){const i=[];for(const t in this.patterns[e])i.push(this.patterns[e][t].bin);const{w:n,h:o}=t.j(i),a=this.atlasImage[e];a.resize({width:n||1,height:o||1});for(const i in this.patterns[e]){const{bin:n}=this.patterns[e][i],o=n.x+1,s=n.y+1,l=this.images[e][i].data,c=l.width,u=l.height;t.i.copy(l,a,{x:0,y:0},{x:o,y:s},{width:c,height:u},r),t.i.copy(l,a,{x:0,y:u-1},{x:o,y:s-1},{width:c,height:1},r),t.i.copy(l,a,{x:0,y:0},{x:o,y:s+u},{width:c,height:1},r),t.i.copy(l,a,{x:c-1,y:0},{x:o-1,y:s},{width:1,height:u},r),t.i.copy(l,a,{x:0,y:0},{x:o+c,y:s},{width:1,height:u},r)}this.dirty=!0}beginFrame(){for(const t in this.images)this.callbackDispatchedThisFrame[t]={}}dispatchRenderCallbacks(t,e){for(const r of t){if(this.callbackDispatchedThisFrame[e][r])continue;this.callbackDispatchedThisFrame[e][r]=!0;const t=this.images[e][r];ut(t)&&this.updateImage(r,e,t)}}}function At(e){const r=e.key,i=e.value,n=e.valueSpec||{},o=e.objectElementValidators||{},a=e.style,s=e.styleSpec;let l=[];const c=t.n(i);if("object"!==c)return[new t.V(r,i,`object expected, ${c} found`)];for(const e in i){const c=e.split(".")[0];let u;o[c]?u=o[c]:n[c]?u=Dt:o["*"]?u=o["*"]:n["*"]&&(u=Dt),u?l=l.concat(u({key:(r?`${r}.`:r)+e,value:i[e],valueSpec:n[c]||n["*"],style:a,styleSpec:s,object:i,objectKey:e},i)):l.push(new t.m(r,i[e],`unknown property "${e}"`))}for(const e in n)o[e]||n[e].required&&void 0===n[e].default&&void 0===i[e]&&l.push(new t.V(r,i,`missing required property "${e}"`));return l}function pt(e){const r=e.value,i=e.valueSpec,n=e.style,o=e.styleSpec,a=e.key,s=e.arrayElementValidator||Dt;if("array"!==t.n(r))return[new t.V(a,r,`array expected, ${t.n(r)} found`)];if(i.length&&r.length!==i.length)return[new t.V(a,r,`array length ${i.length} expected, length ${r.length} found`)];if(i["min-length"]&&r.length<i["min-length"])return[new t.V(a,r,`array length at least ${i["min-length"]} expected, length ${r.length} found`)];let l={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};o.$version<7&&(l.function=i.function),"object"===t.n(i.value)&&(l=i.value);let c=[];for(let t=0;t<r.length;t++)c=c.concat(s({array:r,arrayIndex:t,value:r[t],valueSpec:l,style:n,styleSpec:o,key:`${a}[${t}]`},!0));return c}function dt(e){const r=e.key,i=e.value,n=e.valueSpec;let o=t.n(i);if("number"===o&&i!=i&&(o="NaN"),"number"!==o)return[new t.V(r,i,`number expected, ${o} found`)];if("minimum"in n){let o=n.minimum;if("array"===t.n(n.minimum)&&(o=n.minimum[e.arrayIndex]),i<o)return[new t.V(r,i,`${i} is less than the minimum value ${o}`)]}if("maximum"in n){let o=n.maximum;if("array"===t.n(n.maximum)&&(o=n.maximum[e.arrayIndex]),i>o)return[new t.V(r,i,`${i} is greater than the maximum value ${o}`)]}return[]}function ft(e){const r=e.valueSpec,i=t.u(e.value.type);let n,o,a,s={};const l="categorical"!==i&&void 0===e.value.property,c=!l,u="array"===t.n(e.value.stops)&&"array"===t.n(e.value.stops[0])&&"object"===t.n(e.value.stops[0][0]),h=At({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===i)return[new t.V(e.key,e.value,'identity function may not have a "stops" property')];let r=[];const n=e.value;return r=r.concat(pt({key:e.key,value:n,valueSpec:e.valueSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:A})),"array"===t.n(n)&&0===n.length&&r.push(new t.V(e.key,n,"array must have at least one stop")),r},default:function(t){return Dt({key:t.key,value:t.value,valueSpec:r,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===i&&l&&h.push(new t.V(e.key,e.value,'missing required property "property"')),"identity"===i||e.value.stops||h.push(new t.V(e.key,e.value,'missing required property "stops"')),"exponential"===i&&e.valueSpec.expression&&!t.s(e.valueSpec)&&h.push(new t.V(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(c&&!t.q(e.valueSpec)?h.push(new t.V(e.key,e.value,"property functions not supported")):l&&!t.r(e.valueSpec)&&h.push(new t.V(e.key,e.value,"zoom functions not supported"))),"categorical"!==i&&!u||void 0!==e.value.property||h.push(new t.V(e.key,e.value,'"property" property is required')),h;function A(e){let i=[];const n=e.value,l=e.key;if("array"!==t.n(n))return[new t.V(l,n,`array expected, ${t.n(n)} found`)];if(2!==n.length)return[new t.V(l,n,`array length 2 expected, length ${n.length} found`)];if(u){if("object"!==t.n(n[0]))return[new t.V(l,n,`object expected, ${t.n(n[0])} found`)];if(void 0===n[0].zoom)return[new t.V(l,n,"object stop key must have zoom")];if(void 0===n[0].value)return[new t.V(l,n,"object stop key must have value")];const r=t.u(n[0].zoom);if("number"!=typeof r)return[new t.V(l,n[0].zoom,"stop zoom values must be numbers")];if(a&&a>r)return[new t.V(l,n[0].zoom,"stop zoom values must appear in ascending order")];r!==a&&(a=r,o=void 0,s={}),i=i.concat(At({key:`${l}[0]`,value:n[0],valueSpec:{zoom:{}},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:dt,value:p}}))}else i=i.concat(p({key:`${l}[0]`,value:n[0],valueSpec:{},style:e.style,styleSpec:e.styleSpec},n));return t.t(t.v(n[1]))?i.concat([new t.V(`${l}[1]`,n[1],"expressions are not allowed in function stops.")]):i.concat(Dt({key:`${l}[1]`,value:n[1],valueSpec:r,style:e.style,styleSpec:e.styleSpec}))}function p(e,a){const l=t.n(e.value),c=t.u(e.value),u=null!==e.value?e.value:a;if(n){if(l!==n)return[new t.V(e.key,u,`${l} stop domain type must match previous stop domain type ${n}`)]}else n=l;if("number"!==l&&"string"!==l&&"boolean"!==l&&"number"!=typeof c&&"string"!=typeof c&&"boolean"!=typeof c)return[new t.V(e.key,u,"stop domain value must be a number, string, or boolean")];if("number"!==l&&"categorical"!==i){let n=`number expected, ${l} found`;return t.q(r)&&void 0===i&&(n+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new t.V(e.key,u,n)]}return"categorical"!==i||"number"!==l||"number"==typeof c&&isFinite(c)&&Math.floor(c)===c?"categorical"!==i&&"number"===l&&"number"==typeof c&&"number"==typeof o&&void 0!==o&&c<o?[new t.V(e.key,u,"stop domain values must appear in ascending order")]:(o=c,"categorical"===i&&c in s?[new t.V(e.key,u,"stop domain values must be unique")]:(s[c]=!0,[])):[new t.V(e.key,u,`integer expected, found ${String(c)}`)]}}function mt(e){const r=("property"===e.expressionContext?t.x:t.y)(t.v(e.value),e.valueSpec);if("error"===r.result)return r.value.map((r=>new t.V(`${e.key}${r.key}`,e.value,r.message)));const i=r.value.expression||r.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!i.outputDefined())return[new t.V(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===e.expressionContext&&"layout"===e.propertyType&&!t.z(i))return[new t.V(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext)return gt(i,e);if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!t.A(i,["zoom","feature-state"]))return[new t.V(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!t.B(i))return[new t.V(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function gt(e,r){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const t of r.valueSpec.expression.parameters)i.delete(t);if(0===i.size)return[];const n=[];return e instanceof t.D&&i.has(e.name)?[new t.V(r.key,r.value,`["${e.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(e.eachChild((t=>{n.push(...gt(t,r))})),n)}function _t(e){const r=e.key,i=e.value,n=e.valueSpec,o=[];return Array.isArray(n.values)?-1===n.values.indexOf(t.u(i))&&o.push(new t.V(r,i,`expected one of [${n.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(n.values).indexOf(t.u(i))&&o.push(new t.V(r,i,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(i)} found`)),o}function yt(e){return t.G(t.v(e.value))?mt(t.o({},e,{expressionContext:"filter",valueSpec:e.styleSpec[`filter_${e.layerType||"fill"}`]})):vt(e)}function vt(e){const r=e.value,i=e.key;if("array"!==t.n(r))return[new t.V(i,r,`array expected, ${t.n(r)} found`)];const n=e.styleSpec;let o,a=[];if(r.length<1)return[new t.V(i,r,"filter array must have at least 1 element")];switch(a=a.concat(_t({key:`${i}[0]`,value:r[0],valueSpec:n.filter_operator,style:e.style,styleSpec:e.styleSpec})),t.u(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&"$type"===t.u(r[1])&&a.push(new t.V(i,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":3!==r.length&&a.push(new t.V(i,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(o=t.n(r[1]),"string"!==o&&a.push(new t.V(`${i}[1]`,r[1],`string expected, ${o} found`)));for(let s=2;s<r.length;s++)o=t.n(r[s]),"$type"===t.u(r[1])?a=a.concat(_t({key:`${i}[${s}]`,value:r[s],valueSpec:n.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==o&&"number"!==o&&"boolean"!==o&&a.push(new t.V(`${i}[${s}]`,r[s],`string, number, or boolean expected, ${o} found`));break;case"any":case"all":case"none":for(let t=1;t<r.length;t++)a=a.concat(vt({key:`${i}[${t}]`,value:r[t],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":o=t.n(r[1]),2!==r.length?a.push(new t.V(i,r,`filter array for "${r[0]}" operator must have 2 elements`)):"string"!==o&&a.push(new t.V(`${i}[1]`,r[1],`string expected, ${o} found`))}return a}function xt(e,r){const i=e.key,n=e.style,o=e.layer,a=e.styleSpec,s=e.value,l=e.objectKey,c=a[`${r}_${e.layerType}`];if(!c)return[];const u=l.match(/^(.*)-transition$/);if("paint"===r&&u&&c[u[1]]&&c[u[1]].transition)return Dt({key:i,value:s,valueSpec:a.transition,style:n,styleSpec:a});const h=e.valueSpec||c[l];if(!h)return[new t.m(i,s,`unknown property "${l}"`)];let A;if("string"===t.n(s)&&t.q(h)&&!h.tokens&&(A=/^{([^}]+)}$/.exec(s))){const e=`\`{ "type": "identity", "property": ${A?JSON.stringify(A[1]):'"_"'} }\``;return[new t.V(i,s,`"${l}" does not support interpolation syntax\nUse an identity property function instead: ${e}.`)]}const p=[];if("symbol"===e.layerType)"text-field"!==l||!n||n.glyphs||n.imports||p.push(new t.V(i,s,'use of "text-field" requires a style "glyphs" property')),"text-font"===l&&t.H(t.v(s))&&"identity"===t.u(s.type)&&p.push(new t.V(i,s,'"text-font" does not support identity functions'));else if("model"===e.layerType&&"paint"===r&&o&&o.layout&&o.layout.hasOwnProperty("model-id")&&t.q(h)&&(t.J(h)||t.r(h))){const e=t.x(t.v(s),h),r=e.value.expression||e.value._styleExpression.expression;r&&!t.A(r,["measure-light"])&&("model-emissive-strength"===l&&t.B(r)&&t.z(r)||p.push(new t.V(i,s,`${l} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return p.concat(Dt({key:e.key,value:s,valueSpec:h,style:n,styleSpec:a,expressionContext:"property",propertyType:r,propertyKey:l}))}function wt(t){return xt(t,"paint")}function bt(t){return xt(t,"layout")}function Bt(e){let r=[];const i=e.value,n=e.key,o=e.style,a=e.styleSpec;i.type||i.ref||r.push(new t.V(n,i,'either "type" or "ref" is required'));let s=t.u(i.type);const l=t.u(i.ref);if(i.id){const a=t.u(i.id);for(let s=0;s<e.arrayIndex;s++){const e=o.layers[s];t.u(e.id)===a&&r.push(new t.V(n,i.id,`duplicate layer id "${i.id}", previously used at line ${e.id.__line__}`))}}if("ref"in i){let e;["type","source","source-layer","filter","layout"].forEach((e=>{e in i&&r.push(new t.V(n,i[e],`"${e}" is prohibited for ref layers`))})),o.layers.forEach((r=>{t.u(r.id)===l&&(e=r)})),e?e.ref?r.push(new t.V(n,i.ref,"ref cannot reference another ref layer")):s=t.u(e.type):"string"==typeof l&&r.push(new t.V(n,i.ref,`ref layer "${l}" not found`))}else if("background"!==s&&"sky"!==s&&"slot"!==s)if(i.source){const e=o.sources&&o.sources[i.source],a=e&&t.u(e.type);e?"vector"===a&&"raster"===s?r.push(new t.V(n,i.source,`layer "${i.id}" requires a raster source`)):"raster"===a&&"raster"!==s?r.push(new t.V(n,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==a||i["source-layer"]?"raster-dem"===a&&"hillshade"!==s?r.push(new t.V(n,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"raster-array"!==a||["raster","raster-particle"].includes(s)?"line"!==s||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||"geojson"===a&&e.lineMetrics?"raster-particle"===s&&"raster-array"!==a&&r.push(new t.V(n,i.source,`layer "${i.id}" requires a 'raster-array' source.`)):r.push(new t.V(n,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new t.V(n,i.source,"raster-array source can only be used with layer type 'raster'.")):r.push(new t.V(n,i,`layer "${i.id}" must specify a "source-layer"`)):r.push(new t.V(n,i.source,`source "${i.source}" not found`))}else r.push(new t.V(n,i,'missing required property "source"'));return r=r.concat(At({key:n,value:i,valueSpec:a.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Dt({key:`${n}.type`,value:i.type,valueSpec:a.layer.type,style:e.style,styleSpec:e.styleSpec,object:i,objectKey:"type"}),filter:e=>yt(t.o({layerType:s},e)),layout:e=>At({layer:i,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>bt(t.o({layerType:s},e))}}),paint:e=>At({layer:i,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>wt(t.o({layerType:s,layer:i},e))}})}})),r}function Ct(e){const r=e.value,i=e.key,n=t.n(r);return"string"!==n?[new t.V(i,r,`string expected, ${n} found`)]:[]}const Et={promoteId:function({key:e,value:r}){if("string"===t.n(r))return Ct({key:e,value:r});{const t=[];for(const i in r)t.push(...Ct({key:`${e}.${i}`,value:r[i]}));return t}}};function Tt(e){const r=e.value,i=e.key,n=e.styleSpec,o=e.style;if(!r.type)return[new t.V(i,r,'"type" is required')];const a=t.u(r.type);let s=[];switch(["vector","raster","raster-dem","raster-array"].includes(a)&&(r.url||r.tiles||s.push(new t.m(i,r,'Either "url" or "tiles" is required.'))),a){case"vector":case"raster":case"raster-dem":case"raster-array":return s=s.concat(At({key:i,value:r,valueSpec:n[`source_${a.replace("-","_")}`],style:e.style,styleSpec:n,objectElementValidators:Et})),s;case"geojson":if(s=At({key:i,value:r,valueSpec:n.source_geojson,style:o,styleSpec:n,objectElementValidators:Et}),r.cluster)for(const t in r.clusterProperties){const[e,n]=r.clusterProperties[t],o="string"==typeof e?[e,["accumulated"],["get",t]]:e;s.push(...mt({key:`${i}.${t}.map`,value:n,expressionContext:"cluster-map"})),s.push(...mt({key:`${i}.${t}.reduce`,value:o,expressionContext:"cluster-reduce"}))}return s;case"video":return At({key:i,value:r,valueSpec:n.source_video,style:o,styleSpec:n});case"image":return At({key:i,value:r,valueSpec:n.source_image,style:o,styleSpec:n});case"canvas":return[new t.V(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return _t({key:`${i}.type`,value:r.type,valueSpec:{values:It(n)},style:o,styleSpec:n})}}function It(t){return t.source.reduce(((e,r)=>{const i=t[r];return"enum"===i.type.type&&(e=e.concat(Object.keys(i.type.values))),e}),[])}function St(e){const r=e.value,i=e.styleSpec,n=i.light,o=e.style;let a=[];const s=t.n(r);if(void 0===r)return a;if("object"!==s)return a=a.concat([new t.V("light",r,`object expected, ${s} found`)]),a;for(const e in r){const s=e.match(/^(.*)-transition$/);a=a.concat(s&&n[s[1]]&&n[s[1]].transition?Dt({key:e,value:r[e],valueSpec:i.transition,style:o,styleSpec:i}):n[e]?Dt({key:e,value:r[e],valueSpec:n[e],style:o,styleSpec:i}):[new t.V(e,r[e],`unknown property "${e}"`)])}return a}function Mt(e){const r=e.value;let i=[];if(!r)return i;const n=t.n(r);if("object"!==n)return i=i.concat([new t.V("light-3d",r,`object expected, ${n} found`)]),i;const o=e.styleSpec,a=o["light-3d"],s=e.key,l=e.style,c=e.style.lights;for(const e of["type","id"])if(!(e in r))return i=i.concat([new t.V("light-3d",r,`missing property ${e} on light`)]),i;if(r.type&&c)for(let n=0;n<e.arrayIndex;n++){const e=t.u(r.type),o=c[n];t.u(o.type)===e&&i.push(new t.V(s,r.id,`duplicate light type "${r.type}", previously defined at line ${o.id.__line__}`))}const u=`properties_light_${r.type}`;if(!(u in o))return i=i.concat([new t.V("light-3d",r,`Invalid light type ${r.type}`)]),i;const h=o[u];for(const n in r)if("properties"===n){const a=r[n],s=t.n(a);if("object"!==s)return i=i.concat([new t.V("properties",a,`object expected, ${s} found`)]),i;for(const r in a)i=i.concat(h[r]?Dt({key:r,value:a[r],valueSpec:h[r],style:l,styleSpec:o}):[new t.m(e.key,a[r],`unknown property "${r}"`)])}else{const e=n.match(/^(.*)-transition$/);i=i.concat(e&&a[e[1]]&&a[e[1]].transition?Dt({key:n,value:r[n],valueSpec:o.transition,style:l,styleSpec:o}):a[n]?Dt({key:n,value:r[n],valueSpec:a[n],style:l,styleSpec:o}):[new t.m(n,r[n],`unknown property "${n}"`)])}return i}function Ft(e){const r=e.value,i=e.key,n=e.style,o=e.styleSpec,a=o.terrain;let s=[];const l=t.n(r);if(void 0===r)return s;if("null"===l)return s;if("object"!==l)return s=s.concat([new t.V("terrain",r,`object expected, ${l} found`)]),s;for(const e in r){const i=e.match(/^(.*)-transition$/);s=s.concat(i&&a[i[1]]&&a[i[1]].transition?Dt({key:e,value:r[e],valueSpec:o.transition,style:n,styleSpec:o}):a[e]?Dt({key:e,value:r[e],valueSpec:a[e],style:n,styleSpec:o}):[new t.m(e,r[e],`unknown property "${e}"`)])}if(r.source){const e=n.sources&&n.sources[r.source],o=e&&t.u(e.type);e?"raster-dem"!==o&&s.push(new t.V(i,r.source,`terrain cannot be used with a source of type ${String(o)}, it only be used with a "raster-dem" source type`)):s.push(new t.V(i,r.source,`source "${r.source}" not found`))}else s.push(new t.V(i,r,'terrain is missing required property "source"'));return s}function Pt(e){const r=e.value,i=e.style,n=e.styleSpec,o=n.fog;let a=[];const s=t.n(r);if(void 0===r)return a;if("object"!==s)return a=a.concat([new t.V("fog",r,`object expected, ${s} found`)]),a;for(const e in r){const s=e.match(/^(.*)-transition$/);a=a.concat(s&&o[s[1]]&&o[s[1]].transition?Dt({key:e,value:r[e],valueSpec:n.transition,style:i,styleSpec:n}):o[e]?Dt({key:e,value:r[e],valueSpec:o[e],style:i,styleSpec:n}):[new t.m(e,r[e],`unknown property "${e}"`)])}return a}const Lt={"*":()=>[],array:pt,boolean:function(e){const r=e.value,i=e.key,n=t.n(r);return"boolean"!==n?[new t.V(i,r,`boolean expected, ${n} found`)]:[]},number:dt,color:function(e){const r=e.key,i=e.value,n=t.n(i);return"string"!==n?[new t.V(r,i,`color expected, ${n} found`)]:null===t.F(i)?[new t.V(r,i,`color expected, "${i}" found`)]:[]},enum:_t,filter:yt,function:ft,layer:Bt,object:At,source:Tt,model:t.K,light:St,"light-3d":Mt,terrain:Ft,fog:Pt,string:Ct,formatted:function(t){return 0===Ct(t).length?[]:mt(t)},resolvedImage:function(t){return 0===Ct(t).length?[]:mt(t)},projection:function(e){const r=e.value,i=e.styleSpec,n=i.projection,o=e.style;let a=[];const s=t.n(r);if("object"===s)for(const t in r)a=a.concat(Dt({key:t,value:r[t],valueSpec:n[t],style:o,styleSpec:i}));else"string"!==s&&(a=a.concat([new t.V("projection",r,`object or string expected, ${s} found`)]));return a},import:function(e){const{value:r,styleSpec:i}=e,{data:n,...o}=r;Object.defineProperty(o,"__line__",{value:r.__line__,enumerable:!1});let a=At(t.o({},e,{value:o,valueSpec:i.import}));return""===t.u(o.id)&&a.push(new t.V(`${e.key}.id`,o,"import id can't be an empty string")),n&&(a=a.concat(kt(n,i,{key:`${e.key}.data`}))),a}};function Dt(e,r=!1){const i=e.value,n=e.valueSpec,o=e.styleSpec;if(n.expression&&t.H(t.u(i)))return ft(e);if(n.expression&&t.t(t.v(i)))return mt(e);if(n.type&&Lt[n.type]){const i=Lt[n.type](e);return!0===r&&i.length>0&&"array"===t.n(e.value)?mt(e):i}return At(t.o({},e,{valueSpec:n.type?o[n.type]:n}))}function Ut(e){const r=e.value,i=e.key,n=Ct(e);return n.length||(-1===r.indexOf("{fontstack}")&&n.push(new t.V(i,r,'"glyphs" url must include a "{fontstack}" token')),-1===r.indexOf("{range}")&&n.push(new t.V(i,r,'"glyphs" url must include a "{range}" token'))),n}function kt(e,r=t.L,i={}){return Dt({key:i.key||"",value:e,valueSpec:r.$root,styleSpec:r,style:e,objectElementValidators:{glyphs:Ut,"*":()=>[]}})}function zt(e,r=t.L){return Zt(kt(e,r))}const Rt=t=>Zt(Tt(t)),Ot=t=>Zt(St(t)),Qt=t=>Zt(Mt(t)),Nt=t=>Zt(Ft(t)),Vt=t=>Zt(Pt(t)),Ht=t=>Zt(Bt(t)),jt=t=>Zt(yt(t)),Gt=t=>Zt(wt(t)),Kt=t=>Zt(bt(t)),qt=e=>Zt(t.K(e));function Zt(t){return t.slice().sort(((t,e)=>t.line&&e.line?t.line-e.line:0))}function Wt(e,r){let i=!1;if(r&&r.length)for(const n of r)n instanceof t.m?t.w(n.message):(e.fire(new t.d(new Error(n.message))),i=!0);return i}const Xt=new t.N({anchor:new t.O(t.L.light.anchor),position:new t.Q(t.L.light.position),color:new t.O(t.L.light.color),intensity:new t.O(t.L.light.intensity)});class $t extends t.E{constructor(e,r="flat"){super(),this._transitionable=new t.U(Xt),this.setLight(e,r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,e,r={}){this._validate(Ot,t,r)||(this._transitionable.setTransitionOrValue(t),this.id=e)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(e,r,i){return(!i||!1!==i.validate)&&Wt(this,e.call(zt,t.W({value:r,style:{glyphs:!0,sprite:!0},styleSpec:t.L})))}}const Yt=new t.N({source:new t.O(t.L.terrain.source),exaggeration:new t.O(t.L.terrain.exaggeration)});let Jt=class extends t.E{constructor(e,r,i,n){super(),this.scope=i,this._transitionable=new t.U(Yt,i,n),this._transitionable.setTransitionOrValue(e,n),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=r}get(){return this._transitionable.serialize()}set(t,e){this._transitionable.setTransitionOrValue(t,e)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}getExaggeration(e){return this._transitioning.possiblyEvaluate(new t.X(e)).get("exaggeration")}isZoomDependent(){const e=this._transitionable._values.exaggeration;return null!=e&&null!=e.value&&null!=e.value.expression&&e.value.expression instanceof t.Z}};const te=45,ee=65,re=.05;function ie(e,r,i,n){const o=t.$(te,ee,i),[a,s]=ne(e,n);let l=1-Math.min(1,Math.exp((r-a)/(s-a)*-6));return l*=l*l,l=Math.min(1,1.00747*l),l*o*e.alpha}function ne(t,e){const r=.5/Math.tan(.5*e);return[t.range[0]+r,t.range[1]+r]}function oe(e,r,i,n,o){const a=t._.transformMat4([],[r,i,n],o.mercatorFogMatrix);return ie(e,t._.length(a),o.pitch,o._fov)}function ae(e,r,i,n,o,a,s){const l=[[i,n,0],[o,n,0],[o,a,0],[i,a,0]];let c=Number.MAX_VALUE,u=-Number.MAX_VALUE;for(const e of l){const i=t._.transformMat4([],e,r),n=t._.length(i);c=Math.min(c,n),u=Math.max(u,n)}return[ie(e,c,s.pitch,s._fov),ie(e,u,s.pitch,s._fov)]}const se=new t.N({range:new t.O(t.L.fog.range),color:new t.O(t.L.fog.color),"high-color":new t.O(t.L.fog["high-color"]),"space-color":new t.O(t.L.fog["space-color"]),"horizon-blend":new t.O(t.L.fog["horizon-blend"]),"star-intensity":new t.O(t.L.fog["star-intensity"]),"vertical-range":new t.O(t.L.fog["vertical-range"])});class le extends t.E{constructor(e,r,i,n){super(),this._transitionable=new t.U(se,i,new Map(n)),this.set(e,n),this._transitioning=this._transitionable.untransitioned(),this._transform=r,this.properties=new t.a0(se),this.scope=i}get state(){const e=this._transform,r="globe"===e.projection.name,i=t.a1(e.zoom),n=this.properties.get("range"),o=[.5,3];return{range:r?[t.a2(o[0],n[0],i),t.a2(o[1],n[1],i)]:n,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(e,r,i={}){if(this._validate(Vt,e,i))return;const n=t.W({},e);for(const e of Object.keys(t.L.fog))void 0===n[e]&&(n[e]=t.L.fog[e].default);this._options=n,this._transitionable.setTransitionOrValue(this._options,r)}getOpacity(e){if(!this._transform.projection.supportsFog)return 0;const r=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:t.$(te,ee,e))*r.a}getOpacityAtLatLng(e,r){return this._transform.projection.supportsFog?function(e,r,i){const n=t.Y.fromLngLat(r),o=i.elevation?i.elevation.getAtPointOrZero(n):0;return oe(e,n.x,n.y,o,i)}(this.state,e,r):0}getOpacityForTile(e){if(!this._transform.projection.supportsFog)return[1,1];const r=this._transform.calculateFogTileMatrix(e.toUnwrapped());return ae(this.state,r,0,0,t.a3,t.a3,this._transform)}getOpacityForBounds(t,e,r,i,n){return this._transform.projection.supportsFog?ae(this.state,t,e,r,i,n,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?ne(this.state,t):[0,1]}isVisibleOnFrustum(e){if(!this._transform.projection.supportsFog)return!1;const r=[4,5,6,7];for(const i of r){const r=e.points[i];let n;if(r[2]>=0)n=r;else{const o=e.points[i-4];n=t.a4(o,r,o[2]/(o[2]-r[2]))}if(oe(this.state,n[0],n[1],0,this._transform)>=re)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(e,r,i){return(!i||!1!==i.validate)&&Wt(this,e.call(zt,t.W({value:r,style:{glyphs:!0,sprite:!0},styleSpec:t.L})))}}class ce extends t.E{constructor(e,r,i,n){super(),this.scope=i,this._options=e,this.properties=new t.a0(r),this._transitionable=new t.U(r,i,new Map(n)),this._transitionable.setTransitionOrValue(e.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,e){this._options=t,this._transitionable.setTransitionOrValue(t.properties,e)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}const ue=new t.N({color:new t.O(t.L.properties_light_ambient.color),intensity:new t.O(t.L.properties_light_ambient.intensity)}),he=new t.N({direction:new t.a5(t.L.properties_light_directional.direction),color:new t.O(t.L.properties_light_directional.color),intensity:new t.O(t.L.properties_light_directional.intensity),"cast-shadows":new t.O(t.L.properties_light_directional["cast-shadows"]),"shadow-intensity":new t.O(t.L.properties_light_directional["shadow-intensity"])});var Ae="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",pe="\nout vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color) {\n#ifdef INDICATOR_CUTOUT\nfloat holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif\nvec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}",de="\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}",fe="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",me="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform highp sampler2D u_depth;uniform vec2 u_depth_size_inv;uniform vec2 u_depth_range_unpack;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\n#ifdef TERRAIN_DEPTH_D24\nfloat unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}\n#else\nhighp float unpack_depth_rgba(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;\n#ifdef TERRAIN_DEPTH_D24\nfloat depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);\n#else\nfloat depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));\n#endif\nreturn coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;\n#ifdef TERRAIN_DEPTH_D24\nvec4 depth=vec4(\ntexture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r\n);depth=unpack_depth4(depth);\n#else\nvec4 depth=vec4(\nunpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))\n);\n#endif\nreturn dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",ge="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",_e="highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {\n#ifdef FOG_DITHERING\nvec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);\n#else\nreturn color;\n#endif\n}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",ye="#ifdef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)\n);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)\n);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",ve="#ifdef RASTER_ARRAY\nuniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}\n#endif\nuniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}",xe="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",we="#ifdef RENDER_SHADOWS\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef NATIVE\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const be=[];Se(Ae,be),Se(de,be),Se(pe,be);const Be={"_prelude_fog.vertex.glsl":ge,"_prelude_terrain.vertex.glsl":me,"_prelude_shadow.vertex.glsl":xe,"_prelude_fog.fragment.glsl":_e,"_prelude_shadow.fragment.glsl":we,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE","_prelude_raster_array.glsl":ye,"_prelude_raster_particle.glsl":ve},Ce={};Me("",me),Me(_e,ge),Me(we,xe),Me(ye,""),Me(ve,"");const Ee=Me(pe,de),Te=Ae;var Ie={background:Me('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:Me('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),circle:Me('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:Me("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Me('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:Me("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Me("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:Me("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Me("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),fill:Me('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutline:Me('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:Me('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:Me('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:Me('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nuniform float u_emissive_strength;in float v_height;void main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor;\n#ifdef RENDER_CUTOFF\nshadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}\n#else\nshadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);\n#endif\ncolor.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat cutoff=1.0;vec3 scaled_pos=pos;\n#ifdef RENDER_CUTOFF\nvec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),fillExtrusionDepth:Me("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\nout highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:Me('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\nin vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nout vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:Me('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:Me("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;\n#endif\nHANDLE_WIREFRAME_DEBUG;\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:Me("precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Me('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:Me('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform lowp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trim_alpha=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/clamp(u_trim_fade_range[0],1e-4,1.0)));float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/clamp(u_trim_fade_range[1],1e-4,1.0)));float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED)\nin float a_z_offset;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);\n#if defined(ELEVATED)\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);\n#else\ngl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),linePattern:Me('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 v_uv;\n#endif\n#ifdef LINE_JOIN_NONE\nin vec2 v_pattern_data;\n#endif\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define mediump float pixel_ratio\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize mediump float pixel_ratio\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}\n#endif\n#ifdef LINE_JOIN_NONE\nfloat pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}\n#endif\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_ground(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED)\nin float a_z_offset;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 a_packed;\n#endif\nin highp float a_linesofar;\n#ifdef LINE_JOIN_NONE\nin highp vec3 a_pattern_data;out vec2 v_pattern_data;\n#endif\nuniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nout highp vec4 v_uv;\n#endif\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\n#pragma mapbox: define mediump float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define mediump float floorwidth\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define mediump float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\n#pragma mapbox: initialize mediump float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize mediump float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize mediump float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);\n#if defined(ELEVATED)\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);\n#else\ngl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nfloat a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef LINE_JOIN_NONE\nv_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),raster:Me('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nin float v_split_fade;\n#endif\nuniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;\n#ifdef GLOBE_POLES\ncolor.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);\n#endif\nvec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef PROJECTION_GLOBE_VIEW\nglFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));\n#endif\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nout float v_split_fade;\n#endif\nvoid main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    \nv_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\ngl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),rasterParticle:Me('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\nin vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\nuv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),rasterParticleDraw:Me("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",'#include "_prelude_raster_particle.glsl"\nin float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(\nmod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}'),rasterParticleTexture:Me("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Me('#include "_prelude_raster_particle.glsl"\nuniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(\nlinearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)\n);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}',"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:Me('#include "_prelude_lighting.glsl"\nuniform sampler2D u_texture;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\nin float v_fade_opacity;in vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\n#ifdef COLOR_ADJUSTMENT\nuniform mat4 u_color_adj_mat;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nlowp float alpha=opacity*v_fade_opacity;vec4 out_color;\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);\n#else\nout_color=texture(u_texture,v_tex_a);\n#endif\n#ifdef COLOR_ADJUSTMENT\nout_color=u_color_adj_mat*out_color;\n#endif\nout_color*=alpha;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef OCCLUSION_QUERIES\nin float a_occlusion_query_opacity;\n#endif\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\n#pragma mapbox: define lowp float occlusion_opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\n#pragma mapbox: initialize lowp float occlusion_opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;vec2 a;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;\n#endif\nvec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=globe_occlusion_fade;\n#ifdef SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH\nocclusion_fade*=occlusionFade(projected_point);\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nv_tex_a=a_tex/u_texsize;\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\nv_fade_opacity=out_fade_opacity;\n#ifdef OCCLUSION_QUERIES\nfloat occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);v_fade_opacity*=occludedFadeMultiplier;\n#endif\n}'),symbolSDF:Me('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef OCCLUSION_QUERIES\nin float a_occlusion_query_opacity;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec2 v_data0;out vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\n#pragma mapbox: define lowp float occlusion_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\n#pragma mapbox: initialize lowp float occlusion_opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;\n#endif\nvec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=globe_occlusion_fade;\n#ifdef SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH\nocclusion_fade*=occlusionFade(projected_point);\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;\n#ifdef OCCLUSION_QUERIES\nfloat occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;\n#endif\nfloat alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}'),symbolTextAndIcon:Me('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef OCCLUSION_QUERIES\nin float a_occlusion_query_opacity;\n#endif\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec4 v_data0;out vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\n#pragma mapbox: define lowp float occlusion_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\n#pragma mapbox: initialize lowp float occlusion_opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=globe_occlusion_fade;\n#ifdef SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH\nocclusion_fade*=occlusionFade(projected_point);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nfloat out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;\n#ifdef OCCLUSION_QUERIES\nfloat occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;\n#endif\nfloat alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+ xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}'),terrainRaster:Me('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);\n#endif\n}'),terrainDepth:Me("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:Me('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',fe),skyboxGradient:Me('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',fe),skyboxCapture:Me("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Me('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:Me('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;\n#ifndef NATIVE\nc=dither(c,gl_FragCoord.xy+u_temporal_offset);\n#endif\nglFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:Me('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nuniform vec4 u_occlusionTextureTransform;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef APPLY_LUT_ON_GPU\nuniform highp sampler3D u_lutTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform highp sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;uniform vec2 u_depth_range_unpack;\n#ifdef TERRAIN_DEPTH_D24\nfloat unpack_depth(float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}\n#else\nhighp float unpack_depth_rgba(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;\n#ifdef TERRAIN_DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depthTexture,coord).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));\n#endif\nreturn v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\nif(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}\n#endif\nvec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);\n#ifdef APPLY_LUT_ON_GPU\ncolor=applyLUT(u_lutTexture,color);\n#endif\nreturn color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nvec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;\n#else\nvec2 uv=uv_2f;\n#endif\nao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\n#ifdef APPLY_LUT_ON_GPU\nfloat emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;\n#ifdef APPLY_LUT_ON_GPU\ncolor_mix=applyLUT(u_lutTexture,color_mix);\n#endif\ncolor=mix(color,color_mix,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:Me("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:Me("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}"),occlusion:Me("uniform vec4 u_color;void main() {glFragColor=u_color;}",'#include "_prelude_terrain.vertex.glsl"\nin highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;\n#ifdef TERRAIN\nfloat e=elevation(world_pos.xy);world_pos.z+=e;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}')};function Se(t,e){const r=t.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let t of r)if(t=t.trim(),"#"===t[0]&&t.includes("if")&&!t.includes("endif")){t=t.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const r=t.split(" ");for(const t of r)e.includes(t)||e.push(t)}}function Me(t,e){const r=/#include\s+"([^"]+)"/g,i=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let n=e.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);n&&(n=n.map((t=>{const e=t.split(" ");return e[e.length-1]})),n=[...new Set(n)]);const o={},a=[],s=[];if(t=t.replace(r,((t,e)=>(s.push(e),""))),(e=e.replace(r,((t,e)=>(a.push(e),"")))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let l=[...be];Se(t,l),Se(e,l);for(const t of[...a,...s])Be[t]||console.error(`Undefined include: ${t}`),Ce[t]||(Ce[t]=[],Se(Be[t],Ce[t])),l=[...l,...Ce[t]];return{fragmentSource:t=t.replace(i,((t,e,r,i,n)=>(o[n]=!0,"define"===e?`\n#ifndef HAS_UNIFORM_u_${n}\nin ${r} ${i} ${n};\n#else\nuniform ${r} ${i} u_${n};\n#endif\n`:"initialize"===e?`\n#ifdef HAS_UNIFORM_u_${n}\n    ${r} ${i} ${n} = u_${n};\n#endif\n`:"define-attribute"===e?`\n#ifdef HAS_ATTRIBUTE_a_${n}\n    in ${r} ${i} ${n};\n#endif\n`:"initialize-attribute"===e?"":void 0))),vertexSource:e=e.replace(i,((t,e,r,i,n)=>{const a="float"===i?"vec2":i,s=n.match(/color/)?"color":a;return"define-attribute-vertex-shader-only"===e?`\n#ifdef HAS_ATTRIBUTE_a_${n}\nin ${r} ${i} a_${n};\n#endif\n`:o[n]?"define"===e?`\n#ifndef HAS_UNIFORM_u_${n}\nuniform lowp float u_${n}_t;\nin ${r} ${a} a_${n};\nout ${r} ${i} ${n};\n#else\nuniform ${r} ${i} u_${n};\n#endif\n`:"initialize"===e?"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${n}\n    ${n} = a_${n};\n#else\n    ${r} ${i} ${n} = u_${n};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${n}\n    ${n} = unpack_mix_${s}(a_${n}, u_${n}_t);\n#else\n    ${r} ${i} ${n} = u_${n};\n#endif\n`:"define-attribute"===e?`\n#ifdef HAS_ATTRIBUTE_a_${n}\n    in ${r} ${i} a_${n};\n    out ${r} ${i} ${n};\n#endif\n`:"initialize-attribute"===e?`\n#ifdef HAS_ATTRIBUTE_a_${n}\n    ${n} = a_${n};\n#endif\n`:void 0:"define"===e?`\n#ifndef HAS_UNIFORM_u_${n}\nuniform lowp float u_${n}_t;\nin ${r} ${a} a_${n};\n#else\nuniform ${r} ${i} u_${n};\n#endif\n`:"define-instanced"===e?"mat4"===s?`\n#ifdef INSTANCED_ARRAYS\nin vec4 a_${n}0;\nin vec4 a_${n}1;\nin vec4 a_${n}2;\nin vec4 a_${n}3;\n#else\nuniform ${r} ${i} u_${n};\n#endif\n`:`\n#ifdef INSTANCED_ARRAYS\nin ${r} ${a} a_${n};\n#else\nuniform ${r} ${i} u_${n};\n#endif\n`:"initialize-attribute-custom"===e?`\n#ifdef HAS_ATTRIBUTE_a_${n}\n    ${r} ${i} ${n} = a_${n};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${n}\n    ${r} ${i} ${n} = a_${n};\n#else\n    ${r} ${i} ${n} = u_${n};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${n}\n    ${r} ${i} ${n} = unpack_mix_${s}(a_${n}, u_${n}_t);\n#else\n    ${r} ${i} ${n} = u_${n};\n#endif\n`})),staticAttributes:n,usedDefines:l,vertexIncludes:a,fragmentIncludes:s}}class Fe{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,e,r,i,n,o,a,s){this.context=t;let l=this.boundPaintVertexBuffers.length!==i.length;for(let t=0;!l&&t<i.length;t++)this.boundPaintVertexBuffers[t]!==i[t]&&(l=!0);let c=this.boundDynamicVertexBuffers.length!==a.length;for(let t=0;!c&&t<a.length;t++)this.boundDynamicVertexBuffers[t]!==a[t]&&(c=!0);if(!this.vao||this.boundProgram!==e||this.boundLayoutVertexBuffer!==r||l||c||this.boundIndexBuffer!==n||this.boundVertexOffset!==o)this.freshBind(e,r,i,n,o,a,s);else{t.bindVertexArrayOES.set(this.vao);for(const r of a)r&&(r.bind(),s&&r.instanceCount&&r.setVertexAttribDivisor(t.gl,e,s));n&&n.dynamicDraw&&n.bind()}}freshBind(t,e,r,i,n,o,a){const s=t.numAttributes,l=this.context,c=l.gl;this.vao&&this.destroy(),this.vao=l.gl.createVertexArray(),l.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=r,this.boundIndexBuffer=i,this.boundVertexOffset=n,this.boundDynamicVertexBuffers=o,e.enableAttributes(c,t),e.bind(),e.setVertexAttribPointers(c,t,n);for(const e of r)e.enableAttributes(c,t),e.bind(),e.setVertexAttribPointers(c,t,n);for(const e of o)e&&(e.enableAttributes(c,t),e.bind(),e.setVertexAttribPointers(c,t,n),a&&e.instanceCount&&e.setVertexAttribDivisor(c,t,a));i&&i.bind(),l.currentNumAttributes=s}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Pe(e,r){const i=Math.pow(2,r.canonical.z),n=r.canonical.y;return[new t.Y(0,n/i).toLngLat().lat,new t.Y(0,(n+1)/i).toLngLat().lat]}function Le(e,r,i,n,o,a,s){const l=e.context,c=l.gl,u=i.hillshadeFBO;if(!u)return;e.prepareDrawTile();const h=e.isTileAffectedByFog(r),A=e.getOrCreateProgram("hillshade",{overrideFog:h});l.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,u.colorAttachment.get());const p=((e,r,i,n)=>{const o=i.paint.get("hillshade-shadow-color"),a=i.paint.get("hillshade-highlight-color"),s=i.paint.get("hillshade-accent-color"),l=i.paint.get("hillshade-emissive-strength");let c=t.ab(i.paint.get("hillshade-illumination-direction"));if("viewport"===i.paint.get("hillshade-illumination-anchor"))c-=e.transform.angle;else if(e.style&&e.style.enable3dLights()&&e.style.directionalLight){const r=e.style.directionalLight.properties.get("direction"),i=t.ac(r.x,r.y,r.z);c=t.ab(i[1])}const u=!e.options.moving;return{u_matrix:n||e.transform.calculateProjMatrix(r.tileID.toUnwrapped(),u),u_image:0,u_latrange:Pe(0,r.tileID),u_light:[i.paint.get("hillshade-exaggeration"),c],u_shadow:o.toRenderColor(i.lut),u_highlight:a.toRenderColor(i.lut),u_emissive_strength:l,u_accent:s.toRenderColor(i.lut)}})(e,i,n,e.terrain?r.projMatrix:null);e.uploadCommonUniforms(l,A,r.toUnwrapped());const{tileBoundsBuffer:d,tileBoundsIndexBuffer:f,tileBoundsSegments:m}=e.getTileBoundsBuffers(i);A.draw(e,c.TRIANGLES,o,a,s,t.af.disabled,p,n.id,d,f,m)}function De(e,r,i){if(!r.needsDEMTextureUpload)return;const n=e.context,o=n.gl;n.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||e.getTileTexture(i.stride);const a=i.getPixels();r.demTexture?r.demTexture.update(a,{premultiply:!1}):r.demTexture=new t.T(n,a,o.R32F,{premultiply:!1}),r.needsDEMTextureUpload=!1}function Ue(e,r,i){const n=e.context,o=n.gl;if(!r.dem)return;const a=r.dem;if(n.activeTexture.set(o.TEXTURE1),De(e,r,a),!r.demTexture)return;r.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE);const s=a.dim;n.activeTexture.set(o.TEXTURE0);let l=r.hillshadeFBO;if(!l){const e=new t.T(n,{width:s,height:s,data:null},o.RGBA);e.bind(o.LINEAR,o.CLAMP_TO_EDGE),l=r.hillshadeFBO=n.createFramebuffer(s,s,!0,"renderbuffer"),l.colorAttachment.set(e.texture)}n.bindFramebuffer.set(l.framebuffer),n.viewport.set([0,0,s,s]);const{tileBoundsBuffer:c,tileBoundsIndexBuffer:u,tileBoundsSegments:h}=e.getMercatorTileBoundsBuffers(),A=[];e.linearFloatFilteringSupported()&&A.push("TERRAIN_DEM_FLOAT_FORMAT"),e.getOrCreateProgram("hillshadePrepare",{defines:A}).draw(e,o.TRIANGLES,t.ae.disabled,t.ag.disabled,t.a.unblended,t.af.disabled,((e,r)=>{const i=r.stride,n=t.ad.create();return t.ad.ortho(n,0,t.a3,-t.a3,0,0,1),t.ad.translate(n,n,[0,-t.a3,0]),{u_matrix:n,u_image:1,u_dimension:[i,i],u_zoom:e.overscaledZ}})(r.tileID,a),i.id,c,u,h),r.needsHillshadePrepare=!1}function ke(e,r,i,n,o){const a=function(i,n){if(i)return o(i);if(n){if(e.url&&n.tiles&&e.tiles&&delete e.tiles,n.variants){if(!Array.isArray(n.variants))return o(new Error("variants must be an array"));for(const e of n.variants){if(null==e||"object"!=typeof e||e.constructor!==Object)return o(new Error("variant must be an object"));if(!Array.isArray(e.capabilities))return o(new Error("capabilities must be an array"));if(1===e.capabilities.length&&"meshopt"===e.capabilities[0]){n=t.W(n,e);break}}}const i=t.ah(t.W(n,e),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);n.vector_layers&&(i.vectorLayers=n.vector_layers,i.vectorLayerIds=i.vectorLayers.map((t=>t.id))),n.raster_layers&&(i.rasterLayers=n.raster_layers,i.rasterLayerIds=i.rasterLayers.map((t=>t.id))),i.tiles=r.canonicalizeTileset(i,e.url),o(null,i)}};return e.url?t.g(r.transformRequest(r.normalizeSourceURL(e.url,null,i,n),t.R.Source),a):t.e.frame((()=>a(null,e)))}class ze{constructor(e,r,i){this.bounds=t.ai.convert(this.validateBounds(e)),this.minzoom=r||0,this.maxzoom=i||24}validateBounds(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(e){const r=Math.pow(2,e.z),i=Math.floor(t.aj(this.bounds.getWest())*r),n=Math.floor(t.ak(this.bounds.getNorth())*r),o=Math.ceil(t.aj(this.bounds.getEast())*r),a=Math.ceil(t.ak(this.bounds.getSouth())*r);return e.x>=i&&e.x<o&&e.y>=n&&e.y<a}}class Re extends t.E{constructor(e,r,i,n){super(),this.id=e,this.dispatcher=i,this.setEventedParent(n),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.W({type:"raster"},r),t.W(this,t.ah(r,["url","scheme","tileSize"]))}load(e){this._loaded=!1,this.fire(new t.f("dataloading",{dataType:"source"})),this._tileJSONRequest=ke(this._options,this.map._requestManager,null,null,((r,i)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new t.d(r)):i&&(t.W(this,i),i.bounds&&(this.tileBounds=new ze(i.bounds,this.minzoom,this.maxzoom)),t.an(i.tiles),this.fire(new t.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.f("data",{dataType:"source",sourceDataType:"content"}))),e&&e(r)}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const e=t.al(this.id,this.scope);this.load((()=>this.map.style.clearSource(e)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return t.W({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(e,r){const i=t.e.devicePixelRatio>=2,n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),i,this.tileSize);e.request=t.h(this.map._requestManager.transformRequest(n,t.R.Tile),((i,n,o,a)=>(delete e.request,e.aborted?(e.state="unloaded",r(null)):i?(e.state="errored",r(i)):n?(this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:o,expires:a}),e.setTexture(n,this.map.painter),e.state="loaded",t.am(this.dispatcher),void r(null)):r(null))))}abortTile(t,e){t.request&&(t.request.cancel(),delete t.request),e&&e()}unloadTile(e,r){e.texture&&e.texture instanceof t.T?(e.destroy(!0),e.texture&&e.texture instanceof t.T&&this.map.painter.saveTileTexture(e.texture)):e.destroy(),r&&r()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Oe extends t.E{constructor(e,r,i,n){if(super(),this.id=e,this.dispatcher=i,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.W(this,t.ah(r,["url","scheme","tileSize","promoteId"])),this._options=t.W({type:"vector"},r),this._collectResourceTiming=!!r.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(n),this._tileWorkers={},this._deduped=new t.ao}load(e){this._loaded=!1,this.fire(new t.f("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,i=this.map._worldview;this._tileJSONRequest=ke(this._options,this.map._requestManager,r,i,((n,o)=>{this._tileJSONRequest=null,this._loaded=!0,n?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),i&&2!==i.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${i}`),this.fire(new t.d(n))):o&&(t.W(this,o),o.bounds&&(this.tileBounds=new ze(o.bounds,this.minzoom,this.maxzoom)),t.an(o.tiles,this.map._requestManager._customAccessToken),this.fire(new t.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.f("data",{dataType:"source",sourceDataType:"content"}))),e&&e(n)}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const e=t.al(this.id,this.scope);this.load((()=>this.map.style.clearSource(e)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return t.W({},this._options)}loadTile(e,r){const i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),n=this.map._requestManager.transformRequest(i,t.R.Tile),o=this.map.style?this.map.style.getLut(this.scope):null,a={request:n,data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,lut:o?{image:o.image.clone()}:null,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:t.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:e.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:e.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(a.request.collectResourceTiming=this._collectResourceTiming,e.actor&&"expired"!==e.state)"loading"===e.state?e.reloadCallback=r:e.request=e.actor.send("reloadTile",a,s.bind(this));else if(e.actor=this._tileWorkers[i]=this._tileWorkers[i]||this.dispatcher.getActor(),this.dispatcher.ready)e.request=e.actor.send("loadTile",a,s.bind(this),void 0,!0);else{const r=t.ap.call({deduped:this._deduped},a,((t,r)=>{t||!r?s.call(this,t):(a.data={cacheControl:r.cacheControl,expires:r.expires,rawData:r.rawData.slice(0)},e.actor&&e.actor.send("loadTile",a,s.bind(this),void 0,!0))}),!0);e.request={cancel:r}}function s(i,n){return delete e.request,e.aborted?r(null):i&&404!==i.status?r(i):(n&&n.resourceTiming&&(e.resourceTiming=n.resourceTiming),this.map._refreshExpiredTiles&&n&&e.setExpiryData(n),e.loadVectorData(n,this.map.painter),t.am(this.dispatcher),r(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,e){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}const Qe=(t,e,r)=>({u_matrix:t,u_image0:0,u_skirt_height:e,u_ground_shadow_factor:r}),Ne=(t,e,r,i,n,o,a,s,l,c,u,h,A,p,d,f)=>({u_proj_matrix:Float32Array.from(t),u_globe_matrix:e,u_normalize_matrix:Float32Array.from(i),u_merc_matrix:r,u_zoom_transition:n,u_merc_center:o,u_image0:0,u_frustum_tl:a,u_frustum_tr:s,u_frustum_br:l,u_frustum_bl:c,u_globe_pos:u,u_globe_radius:h,u_viewport:A,u_grid_matrix:f?Float32Array.from(f):new Float32Array(9),u_skirt_height:p,u_far_z_cutoff:d});class Ve{constructor(t=0,e=0,r=0,i=0){if(isNaN(t)||t<0||isNaN(e)||e<0||isNaN(r)||r<0||isNaN(i)||i<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=r,this.right=i}interpolate(e,r,i){return null!=r.top&&null!=e.top&&(this.top=t.a2(e.top,r.top,i)),null!=r.bottom&&null!=e.bottom&&(this.bottom=t.a2(e.bottom,r.bottom,i)),null!=r.left&&null!=e.left&&(this.left=t.a2(e.left,r.left,i)),null!=r.right&&null!=e.right&&(this.right=t.a2(e.right,r.right,i)),this}getCenter(e,r){const i=t.at((this.left+e-this.right)/2,0,e),n=t.at((this.top+r-this.bottom)/2,0,r);return new t.P(i,n)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Ve(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function He(e,r){const i=t.aw(e,3);t.ad.fromQuat(e,r),t.az(e,3,i)}function je(e,r){const i=t.av.identity([]);return t.av.rotateZ(i,i,-r),t.av.rotateX(i,i,-e),i}function Ge(e,r){const i=[e[0],e[1],0],n=[r[0],r[1],0];if(t._.length(i)>=1e-15){const e=t._.normalize([],i);t._.scale(n,e,t._.dot(n,e)),r[0]=n[0],r[1]=n[1]}const o=t._.cross([],r,e);if(t._.len(o)<1e-15)return null;const a=Math.atan2(-o[1],o[0]);return je(Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2]),a)}class Ke{constructor(t,e){this.position=t,this.orientation=e}get position(){return this._position}set position(e){if(e){const r=e instanceof t.Y?e:new t.Y(e[0],e[1],e[2]);this._renderWorldCopies&&(r.x=t.au(r.x,0,1)),this._position=r}else this._position=null}lookAtPoint(e,r){if(this.orientation=null,!this.position)return;const i=this.position,n=this._elevation?this._elevation.getAtPointOrZero(t.Y.fromLngLat(e)):0,o=t.Y.fromLngLat(e,n),a=[o.x-i.x,o.y-i.y,o.z-i.z];r||(r=[0,0,1]),r[2]=Math.abs(r[2]),this.orientation=Ge(a,r)}setPitchBearing(e,r){this.orientation=je(t.ab(e),t.ab(-r))}}class qe{constructor(e,r){this._transform=t.ad.identity([]),this.orientation=r,this.position=e}get mercatorPosition(){const e=this.position;return new t.Y(e[0],e[1],e[2])}get position(){const e=t.aw(this._transform,3);return[e[0],e[1],e[2]]}set position(e){var r;e&&t.az(this._transform,3,[(r=e)[0],r[1],r[2],1])}get orientation(){return this._orientation}set orientation(e){this._orientation=e||t.av.identity([]),e&&He(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),e=this.right();return{bearing:Math.atan2(-e[1],e[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,e){this._orientation=je(t,e),He(this._transform,this._orientation)}forward(){const e=t.aw(this._transform,2);return[-e[0],-e[1],-e[2]]}up(){const e=t.aw(this._transform,1);return[-e[0],-e[1],-e[2]]}right(){const e=t.aw(this._transform,0);return[e[0],e[1],e[2]]}getCameraToWorld(e,r){const i=new Float64Array(16);return t.ad.invert(i,this.getWorldToCamera(e,r)),i}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(e,r,i){const n=this.position;t._.scale(n,n,-e);const o=new Float64Array(16);return t.ad.fromScaling(o,[i,i,i]),t.ad.translate(o,o,n),o[10]*=r,o}getWorldToCamera(e,r){const i=new Float64Array(16),n=new Float64Array(4),o=this.position;return t.av.conjugate(n,this._orientation),t._.scale(o,o,-e),t.ad.fromQuat(i,n),t.ad.translate(i,i,o),i[1]*=-1,i[5]*=-1,i[9]*=-1,i[13]*=-1,i[8]*=r,i[9]*=r,i[10]*=r,i[11]*=r,i}getCameraToClipPerspective(e,r,i,n){const o=new Float64Array(16);return t.ad.perspective(o,e,r,i,n),o}getCameraToClipOrthographic(e,r,i,n,o,a){const s=new Float64Array(16);return t.ad.ortho(s,e,r,i,n,o,a),s}getDistanceToElevation(e,r=!1){const i=0===e?0:t.ax(e,r?t.ay(this.position[1]):this.position[1]),n=this.forward();return(i-this.position[2])/n[2]}clone(){return new qe([...this.position],[...this.orientation])}}const Ze={unknown:0,flipRequired:1,flipNotRequired:2},We=Math.tan(85*Math.PI/180);function Xe(e,r,i,n,o,a,s){const l=t.ad.create();if(i)if("globe"===a.name){const e=t.aB(o,r);t.ad.multiply(l,l,e)}else{const e=t.aC.invert([],s);l[0]=e[0],l[1]=e[1],l[4]=e[2],l[5]=e[3],n||t.ad.rotateZ(l,l,o.angle)}else t.ad.multiply(l,o.labelPlaneMatrix,e);return l}function $e(t,e,r,i,n,o,a){const s=Xe(t,e,r,i,n,o,a);return"globe"===o.name&&r||(s[2]=s[6]=s[10]=s[14]=0),s}function Ye(e,r,i,n,o,a,s){if(i){if("globe"===a.name){const l=Xe(e,r,i,n,o,a,s);return t.ad.invert(l,l),t.ad.multiply(l,e,l),l}{const r=t.ad.clone(e),i=t.ad.identity([]);return i[0]=s[0],i[1]=s[1],i[4]=s[2],i[5]=s[3],t.ad.multiply(r,r,i),n||t.ad.rotateZ(r,r,-o.angle),r}}return o.glCoordMatrix}function Je(e,r,i,n){const o=[e,r,i,1];i?t.aA.transformMat4(o,o,n):ur(o,o,n);const a=o[3];return o[0]/=a,o[1]/=a,o[2]/=a,o}function tr(t,e){return Math.min(.5+t/e*.5,1.5)}function er(t,e){const r=t[0]/t[3],i=t[1]/t[3];return r>=-e[0]&&r<=e[0]&&i>=-e[1]&&i<=e[1]}function rr(e,r,i,n,o,a,s,l,c,u){const h=i.transform,A=n?e.textSizeData:e.iconSizeData,p=t.aD(A,i.transform.zoom),d="globe"===h.projection.name,f=[256/i.width*2+1,256/i.height*2+1],m=n?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;m.clear();let g=null;d&&(g=n?e.text.globeExtVertexArray:e.icon.globeExtVertexArray);const _=e.lineVertexArray,y=n?e.text.placedSymbolArray:e.icon.placedSymbolArray,v=i.transform.width/i.transform.height;let x,w=!1;for(let n=0;n<y.length;n++){const d=y.get(n),{numGlyphs:b,writingMode:B}=d;if(B!==t.aE.vertical||w||x===t.aE.horizontal||(w=!0),x=B,(d.hidden||B===t.aE.vertical)&&!w){cr(b,m);continue}w=!1;const C=new t.P(d.tileAnchorX,d.tileAnchorY);let{x:E,y:T,z:I}=h.projection.projectTilePoint(C.x,C.y,u.canonical);if(c){const[t,e,r]=c(C);E+=t,T+=e,I+=r}const S=[E,T,I,1];if(t.aA.transformMat4(S,S,r),!er(S,f)){cr(b,m);continue}const M=S[3],F=tr(i.transform.getCameraToCenterDistance(h.projection),M),P=t.aF(A,p,d),L=s?P/F:P*F,D=Je(E,T,I,o);if(D[3]<=0){cr(b,m);continue}let U={};const k=s?null:c,z=or(d,L,!1,l,r,o,a,e.glyphOffsetArray,_,m,g,D,C,U,v,k,h.projection,u,s);w=z.useVertical,k&&z.needsFlipping&&(U={}),(z.notEnoughRoom||w||z.needsFlipping&&or(d,L,!0,l,r,o,a,e.glyphOffsetArray,_,m,g,D,C,U,v,k,h.projection,u,s).notEnoughRoom)&&cr(b,m)}n?(e.text.dynamicLayoutVertexBuffer.updateData(m),g&&e.text.globeExtVertexBuffer&&e.text.globeExtVertexBuffer.updateData(g)):(e.icon.dynamicLayoutVertexBuffer.updateData(m),g&&e.icon.globeExtVertexBuffer&&e.icon.globeExtVertexBuffer.updateData(g))}function ir(t,e,r,i,n,o,a,s,l,c,u,h,A,p,d,f){const{lineStartIndex:m,glyphStartIndex:g,segment:_}=s,y=g+s.numGlyphs,v=m+s.lineLength,x=e.getoffsetX(g),w=e.getoffsetX(y-1),b=lr(t*x,r,i,n,o,a,_,m,v,l,c,u,h,A,!0,p,d,f);if(!b)return null;const B=lr(t*w,r,i,n,o,a,_,m,v,l,c,u,h,A,!0,p,d,f);return B?{first:b,last:B}:null}function nr(e,r,i,n){return e===t.aE.horizontal&&Math.abs(n)>Math.abs(i)?{useVertical:!0}:e===t.aE.vertical?n>0?{needsFlipping:!0}:null:r!==Ze.unknown&&function(t,e){return 0===t||Math.abs(e/t)>We}(i,n)?r===Ze.flipRequired?{needsFlipping:!0}:null:i<0?{needsFlipping:!0}:null}function or(e,r,i,n,o,a,s,l,c,u,h,A,p,d,f,m,g,_,y){const v=r/24,x=e.lineOffsetX*v,w=e.lineOffsetY*v,{lineStartIndex:b,glyphStartIndex:B,numGlyphs:C,segment:E,writingMode:T,flipState:I}=e,S=b+e.lineLength,M=e=>{if(h){const[r,i,n]=e.up,o=u.length;t.aG(h,o+0,r,i,n),t.aG(h,o+1,r,i,n),t.aG(h,o+2,r,i,n),t.aG(h,o+3,r,i,n)}const[r,i,n]=e.point;t.aH(u,r,i,n,e.angle)};if(C>1){const t=ir(v,l,x,w,i,A,p,e,c,a,d,m,!1,g,_,y);if(!t)return{notEnoughRoom:!0};if(n&&!i){let[r,i,n]=t.first.point,[o,a,l]=t.last.point;[r,i]=Je(r,i,n,s),[o,a]=Je(o,a,l,s);const c=nr(T,I,(o-r)*f,a-i);if(e.flipState=c&&c.needsFlipping?Ze.flipRequired:Ze.flipNotRequired,c)return c}M(t.first);for(let t=B+1;t<B+C-1;t++){const e=lr(v*l.getoffsetX(t),x,w,i,A,p,E,b,S,c,a,d,m,!1,!1,g,_,y);if(!e)return u.length-=4*(t-B),{notEnoughRoom:!0};M(e)}M(t.last)}else{if(n&&!i){const r=Je(p.x,p.y,0,o),i=b+E+1,n=new t.P(c.getx(i),c.gety(i)),a=Je(n.x,n.y,0,o),s=a[3]>0?a:sr(p,n,r,1,o,void 0,g,_.canonical),l=nr(T,I,(s[0]-r[0])*f,s[1]-r[1]);if(e.flipState=l&&l.needsFlipping?Ze.flipRequired:Ze.flipNotRequired,l)return l}const r=lr(v*l.getoffsetX(B),x,w,i,A,p,E,b,S,c,a,d,m,!1,!1,g,_,y);if(!r)return{notEnoughRoom:!0};M(r)}return{}}function ar(t,e,r,i,n){const{x:o,y:a,z:s}=i.projectTilePoint(t.x,t.y,e);if(!n)return Je(o,a,s,r);const[l,c,u]=n(t);return Je(o+l,a+c,s+u,r)}function sr(e,r,i,n,o,a,s,l){const c=ar(e.sub(r)._unit()._add(e),l,o,s,a);return t._.sub(c,i,c),t._.normalize(c,c),t._.scaleAndAdd(c,i,c,n)}function lr(e,r,i,n,o,a,s,l,c,u,h,A,p,d,f,m,g,_){const y=n?e-r:e+r;let v=y>0?1:-1,x=0;n&&(v*=-1,x=Math.PI),v<0&&(x+=Math.PI);let w=l+s+(v>0?0:1)|0,b=o,B=o,C=0,E=0;const T=Math.abs(y),I=[],S=[];let M=a,F=M;const P=()=>sr(F,M,B,T-C+1,h,p,m,g.canonical);for(;C+E<=T;){if(w+=v,w<l||w>=c)return null;if(B=b,F=M,I.push(B),d&&S.push(F),M=new t.P(u.getx(w),u.gety(w)),b=A[w],!b){const t=ar(M,g.canonical,h,m,p);b=t[3]>0?A[w]=t:P()}C+=E,E=t._.distance(B,b)}f&&p&&(A[w]&&(b=P(),E=t._.distance(B,b)),A[w]=b);const L=(T-C)/E,D=M.sub(F)._mult(L)._add(F),U=t._.sub([],b,B),k=t._.scaleAndAdd([],B,U,L);let z=[0,0,1],R=U[0],O=U[1];if(_&&(z=m.upVector(g.canonical,D.x,D.y),0!==z[0]||0!==z[1]||1!==z[2])){const e=[z[2],0,-z[0]],r=t._.cross([],z,e);t._.normalize(e,e),t._.normalize(r,r),R=t._.dot(U,e),O=t._.dot(U,r)}if(i){const e=t._.cross([],z,U);t._.normalize(e,e),t._.scaleAndAdd(k,k,e,i*v)}const Q=x+Math.atan2(O,R);return I.push(k),d&&S.push(D),{point:k,angle:Q,path:I,tilePath:S,up:z}}function cr(t,e){const r=e.length,i=r+4*t;e.resize(i),e.float32.fill(-1/0,4*r,4*i)}function ur(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[4]*n+r[12],t[1]=r[1]*i+r[5]*n+r[13],t[3]=r[3]*i+r[7]*n+r[15],t}const hr=(t,e,r)=>(1-r)*t+r*e,Ar=t=>t*t*t*t*t;class pr{constructor(e,r,i,n,o,a,s){this.tileSize=512,this._renderWorldCopies=void 0===o||o,this._minZoom=e||0,this._maxZoom=r||22,this._minPitch=i??0,this._maxPitch=n??60,this.setProjection(a),this.setMaxBounds(s),this.width=0,this.height=0,this._center=new t.aI(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Ve,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new qe,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const t=new pr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(t,e=!1){const r=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||r)&&this._updateCameraOnTerrain(),(t||r)&&this._constrainCamera(e),this._calcMatrices()}getProjection(){return t.ah(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const i=this.projection?this.getProjection():void 0;this.projection=t.aJ(this.projectionOptions);const n=!e(i,this.getProjection());return n&&this._calcMatrices(),this.mercatorFromTransition=!1,n}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const e=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=t.aJ({name:"mercator"});const r=e!==this.projection.name;return r&&this._calcMatrices(),r}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return t.ax(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new t.P(this.width,this.height)}get bearing(){return t.au(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(e){const r=-e*Math.PI/180;this.angle!==r&&(this._unmodified=!1,this.angle=r,this._calcMatrices(),this.rotationMatrix=t.aC.create(),t.aC.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const r=t.at(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=t.ab(e),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._setZoom(e),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,e=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!e||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const r=this._elevation;e||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&r.exaggeration()&&this._centerAltitudeValidForExaggeration!==r.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*r.exaggeration(),this._centerAltitudeValidForExaggeration=r.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=r.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const e=this._elevation,r=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],i=this.horizonLineFromTop();let n=0,o=0;for(let a=0;a<r.length;a++){const s=new t.P(r[a][0]*this.width,i+r[a][1]*(this.height-i)),l=e.pointCoordinate(s);if(!l)continue;const c=1/Math.hypot(l[0]-this._camera.position[0],l[1]-this._camera.position[1]);n+=l[3]*c,o+=c}return 0===o?NaN:n/o}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const t=this._seaLevelZoom,e=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),r=this.pixelsPerMeter/this.worldSize*e,i=this._mercatorZfromZoom(t),n=this._mercatorZfromZoom(this._maxZoom),o=Math.max(i-r,n);this._setZoom(this._zoomFromMercatorZ(o))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(e){const r=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,e.toAltitude()));let i;i=e.z<this._camera.position[2]?[r.x,r.y,r.z]:[e.x,e.y,e.z];const n=t._.length(t._.sub([],this._camera.position,i));return t.at(this._zoomFromMercatorZ(n),this._minZoom,this._maxZoom)}setFreeCameraOptions(e){if(!this.height)return;if(!e.position&&!e.orientation)return;this._updateCameraState();let r=!1;if(e.orientation&&!t.av.exactEquals(e.orientation,this._camera.orientation)&&(r=this._setCameraOrientation(e.orientation)),e.position){const i=[e.position.x,e.position.y,e.position.z];t._.exactEquals(i,this._camera.position)||(this._setCameraPosition(i),r=!0)}r&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const e=this._camera.position,r=new Ke;return r.position=new t.Y(e[0],e[1],e[2]),r.orientation=this._camera.orientation,r._elevation=this.elevation,r._renderWorldCopies=this.renderWorldCopies,r}_setCameraOrientation(e){if(!t.av.length(e))return!1;t.av.normalize(e,e);const r=t._.transformQuat([],[0,0,-1],e),i=t._.transformQuat([],[0,-1,0],e);if(i[2]<0)return!1;const n=Ge(r,i);return!!n&&(this._camera.orientation=n,!0)}_setCameraPosition(e){const r=this.zoomScale(this.minZoom)*this.tileSize,i=this.zoomScale(this.maxZoom)*this.tileSize,n=this.cameraToCenterDistance;e[2]=t.at(e[2],n/i,n/r),this._camera.position=e}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,e,r){this._unmodified=!1,this._edgeInsets.interpolate(t,e,r),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)}getVisibleUnwrappedCoordinates(e){const r=[new t.aK(0,e)];if(this.renderWorldCopies){const i=this.pointCoordinate(new t.P(0,0)),n=this.pointCoordinate(new t.P(this.width,0)),o=this.pointCoordinate(new t.P(this.width,this.height)),a=this.pointCoordinate(new t.P(0,this.height)),s=Math.floor(Math.min(i.x,n.x,o.x,a.x)),l=Math.floor(Math.max(i.x,n.x,o.x,a.x)),c=1;for(let i=s-c;i<=l+c;i++)0!==i&&r.push(new t.aK(i,e))}return r}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(e,r,i){let n=[];if(0===r[0]&&0===r[1])return n;for(const i of e){const e=i.canonical,o=i.overscaledZ,a=i.wrap,s=1<<e.z,l=e.x+1<s,c=e.x>0,u=e.y+1<s,h=e.y>0,A=i.wrap-(c?0:1),p=i.wrap+(l?0:1),d=c?e.x-1:s-1,f=l?e.x+1:0;r[0]<0?(n.push(new t.aL(o,p,e.z,f,e.y)),r[1]<0&&u&&(n.push(new t.aL(o,a,e.z,e.x,e.y+1)),n.push(new t.aL(o,p,e.z,f,e.y+1))),r[1]>0&&h&&(n.push(new t.aL(o,a,e.z,e.x,e.y-1)),n.push(new t.aL(o,p,e.z,f,e.y-1)))):r[0]>0?(n.push(new t.aL(o,A,e.z,d,e.y)),r[1]<0&&u&&(n.push(new t.aL(o,a,e.z,e.x,e.y+1)),n.push(new t.aL(o,A,e.z,d,e.y+1))),r[1]>0&&h&&(n.push(new t.aL(o,a,e.z,e.x,e.y-1)),n.push(new t.aL(o,A,e.z,d,e.y-1)))):r[1]<0&&u?n.push(new t.aL(o,a,e.z,e.x,e.y+1)):h&&n.push(new t.aL(o,a,e.z,e.x,e.y-1))}if(n.length>1){n.sort(((t,e)=>t.overscaledZ-e.overscaledZ||t.wrap-e.wrap||t.canonical.z-e.canonical.z||t.canonical.x-e.canonical.x||t.canonical.y-e.canonical.y));let t=0,e=0;for(;e<n.length;)n[e].equals(n[t])?++e:n[++t]=n[e++];n.length=t+1}const o=[];for(const t of n)n.some((e=>t.isChildOf(e)))||o.push(t);return n=o.filter((t=>!e.some((e=>!!(t.overscaledZ<i&&e.isChildOf(t))||t.equals(e)||t.isChildOf(e))))),n}coveringTiles(e){let r=this.coveringZoomLevel(e);const i=r,n=this.elevation&&this.elevation.exaggeration(),o=n&&!e.isTerrainDEM,a="mercator"===this.projection.name;if(void 0!==e.minzoom&&r<e.minzoom)return[];void 0!==e.maxzoom&&r>e.maxzoom&&(r=e.maxzoom);const s=this.locationCoordinate(this.center),l=this.center.lat,c=1<<r,u=[c*s.x,c*s.y,0],h="globe"===this.projection.name,A=!h,p=t.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,A),d=h?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),f=c*t.ax(1,this.center.lat),m=this._camera.position[2]/t.ax(1,this.center.lat),g=[c*d.x,c*d.y,m*(A?1:f)],_=h||n,y=this.cameraToCenterDistance/e.tileSize*(e.roundZoom?1:.502),v=this.isLODDisabled(!0)?r:0;let x;if(this._elevation&&e.isTerrainDEM)x=1e4*this._elevation.exaggeration();else if(this._elevation){const t=this._elevation.getMinMaxForVisibleTiles();x=t?t.max:this._centerAltitude}else x=this._centerAltitude;const w=e.isTerrainDEM?-x:this._elevation?this._elevation.getMinElevationBelowMSL():0,b=this.projection.isReprojectedInTileSpace?t.aN(this):1,B=e=>{const r=1/4e4,i=new t.Y(e.x+r,e.y,e.z),n=new t.Y(e.x,e.y+r,e.z),o=e.toLngLat(),a=i.toLngLat(),s=n.toLngLat(),l=this.locationCoordinate(o),c=this.locationCoordinate(a),u=this.locationCoordinate(s),h=Math.hypot(c.x-l.x,c.y-l.y),A=Math.hypot(u.x-l.x,u.y-l.y);return Math.sqrt(h*A)*b/r},C=e=>{const r=x,i=w;return{aabb:t.aQ(this,c,0,0,0,e,i,r,this.projection),zoom:0,x:0,y:0,minZ:i,maxZ:r,wrap:e,fullyVisible:!1}},E=[];let T=[];const I=r,S=e.reparseOverscaled?i:r,M=(m-this._centerAltitude)*f,F=t=>{if(!this._elevation||!t.tileID||!a)return;const e=this._elevation.getMinMaxForTile(t.tileID),r=t.aabb;e?(r.min[2]=e.min,r.max[2]=e.max,r.center[2]=(r.min[2]+r.max[2])/2):(t.shouldSplit=L(t),t.shouldSplit||(r.min[2]=r.max[2]=r.center[2]=this._centerAltitude))},P=(t,e)=>{if(.707*e<t)return 1;const r=e/t;return r/(1.4144271570014144+(Math.pow(1.1,r-1.4144271570014144+1)-1)/(1.1-1)-1)},L=e=>{if(e.zoom<v)return!0;if(e.zoom===I)return!1;if(null!=e.shouldSplit)return e.shouldSplit;const r=e.aabb.distanceX(g),n=e.aabb.distanceY(g);let s=M,c=1;if(h){s=e.aabb.distanceZ(g);const r=Math.pow(2,e.zoom),i=t.ay((e.y+1)/r),n=t.ay(e.y/r),o=Math.min(Math.max(l,i),n),a=t.b4(o)/t.b4(l);if(c=o===l?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,a/this._mercatorScaleRatio),this.zoom<=t.b1&&e.zoom===I-1&&a>=.9)return!0}else if(o&&(s=e.aabb.distanceZ(g)*f),this.projection.isReprojectedInTileSpace&&i<=5){const r=Math.pow(2,e.zoom),i=B(new t.Y((e.x+.5)/r,(e.y+.5)/r));c=i>.85?1:i}if(!a){const t=Math.sqrt(r*r+n*n+s*s);let i=(1<<I-e.zoom)*y*c;return i*=P(Math.max(s,M),t),t<i}let A=Number.MAX_VALUE,p=0;const d=e.aabb.getCorners(),m=[];for(const e of d){t._.sub(m,e,g),h||(o?m[2]*=f:m[2]=M);const r=t._.dot(m,this._camera.forward());r<A&&(A=r,p=Math.abs(m[2]))}let _=(1<<I-e.zoom)*y*c;if(_*=P(Math.max(p,M),A),A<_)return!0;const x=e.aabb.closestPoint(u);return x[0]===u[0]&&x[1]===u[1]};if(this.renderWorldCopies)for(let t=1;t<=3;t++)E.push(C(-t)),E.push(C(t));for(E.push(C(0));E.length>0;){const i=E.pop(),n=i.x,s=i.y;let l=i.fullyVisible;const A=()=>"globe"===this.projection.name&&(0===i.y||i.y===(1<<i.zoom)-1);if(!l){let e=_?i.aabb.intersects(p):i.aabb.intersectsFlat(p);if(0===e&&A()){const r=new t.aO(i.zoom,n,s);e=t.aP(this,c,r,!0).intersects(p)}if(0===e)continue;l=2===e}if(i.zoom!==I&&L(i))for(let e=0;e<4;e++){const r=(n<<1)+e%2,u=(s<<1)+(e>>1),A={aabb:a?i.aabb.quadrant(e):t.aQ(this,c,i.zoom+1,r,u,i.wrap,i.minZ,i.maxZ,this.projection),zoom:i.zoom+1,x:r,y:u,wrap:i.wrap,fullyVisible:l,tileID:void 0,shouldSplit:void 0,minZ:i.minZ,maxZ:i.maxZ};o&&!h&&(A.tileID=new t.aL(i.zoom+1===I?S:i.zoom+1,i.wrap,i.zoom+1,r,u),F(A)),E.push(A)}else{const o=i.zoom===I?S:i.zoom;if(e.minzoom&&e.minzoom>o)continue;if(!l){let e=_?i.aabb.intersectsPrecise(p):i.aabb.intersectsPreciseFlat(p);if(0===e&&A()){const r=new t.aO(i.zoom,n,s);e=t.aP(this,c,r,!0).intersectsPrecise(p)}if(0===e)continue}const a=u[0]-(.5+n+(i.wrap<<i.zoom))*(1<<r-i.zoom),h=u[1]-.5-s,d=i.tileID?i.tileID:new t.aL(o,i.wrap,i.zoom,n,s);T.push({tileID:d,distanceSq:a*a+h*h})}}if(this.fogCullDistSq){const r=this.fogCullDistSq,i=this.horizonLineFromTop();T=T.filter((n=>{const o=[0,0,0,1],a=[t.a3,t.a3,0,1],s=this.calculateFogTileMatrix(n.tileID.toUnwrapped());t.aA.transformMat4(o,o,s),t.aA.transformMat4(a,a,s);const l=t.aA.min([],o,a),c=t.aA.max([],o,a),u=t.aR(l,c);if(0===u)return!0;let h=!1;const A=this._elevation;if(A&&u>r&&0!==i){const r=this.calculateProjMatrix(n.tileID.toUnwrapped());let o;e.isTerrainDEM||(o=A.getMinMaxForTile(n.tileID)),o||(o={min:w,max:x});const a=t.b2(this.rotation),s=[a[0]*t.a3,a[1]*t.a3,o.max];t._.transformMat4(s,s,r),h=(1-s[1])*this.height*.5<i}return u<r||h}))}return T.sort(((t,e)=>t.distanceSq-e.distanceSq)).map((t=>t.tileID))}resize(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(e){const r=t.at(e.lat,-t.aS,t.aS),i=this.projection.project(e.lng,r);return new t.P(i.x*this.worldSize,i.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/t.ax(1,this.center.lat)/this.worldSize}setLocationAtPoint(e,r){let i,n;const o=this.centerPoint;if("globe"===this.projection.name){const t=this.worldSize;i=(r.x-o.x)/t,n=(r.y-o.y)/t}else{const t=this.pointCoordinate(r),e=this.pointCoordinate(o);i=t.x-e.x,n=t.y-e.y}const a=this.locationCoordinate(e);this.setLocation(new t.Y(a.x-i,a.y-n))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(e,r){const i=r?t.ax(r,e.lat):void 0,n=this.projection.project(e.lng,e.lat);return new t.Y(n.x,n.y,i)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(e,r){const i=null!=r?r:this._centerAltitude,n=[e.x,e.y,0,1],o=[e.x,e.y,1,1];t.aA.transformMat4(n,n,this.pixelMatrixInverse),t.aA.transformMat4(o,o,this.pixelMatrixInverse);const a=o[3];t.aA.scale(n,n,1/n[3]),t.aA.scale(o,o,1/a);const s=n[2],l=o[2];return{p0:n,p1:o,t:s===l?0:(i-s)/(l-s)}}screenPointToMercatorRay(e){const r=[e.x,e.y,0,1],i=[e.x,e.y,1,1];return t.aA.transformMat4(r,r,this.pixelMatrixInverse),t.aA.transformMat4(i,i,this.pixelMatrixInverse),t.aA.scale(r,r,1/r[3]),t.aA.scale(i,i,1/i[3]),r[2]=t.ax(r[2],this._center.lat)*this.worldSize,i[2]=t.ax(i[2],this._center.lat)*this.worldSize,t.aA.scale(r,r,1/this.worldSize),t.aA.scale(i,i,1/this.worldSize),new t.aT([r[0],r[1],r[2]],t._.normalize([],t._.sub([],i,r)))}rayIntersectionCoordinate(e){const{p0:r,p1:i,t:n}=e,o=t.ax(r[2],this._center.lat),a=t.ax(i[2],this._center.lat);return new t.Y(t.a2(r[0],i[0],n)/this.worldSize,t.a2(r[1],i[1],n)/this.worldSize,t.a2(o,a,n))}pointCoordinate(t,e=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,e)}pointCoordinate3D(e){if(!this.elevation)return this.pointCoordinate(e);let r=this.projection.pointCoordinate3D(this,e.x,e.y);if(r)return new t.Y(r[0],r[1],r[2]);let i=0,n=this.horizonLineFromTop();if(e.y>n)return this.pointCoordinate(e);const o=.02*n,a=e.clone();for(let e=0;e<10&&n-i>o;e++){a.y=t.a2(i,n,.66);const e=this.projection.pointCoordinate3D(this,a.x,a.y);e?(n=a.y,r=e):i=a.y}return r?new t.Y(r[0],r[1],r[2]):this.pointCoordinate(e)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(e){if(e.y<0||e.y>this.height||e.x<0||e.x>this.width)return!1;if(this.elevation||this.zoom>=t.aU)return!this.isPointAboveHorizon(e);const r=this.pointCoordinate(e);return r.y>=0&&r.y<=1}_coordinatePoint(e,r){const i=r&&this.elevation?this.elevation.getAtPointOrZero(e,this._centerAltitude):this._centerAltitude,n=[e.x*this.worldSize,e.y*this.worldSize,i+e.toAltitude(),1];return t.aA.transformMat4(n,n,this.pixelMatrix),n[3]>0?new t.P(n[0]/n[3],n[1]/n[3]):new t.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:e,left:r}=this._edgeInsets,i=this.height-this._edgeInsets.bottom,n=this.width-this._edgeInsets.right,o=this.pointLocation3D(new t.P(r,e)),a=this.pointLocation3D(new t.P(n,e)),s=this.pointLocation3D(new t.P(n,i)),l=this.pointLocation3D(new t.P(r,i));let c=Math.min(o.lng,a.lng,s.lng,l.lng),u=Math.max(o.lng,a.lng,s.lng,l.lng),h=Math.min(o.lat,a.lat,s.lat,l.lat),A=Math.max(o.lat,a.lat,s.lat,l.lat);const p=Math.pow(2,-this.zoom)/16*270,d="globe"===this.projection.name?1:4,f=(e,r,i,n,o)=>{const a=(e+i)/2,s=(r+n)/2,l=new t.P(a,s),{lng:m,lat:g}=this.pointLocation3D(l),_=Math.max(0,c-m,h-g,m-u,g-A);c=Math.min(c,m),u=Math.max(u,m),h=Math.min(h,g),A=Math.max(A,g),(o<d||_>p)&&(f(e,r,a,s,o+1),f(a,s,i,n,o+1))};if(f(r,e,n,e,1),f(n,e,n,i,1),f(n,i,r,i,1),f(r,i,r,e,1),"globe"===this.projection.name){const[e,r]=t.aV(this);e?(A=90,u=180,c=-180):r&&(h=-90,u=180,c=-180)}return new t.ai(new t.aI(c,h),new t.aI(u,A))}_getBoundsRectangular(e,r){const{top:i,left:n}=this._edgeInsets,o=this.height-this._edgeInsets.bottom,a=this.width-this._edgeInsets.right,s=new t.P(n,i),l=new t.P(a,i),c=new t.P(a,o),u=new t.P(n,o);let h=this.pointCoordinate(s,e),A=this.pointCoordinate(l,e);const p=this.pointCoordinate(c,r),d=this.pointCoordinate(u,r),f=(t,e)=>(e.y-t.y)/(e.x-t.x);return h.y>1&&A.y>=0?h=new t.Y((1-d.y)/f(d,h)+d.x,1):h.y<0&&A.y<=1&&(h=new t.Y(-d.y/f(d,h)+d.x,0)),A.y>1&&h.y>=0?A=new t.Y((1-p.y)/f(p,A)+p.x,1):A.y<0&&h.y<=1&&(A=new t.Y(-p.y/f(p,A)+p.x,0)),(new t.ai).extend(this.coordinateLocation(h)).extend(this.coordinateLocation(A)).extend(this.coordinateLocation(d)).extend(this.coordinateLocation(p))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const e=t.visibleDemTiles.reduce(((t,e)=>{if(e.dem){const r=e.dem.tree;t.min=Math.min(t.min,r.minimums[0]),t.max=Math.max(t.max,r.maximums[0])}return t}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(e.min*t.exaggeration(),e.max*t.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const e=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,r=this.height/2-e*(1-this._horizonShift);return t?Math.max(0,r):r}getMaxBounds(){return this.maxBounds}setMaxBounds(e){this.maxBounds=e,this.minLat=-t.aS,this.maxLat=t.aS,this.minLng=-180,this.maxLng=180,e&&(this.minLat=e.getSouth(),this.maxLat=e.getNorth(),this.minLng=e.getWest(),this.maxLng=e.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=t.aj(this.minLng)*this.tileSize,this.worldMaxX=t.aj(this.maxLng)*this.tileSize,this.worldMinY=t.ak(this.maxLat)*this.tileSize,this.worldMaxY=t.ak(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,e){return this.projection.createTileMatrix(this,e,t)}calculateDistanceTileData(e){const r=e.key,i=this._distanceTileDataCache;if(i[r])return i[r];const n=e.canonical,o=1/this.height,a=this.cameraWorldSize,s=a/this.zoomScale(n.z),l=(n.x+Math.pow(2,n.z)*e.wrap)*s,c=n.y*s,u=this.point;u.x*=a/this.worldSize,u.y*=a/this.worldSize;const h=this.angle,A=Math.sin(-h),p=-Math.cos(-h);return i[r]={bearing:[A,p],center:[(u.x-l)*o,(u.y-c)*o],scale:s/t.a3*o},i[r]}calculateFogTileMatrix(e){const r=e.key,i=this._fogTileMatrixCache;if(i[r])return i[r];const n=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,e);return t.ad.multiply(n,this.worldToFogMatrix,n),i[r]=new Float32Array(n),i[r]}calculateProjMatrix(e,r=!1,i=!1){const n=e.key;let o;if(o=i?this._expandedProjMatrixCache:r?this._alignedProjMatrixCache:this._projMatrixCache,o[n])return o[n];const a=this.calculatePosMatrix(e,this.worldSize);let s;return s=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:i?this.expandedFarZProjMatrix:r?this.alignedProjMatrix:this.projMatrix,t.ad.multiply(a,s,a),o[n]=new Float32Array(a),o[n]}calculatePixelsToTileUnitsMatrix(e){const r=e.tileID.key,i=this._pixelsToTileUnitsCache;if(i[r])return i[r];const n=t.aW(e,this);return i[r]=n,i[r]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const e=1/this.worldSize,r=t.ad.fromScaling([],[e,e,e]);return t.ad.multiply(r,r,this.globeMatrix),r}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const e=this._elevation;this._updateCameraState();const r=t.ax(1,this._center.lat)*this.worldSize,i=this._computeCameraPosition(r),n=this._camera.forward(),o=t.ax(1,this._center.lat);i[2]/=o,n[2]/=o,t._.normalize(n,n);const a=e.raycast(i,n,e.exaggeration());if(a){const e=t._.scaleAndAdd([],i,n,a),r=new t.Y(e[0],e[1],t.ax(e[2],t.ay(e[1]))),s=(r.z+t._.length([r.x-i[0],r.y-i[1],r.z-i[2]*o]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(s),this._centerAltitude=r.toAltitude(),this._center=this.coordinateLocation(r),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(e=!1){if(!this._elevation)return;const r=this._elevation,i=t.ax(1,this._center.lat)*this.worldSize,n=this._computeCameraPosition(i),o=r.getAtPointOrZero(new t.Y(...n)),a=this.pixelsPerMeter/this.worldSize*o,s=this._minimumHeightOverTerrain(),l=n[2]-a;if(l<=s)if(l<0||e){const e=this.locationCoordinate(this._center,this._centerAltitude),r=[n[0],n[1],e.z-n[2]],i=t._.length(r);r[2]-=(s-l)/this._pixelsPerMercatorPixel;const o=t._.length(r);if(0===o)return;t._.scale(r,r,i/o*this._pixelsPerMercatorPixel),this._camera.position=[n[0],n[1],e.z*this._pixelsPerMercatorPixel-r[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||e){const r=this.center;return r.lat=t.at(r.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!e)&&(r.lng=t.at(r.lng,this.minLng,this.maxLng)),this.center=r,void(this._constraining=!1)}const r=this._unmodified,{x:i,y:n}=this.point;let o=0,a=i,s=n;const l=this.width/2,c=this.height/2,u=this.worldMinY*this.scale,h=this.worldMaxY*this.scale;if(n-c<u&&(s=u+c),n+c>h&&(s=h-c),h-u<this.height&&(o=Math.max(o,this.height/(h-u)),s=(h+u)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const t=this.worldMinX*this.scale,e=this.worldMaxX*this.scale,r=this.worldSize/2-(t+e)/2;a=(i+r+this.worldSize)%this.worldSize-r,a-l<t&&(a=t+l),a+l>e&&(a=e-l),e-t<this.width&&(o=Math.max(o,this.width/(e-t)),a=(e+t)/2)}a===i&&s===n||(this.center=this.unproject(new t.P(a,s))),o&&(this.zoom+=this.scaleZoom(o)),this._constrainCamera(),this._unmodified=r,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,r="globe"===this.projection.name,i=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=t.ax(1,this.center.lat)/t.ax(1,t.b3));const n=t.aX(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,n),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const o="meters"===this.projection.zAxisUnit?i:1,a=this._camera.getWorldToCamera(this.worldSize,o);let s;const l=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(l[8]=2*-e.x/this.width,l[9]=2*e.y/this.height,this.isOrthographic){let t=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),r=t*this.aspect,i=-r,n=-t;r-=e.x,i-=e.x,t+=e.y,n+=e.y,s=this._camera.getCameraToClipOrthographic(i,r,n,t,this._nearZ,this._farZ),((t,e,r,i)=>{for(let n=0;n<16;n++)t[n]=hr(e[n],r[n],i)})(s,s,l,Ar(this.pitch>=15?1:this.pitch/15))}else s=l;const c=t.ad.mul([],l,a);let u=t.ad.mul([],s,a);if(this.projection.isReprojectedInTileSpace){const e=this.locationCoordinate(this.center),r=t.ad.identity([]);t.ad.translate(r,r,[e.x*this.worldSize,e.y*this.worldSize,0]),t.ad.multiply(r,r,t.aY(this)),t.ad.translate(r,r,[-e.x*this.worldSize,-e.y*this.worldSize,0]),t.ad.multiply(u,u,r),t.ad.multiply(c,c,r),this.inverseAdjustmentMatrix=t.aZ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=t.ad.scale([],u,[this.worldSize,this.worldSize,this.worldSize/o,1]),this.projMatrix=u,this.invProjMatrix=t.ad.invert(new Float64Array(16),this.projMatrix),r){const r=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);r[8]=2*-e.x/this.width,r[9]=2*e.y/this.height,this.expandedFarZProjMatrix=t.ad.mul([],r,a)}else this.expandedFarZProjMatrix=this.projMatrix;const h=t.ad.invert([],s);this.frustumCorners=t.a_.fromInvProjectionMatrix(h,this.horizonLineFromTop(),this.height),this.cameraFrustum=t.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!r);const A=new Float32Array(16);t.ad.identity(A),t.ad.scale(A,A,[1,-1,1]),t.ad.rotateX(A,A,this._pitch),t.ad.rotateZ(A,A,this.angle);const p=t.ad.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=t.ad.clone(p);const d=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;p[8]=2*-e.x/this.width,p[9]=2*(e.y+d)/this.height,this.skyboxMatrix=t.ad.multiply(A,p,A);const f=this.point,m=f.x,g=f.y,_=this.width%2/2,y=this.height%2/2,v=Math.cos(this.angle),x=Math.sin(this.angle),w=m-Math.round(m)+v*_+x*y,b=g-Math.round(g)+v*y+x*_,B=new Float64Array(u);if(t.ad.translate(B,B,[w>.5?w-1:w,b>.5?b-1:b,0]),this.alignedProjMatrix=B,u=t.ad.create(),t.ad.scale(u,u,[this.width/2,-this.height/2,1]),t.ad.translate(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=t.ad.create(),t.ad.scale(u,u,[1,-1,1]),t.ad.translate(u,u,[-1,-1,0]),t.ad.scale(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u,this.pixelMatrix=t.ad.multiply(new Float64Array(16),this.labelPlaneMatrix,c),this._calcFogMatrices(),this._distanceTileDataCache={},u=t.ad.invert(new Float64Array(16),this.pixelMatrix),!u)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=u,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=t.a$(this);const e=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=t._.transformMat4(e,e,a),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=u;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const e=this.cameraWorldSizeForFog,r=this.cameraPixelsPerMeter,i=this._camera.position,n=1/this.height/this._pixelsPerMercatorPixel,o=[e,e,r];t._.scale(o,o,n),t._.scale(i,i,-1),t._.multiply(i,i,o);const a=t.ad.create();t.ad.translate(a,a,i),t.ad.scale(a,a,o),this.mercatorFogMatrix=a,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(e,r,n)}_computeCameraPosition(t){const e=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,r=this._camera.forward(),i=this.point,n=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*e-t/this.worldSize*this._centerAltitude;return[i.x/this.worldSize-r[0]*n,i.y/this.worldSize-r[1]*n,t/this.worldSize*this._centerAltitude-r[2]*n]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(e){const r=this._maxCameraBoundsDistance()*Math.cos(this._pitch),i=this._camera.position[2],n=e[2];let o=1;this.projection.wrap&&(this.center=this.center.wrap()),n>0&&(o=Math.min((r-i)/n,1)),this._camera.position=t._.scaleAndAdd([],this._camera.position,e,o),this._updateStateFromCamera()}_updateStateFromCamera(){const e=this._camera.position,r=this._camera.forward(),{pitch:i,bearing:n}=this._camera.getPitchBearing(),o=t.ax(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,a=this._mercatorZfromZoom(this._maxZoom)*Math.cos(t.ab(this._maxPitch)),s=Math.max((e[2]-o)/Math.cos(i),a),l=this._zoomFromMercatorZ(s);t._.scaleAndAdd(e,e,r,s),this._pitch=t.at(i,t.ab(this.minPitch),t.ab(this.maxPitch)),this.angle=t.au(n,-Math.PI,Math.PI),this._setZoom(t.at(l,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new t.Y(e[0],e[1],e[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(e){let r=0,i=t.aU,n=0,o=1/0;for(;i-r>1e-6&&i>r;){const t=r+.5*(i-r),a=this.tileSize*Math.pow(2,t),s=this.getCameraToCenterDistance(this.projection,t,a),l=this.scaleZoom(s/(e*this.tileSize)),c=Math.abs(t-l);c<o&&(o=c,n=t),t<l?r=t:i=t}return n}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(t.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(e,r){const i=Math.min(e.x,r.x),n=Math.max(e.x,r.x),o=Math.min(e.y,r.y),a=Math.max(e.y,r.y);if(o<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const s=[new t.P(i,o),new t.P(n,a),new t.P(i,a),new t.P(n,o)],l=this.renderWorldCopies?-3:0,c=this.renderWorldCopies?4:1;for(const t of s){const e=this.pointRayIntersection(t);if(e.t<0)return!0;const r=this.rayIntersectionCoordinate(e);if(r.x<l||r.y<0||r.x>c||r.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+t.b0(this.fovAboveCenter)>88||this.anyCornerOffEdge(new t.P(0,0),new t.P(this.width,this.height))}zoomDeltaToMovement(e,r){const i=t._.length(t._.sub([],this._camera.position,e)),n=this._zoomFromMercatorZ(i)+r;return i-this._mercatorZfromZoom(n)}getCameraPoint(){if("globe"===this.projection.name){const e=function([e,r,i],n){const o=[e,r,i,1];t.aA.transformMat4(o,o,n);const a=o[3]=Math.max(o[3],1e-6);return o[0]/=a,o[1]/=a,o[2]/=a,o}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new t.P(e[0],e[1])}{const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.P(0,e))}}getCameraToCenterDistance(e,r=this.zoom,i=this.worldSize){const n=t.aX(e,r,this.width,this.height,1024),o=e.pixelSpaceConversion(this.center.lat,i,n);let a=.5/Math.tan(.5*this._fov)*this.height*o;return this.isOrthographic&&(a=hr(1,a,Ar(this.pitch>=15?1:this.pitch/15))),a}getWorldToCameraMatrix(){const e=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&t.ad.multiply(e,e,this.globeMatrix),e}getFrustum(e){return t.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,e,"meters"===this.projection.zAxisUnit)}}const dr={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11},fr=(e,r)=>{if(r>0&&e.terrain&&t.w("Cutoff is currently disabled on terrain"),r<=0||e.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const i=e.transform,n=Math.max(Math.abs(i._zoom-(e.minCutoffZoom-1)),1),o=i.isLODDisabled(!1)?t.$(60,45,i.pitch):t.$(30,15,i.pitch),a=i._farZ-i._nearZ,s=r*i.height,l=((1-(c=o))*i.cameraToCenterDistance+c*(i._farZ+s))*n;var c;return{shouldRenderCutoff:o<1,uniformValues:{u_cutoff_params:[i._nearZ,i._farZ,(l-i._nearZ)/a,(l-s-i._nearZ)/a]}}},mr={cascadeCount:2,shadowMapResolution:2048};class gr{constructor(t,e){this.aabb=t,this.lastCascade=e}}class _r{add(t,e){const r=this.receivers[t.key];void 0!==r?(r.aabb.min[0]=Math.min(r.aabb.min[0],e.min[0]),r.aabb.min[1]=Math.min(r.aabb.min[1],e.min[1]),r.aabb.min[2]=Math.min(r.aabb.min[2],e.min[2]),r.aabb.max[0]=Math.max(r.aabb.max[0],e.max[0]),r.aabb.max[1]=Math.max(r.aabb.max[1],e.max[1]),r.aabb.max[2]=Math.max(r.aabb.max[2],e.max[2])):this.receivers[t.key]=new gr(e,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(e,r,i){const n=t.b6.fromPoints(e.points);let o=0;for(const e in this.receivers){const a=this.receivers[e];if(!a)continue;if(!n.intersectsAabb(a.aabb))continue;a.aabb.min=n.closestPoint(a.aabb.min),a.aabb.max=n.closestPoint(a.aabb.max);const s=a.aabb.getCorners();for(let e=0;e<i.length;e++){let n=!0;for(const o of s){const a=[o[0]*r,o[1]*r,o[2]];if(t._.transformMat4(a,a,i[e].matrix),a[0]<-1||a[0]>1||a[1]<-1||a[1]>1){n=!1;break}}if(a.lastCascade=e,o=Math.max(o,e),n)break}}return o+1}}class yr{constructor(e){this.painter=e,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new _r,this._depthMode=new t.ae(e.context.gl.LEQUAL,t.ae.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,e.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},(()=>{this.painter.style.map.triggerRepaint()})),e.tp.registerParameter(mr,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),e.tp.registerParameter(mr,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),e.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(e,r){const i=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!r||!r.properties)return;const n=r.properties.get("shadow-intensity");if(!r.shadowsEnabled()||n<=0)return;if(this._shadowLayerCount=i.style.order.reduce(((t,r)=>{const n=i.style._mergedLayers[r];return t+(n.hasShadowPass()&&!n.isHidden(e.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this.enabled)return;const o=i.context,a=mr.shadowMapResolution,s=mr.shadowMapResolution;if(0===this._cascades.length||mr.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let e=0;e<mr.cascadeCount;++e){const e=i._shadowMapDebug,r=o.gl,n=o.createFramebuffer(a,s,e,"texture"),l=new t.T(o,{width:a,height:s,data:null},r.DEPTH_COMPONENT);if(n.depthAttachment.set(l.texture),e){const e=new t.T(o,{width:a,height:s,data:null},r.RGBA);n.colorAttachment.set(e.texture)}this._cascades.push({framebuffer:n,texture:l,matrix:[],far:0,boundingSphereRadius:0,frustum:new t.aM,scale:0})}}this.shadowDirection=xr(r);let l=0;if(e.elevation){const t=e.elevation,r=[1e4,-1e4];t.visibleDemTiles.filter((t=>t.dem)).forEach((t=>{const e=t.dem.tree;r[0]=Math.min(r[0],e.minimums[0]),r[1]=Math.max(r[1],e.maximums[0])})),1e4!==r[0]&&(l=(r[1]-r[0])*t.exaggeration())}const c=1.5*e.cameraToCenterDistance,u=3*c,h=new Float64Array(16);for(let r=0;r<this._cascades.length;++r){const i=this._cascades[r];let n=e.height/50,o=1;1===mr.cascadeCount?o=u:0===r?o=c:(n=c,o=u);const[a,s]=br(e,this.shadowDirection,n,o,mr.shadowMapResolution,l);i.scale=e.scale,i.matrix=a,i.boundingSphereRadius=s,t.ad.invert(h,i.matrix),i.frustum=t.aM.fromInvProjectionMatrix(h,1,0,!0),i.far=o}const A=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[A].far,this._cascades[A].far],this._uniformValues.u_shadow_intensity=n,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/mr.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=mr.shadowMapResolution,this._uniformValues.u_shadowmap_0=dr.ShadowMap0,this._uniformValues.u_shadowmap_1=dr.ShadowMap0+1,this._groundShadowTiles=i.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const p=i.transform.elevation;for(const t of this._groundShadowTiles){let e={min:0,max:0};if(p){const r=p.getMinMaxForTile(t);r&&(e=r)}this.addShadowReceiver(t.toUnwrapped(),e.min,e.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(e,r){if(!this.enabled)return;const i=this.painter,n=i.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(i.transform.getFrustum(0),i.transform.worldSize,this._cascades),n.viewport.set([0,0,mr.shadowMapResolution,mr.shadowMapResolution]);for(let o=0;o<this._numCascadesToRender;++o){i.currentShadowCascade=o,n.bindFramebuffer.set(this._cascades[o].framebuffer.framebuffer),n.clear({color:t.C.white,depth:1});for(const t of e.order){const n=e._mergedLayers[t];if(!n.hasShadowPass()||n.isHidden(i.transform.zoom))continue;const o=e.getLayerSourceCache(n),a=o?r[o.id]:void 0;("model"===n.type||a&&a.length)&&i.renderLayer(i,o,n,a)}}i.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const e=this.painter,r=e.style,i=e.context,n=r.directionalLight,o=r.ambientLight;if(!n||!o)return;const a=[],s=fr(e,e.longestCutoffRange);s.shouldRenderCutoff&&a.push("RENDER_CUTOFF");const l=wr(r,n,o),c=new t.ae(i.gl.LEQUAL,t.ae.ReadOnly,e.depthRangeFor3D);for(const r of this._groundShadowTiles){const n=r.toUnwrapped(),o=e.isTileAffectedByFog(r),u=e.getOrCreateProgram("groundShadow",{defines:a,overrideFog:o});this.setupShadows(n,u),e.uploadCommonUniforms(i,u,n,null,s);const h={u_matrix:e.transform.calculateProjMatrix(n),u_ground_shadow_factor:l};u.draw(e,i.gl.TRIANGLES,c,t.ag.disabled,t.a.multiply,t.af.disabled,h,"ground_shadow",e.tileExtentBuffer,e.quadTriangleIndexBuffer,e.tileExtentSegments,{},e.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?t.a.unblended:t.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(e){const r=this.painter.transform,i=r.calculatePosMatrix(e,r.worldSize);return t.ad.multiply(i,this._cascades[this.painter.currentShadowCascade].matrix,i),Float32Array.from(i)}calculateShadowPassMatrixFromMatrix(e){return t.ad.multiply(e,this._cascades[this.painter.currentShadowCascade].matrix,e),Float32Array.from(e)}setupShadows(e,r,i,n=0){if(!this.enabled)return;const o=this.painter.transform,a=this.painter.context,s=a.gl,l=this._uniformValues,c=new Float64Array(16),u=o.calculatePosMatrix(e,o.worldSize);for(let e=0;e<this._cascades.length;e++)t.ad.multiply(c,this._cascades[e].matrix,u),l[0===e?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(c),a.activeTexture.set(s.TEXTURE0+dr.ShadowMap0+e),this._cascades[e].texture.bind(s.NEAREST,s.CLAMP_TO_EDGE);if(this.useNormalOffset=!!i,this.useNormalOffset){const r=t.b5(e.canonical),a=2/o.tileSize*t.a3/mr.shadowMapResolution,s=a*this._cascades[0].boundingSphereRadius,c=a*this._cascades[this._cascades.length-1].boundingSphereRadius,u=("vector-tile"===i?1:3)/Math.pow(2,n-e.canonical.z-(1-o.zoom+Math.floor(o.zoom)));l.u_shadow_normal_offset=[r,s*u,c*u],l.u_shadow_bias=[6e-5,.0012,.012]}else l.u_shadow_bias=[36e-5,.0012,.012];r.setShadowUniformValues(a,l)}setupShadowsFromMatrix(e,r,i=!1){if(!this.enabled)return;const n=this.painter.context,o=n.gl,a=this._uniformValues,s=new Float64Array(16);for(let r=0;r<mr.cascadeCount;r++)t.ad.multiply(s,this._cascades[r].matrix,e),a[0===r?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(s),n.activeTexture.set(o.TEXTURE0+dr.ShadowMap0+r),this._cascades[r].texture.bind(o.NEAREST,o.CLAMP_TO_EDGE);if(this.useNormalOffset=i,i){const t=5;a.u_shadow_normal_offset=[1,t,t],a.u_shadow_bias=[6e-5,.0012,.012]}else a.u_shadow_bias=[36e-5,.0012,.012];r.setShadowUniformValues(n,a)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(e,r,i,n){if(n[2]>=0)return{};const o=function(e,r,i){const n=i/(1<<e.canonical.z);return new t.b6([e.canonical.x*n+e.wrap*i,e.canonical.y*n+e.wrap*i,0],[(e.canonical.x+1)*n+e.wrap*i,(e.canonical.y+1)*n+e.wrap*i,r])}(e,r,i).getCorners(),a=r/-n[2];n[0]<0?(t._.add(o[0],o[0],[n[0]*a,0,0]),t._.add(o[3],o[3],[n[0]*a,0,0])):n[0]>0&&(t._.add(o[1],o[1],[n[0]*a,0,0]),t._.add(o[2],o[2],[n[0]*a,0,0])),n[1]<0?(t._.add(o[0],o[0],[0,n[1]*a,0]),t._.add(o[1],o[1],[0,n[1]*a,0])):n[1]>0&&(t._.add(o[2],o[2],[0,n[1]*a,0]),t._.add(o[3],o[3],[0,n[1]*a,0]));const s={};return s.vertices=o,s.planes=[vr(o[1],o[0],o[4]),vr(o[2],o[1],o[5]),vr(o[3],o[2],o[6]),vr(o[0],o[3],o[7])],s}addShadowReceiver(e,r,i){this._receivers.add(e,t.b6.fromTileIdAndHeight(e,r,i))}getMaxCascadeForTile(t){const e=this._receivers.get(t);return e&&e.lastCascade?e.lastCascade:0}}function vr(e,r,i){const n=t._.sub([],i,r),o=t._.sub([],e,r),a=t._.cross([],n,o),s=t._.length(a);return 0===s?[0,0,1,0]:(t._.scale(a,a,1/s),[a[0],a[1],a[2],-t._.dot(a,r)])}function xr(e){const r=e.properties.get("direction"),i=t.ac(r.x,r.y,r.z);i[2]=t.at(i[2],0,75);const n=t.b7([i[0],i[1],i[2]]);return t._.fromValues(n.x,n.y,n.z)}function wr(e,r,i){const n=r.properties.get("color"),o=r.properties.get("intensity"),a=r.properties.get("direction"),s=[a.x,a.y,a.z],l=i.properties.get("color"),c=i.properties.get("intensity"),u=Math.max(t._.dot([0,0,1],s),0),h=[0,0,0];t._.scale(h,l.toRenderColor(e.getLut(r.scope)).toArray01Linear().slice(0,3),c);const A=[0,0,0];return t._.scale(A,n.toRenderColor(e.getLut(i.scope)).toArray01Linear().slice(0,3),u*o),t.b8([h[0]>0?h[0]/(h[0]+A[0]):0,h[1]>0?h[1]/(h[1]+A[1]):0,h[2]>0?h[2]/(h[2]+A[2]):0])}function br(e,r,i,n,o,a){const s=e.zoom,l=e.scale,c=e.worldSize,u=1/c,h=e.aspect,A=Math.sqrt(1+h*h)*Math.tan(.5*e.fovX),p=A*A,d=n-i,f=n+i;let m,g;p>d/f?(m=n,g=n*A):(m=.5*f*(1+p),g=.5*Math.sqrt(d*d+2*(n*n+i*i)*p+f*f*p*p));const _=e.projection.pixelsPerMeter(e.center.lat,c),y=e._camera.getCameraToWorldMercator(),v=[0,0,-m*u];t._.transformMat4(v,v,y);let x=g*u;const w=e._edgeInsets;if(!(0===w.left&&0===w.top&&0===w.right&&0===w.bottom||w.left===w.right&&w.top===w.bottom)){const r=e._camera.getWorldToCamera(e.worldSize,"meters"===e.projection.zAxisUnit?_:1),o=e._camera.getCameraToClipPerspective(e._fov,e.width/e.height,i,n);o[8]=2*-e.centerOffset.x/e.width,o[9]=2*e.centerOffset.y/e.height;const a=new Float64Array(16);t.ad.mul(a,o,r);const u=new Float64Array(16);t.ad.invert(u,a);const h=t.aM.fromInvProjectionMatrix(u,c,s,!0);for(const r of h.points){const i=((b=r)[0]/=l,b[1]/=l,b[2]=t.ax(b[2],e._center.lat),b);x=Math.max(x,t._.len(t._.subtract([],v,i)))}}var b;x*=o/(o-1);const B=Math.acos(r[2]),C=Math.atan2(-r[0],-r[1]),E=new qe;E.position=v,E.setPitchBearing(B,C);const T=E.getWorldToCamera(c,_),I=x*c,S=Math.min(e._mercatorZfromZoom(17)*c*-2,-2*I),M=E.getCameraToClipOrthographic(-I,I,-I,I,S,(I+a*_)/r[2]),F=new Float64Array(16);t.ad.multiply(F,M,T);const P=t._.fromValues(Math.floor(1e6*v[0])/1e6*c,Math.floor(1e6*v[1])/1e6*c,0),L=.5*o,D=[0,0,0];t._.transformMat4(D,P,F),t._.scale(D,D,L);const U=[Math.floor(D[0]),Math.floor(D[1]),Math.floor(D[2])],k=[0,0,0];t._.sub(k,D,U),t._.scale(k,k,-1/L);const z=new Float64Array(16);return t.ad.identity(z),t.ad.translate(z,z,k),t.ad.multiply(F,z,F),[F,I]}function Br(t,e){return null!=t&&null!=e&&!(!t.hasData()||!e.hasData())&&null!=t.demTexture&&null!=e.demTexture&&t.tileID.key!==e.tileID.key}const Cr=new class{constructor(){this.operations={}}newMorphing(t,e,r,i,n){if(t in this.operations){const e=this.operations[t];e.to.tileID.key!==r.tileID.key&&(e.queued=r)}else this.operations[t]={startTime:i,phase:0,duration:n,from:e,to:r,queued:null}}getMorphValuesForProxy(t){if(!(t in this.operations))return null;const e=this.operations[t];return{from:e.from,to:e.to,phase:e.phase}}update(t){for(const e in this.operations){const r=this.operations[e];for(r.phase=(t-r.startTime)/r.duration;r.phase>=1||!this._validOp(r);)if(!this._nextOp(r,t)){delete this.operations[e];break}}}_nextOp(t,e){return!!t.queued&&(t.from=t.to,t.to=t.queued,t.queued=null,t.phase=0,t.startTime=e,!0)}_validOp(t){return t.from.hasData()&&t.to.hasData()}},Er={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Tr(t,e,r){if(0===e)return 0;const i=e<1&&514===r?.25/e:1;return 6*Math.pow(1.5,22-t)*Math.max(e,1)*i}function Ir(t,e){const r=1<<t.z;return!e&&(0===t.x||t.x===r-1)||0===t.y||t.y===r-1}const Sr=t=>({u_matrix:t});function Mr(e,r,i,n,o){if(o>0){const a=t.e.now(),s=(a-e.timeAdded)/o,l=r?(a-r.timeAdded)/o:-1,c=i.getSource(),u=n.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),h=!r||Math.abs(r.tileID.overscaledZ-u)>Math.abs(e.tileID.overscaledZ-u),A=h&&e.refreshedUponExpiration?1:t.at(h?s:1-l,0,1);return e.refreshedUponExpiration&&s>=1&&(e.refreshedUponExpiration=!1),r?{opacity:1,mix:1-A}:{opacity:A,mix:0}}return{opacity:1,mix:0}}class Fr extends Re{constructor(e,r,i,n){super(e,r,i,n),this.type="raster-array",this.maxzoom=22,this._options=t.W({type:"raster-array"},r)}triggerRepaint(t){const e=this.map.painter._terrain,r=this.map.style.getSourceCache(this.id);e&&e.enabled&&r&&e._clearRenderCacheForTile(r.id,t.tileID),this.map.triggerRepaint()}loadTile(e,r){const i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),n=this.map._requestManager.transformRequest(i,t.R.Tile);e.requestParams=n,e.actor||(e.actor=this.dispatcher.getActor()),e.request=e.fetchHeader(void 0,((t,i,n,o)=>{if(delete e.request,e.aborted)return e.state="unloaded",r(null);if(t){if(20===t.code)return;return e.state="errored",r(t)}this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:n,expires:o}),e.state="empty",r(null)}))}unloadTile(e,r){const i=e.texture;i&&i instanceof t.T?(e.destroy(!0),this.map.painter.saveTileTexture(i)):(e.destroy(),e.flushQueues(),e._isHeaderLoaded=!1,delete e._mrt,delete e.textureDescriptor),e.fbo&&(e.fbo.destroy(),delete e.fbo),delete e.request,delete e.requestParams,delete e.neighboringTiles,e.state="unloaded"}prepareTile(e,r,i){e._isHeaderLoaded&&("empty"!==e.state&&(e.state="reloading"),e.fetchBand(r,i,((r,i)=>{if(r)return e.state="errored",this.fire(new t.d(r)),void this.triggerRepaint(e);i&&(e.setTexture(i,this.map.painter),e.state="loaded",this.triggerRepaint(e))})))}getInitialBand(t){if(!this.rasterLayers)return 0;const e=this.rasterLayers.find((({id:e})=>e===t)),r=e&&e.fields,i=r&&r.bands&&r.bands;return i?i[0]:0}getTextureDescriptor(e,r,i){if(!e)return;const n=r.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!n)return;let o=null;r instanceof t.bk?o=r.paint.get("raster-array-band"):r instanceof t.bl&&(o=r.paint.get("raster-particle-array-band"));const a=o||this.getInitialBand(n);if(null!=a)if(e.textureDescriptor){if(!e.updateNeeded(n,a)||i)return Object.assign({},e.textureDescriptor,{texture:e.texture})}else this.prepareTile(e,n,a)}}const Pr={vector:Oe,raster:Re,"raster-dem":class extends Re{constructor(e,r,i,n){super(e,r,i,n),this.type="raster-dem",this.maxzoom=22,this._options=t.W({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(e,r){const i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function n(t,i){t&&(e.state="errored",r(t)),i&&(e.dem=i,e.dem.onDeserialize(),e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0,e.state="loaded",r(null))}e.request=t.h(this.map._requestManager.transformRequest(i,t.R.Tile),function(i,o,a,s){if(delete e.request,e.aborted)e.state="unloaded",r(null);else if(i)e.state="errored",r(i);else if(o){this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:a,expires:s});const r=ImageBitmap&&o instanceof ImageBitmap&&t.bi(),i=1-(o.width-t.bj(o.width))/2;i<1||e.neighboringTiles||(e.neighboringTiles=this._getNeighboringTiles(e.tileID));const l=r?o:t.e.getImageData(o,i),c={uid:e.uid,coord:e.tileID,source:this.id,scope:this.scope,rawImageData:l,encoding:this.encoding,padding:i};e.actor&&"expired"!==e.state||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",c,n.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(e){const r=e.canonical,i=Math.pow(2,r.z),n=(r.x-1+i)%i,o=0===r.x?e.wrap-1:e.wrap,a=(r.x+1+i)%i,s=r.x+1===i?e.wrap+1:e.wrap,l={};return l[new t.aL(e.overscaledZ,o,r.z,n,r.y).key]={backfilled:!1},l[new t.aL(e.overscaledZ,s,r.z,a,r.y).key]={backfilled:!1},r.y>0&&(l[new t.aL(e.overscaledZ,o,r.z,n,r.y-1).key]={backfilled:!1},l[new t.aL(e.overscaledZ,e.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},l[new t.aL(e.overscaledZ,s,r.z,a,r.y-1).key]={backfilled:!1}),r.y+1<i&&(l[new t.aL(e.overscaledZ,o,r.z,n,r.y+1).key]={backfilled:!1},l[new t.aL(e.overscaledZ,e.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},l[new t.aL(e.overscaledZ,s,r.z,a,r.y+1).key]={backfilled:!1}),l}},"raster-array":Fr,geojson:class extends t.E{constructor(e,r,i,n){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=i.getActor(),this.setEventedParent(n),this._data=r.data,this._options=t.W({},r),this._collectResourceTiming=r.collectResourceTiming,void 0!==r.maxzoom&&(this.maxzoom=r.maxzoom),void 0!==r.minzoom&&(this.minzoom=r.minzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const o=t.a3/this.tileSize;this.workerOptions=t.W({source:this.id,scope:this.scope,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(void 0!==r.buffer?r.buffer:128)*o,tolerance:(void 0!==r.tolerance?r.tolerance:.375)*o,extent:t.a3,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:void 0!==r.clusterMaxZoom?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:t.a3,radius:(void 0!==r.clusterRadius?r.clusterRadius:50)*o,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter,dynamic:r.dynamic},r.workerOptions)}onAdd(t){this.map=t,this.setData(this._data)}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(e){return this._options.dynamic?"string"!=typeof e&&("Feature"===e.type&&(e={type:"FeatureCollection",features:[e]}),"FeatureCollection"!==e.type)?this.fire(new t.d(new Error("Data to update should be a feature or a feature collection."))):(this._coalesce&&"string"!=typeof e&&"string"!=typeof this._data&&"FeatureCollection"===this._data.type?this._data.features.push(...e.features):this._data=e,this._updateWorkerData(!0),this):this.fire(new t.d(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")))}getClusterExpansionZoom(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id,scope:this.scope},e),this}getClusterChildren(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id,scope:this.scope},e),this}getClusterLeaves(t,e,r,i){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:t,limit:e,offset:r},i),this}_updateWorkerData(e=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new t.f("dataloading",{dataType:"source"})),this._loaded=!1;const r=t.W({append:e},this.workerOptions);r.scope=this.scope;const i=this._data;"string"==typeof i?(r.request=this.map._requestManager.transformRequest(t.e.resolveURL(i),t.R.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,r,((r,i)=>{if(this._loaded=!0,this._pendingLoad=null,r)this.fire(new t.d(r));else{const r={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&i&&i.resourceTiming&&i.resourceTiming[this.id]&&(r.resourceTiming=i.resourceTiming[this.id]),e&&(this._partialReload=!0),this.fire(new t.f("data",r)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(e),this._coalesce=!1)}))}loaded(){return this._loaded}loadTile(e,r){const i=e.actor?"reloadTile":"loadTile";e.actor=this.actor;const n=this.map.style?this.map.style.getLut(this.scope):null,o=this._partialReload,a={type:this.type,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:n?{image:n.image.clone()}:null,scope:this.scope,pixelRatio:t.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:o};e.request=this.actor.send(i,a,((t,n)=>o&&!n?(e.state="loaded",r(null)):(delete e.request,e.destroy(),e.aborted?r(null):t?r(t):(e.loadVectorData(n,this.map.painter,"reloadTile"===i),r(null)))),void 0,"loadTile"===i)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t,e){this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}onRemove(t){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return t.W({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends t.bm{constructor(t,e,r,i){super(t,e,r,i),this.roundZoom=!0,this.type="video",this.options=e}load(){this._loaded=!1;const e=this.options;this.urls=[];for(const r of e.urls)this.urls.push(this.map._requestManager.transformRequest(r,t.R.Source).url);t.bn(this.urls,((e,r)=>{this._loaded=!0,e?this.fire(new t.d(e)):r&&(this.video=r,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const r=this.video.seekable;e<r.start(0)||e>r.end(0)?this.fire(new t.d(new t.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const e=this.map.painter.context,r=e.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new t.T(e,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(e)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:t.bm,model:class extends t.E{constructor(t,e,r,i){super(),this.id=t,this.type="model",this.models=[],this._loaded=!1,this._options=e}load(){const e=[];for(const r in this._options.models){const i=this._options.models[r],n=t.l(this.map._requestManager.transformRequest(i.uri,t.R.Model).url).then((e=>{if(!e)return;const n=t.c(e),o=new t.M(r,i.position,i.orientation,n);o.computeBoundsAndApplyParent(),this.models.push(o)})).catch((e=>{this.fire(new t.d(new Error(`Could not load model ${r} from ${i.uri}: ${e.message}`)))}));e.push(n)}return Promise.allSettled(e).then((()=>{this._loaded=!0,this.fire(new t.f("data",{dataType:"source",sourceDataType:"metadata"}))})).catch((e=>{this.fire(new t.d(new Error(`Could not load models: ${e.message}`)))}))}onAdd(t){this.map=t,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(t,e){}serialize(){return{type:"model"}}},"batched-model":class extends t.E{constructor(t,e,r,i){super(),this.type="batched-model",this.id=t,this.tileSize=512,this._options=e,this.tiles=this._options.tiles,this.maxzoom=e.maxzoom||19,this.minzoom=e.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=r,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(i)}onAdd(t){this.map=t,this.load()}load(e){this._loaded=!1,this.fire(new t.f("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,i=this.map._worldview;this._tileJSONRequest=ke(this._options,this.map._requestManager,r,i,((n,o)=>{this._tileJSONRequest=null,this._loaded=!0,n?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),i&&2!==i.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${i}`),this.fire(new t.d(n))):o&&(t.W(this,o),o.bounds&&(this.tileBounds=new ze(o.bounds,this.minzoom,this.maxzoom)),t.an(o.tiles,this.map._requestManager._customAccessToken),this.fire(new t.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.f("data",{dataType:"source",sourceDataType:"content"}))),e&&e(n)}))}hasTransition(){return!1}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loaded(){return this._loaded}loadTile(e,r){const i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),n={request:this.map._requestManager.transformRequest(i,t.R.Tile),data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:e.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(e.actor&&"expired"!==e.state)if("loading"===e.state)e.reloadCallback=r;else{if(e.buckets){const t=Object.values(e.buckets);for(const e of t)e.dirty=!0;return void(e.state="loaded")}e.request=e.actor.send("reloadTile",n,o.bind(this))}else e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",n,o.bind(this),void 0,!0);function o(t,i){return e.aborted?r(null):t&&404!==t.status?r(t):(i&&(i.resourceTiming&&(e.resourceTiming=i.resourceTiming),this.map._refreshExpiredTiles&&e.setExpiryData(i),e.buckets={...e.buckets,...i.buckets},i.featureIndex&&(e.latestFeatureIndex=i.featureIndex)),e.state="loaded",void r(null))}}serialize(){return t.W({},this._options)}},canvas:class extends t.bm{constructor(e,r,i,n){super(e,r,i,n),r.coordinates?Array.isArray(r.coordinates)&&4===r.coordinates.length&&!r.coordinates.some((t=>!Array.isArray(t)||2!==t.length||t.some((t=>"number"!=typeof t))))||this.fire(new t.d(new t.V(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.d(new t.V(`sources.${e}`,null,'missing required property "coordinates"'))),r.animate&&"boolean"!=typeof r.animate&&this.fire(new t.d(new t.V(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),r.canvas?"string"==typeof r.canvas||r.canvas instanceof HTMLCanvasElement||this.fire(new t.d(new t.V(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.d(new t.V(`sources.${e}`,null,'missing required property "canvas"'))),this.options=r,this.animate=void 0===r.animate||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.d(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(t){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const r=this.map.painter.context;this.texture?!e&&!this._playing||this.texture instanceof t.bo||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.T(r,this.canvas,r.gl.RGBA,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}},custom:class extends t.E{constructor(e,r,i,n){super(),this.id=e,this.type="custom",this._dataType="raster",this._dispatcher=i,this._implementation=r,this.setEventedParent(n),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new t.d(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new t.d(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new ze(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),t.W(this,t.ah(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return t.ah(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new t.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.f("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(e){this.map=e,this._loaded=!1,this.fire(new t.f("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(e),this.load()}onRemove(t){this._implementation.onRemove&&this._implementation.onRemove(t)}hasTile(t){if(this._implementation.hasTile){const{x:e,y:r,z:i}=t.canonical;return this._implementation.hasTile({x:e,y:r,z:i})}return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,e){const{x:r,y:i,z:n}=t.tileID.canonical,o=new AbortController;t.request=Promise.resolve(this._implementation.loadTile({x:r,y:i,z:n},{signal:o.signal})).then(function(r){return delete t.request,t.aborted?(t.state="unloaded",e(null)):void 0===r?(t.state="errored",e(null)):null===r?(this.loadTileData(t,{width:this.tileSize,height:this.tileSize,data:null}),t.state="loaded",e(null)):function(t){return t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof ImageBitmap||t instanceof HTMLImageElement}(r)?(this.loadTileData(t,r),t.state="loaded",void e(null)):(t.state="errored",e(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch((r=>{20!==r.code&&(t.state="errored",e(r))})),t.request.cancel=()=>o.abort()}loadTileData(t,e){t.setTexture(e,this.map.painter)}unloadTile(e,r){if(e.texture&&e.texture instanceof t.T?(e.destroy(!0),e.texture&&e.texture instanceof t.T&&this.map.painter.saveTileTexture(e.texture)):e.destroy(),this._implementation.unloadTile){const{x:t,y:r,z:i}=e.tileID.canonical;this._implementation.unloadTile({x:t,y:r,z:i})}r&&r()}abortTile(t,e){t.request&&t.request.cancel&&(t.request.cancel(),delete t.request),e&&e()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((t=>({x:t.canonical.x,y:t.canonical.y,z:t.canonical.z})))}_clearTiles(){const e=t.al(this.id,this.scope);this.map.style.clearSource(e)}_update(){this.fire(new t.f("data",{dataType:"source",sourceDataType:"content"}))}}},Lr=function(e,r,i,n){const o=new Pr[r.type](e,r,i,n);if(o.id!==e)throw new Error(`Expected Source id to be ${e} instead of ${o.id}`);return t.bp(["load","abort","unload","serialize","prepare"],o),o};class Dr extends t.bv{constructor(e){const r={type:"raster-dem",maxzoom:e.transform.maxZoom},i=new t.bw(t.bx(),null),n=Lr("mock-dem",r,i,e.style);super("mock-dem",n,!1),n.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,e){t.state="loaded",e(null)}}class Ur extends t.bv{constructor(e){const r=Lr("proxy",{type:"geojson",maxzoom:e.transform.maxZoom},new t.bw(t.bx(),null),e.style);super("proxy",r,!1),r.setEventedParent(this),this.map=this.getSource().map=e,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(e,r,i){if(e.freezeTileCoverage)return;this.transform=e;const n=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((r,i)=>{if(r[i.key]="",!this._tiles[i.key]){const r=new t.by(i,this._source.tileSize*i.overscaleFactor(),e.tileZoom);r.state="loaded",this._tiles[i.key]=r}return r}),{});for(const t in this._tiles)t in n||(this.freeFBO(t),this._tiles[t].unloadVectorData(),delete this._tiles[t])}freeFBO(t){const e=this.proxyCachedFBO[t];if(void 0!==e){const r=Object.values(e);this.renderCachePool.push(...r),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach((t=>t.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class kr extends t.aL{constructor(t,e,r){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=e,this.projMatrix=r}}class zr extends t.bq{constructor(e,r){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},e.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},(()=>{this._style.map.triggerRepaint()})),e.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},(()=>{this._style.map.triggerRepaint()})),e.tp.registerButton(["Terrain"],"Invalidate Render Cache",(()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()})),this.painter=e,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[i,n,o]=function(){const e=new t.bt,r=new t.bu,i=131;e.reserve(17161),r.reserve(33800);const n=t.a3/128,o=t.a3+n/2,a=o+n;for(let r=-n;r<a;r+=n)for(let i=-n;i<a;i+=n){const n=i<0||i>o||r<0||r>o?24575:0,a=t.at(Math.round(i),0,t.a3),s=t.at(Math.round(r),0,t.a3);e.emplaceBack(a+n,s)}const s=(t,e)=>{const n=e*i+t;r.emplaceBack(n+1,n,n+i),r.emplaceBack(n+i,n+i+1,n+1)};for(let t=1;t<129;t++)for(let e=1;e<129;e++)s(e,t);return[0,129].forEach((t=>{for(let e=0;e<130;e++)s(e,t),s(t,e)})),[e,r,32768]}(),a=e.context;this.gridBuffer=a.createVertexBuffer(i,t.br.members),this.gridIndexBuffer=a.createIndexBuffer(n),this.gridSegments=t.b.simpleSegment(0,0,i.length,n.length),this.gridNoSkirtSegments=t.b.simpleSegment(0,0,i.length,o),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Ur(r.map),this.orthoMatrix=t.ad.create(),t.ad.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,t.a3,0,t.a3,0,1);const s=a.gl;this._overlapStencilMode=new t.ag({func:s.GEQUAL,mask:255},0,255,s.KEEP,s.KEEP,s.REPLACE),this._previousZoom=e.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=r,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Dr(r.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(e,r,i){if(e&&e.terrain){this._style!==e&&(this.style=e,this._evaluationZoom=void 0);const n=e.terrain.properties,o=0===e.terrain.drapeRenderMode,a=e.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=t.e.now();const s=e.terrain&&e.terrain.scope,l=n.get("source"),c=o?this._mockSourceCache:e.getSourceCache(l,s);if(!c)return void t.w(`Couldn't find terrain source "${l}".`);if(this.sourceCache=c,this._exaggeration=a?this.calculateExaggeration(r):n.get("exaggeration"),!r.projection.requiresDraping&&a&&0===this._exaggeration)return void this._disable();this.enabled=!0;const u=()=>{this.sourceCache.used&&t.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const e=this.getScaledDemTileSize();this.sourceCache.update(r,e,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,u(),this._initializing=!0),u(),r.updateElevation(!0,i),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(r),this._emptyDEMTextureDirty=!0,this._previousZoom=r.zoom}else this._disable()}calculateExaggeration(e){const r=this._previousCameraAltitude,i=e.getFreeCameraOptions().position.z/e.pixelsPerMeter*e.worldSize;this._previousCameraAltitude=i;const n=null!=r?i-r:Number.MAX_VALUE;if(Math.abs(n)<2)return this._exaggeration;const o=e.zoom,a=this._style.terrain;if(!this._previousUpdateTimestamp)return a.getExaggeration(o);let s=o-this._previousZoom;const l=this._previousUpdateTimestamp;let c=o;null!=this._evaluationZoom&&(c=this._evaluationZoom,Math.abs(o-c)>.5&&(s=.5*(o-c+s)),s*n<0&&(c+=s)),this._evaluationZoom=c;const u=a.getExaggeration(c),h=u===a.getExaggeration(Math.max(0,c-.1));if(h&&Math.abs(u-this._exaggeration)<.01)return u;let A=Math.min(.1,.00375*(this._updateTimestamp-l));return(h||u<.1||Math.abs(s)<1e-4)&&(A=Math.min(.2,4*A)),t.a2(this._exaggeration,u,A)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&"source"===t.dataType?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):"style"===t.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach((t=>t.fb.destroy())),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(e){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const r=this.proxySourceCache,i=this.painter.transform;this._initializing&&(this._initializing=0===i._centerAltitude&&-1===this.getAtPointOrZero(t.Y.fromLngLat(i.center),-1),this._emptyDEMTextureDirty=!this._initializing);const n=this.proxyCoords=r.getIds().map((t=>{const e=r.getTileByID(t).tileID;return e.projMatrix=i.calculateProjMatrix(e.toUnwrapped()),e}));!function(e,r){const i=r.transform.pointCoordinate(r.transform.getCameraPoint()),n=new t.P(i.x,i.y);e.sort(((e,r)=>{if(r.overscaledZ-e.overscaledZ)return r.overscaledZ-e.overscaledZ;const i=new t.P(e.canonical.x+(1<<e.canonical.z)*e.wrap,e.canonical.y),o=new t.P(r.canonical.x+(1<<r.canonical.z)*r.wrap,r.canonical.y),a=n.mult(1<<e.canonical.z);return a.x-=.5,a.y-=.5,a.distSqr(i)-a.distSqr(o)}))}(n,this.painter);const o=this.proxyToSource||{};this.proxyToSource={},n.forEach((t=>{this.proxyToSource[t.key]={}})),this.terrainTileForTile={};const a=this._style._mergedSourceCaches;for(const t in a){const r=a[t];if(!r.used)continue;if(r!==this.sourceCache&&this.resetTileLookupCache(r.id),this._setupProxiedCoordsForOrtho(r,e[t],o),r.usedForTerrain)continue;const i=e[t];r.getSource().reparseOverscaled&&this._assignTerrainTiles(i)}this.proxiedCoords[r.id]=n.map((t=>new kr(t,t.key,this.orthoMatrix))),this._assignTerrainTiles(n),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(o),this.renderingToTexture=!1;const s={};this._visibleDemTiles=[];for(const t of this.proxyCoords){const e=this.terrainTileForTile[t.key];if(!e)continue;const r=e.tileID.key;r in s||(this._visibleDemTiles.push(e),s[r]=r)}}_assignTerrainTiles(t){this._initializing||t.forEach((t=>{if(this.terrainTileForTile[t.key])return;const e=this._findTileCoveringTileID(t,this.sourceCache);e&&(this.terrainTileForTile[t.key]=e)}))}_prepareDEMTextures(){const t=this.painter.context,e=t.gl;for(const r in this.terrainTileForTile){const i=this.terrainTileForTile[r],n=i.dem;!n||i.demTexture&&!i.needsDEMTextureUpload||(t.activeTexture.set(e.TEXTURE1),De(this.painter,i,n))}}_prepareDemTileUniforms(t,e,r,i){if(!e||null==e.demTexture)return!1;const n=t.tileID.canonical,o=Math.pow(2,e.tileID.canonical.z-n.z),a=i||"";return r[`u_dem_tl${a}`]=[n.x*o%1,n.y*o%1],r[`u_dem_scale${a}`]=o,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const e=this.painter.context,r=e.gl;if(!this._emptyDepthBufferTexture){const i=new t.i({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new t.T(e,i,r.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const e=this._visibleDemTiles.reduce(((e,r)=>{if(!r.dem)return e;const i=r.dem.tree.minimums[0];return i>0&&t++,e+i}),0);return t?e/t:0}_updateEmptyDEMTexture(){const e=this.painter.context,r=e.gl;e.activeTexture.set(r.TEXTURE2);const i=this._getLoadedAreaMinimum(),[n,o]=(()=>{const e=new t.bz({width:1,height:1},new Float32Array([i]));return[r.R32F,e]})();this._emptyDEMTextureDirty=!1;let a=this._emptyDEMTexture;return a?a.update(o,{premultiply:!1}):a=this._emptyDEMTexture=new t.T(e,o,n,{premultiply:!1}),a}setupElevationDraw(e,r,i){const n=this.painter.context,o=n.gl,a={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[2,0],u_exaggeration:0};a.u_exaggeration=this.exaggeration();let s=null,l=null,c=1;if(i&&i.morphing&&this._useVertexMorphing){const t=i.morphing.srcDemTile,r=i.morphing.dstDemTile;c=i.morphing.phase,t&&r&&(this._prepareDemTileUniforms(e,t,a,"_prev")&&(l=t),this._prepareDemTileUniforms(e,r,a)&&(s=r))}const u=t=>t&&t.demTexture&&this.painter.linearFloatFilteringSupported()?o.LINEAR:o.NEAREST;let h=null;var A,p;if(this.enabled?l&&s?(h=s.demTexture,n.activeTexture.set(o.TEXTURE4),l.demTexture.bind(u(l),o.CLAMP_TO_EDGE),a.u_dem_lerp=c):(s=this.terrainTileForTile[e.tileID.key],h=this._prepareDemTileUniforms(e,s,a)?s.demTexture:this.emptyDEMTexture):h=this.emptyDEMTexture,n.activeTexture.set(o.TEXTURE2),h&&(a.u_dem_size=1===(A=h).size[0]?1:A.size[0]-2,h.bind(u(s),o.CLAMP_TO_EDGE)),n.activeTexture.set(o.TEXTURE3),i&&i.useDepthForOcclusion&&this.painter.terrainDepthTexture&&this.painter.terrainDepthFBO?(this.painter.terrainDepthTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),a.u_depth_size_inv=[1/this.painter.terrainDepthFBO.width,1/this.painter.terrainDepthFBO.height],a.u_depth_range_unpack=[2/((p=this.painter.depthRangeFor3D)[1]-p[0]),-1-2*p[0]/(p[1]-p[0])]):(this.emptyDepthBufferTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),a.u_depth_range_unpack=[2,0]),n.activeTexture.set(o.TEXTURE0),i&&i.useMeterToDem&&s){const e=(1<<s.tileID.canonical.z)*t.ax(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;a.u_meter_to_dem=e}if(i&&i.labelPlaneMatrixInv&&(a.u_label_plane_matrix_inv=i.labelPlaneMatrixInv),r.setTerrainUniformValues(n,a),"globe"===this.painter.transform.projection.name){const t=this.globeUniformValues(this.painter.transform,e.tileID.canonical,i&&i.useDenormalizedUpVectorScale);r.setGlobeUniformValues(n,t)}}globeUniformValues(e,r,i){const n=e.projection;return{u_tile_tl_up:n.upVector(r,0,0),u_tile_tr_up:n.upVector(r,t.a3,0),u_tile_br_up:n.upVector(r,t.a3,t.a3),u_tile_bl_up:n.upVector(r,0,t.a3),u_tile_up_scale:i?t.bs(1):n.upVectorScale(r,e.center.lat,e.worldSize).metersToTile}}renderToBackBuffer(e){const r=this.painter,i=this.painter.context;0!==e.length&&(i.bindFramebuffer.set(null),i.viewport.set([0,0,r.width,r.height]),r.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(e,r,i,n,o){if("globe"===e.transform.projection.name)!function(e,r,i,n,o){const a=e.context,s=a.gl;let l,c;const u=e.transform,h=t.ba(e,a,u),A=(t,r)=>{if(c===r)return;const i=[Er[r],"PROJECTION_GLOBE_VIEW"];h&&i.push("CUSTOM_ANTIALIASING");const n=e.isTileAffectedByFog(t);l=e.getOrCreateProgram("globeRaster",{defines:i,overrideFog:n}),c=r},p=e.colorModeForRenderPass(),d=new t.ae(s.LEQUAL,t.ae.ReadWrite,e.depthRangeFor3D);Cr.update(o);const f=t.bb(u),m=[t.aj(u.center.lng),t.ak(u.center.lat)],g=e.globeSharedBuffers,_=[u.width*t.e.devicePixelRatio,u.height*t.e.devicePixelRatio],y=Float32Array.from(u.globeMatrix),v={useDenormalizedUpVectorScale:!0};{const u=e.transform,h=Tr(u.zoom,r.exaggeration(),r.sourceCache._source.tileSize);c=-1;const x=s.TRIANGLES;for(const c of n){const n=i.getTile(c),w=t.ag.disabled,b=r.prevTerrainTileForTile[c.key],B=r.terrainTileForTile[c.key];Br(b,B)&&Cr.newMorphing(c.key,b,B,o,250),a.activeTexture.set(s.TEXTURE0),n.texture&&n.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE);const C=Cr.getMorphValuesForProxy(c.key),E=C?1:0;C&&t.o(v,{morphing:{srcDemTile:C.from,dstDemTile:C.to,phase:t.b9(C.phase)}});const T=t.bc(c.canonical),I=t.bd(T.getCenter().lat),S=t.be(c.canonical,T,I,u.worldSize/u._pixelsPerMercatorPixel),M=t.bf(t.bg(c.canonical)),F=Ne(u.expandedFarZProjMatrix,y,f,M,t.a1(u.zoom),m,u.frustumCorners.TL,u.frustumCorners.TR,u.frustumCorners.BR,u.frustumCorners.BL,u.globeCenterInViewSpace,u.globeRadius,_,h,u._farZ,S);if(A(c,E),l&&(r.setupElevationDraw(n,l,v),e.uploadCommonUniforms(a,l,c.toUnwrapped()),g)){const[r,i,n]=g.getGridBuffers(I,0!==h);l.draw(e,x,d,w,p,t.af.backCCW,F,"globe_raster",r,i,n)}}}if(g&&(e.renderDefaultNorthPole||e.renderDefaultSouthPole)){const o=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];h&&o.push("CUSTOM_ANTIALIASING"),l=e.getOrCreateProgram("globeRaster",{defines:o});for(const o of n){const{x:n,y:c,z:h}=o.canonical,A=0===c,f=c===(1<<h)-1,[y,x,w,b]=g.getPoleBuffers(h,!1);if(b&&(A||f)){const c=i.getTile(o);a.activeTexture.set(s.TEXTURE0),c.texture&&c.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE);let g=t.bh(h,n,u);const B=t.bf(t.bg(o.canonical)),C=(r,i)=>r.draw(e,s.TRIANGLES,d,t.ag.disabled,p,t.af.disabled,Ne(u.expandedFarZProjMatrix,g,g,B,0,m,u.frustumCorners.TL,u.frustumCorners.TR,u.frustumCorners.BR,u.frustumCorners.BL,u.globeCenterInViewSpace,u.globeRadius,_,0,u._farZ),"globe_pole_raster",i,w,b);r.setupElevationDraw(c,l,v),e.uploadCommonUniforms(a,l,o.toUnwrapped()),A&&e.renderDefaultNorthPole&&C(l,y),f&&e.renderDefaultSouthPole&&(g=t.ad.scale(t.ad.create(),g,[1,-1,1]),C(l,x))}}}}(e,r,i,n,o);else{const a=e.context,s=a.gl;let l,c;const u=e.shadowRenderer,h=fr(e,e.longestCutoffRange),A=t=>{if(c===t)return;const r=[];r.push(Er[t]),h.shouldRenderCutoff&&r.push("RENDER_CUTOFF"),l=e.getOrCreateProgram("terrainRaster",{defines:r}),c=t},p=e.colorModeForRenderPass(),d=new t.ae(s.LEQUAL,t.ae.ReadWrite,e.depthRangeFor3D);Cr.update(o);const f=e.transform,m=Tr(f.zoom,r.exaggeration(),r.sourceCache._source.tileSize);let g=[0,0,0];if(u){const t=e.style.directionalLight,r=e.style.ambientLight;t&&r&&(g=wr(e.style,t,r))}{c=-1;const _=s.TRIANGLES,[y,v]=[r.gridIndexBuffer,r.gridSegments];for(const c of n){const n=i.getTile(c),x=t.ag.disabled,w=r.prevTerrainTileForTile[c.key],b=r.terrainTileForTile[c.key];Br(w,b)&&Cr.newMorphing(c.key,w,b,o,250),a.activeTexture.set(s.TEXTURE0),n.texture&&n.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE);const B=Cr.getMorphValuesForProxy(c.key),C=B?1:0;let E;B&&(E={morphing:{srcDemTile:B.from,dstDemTile:B.to,phase:t.b9(B.phase)}});const T=Qe(c.projMatrix,Ir(c.canonical,f.renderWorldCopies)?m/10:m,g);if(A(C),!l)continue;r.setupElevationDraw(n,l,E);const I=c.toUnwrapped();u&&u.setupShadows(I,l),e.uploadCommonUniforms(a,l,I,null,h),l.draw(e,_,d,x,p,t.af.backCCW,T,"terrain_raster",r.gridBuffer,y,v)}}}}(r,this,this.proxySourceCache,e,this._updateTimestamp),this.renderingToTexture=!0,r.gpuTimingDeferredRenderEnd(),e.splice(0,e.length))}renderBatch(e){if(0===this._drapedRenderBatches.length)return e+1;this.renderingToTexture=!0;const r=this.painter,i=this.painter.context,n=this.proxySourceCache,o=this.proxiedCoords[n.id],a=this._drapedRenderBatches.shift(),s=r.style.order,l=[];let c=0;for(const u of o){const o=n.getTileByID(u.proxyTileKey),h=n.proxyCachedFBO[u.key]?n.proxyCachedFBO[u.key][e]:void 0,A=void 0!==h?n.renderCache[h]:this.pool[c++],p=void 0!==h;if(o.texture=A.tex,p&&!A.dirty){l.push(o.tileID);continue}let d;i.bindFramebuffer.set(A.fb.framebuffer),this.renderedToTile=!1,A.dirty&&(i.clear({color:t.C.transparent,stencil:0}),A.dirty=!1);for(let t=a.start;t<=a.end;++t){const e=r.style._mergedLayers[s[t]];if(e.isHidden(r.transform.zoom))continue;const n=r.style.getLayerSourceCache(e),o=n?this.proxyToSource[u.key][n.id]:[u];if(!o)continue;const a=o;i.viewport.set([0,0,A.fb.width,A.fb.height]),d!==(n?n.id:null)&&(this._setupStencil(A,o,e,n),d=n?n.id:null),r.renderLayer(r,n,e,a)}if(0===this._drapedRenderBatches.length)for(const t of this._pendingGroundEffectLayers){const e=r.style._mergedLayers[s[t]];if(e.isHidden(r.transform.zoom))continue;const n=r.style.getLayerSourceCache(e),o=n?this.proxyToSource[u.key][n.id]:[u];if(!o)continue;const a=o;i.viewport.set([0,0,A.fb.width,A.fb.height]),d!==(n?n.id:null)&&(this._setupStencil(A,o,e,n),d=n?n.id:null),r.renderLayer(r,n,e,a)}this.renderedToTile?(A.dirty=!0,l.push(o.tileID)):p||--c,5===c&&(c=0,this.renderToBackBuffer(l))}return this.renderToBackBuffer(l),this.renderingToTexture=!1,i.bindFramebuffer.set(null),i.viewport.set([0,0,r.width,r.height]),a.end+1}postRender(){}isLayerOrderingCorrect(t){const e=t.order.length;let r=-1,i=e;for(let n=0;n<e;++n)this._style.isLayerDraped(t._mergedLayers[t.order[n]])?r=Math.max(r,n):i=Math.min(i,n);return i>r}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter((t=>t.dem)).forEach((e=>{t=Math.min(t,e.dem.tree.minimums[0])})),0===t?t:(t-30)*this._exaggeration}raycast(t,e,r){if(!this._visibleDemTiles)return null;const i=this._visibleDemTiles.filter((t=>t.dem)).map((i=>{const n=i.tileID,o=1<<n.overscaledZ,{x:a,y:s}=n.canonical,l=a/o,c=(a+1)/o,u=s/o,h=(s+1)/o;return{minx:l,miny:u,maxx:c,maxy:h,t:i.dem.tree.raycastRoot(l,u,c,h,t,e,r),tile:i}}));i.sort(((t,e)=>(null!==t.t?t.t:Number.MAX_VALUE)-(null!==e.t?e.t:Number.MAX_VALUE)));for(const n of i){if(null==n.t)return null;const i=n.tile.dem.tree.raycast(n.minx,n.miny,n.maxx,n.maxy,t,e,r);if(null!=i)return i}return null}_createFBO(){const e=this.painter.context,r=e.gl,i=this.drapeBufferSize;e.activeTexture.set(r.TEXTURE0);const n=new t.T(e,{width:i[0],height:i[1],data:null},r.RGBA);n.bind(r.LINEAR,r.CLAMP_TO_EDGE);const o=e.createFramebuffer(i[0],i[1],!0,null);return o.colorAttachment.set(n.texture),o.depthAttachment=new it(e,o.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=e.createRenderbuffer(e.gl.DEPTH_STENCIL,i[0],i[1]),this._stencilRef=0,o.depthAttachment.set(this._sharedDepthStencil),e.clear({stencil:0})):o.depthAttachment.set(this._sharedDepthStencil),e.extTextureFilterAnisotropic&&r.texParameterf(r.TEXTURE_2D,e.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.extTextureFilterAnisotropicMax),{fb:o,tex:n,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache)return!0;if(this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some((t=>{const e=this._style._mergedLayers[t],r=e.isHidden(this.painter.transform.zoom);return"custom"===e.type?!r&&e.shouldRedrape():!r&&e.hasTransition()}))}_clearLineLayersFromRenderCache(){let e=!1;for(const t of this._style.getSources())if(t instanceof Oe){e=!0;break}if(!e)return;const r={};for(let e=0;e<this._style.order.length;++e){const i=this._style._mergedLayers[this._style.order[e]],n=this._style.getLayerSourceCache(i);if(n&&!r[n.id]&&!i.isHidden(this.painter.transform.zoom)&&"line"===i.type&&i.widthExpression()instanceof t.Z){r[n.id]=!0;for(const t of this.proxyCoords){const e=this.proxyToSource[t.key][n.id];if(e)for(const t of e)this._clearRenderCacheForTile(n.id,t)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const e in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[e]._source instanceof Re){t=!0;break}if(!t)return;const e={};for(let t=0;t<this._style.order.length;++t){const r=this._style._mergedLayers[this._style.order[t]],i=this._style.getLayerSourceCache(r);if(!i||e[i.id])continue;if(r.isHidden(this.painter.transform.zoom)||"raster"!==r.type)continue;const n=r.paint.get("raster-fade-duration");for(const t of this.proxyCoords){const e=this.proxyToSource[t.key][i.id];if(e)for(const t of e){const e=Mr(i.getTile(t),i.findLoadedParent(t,0),i,this.painter.transform,n);(1!==e.opacity||0!==e.mix)&&this._clearRenderCacheForTile(i.id,t)}}}}_setupDrapedRenderBatches(){const e=this._style.order,r=e.length;if(0===r)return;const i=[];this._pendingGroundEffectLayers=[];let n,o=0,a=this._style._mergedLayers[e[o]];for(;!this._style.isLayerDraped(a)&&a.isHidden(this.painter.transform.zoom)&&++o<r;)a=this._style._mergedLayers[e[o]];for(;o<r;++o){const t=this._style._mergedLayers[e[o]];t.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(t)?void 0===n&&(n=o):("fill-extrusion"===t.type&&this._pendingGroundEffectLayers.push(o),void 0!==n&&(i.push({start:n,end:o-1}),n=void 0)))}if(void 0!==n&&i.push({start:n,end:o-1}),0!==i.length){const e=i[i.length-1];this._pendingGroundEffectLayers.every((t=>t>e.end))||t.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=i}_setupRenderCache(t){const e=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,e.renderCache.length>e.renderCachePool.length){const t=Object.values(e.proxyCachedFBO);e.proxyCachedFBO={};for(let r=0;r<t.length;++r){const i=Object.values(t[r]);e.renderCachePool.push(...i)}}return}this._clearRasterLayersFromRenderCache();const r=this.proxyCoords,i=this._tilesDirty;for(let n=r.length-1;n>=0;n--){const o=r[n];if(e.getTileByID(o.key),void 0!==e.proxyCachedFBO[o.key]){const r=t[o.key],n=this.proxyToSource[o.key];let a=0;for(const t in n){const e=n[t],o=r[t];if(!o||o.length!==e.length||e.some(((e,r)=>e!==o[r]||i[t]&&i[t].hasOwnProperty(e.key)))){a=-1;break}++a}for(const t in e.proxyCachedFBO[o.key])e.renderCache[e.proxyCachedFBO[o.key][t]].dirty=a<0||a!==Object.values(r).length}}const n=[...this._drapedRenderBatches];n.sort(((t,e)=>e.end-e.start-(t.end-t.start)));for(const t of n)for(const i of r){if(e.proxyCachedFBO[i.key])continue;let r=e.renderCachePool.pop();void 0===r&&e.renderCache.length<50&&(r=e.renderCache.length,e.renderCache.push(this._createFBO())),void 0!==r&&(e.proxyCachedFBO[i.key]={},e.proxyCachedFBO[i.key][t.start]=r,e.renderCache[r].dirty=!0)}this._tilesDirty={}}_setupStencil(t,e,r,i){if(!i||!this._sourceTilesOverlap[i.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const n=this.painter.context,o=n.gl;if(e.length<=1)return void(this._overlapStencilType=!1);let a;if(r.isTileClipped())a=e.length,this._overlapStencilMode.test={func:o.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(e[0].overscaledZ>e[e.length-1].overscaledZ))return void(this._overlapStencilType=!1);a=1,this._overlapStencilMode.test={func:o.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+a>255&&(n.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=a,this._overlapStencilMode.ref=this._stencilRef,r.isTileClipped()&&this._renderTileClippingMasks(e,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(e){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[e.key]),this._overlapStencilMode):t.ag.disabled}_renderTileClippingMasks(e,r){const i=this.painter,n=this.painter.context,o=n.gl;i._tileClippingMaskIDs={},n.setColorMode(t.a.disabled),n.setDepthMode(t.ae.disabled);const a=i.getOrCreateProgram("clippingMask");for(const n of e){const e=i._tileClippingMaskIDs[n.key]=--r;a.draw(i,o.TRIANGLES,t.ae.disabled,new t.ag({func:o.ALWAYS,mask:0},e,255,o.KEEP,o.KEEP,o.REPLACE),t.a.disabled,t.af.disabled,Sr(n.projMatrix),"$clipping",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments)}}pointCoordinate(e){const r=this.painter.transform;if(e.x<0||e.x>r.width||e.y<0||e.y>r.height)return null;const i=[e.x,e.y,1,1];t.aA.transformMat4(i,i,r.pixelMatrixInverse),t.aA.scale(i,i,1/i[3]),i[0]/=r.worldSize,i[1]/=r.worldSize;const n=r._camera.position,o=t.ax(1,r.center.lat),a=[n[0],n[1],n[2]/o,0],s=t._.subtract([],i.slice(0,3),a);t._.normalize(s,s);const l=this.raycast(a,s,this._exaggeration);return null!==l&&l?(t._.scaleAndAdd(a,a,s,l),a[3]=a[2],a[2]*=o,a):null}_setupProxiedCoordsForOrtho(e,r,i){if(e.getSource()instanceof t.bm)return this._setupProxiedCoordsForImageSource(e,r,i);this._findCoveringTileCache[e.id]=this._findCoveringTileCache[e.id]||{};const n=this.proxiedCoords[e.id]=[],o=this.proxyCoords;for(let t=0;t<o.length;t++){const r=o[t],a=this._findTileCoveringTileID(r,e);if(a){const t=this._createProxiedId(r,a,i[r.key]&&i[r.key][e.id]);n.push(t),this.proxyToSource[r.key][e.id]=[t]}}let a=!1;const s=new Set;for(let t=0;t<r.length;t++){const o=e.getTile(r[t]);if(!o||!o.hasData())continue;const l=this._findTileCoveringTileID(o.tileID,this.proxySourceCache);if(l&&l.tileID.canonical.z!==o.tileID.canonical.z){const t=this.proxyToSource[l.tileID.key][e.id],r=this._createProxiedId(l.tileID,o,i[l.tileID.key]&&i[l.tileID.key][e.id]);t?t.splice(t.length-1,0,r):this.proxyToSource[l.tileID.key][e.id]=[r];const c=this.proxyToSource[l.tileID.key][e.id];s.has(c)||s.add(c),n.push(r),a=!0}}if(this._sourceTilesOverlap[e.id]=a,a&&this._debugParams.sortTilesHiZFirst)for(const t of s)t.sort(((t,e)=>e.overscaledZ-t.overscaledZ))}_setupProxiedCoordsForImageSource(e,r,i){if(!e.getSource().loaded())return;const n=this.proxiedCoords[e.id]=[],o=this.proxyCoords,a=e.getSource(),s=a.tileID;if(!s)return;const l=new t.P(s.x,s.y)._div(1<<s.z),c=a.coordinates.map(t.Y.fromLngLat).reduce(((t,e)=>(t.min.x=Math.min(t.min.x,e.x-l.x),t.min.y=Math.min(t.min.y,e.y-l.y),t.max.x=Math.max(t.max.x,e.x-l.x),t.max.y=Math.max(t.max.y,e.y-l.y),t)),{min:new t.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new t.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),u=(e,r)=>{const i=e.wrap+e.canonical.x/(1<<e.canonical.z),n=e.canonical.y/(1<<e.canonical.z),o=t.a3/(1<<e.canonical.z),a=r.wrap+r.canonical.x/(1<<r.canonical.z),s=r.canonical.y/(1<<r.canonical.z);return i+o<a+c.min.x||i>a+c.max.x||n+o<s+c.min.y||n>s+c.max.y};for(let t=0;t<o.length;t++){const a=o[t];for(let t=0;t<r.length;t++){const o=e.getTile(r[t]);if(!o||!o.hasData())continue;if(u(a,o.tileID))continue;const s=this._createProxiedId(a,o,i[a.key]&&i[a.key][e.id]),l=this.proxyToSource[a.key][e.id];l?l.push(s):this.proxyToSource[a.key][e.id]=[s],n.push(s)}}}_createProxiedId(e,r,i){let n=this.orthoMatrix;if(i){const t=i.find((t=>t.key===r.tileID.key));if(t)return t}if(r.tileID.key!==e.key){const i=e.canonical.z-r.tileID.canonical.z;let o,a,s;n=t.ad.create();const l=r.tileID.wrap-e.wrap<<e.overscaledZ;i>0?(o=t.a3>>i,a=o*((r.tileID.canonical.x<<i)-e.canonical.x+l),s=o*((r.tileID.canonical.y<<i)-e.canonical.y)):(o=t.a3<<-i,a=t.a3*(r.tileID.canonical.x-(e.canonical.x+l<<-i)),s=t.a3*(r.tileID.canonical.y-(e.canonical.y<<-i))),t.ad.ortho(n,0,o,0,o,0,1),t.ad.translate(n,n,[a,s,0])}return new kr(r.tileID,e.key,n)}_findTileCoveringTileID(e,r){let i=r.getTile(e);if(i&&i.hasData())return i;const n=this._findCoveringTileCache[r.id],o=n[e.key];if(i=o?r.getTileByID(o):null,i&&i.hasData()||null===o)return i;let a=i?i.tileID:e,s=a.overscaledZ;const l=r.getSource().minzoom,c=[];if(!o){const n=r.getSource().maxzoom;if(e.canonical.z>=n){const i=e.canonical.z-n;r.getSource().reparseOverscaled?(s=Math.max(e.canonical.z+2,r.transform.tileZoom),a=new t.aL(s,e.wrap,n,e.canonical.x>>i,e.canonical.y>>i)):0!==i&&(s=n,a=new t.aL(s,e.wrap,n,e.canonical.x>>i,e.canonical.y>>i))}a.key!==e.key&&(c.push(a.key),i=r.getTile(a))}const u=t=>{c.forEach((e=>{n[e]=t})),c.length=0};for(s-=1;s>=l&&(!i||!i.hasData());s--){i&&u(i.tileID.key);const t=a.calculateScaledKey(s);if(i=r.getTileByID(t),i&&i.hasData())break;const e=n[t];if(null===e)break;void 0===e?c.push(t):i=r.getTileByID(e)}return u(i?i.tileID.key:null),i&&i.hasData()?i:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,e){let r=this._tilesDirty[t];r||(r=this._tilesDirty[t]={}),r[e.key]=!0}}function Rr(e,r,i){const n=function(e,r,i){const n=t._.dot(r,e),o=t._.dot(i,[.2126,.7152,.0722]),a=(t,e,r)=>(1-r)*t+r*e,s=a(1-.3*Math.min(o,1),1,Math.min(n+1,1));return a(.92,1,Math.asin(t.at(r[2],-1,1))/Math.PI+.5)*s}(e,[0,0,1],r),o=[0,0,0];t._.scale(o,i.slice(0,3),n);const a=[0,0,0];t._.scale(a,r.slice(0,3),e[2]);const s=[0,0,0];return t._.add(s,o,a),t.b8(s)}const Or=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Qr=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class Nr{static cacheKey(t,e,r,i){let n=`${e}${i?i.cacheKey:""}`;for(const e of r)t.usedDefines.includes(e)&&(n+=`/${e}`);return n}constructor(e,r,i,n,o,a){const s=e.gl;this.program=s.createProgram(),this.configuration=n,this.name=r,this.fixedDefines=[...a];const l=n?n.getBinderAttributes():[],c=(i.staticAttributes||[]).concat(l);let u=n?n.defines():[];u=u.concat(a.map((t=>`#define ${t}`)));const h="#version 300 es\n";let A=h+u.concat("precision mediump float;",Te,Ee.fragmentSource).join("\n");for(const t of i.fragmentIncludes)A+=`\n${Be[t]}`;A+=`\n${i.fragmentSource}`;let p=h+u.concat("precision highp float;",Te,Ee.vertexSource).join("\n");for(const t of i.vertexIncludes)p+=`\n${Be[t]}`;p+=`\n${i.vertexSource}`;const d=s.createShader(s.FRAGMENT_SHADER);if(s.isContextLost())return void(this.failedToCreate=!0);s.shaderSource(d,A),s.compileShader(d),s.attachShader(this.program,d);const f=s.createShader(s.VERTEX_SHADER);if(s.isContextLost())this.failedToCreate=!0;else{s.shaderSource(f,p),s.compileShader(f),s.attachShader(this.program,f),this.attributes={},this.numAttributes=c.length;for(let t=0;t<this.numAttributes;t++)if(c[t]){const e=c[t].startsWith("a_")?c[t]:`a_${c[t]}`;s.bindAttribLocation(this.program,t,e),this.attributes[e]=t}s.linkProgram(this.program),s.deleteShader(f),s.deleteShader(d),this.fixedUniforms=o(e),this.binderUniforms=n?n.getUniforms(e):[],a.includes("TERRAIN")&&(this.terrainUniforms=(e=>({u_dem:new t.a7(e),u_dem_prev:new t.a7(e),u_dem_tl:new t.a8(e),u_dem_scale:new t.aa(e),u_dem_tl_prev:new t.a8(e),u_dem_scale_prev:new t.aa(e),u_dem_size:new t.aa(e),u_dem_lerp:new t.aa(e),u_exaggeration:new t.aa(e),u_depth:new t.a7(e),u_depth_size_inv:new t.a8(e),u_depth_range_unpack:new t.a8(e),u_meter_to_dem:new t.aa(e),u_label_plane_matrix_inv:new t.a6(e)}))(e)),a.includes("GLOBE")&&(this.globeUniforms=(e=>({u_tile_tl_up:new t.aq(e),u_tile_tr_up:new t.aq(e),u_tile_br_up:new t.aq(e),u_tile_bl_up:new t.aq(e),u_tile_up_scale:new t.aa(e)}))(e)),a.includes("FOG")&&(this.fogUniforms=(e=>({u_fog_matrix:new t.a6(e),u_fog_range:new t.a8(e),u_fog_color:new t.as(e),u_fog_horizon_blend:new t.aa(e),u_fog_vertical_limit:new t.a8(e),u_fog_temporal_offset:new t.aa(e),u_frustum_tl:new t.aq(e),u_frustum_tr:new t.aq(e),u_frustum_br:new t.aq(e),u_frustum_bl:new t.aq(e),u_globe_pos:new t.aq(e),u_globe_radius:new t.aa(e),u_globe_transition:new t.aa(e),u_is_globe:new t.a7(e),u_viewport:new t.a8(e)}))(e)),a.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(e=>({u_cutoff_params:new t.as(e)}))(e)),a.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(e=>({u_lighting_ambient_color:new t.aq(e),u_lighting_directional_dir:new t.aq(e),u_lighting_directional_color:new t.aq(e),u_ground_radiance:new t.aq(e)}))(e)),a.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(e=>({u_light_matrix_0:new t.a6(e),u_light_matrix_1:new t.a6(e),u_fade_range:new t.a8(e),u_shadow_normal_offset:new t.aq(e),u_shadow_intensity:new t.aa(e),u_shadow_texel_size:new t.aa(e),u_shadow_map_resolution:new t.aa(e),u_shadow_direction:new t.aq(e),u_shadow_bias:new t.aq(e),u_shadowmap_0:new t.a7(e),u_shadowmap_1:new t.a7(e)}))(e))}}setTerrainUniformValues(t,e){if(!this.terrainUniforms)return;const r=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)r[t]&&r[t].set(this.program,t,e[t])}}setGlobeUniformValues(t,e){if(!this.globeUniforms)return;const r=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)r[t]&&r[t].set(this.program,t,e[t])}}setFogUniformValues(t,e){if(!this.fogUniforms)return;const r=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)r[t].set(this.program,t,e[t])}}setCutoffUniformValues(t,e){if(!this.cutoffUniforms)return;const r=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)r[t].set(this.program,t,e[t])}}setLightsUniformValues(t,e){if(!this.lightsUniforms)return;const r=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)r[t].set(this.program,t,e[t])}}setShadowUniformValues(t,e){if(this.failedToCreate||!this.shadowUniforms)return;const r=this.shadowUniforms;t.program.set(this.program);for(const t in e)r[t].set(this.program,t,e[t])}_drawDebugWireframe(e,r,i,n,o,a,s,l,c,u){const h=e.options.wireframe;if(!1===h.terrain&&!1===h.layers2D&&!1===h.layers3D)return;const A=e.context;if(!(()=>!(!h.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!h.layers2D||e._terrain&&e._terrain.renderingToTexture||!Or.includes(this.name))||!(!h.layers3D||!Qr.includes(this.name)))())return;const p=A.gl,d=e.wireframeDebugCache.getLinesFromTrianglesBuffer(e.frameCounter,o,A);if(!d)return;const f=[...this.fixedDefines];f.push("DEBUG_WIREFRAME");const m=e.getOrCreateProgram(this.name,{config:this.configuration,defines:f});A.program.set(m.program);const g=(t,e,r)=>{if(e[t]&&r[t])for(const i in e[t])r[t][i]&&r[t][i].set(r.program,i,e[t][i].current)};c&&c.setUniforms(m.program,A,m.binderUniforms,s,{zoom:l}),g("fixedUniforms",this,m),g("terrainUniforms",this,m),g("globeUniforms",this,m),g("fogUniforms",this,m),g("lightsUniforms",this,m),g("shadowUniforms",this,m),d.bind(),A.setColorMode(new t.a([p.ONE,p.ONE_MINUS_SRC_ALPHA,p.ZERO,p.ONE],t.C.transparent,[!0,!0,!0,!1])),A.setDepthMode(new t.ae(r.func===p.LESS?p.LEQUAL:r.func,t.ae.ReadOnly,r.range)),A.setStencilMode(t.ag.disabled);const _=3*a.primitiveLength*2,y=3*a.primitiveOffset*2*2;u&&u>1?p.drawElementsInstanced(p.LINES,_,p.UNSIGNED_SHORT,y,u):p.drawElements(p.LINES,_,p.UNSIGNED_SHORT,y),o.bind(),A.program.set(this.program),A.setDepthMode(r),A.setStencilMode(i),A.setColorMode(n)}draw(t,e,r,i,n,o,a,s,l,c,u,h,A,p,d,f){const m=t.context,g=m.gl;if(this.failedToCreate)return;m.program.set(this.program),m.setDepthMode(r),m.setStencilMode(i),m.setColorMode(n),m.setCullFace(o);for(const t of Object.keys(this.fixedUniforms))this.fixedUniforms[t].set(this.program,t,a[t]);p&&p.setUniforms(this.program,m,this.binderUniforms,h,{zoom:A});const _={[g.POINTS]:1,[g.LINES]:2,[g.TRIANGLES]:3,[g.LINE_STRIP]:1}[e],y=f&&f>0?1:void 0;for(const o of u.get()){const a=o.vaos||(o.vaos={});(a[s]||(a[s]=new Fe)).bind(m,this,l,p?p.getPaintVertexBuffers():[],c,o.vertexOffset,d||[],y),f&&f>1?g.drawElementsInstanced(e,o.primitiveLength*_,g.UNSIGNED_SHORT,o.primitiveOffset*_*2,f):c?g.drawElements(e,o.primitiveLength*_,g.UNSIGNED_SHORT,o.primitiveOffset*_*2):g.drawArrays(e,o.vertexOffset,o.vertexLength),e===g.TRIANGLES&&c&&this._drawDebugWireframe(t,r,i,n,c,o,h,A,p,f)}}}function Vr(e,r){const i=Math.pow(2,r.tileID.overscaledZ),n=r.tileSize*Math.pow(2,e.transform.tileZoom)/i,o=n*(r.tileID.canonical.x+r.tileID.wrap*i),a=n*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/t.bB(r,1,e.transform.tileZoom),u_pixel_coord_upper:[o>>16,a>>16],u_pixel_coord_lower:[65535&o,65535&a]}}const Hr=t.ad.create(),jr=(e,r,i,n,o,a,s,l,c,u,h,A,p,d,f,m)=>{const g=r.style.light,_=g.properties.get("position"),y=[_.x,_.y,_.z],v=t.bC.create();"viewport"===g.properties.get("anchor")&&(t.bC.fromRotation(v,-r.transform.angle),t._.transformMat3(y,y,v));const x=g.properties.get("color"),w=r.transform,b={u_matrix:e,u_lightpos:y,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[x.r,x.g,x.b],u_vertical_gradient:+i,u_opacity:n,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Hr,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:o,u_edge_radius:a,u_flood_light_color:A,u_vertical_scale:p,u_flood_light_intensity:d,u_ground_shadow_factor:f,u_emissive_strength:m};return"globe"===w.projection.name&&(b.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],b.u_zoom_transition=c,b.u_inv_rot_matrix=h,b.u_merc_center=u,b.u_up_dir=w.projection.upVector(new t.aO(0,0,0),u[0]*t.a3,u[1]*t.a3),b.u_height_lift=l),b},Gr=(t,e,r)=>({u_matrix:t,u_edge_radius:e,u_vertical_scale:r}),Kr=(e,r,i,n,o,a,s,l,c,u,h,A,p,d)=>{const f=jr(e,r,i,n,o,a,s,c,u,h,A,p,d,1,[0,0,0],0),m={u_height_factor:-Math.pow(2,s.overscaledZ)/l.tileSize/8};return t.W(f,Vr(r,l),m)},qr=(t,e)=>({u_matrix:t,u_emissive_strength:e}),Zr=(e,r,i,n)=>t.W(qr(e,r),Vr(i,n)),Wr=(t,e,r)=>({u_matrix:t,u_world:r,u_emissive_strength:e}),Xr=(e,r,i,n,o)=>t.W(Zr(e,r,i,n),{u_world:o}),$r=(e,r,i,n)=>{const o=t.a3/i.tileSize;return{u_matrix:e,u_camera_to_center_distance:r.getCameraToCenterDistance(n),u_extrude_scale:[r.pixelsToGLUnits[0]/o,r.pixelsToGLUnits[1]/o]}},Yr=(t,e,r=1)=>({u_matrix:t,u_color:e.toRenderColor(null),u_overlay:0,u_overlay_scale:r}),Jr=t.ad.create(),ti=(e,r,i,n,o,a,s)=>{const l=e.transform,c="globe"===l.projection.name,u=c?t.bD(l.zoom,r.canonical)*l._pixelsPerMercatorPixel:t.bB(i,1,a),h={u_matrix:r.projMatrix,u_extrude_scale:u,u_intensity:s,u_inv_rot_matrix:Jr,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(c){h.u_inv_rot_matrix=n,h.u_merc_center=o,h.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],h.u_zoom_transition=t.a1(l.zoom);const e=o[0]*t.a3,i=o[1]*t.a3;h.u_up_dir=l.projection.upVector(new t.aO(0,0,0),e,i)}return h};function ei(t,[e,r,i,n],[o,a]){if(o===a)return[0,0,0,0];const s=255*(t-1)/(t*(a-o));return[e*s,r*s,i*s,n*s]}function ri(t,e,[r,i]){return r===i?0:.5/t+(e-r)*(t-1)/(t*(i-r))}const ii=(e,r,i,n,o,a,s,l,c,u,h,A,p,d,f,m,g,_,y,v,x)=>({u_matrix:e,u_normalize_matrix:r,u_globe_matrix:i,u_merc_matrix:n,u_grid_matrix:o,u_tl_parent:a,u_scale_parent:u,u_fade_t:h.mix,u_opacity:h.opacity*A.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:A.paint.get("raster-brightness-min"),u_brightness_high:A.paint.get("raster-brightness-max"),u_saturation_factor:t.bE(A.paint.get("raster-saturation")),u_contrast_factor:t.bF(A.paint.get("raster-contrast")),u_spin_weights:ni(A.paint.get("raster-hue-rotate")),u_perspective_transform:p,u_raster_elevation:d,u_zoom_transition:s,u_merc_center:l,u_cutoff_params:c,u_colorization_mix:ei(t.bG,m,_),u_colorization_offset:ri(t.bG,g,_),u_color_ramp:f,u_texture_offset:[v/(y+2*v),y/(y+2*v)],u_texture_res:[y+2*v,y+2*v],u_emissive_strength:x});function ni(t){t*=Math.PI/180;const e=Math.sin(t),r=Math.cos(t);return[(2*r+1)/3,(-Math.sqrt(3)*e-r+1)/3,(Math.sqrt(3)*e-r+1)/3]}const oi=.05,ai=(t,e,r,i,n,o,a,s,l,c,u,h)=>({u_matrix:t,u_normalize_matrix:e,u_globe_matrix:r,u_merc_matrix:i,u_grid_matrix:n,u_tl_parent:o,u_scale_parent:c,u_fade_t:u.mix,u_opacity:u.opacity,u_image0:0,u_image1:1,u_raster_elevation:h,u_zoom_transition:a,u_merc_center:s,u_cutoff_params:l}),si=(t,e,r,i,n,o,a,s,l,c)=>({u_particle_texture:t,u_particle_texture_side_len:e,u_tile_offset:r,u_velocity:i,u_color_ramp:o,u_velocity_res:n,u_max_speed:a,u_uv_offset:s,u_data_scale:[255*l[0],255*l[1]],u_data_offset:c,u_particle_pos_scale:1.1,u_particle_pos_offset:[oi,oi]}),li=(t,e,r,i,n,o,a,s,l,c)=>({u_particle_texture:t,u_particle_texture_side_len:e,u_velocity:r,u_velocity_res:i,u_max_speed:n,u_speed_factor:o,u_reset_rate:a,u_rand_seed:Math.random(),u_uv_offset:s,u_data_scale:[255*l[0],255*l[1]],u_data_offset:c,u_particle_pos_scale:1.1,u_particle_pos_offset:[oi,oi]}),ci=t.ad.create(),ui=(e,r,i,n,o,a,s,l,c,u,h,A,p,d,f,m,g,_)=>{const y=o.transform,v={u_is_size_zoom_constant:+("constant"===e||"source"===e),u_is_size_feature_constant:+("constant"===e||"camera"===e),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:y.getCameraToCenterDistance(m),u_rotate_symbol:+i,u_aspect_ratio:y.width/y.height,u_fade_change:o.options.fadeDuration?o.symbolFadeChange:1,u_matrix:a,u_label_plane_matrix:s,u_coord_matrix:l,u_is_text:+c,u_pitch_with_map:+n,u_texsize:u,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ci,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:ci,u_up_vector:[0,-1,0],u_color_adj_mat:g,u_icon_transition:_||0};return"globe"===m.name&&(v.u_tile_id=[h.canonical.x,h.canonical.y,1<<h.canonical.z],v.u_zoom_transition=A,v.u_inv_rot_matrix=d,v.u_merc_center=p,v.u_camera_forward=y._camera.forward(),v.u_ecef_origin=t.bH(y.globeMatrix,h.toUnwrapped()),v.u_tile_matrix=Float32Array.from(y.globeMatrix),v.u_up_vector=f),v},hi=(e,r,i,n,o,a,s,l,c,u,h,A,p,d,f,m,g)=>t.W(ui(e,r,i,n,o,a,s,l,c,u,A,p,d,f,m,g),{u_gamma_scale:n?o.transform.getCameraToCenterDistance(g)*Math.cos(o.terrain?0:o.transform._pitch):1,u_device_pixel_ratio:t.e.devicePixelRatio,u_is_halo:+h,undefined:void 0}),Ai=(e,r,i,n,o,a,s,l,c,u,h,A,p,d,f,m)=>t.W(hi(e,r,i,n,o,a,s,l,!0,c,!0,h,A,p,d,f,m),{u_texsize_icon:u,u_texture_icon:1}),pi=(t,e,r,i)=>({u_matrix:t,u_emissive_strength:e,u_opacity:r,u_color:i}),di=(e,r,i,n,o,a,s,l)=>t.W(function(e,r,i,n,o){const{width:a,height:s}=n.imageManager.getPixelSize(r),l=Math.pow(2,o.tileID.overscaledZ),c=o.tileSize*Math.pow(2,n.transform.tileZoom)/l,u=c*(o.tileID.canonical.x+o.tileID.wrap*l),h=c*o.tileID.canonical.y;return{u_image:0,u_pattern_tl:i.tl,u_pattern_br:i.br,u_texsize:[a,s],u_pattern_size:i.displaySize,u_tile_units_to_pixels:1/t.bB(o,1,n.transform.tileZoom),u_pixel_coord_upper:[u>>16,h>>16],u_pixel_coord_lower:[65535&u,65535&h]}}(0,a,s,n,l),{u_matrix:e,u_emissive_strength:r,u_opacity:i}),fi=new Float32Array(t.ad.identity([])),mi=(e,r,i,n,o,a,s,l,c,u,h,A,p,d=[0,0,0],f)=>{const m=o.style.light,g=m.properties.get("position"),_=[-g.x,-g.y,g.z],y=t.bC.create();"viewport"===m.properties.get("anchor")&&(t.bC.fromRotation(y,-o.transform.angle),t._.transformMat3(_,_,y));const v="MASK"===h.alphaMode,x=m.properties.get("color").toRenderColor(null),w=p.paint.get("model-ambient-occlusion-intensity"),b=p.paint.get("model-color").constantOr(t.C.white).toRenderColor(null),B=p.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:e,u_lighting_matrix:r,u_normal_matrix:i,u_node_matrix:n||fi,u_lightpos:_,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[x.r,x.g,x.b],u_camera_pos:d,u_opacity:a,u_baseTextureIsAlpha:0,u_alphaMask:+v,u_alphaCutoff:h.alphaCutoff,u_baseColorFactor:[s.r,s.g,s.b,s.a],u_emissiveFactor:[l[0],l[1],l[2],1],u_metallicFactor:c,u_roughnessFactor:u,u_baseColorTexture:dr.BaseColor,u_metallicRoughnessTexture:dr.MetallicRoughness,u_normalTexture:dr.Normal,u_occlusionTexture:dr.Occlusion,u_emissionTexture:dr.Emission,u_lutTexture:dr.LUT,u_color_mix:[b.r,b.g,b.b,B],u_aoIntensity:w,u_emissive_strength:A,u_occlusionTextureTransform:f||[0,0,0,0]}},gi=(t,e=fi,r=fi)=>({u_matrix:t,u_instance:e,u_node_matrix:r}),_i=(t,e,r,i,n)=>({u_matrix:Float32Array.from(t),u_anchorPos:e,u_screenSizePx:r,u_occluderSizePx:i,u_color:n}),yi={fillExtrusion:e=>({u_matrix:new t.a6(e),u_lightpos:new t.aq(e),u_lightintensity:new t.aa(e),u_lightcolor:new t.aq(e),u_vertical_gradient:new t.aa(e),u_opacity:new t.aa(e),u_edge_radius:new t.aa(e),u_ao:new t.a8(e),u_tile_id:new t.aq(e),u_zoom_transition:new t.aa(e),u_inv_rot_matrix:new t.a6(e),u_merc_center:new t.a8(e),u_up_dir:new t.aq(e),u_height_lift:new t.aa(e),u_flood_light_color:new t.aq(e),u_vertical_scale:new t.aa(e),u_flood_light_intensity:new t.aa(e),u_ground_shadow_factor:new t.aq(e),u_emissive_strength:new t.aa(e)}),fillExtrusionDepth:e=>({u_matrix:new t.a6(e),u_edge_radius:new t.aa(e),u_vertical_scale:new t.aa(e)}),fillExtrusionPattern:e=>({u_matrix:new t.a6(e),u_lightpos:new t.aq(e),u_lightintensity:new t.aa(e),u_lightcolor:new t.aq(e),u_vertical_gradient:new t.aa(e),u_height_factor:new t.aa(e),u_edge_radius:new t.aa(e),u_ao:new t.a8(e),u_tile_id:new t.aq(e),u_zoom_transition:new t.aa(e),u_inv_rot_matrix:new t.a6(e),u_merc_center:new t.a8(e),u_up_dir:new t.aq(e),u_height_lift:new t.aa(e),u_image:new t.a7(e),u_texsize:new t.a8(e),u_pixel_coord_upper:new t.a8(e),u_pixel_coord_lower:new t.a8(e),u_tile_units_to_pixels:new t.aa(e),u_opacity:new t.aa(e)}),fillExtrusionGroundEffect:e=>({u_matrix:new t.a6(e),u_opacity:new t.aa(e),u_ao_pass:new t.aa(e),u_meter_to_tile:new t.aa(e),u_ao:new t.a8(e),u_flood_light_intensity:new t.aa(e),u_flood_light_color:new t.aq(e),u_attenuation:new t.aa(e),u_edge_radius:new t.aa(e),u_fb:new t.a7(e),u_fb_size:new t.aa(e)}),fill:e=>({u_matrix:new t.a6(e),u_emissive_strength:new t.aa(e)}),fillPattern:e=>({u_matrix:new t.a6(e),u_emissive_strength:new t.aa(e),u_image:new t.a7(e),u_texsize:new t.a8(e),u_pixel_coord_upper:new t.a8(e),u_pixel_coord_lower:new t.a8(e),u_tile_units_to_pixels:new t.aa(e)}),fillOutline:e=>({u_matrix:new t.a6(e),u_emissive_strength:new t.aa(e),u_world:new t.a8(e)}),fillOutlinePattern:e=>({u_matrix:new t.a6(e),u_emissive_strength:new t.aa(e),u_world:new t.a8(e),u_image:new t.a7(e),u_texsize:new t.a8(e),u_pixel_coord_upper:new t.a8(e),u_pixel_coord_lower:new t.a8(e),u_tile_units_to_pixels:new t.aa(e)}),circle:t.bI,collisionBox:e=>({u_matrix:new t.a6(e),u_camera_to_center_distance:new t.aa(e),u_extrude_scale:new t.a8(e)}),collisionCircle:e=>({u_matrix:new t.a6(e),u_inv_matrix:new t.a6(e),u_camera_to_center_distance:new t.aa(e),u_viewport_size:new t.a8(e)}),debug:e=>({u_color:new t.a9(e),u_matrix:new t.a6(e),u_overlay:new t.a7(e),u_overlay_scale:new t.aa(e)}),clippingMask:e=>({u_matrix:new t.a6(e)}),heatmap:e=>({u_extrude_scale:new t.aa(e),u_intensity:new t.aa(e),u_matrix:new t.a6(e),u_inv_rot_matrix:new t.a6(e),u_merc_center:new t.a8(e),u_tile_id:new t.aq(e),u_zoom_transition:new t.aa(e),u_up_dir:new t.aq(e)}),heatmapTexture:e=>({u_image:new t.a7(e),u_color_ramp:new t.a7(e),u_opacity:new t.aa(e)}),hillshade:e=>({u_matrix:new t.a6(e),u_image:new t.a7(e),u_latrange:new t.a8(e),u_light:new t.a8(e),u_shadow:new t.a9(e),u_highlight:new t.a9(e),u_emissive_strength:new t.aa(e),u_accent:new t.a9(e)}),hillshadePrepare:e=>({u_matrix:new t.a6(e),u_image:new t.a7(e),u_dimension:new t.a8(e),u_zoom:new t.aa(e)}),line:t.bJ,linePattern:t.bK,raster:e=>({u_matrix:new t.a6(e),u_normalize_matrix:new t.a6(e),u_globe_matrix:new t.a6(e),u_merc_matrix:new t.a6(e),u_grid_matrix:new t.ar(e),u_tl_parent:new t.a8(e),u_scale_parent:new t.aa(e),u_fade_t:new t.aa(e),u_opacity:new t.aa(e),u_image0:new t.a7(e),u_image1:new t.a7(e),u_brightness_low:new t.aa(e),u_brightness_high:new t.aa(e),u_saturation_factor:new t.aa(e),u_contrast_factor:new t.aa(e),u_spin_weights:new t.aq(e),u_perspective_transform:new t.a8(e),u_raster_elevation:new t.aa(e),u_zoom_transition:new t.aa(e),u_merc_center:new t.a8(e),u_cutoff_params:new t.as(e),u_colorization_mix:new t.as(e),u_colorization_offset:new t.aa(e),u_color_ramp:new t.a7(e),u_texture_offset:new t.a8(e),u_texture_res:new t.a8(e),u_emissive_strength:new t.aa(e)}),rasterParticle:e=>({u_matrix:new t.a6(e),u_normalize_matrix:new t.a6(e),u_globe_matrix:new t.a6(e),u_merc_matrix:new t.a6(e),u_grid_matrix:new t.ar(e),u_tl_parent:new t.a8(e),u_scale_parent:new t.aa(e),u_fade_t:new t.aa(e),u_opacity:new t.aa(e),u_image0:new t.a7(e),u_image1:new t.a7(e),u_raster_elevation:new t.aa(e),u_zoom_transition:new t.aa(e),u_merc_center:new t.a8(e),u_cutoff_params:new t.as(e)}),rasterParticleTexture:e=>({u_texture:new t.a7(e),u_opacity:new t.aa(e)}),rasterParticleDraw:e=>({u_particle_texture:new t.a7(e),u_particle_texture_side_len:new t.aa(e),u_tile_offset:new t.a8(e),u_velocity:new t.a7(e),u_color_ramp:new t.a7(e),u_velocity_res:new t.a8(e),u_max_speed:new t.aa(e),u_uv_offset:new t.a8(e),u_data_scale:new t.a8(e),u_data_offset:new t.aa(e),u_particle_pos_scale:new t.aa(e),u_particle_pos_offset:new t.a8(e)}),rasterParticleUpdate:e=>({u_particle_texture:new t.a7(e),u_particle_texture_side_len:new t.aa(e),u_velocity:new t.a7(e),u_velocity_res:new t.a8(e),u_max_speed:new t.aa(e),u_speed_factor:new t.aa(e),u_reset_rate:new t.aa(e),u_rand_seed:new t.aa(e),u_uv_offset:new t.a8(e),u_data_scale:new t.a8(e),u_data_offset:new t.aa(e),u_particle_pos_scale:new t.aa(e),u_particle_pos_offset:new t.a8(e)}),symbolIcon:e=>({u_is_size_zoom_constant:new t.a7(e),u_is_size_feature_constant:new t.a7(e),u_size_t:new t.aa(e),u_size:new t.aa(e),u_camera_to_center_distance:new t.aa(e),u_rotate_symbol:new t.a7(e),u_aspect_ratio:new t.aa(e),u_fade_change:new t.aa(e),u_matrix:new t.a6(e),u_label_plane_matrix:new t.a6(e),u_coord_matrix:new t.a6(e),u_is_text:new t.a7(e),u_pitch_with_map:new t.a7(e),u_texsize:new t.a8(e),u_tile_id:new t.aq(e),u_zoom_transition:new t.aa(e),u_inv_rot_matrix:new t.a6(e),u_merc_center:new t.a8(e),u_camera_forward:new t.aq(e),u_tile_matrix:new t.a6(e),u_up_vector:new t.aq(e),u_ecef_origin:new t.aq(e),u_texture:new t.a7(e),u_icon_transition:new t.aa(e),u_color_adj_mat:new t.a6(e)}),symbolSDF:e=>({u_is_size_zoom_constant:new t.a7(e),u_is_size_feature_constant:new t.a7(e),u_size_t:new t.aa(e),u_size:new t.aa(e),u_camera_to_center_distance:new t.aa(e),u_rotate_symbol:new t.a7(e),u_aspect_ratio:new t.aa(e),u_fade_change:new t.aa(e),u_matrix:new t.a6(e),u_label_plane_matrix:new t.a6(e),u_coord_matrix:new t.a6(e),u_is_text:new t.a7(e),u_pitch_with_map:new t.a7(e),u_texsize:new t.a8(e),u_texture:new t.a7(e),u_gamma_scale:new t.aa(e),u_device_pixel_ratio:new t.aa(e),u_tile_id:new t.aq(e),u_zoom_transition:new t.aa(e),u_inv_rot_matrix:new t.a6(e),u_merc_center:new t.a8(e),u_camera_forward:new t.aq(e),u_tile_matrix:new t.a6(e),u_up_vector:new t.aq(e),u_ecef_origin:new t.aq(e),u_is_halo:new t.a7(e)}),symbolTextAndIcon:e=>({u_is_size_zoom_constant:new t.a7(e),u_is_size_feature_constant:new t.a7(e),u_size_t:new t.aa(e),u_size:new t.aa(e),u_camera_to_center_distance:new t.aa(e),u_rotate_symbol:new t.a7(e),u_aspect_ratio:new t.aa(e),u_fade_change:new t.aa(e),u_matrix:new t.a6(e),u_label_plane_matrix:new t.a6(e),u_coord_matrix:new t.a6(e),u_is_text:new t.a7(e),u_pitch_with_map:new t.a7(e),u_texsize:new t.a8(e),u_texsize_icon:new t.a8(e),u_texture:new t.a7(e),u_texture_icon:new t.a7(e),u_gamma_scale:new t.aa(e),u_device_pixel_ratio:new t.aa(e),u_is_halo:new t.a7(e)}),background:e=>({u_matrix:new t.a6(e),u_emissive_strength:new t.aa(e),u_opacity:new t.aa(e),u_color:new t.a9(e)}),backgroundPattern:e=>({u_matrix:new t.a6(e),u_emissive_strength:new t.aa(e),u_opacity:new t.aa(e),u_image:new t.a7(e),u_pattern_tl:new t.a8(e),u_pattern_br:new t.a8(e),u_texsize:new t.a8(e),u_pattern_size:new t.a8(e),u_pixel_coord_upper:new t.a8(e),u_pixel_coord_lower:new t.a8(e),u_tile_units_to_pixels:new t.aa(e)}),terrainRaster:e=>({u_matrix:new t.a6(e),u_image0:new t.a7(e),u_skirt_height:new t.aa(e),u_ground_shadow_factor:new t.aq(e)}),skybox:e=>({u_matrix:new t.a6(e),u_sun_direction:new t.aq(e),u_cubemap:new t.a7(e),u_opacity:new t.aa(e),u_temporal_offset:new t.aa(e)}),skyboxGradient:e=>({u_matrix:new t.a6(e),u_color_ramp:new t.a7(e),u_center_direction:new t.aq(e),u_radius:new t.aa(e),u_opacity:new t.aa(e),u_temporal_offset:new t.aa(e)}),skyboxCapture:e=>({u_matrix_3f:new t.ar(e),u_sun_direction:new t.aq(e),u_sun_intensity:new t.aa(e),u_color_tint_r:new t.as(e),u_color_tint_m:new t.as(e),u_luminance:new t.aa(e)}),globeRaster:e=>({u_proj_matrix:new t.a6(e),u_globe_matrix:new t.a6(e),u_normalize_matrix:new t.a6(e),u_merc_matrix:new t.a6(e),u_zoom_transition:new t.aa(e),u_merc_center:new t.a8(e),u_image0:new t.a7(e),u_grid_matrix:new t.ar(e),u_skirt_height:new t.aa(e),u_far_z_cutoff:new t.aa(e),u_frustum_tl:new t.aq(e),u_frustum_tr:new t.aq(e),u_frustum_br:new t.aq(e),u_frustum_bl:new t.aq(e),u_globe_pos:new t.aq(e),u_globe_radius:new t.aa(e),u_viewport:new t.a8(e)}),globeAtmosphere:e=>({u_frustum_tl:new t.aq(e),u_frustum_tr:new t.aq(e),u_frustum_br:new t.aq(e),u_frustum_bl:new t.aq(e),u_horizon:new t.aa(e),u_transition:new t.aa(e),u_fadeout_range:new t.aa(e),u_color:new t.as(e),u_high_color:new t.as(e),u_space_color:new t.as(e),u_temporal_offset:new t.aa(e),u_horizon_angle:new t.aa(e)}),model:e=>({u_matrix:new t.a6(e),u_lighting_matrix:new t.a6(e),u_normal_matrix:new t.a6(e),u_node_matrix:new t.a6(e),u_lightpos:new t.aq(e),u_lightintensity:new t.aa(e),u_lightcolor:new t.aq(e),u_camera_pos:new t.aq(e),u_opacity:new t.aa(e),u_baseColorFactor:new t.as(e),u_emissiveFactor:new t.as(e),u_metallicFactor:new t.aa(e),u_roughnessFactor:new t.aa(e),u_baseTextureIsAlpha:new t.a7(e),u_alphaMask:new t.a7(e),u_alphaCutoff:new t.aa(e),u_baseColorTexture:new t.a7(e),u_metallicRoughnessTexture:new t.a7(e),u_normalTexture:new t.a7(e),u_occlusionTexture:new t.a7(e),u_emissionTexture:new t.a7(e),u_lutTexture:new t.a7(e),u_color_mix:new t.as(e),u_aoIntensity:new t.aa(e),u_emissive_strength:new t.aa(e),u_occlusionTextureTransform:new t.as(e)}),modelDepth:e=>({u_matrix:new t.a6(e),u_instance:new t.a6(e),u_node_matrix:new t.a6(e)}),groundShadow:e=>({u_matrix:new t.a6(e),u_ground_shadow_factor:new t.aq(e)}),stars:e=>({u_matrix:new t.a6(e),u_up:new t.aq(e),u_right:new t.aq(e),u_intensity_multiplier:new t.aa(e)}),occlusion:e=>({u_matrix:new t.a6(e),u_anchorPos:new t.aq(e),u_screenSizePx:new t.a8(e),u_occluderSizePx:new t.a8(e),u_color:new t.as(e)})};function vi(e,r,i){const n=r.createTileMatrix(e,e.worldSize,i.toUnwrapped());return t.ad.multiply(new Float32Array(16),e.projMatrix,n)}function xi(t,e,r){if(e.projection.name===r.projection.name)return t.projMatrix;const i=r.clone();return i.setProjection(e.projection),vi(i,e.getProjection(),t)}function wi(t,e,r){return e.name===r.projection.name?t.projMatrix:vi(r,e,t)}let bi;function Bi(e,r,i,n,o,a,s){const l=e.context,c=l.gl,u=e.transform,h=e.getOrCreateProgram("collisionBox"),A=[];let p=0,d=0;for(let l=0;l<n.length;l++){const f=n[l],m=r.getTile(f),g=m.getBucket(i);if(!g)continue;const _=xi(f,g,u);let y=_;0===o[0]&&0===o[1]||(y=e.translatePosMatrix(_,m,o,a));const v=s?g.textCollisionBox:g.iconCollisionBox,x=g.collisionCircleArray;if(x.length>0){const e=t.ad.create(),r=y;t.ad.mul(e,g.placementInvProjMatrix,u.glCoordMatrix),t.ad.mul(e,e,g.placementViewportMatrix),A.push({circleArray:x,circleOffset:d,transform:r,invTransform:e,projection:g.getProjection()}),p+=x.length/4,d=p}v&&(e.terrain&&e.terrain.setupElevationDraw(m,h),h.draw(e,c.LINES,t.ae.disabled,t.ag.disabled,e.colorModeForRenderPass(),t.af.disabled,$r(y,u,m,g.getProjection()),i.id,v.layoutVertexBuffer,v.indexBuffer,v.segments,null,u.zoom,null,[v.collisionVertexBuffer,v.collisionVertexBufferExt]))}if(!s||!A.length)return;const f=e.getOrCreateProgram("collisionCircle"),m=new t.bL;m.resize(4*p),m._trim();let g=0;for(const t of A)for(let e=0;e<t.circleArray.length/4;e++){const r=4*e,i=t.circleArray[r+0],n=t.circleArray[r+1],o=t.circleArray[r+2],a=t.circleArray[r+3];m.emplace(g++,i,n,o,a,0),m.emplace(g++,i,n,o,a,1),m.emplace(g++,i,n,o,a,2),m.emplace(g++,i,n,o,a,3)}(!bi||bi.length<2*p)&&(bi=function(e){const r=2*e,i=new t.bu;i.resize(r),i._trim();for(let t=0;t<r;t++){const e=6*t;i.uint16[e+0]=4*t+0,i.uint16[e+1]=4*t+1,i.uint16[e+2]=4*t+2,i.uint16[e+3]=4*t+2,i.uint16[e+4]=4*t+3,i.uint16[e+5]=4*t+0}return i}(p));const _=l.createIndexBuffer(bi,!0),y=l.createVertexBuffer(m,t.bM.members,!0);for(const r of A){const n={u_matrix:r.transform,u_inv_matrix:r.invTransform,u_camera_to_center_distance:(v=u).getCameraToCenterDistance(r.projection),u_viewport_size:[v.width,v.height]};f.draw(e,c.TRIANGLES,t.ae.disabled,t.ag.disabled,e.colorModeForRenderPass(),t.af.disabled,n,i.id,y,_,t.b.simpleSegment(0,2*r.circleOffset,r.circleArray.length,r.circleArray.length/2),null,u.zoom)}var v;y.destroy(),_.destroy()}const Ci=t.ad.create();function Ei(e){const r=e._camera.getWorldToCamera(e.worldSize,1),i=t.ad.multiply([],r,e.globeMatrix);t.ad.invert(i,i);const n=[0,0,0],o=[0,1,0,0];return t.aA.transformMat4(o,o,i),n[0]=o[0],n[1]=o[1],n[2]=o[2],t._.normalize(n,n),n}function Ti({width:e,height:r,anchor:i,textOffset:n,textScale:o},a){const{horizontalAlign:s,verticalAlign:l}=t.bQ(i),c=-(s-.5)*e,u=-(l-.5)*r,h=t.bP(i,n);return new t.P((c/o+h[0])*a,(u/o+h[1])*a)}function Ii(e,r,i,n,o,a,s,l,c,u,h){const A=e.text.placedSymbolArray,p=e.text.dynamicLayoutVertexArray,d=e.icon.dynamicLayoutVertexArray,f={},m=e.getProjection(),g=wi(l,m,a),_=a.elevation,y=m.upVectorScale(l.canonical,a.center.lat,a.worldSize).metersToTile;p.clear();for(let d=0;d<A.length;d++){const v=A.get(d),{tileAnchorX:x,tileAnchorY:w,numGlyphs:b}=v,B=v.hidden||!v.crossTileID||e.allowVerticalPlacement&&!v.placedOrientation?null:n[v.crossTileID];if(B){let n=0,A=0,d=0;if(_){const t=_?_.getAtTileOffset(l,x,w):0,[e,r,i]=m.upVector(l.canonical,x,w);n=t*e*y,A=t*r*y,d=t*i*y}let[C,E,T,I]=Je(v.projectedAnchorX+n,v.projectedAnchorY+A,v.projectedAnchorZ+d,i?g:s);const S=tr(a.getCameraToCenterDistance(m),I);let M=o.evaluateSizeForFeature(e.textSizeData,u,v)*S/t.bN;i&&(M*=e.tilePixelRatio/c);const F=Ti(B,M);i?(({x:C,y:E,z:T}=m.projectTilePoint(x+F.x,w+F.y,l.canonical)),[C,E,T]=Je(C+n,E+A,T+d,s)):(r&&F._rotate(-a.angle),C+=F.x,E+=F.y,T=0);const P=e.allowVerticalPlacement&&v.placedOrientation===t.aE.vertical?Math.PI/2:0;for(let e=0;e<b;e++)t.aH(p,C,E,T,P);h&&v.associatedIconIndex>=0&&(f[v.associatedIconIndex]={x:C,y:E,z:T,angle:P})}else cr(b,p)}if(h){d.clear();const r=e.icon.placedSymbolArray;for(let e=0;e<r.length;e++){const i=r.get(e),{numGlyphs:n}=i,o=f[e];if(i.hidden||!o)cr(n,d);else{const{x:e,y:r,z:i,angle:a}=o;for(let o=0;o<n;o++)t.aH(d,e,r,i,a)}}e.icon.dynamicLayoutVertexBuffer.updateData(d)}e.text.dynamicLayoutVertexBuffer.updateData(p)}function Si(e,r,i,n,o,a,s={}){const l=i.paint.get("icon-translate"),c=i.paint.get("text-translate"),u=i.paint.get("icon-translate-anchor"),h=i.paint.get("text-translate-anchor"),A=i.layout.get("icon-rotation-alignment"),p=i.layout.get("text-rotation-alignment"),d=i.layout.get("icon-pitch-alignment"),f=i.layout.get("text-pitch-alignment"),m=i.layout.get("icon-keep-upright"),g=i.layout.get("text-keep-upright"),_=i.paint.get("icon-color-saturation"),y=i.paint.get("icon-color-contrast"),v=i.paint.get("icon-color-brightness-min"),x=i.paint.get("icon-color-brightness-max"),w=i.paint.get("icon-occlusion-opacity").constantOr(0),b=i.paint.get("text-occlusion-opacity").constantOr(0),B=e.context,C=B.gl,E=e.transform,T="map"===A,I="map"===p,S="map"===d,M="map"===f,F=1!==w,P=1!==b,L=void 0!==i.layout.get("symbol-sort-key").constantOr(1);let D=!1;const U=e.depthModeForSublayer(0,t.ae.ReadOnly),k=[t.aj(E.center.lng),t.ak(E.center.lat)],z=i.layout.get("text-variable-anchor"),R="globe"===E.projection.name,O=[],Q=[0,-1,0];for(const o of n){const n=r.getTile(o),a=n.getBucket(i);if(!a)continue;if("mercator"===a.projection.name&&R)continue;if(a.fullyClipped)continue;const A="globe"===a.projection.name,p=A?t.a1(E.zoom):0,d=wi(o,a.getProjection(),E),f=E.calculatePixelsToTileUnitsMatrix(n),w=z&&a.hasTextData(),b=a.hasIconTextFit()&&w&&a.hasIconData(),B=a.getProjection().createInversionMatrix(E,o.canonical),U=()=>{const r=T&&"point"!==i.layout.get("symbol-placement"),s=[];i.hasInitialOcclusionOpacityProperties&&F&&e.symbolParams.useOcclusionQueries&&!A&&!R&&s.push("OCCLUSION_QUERIES"),i.hasInitialOcclusionOpacityProperties||s.push("SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH");const c=r||b,h=i.paint.get("icon-image-cross-fade").constantOr(0);e.terrainRenderModeElevated()&&S&&s.push("PITCH_WITH_MAP_TERRAIN"),A&&(s.push("PROJECTION_GLOBE_VIEW"),c&&s.push("PROJECTED_POS_ON_VIEWPORT")),h>0&&s.push("ICON_TRANSITION"),a.icon.zOffsetVertexBuffer&&s.push("Z_OFFSET"),s.push("TERRAIN_DEPTH_D24"),0===_&&0===y&&0===v&&1===x||s.push("COLOR_ADJUSTMENT");const g=a.icon.programConfigurations.get(i.id),w=e.getOrCreateProgram(a.sdfIcons?"symbolSDF":"symbolIcon",{config:g,defines:s});let I;const M=n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],P=a.iconSizeData,L=t.aD(P,E.zoom),D=S||0!==E.pitch,U=Xe(d,n.tileID.canonical,S,T,E,a.getProjection(),f),z=Ye(d,n.tileID.canonical,S,T,E,a.getProjection(),f),O=e.translatePosMatrix(z,n,l,u,!0),N=e.translatePosMatrix(d,n,l,u),V=c?Ci:U,H=T&&!S&&!r;let j=Q;!R&&!E.mercatorFromTransition||T||(j=Ei(E));const G=A?j:Q;if(a.sdfIcons&&!a.iconsInText)I=hi(P.kind,L,H,S,e,N,V,O,!1,M,!0,o,p,k,B,G,a.getProjection());else{const t=i.getColorAdjustmentMatrix(_,y,v,x);I=ui(P.kind,L,H,S,e,N,V,O,!1,M,o,p,k,B,G,a.getProjection(),t,h)}const K=n.imageAtlasTexture?n.imageAtlasTexture:null,q=1!==i.layout.get("icon-size").constantOr(0)||a.iconsNeedLinear,Z=a.sdfIcons||e.options.rotating||e.options.zooming||q||D?C.LINEAR:C.NEAREST,W=a.sdfIcons&&0!==i.paint.get("icon-halo-width").constantOr(1),X=e.terrain&&S&&r?t.ad.invert(t.ad.create(),U):Ci;if(r&&a.icon){const t=E.elevation,r=t?t.getAtTileOffsetFunc(o,E.center.lat,E.worldSize,a.getProjection()):null,i=$e(d,n.tileID.canonical,S,T,E,a.getProjection(),f);rr(a,d,e,!1,i,z,S,m,r,o)}return{program:w,buffers:a.icon,uniformValues:I,atlasTexture:K,atlasTextureIcon:null,atlasInterpolation:Z,atlasInterpolationIcon:null,isSDF:a.sdfIcons,hasHalo:W,tile:n,labelPlaneMatrixInv:X}},N=()=>{const r=I&&"point"!==i.layout.get("symbol-placement"),s=[],l=r||z||b;i.hasInitialOcclusionOpacityProperties&&P&&e.symbolParams.useOcclusionQueries&&!A&&!R&&s.push("OCCLUSION_QUERIES"),i.hasInitialOcclusionOpacityProperties||s.push("SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH"),e.terrainRenderModeElevated()&&M&&s.push("PITCH_WITH_MAP_TERRAIN"),A&&(s.push("PROJECTION_GLOBE_VIEW"),l&&s.push("PROJECTED_POS_ON_VIEWPORT")),a.text.zOffsetVertexBuffer&&s.push("Z_OFFSET"),s.push("TERRAIN_DEPTH_D24");const u=a.text.programConfigurations.get(i.id),m=e.getOrCreateProgram(a.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:u,defines:s});let _,y=[0,0],v=null;const x=a.textSizeData;a.iconsInText&&(y=n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],v=n.imageAtlasTexture?n.imageAtlasTexture:null,_=M||0!==E.pitch||e.options.rotating||e.options.zooming||"composite"===x.kind||"camera"===x.kind?C.LINEAR:C.NEAREST);const w=n.glyphAtlasTexture?n.glyphAtlasTexture.size:[0,0],T=t.aD(x,E.zoom),S=Xe(d,n.tileID.canonical,M,I,E,a.getProjection(),f),F=Ye(d,n.tileID.canonical,M,I,E,a.getProjection(),f),L=e.translatePosMatrix(F,n,c,h,!0),D=e.translatePosMatrix(d,n,c,h),U=l?Ci:S,O=I&&!M&&!r;let N=Q;!R&&!E.mercatorFromTransition||I||(N=Ei(E));const V=A?N:Q;let H;H=a.iconsInText?Ai(x.kind,T,O,M,e,D,U,L,w,y,o,p,k,B,V,a.getProjection()):hi(x.kind,T,O,M,e,D,U,L,!0,w,!0,o,p,k,B,V,a.getProjection());const j=n.glyphAtlasTexture?n.glyphAtlasTexture:null,G=C.LINEAR,K=0!==i.paint.get("text-halo-width").constantOr(1),q=e.terrain&&M&&r?t.ad.invert(t.ad.create(),S):Ci;if(r&&a.text){const t=E.elevation,r=t?t.getAtTileOffsetFunc(o,E.center.lat,E.worldSize,a.getProjection()):null,i=$e(d,n.tileID.canonical,M,I,E,a.getProjection(),f);rr(a,d,e,!0,i,F,M,g,r,o)}return{program:m,buffers:a.text,uniformValues:H,atlasTexture:j,atlasTextureIcon:v,atlasInterpolation:G,atlasInterpolationIcon:_,isSDF:!0,hasHalo:K,tile:n,labelPlaneMatrixInv:q}},V=a.icon.segments.get().length,H=a.text.segments.get().length,j=V&&!s.onlyText?U():null,G=H&&!s.onlyIcons?N():null,K=i.paint.get("icon-opacity").constantOr(1),q=i.paint.get("text-opacity").constantOr(1);if(L&&a.canOverlap){D=!0;const e=K&&!s.onlyText?a.icon.segments.get():[],r=q&&!s.onlyIcons?a.text.segments.get():[];for(const r of e)O.push({segments:new t.b([r]),sortKey:r.sortKey,state:j});for(const e of r)O.push({segments:new t.b([e]),sortKey:e.sortKey,state:G})}else s.onlyText||O.push({segments:K?a.icon.segments:new t.b([]),sortKey:0,state:j}),s.onlyIcons||O.push({segments:q?a.text.segments:new t.b([]),sortKey:0,state:G})}D&&O.sort(((t,e)=>t.sortKey-e.sortKey));for(const t of O){const r=t.state;if(r)if(e.terrain&&e.terrain.setupElevationDraw(r.tile,r.program,{useDepthForOcclusion:!i.hasInitialOcclusionOpacityProperties&&E.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:r.labelPlaneMatrixInv}),B.activeTexture.set(C.TEXTURE0),r.atlasTexture&&r.atlasTexture.bind(r.atlasInterpolation,C.CLAMP_TO_EDGE,!0),r.atlasTextureIcon&&(B.activeTexture.set(C.TEXTURE1),r.atlasTextureIcon&&r.atlasTextureIcon.bind(r.atlasInterpolationIcon,C.CLAMP_TO_EDGE,!0)),e.uploadCommonLightUniforms(e.context,r.program),r.hasHalo){const n=r.uniformValues;n.u_is_halo=1,Mi(r.buffers,t.segments,i,e,r.program,U,o,a,n,2),n.u_is_halo=0}else{if(r.isSDF){const n=r.uniformValues;r.hasHalo&&(n.u_is_halo=1,Mi(r.buffers,t.segments,i,e,r.program,U,o,a,n,1)),n.u_is_halo=0}Mi(r.buffers,t.segments,i,e,r.program,U,o,a,r.uniformValues,1)}}}function Mi(e,r,i,n,o,a,s,l,c,u){const h=n.context.gl,A=[e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer,e.iconTransitioningVertexBuffer,e.globeExtVertexBuffer,e.zOffsetVertexBuffer];e.occlusionQueryOpacityVertexBuffer.length>0&&A.push(e.occlusionQueryOpacityVertexBuffer),o.draw(n,h.TRIANGLES,a,s,l,t.af.disabled,c,i.id,e.layoutVertexBuffer,e.indexBuffer,r,i.paint,n.transform.zoom,e.programConfigurations.get(i.id),A,u)}function Fi(e,r,i,n,o,a,s){const l=e.context.gl,c=i.paint.get("fill-pattern"),u=c&&c.constantOr(1);let h,A,p,d,f;s?(A=u&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",h=l.LINES):(A=u?"fillPattern":"fill",h=l.TRIANGLES);for(const m of n){const n=r.getTile(m);if(u&&!n.patternsLoaded())continue;const g=n.getBucket(i);if(!g)continue;e.prepareDrawTile();const _=g.programConfigurations.get(i.id),y=e.isTileAffectedByFog(m),v=e.getOrCreateProgram(A,{config:_,overrideFog:y});u&&(e.context.activeTexture.set(l.TEXTURE0),n.imageAtlasTexture&&n.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),_.updatePaintBuffers());const x=c.constantOr(null);if(x&&n.imageAtlas){const t=n.imageAtlas.patternPositions[x.toString()];t&&_.setConstantPatternPositions(t)}const w=e.translatePosMatrix(m.projMatrix,n,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor")),b=i.paint.get("fill-emissive-strength");if(s){d=g.indexBuffer2,f=g.segments2;const t=e.terrain&&e.terrain.renderingToTexture?e.terrain.drapeBufferSize:[l.drawingBufferWidth,l.drawingBufferHeight];p="fillOutlinePattern"===A&&u?Xr(w,b,e,n,t):Wr(w,b,t)}else d=g.indexBuffer,f=g.segments,p=u?Zr(w,b,e,n):qr(w,b);e.uploadCommonUniforms(e.context,v,m.toUnwrapped()),v.draw(e,h,o,e.stencilModeForClipping(m),a,t.af.disabled,p,i.id,g.layoutVertexBuffer,d,f,i.paint,e.transform.zoom,_,void 0)}}function Pi(e,r,i,n,o,a,s,l){i.resetLayerRenderingStats(e);const c=e.context,u=c.gl,h=e.transform,A=i.paint.get("fill-extrusion-pattern"),p=A.constantOr(1),d=i.paint.get("fill-extrusion-opacity"),f=e.style.enable3dLights(),m=i.paint.get(f&&!p?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),g=[i.paint.get("fill-extrusion-ambient-occlusion-intensity"),m],_=i.layout.get("fill-extrusion-edge-radius"),y=_>0&&!i.paint.get("fill-extrusion-rounded-roof"),v=y?0:_,x="globe"===h.projection.name?t.bY():0,w="globe"===h.projection.name,b=w?t.a1(h.zoom):0,B=[t.aj(h.center.lng),t.ak(h.center.lat)],C=i.paint.get("fill-extrusion-flood-light-color").toRenderColor(i.lut).toArray01().slice(0,3),E=i.paint.get("fill-extrusion-flood-light-intensity"),T=i.paint.get("fill-extrusion-vertical-scale"),I=fr(e,i.paint.get("fill-extrusion-cutoff-fade-range")),S=i.paint.get("fill-extrusion-emissive-strength"),M=[];let F;w&&M.push("PROJECTION_GLOBE_VIEW"),g[0]>0&&M.push("FAUX_AO"),y&&M.push("ZERO_ROOF_RADIUS"),l&&M.push("HAS_CENTROID"),E>0&&M.push("FLOOD_LIGHT"),I.shouldRenderCutoff&&M.push("RENDER_CUTOFF");const P="shadow"===e.renderPass,L=e.shadowRenderer,D=P&&!!L;e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!0);let U=[0,0,0];if(L){const t=e.style.directionalLight,r=e.style.ambientLight;t&&r&&(U=wr(e.style,t,r)),F=M.concat(["SHADOWS_SINGLE_CASCADE"])}const k=D?"fillExtrusionDepth":p?"fillExtrusionPattern":"fillExtrusion",z=i.getLayerRenderingStats();for(const f of n){const n=r.getTile(f),m=n.getBucket(i);if(!m||m.projection.name!==h.projection.name)continue;let _=!1;L&&(_=0===L.getMaxCascadeForTile(f.toUnwrapped()));const y=e.isTileAffectedByFog(f),D=m.programConfigurations.get(i.id),R=e.getOrCreateProgram(k,{config:D,defines:_?F:M,overrideFog:y});if(e.terrain&&e.terrain.setupElevationDraw(n,R,{useMeterToDem:!0}),!m.centroidVertexBuffer){const t=R.attributes.a_centroid_pos;void 0!==t&&u.vertexAttrib2f(t,0,0)}!P&&L&&L.setupShadows(n.tileID.toUnwrapped(),R,"vector-tile",n.tileID.overscaledZ),p&&(e.context.activeTexture.set(u.TEXTURE0),n.imageAtlasTexture&&n.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),D.updatePaintBuffers());const O=A.constantOr(null);if(O&&n.imageAtlas){const t=n.imageAtlas.patternPositions[O.toString()];t&&D.setConstantPatternPositions(t)}const Q=i.paint.get("fill-extrusion-vertical-gradient");let N;if(P&&L){if(Ri(n.tileID,m,e))continue;const t=L.calculateShadowPassMatrixFromTile(n.tileID.toUnwrapped());N=Gr(t,v,T)}else{const t=e.translatePosMatrix(f.expandedProjMatrix,n,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),r=h.projection.createInversionMatrix(h,f.canonical);N=p?Kr(t,e,Q,d,g,v,f,n,x,b,B,r,C,T):jr(t,e,Q,d,g,v,f,x,b,B,r,C,T,E,U,S)}e.uploadCommonUniforms(c,R,f.toUnwrapped(),null,I);let V=m.segments;if("mercator"===h.projection.name&&!P&&(V=m.getVisibleSegments(n.tileID,e.terrain,e.transform.getFrustum(0)),!V.get().length))continue;if(z)if(P)for(const t of V.get())z.numRenderedVerticesInShadowPass+=t.primitiveLength;else for(const t of V.get())z.numRenderedVerticesInTransparentPass+=t.primitiveLength;const H=[];(e.terrain||l)&&H.push(m.centroidVertexBuffer),w&&H.push(m.layoutVertexExtBuffer),R.draw(e,c.gl.TRIANGLES,o,a,s,t.af.backCCW,N,i.id,m.layoutVertexBuffer,m.indexBuffer,V,i.paint,e.transform.zoom,D,H)}e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!1)}function Li(e,r,i,n,o,a,s,l,c,u,h,A,p,d,f,m,g,_,y){const v=e.context,x=v.gl,w=e.transform,b=e.transform.zoom,B=[],C=fr(e,i.paint.get("fill-extrusion-cutoff-fade-range"));"clear"===u?(B.push("CLEAR_SUBPASS"),y&&(B.push("CLEAR_FROM_TEXTURE"),v.activeTexture.set(x.TEXTURE0),y.bind(x.LINEAR,x.CLAMP_TO_EDGE))):"sdf"===u&&B.push("SDF_SUBPASS"),g&&B.push("HAS_CENTROID"),C.shouldRenderCutoff&&B.push("RENDER_CUTOFF");const E=i.layout.get("fill-extrusion-edge-radius"),T=(t,r,n,u,_)=>{const x=r.programConfigurations.get(i.id),w=e.isTileAffectedByFog(t),T=e.getOrCreateProgram("fillExtrusionGroundEffect",{config:x,defines:B,overrideFog:w}),I=((t,e,r,i,n,o,a,s,l,c,u)=>({u_matrix:e,u_opacity:r,u_ao_pass:i?1:0,u_meter_to_tile:n,u_ao:o,u_flood_light_intensity:a,u_flood_light_color:s,u_attenuation:l,u_edge_radius:c,u_fb:0,u_fb_size:u}))(0,u,h,c,_,[A,p*_],d,f,m,b>=17?0:E*_,y?y.size[0]:0),S=[];g&&S.push(r.hiddenByLandmarkVertexBuffer),e.uploadCommonUniforms(v,T,t.toUnwrapped(),null,C),T.draw(e,v.gl.TRIANGLES,o,a,s,l,I,i.id,r.vertexBuffer,r.indexBuffer,n,i.paint,b,x,S)};for(const o of n){const n=r.getTile(o),a=n.getBucket(i);if(!a||a.projection.name!==w.projection.name||!a.groundEffect||a.groundEffect&&!a.groundEffect.hasData())continue;const s=a.groundEffect,l=1/a.tileToMeter;{const t=e.translatePosMatrix(o.projMatrix,n,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),r=s.getDefaultSegment();T(o,s,r,t,l)}if(_)for(let a=0;a<4;a++){const s=t.bZ[a](o),c=r.getTile(s);if(!c)continue;const u=c.getBucket(i);if(!u||u.projection.name!==w.projection.name||!u.groundEffect||u.groundEffect&&!u.groundEffect.hasData())continue;const h=u.groundEffect;let A,p;0===a?(A=[-t.a3,0,0],p=1):1===a?(A=[t.a3,0,0],p=0):2===a?(A=[0,-t.a3,0],p=3):(A=[0,t.a3,0],p=2);const d=h.regionSegments[p];if(!d)continue;const f=new Float32Array(16);t.ad.translate(f,o.projMatrix,A),T(o,h,d,e.translatePosMatrix(f,n,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),l)}}}function Di(e,r,i,n,o,a,s){0===n.centroidVertexArray.length&&n.createCentroidsBuffer();const l=a?a.findDEMTileFor(i):null;if(!(l&&l.dem||s))return;const c=e=>new t.P(Math.ceil((e+t.c0)*t.c1),0),u=t=>{const e=r.getSource().minzoom,i=t=>{const e=r.getTileByID(t);if(e&&e.hasData())return e.getBucket(o)},n=[0,-1,1];for(const r of n){if(t.overscaledZ+r<e)continue;const n=i(t.calculateScaledKey(t.overscaledZ+r));if(n)return n}},h=[0,0,0],A=(e,r)=>(h[0]=Math.min(e.min.y,r.min.y),h[1]=Math.max(e.max.y,r.max.y),h[2]=t.a3-r.min.x>e.max.x?r.min.x-t.a3:e.max.x,h),p=(e,r)=>(h[0]=Math.min(e.min.x,r.min.x),h[1]=Math.max(e.max.x,r.max.x),h[2]=t.a3-r.min.y>e.max.y?r.min.y-t.a3:e.max.y,h),d=[(t,e)=>A(t,e),(t,e)=>A(e,t),(t,e)=>p(t,e),(t,e)=>p(e,t)],f=(e,r,n,o,s,c,u)=>{if(!a)return 0;const h=[[c?n:e,c?e:n,0],[c?n:r,c?r:n,0]],A=u<0?t.a3+u:u,p=[c?A:(e+r)/2,c?(e+r)/2:A,0];return 0===n&&u<0||0!==n&&u>0?a.getForTilePoints(s,[p],!0,o):h.push(p),a.getForTilePoints(i,h,!0,l),Math.max(h[0][2],h[1][2],p[2])/a.exaggeration()};for(let e=0;e<4;e++){const r=n.borderFeatureIndices[e];if(0===r.length)continue;const o=t.bZ[e](i),l=u(o);if(!(l&&l instanceof t.b_))continue;if(n.borderDoneWithNeighborZ[e]===l.canonical.z)continue;0===l.centroidVertexArray.length&&l.createCentroidsBuffer();const h=a?a.findDEMTileFor(o):null;if(!(h&&h.dem||s))continue;const A=(e<2?1:5)-e,p=l.borderDoneWithNeighborZ[A]!==n.canonical.z,_=l.borderFeatureIndices[A];let y=0;if(n.canonical.z!==l.canonical.z){for(const t of r)n.showCentroid(n.featuresOnBorder[t]);if(p)for(const t of _)l.showCentroid(l.featuresOnBorder[t]);n.borderDoneWithNeighborZ[e]=l.canonical.z,l.borderDoneWithNeighborZ[A]=n.canonical.z}for(const i of r){const r=n.featuresOnBorder[i],a=n.centroidData[r.centroidDataIndex],u=r.borders[e];let p;for(;y<_.length;){p=l.featuresOnBorder[_[y]];const t=p.borders[A];if(t[1]>u[0]+3||t[0]>u[0]-3)break;l.showCentroid(p),y++}if(p&&y<_.length){const i=y;let v=0;for(;!(p.borders[A][0]>u[1]-3)&&(v++,++y!==_.length);)p=l.featuresOnBorder[_[y]];if(p=l.featuresOnBorder[_[i]],v>1){const t=p.borders[A];Math.abs(u[0]-t[0])<3&&Math.abs(u[1]-t[1])<3&&(v=1,y=i+1)}else if(0===v){n.showCentroid(r);continue}const x=l.centroidData[p.centroidDataIndex];s&&1===v&&(((m=a).flags|(g=x).flags)&t.b$?(m.flags|=t.b$,g.flags|=t.b$):(m.flags&=~t.b$,g.flags&=~t.b$));const w=r.intersectsCount()>1||p.intersectsCount()>1;if(v>1)y=i,a.centroidXY=x.centroidXY=new t.P(0,0);else if(h&&h.dem&&!w){const r=d[e](a,x),i=e%2?t.a3-1:0,n=f(r[0],Math.min(t.a3-1,r[1]),i,h,o,e<2,r[2]);a.centroidXY=x.centroidXY=c(n)}else w?a.centroidXY=x.centroidXY=new t.P(0,0):(a.centroidXY=n.encodeBorderCentroid(r),x.centroidXY=l.encodeBorderCentroid(p));n.writeCentroidToBuffer(a),l.writeCentroidToBuffer(x)}else n.showCentroid(r)}n.borderDoneWithNeighborZ[e]=l.canonical.z,l.borderDoneWithNeighborZ[A]=n.canonical.z}var m,g;(n.needsCentroidUpdate||!n.centroidVertexBuffer&&0!==n.centroidVertexArray.length)&&n.uploadCentroid(e)}const Ui=[1,0,0],ki=[0,1,0],zi=[0,0,1];function Ri(e,r,i){const n=i.transform,o=i.shadowRenderer;if(!o)return!0;const a=e.toUnwrapped(),s=n.tileSize*o._cascades[i.currentShadowCascade].scale;let l=r.maxHeight;if(n.elevation){const t=n.elevation.getMinMaxForTile(e);t&&(l+=t.max)}const c=[...o.shadowDirection];c[2]=-c[2];const u=o.computeSimplifiedTileShadowVolume(a,l,s,c);if(!u)return!1;const h=[Ui,ki,zi,c,[c[0],0,c[2]],[0,c[1],c[2]]],A="globe"===n.projection.name,p=n.scaleZoom(s),d=t.aM.fromInvProjectionMatrix(n.invProjMatrix,n.worldSize,p,!A),f=o.getCurrentCascadeFrustum();return 0===d.intersectsPrecise(u.vertices,u.planes,h)||0===f.intersectsPrecise(u.vertices,u.planes,h)}function Oi(e){return[e[0]*t.c2,e[1]*t.c2,e[2]*t.c2,0]}function Qi(e,r,i,n,o,a,s,l,c){const u=n.getSource(),h=i.globeSharedBuffers;if(!h)return;let A,p,d;if(r&&(A=n.getTile(r)),u instanceof t.bm?(p=u.texture,d=t.bh(0,0,i.transform)):A&&r&&(p=A.texture,d=t.bh(r.canonical.z,r.canonical.x,i.transform)),!p||!d)return;e||(d=t.ad.scale(t.ad.create(),d,[1,-1,1]));const f=i.context,m=f.gl,g="nearest"===o.paint.get("raster-resampling")?m.NEAREST:m.LINEAR,_=i.colorModeForDrapableLayerRenderPass(a),y=s.defines;y.push("GLOBE_POLES");const v=new t.ae(m.LEQUAL,t.ae.ReadWrite,i.depthRangeFor3D),x=Float32Array.from(i.transform.expandedFarZProjMatrix),w=Float32Array.from(t.bf(t.bg(new t.aO(0,0,0))));i.terrain&&i.terrain.prepareDrawTile(),f.activeTexture.set(m.TEXTURE0),p.bind(g,m.CLAMP_TO_EDGE),f.activeTexture.set(m.TEXTURE1),p.bind(g,m.CLAMP_TO_EDGE),p.useMipmap&&f.extTextureFilterAnisotropic&&i.transform.pitch>20&&m.texParameterf(m.TEXTURE_2D,f.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,f.extTextureFilterAnisotropicMax);const[b,B,C,E]=r?h.getPoleBuffers(r.canonical.z,!1):h.getPoleBuffers(0,!0),T=o.paint.get("raster-elevation");let I;e?(I=b,i.renderDefaultNorthPole=0!==T):(I=B,i.renderDefaultSouthPole=0!==T);const S=Oi(s.mix),M=((t,e,r,i,n,o,a,s,l,c,u,h,A)=>ii(t,e,r,new Float32Array(16),new Float32Array(9),[0,0],i,[0,0],[0,0,0,0],1,{opacity:1,mix:0},o,[0,0]||[0,0],s,2,c,u,h,1,0,A))(x,w,d,t.a1(i.transform.zoom),0,o,0,T,0,S,s.offset,s.range,a),F=i.getOrCreateProgram("raster",{defines:y});i.uploadCommonUniforms(f,F,null),F.draw(i,m.TRIANGLES,v,c,_,l,M,o.id,I,C,E)}function Ni(t){const e=t._nearZ,r=t.projection.farthestPixelDistance(t),i=r-e,n=.2*t.height,o=e+n;return[e,r,(o-n-e)/i,(o-e)/i]}function Vi(e,r,i,n){if(e)return r instanceof Fr&&e instanceof t.c3?r.getTextureDescriptor(e,i,!0):{texture:e.texture,mix:Oi(n.mix),offset:n.offset,buffer:0,tileSize:1}}function Hi(e,r,i){if(!e)return null;const n=r.getTextureDescriptor(e,i,!0);if(!n)return null;let{texture:o,mix:a,offset:s,tileSize:l,buffer:c,format:u}=n;if(!o||!u)return null;let h=!1;return"uint32"===u&&(h=!0,a[3]=0,a=ei(t.c4,a,[0,i.paint.get("raster-particle-max-speed")]),s=ri(t.c4,s,[0,i.paint.get("raster-particle-max-speed")])),{texture:o,textureOffset:[c/(l+2*c),l/(l+2*c)],tileSize:l,scalarData:h,scale:a,offset:s,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[u]]}}function ji(t){const e=t._nearZ,r=t.projection.farthestPixelDistance(t),i=r-e,n=.2*t.height,o=e+n;return[e,r,(o-n-e)/i,(o-e)/i]}const Gi=new t.C(1,0,0,1),Ki=new t.C(0,1,0,1),qi=new t.C(0,0,1,1),Zi=new t.C(1,0,1,1),Wi=new t.C(0,1,1,1);function Xi(e,r,i,n,o,a,s){const l=e.context,c=e.transform,u=l.gl,h="globe"===c.projection.name,A=h?["PROJECTION_GLOBE_VIEW"]:[];let p=t.ad.clone(i.projMatrix);if(h&&t.a1(c.zoom)>0){const e=t.c5(i.canonical,c),r=t.c6(e);p=t.ad.multiply(new Float32Array(16),c.globeMatrix,r),t.ad.multiply(p,c.projMatrix,p)}const d=t.ad.create();d[12]+=2*o/(t.e.devicePixelRatio*c.width),d[13]+=2*a/(t.e.devicePixelRatio*c.height),t.ad.multiply(p,d,p);const f=e.getOrCreateProgram("debug",{defines:A}),m=r.getTileByID(i.key);e.terrain&&e.terrain.setupElevationDraw(m,f);const g=t.ae.disabled,_=t.ag.disabled,y=e.colorModeForRenderPass(),v="$debug";l.activeTexture.set(u.TEXTURE0),e.emptyTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),h?m._makeGlobeTileDebugBuffers(e.context,c):m._makeDebugTileBoundsBuffers(e.context,c.projection);const x=m._tileDebugBuffer||e.debugBuffer,w=m._tileDebugIndexBuffer||e.debugIndexBuffer,b=m._tileDebugSegments||e.debugSegments;if(f.draw(e,u.LINE_STRIP,g,_,y,t.af.disabled,Yr(p,n),v,x,w,b,null,null,null,[m._globeTileDebugBorderBuffer]),s){const t=m.latestRawTileData,r=Math.floor((t&&t.byteLength||0)/1024);let n=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(n+=` => ${i.overscaledZ}`),n+=` ${m.state}`,n+=` ${r}kb`,function(t,e){t.initDebugOverlayCanvas();const r=t.debugOverlayCanvas,i=t.context.gl,n=t.debugOverlayCanvas.getContext("2d");n.clearRect(0,0,r.width,r.height),n.shadowColor="white",n.shadowBlur=2,n.lineWidth=1.5,n.strokeStyle="white",n.textBaseline="top",n.font="bold 36px Open Sans, sans-serif",n.fillText(e,5,5),n.strokeText(e,5,5),t.debugOverlayTexture.update(r),t.debugOverlayTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}(e,n)}const B=r.getTile(i).tileSize,C=512/Math.min(B,512)*(i.overscaledZ/c.zoom)*.5,E=m._tileDebugTextBuffer||e.debugBuffer,T=m._tileDebugTextIndexBuffer||e.quadTriangleIndexBuffer,I=m._tileDebugTextSegments||e.debugSegments;f.draw(e,u.TRIANGLES,g,_,t.a.alphaBlended,t.af.disabled,Yr(p,t.C.transparent,C),v,E,T,I,null,null,null,[m._globeTileDebugTextBuffer])}function $i(t,e,r,i){Ji(t,0,e+r/2,t.transform.width,r,i)}function Yi(t,e,r,i){Ji(t,e-r/2,0,r,t.transform.height,i)}function Ji(e,r,i,n,o,a){const s=e.context,l=s.gl;l.enable(l.SCISSOR_TEST),l.scissor(r*t.e.devicePixelRatio,i*t.e.devicePixelRatio,n*t.e.devicePixelRatio,o*t.e.devicePixelRatio),s.clear({color:a}),l.disable(l.SCISSOR_TEST)}const tn=t.c7([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:en}=tn;function rn(t,e,r,i){t.emplaceBack(e,r,i)}class nn{constructor(e){this.vertexArray=new t.c8,this.indices=new t.bu,rn(this.vertexArray,-1,-1,1),rn(this.vertexArray,1,-1,1),rn(this.vertexArray,-1,1,1),rn(this.vertexArray,1,1,1),rn(this.vertexArray,-1,-1,-1),rn(this.vertexArray,1,-1,-1),rn(this.vertexArray,-1,1,-1),rn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=e.createVertexBuffer(this.vertexArray,en),this.indexBuffer=e.createIndexBuffer(this.indices),this.segment=t.b.simpleSegment(0,0,36,12)}}function on(e,r,i,n,o,a){const s=e.context.gl,l=r.paint.get("sky-atmosphere-color"),c=r.paint.get("sky-atmosphere-halo-color"),u=r.paint.get("sky-atmosphere-sun-intensity"),h=((t,e,r,i,n)=>({u_matrix_3f:t,u_sun_direction:e,u_sun_intensity:r,u_color_tint_r:[i.r,i.g,i.b,i.a],u_color_tint_m:[n.r,n.g,n.b,n.a],u_luminance:5e-5}))(t.bC.fromMat4(t.bC.create(),n),o,u,l,c);s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+a,r.skyboxTexture,0),i.draw(e,s.TRIANGLES,t.ae.disabled,t.ag.disabled,t.a.unblended,t.af.frontCW,h,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const an=t.c7([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class sn{constructor(e){const r=new t.c9;r.emplaceBack(-1,1,1,0,0),r.emplaceBack(1,1,1,1,0),r.emplaceBack(1,-1,1,1,1),r.emplaceBack(-1,-1,1,0,1);const i=new t.bu;i.emplaceBack(0,1,2),i.emplaceBack(2,3,0),this.vertexBuffer=e.createVertexBuffer(r,an.members),this.indexBuffer=e.createIndexBuffer(i),this.segments=t.b.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const ln=t.c7([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class cn{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class un{constructor(e){this.colorModeAlphaBlendedWriteRGB=new t.a([t.ca,t.cb,t.ca,t.cb],t.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new t.a([t.ca,t.cc,t.ca,t.cc],t.C.transparent,[!1,!1,!1,!0]),this.params=new cn,this.updateNeeded=!0,e.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},(()=>{this.updateNeeded=!0})),e.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),e.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0})),e.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0}))}update(e){const r=e.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new sn(r);const e=this.params.sizeRange,i=this.params.intensityRange,n=function(e){const r=t.cf(30),i=[];for(let n=0;n<e;++n){const e=2*Math.PI*r(),n=Math.acos(1-2*r())-.5*Math.PI;i.push(t._.fromValues(Math.cos(n)*Math.cos(e),Math.cos(n)*Math.sin(e),Math.sin(n)))}return i}(this.params.starsCount),o=t.cf(300),a=new t.cd,s=new t.bu;let l=0;for(let r=0;r<n.length;++r){const c=t._.scale([],n[r],200),u=Math.max(0,1+.01*e*(1*o()-.5)),h=Math.max(0,1+.01*i*(1*o()-.5));a.emplaceBack(c[0],c[1],c[2],-1,-1,u,h),a.emplaceBack(c[0],c[1],c[2],1,-1,u,h),a.emplaceBack(c[0],c[1],c[2],1,1,u,h),a.emplaceBack(c[0],c[1],c[2],-1,1,u,h),s.emplaceBack(l+0,l+1,l+2),s.emplaceBack(l+0,l+2,l+3),l+=4}this.starsVx=r.createVertexBuffer(a,ln.members),this.starsIdx=r.createIndexBuffer(s),this.starsSegments=t.b.simpleSegment(0,0,a.length,s.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(e,r){const i=e.context,n=i.gl,o=e.transform,a=new t.ae(n.LEQUAL,t.ae.ReadOnly,[0,1]),s=t.a1(o.zoom),l=e.style.getLut(r.scope),c=r.properties.get("color").toRenderColor(l).toArray01(),u=r.properties.get("high-color").toRenderColor(l).toArray01(),h=r.properties.get("space-color").toRenderColor(l).toArray01PremultipliedAlpha(),A=5e-4,p=t.ce(r.properties.get("horizon-blend"),0,1,A,.25),d=t.ba(e,i,o)&&p===A?o.worldSize/(2*Math.PI*1.025)-1:o.globeRadius,f=e.frameCounter/1e3%1,m=t._.length(o.globeCenterInViewSpace),g=Math.sqrt(Math.pow(m,2)-Math.pow(d,2)),_=Math.acos(g/m),y=r=>{const l="globe"===o.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];r&&l.push("ALPHA_PASS");const A=e.getOrCreateProgram("globeAtmosphere",{defines:l}),d=((t,e,r,i,n,o,a,s,l,c,u,h)=>({u_frustum_tl:t,u_frustum_tr:e,u_frustum_br:r,u_frustum_bl:i,u_horizon:n,u_transition:o,u_fadeout_range:a,u_color:s,u_high_color:l,u_space_color:c,u_temporal_offset:u,u_horizon_angle:h}))(o.frustumCorners.TL,o.frustumCorners.TR,o.frustumCorners.BR,o.frustumCorners.BL,o.frustumCorners.horizon,s,p,c,u,h,f,_);e.uploadCommonUniforms(i,A);const m=this.atmosphereBuffer;m&&A.draw(e,n.TRIANGLES,a,t.ag.disabled,r?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,t.af.backCW,d,r?"atmosphere_glow_alpha":"atmosphere_glow",m.vertexBuffer,m.indexBuffer,m.segments)};y(!1),y(!0)}drawStars(e,r){const i=t.at(r.properties.get("star-intensity"),0,1);if(0===i)return;const n=e.context,o=n.gl,a=e.transform,s=e.getOrCreateProgram("stars"),l=t.av.identity([]);t.av.rotateX(l,l,-a._pitch),t.av.rotateZ(l,l,-a.angle),t.av.rotateX(l,l,t.ab(a._center.lat)),t.av.rotateY(l,l,-t.ab(a._center.lng));const c=t.ad.fromQuat(new Float32Array(16),l),u=t.ad.multiply([],a.starsProjMatrix,c),h=t.bC.fromMat4([],c),A=t.bC.invert([],h),p=[0,1,0];t._.transformMat3(p,p,A),t._.scale(p,p,this.params.sizeMultiplier);const d=[1,0,0];t._.transformMat3(d,d,A),t._.scale(d,d,this.params.sizeMultiplier);const f=(m=p,g=d,_=i,{u_matrix:Float32Array.from(u),u_up:m,u_right:g,u_intensity_multiplier:_});var m,g,_;e.uploadCommonUniforms(n,s),this.starsVx&&this.starsIdx&&s.draw(e,o.TRIANGLES,t.ae.disabled,t.ag.disabled,this.colorModeAlphaBlendedWriteRGB,t.af.disabled,f,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function hn(e,r){const i=[...e],n=r.cameraWorldSizeForFog/r.worldSize,o=t.ad.identity([]);return t.ad.scale(o,o,[n,n,1]),t.ad.multiply(i,o,i),t.ad.multiply(i,r.worldToFogMatrix,i),i}function An(e,r,i,n,o){const a=i.material,s=n.context,{baseColorTexture:l,metallicRoughnessTexture:c}=a.pbrMetallicRoughness,{normalTexture:u,occlusionTexture:h,emissionTexture:A}=a;function p(t,r,i){if(t&&(e.push(r),s.activeTexture.set(s.gl.TEXTURE0+i),t.gfxTexture)){const{minFilter:e,magFilter:r,wrapS:i,wrapT:n}=t.sampler;t.gfxTexture.bindExtraParam(e,r,i,n)}}p(l,"HAS_TEXTURE_u_baseColorTexture",dr.BaseColor),p(c,"HAS_TEXTURE_u_metallicRoughnessTexture",dr.MetallicRoughness),p(u,"HAS_TEXTURE_u_normalTexture",dr.Normal),p(h,"HAS_TEXTURE_u_occlusionTexture",dr.Occlusion),p(A,"HAS_TEXTURE_u_emissionTexture",dr.Emission),o&&(o.texture||(o.texture=new t.ch(n.context,o.image,[o.image.height,o.image.height,o.image.height],s.gl.RGBA)),s.activeTexture.set(s.gl.TEXTURE0+dr.LUT),o.texture&&o.texture.bind(s.gl.LINEAR,s.gl.CLAMP_TO_EDGE),e.push("APPLY_LUT_ON_GPU")),i.texcoordBuffer&&(e.push("HAS_ATTRIBUTE_a_uv_2f"),r.push(i.texcoordBuffer)),i.colorBuffer&&(e.push(12===i.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),r.push(i.colorBuffer)),i.normalBuffer&&(e.push("HAS_ATTRIBUTE_a_normal_3f"),r.push(i.normalBuffer)),i.pbrBuffer&&(e.push("HAS_ATTRIBUTE_a_pbr"),e.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),r.push(i.pbrBuffer)),"OPAQUE"!==a.alphaMode&&"MASK"!==a.alphaMode||e.push("UNPREMULT_TEXTURE_IN_SHADER"),a.defined||e.push("DIFFUSE_SHADED"),e.push("USE_STANDARD_DERIVATIVES")}function pn(e,r,i,n,o,a){const s=i.paint.get("model-opacity"),l=r.context,c=new t.ae(r.context.gl.LEQUAL,t.ae.ReadWrite,r.depthRangeFor3D),u=r.transform,h=e.mesh,A=h.material,p=A.pbrMetallicRoughness,d=r.style.fog;let f;f="pixels"===r.transform.projection.zAxisUnit?[...e.nodeModelMatrix]:t.ad.multiply([],n.zScaleMatrix,e.nodeModelMatrix),t.ad.multiply(f,n.negCameraPosMatrix,f);const m=t.ad.invert([],f);t.ad.transpose(m,m);const g=i.paint.get("model-emissive-strength").constantOr(0),_=mi(new Float32Array(e.worldViewProjection),new Float32Array(f),new Float32Array(m),null,r,s,p.baseColorFactor.toRenderColor(null),A.emissiveFactor,p.metallicFactor,p.roughnessFactor,A,g,i),y={defines:[]},v=[];An(y.defines,v,h,r,i.lut);const x=r.shadowRenderer;x&&(x.useNormalOffset=!1);let w=null;if(d){const t=hn(e.nodeModelMatrix,r.transform);if(w=new Float32Array(t),"globe"!==u.projection.name){const e=h.aabb.min,r=h.aabb.max,[i,n]=d.getOpacityForBounds(t,e[0],e[1],r[0],r[1]);y.overrideFog=i>=re||n>=re}}const b=fr(r,i.paint.get("model-cutoff-fade-range"));b.shouldRenderCutoff&&y.defines.push("RENDER_CUTOFF");const B=r.getOrCreateProgram("model",y);r.uploadCommonUniforms(l,B,null,w,b),"shadow"!==r.renderPass&&x&&x.setupShadowsFromMatrix(e.nodeModelMatrix,B),B.draw(r,l.gl.TRIANGLES,c,o,a,h.material.doubleSided?t.af.disabled:t.af.backCCW,_,i.id,h.vertexBuffer,h.indexBuffer,h.segments,i.paint,r.transform.zoom,void 0,v)}function dn(e,r,i,n,o,a,s){let l;l="globe"===e.projection.name?t.ci(i,e):[...i],t.ad.multiply(l,l,r.matrix);const c=t.ad.multiply([],n,l);if(r.meshes)for(const e of r.meshes){if("BLEND"!==e.material.alphaMode){s.push({mesh:e,depth:0,modelIndex:o,worldViewProjection:c,nodeModelMatrix:l});continue}const r=t._.transformMat4([],e.centroid,c);r[2]>0&&a.push({mesh:e,depth:r[2],modelIndex:o,worldViewProjection:c,nodeModelMatrix:l})}if(r.children)for(const t of r.children)dn(e,t,i,n,o,a,s)}function fn(e,r,i,n){const o=i.shadowRenderer;if(!o)return;const a=o.getShadowPassDepthMode(),s=o.getShadowPassColorMode(),l=o.calculateShadowPassMatrixFromMatrix(r),c=gi(l);i.getOrCreateProgram("modelDepth",{defines:i._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(i,i.context.gl.TRIANGLES,a,t.ag.disabled,s,t.af.backCCW,c,n.id,e.vertexBuffer,e.indexBuffer,e.segments,n.paint,i.transform.zoom,void 0,void 0)}function mn(e,r,i){const n=r.updateZoomBasedPaintProperties(),o=function(e,r,i){let n,o,a,s=e.terrain?e.terrain.exaggeration():0;if(e.terrain&&s>0){const r=e.terrain,o=r.findDEMTileFor(i);o&&o.dem?n=t.ck.create(r,i,o):s=0}if(0===s&&(r.terrainElevationMin=0,r.terrainElevationMax=0),s===r.validForExaggeration&&(0===s||n&&n._demTile&&n._demTile.tileID===r.validForDEMTile.id&&n._dem._timestamp===r.validForDEMTile.timestamp))return!1;for(const t in r.instancesPerModel){const e=r.instancesPerModel[t];for(let t=0;t<e.instancedDataArray.length;++t){const i=(n?s*n.getElevationAt(0|e.instancedDataArray.float32[16*t],0|e.instancedDataArray.float32[16*t+1],!0,!0):0)+e.instancesEvaluatedElevation[t];e.instancedDataArray.float32[16*t+6]=i,o=o?Math.min(r.terrainElevationMin,i):i,a=a?Math.max(r.terrainElevationMax,i):i}}return r.terrainElevationMin=o||0,r.terrainElevationMax=a||0,r.validForExaggeration=s,r.validForDEMTile=n&&n._demTile?{id:n._demTile.tileID,timestamp:n._dem._timestamp}:{id:void 0,timestamp:0},!0}(e,r,i);(n||o)&&(r.uploaded=!1,r.upload(e.context))}const gn={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new t.b6([0,0,0],[t.a3,t.a3,0])};function _n(e,r){const i=1<<e.canonical.z,n=r.getFreeCameraOptions().position,o=r.elevation,a=e.canonical.x/i,s=(e.canonical.x+1)/i,l=e.canonical.y/i,c=(e.canonical.y+1)/i;let u=r._centerAltitude;if(o){const t=o.getMinMaxForTile(e);t&&t.max>u&&(u=t.max)}const h=t.at(n.x,a,s)-n.x,A=t.at(n.y,l,c)-n.y,p=t.ax(u,r.center.lat)-n.z;return r._zoomFromMercatorZ(Math.sqrt(h*h+A*A+p*p))}function yn(e,r,i,n,o,a,s){const l=e.context,c="shadow"===e.renderPass,u=e.shadowRenderer,h=c&&u?u.getShadowPassDepthMode():new t.ae(l.gl.LEQUAL,t.ae.ReadWrite,e.depthRangeFor3D),A=e.isTileAffectedByFog(a);if(i.meshes)for(const p of i.meshes){const d=["MODEL_POSITION_ON_GPU"],f=[];let m,g,_;n.instancedDataArray.length>20&&d.push("INSTANCED_ARRAYS");const y=fr(e,r.paint.get("model-cutoff-fade-range"));if(y.shouldRenderCutoff&&d.push("RENDER_CUTOFF"),c&&u)m=e.getOrCreateProgram("modelDepth",{defines:d}),g=gi(s.shadowTileMatrix,s.shadowTileMatrix,Float32Array.from(i.matrix)),_=u.getShadowPassColorMode();else{An(d,f,p,e,r.lut),m=e.getOrCreateProgram("model",{defines:d,overrideFog:A});const n=p.material,c=n.pbrMetallicRoughness,h=r.paint.get("model-opacity"),v=r.paint.get("model-emissive-strength").constantOr(0);g=mi(a.expandedProjMatrix,Float32Array.from(i.matrix),new Float32Array(16),null,e,h,c.baseColorFactor.toRenderColor(null),n.emissiveFactor,c.metallicFactor,c.roughnessFactor,n,v,r,o),u&&(s.shadowUniformsInitialized?m.setShadowUniformValues(l,u.getShadowUniformValues()):(u.setupShadows(a.toUnwrapped(),m,"model-tile",a.overscaledZ),s.shadowUniformsInitialized=!0)),_=y.shouldRenderCutoff||h<1||"OPAQUE"!==n.alphaMode?t.a.alphaBlended:t.a.unblended}e.uploadCommonUniforms(l,m,a.toUnwrapped(),null,y);const v=p.material.doubleSided?t.af.disabled:t.af.backCCW;if(n.instancedDataArray.length>20)f.push(n.instancedDataBuffer),m.draw(e,l.gl.TRIANGLES,h,t.ag.disabled,_,v,g,r.id,p.vertexBuffer,p.indexBuffer,p.segments,r.paint,e.transform.zoom,void 0,f,n.instancedDataArray.length);else{const i=c?"u_instance":"u_normal_matrix";for(let o=0;o<n.instancedDataArray.length;++o)g[i]=new Float32Array(n.instancedDataArray.arrayBuffer,64*o,16),m.draw(e,l.gl.TRIANGLES,h,t.ag.disabled,_,v,g,r.id,p.vertexBuffer,p.indexBuffer,p.segments,r.paint,e.transform.zoom,void 0,f)}}if(i.children)for(const t of i.children)yn(e,r,t,n,o,a,s)}const vn=[1,-1,1];function xn(e,r,i,n){if(!i.modelManager)return!0;const o=i.modelManager;if(!i.shadowRenderer)return!0;const a=i.shadowRenderer,s=r.aabb;let l=!0,c=e.maxHeight;if(0===c){let t=0;for(const r in e.instancesPerModel){const e=o.getModel(r,n);e?t=Math.max(t,Math.max(Math.max(e.aabb.max[0],e.aabb.max[1]),e.aabb.max[2])):l=!1}c=e.maxScale*t*1.41+e.maxVerticalOffset,l&&(e.maxHeight=c)}s.max[2]=c,s.min[2]+=e.terrainElevationMin,s.max[2]+=e.terrainElevationMax,t._.transformMat4(s.min,s.min,r.tileMatrix),t._.transformMat4(s.max,s.max,r.tileMatrix);const u=s.intersects(a.getCurrentCascadeFrustum());return 0===i.currentShadowCascade&&(e.isInsideFirstShadowMapFrustum=2===u),0===u}function wn(e,r){const i=e.uniformValues.u_cutoff_params[0],n=e.uniformValues.u_cutoff_params[1],o=e.uniformValues.u_cutoff_params[2],a=e.uniformValues.u_cutoff_params[3];return n===i||a===o?1:t.at(((r-i)/(n-i)-o)/(a-o),0,1)}function bn(e,r,i,n){if(r.pitch<20)return 1;const o=r.getWorldToCameraMatrix(),a=t.ad.multiply([],o,e),s=[...i.min,1];let l=t.aA.transformMat4([],s,a),c=l,u=l;s[1]=i.max[1],l=t.aA.transformMat4([],s,a),c=l[1]<c[1]?l:c,u=l[1]>u[1]?l:u,s[0]=i.max[0],l=t.aA.transformMat4([],s,a),c=l[1]<c[1]?l:c,u=l[1]>u[1]?l:u,s[1]=i.min[1],l=t.aA.transformMat4([],s,a),c=l[1]<c[1]?l:c,u=l[1]>u[1]?l:u;const h=t.at(n[0],0,1),A=100*r.pixelsPerMeter*t.at(n[1],0,1),p=t.at(n[2],0,1),d=t._.lerp([],c,u,h),f=Math.tan(.5*r.fovX),m=-d[2]*f;if(0===A)return d[1]<-Math.abs(m)?p:1;const g=(-Math.abs(m)-d[1])/A,_=(t,e,r)=>(1-r)*t+r*e,y=t.at(_(1,p,g),p,1);return _(1,y,t.at((r.pitch-20)/20,0,1))}class Bn{}class Cn{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(e,r,i){{const t=this._storage.get(r.id);if(t)return t.lastUsedFrameIdx=e,t.buf}const n=i.gl,o=n.getBufferParameter(n.ELEMENT_ARRAY_BUFFER,n.BUFFER_SIZE),a=new ArrayBuffer(o),s=new Int16Array(a);n.getBufferSubData(n.ELEMENT_ARRAY_BUFFER,0,new Int16Array(a));const l=new t.cm;for(let t=0;t<o/2;t+=3){const e=s[t],r=s[t+1],i=s[t+2];l.emplaceBack(e,r),l.emplaceBack(r,i),l.emplaceBack(i,e)}const c=i.bindVertexArrayOES.current,u=new Bn;return u.buf=new t.I(i,l),u.lastUsedFrameIdx=e,this._storage.set(r.id,u),i.bindVertexArrayOES.set(c),u.buf}update(t){for(const[e,r]of this._storage)t-r.lastUsedFrameIdx>30&&(r.buf.destroy(),this._storage.delete(e))}destroy(){for(const[t,e]of this._storage)e.buf.destroy(),this._storage.delete(t)}}const En=t.c7([{type:"Float32",name:"a_offset_xy",components:2}]);class Tn{constructor(e){const r=new t.cn,i=new t.bu;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(1,1),r.emplaceBack(-1,1),i.emplaceBack(0,1,2),i.emplaceBack(0,2,3),this.segments=t.b.simpleSegment(0,0,r.length,i.length),this.vx=e.createVertexBuffer(r,En.members),this.idx=e.createIndexBuffer(i)}destroy(){this.vx.destroy(),this.idx.destroy()}}const In={symbol:function(e,r,i,n,o){if("translucent"!==e.renderPass)return;const a=t.ag.disabled,s=e.colorModeForRenderPass();i.layout.get("text-variable-anchor")&&function(e,r,i,n,o,a,s){const l=r.transform,c="map"===o,u="map"===a;for(const r of e){const e=n.getTile(r),o=e.getBucket(i);if(!o||!o.text||!o.text.segments.get().length)continue;const a=t.aD(o.textSizeData,l.zoom),h=wi(r,o.getProjection(),l),A=l.calculatePixelsToTileUnitsMatrix(e),p=Xe(h,e.tileID.canonical,u,c,l,o.getProjection(),A),d=o.hasIconTextFit()&&o.hasIconData();if(a){const i=Math.pow(2,l.zoom-e.tileID.overscaledZ);Ii(o,c,u,s,t.bO,l,p,r,i,a,d)}}}(n,e,i,r,i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),o);const l=0!==i.paint.get("icon-opacity").constantOr(1),c=0!==i.paint.get("text-opacity").constantOr(1);void 0!==i.layout.get("symbol-sort-key").constantOr(1)&&(l||c)?Si(e,r,i,n,a,s):(l&&Si(e,r,i,n,a,s,{onlyIcons:!0}),c&&Si(e,r,i,n,a,s,{onlyText:!0}),function(e,r,i,n){if(!e.symbolParams.useOcclusionQueries)return;const o=e.context.gl,a=e.transform,s=i.paint,l=s.get("icon-occlusion-opacity").constantOr(0),c=s.get("text-occlusion-opacity").constantOr(0);if(!i.hasInitialOcclusionOpacityProperties||1===l&&1===c)return;const u="globe"===a.projection.name;for(const s of n){const n=r.getTile(s),l=n.getBucket(i);if(!l)continue;if("mercator"===l.projection.name&&u)continue;if(l.fullyClipped)continue;if("globe"===l.projection.name){t.w(`Occlusion not supported for globe mode. Layer: ${i.type}`);continue}const c=wi(s,l.getProjection(),a),h=t.ad.fromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,e.symbolParams.depthOffset,1),A=t.ad.multiply([],h,c),p="none"!==e.symbolParams.visualizeOcclusions?1:e.symbolParams.occlusionQueryFrameWindow;for(let r=0;r<l.symbolInstances.length;r++){const i=l.symbolInstances.get(r),s=e.style.placement.opacities[i.crossTileID];if(s&&s.isHidden())continue;if((e.frameCounter+r)%p!=0)continue;const c=i.tileAnchorX,u=i.tileAnchorY,h=i.zOffset;let d;if("none"===e.symbolParams.visualizeOcclusions){const t=l.queries.get(r);if(t){if(!t.isFree()){if(!t.isResultAvailable())continue;const e=t.consumeResult();i.occlusionState=0===e?0:1;continue}d=t}else d=new at(e.context),l.queries.set(r,d)}const f=e.getOrCreateProgram("occlusion"),m=e.symbolParams.occluderSize,g=_i(A,[c,u,h],[a.width,a.height],[m,m],"zPass"===e.symbolParams.visualizeOcclusions?[1,0,0,.8]:[1,.4,.2,.9]);e.terrain&&e.terrain.setupElevationDraw(n,f,{useDepthForOcclusion:!1,labelPlaneMatrixInv:void 0}),"none"===e.symbolParams.visualizeOcclusions&&d&&d.begin();const _=new t.ae("zPass"===e.symbolParams.visualizeOcclusions?e.context.gl.ALWAYS:e.context.gl.LEQUAL,t.ae.ReadOnly,e.depthRangeFor3D);f.draw(e,o.TRIANGLES,_,t.ag.disabled,"none"!==e.symbolParams.visualizeOcclusions?t.a.alphaBlendedNonPremultiplied:t.a.disabled,t.af.disabled,g,"occlusion",e.occlusionBuffers.vx,e.occlusionBuffers.idx,e.occlusionBuffers.segments),"none"===e.symbolParams.visualizeOcclusions&&d&&d.end()}}}(e,r,i,n)),r.map.showCollisionBoxes&&(Bi(e,r,i,n,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),!0),Bi(e,r,i,n,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),!1))},circle:function(e,r,i,n){if("translucent"!==e.renderPass)return;const o=i.paint.get("circle-opacity"),a=i.paint.get("circle-stroke-width"),s=i.paint.get("circle-stroke-opacity"),l=void 0!==i.layout.get("circle-sort-key").constantOr(1),c=i.paint.get("circle-emissive-strength");if(0===o.constantOr(1)&&(0===a.constantOr(1)||0===s.constantOr(1)))return;const u=e.context,h=u.gl,A=e.transform,p=e.depthModeForSublayer(0,t.ae.ReadOnly),d=t.ag.disabled,f=e.colorModeForDrapableLayerRenderPass(c),m="globe"===A.projection.name,g=[t.aj(A.center.lng),t.ak(A.center.lat)],_=[];for(let o=0;o<n.length;o++){const a=n[o],s=r.getTile(a),c=s.getBucket(i);if(!c||c.projection.name!==A.projection.name)continue;const u=c.programConfigurations.get(i.id),h=t.bR(i),p=e.isTileAffectedByFog(a);m&&h.push("PROJECTION_GLOBE_VIEW"),h.push("TERRAIN_DEPTH_D24");const d=e.getOrCreateProgram("circle",{config:u,defines:h,overrideFog:p}),f=c.layoutVertexBuffer,y=c.globeExtVertexBuffer,v=c.indexBuffer,x=A.projection.createInversionMatrix(A,a.canonical),w={programConfiguration:u,program:d,layoutVertexBuffer:f,globeExtVertexBuffer:y,indexBuffer:v,uniformValues:t.bS(e,a,s,x,g,i),tile:s};if(l){const e=c.segments.get();for(const r of e)_.push({segments:new t.b([r]),sortKey:r.sortKey,state:w})}else _.push({segments:c.segments,sortKey:0,state:w})}l&&_.sort(((t,e)=>t.sortKey-e.sortKey));const y={useDepthForOcclusion:A.depthOcclusionForSymbolsAndCircles};for(const r of _){const{programConfiguration:n,program:o,layoutVertexBuffer:a,globeExtVertexBuffer:s,indexBuffer:l,uniformValues:c,tile:m}=r.state,g=r.segments;e.terrain&&e.terrain.setupElevationDraw(m,o,y),e.uploadCommonUniforms(u,o,m.tileID.toUnwrapped()),o.draw(e,h.TRIANGLES,p,d,f,t.af.disabled,c,i.id,a,l,g,i.paint,A.zoom,n,[s])}},heatmap:function(e,r,i,n){if(0!==i.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){const o=e.context,a=o.gl,s=t.ag.disabled,l=new t.a([a.ONE,a.ONE,a.ONE,a.ONE],t.C.transparent,[!0,!0,!0,!0]);!function(t,e,r,i){const n=t.gl,o=e.width*i,a=e.height*i;t.activeTexture.set(n.TEXTURE1),t.viewport.set([0,0,o,a]);let s=r.heatmapFbo;if(!s||s&&(s.width!==o||s.height!==a)){s&&s.destroy();const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),s=r.heatmapFbo=t.createFramebuffer(o,a,!0,null),function(t,e,r,i,n,o){const a=t.gl;a.texImage2D(a.TEXTURE_2D,0,t.extRenderToTextureHalfFloat?a.RGBA16F:a.RGBA,n,o,0,a.RGBA,t.extRenderToTextureHalfFloat?a.HALF_FLOAT:a.UNSIGNED_BYTE,null),i.colorAttachment.set(r)}(t,0,e,s,o,a)}else n.bindTexture(n.TEXTURE_2D,s.colorAttachment.get()),t.bindFramebuffer.set(s.framebuffer)}(o,e,i,"globe"===e.transform.projection.name?.5:.25),o.clear({color:t.C.transparent});const c=e.transform,u="globe"===c.projection.name,h=u?["PROJECTION_GLOBE_VIEW"]:[],A=u?t.af.frontCCW:t.af.disabled,p=[t.aj(c.center.lng),t.ak(c.center.lat)];for(let d=0;d<n.length;d++){const f=n[d];if(r.hasRenderableParent(f))continue;const m=r.getTile(f),g=m.getBucket(i);if(!g||g.projection.name!==c.projection.name)continue;const _=e.isTileAffectedByFog(f),y=g.programConfigurations.get(i.id),v=e.getOrCreateProgram("heatmap",{config:y,defines:h,overrideFog:_}),{zoom:x}=e.transform;e.terrain&&e.terrain.setupElevationDraw(m,v),e.uploadCommonUniforms(o,v,f.toUnwrapped());const w=c.projection.createInversionMatrix(c,f.canonical);v.draw(e,a.TRIANGLES,t.ae.disabled,s,l,A,ti(e,f,m,w,p,x,i.paint.get("heatmap-intensity")),i.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,i.paint,e.transform.zoom,y,u?[g.globeExtVertexBuffer]:null)}o.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,r){const i=e.context,n=i.gl,o=r.heatmapFbo;if(!o)return;i.activeTexture.set(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,o.colorAttachment.get()),i.activeTexture.set(n.TEXTURE1);let a=r.colorRampTexture;a||(a=r.colorRampTexture=new t.T(i,r.colorRamp,n.RGBA)),a.bind(n.LINEAR,n.CLAMP_TO_EDGE),e.getOrCreateProgram("heatmapTexture").draw(e,n.TRIANGLES,t.ae.disabled,t.ag.disabled,e.colorModeForRenderPass(),t.af.disabled,((t,e)=>({u_image:0,u_color_ramp:1,u_opacity:e.paint.get("heatmap-opacity")}))(0,r),r.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,r.paint,e.transform.zoom)}(e,i))},line:function(e,r,i,n){if("translucent"!==e.renderPass)return;const o=i.paint.get("line-opacity"),a=i.paint.get("line-width");if(0===o.constantOr(1)||0===a.constantOr(1))return;const s=i.paint.get("line-emissive-strength"),l=i.paint.get("line-occlusion-opacity"),c=e.context,u=c.gl,h=i.layout.get("line-z-offset"),A=!h.isConstant()||!!h.constantOr(0),p=A?new t.ae(e.depthOcclusion?u.GREATER:u.LEQUAL,t.ae.ReadOnly,e.depthRangeFor3D):e.depthModeForSublayer(0,t.ae.ReadOnly),d=e.colorModeForDrapableLayerRenderPass(s),f=e.terrain&&e.terrain.renderingToTexture,m=f?1:t.e.devicePixelRatio,g=i.paint.get("line-dasharray"),_=g.constantOr(1),y=i.layout.get("line-cap"),v=g.constantOr(null),x=y.constantOr(null),w=i.paint.get("line-pattern"),b=w.constantOr(1),B=w.constantOr(null),C=i.paint.get("line-opacity").constantOr(1);let E=!b&&1!==C||e.depthOcclusion&&l>0&&l<1;const T=i.paint.get("line-gradient"),I=b?"linePattern":"line",S=t.bT(i);let M;if(f&&e.terrain&&e.terrain.clipOrMaskOverlapStencilType()&&(E=!1),0!==l&&e.depthOcclusion){const e=i.paint._values["line-opacity"];e&&e.value&&"constant"===e.value.kind?M=e.value:t.w(`Occlusion opacity for layer ${i.id} is supported only when line-opacity isn't data-driven.`)}if(A&&(e.forceTerrainMode=!0),!A&&0!==l&&e.terrain&&!f)return void t.w(`Occlusion opacity for layer ${i.id} is supported on terrain only if the layer has non-zero line-z-offset.`);const F=E&&A?e.stencilModeFor3D():t.ag.disabled;for(const o of n){const n=r.getTile(o);if(b&&!n.patternsLoaded())continue;const a=n.getBucket(i);if(!a)continue;e.prepareDrawTile();const s=a.programConfigurations.get(i.id),h=e.isTileAffectedByFog(o),g=e.getOrCreateProgram(I,{config:s,defines:A?[...S,"ELEVATED"]:S,overrideFog:h});if(B&&n.imageAtlas){const t=n.imageAtlas.patternPositions[B.toString()];t&&s.setConstantPatternPositions(t)}if(!b&&v&&x&&n.lineAtlas){const t=n.lineAtlas.getDash(v,x);t&&s.setConstantPatternPositions(t)}let[y,w]=i.paint.get("line-trim-offset");if("round"===x||"square"===x){const t=1;y!==w&&(0===y&&(y-=t),1===w&&(w+=t))}const P=f?o.projMatrix:null,L=b?t.bU(e,n,i,P,m,[y,w]):t.bV(e,n,i,P,a.lineClipsArray.length,m,[y,w]);if(T){const n=a.gradients[i.id];let s=n.texture;if(i.gradientVersion!==n.version){let l=256;if(i.stepInterpolant){const i=r.getSource().maxzoom,n=o.canonical.z===i?Math.ceil(1<<e.transform.maxZoom-o.canonical.z):1;l=t.at(t.bW(a.maxLineLength/t.a3*1024*n),256,c.maxTextureSize)}n.gradient=t.bX({expression:i.gradientExpression(),evaluationKey:"lineProgress",resolution:l,image:n.gradient||void 0,clips:a.lineClipsArray}),n.texture?n.texture.update(n.gradient):n.texture=new t.T(c,n.gradient,u.RGBA),n.version=i.gradientVersion,s=n.texture}c.activeTexture.set(u.TEXTURE1),s.bind(i.stepInterpolant?u.NEAREST:u.LINEAR,u.CLAMP_TO_EDGE)}_&&(c.activeTexture.set(u.TEXTURE0),n.lineAtlasTexture&&n.lineAtlasTexture.bind(u.LINEAR,u.REPEAT),s.updatePaintBuffers()),b&&(c.activeTexture.set(u.TEXTURE0),n.imageAtlasTexture&&n.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),s.updatePaintBuffers()),A&&e.terrain.setupElevationDraw(n,g),e.uploadCommonUniforms(c,g,o.toUnwrapped());const D=r=>{null!=M&&(M.value=C*l),g.draw(e,u.TRIANGLES,p,r,d,t.af.disabled,L,i.id,a.layoutVertexBuffer,a.indexBuffer,a.segments,i.paint,e.transform.zoom,s,[a.layoutVertexBuffer2,a.patternVertexBuffer,a.zOffsetVertexBuffer]),null!=M&&(M.value=C)};if(E&&!A){const r=e.stencilModeForClipping(o).ref;0===r&&f&&c.clear({stencil:0});const i={func:u.EQUAL,mask:255};L.u_alpha_discard_threshold=.8,D(new t.ag(i,r,255,u.KEEP,u.KEEP,u.INVERT)),L.u_alpha_discard_threshold=0,D(new t.ag(i,r,255,u.KEEP,u.KEEP,u.KEEP))}else E&&A&&(L.u_alpha_discard_threshold=.001),D(A?F:e.stencilModeForClipping(o))}E&&(e.resetStencilClippingMasks(),f&&c.clear({stencil:0})),0===l||e.depthOcclusion||f||e.layersWithOcclusionOpacity.push(e.currentLayer),A&&(e.forceTerrainMode=!1)},fill:function(e,r,i,n){const o=i.paint.get("fill-color"),a=i.paint.get("fill-opacity");if(0===a.constantOr(1))return;const s=i.paint.get("fill-emissive-strength"),l=e.colorModeForDrapableLayerRenderPass(s),c=i.paint.get("fill-pattern"),u=e.opaquePassEnabledForLayer()&&!c.constantOr(1)&&1===o.constantOr(t.C.transparent).a&&1===a.constantOr(0)?"opaque":"translucent";if(e.renderPass===u){const o=e.depthModeForSublayer(1,"opaque"===e.renderPass?t.ae.ReadWrite:t.ae.ReadOnly);Fi(e,r,i,n,o,l,!1)}if("translucent"===e.renderPass&&i.paint.get("fill-antialias")){const o=e.depthModeForSublayer(i.getPaintProperty("fill-outline-color")?2:0,t.ae.ReadOnly);Fi(e,r,i,n,o,l,!0)}},"fill-extrusion":function(e,r,i,n){const o=i.paint.get("fill-extrusion-opacity"),a=e.context,s=a.gl,l=e.terrain,c=l&&l.renderingToTexture;if(0===o)return;const u=e.conflationActive&&e.style.isLayerClipped(i,r.getSource()),h=e.style.order.indexOf(i.fqid);if(u&&function(t,e,r,i,n){for(const o of i){const i=e.getTile(o).getBucket(r);i&&(i.updateReplacement(o,t.replacementSource,n),i.uploadCentroid(t.context))}}(e,r,i,n,h),l||u)for(const t of n){const n=r.getTile(t).getBucket(i);n&&Di(e.context,r,t,n,i,l,u)}if("shadow"===e.renderPass&&e.shadowRenderer){const a=e.shadowRenderer;if(l&&o<.65&&i._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof t.Z)return;const s=a.getShadowPassDepthMode(),c=a.getShadowPassColorMode();Pi(e,r,i,n,s,t.ag.disabled,c,u)}else if("translucent"===e.renderPass){const h=!i.paint.get("fill-extrusion-pattern").constantOr(1),A=i.paint.get("fill-extrusion-color").constantOr(t.C.white);if(!c&&0!==A.a){const a=new t.ae(e.context.gl.LEQUAL,t.ae.ReadWrite,e.depthRangeFor3D);1===o&&h?Pi(e,r,i,n,a,t.ag.disabled,t.a.unblended,u):(Pi(e,r,i,n,a,t.ag.disabled,t.a.disabled,u),Pi(e,r,i,n,a,e.stencilModeFor3D(),e.colorModeForRenderPass(),u),e.resetStencilClippingMasks())}if(e.style.enable3dLights()&&h&&(!l&&"globe"!==e.transform.projection.name||c)){const o=i.paint.get("fill-extrusion-opacity"),h=i.paint.get("fill-extrusion-ambient-occlusion-intensity"),A=i.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),p=i.paint.get("fill-extrusion-flood-light-intensity"),d=i.paint.get("fill-extrusion-flood-light-color").toRenderColor(i.lut).toArray01().slice(0,3),f=h>0&&A>0,m=p>0,g=(t,e,r)=>(1-r)*t+r*e,_=a=>{const l=e.depthModeForSublayer(1,t.ae.ReadOnly,s.LEQUAL,!0),c=i.paint.get(a?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),f=g(.1,3,c),m=e._showOverdrawInspector;if(!m){const c=new t.ag({func:s.ALWAYS,mask:255},255,255,s.KEEP,s.KEEP,s.REPLACE),m=new t.a([s.ONE,s.ONE,s.ONE,s.ONE],t.C.transparent,[!1,!1,!1,!0],s.MIN);Li(e,r,i,n,l,c,m,t.af.disabled,a,"sdf",o,h,A,p,d,f,u,!1)}{const c=m?t.ag.disabled:new t.ag({func:s.EQUAL,mask:255},255,255,s.KEEP,s.DECR,s.DECR),g=m?e.colorModeForRenderPass():new t.a([s.ONE_MINUS_DST_ALPHA,s.DST_ALPHA,s.ONE,s.ONE],t.C.transparent,[!0,!0,!0,!0]);Li(e,r,i,n,l,c,g,t.af.disabled,a,"color",o,h,A,p,d,f,u,!1)}};if(c){const c=(a,l,c)=>{const f=e.depthModeForSublayer(1,t.ae.ReadOnly,s.LEQUAL,!1),m=i.paint.get(a?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),_=g(.1,3,m);{const c=new t.a([s.ONE,s.ONE,s.ONE,s.ONE],t.C.transparent,[!1,!1,!1,!0]);Li(e,r,i,n,f,t.ag.disabled,c,t.af.disabled,a,"clear",o,h,A,p,d,_,u,l)}{const c=new t.ag({func:s.ALWAYS,mask:255},255,255,s.KEEP,s.KEEP,s.REPLACE),m=new t.a([s.ONE,s.ONE,s.ONE,s.ONE],t.C.transparent,[!1,!1,!1,!0],s.MIN);Li(e,r,i,n,f,c,m,t.af.disabled,a,"sdf",o,h,A,p,d,_,u,l)}{const c=a?s.ZERO:s.ONE_MINUS_DST_ALPHA,m=new t.ag({func:s.EQUAL,mask:255},255,255,s.KEEP,s.DECR,s.DECR),g=new t.a([c,s.DST_ALPHA,s.ONE_MINUS_DST_ALPHA,s.ZERO],t.C.transparent,[!0,!0,!0,!0]);Li(e,r,i,n,f,m,g,t.af.disabled,a,"color",o,h,A,p,d,_,u,l)}{const m=new t.a([s.ONE,s.ONE,s.ONE,a?s.ZERO:s.ONE],t.C.transparent,[!1,!1,!1,!0],a?s.FUNC_ADD:s.MAX);Li(e,r,i,n,f,t.ag.disabled,m,t.af.disabled,a,"clear",o,h,A,p,d,_,u,l,c)}};if(f||m){let r;if(e.prepareDrawTile(),l){const e=l.drapeBufferSize[0],i=l.drapeBufferSize[1];r=l.framebufferCopyTexture,r&&(!r||r.size[0]===e&&r.size[1]===i)||(r&&r.destroy(),r=l.framebufferCopyTexture=new t.T(a,new t.i({width:e,height:i}),s.RGBA)),r.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,e,i,0)}f&&c(!0,!1,r),m&&c(!1,!0,r)}}else f&&_(!0),m&&_(!1)}}},hillshade:function(e,r,i,n){if("offscreen"!==e.renderPass&&"translucent"!==e.renderPass)return;if(e.style.disableElevatedTerrain)return;const o=e.context,a=e.terrain&&e.terrain.renderingToTexture,[s,l]="translucent"!==e.renderPass||a?[{},n]:e.stencilConfigForOverlap(n);for(const n of l){const o=r.getTile(n);if(o.needsHillshadePrepare&&"offscreen"===e.renderPass)Ue(e,o,i);else if("translucent"===e.renderPass){const r=e.depthModeForSublayer(0,t.ae.ReadOnly),l=i.paint.get("hillshade-emissive-strength"),c=e.colorModeForDrapableLayerRenderPass(l),u=a&&e.terrain?e.terrain.stencilModeForRTTOverlap(n):s[n.overscaledZ];Le(e,n,o,i,r,u,c)}}o.viewport.set([0,0,e.width,e.height]),e.resetStencilClippingMasks()},raster:function(e,r,i,n,o,a){if("translucent"!==e.renderPass)return;if(0===i.paint.get("raster-opacity"))return;const s="globe"===e.transform.projection.name,l=0!==i.paint.get("raster-elevation"),c=l&&s;if(e.renderElevatedRasterBackface&&!c)return;const u=e.context,h=u.gl,A=r.getSource(),p=function(e,r,i,n){const o=r.paint.get("raster-color"),a="raster-array"===e.type,s=[],l=r.paint.get("raster-resampling"),c=r.paint.get("raster-color-mix");let u=r.paint.get("raster-color-range");const h=[c[0],c[1],c[2],0],A=c[3];let p="nearest"===l?n.NEAREST:n.LINEAR;if(a&&(s.push("RASTER_ARRAY"),o||s.push("RASTER_COLOR"),"linear"===l&&s.push("RASTER_ARRAY_LINEAR"),p=n.NEAREST,!u&&e.rasterLayers)){const t=e.rasterLayers.find((({id:t})=>t===r.sourceLayer));t&&t.fields&&t.fields.range&&(u=t.fields.range)}if(u=u||[0,1],o){s.push("RASTER_COLOR"),i.activeTexture.set(n.TEXTURE2),r.updateColorRamp(u);let e=r.colorRampTexture;e||(e=r.colorRampTexture=new t.T(i,r.colorRamp,n.RGBA)),e.bind(n.LINEAR,n.CLAMP_TO_EDGE)}return{mix:h,range:u,offset:A,defines:s,resampling:p}}(A,i,u,h);if(A instanceof t.bm&&!n.length&&!s)return;const d=i.paint.get("raster-emissive-strength"),f=e.colorModeForDrapableLayerRenderPass(d),m=e.terrain&&e.terrain.renderingToTexture,g=!e.options.moving,_="nearest"===i.paint.get("raster-resampling")?h.NEAREST:h.LINEAR;if(A instanceof t.bm&&!n.length&&(A.onNorthPole||A.onSouthPole)){const n=l?e.stencilModeFor3D():t.ag.disabled;return void Qi(!!A.onNorthPole,null,e,r,i,d,p,t.af.disabled,n)}if(!n.length)return;const[y,v]=A instanceof t.bm||m?[{},n]:e.stencilConfigForOverlap(n),x=v[v.length-1].overscaledZ;c&&p.defines.push("PROJECTION_GLOBE_VIEW"),l&&p.defines.push("RENDER_CUTOFF");const w=(n,o,v)=>{for(const w of n){const n=w.toUnwrapped(),b=r.getTile(w);if(m&&(!b||!b.hasData()))continue;u.activeTexture.set(h.TEXTURE0);const B=Vi(b,A,i,p);if(!B||!B.texture)continue;const{texture:C,mix:E,offset:T,tileSize:I,buffer:S}=B;let M,F;m?(M=t.ae.disabled,F=w.projMatrix):l?(M=new t.ae(h.LEQUAL,t.ae.ReadWrite,e.depthRangeFor3D),F=s?Float32Array.from(e.transform.expandedFarZProjMatrix):e.transform.calculateProjMatrix(n,g)):(M=e.depthModeForSublayer(w.overscaledZ-x,1===i.paint.get("raster-opacity")?t.ae.ReadWrite:t.ae.ReadOnly,h.LESS),F=e.transform.calculateProjMatrix(n,g));const P=e.terrain&&m?e.terrain.stencilModeForRTTOverlap(w):y[w.overscaledZ],L=a?0:i.paint.get("raster-fade-duration");b.registerFadeDuration(L);const D=r.findLoadedParent(w,0),U=Mr(b,D,r,e.transform,L);let k,z;e.terrain&&e.terrain.prepareDrawTile(),u.activeTexture.set(h.TEXTURE0),C.bind(_,h.CLAMP_TO_EDGE),u.activeTexture.set(h.TEXTURE1),D?(D.texture&&D.texture.bind(_,h.CLAMP_TO_EDGE),k=Math.pow(2,D.tileID.overscaledZ-b.tileID.overscaledZ),z=[b.tileID.canonical.x*k%1,b.tileID.canonical.y*k%1]):C.bind(_,h.CLAMP_TO_EDGE),C.useMipmap&&u.extTextureFilterAnisotropic&&e.transform.pitch>20&&h.texParameterf(h.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax);const R=e.transform;let O;const Q=l?Ni(R):[0,0,0,0];let N,V,H,j,G,K=0;if(c&&A instanceof t.bm&&A.coordinates.length>3)N=Float32Array.from(t.bf(t.bg(new t.aO(0,0,0)))),V=Float32Array.from(R.globeMatrix),H=Float32Array.from(t.bb(R)),j=[t.aj(R.center.lng),t.ak(R.center.lat)],O=A.elevatedGlobePerspectiveTransform,G=A.elevatedGlobeGridMatrix||new Float32Array(9);else if(c){const e=t.bc(w.canonical);K=t.bd(e.getCenter().lat),N=Float32Array.from(t.bf(t.bg(w.canonical))),V=Float32Array.from(R.globeMatrix),H=Float32Array.from(t.bb(R)),j=[t.aj(R.center.lng),t.ak(R.center.lat)],O=[0,0],G=Float32Array.from(t.be(w.canonical,e,K,R.worldSize/R._pixelsPerMercatorPixel))}else O=A instanceof t.bm?A.perspectiveTransform:[0,0],N=new Float32Array(16),V=new Float32Array(9),H=new Float32Array(16),j=[0,0],G=new Float32Array(9);const q=ii(F,N,V,H,G,z||[0,0],t.a1(e.transform.zoom),j,Q,k||1,U,i,O,l?i.paint.get("raster-elevation"):0,2,E,T,p.range,I,S,d),Z=e.isTileAffectedByFog(w),W=e.getOrCreateProgram("raster",{defines:p.defines,overrideFog:Z});if(e.uploadCommonUniforms(u,W,n),A instanceof t.bm){const r=A.elevatedGlobeVertexBuffer,n=A.elevatedGlobeIndexBuffer;if(m||!s)A.boundsBuffer&&A.boundsSegments&&W.draw(e,h.TRIANGLES,M,t.ag.disabled,f,t.af.disabled,q,i.id,A.boundsBuffer,e.quadTriangleIndexBuffer,A.boundsSegments);else if(r&&n){const a=R.zoom<=t.b1?A.elevatedGlobeSegments:A.getSegmentsForLongitude(R.center.lng);a&&W.draw(e,h.TRIANGLES,M,t.ag.disabled,f,o,q,i.id,r,n,a)}}else if(c){M=new t.ae(h.LEQUAL,t.ae.ReadOnly,e.depthRangeFor3D);const r=e.globeSharedBuffers;if(r){const[t,n,a]=r.getGridBuffers(K,!1);W.draw(e,h.TRIANGLES,M,v||P,e.colorModeForRenderPass(),o,q,i.id,t,n,a)}}else{const{tileBoundsBuffer:r,tileBoundsIndexBuffer:n,tileBoundsSegments:o}=e.getTileBoundsBuffers(b);W.draw(e,h.TRIANGLES,M,P,f,t.af.disabled,q,i.id,r,n,o)}}if(!(A instanceof t.bm)&&c)for(const a of n){const n=a.canonical.y===(1<<a.canonical.z)-1;0===a.canonical.y&&Qi(!0,a,e,r,i,d,p,o,v||t.ag.disabled),n&&Qi(!1,a,e,r,i,d,p,o===t.af.frontCW?t.af.backCW:t.af.frontCW,v||t.ag.disabled)}};c?w(v,e.renderElevatedRasterBackface?t.af.backCW:t.af.frontCW,e.stencilModeFor3D()):w(v,t.af.disabled,void 0),e.resetStencilClippingMasks()},"raster-particle":function(e,r,i,n,o,a){"offscreen"===e.renderPass&&function(e,r,i,n){if(!n.length)return;const o=e.context,a=o.gl,s=r.getSource();if(!(s instanceof Fr))return;const l=Math.ceil(Math.sqrt(i.paint.get("raster-particle-count")));let c=i.particlePositionRGBAImage;if(!c||c.width!==l){const e=function(t){const e=t*t,r=new Uint8Array(4*e),i=function(t){return t|=0,t=Math.imul(2747636419^t,2654435769),t=Math.imul(t^t>>>16,2654435769),((t=Math.imul(t^t>>>16,2654435769))>>>0)/4294967296},n=1/1.1;for(let t=0;t<e;t++){const e=n*(i(2*t+0)+oi),o=n*(i(2*t+1)+oi),a=255*e%1,s=255*o%1,l=a,c=o-s/255,u=s;r[4*t+0]=255*(e-a/255),r[4*t+1]=255*l,r[4*t+2]=255*c,r[4*t+3]=255*u}return r}(l);c=i.particlePositionRGBAImage=new t.i({width:l,height:l},e)}let u=i.particleFramebuffer;u?u.width!==l&&(u.destroy(),u=i.particleFramebuffer=o.createFramebuffer(l,l,!0,null)):u=i.particleFramebuffer=o.createFramebuffer(l,l,!0,null);const h=[];for(const e of n){const n=r.getTile(e);if(!(n instanceof t.c3))continue;const a=Hi(n,s,i);if(!a)continue;const u=[n.tileSize,n.tileSize];let A=i.tileFramebuffer;A||(A=i.tileFramebuffer=o.createFramebuffer(u[0],u[1],!0,null));let p=n.rasterParticleState;p||(p=n.rasterParticleState=new lt(o,e,u,c));const d=p.update(i.lastInvalidatedAt);p.particleTextureDimension!==l&&p.updateParticleTexture(e,c);const f=p.targetColorTexture;p.targetColorTexture=p.backgroundColorTexture,p.backgroundColorTexture=f;const m=p.particleTexture0;p.particleTexture0=p.particleTexture1,p.particleTexture1=m,h.push([e,a,p,d])}if(0===h.length)return;const A=t.e.now(),p=i.previousDrawTimestamp?.001*(A-i.previousDrawTimestamp):.0167;if(i.previousDrawTimestamp=A,i.hasColorMap()){o.activeTexture.set(a.TEXTURE0+2);let e=i.colorRampTexture;e||(e=i.colorRampTexture=new t.T(o,i.colorRamp,a.RGBA)),e.bind(a.LINEAR,a.CLAMP_TO_EDGE)}o.bindFramebuffer.set(i.tileFramebuffer.framebuffer),function(e,r,i){const n=e.context,o=n.gl,a=r.tileFramebuffer;n.activeTexture.set(o.TEXTURE0);const s={u_texture:0,u_opacity:1.05*(c=r.paint.get("raster-particle-fade-opacity-factor"))/(c+.05)},l=e.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var c;for(const c of i){const[,,i,u]=c;a.colorAttachment.set(i.targetColorTexture.texture),n.viewport.set([0,0,a.width,a.height]),n.clear({color:t.C.transparent}),u&&(i.backgroundColorTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),l.draw(e,o.TRIANGLES,t.ae.disabled,t.ag.disabled,t.a.alphaBlended,t.af.disabled,s,r.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments))}}(e,i,h),function(e,r,i,n){const o=e.context,a=o.gl,s=i.tileFramebuffer,l="globe"===e.transform.projection.name,c=i.paint.get("raster-particle-max-speed");for(const u of n){const[n,h,A]=u;o.activeTexture.set(a.TEXTURE0+0),h.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),s.colorAttachment.set(A.targetColorTexture.texture);const p=e.getOrCreateProgram("rasterParticleDraw",{defines:h.defines,overrideFog:!1});o.activeTexture.set(a.TEXTURE0+1);const d=h.scalarData?[]:[0,1,2,3].map((e=>t.bZ[e](n)));d.push(n);const f=n.canonical.x,m=n.canonical.y;for(const o of d){const s=r.getTile(l?o.wrapped():o);if(!s)continue;const u=s.rasterParticleState;if(!u)continue;const A=o.canonical.x+(1<<o.canonical.z)*(o.wrap-n.wrap),d=o.canonical.y;u.particleTexture0.bind(a.NEAREST,a.CLAMP_TO_EDGE);const g=si(1,u.particleTexture0.size[0],[A-f,d-m],0,h.texture.size,2,c,h.textureOffset,h.scale,h.offset);p.draw(e,a.POINTS,t.ae.disabled,t.ag.disabled,t.a.alphaBlended,t.af.disabled,g,i.id,u.particleIndexBuffer,void 0,u.particleSegment)}}}(e,r,i,h),o.bindFramebuffer.set(i.particleFramebuffer.framebuffer),function(e,r,i,n){const o=e.context,a=o.gl,s=r.paint.get("raster-particle-max-speed"),l=n*r.paint.get("raster-particle-speed-factor")*.15,c=function(t){return Math.pow(t,6)}(.01+1*r.paint.get("raster-particle-reset-rate-factor")),u=r.particleFramebuffer;o.viewport.set([0,0,u.width,u.height]);for(const n of i){const[,i,h]=n;o.activeTexture.set(a.TEXTURE0+0),i.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),o.activeTexture.set(a.TEXTURE0+1);const A=h.particleTexture0;A.bind(a.NEAREST,a.CLAMP_TO_EDGE);const p=li(1,A.size[0],0,i.texture.size,s,l,c,i.textureOffset,i.scale,i.offset);u.colorAttachment.set(h.particleTexture1.texture),o.clear({color:t.C.transparent}),e.getOrCreateProgram("rasterParticleUpdate",{defines:i.defines}).draw(e,a.TRIANGLES,t.ae.disabled,t.ag.disabled,t.a.unblended,t.af.disabled,p,r.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments)}}(e,i,h,p)}(e,r,i,n),"translucent"===e.renderPass&&(function(e,r,i,n){const o=e.context,a=o.gl,s=!e.options.moving,l="globe"===e.transform.projection.name;if(!n.length)return;const[c,u]=e.stencilConfigForOverlap(n),h=[];l&&h.push("PROJECTION_GLOBE_VIEW");const A=e.stencilModeFor3D();for(const n of u){const u=n.toUnwrapped(),p=r.getTile(n);if(!p.rasterParticleState)continue;const d=p.rasterParticleState,f=100;p.registerFadeDuration(f);const m=r.findLoadedParent(n,0),g=Mr(p,m,r,e.transform,f);let _,y;e.terrain&&e.terrain.prepareDrawTile(),o.activeTexture.set(a.TEXTURE0),d.targetColorTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),o.activeTexture.set(a.TEXTURE1),m&&m.rasterParticleState?(m.rasterParticleState.targetColorTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),_=Math.pow(2,m.tileID.overscaledZ-p.tileID.overscaledZ),y=[p.tileID.canonical.x*_%1,p.tileID.canonical.y*_%1]):d.targetColorTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const v=l?Float32Array.from(e.transform.expandedFarZProjMatrix):e.transform.calculateProjMatrix(u,s),x=e.transform,w=ji(x),b=t.bc(n.canonical),B=t.bd(b.getCenter().lat);let C,E,T,I,S;l?(C=Float32Array.from(t.bf(t.bg(n.canonical))),E=Float32Array.from(x.globeMatrix),T=Float32Array.from(t.bb(x)),I=[t.aj(x.center.lng),t.ak(x.center.lat)],S=Float32Array.from(t.be(n.canonical,b,B,x.worldSize/x._pixelsPerMercatorPixel))):(C=new Float32Array(16),E=new Float32Array(9),T=new Float32Array(16),I=[0,0],S=new Float32Array(9));const M=ai(v,C,E,T,S,y||[0,0],t.a1(e.transform.zoom),I,w,_||1,g,250),F=e.isTileAffectedByFog(n),P=e.getOrCreateProgram("rasterParticle",{defines:h,overrideFog:F});if(e.uploadCommonUniforms(o,P,u),l){const r=new t.ae(a.LEQUAL,t.ae.ReadWrite,e.depthRangeFor3D),n=0,o=e.globeSharedBuffers;if(o){const[s,l,c]=o.getGridBuffers(B,0!==n);P.draw(e,a.TRIANGLES,r,A,t.a.alphaBlended,t.af.backCCW,M,i.id,s,l,c)}}else{const r=e.depthModeForSublayer(0,t.ae.ReadOnly),o=c[n.overscaledZ],{tileBoundsBuffer:s,tileBoundsIndexBuffer:l,tileBoundsSegments:u}=e.getTileBoundsBuffers(p);P.draw(e,a.TRIANGLES,r,o,t.a.alphaBlended,t.af.disabled,M,i.id,s,l,u)}}e.resetStencilClippingMasks()}(e,r,i,n),e.style.map.triggerRepaint())},background:function(e,r,i,n){const o=i.paint.get("background-color"),a=i.paint.get("background-opacity"),s=i.paint.get("background-emissive-strength");if(0===a)return;const l=e.context,c=l.gl,u=e.transform,h=u.tileSize,A=i.paint.get("background-pattern");let p;if(void 0!==A){if(null===A)return;if(p=e.imageManager.getPattern(A.toString(),i.scope,e.style.getLut(i.scope)),!p)return}const d=!A&&1===o.a&&1===a&&e.opaquePassEnabledForLayer()?"opaque":"translucent";if(e.renderPass!==d)return;const f=t.ag.disabled,m=e.depthModeForSublayer(0,"opaque"===d?t.ae.ReadWrite:t.ae.ReadOnly),g=e.colorModeForDrapableLayerRenderPass(s),_=A?"backgroundPattern":"background";let y,v=n;v||(y=e.getBackgroundTiles(),v=Object.values(y).map((t=>t.tileID))),A&&(l.activeTexture.set(c.TEXTURE0),e.imageManager.bind(e.context,i.scope));for(const d of v){const v=e.isTileAffectedByFog(d),x=e.getOrCreateProgram(_,{overrideFog:v}),w=d.toUnwrapped(),b=n?d.projMatrix:e.transform.calculateProjMatrix(w);e.prepareDrawTile();const B=r?r.getTile(d):y?y[d.key]:new t.by(d,h,u.zoom,e),C=A?di(b,s,a,e,0,i.scope,p,{tileID:d,tileSize:h}):pi(b,s,a,o.toRenderColor(i.lut));e.uploadCommonUniforms(l,x,w);const{tileBoundsBuffer:E,tileBoundsIndexBuffer:T,tileBoundsSegments:I}=e.getTileBoundsBuffers(B);x.draw(e,c.TRIANGLES,m,f,g,t.af.disabled,C,i.id,E,T,I)}},sky:function(e,r,i){const n=e._atmosphere?t.a1(e.transform.zoom):1,o=i.paint.get("sky-opacity")*n;if(0===o)return;const a=e.context,s=i.paint.get("sky-type"),l=new t.ae(a.gl.LEQUAL,t.ae.ReadOnly,[0,1]),c=e.frameCounter/1e3%1;"atmosphere"===s?"offscreen"===e.renderPass?i.needsSkyboxCapture(e)&&(function(e,r){const i=e.context,n=i.gl;let o=r.skyboxFbo;if(!o){o=r.skyboxFbo=i.createFramebuffer(32,32,!0,null),r.skyboxGeometry=new nn(i),r.skyboxTexture=i.gl.createTexture(),n.bindTexture(n.TEXTURE_CUBE_MAP,r.skyboxTexture),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MAG_FILTER,n.LINEAR);for(let t=0;t<6;++t)n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,n.RGBA,32,32,0,n.RGBA,n.UNSIGNED_BYTE,null)}i.bindFramebuffer.set(o.framebuffer),i.viewport.set([0,0,32,32]);const a=r.getCenter(e,!0),s=e.getOrCreateProgram("skyboxCapture"),l=new Float64Array(16);t.ad.identity(l),t.ad.rotateY(l,l,.5*-Math.PI),on(e,r,s,l,a,0),t.ad.identity(l),t.ad.rotateY(l,l,.5*Math.PI),on(e,r,s,l,a,1),t.ad.identity(l),t.ad.rotateX(l,l,.5*-Math.PI),on(e,r,s,l,a,2),t.ad.identity(l),t.ad.rotateX(l,l,.5*Math.PI),on(e,r,s,l,a,3),t.ad.identity(l),on(e,r,s,l,a,4),t.ad.identity(l),t.ad.rotateY(l,l,Math.PI),on(e,r,s,l,a,5),i.viewport.set([0,0,e.width,e.height])}(e,i),i.markSkyboxValid(e)):"sky"===e.renderPass&&function(e,r,i,n,o){const a=e.context,s=a.gl,l=e.transform,c=e.getOrCreateProgram("skybox");a.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_CUBE_MAP,r.skyboxTexture);const u=((t,e,r,i,n)=>({u_matrix:t,u_sun_direction:e,u_cubemap:0,u_opacity:i,u_temporal_offset:n}))(l.skyboxMatrix,r.getCenter(e,!1),0,n,o);e.uploadCommonUniforms(a,c),c.draw(e,s.TRIANGLES,i,t.ag.disabled,e.colorModeForRenderPass(),t.af.backCW,u,"skybox",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}(e,i,l,o,c):"gradient"===s&&"sky"===e.renderPass&&function(e,r,i,n,o){const a=e.context,s=a.gl,l=e.transform,c=e.getOrCreateProgram("skyboxGradient");r.skyboxGeometry||(r.skyboxGeometry=new nn(a)),a.activeTexture.set(s.TEXTURE0);let u=r.colorRampTexture;u||(u=r.colorRampTexture=new t.T(a,r.colorRamp,s.RGBA)),u.bind(s.LINEAR,s.CLAMP_TO_EDGE);const h=((e,r,i,n,o)=>({u_matrix:e,u_color_ramp:0,u_center_direction:r,u_radius:t.ab(i),u_opacity:n,u_temporal_offset:o}))(l.skyboxMatrix,r.getCenter(e,!1),r.paint.get("sky-gradient-radius"),n,o);e.uploadCommonUniforms(a,c),c.draw(e,s.TRIANGLES,i,t.ag.disabled,e.colorModeForRenderPass(),t.af.backCW,h,"skyboxGradient",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}(e,i,l,o,c)},debug:function(e,r,i,n,o,a){for(let s=0;s<i.length;s++)if(o){const o=1,l=.8,c=new t.C(n.r*l,n.g*l,n.b*l,1);Xi(e,r,i[s],n,-o,-o,a),Xi(e,r,i[s],n,-o,o,a),Xi(e,r,i[s],n,o,o,a),Xi(e,r,i[s],n,o,-o,a),Xi(e,r,i[s],c,0,0,a)}else Xi(e,r,i[s],n,0,0,a)},custom:function(e,r,i,n){const o=e.context,a=i.implementation;if(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes("custom")||e.terrain&&(e.terrain.renderingToTexture||"offscreen"===e.renderPass)&&i.isDraped(r)){if("offscreen"===e.renderPass){const r=a.prerender;if(r){if(e.setCustomLayerDefaults(),o.setColorMode(e.colorModeForRenderPass()),"globe"===e.transform.projection.name){const i=e.transform.pointMerc;r.call(a,o.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),t.a1(e.transform.zoom),[i.x,i.y],e.transform.pixelsPerMeterRatio)}else r.call(a,o.gl,e.transform.customLayerMatrix());o.setDirty(),e.setBaseState()}}else if("translucent"===e.renderPass){if(e.terrain&&e.terrain.renderingToTexture){const r=a.renderToTile;if(r){const i=n[0].canonical,s=new t.Y(i.x+n[0].wrap*(1<<i.z),i.y,i.z);o.setDepthMode(t.ae.disabled),o.setStencilMode(t.ag.disabled),o.setColorMode(e.colorModeForRenderPass()),e.setCustomLayerDefaults(),r.call(a,o.gl,s),o.setDirty(),e.setBaseState()}return}e.setCustomLayerDefaults(),o.setColorMode(e.colorModeForRenderPass()),o.setStencilMode(t.ag.disabled);const r="3d"===a.renderingMode?new t.ae(e.context.gl.LEQUAL,t.ae.ReadWrite,e.depthRangeFor3D):e.depthModeForSublayer(0,t.ae.ReadOnly);if(o.setDepthMode(r),"globe"===e.transform.projection.name){const r=e.transform.pointMerc;a.render(o.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),t.a1(e.transform.zoom),[r.x,r.y],e.transform.pixelsPerMeterRatio)}else a.render(o.gl,e.transform.customLayerMatrix());o.setDirty(),e.setBaseState(),o.bindFramebuffer.set(null)}}else t.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(e,r,i,n){if("opaque"===e.renderPass)return;const o=i.paint.get("model-opacity");if(0===o)return;const a=i.paint.get("model-cast-shadows");if("shadow"===e.renderPass){if(!a)return;if(e.terrain&&o<.65&&i._transitionablePaint._values["model-opacity"].value.expression instanceof t.Z)return}const s=e.shadowRenderer,l=i.paint.get("model-receive-shadows");s&&(s.useNormalOffset=!0,l||(s.enabled=!1));const c=()=>{s&&(s.useNormalOffset=!0,l||(s.enabled=!0))},u=r.getSource();if("light-beam"===e.renderPass&&"batched-model"!==u.type)return;if("vector"===u.type||"geojson"===u.type)return function(e,r,i,n,o){const a=e.transform;if("mercator"!==a.projection.name)return void t.w(`Drawing 3D models for ${a.projection.name} projection is not yet implemented`);const s=a.getFreeCameraOptions().position;if(!e.modelManager)return;const l=e.modelManager;i.modelManager=l;const c=e.shadowRenderer;if(!i._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const u=i._unevaluatedLayout._values["model-id"],h={...i.layout.get("model-id").parameters},A=e.style.order.indexOf(i.fqid);for(const p of n){const n=r.getTile(p).getBucket(i);if(!n||n.projection.name!==a.projection.name)continue;const d=n.getModelUris();d&&!n.modelsRequested&&(l.addModelsFromBucket(d,o),n.modelsRequested=!0);const f=_n(p,a);h.zoom=f;const m=u.possiblyEvaluate(h);if(mn(e,n,p),gn.shadowUniformsInitialized=!1,gn.useSingleShadowCascade=!!c&&0===c.getMaxCascadeForTile(p.toUnwrapped()),"shadow"===e.renderPass&&c){if(1===e.currentShadowCascade&&n.isInsideFirstShadowMapFrustum)continue;const r=a.calculatePosMatrix(p.toUnwrapped(),a.worldSize);if(gn.tileMatrix.set(r),gn.shadowTileMatrix=Float32Array.from(c.calculateShadowPassMatrixFromMatrix(r)),gn.aabb.min.fill(0),gn.aabb.max[0]=gn.aabb.max[1]=t.a3,gn.aabb.max[2]=0,xn(n,gn,e,i.scope))continue}const g=1<<p.canonical.z,_=[((s.x-p.wrap)*g-p.canonical.x)*t.a3,(s.y*g-p.canonical.y)*t.a3,s.z*g*t.a3];e.conflationActive&&Object.keys(n.instancesPerModel).length>0&&e.style.isLayerClipped(i,r.getSource())&&n.updateReplacement(p,e.replacementSource,A)&&(n.uploaded=!1,n.upload(e.context));for(let t in n.instancesPerModel){const r=n.instancesPerModel[t];r.features.length>0&&(t=m.evaluate(r.features[0].feature,{}));const a=l.getModel(t,o);if(a&&a.uploaded)for(const t of a.nodes)yn(e,i,t,r,_,p,gn)}}}(e,r,i,n,"vector"===u.type?i.scope:""),void c();if(!u.loaded())return;if("batched-model"===u.type)return function(e,r,i,n){i.resetLayerRenderingStats(e);const o=e.context,a=e.transform,s=e.style.fog,l=e.shadowRenderer;if("mercator"!==a.projection.name)return void t.w(`Drawing 3D landmark models for ${a.projection.name} projection is not yet implemented`);const c=e.transform.getFreeCameraOptions().position,u=t._.scale([],[c.x,c.y,c.z],e.transform.worldSize);t._.negate(u,u);const h=t.ad.identity([]),A=t.cg(a.center.lat,a.zoom),p=t.ad.fromScaling([],[1,1,1/A]);t.ad.translate(h,h,u);const d=i.paint.get("model-opacity"),f=new t.ae(o.gl.LEQUAL,t.ae.ReadWrite,e.depthRangeFor3D),m=new t.ae(o.gl.LEQUAL,t.ae.ReadOnly,e.depthRangeFor3D),g=new t.b6([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),_="shadow"===e.renderPass,y=_&&l?l.getCurrentCascadeFrustum():a.getFrustum(a.scaleZoom(a.worldSize)),v=i.paint.get("model-front-cutoff"),x=v[2]<1,w=fr(e,i.paint.get("model-cutoff-fade-range")),b=i.getLayerRenderingStats();(function(t,e,r,i){const n=t.terrain?t.terrain.exaggeration():0,o=t.transform.zoom;for(const a of i){const i=e.getTile(a).getBucket(r);i&&(t.conflationActive&&i.updateReplacement(a,t.replacementSource),i.evaluateScale(t,r),t.terrain&&n>0&&i.elevationUpdate(t.terrain,n,a,r.source),i.needsReEvaluation(t,o,r)&&i.evaluate(r))}})(e,r,i,n),function(){let c,u,A;x?(c=n.length-1,u=-1,A=-1):(c=0,u=n.length,A=1);for(let B=c;B!==u;B+=A){const c=n[B],u=r.getTile(c).getBucket(i);if(!u||!u.uploaded)continue;let A=!1;l&&(A=0===l.getMaxCascadeForTile(c.toUnwrapped()));const C=a.calculatePosMatrix(c.toUnwrapped(),a.worldSize),E=u.modelTraits,T=[];for(const r of u.getNodesInfo()){if(r.hiddenByReplacement)continue;if(!r.node.meshes)continue;const i=r.node;let n=0;e.terrain&&i.elevation&&(n=i.elevation*e.terrain.exaggeration());const o=r.evaluatedScale;if(o[0]<=1&&o[1]<=1&&o[2]<=1&&0===(()=>{const e=r.aabb;return g.min=[...e.min],g.max=[...e.max],g.min[2]+=n,g.max[2]+=n,t._.transformMat4(g.min,g.min,C),t._.transformMat4(g.max,g.max,C),g})().intersects(y))continue;const s=[...C],l=i.anchor?i.anchor[0]:0,c=i.anchor?i.anchor[1]:0;t.ad.translate(s,s,[l*(o[0]-1),c*(o[1]-1),n]),t._.exactEquals(o,t.cj)||t.ad.scale(s,s,o);const u=t.ad.multiply([],s,i.matrix),h=t.ad.multiply([],a.expandedFarZProjMatrix,u),A=t.ad.multiply([],a.expandedFarZProjMatrix,s),p=t.aA.transformMat4([],[l,c,n,1],h)[2];i.hidden=!1;let f=d;_||(x&&(f*=bn(s,a,r.aabb,v)),f*=wn(w,p)),0!==f?T.push({nodeInfo:r,depth:p,opacity:f,wvpForNode:h,wvpForTile:A,nodeModelMatrix:u,tileModelMatrix:s}):i.hidden=!0}_||T.sort(((t,e)=>!x||1===t.opacity&&1===e.opacity?t.depth<e.depth?-1:1:1===t.opacity?-1:1===e.opacity?1:t.depth>e.depth?-1:1));for(const r of T){const n=r.nodeInfo,c=n.node;let u=t.ad.multiply([],p,r.tileModelMatrix);t.ad.multiply(u,h,u);const d=t.ad.invert([],u);t.ad.transpose(d,d),t.ad.scale(d,d,vn),u=t.ad.multiply(u,u,c.matrix);const g="light-beam"===e.renderPass,y=E&t.cl.HasMapboxMeshFeatures,v=y?0:n.evaluatedRMEA[0][2];for(let h=0;h<c.meshes.length;++h){const p=c.meshes[h],x=h===c.lightMeshIndex;let w=r.wvpForNode;if(x){if(!g&&!e.terrain&&e.shadowRenderer){e.currentLayer<e.firstLightBeamLayer&&(e.firstLightBeamLayer=e.currentLayer);continue}w=r.wvpForTile}else if(g)continue;const B={defines:[]},C=[];if(An(B.defines,C,p,e,i.lut),y||B.defines.push("DIFFUSE_SHADED"),A&&B.defines.push("SHADOWS_SINGLE_CASCADE"),b&&(_?b.numRenderedVerticesInShadowPass+=p.vertexArray.length:b.numRenderedVerticesInTransparentPass+=p.vertexArray.length),_){fn(p,r.nodeModelMatrix,e,i);continue}let E=null;if(s){const t=hn(r.nodeModelMatrix,e.transform);if(E=new Float32Array(t),"globe"!==a.projection.name){const e=p.aabb.min,r=p.aabb.max,[i,n]=s.getOpacityForBounds(t,e[0],e[1],r[0],r[1]);B.overrideFog=i>=re||n>=re}}const T=p.material;let I;T.occlusionTexture&&T.occlusionTexture.offsetScale&&(I=T.occlusionTexture.offsetScale,B.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!_&&l&&(l.useNormalOffset=!!p.normalBuffer);const S=e.getOrCreateProgram("model",B);!_&&l&&l.setupShadowsFromMatrix(r.tileModelMatrix,S,l.useNormalOffset),e.uploadCommonUniforms(o,S,null,E);const M=T.pbrMetallicRoughness;M.metallicFactor=.9,M.roughnessFactor=.5;const F=mi(new Float32Array(w),new Float32Array(u),new Float32Array(d),new Float32Array(c.matrix),e,r.opacity,M.baseColorFactor.toRenderColor(null),T.emissiveFactor,M.metallicFactor,M.roughnessFactor,T,v,i,[0,0,0],I);!x&&(n.hasTranslucentParts||r.opacity<1)&&S.draw(e,o.gl.TRIANGLES,f,t.ag.disabled,t.a.disabled,t.af.backCCW,F,i.id,p.vertexBuffer,p.indexBuffer,p.segments,i.paint,e.transform.zoom,void 0,C),S.draw(e,o.gl.TRIANGLES,x?m:f,t.ag.disabled,x||r.opacity<1||n.hasTranslucentParts?t.a.alphaBlended:t.a.unblended,t.af.backCCW,F,i.id,p.vertexBuffer,p.indexBuffer,p.segments,i.paint,e.transform.zoom,void 0,C)}}}}()}(e,r,i,n),void c();if("model"!==u.type)return;const h=u.getModels(),A=[],p=e.transform.getFreeCameraOptions().position,d=t._.scale([],[p.x,p.y,p.z],e.transform.worldSize);t._.negate(d,d);const f=[],m=[];let g=0;for(const r of h){const n=i.paint.get("model-rotation").constantOr(null),o=i.paint.get("model-scale").constantOr(null),a=i.paint.get("model-translation").constantOr(null);r.computeModelMatrix(e,n,o,a,!0,!0,!1);const s=t.ad.identity([]),l=t.cg(r.position.lat,e.transform.zoom),c=t.ad.fromScaling([],[1,1,1/l]);t.ad.translate(s,s,d),A.push({zScaleMatrix:c,negCameraPosMatrix:s});for(const t of r.nodes)dn(e.transform,t,r.matrix,e.transform.expandedFarZProjMatrix,g,f,m);g++}if(f.sort(((t,e)=>e.depth-t.depth)),"shadow"!==e.renderPass){if(1===o)for(const r of m)pn(r,e,i,A[r.modelIndex],t.ag.disabled,e.colorModeForRenderPass());else{for(const r of m)pn(r,e,i,A[r.modelIndex],t.ag.disabled,t.a.disabled);for(const t of m)pn(t,e,i,A[t.modelIndex],e.stencilModeFor3D(),e.colorModeForRenderPass());e.resetStencilClippingMasks()}for(const r of f)pn(r,e,i,A[r.modelIndex],t.ag.disabled,e.colorModeForRenderPass());c()}else{for(const t of m)fn(t.mesh,t.nodeModelMatrix,e,i);for(const t of f)fn(t.mesh,t.nodeModelMatrix,e,i);c()}}},Sn={model:function(t,e,r){const i=e.getSource();if(!i.loaded())return;if("vector"===i.type||"geojson"===i.type)return void(r.modelManager&&r.modelManager.upload(r,"vector"===i.type?t.scope:""));if("batched-model"===i.type)return;if("model"!==i.type)return;const n=i.getModels();for(const t of n)t.upload(r.context)},raster:function(t,e,r){const i=e.getSource();if(!(i instanceof Fr&&i.loaded()))return;const n=t.sourceLayer||i.rasterLayerIds&&i.rasterLayerIds[0];if(!n)return;const o=t.paint.get("raster-array-band")||i.getInitialBand(n);if(null==o)return;const a=e.getIds().map((t=>e.getTileByID(t)));for(const t of a)t.updateNeeded(n,o)&&i.prepareTile(t,n,o)},"raster-particle":function(t,e,r){const i=e.getSource();if(!(i instanceof Fr&&i.loaded()))return;const n=t.sourceLayer||i.rasterLayerIds&&i.rasterLayerIds[0];if(!n)return;const o=t.paint.get("raster-particle-array-band")||i.getInitialBand(n);if(null==o)return;const a=e.getIds().map((t=>e.getTileByID(t)));for(const t of a)t.updateNeeded(n,o)&&i.prepareTile(t,n,o)}};class Mn{constructor(e,r,i,n){this.context=new ot(e,r),this.occlusionBuffers=new Tn(this.context),this.transform=i,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=n,this._timeStamp=t.e.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const o=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const t of o)this._debugParams.enabledLayers[t]=!0;n.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},(()=>{this.style.map.triggerRepaint()})),n.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),n.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),n.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),n.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const t of o)n.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],t);this.symbolParams=new st(n),this.setup(),this.numSublayers=t.bv.maxUnderzooming+t.bv.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new t.co,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new yr(this),this._wireframeDebugCache=new Cn,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[]}updateTerrain(t,e){const r=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(r||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new zr(this,t));const i=this._terrain;this.transform.elevation=r?i:null,i.update(t,this.transform,e),this.transform.elevation&&!i.enabled&&(this.transform.elevation=null)}_updateFog(t){const e=t.fog;if(!e||"globe"===this.transform.projection.name||e.getOpacity(this.transform.pitch)<1||e.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[r,i]=e.getFovAdjustedRange(this.transform._fov);if(r>i)return void(this.transform.fogCullDistSq=null);const n=r+.78*(i-r);this.transform.fogCullDistSq=n*n}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new zr(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(e,r){if(this.width=e*t.e.devicePixelRatio,this.height=r*t.e.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const t of this.style.order)this.style._mergedLayers[t].resize()}setup(){const e=this.context,r=new t.bt;r.emplaceBack(0,0),r.emplaceBack(t.a3,0),r.emplaceBack(0,t.a3),r.emplaceBack(t.a3,t.a3),this.tileExtentBuffer=e.createVertexBuffer(r,t.br.members),this.tileExtentSegments=t.b.simpleSegment(0,0,4,2);const i=new t.bt;i.emplaceBack(0,0),i.emplaceBack(t.a3,0),i.emplaceBack(0,t.a3),i.emplaceBack(t.a3,t.a3),this.debugBuffer=e.createVertexBuffer(i,t.br.members),this.debugSegments=t.b.simpleSegment(0,0,4,5);const n=new t.bt;n.emplaceBack(-1,-1),n.emplaceBack(1,-1),n.emplaceBack(-1,1),n.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(n,t.br.members),this.viewportSegments=t.b.simpleSegment(0,0,4,2);const o=new t.cp;o.emplaceBack(0,0,0,0),o.emplaceBack(t.a3,0,t.a3,0),o.emplaceBack(0,t.a3,0,t.a3),o.emplaceBack(t.a3,t.a3,t.a3,t.a3),this.mercatorBoundsBuffer=e.createVertexBuffer(o,t.cq.members),this.mercatorBoundsSegments=t.b.simpleSegment(0,0,4,2);const a=new t.bu;a.emplaceBack(0,1,2),a.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(a);const s=new t.cr;for(const t of[0,1,3,2,0])s.emplaceBack(t);this.debugIndexBuffer=e.createIndexBuffer(s),this.emptyTexture=new t.T(e,new t.i({width:1,height:1},Uint8Array.of(0,0,0,0)),e.gl.RGBA),this.identityMat=t.ad.create();const l=this.context.gl;this.stencilClearMode=new t.ag({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const e=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,e.TRIANGLES,t.ae.disabled,this.stencilClearMode,t.a.disabled,t.af.disabled,Sr(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(e,r,i){if(!r||this.currentStencilSource===r.id||!e.isTileClipped()||!i||0===i.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let t=!1;for(const e of i)if(void 0===this._tileClippingMaskIDs[e.key]){t=!0;break}if(!t)return}this.currentStencilSource=r.id;const n=this.context,o=n.gl;this.nextStencilID+i.length>256&&this.clearStencil(),n.setColorMode(t.a.disabled),n.setDepthMode(t.ae.disabled);const a=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const e of i){const i=r.getTile(e),n=this._tileClippingMaskIDs[e.key]=this.nextStencilID++,{tileBoundsBuffer:s,tileBoundsIndexBuffer:l,tileBoundsSegments:c}=this.getTileBoundsBuffers(i);a.draw(this,o.TRIANGLES,t.ae.disabled,new t.ag({func:o.ALWAYS,mask:0},n,255,o.KEEP,o.KEEP,o.REPLACE),t.a.disabled,t.af.disabled,Sr(e.projMatrix),"$clipping",s,l,c)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,r=this.context.gl;return new t.ag({func:r.NOTEQUAL,mask:255},e,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(e){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(e);const r=this.context.gl;return new t.ag({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,r.KEEP,r.KEEP,r.REPLACE)}stencilConfigForOverlap(e){const r=this.context.gl,i=e.sort(((t,e)=>e.overscaledZ-t.overscaledZ)),n=i[i.length-1].overscaledZ,o=i[0].overscaledZ-n+1;if(o>1){this.currentStencilSource=void 0,this.nextStencilID+o>256&&this.clearStencil();const e={};for(let i=0;i<o;i++)e[i+n]=new t.ag({func:r.GEQUAL,mask:255},i+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=o,[e,i]}return[{[n]:t.ag.disabled},i]}colorModeForRenderPass(){const e=this.context.gl;if(this._showOverdrawInspector){const r=1/8;return new t.a([e.CONSTANT_COLOR,e.ONE,e.CONSTANT_COLOR,e.ONE],new t.C(r,r,r,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?t.a.unblended:t.a.alphaBlended}colorModeForDrapableLayerRenderPass(e){const r=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?new t.a([r.ONE,r.ONE_MINUS_SRC_ALPHA,r.CONSTANT_ALPHA,r.ONE_MINUS_SRC_ALPHA],new t.C(0,0,0,void 0===e?0:e),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(e,r,i,n=!1){if(this.depthOcclusion)return new t.ae(this.context.gl.GREATER,t.ae.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!n)return t.ae.disabled;const o=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new t.ae(i||this.context.gl.LEQUAL,r,[o,o])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const e=this.context.gl,r=Math.ceil(this.width),i=Math.ceil(this.height),n=this.context.bindFramebuffer.get(),o=e.getParameter(e.TEXTURE_BINDING_2D);this.terrainDepthFBO&&this.terrainDepthFBO.width===r&&this.terrainDepthFBO.height===i||(this.terrainDepthFBO&&(this.terrainDepthFBO.destroy(),this.terrainDepthFBO=void 0,this.terrainDepthTexture=void 0),0!==r&&0!==i&&(this.terrainDepthFBO=new nt(this.context,r,i,!1,"texture"),this.terrainDepthTexture=new t.T(this.context,{width:r,height:i,data:null},e.DEPTH_STENCIL),this.terrainDepthFBO.depthAttachment.set(this.terrainDepthTexture.texture))),this.context.bindFramebuffer.set(n),e.bindTexture(e.TEXTURE_2D,o),this.terrainDepthFBO&&(e.bindFramebuffer(e.READ_FRAMEBUFFER,null),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,this.terrainDepthFBO.framebuffer),e.blitFramebuffer(0,0,r,i,0,0,r,i,e.DEPTH_BUFFER_BIT,e.NEAREST),e.bindFramebuffer(e.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(0===this._dt?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce(((t,e)=>t+e/this._fpsHistory.length),0))}render(e,r){const i=t.e.now();this._dt=i-this._timeStamp,this._timeStamp=i,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=e.map.repaint,this.style=e,this.options=r;const n=this.style._mergedLayers,o=this.style.order.filter((t=>{const e=n[t];return!(e.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[e.type]})),a=o.map((t=>n[t])),s=this.style._mergedSourceCaches;this.imageManager=e.imageManager,this.modelManager=e.modelManager,this.symbolFadeChange=e.placement.symbolFadeChange(t.e.now()),this.imageManager.beginFrame();let l=0,c=!1;for(const t in s){const e=s[t];e.used&&(e.prepare(this.context),e.getSource().usedInConflation&&++l)}let u=!1;for(const t of a)t.isHidden(this.transform.zoom)||("clip"===t.type&&(u=!0),this.prepareLayer(t));const h={},A={},p={},d={},f={};for(const t in s){const e=s[t];h[t]=e.getVisibleCoordinates(),A[t]=h[t].slice().reverse(),p[t]=e.getVisibleCoordinates(!0).reverse(),d[t]=e.getShadowCasterCoordinates(),f[t]=e.sortCoordinatesByDistance(h[t])}const m=t=>{const e=this.style.getLayerSourceCache(t);return e&&e.used?e.getSource():null};if(l||u){const e=[],r=[];let i=0;for(const t of a)this.isSourceForClippingOrConflation(t,m(t))&&(e.push(t),r.push(i)),i++;if(e&&(u||e.length>1)){const i=[];for(let n=0;n<e.length;n++){const o=e[n],a=r[n],s=this.style.getLayerSourceCache(o);if(!s||!s.used||!s.getSource().usedInConflation&&"clip"!==o.type)continue;let l=1/0,c=t.cu.None;if("clip"===o.type){l=a;for(const e of o.layout.get("clip-layer-types"))c|="model"===e?t.cu.Model:"symbol"===e?t.cu.Symbol:t.cu.FillExtrusion}i.push({layer:o.fqid,cache:s,order:l,clipMask:c})}this.replacementSource.setSources(i),c=!0}}c||this.replacementSource.clear(),this.conflationActive=c,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let t=0;t<a.length;t++){const e=a[t],r=e.cutoffRange();if(this.longestCutoffRange=Math.max(r,this.longestCutoffRange),r>0){const t=m(e);t&&(this.minCutoffZoom=Math.max(t.minzoom,this.minCutoffZoom)),e.minzoom&&(this.minCutoffZoom=Math.max(e.minzoom,this.minCutoffZoom))}e.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=t),this._lastOcclusionLayer=t)}const g=this.style&&this.style.fog;g?(this._fogVisible=0!==g.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=g.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(p),this.opaquePassCutoff=0);const _=this._shadowRenderer;if(_){_.updateShadowParameters(this.transform,this.style.directionalLight);for(const t in s)for(const e of h[t]){let t={min:0,max:0};this.terrain&&(t=this.terrain.getMinMaxForTile(e)||t),_.addShadowReceiver(e.toUnwrapped(),t.min,t.max)}}if("globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new t.cs(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new un(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!t.ct(this.context.gl))return;this.renderPass="offscreen";for(const t of a){const r=e.getLayerSourceCache(t);if(!t.hasOffscreenPass()||t.isHidden(this.transform.zoom))continue;const i=r?A[r.id]:void 0;("custom"===t.type||"raster"===t.type||"raster-particle"===t.type||t.isSky()||i&&i.length)&&this.renderLayer(this,r,t,i)}this.depthRangeFor3D=[0,1-(a.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,d)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const y="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),v=(()=>{if(r.showOverdrawInspector)return t.C.black;const e=this.style.fog;if(e&&this.transform.projection.supportsFog){const r=this.style.getLut(e.scope);if(!y){const i=e.properties.get("color").toRenderColor(r).toArray01();return new t.C(...i)}if(y){const i=e.properties.get("space-color").toRenderColor(r).toArray01();return new t.C(...i)}}return t.C.transparent})();if(this.context.clear({color:v,depth:1}),this.clearStencil(),this._showOverdrawInspector=r.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&y&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=o.length-1;this.currentLayer>=0;this.currentLayer--){const t=a[this.currentLayer],r=e.getLayerSourceCache(t);if(t.isSky())continue;const i=r?(t.is3D()?f:A)[r.id]:void 0;this._renderTileClippingMasks(t,r,i),this.renderLayer(this,r,t,i)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&y&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||t.a1(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<o.length;this.currentLayer++){const t=a[this.currentLayer],r=e.getLayerSourceCache(t);t.isSky()&&this.renderLayer(this,r,t,r?A[r.id]:void 0)}function x(t,e){let r;return e&&(r=("symbol"===t.type?p:t.is3D()?f:A)[e.id]),r}if(this.renderPass="translucent","globe"===this.transform.projection.name){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<o.length;){const t=a[this.currentLayer];if("raster"===t.type){const r=e.getLayerSourceCache(t);this.renderLayer(this,r,t,x(t,r))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let w=0;_&&(w=_.getShadowCastingLayerCount());let b=!1;for(;this.currentLayer<o.length;){const t=a[this.currentLayer],r=e.getLayerSourceCache(t);if(t.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(t)){if(t.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(b||!this.terrain||!this.style.hasSymbolLayers()&&!this.style.hasCircleLayers()||this.transform.isOrthographic||(b=!0,this.blitDepth()),t.is3D()||this.terrain||this._renderTileClippingMasks(t,r,r?h[r.id]:void 0),this.renderLayer(this,r,t,x(t,r)),!this.terrain&&_&&w>0&&t.hasShadowPass()&&0==--w&&(_.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const t=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=t;this.currentLayer++){const t=a[this.currentLayer];if(!t.hasLightBeamPass())continue;const r=e.getLayerSourceCache(t);this.renderLayer(this,r,t,r?A[r.id]:void 0)}this.currentLayer=t,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const t=this.currentLayer;this.depthOcclusion=!0;for(const t of this.layersWithOcclusionOpacity){this.currentLayer=t;const r=a[this.currentLayer],i=e.getLayerSourceCache(r),n=i?A[i.id]:void 0;r.is3D()||this.terrain||this._renderTileClippingMasks(r,i,i?h[i.id]:void 0),this.renderLayer(this,i,r,n)}this.depthOcclusion=!1,this.currentLayer=t,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let r=null;a.forEach((t=>{const i=e.getLayerSourceCache(t);i&&!t.isHidden(this.transform.zoom)&&i.getVisibleCoordinates().length&&(!r||r.getSource().maxzoom<i.getSource().maxzoom)&&(r=i)})),r&&this.options.showTileBoundaries&&In.debug(this,r,r.getVisibleCoordinates(),t.C.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&In.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new t.C(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(t){const e=t.transform.padding;$i(t,t.transform.height-(e.top||0),3,Gi),$i(t,e.bottom||0,3,Ki),Yi(t,e.left||0,3,qi),Yi(t,t.transform.width-(e.right||0),3,Zi);const r=t.transform.centerPoint;!function(t,e,r,i){Ji(t,e-1,r-10,2,20,i),Ji(t,e-10,r-1,20,2,i)}(t,r.x,t.transform.height-r.y,Wi)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),c||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:e}=this.transform.projection,r=!e||!e.includes(t.type);if(Sn[t.type]&&(r||this.terrain&&"custom"===t.type)){const e=this.style.getLayerSourceCache(t);Sn[t.type](t,e,this)}this.gpuTimingEnd()}renderLayer(t,e,r,i){r.isHidden(this.transform.zoom)||("background"===r.type||"sky"===r.type||"custom"===r.type||"model"===r.type||"raster"===r.type||"raster-particle"===r.type||i&&i.length)&&(this.id=r.id,this.gpuTimingStart(r),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(r.type)&&(!t.terrain||"custom"!==r.type)||"clip"===r.type||In[r.type](t,e,r,i,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const e=this.context.extTimerQuery,r=this.context.gl;let i=this.gpuTimers[t.id];i||(i=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:r.createQuery()}),i.calls++,r.beginQuery(e.TIME_ELAPSED_EXT,i.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,e=this.context.gl,r=e.createQuery();this.deferredRenderGpuTimeQueries.push(r),e.beginQuery(t.TIME_ELAPSED_EXT,r)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const e={};for(const r in t){const i=t[r],n=this.context.extTimerQuery,o=n.getQueryParameter(i.query,this.context.gl.QUERY_RESULT)/1e6;n.deleteQueryEXT(i.query),e[r]=o}return e}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const e=this.context.extTimerQuery,r=this.context.gl;let i=0;for(const n of t)i+=e.getQueryParameter(n,r.QUERY_RESULT)/1e6,e.deleteQueryEXT(n);return i}translatePosMatrix(e,r,i,n,o){if(!i[0]&&!i[1])return e;const a=o?"map"===n?this.transform.angle:0:"viewport"===n?-this.transform.angle:0;if(a){const t=Math.sin(a),e=Math.cos(a);i=[i[0]*e-i[1]*t,i[0]*t+i[1]*e]}const s=[o?i[0]:t.bB(r,i[0],this.transform.zoom),o?i[1]:t.bB(r,i[1],this.transform.zoom),0],l=new Float32Array(16);return t.ad.translate(l,e,s),l}saveTileTexture(t){const e=t.size[0],r=this._tileTextures[e];r?r.push(t):this._tileTextures[e]=[t]}getTileTexture(t){const e=this._tileTextures[t];return e&&e.length>0?e.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(t,e,r){const i=void 0===r?this.terrain&&this.terrain.renderingToTexture:r,n=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===t||"terrainRaster"===t?(n.push("LIGHTING_3D_MODE"),n.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):i||n.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass?this._shadowMapDebug||n.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?n.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):n.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(n.push("TERRAIN"),this.linearFloatFilteringSupported()&&n.push("TERRAIN_DEM_FLOAT_FORMAT")),"globe"===this.transform.projection.name&&n.push("GLOBE"),!this._fogVisible||i||void 0!==e&&!e||n.push("FOG","FOG_DITHERING"),i&&n.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&n.push("OVERDRAW_INSPECTOR"),n}getOrCreateProgram(t,e){this.cache=this.cache||{};const r=e&&e.defines||[],i=e&&e.config,n=this.currentGlobalDefines(t,e&&e.overrideFog,e&&e.overrideRtt).concat(r),o=Nr.cacheKey(Ie[t],t,n,i);return this.cache[o]||(this.cache[o]=new Nr(this.context,t,Ie[t],i,yi[t],n)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.terrainDepthFBO&&(this.terrainDepthFBO.destroy(),this.terrainDepthFBO=void 0,this.terrainDepthTexture=void 0)}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(e,r){if(this.style.enable3dLights()){const i=this.style.directionalLight,n=this.style.ambientLight;if(i&&n){const o=((e,r,i)=>{const n=e.properties.get("direction"),o=e.properties.get("color").toRenderColor(i.getLut(e.scope)).toArray01(),a=e.properties.get("intensity"),s=r.properties.get("color").toRenderColor(i.getLut(r.scope)).toArray01(),l=r.properties.get("intensity"),c=[n.x,n.y,n.z],u=t.bA(s,l),h=t.bA(o,a);return{u_lighting_ambient_color:u,u_lighting_directional_dir:c,u_lighting_directional_color:h,u_ground_radiance:Rr(c,h,u)}})(i,n,this.style);r.setLightsUniformValues(e,o)}}}uploadCommonUniforms(e,r,i,n,o){if(this.uploadCommonLightUniforms(e,r),this.terrain&&this.terrain.renderingToTexture)return;const a=this.style.fog;if(a){const o=a.getOpacity(this.transform.pitch),s=((e,r,i,n,o,a,s,l,c,u,h,A)=>{const p=e.transform,d=r.properties.get("color").toRenderColor(e.style.getLut(r.scope)).toArray01();d[3]=n;const f=e.frameCounter/1e3%1,[m,g]=r.properties.get("vertical-range");return{u_fog_matrix:i?p.calculateFogTileMatrix(i):A||e.identityMat,u_fog_range:r.getFovAdjustedRange(p._fov),u_fog_color:d,u_fog_horizon_blend:r.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(m,g),g],u_fog_temporal_offset:f,u_frustum_tl:o,u_frustum_tr:a,u_frustum_br:s,u_frustum_bl:l,u_globe_pos:c,u_globe_radius:u,u_viewport:h,u_globe_transition:t.a1(p.zoom),u_is_globe:+("globe"===p.projection.name)}})(this,a,i,o,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*t.e.devicePixelRatio,this.transform.height*t.e.devicePixelRatio],n);r.setFogUniformValues(e,s)}o&&r.setCutoffUniformValues(e,o.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),e}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&0!==t.getOpacity(this.transform.pitch)}getBackgroundTiles(){const e=this._backgroundTiles,r=this._backgroundTiles={},i=this.transform.coveringTiles({tileSize:512});for(const n of i)r[n.key]=e[n.key]||new t.by(n,512,this.transform.tileZoom,this);return r}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,e){return!(!t.is3D()||t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerIndices.length||"building"!==t.sourceLayer)&&"clip"!==t.type&&(!e||"batched-model"!==e.type))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let e=this._cachedTileFogOpacities[t.key];return e||(this._cachedTileFogOpacities[t.key]=e=this.style.fog.getOpacityForTile(t)),e[0]>=re||e[1]>=re}}class Fn{constructor(t,e,r,i){this.screenBounds=t,this.cameraPoint=e,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=r,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,i)}static createFromScreenPoints(e,r){let i,n;if(e instanceof t.P||"number"==typeof e[0]){const o=t.P.convert(e);i=[o],n=r.isPointAboveHorizon(o)}else{const o=t.P.convert(e[0]),a=t.P.convert(e[1]);i=[o,a],n=t.cv(o,a).every((t=>r.isPointAboveHorizon(t)))}return new Fn(i,r.getCameraPoint(),n,r)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(e){return t.cv(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],e)}bufferedCameraGeometry(e){const r=this.screenBounds[0],i=1===this.screenBounds.length?this.screenBounds[0].add(new t.P(1,1)):this.screenBounds[1],n=t.cv(r,i,0,!1);return this.cameraPoint.y>i.y&&(this.cameraPoint.x>r.x&&this.cameraPoint.x<i.x?n.splice(3,0,this.cameraPoint):this.cameraPoint.x>=i.x?n[2]=this.cameraPoint:this.cameraPoint.x<=r.x&&(n[3]=this.cameraPoint)),t.cw(n,e)}bufferedCameraGeometryGlobe(e){const r=this.screenBounds[0],i=1===this.screenBounds.length?this.screenBounds[0].add(new t.P(1,1)):this.screenBounds[1],n=t.cv(r,i,e),o=this.cameraPoint.clone();switch(3*((o.y>r.y)+(o.y>i.y))+((o.x>r.x)+(o.x>i.x))){case 0:n[0]=o,n[4]=o.clone();break;case 1:n.splice(1,0,o);break;case 2:n[1]=o;break;case 3:n.splice(4,0,o);break;case 5:n.splice(2,0,o);break;case 6:n[3]=o;break;case 7:n.splice(3,0,o);break;case 8:n[2]=o}return n}containsTile(e,r,i,n=0){const o=e.queryPadding/r._pixelsPerMercatorPixel+1,a=i?this._bufferedCameraMercator(o,r):this._bufferedScreenMercator(o,r);let s=e.tileID.wrap+(a.unwrapped?n:0);const l=a.polygon.map((r=>t.cx(e.tileTransform,r,s)));if(!t.cy(l,0,0,t.a3,t.a3))return;s=e.tileID.wrap+(this.screenGeometryMercator.unwrapped?n:0);const c=this.screenGeometryMercator.polygon.map((r=>t.cz(e.tileTransform,r,s))),u=c.map((e=>new t.P(e[0],e[1]))),h=r.getFreeCameraOptions().position||new t.Y(0,0,0),A=t.cz(e.tileTransform,h,s),p=c.map((e=>{const r=t._.sub(e,e,A);return t._.normalize(r,r),new t.aT(A,r)})),d=t.bB(e,1,r.zoom)*r._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:u,tilespaceRays:p,bufferedTilespaceGeometry:l,bufferedTilespaceBounds:(f=t.cA(l),f.min.x=t.at(f.min.x,0,t.a3),f.min.y=t.at(f.min.y,0,t.a3),f.max.x=t.at(f.max.x,0,t.a3),f.max.y=t.at(f.max.y,0,t.a3),f),tile:e,tileID:e.tileID,pixelToTileUnitsFactor:d};var f}_bufferedScreenMercator(t,e){const r=Dn(t);if(this._screenRaycastCache[r])return this._screenRaycastCache[r];{let i;return i="globe"===e.projection.name?this._projectAndResample(this.bufferedScreenGeometry(t),e):{polygon:this.bufferedScreenGeometry(t).map((t=>e.pointCoordinate3D(t))),unwrapped:!0},this._screenRaycastCache[r]=i,i}}_bufferedCameraMercator(t,e){const r=Dn(t);if(this._cameraRaycastCache[r])return this._cameraRaycastCache[r];{let i;return i="globe"===e.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),e):{polygon:this.bufferedCameraGeometry(t).map((t=>e.pointCoordinate3D(t))),unwrapped:!0},this._cameraRaycastCache[r]=i,i}}_projectAndResample(e,r){const i=function(e,r){const i=t.ad.multiply([],r.pixelMatrix,r.globeMatrix),n=[0,-t.cD,0,1],o=[0,t.cD,0,1],a=[0,0,0,1];t.aA.transformMat4(n,n,i),t.aA.transformMat4(o,o,i),t.aA.transformMat4(a,a,i);const s=new t.P(n[0]/n[3],n[1]/n[3]),l=new t.P(o[0]/o[3],o[1]/o[3]),c=t.cB(e,s)&&n[3]<a[3],u=t.cB(e,l)&&o[3]<a[3];if(!c&&!u)return null;const h=function(t,e,r){for(let i=1;i<t.length;i++){const n=Ln(e.pointCoordinate3D(t[i-1]).x),o=Ln(e.pointCoordinate3D(t[i]).x);if(r<0){if(n<o)return{idx:i,t:-n/(o-1-n)}}else if(o<n)return{idx:i,t:(1-n)/(o+1-n)}}return null}(e,r,c?-1:1);if(!h)return null;const{idx:A,t:p}=h;let d=A>1?Pn(e.slice(0,A),r):[],f=A<e.length?Pn(e.slice(A),r):[];d=d.map((e=>new t.P(Ln(e.x),e.y))),f=f.map((e=>new t.P(Ln(e.x),e.y)));const m=[...d];0===m.length&&m.push(f[f.length-1]);const g=t.a2(m[m.length-1].y,(0===f.length?d[0]:f[0]).y,p);let _;return _=c?[new t.P(0,g),new t.P(0,0),new t.P(1,0),new t.P(1,g)]:[new t.P(1,g),new t.P(1,1),new t.P(0,1),new t.P(0,g)],m.push(..._),0===f.length?m.push(d[0]):m.push(...f),{polygon:m.map((e=>new t.Y(e.x,e.y))),unwrapped:!1}}(e,r);if(i)return i;const n=function(e,r){let i=!1,n=-1/0,o=0;for(let t=0;t<e.length-1;t++)e[t].x>n&&(n=e[t].x,o=t);for(let t=0;t<e.length-1;t++){const r=(o+t)%(e.length-1),n=e[r],a=e[r+1];Math.abs(n.x-a.x)>.5&&(n.x<a.x?(n.x+=1,0===r&&(e[e.length-1].x+=1)):(a.x+=1,r+1===e.length-1&&(e[0].x+=1)),i=!0)}const a=t.aj(r.center.lng);return i&&a<Math.abs(a-1)&&e.forEach((t=>{t.x-=1})),{polygon:e,unwrapped:i}}(Pn(e,r).map((e=>new t.P(Ln(e.x),e.y))),r);return{polygon:n.polygon.map((e=>new t.Y(e.x,e.y))),unwrapped:n.unwrapped}}}function Pn(e,r){return t.cC(e,(t=>{const e=r.pointCoordinate3D(t);t.x=e.x,t.y=e.y}),1/256)}function Ln(t){return t<0?1+t%1:t%1}function Dn(t){return 100*t|0}function Un(e,r){const i=t.ad.identity([]);return t.ad.scale(i,i,[.5*e.width,.5*-e.height,1]),t.ad.translate(i,i,[1,-1,0]),t.ad.multiply(i,i,e.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(i)}function kn(t,e,r,i,n,o,a,s=!1){const l=t.tilesIn(i,a,s);l.sort(Rn);const c=[];for(const i of l)c.push({wrappedTileID:i.tile.tileID.wrapped().key,queryResults:i.tile.queryRenderedFeatures(e,r,t._state,i,n,o,Un(t.transform,i.tile.tileID),s)});const u=function(t){const e={},r={};for(const i of t){const t=i.queryResults,n=i.wrappedTileID,o=r[n]=r[n]||{};for(const r in t){const i=t[r],n=o[r]=o[r]||{},a=e[r]=e[r]||[];for(const t of i)n[t.featureIndex]||(n[t.featureIndex]=!0,a.push(t))}}return e}(c);for(const e in u)u[e].forEach((e=>{const r=e.feature,i=r.layer;i&&"background"!==i.type&&"sky"!==i.type&&"slot"!==i.type&&(r.source=i.source,i["source-layer"]&&(r.sourceLayer=i["source-layer"]),r.state=void 0!==r.id?t.getFeatureState(i["source-layer"],r.id):{})}));return u}function zn(t,e){const r=t.getRenderableIds().map((e=>t.getTileByID(e))),i=[],n={};for(let t=0;t<r.length;t++){const o=r[t],a=o.tileID.canonical.key;n[a]||(n[a]=!0,o.querySourceFeatures(i,e))}return i}function Rn(t,e){const r=t.tileID,i=e.tileID;return r.overscaledZ-i.overscaledZ||r.canonical.y-i.canonical.y||r.wrap-i.wrap||r.canonical.x-i.canonical.x}class On{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,e=!1;for(const r in this.style._mergedLayers){const i=this.style._mergedLayers[r];if("fill-extrusion"===i.type)this.layers.push({layer:i,visible:t,visibilityChanged:e});else if("model"===i.type){const r=this.style.getLayerSource(i);r&&"batched-model"===r.type&&this.layers.push({layer:i,visible:t,visibilityChanged:e})}}}onNewFrame(t){this.layersGotHidden=!1;for(const e of this.layers){const r=e.layer;let i=!1;"fill-extrusion"===r.type?i=!r.isHidden(t)&&r.paint.get("fill-extrusion-opacity")>0:"model"===r.type&&(i=!r.isHidden(t)&&r.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!i&&e.visible,e.visible=i}}updateZOffset(t,e){this.currentBuildingBuckets=[];for(const t of this.layers){const r=t.layer,i=this.style.getLayerSourceCache(r);let n=1;"fill-extrusion"===r.type&&(n=t.visible?r.paint.get("fill-extrusion-vertical-scale"):0);let o=i?i.getTile(e):null;if(!o&&i&&e.canonical.z>i.getSource().minzoom){let t=e.scaledTo(Math.min(i.getSource().maxzoom,e.overscaledZ-1));for(;t.overscaledZ>=i.getSource().minzoom&&(o=i.getTile(t),!o&&0!==t.overscaledZ);)t=t.scaledTo(t.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:o?o.getBucket(r):null,tileID:o?o.tileID:e,verticalScale:n})}t.hasAnyZOffset=!1;let r=!1;for(let i=0;i<t.symbolInstances.length;i++){const n=t.symbolInstances.get(i),o=n.zOffset,a=this._getHeightAtTileOffset(e,n.tileAnchorX,n.tileAnchorY);n.zOffset=a!==Number.NEGATIVE_INFINITY?a:o,r||o===n.zOffset||(r=!0),t.hasAnyZOffset||0===n.zOffset||(t.hasAnyZOffset=!0)}r&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(e,r,i,n){let o=r,a=i;if(e.canonical.z!==n.canonical.z){const s=n.canonical,l=1/(1<<e.canonical.z-s.z);o=(r+e.canonical.x*t.a3)*l-s.x*t.a3|0,a=(i+e.canonical.y*t.a3)*l-s.y*t.a3|0}return{tileX:o,tileY:a}}_getHeightAtTileOffset(t,e,r){let i,n;for(let o=0;o<this.layers.length;++o){if("fill-extrusion"!==this.layers[o].layer.type)continue;const{bucket:a,tileID:s,verticalScale:l}=this.currentBuildingBuckets[o];if(!a)continue;const{tileX:c,tileY:u}=this._mapCoordToOverlappingTile(t,e,r,s),h=a.getHeightAtTileCoord(c,u);h&&void 0!==h.height&&(h.hidden?i=h.height:n=Math.max(h.height*l,n||0))}if(void 0!==n)return n;for(let n=0;n<this.layers.length;++n){const o=this.layers[n];if("model"!==o.layer.type||!o.visible)continue;const{bucket:a,tileID:s}=this.currentBuildingBuckets[n];if(!a)continue;const{tileX:l,tileY:c}=this._mapCoordToOverlappingTile(t,e,r,s),u=a.getHeightAtTileCoord(l,c);if(u&&!u.hidden)return void 0===u.height&&void 0!==i?Math.min(u.maxHeight,i)*u.verticalScale:u.height?u.height*u.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Qn(e,r){const i={};for(const t in e)"ref"!==t&&(i[t]=e[t]);return t.cE.forEach((t=>{t in r&&(i[t]=r[t])})),i}function Nn(t){t=t.slice();const e=Object.create(null);for(let r=0;r<t.length;r++)e[t[r].id]=t[r];for(let r=0;r<t.length;r++)"ref"in t[r]&&(t[r]=Qn(t[r],e[t[r].ref]));return t}const Vn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Hn(t,e,r){r.push({command:Vn.addSource,args:[t,e[t]]})}function jn(t,e,r){e.push({command:Vn.removeSource,args:[t]}),r[t]=!0}function Gn(t,e,r,i){jn(t,r,i),Hn(t,e,r)}function Kn(t,r,i){let n;for(n in t[i])if(t[i].hasOwnProperty(n)&&"data"!==n&&!e(t[i][n],r[i][n]))return!1;for(n in r[i])if(r[i].hasOwnProperty(n)&&"data"!==n&&!e(t[i][n],r[i][n]))return!1;return!0}function qn(t,r,i,n,o,a){let s;for(s in r=r||{},t=t||{})t.hasOwnProperty(s)&&(e(t[s],r[s])||i.push({command:a,args:[n,s,r[s],o]}));for(s in r)r.hasOwnProperty(s)&&!t.hasOwnProperty(s)&&(e(t[s],r[s])||i.push({command:a,args:[n,s,r[s],o]}))}function Zn(t){return t.id}function Wn(t,e){return t[e.id]=e,t}class Xn{constructor(t,e){this.reset(t,e)}reset(t,e){this.points=t||[],this._distances=[0];for(let t=1;t<this.points.length;t++)this._distances[t]=this._distances[t-1]+this.points[t].dist(this.points[t-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(e||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(1===this.points.length)return this.points[0];e=t.at(e,0,1);let r=1,i=this._distances[r];const n=e*this.paddedLength+this.padding;for(;i<n&&r<this._distances.length;)i=this._distances[++r];const o=r-1,a=this._distances[o],s=i-a,l=s>0?(n-a)/s:0;return this.points[o].mult(1-l).add(this.points[r].mult(l))}}class $n{constructor(t,e,r){const i=this.boxCells=[],n=this.circleCells=[];this.xCellCount=Math.ceil(t/r),this.yCellCount=Math.ceil(e/r);for(let t=0;t<this.xCellCount*this.yCellCount;t++)i.push([]),n.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,e,r,i,n){this._forEachCell(e,r,i,n,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(i),this.bboxes.push(n)}insertCircle(t,e,r,i){this._forEachCell(e-i,r-i,e+i,r+i,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(r),this.circles.push(i)}_insertBoxCell(t,e,r,i,n,o){this.boxCells[n].push(o)}_insertCircleCell(t,e,r,i,n,o){this.circleCells[n].push(o)}_query(t,e,r,i,n,o){if(r<0||t>this.width||i<0||e>this.height)return!n&&[];const a=[];if(t<=0&&e<=0&&this.width<=r&&this.height<=i){if(n)return!0;for(let t=0;t<this.boxKeys.length;t++)a.push({key:this.boxKeys[t],x1:this.bboxes[4*t],y1:this.bboxes[4*t+1],x2:this.bboxes[4*t+2],y2:this.bboxes[4*t+3]});for(let t=0;t<this.circleKeys.length;t++){const e=this.circles[3*t],r=this.circles[3*t+1],i=this.circles[3*t+2];a.push({key:this.circleKeys[t],x1:e-i,y1:r-i,x2:e+i,y2:r+i})}return o?a.filter(o):a}return this._forEachCell(t,e,r,i,this._queryCell,a,{hitTest:n,seenUids:{box:{},circle:{}}},o),n?a.length>0:a}_queryCircle(t,e,r,i,n){const o=t-r,a=t+r,s=e-r,l=e+r;if(a<0||o>this.width||l<0||s>this.height)return!i&&[];const c=[];return this._forEachCell(o,s,a,l,this._queryCellCircle,c,{hitTest:i,circle:{x:t,y:e,radius:r},seenUids:{box:{},circle:{}}},n),i?c.length>0:c}query(t,e,r,i,n){return this._query(t,e,r,i,!1,n)}hitTest(t,e,r,i,n){return this._query(t,e,r,i,!0,n)}hitTestCircle(t,e,r,i){return this._queryCircle(t,e,r,!0,i)}_queryCell(t,e,r,i,n,o,a,s){const l=a.seenUids,c=this.boxCells[n];if(null!==c){const n=this.bboxes;for(const u of c)if(!l.box[u]){l.box[u]=!0;const c=4*u;if(t<=n[c+2]&&e<=n[c+3]&&r>=n[c+0]&&i>=n[c+1]&&(!s||s(this.boxKeys[u]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[u],x1:n[c],y1:n[c+1],x2:n[c+2],y2:n[c+3]})}}}const u=this.circleCells[n];if(null!==u){const n=this.circles;for(const c of u)if(!l.circle[c]){l.circle[c]=!0;const u=3*c;if(this._circleAndRectCollide(n[u],n[u+1],n[u+2],t,e,r,i)&&(!s||s(this.circleKeys[c]))){if(a.hitTest)return o.push(!0),!0;{const t=n[u],e=n[u+1],r=n[u+2];o.push({key:this.circleKeys[c],x1:t-r,y1:e-r,x2:t+r,y2:e+r})}}}}}_queryCellCircle(t,e,r,i,n,o,a,s){const l=a.circle,c=a.seenUids,u=this.boxCells[n];if(null!==u){const t=this.bboxes;for(const e of u)if(!c.box[e]){c.box[e]=!0;const r=4*e;if(this._circleAndRectCollide(l.x,l.y,l.radius,t[r+0],t[r+1],t[r+2],t[r+3])&&(!s||s(this.boxKeys[e])))return o.push(!0),!0}}const h=this.circleCells[n];if(null!==h){const t=this.circles;for(const e of h)if(!c.circle[e]){c.circle[e]=!0;const r=3*e;if(this._circlesCollide(t[r],t[r+1],t[r+2],l.x,l.y,l.radius)&&(!s||s(this.circleKeys[e])))return o.push(!0),!0}}}_forEachCell(t,e,r,i,n,o,a,s){const l=this._convertToXCellCoord(t),c=this._convertToYCellCoord(e),u=this._convertToXCellCoord(r),h=this._convertToYCellCoord(i);for(let A=l;A<=u;A++)for(let l=c;l<=h;l++)if(n.call(this,t,e,r,i,this.xCellCount*l+A,o,a,s))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,e,r,i,n,o){const a=i-t,s=n-e,l=r+o;return l*l>a*a+s*s}_circleAndRectCollide(t,e,r,i,n,o,a){const s=(o-i)/2,l=Math.abs(t-(i+s));if(l>s+r)return!1;const c=(a-n)/2,u=Math.abs(e-(n+c));if(u>c+r)return!1;if(l<=s||u<=c)return!0;const h=l-s,A=u-c;return h*h+A*A<=r*r}}const Yn=100;class Jn{constructor(t,e,r=new $n(t.width+200,t.height+200,25),i=new $n(t.width+200,t.height+200,25)){this.transform=t,this.grid=r,this.ignoredGrid=i,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Yn,this.screenBottomBoundary=t.height+Yn,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=e}placeCollisionBox(t,e,r,i,n,o,a,s){let l=r.projectedAnchorX,c=r.projectedAnchorY,u=r.projectedAnchorZ;const h=r.elevation,A=r.tileID,p=t.getProjection();if(h&&A){const[t,e,i]=p.upVector(A.canonical,r.tileAnchorX,r.tileAnchorY),n=p.upVectorScale(A.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;l+=t*h*n,c+=e*h*n,u+=i*h*n}const d=this.projectAndGetPerspectiveRatio(a,l,c,u,r.tileID,"globe"===p.name||!!h||this.transform.pitch>0,p),f=o*d.perspectiveRatio,m=(r.x1*e+i.x-r.padding)*f+d.point.x,g=(r.y1*e+i.y-r.padding)*f+d.point.y,_=(r.x2*e+i.x+r.padding)*f+d.point.x,y=(r.y2*e+i.y+r.padding)*f+d.point.y,v=d.perspectiveRatio<=.55||d.occluded;return!this.isInsideGrid(m,g,_,y)||!n&&this.grid.hitTest(m,g,_,y,s)||v?{box:[],offscreen:!1,occluded:d.occluded}:{box:[m,g,_,y],offscreen:this.isOffscreen(m,g,_,y),occluded:!1}}placeCollisionCircles(e,r,i,n,o,a,s,l,c,u,h,A,p,d,f){const m=[],g=this.transform.elevation,_=e.getProjection(),y=g?g.getAtTileOffsetFunc(f,this.transform.center.lat,this.transform.worldSize,_):null,v=new t.P(i.tileAnchorX,i.tileAnchorY);let{x:x,y:w,z:b}=_.projectTilePoint(v.x,v.y,f.canonical);if(y){const[t,e,r]=y(v);x+=t,w+=e,b+=r}const B="globe"===_.name,C=this.projectAndGetPerspectiveRatio(s,x,w,b,f,B||!!g||this.transform.pitch>0,_),{perspectiveRatio:E}=C,T=(h?a/E:a*E)/t.bN,I=Je(x,w,b,l),S=C.signedDistanceFromCamera>0?ir(T,o,i.lineOffsetX*T,i.lineOffsetY*T,!1,I,v,i,n,l,{},g&&!h?y:null,h&&!!g,_,f,h):null;let M=!1,F=!1,P=!0;if(S&&!C.occluded){const e=.5*p*E+d,i=new t.P(-100,-100),n=new t.P(this.screenRightBoundary,this.screenBottomBoundary),o=new Xn,{first:a,last:s}=S,l=a.path.length;let h=[];for(let t=l-1;t>=1;t--)h.push(a.path[t]);for(let t=1;t<s.path.length;t++)h.push(s.path[t]);const f=2.5*e;c&&(h=h.map((([t,e,r],i)=>(y&&!B&&(r=y(i<l-1?a.tilePath[l-1-i]:s.tilePath[i-l+2])[2]),Je(t,e,r,c)))),h.some((t=>t[3]<=0))&&(h=[]));let g=[];if(h.length>0){let e=1/0,r=-1/0,o=1/0,a=-1/0;for(const t of h)e=Math.min(e,t[0]),o=Math.min(o,t[1]),r=Math.max(r,t[0]),a=Math.max(a,t[1]);r>=i.x&&e<=n.x&&a>=i.y&&o<=n.y&&(g=[h.map((e=>new t.P(e[0],e[1])))],(e<i.x||r>n.x||o<i.y||a>n.y)&&(g=t.cF(g,i.x,i.y,n.x,n.y)))}for(const t of g){o.reset(t,.25*e);let i=0;i=o.length<=.5*e?1:Math.ceil(o.paddedLength/f)+1;for(let t=0;t<i;t++){const n=t/Math.max(i-1,1),a=o.lerp(n),s=a.x+Yn,l=a.y+Yn;m.push(s,l,e,0);const c=s-e,h=l-e,p=s+e,d=l+e;if(P=P&&this.isOffscreen(c,h,p,d),F=F||this.isInsideGrid(c,h,p,d),!r&&this.grid.hitTestCircle(s,l,e,A)&&(M=!0,!u))return{circles:[],offscreen:!1,collisionDetected:M,occluded:!1}}}}return{circles:!u&&M||!F?[]:m,offscreen:P,collisionDetected:M,occluded:C.occluded}}queryRenderedSymbols(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const r=[];let i=1/0,n=1/0,o=-1/0,a=-1/0;for(const s of e){const e=new t.P(s.x+Yn,s.y+Yn);i=Math.min(i,e.x),n=Math.min(n,e.y),o=Math.max(o,e.x),a=Math.max(a,e.y),r.push(e)}const s=this.grid.query(i,n,o,a).concat(this.ignoredGrid.query(i,n,o,a)),l={},c={};for(const e of s){const i=e.key;if(void 0===l[i.bucketInstanceId]&&(l[i.bucketInstanceId]={}),l[i.bucketInstanceId][i.featureIndex])continue;const n=[new t.P(e.x1,e.y1),new t.P(e.x2,e.y1),new t.P(e.x2,e.y2),new t.P(e.x1,e.y2)];t.cG(r,n)&&(l[i.bucketInstanceId][i.featureIndex]=!0,void 0===c[i.bucketInstanceId]&&(c[i.bucketInstanceId]=[]),c[i.bucketInstanceId].push(i.featureIndex))}return c}insertCollisionBox(t,e,r,i,n){(e?this.ignoredGrid:this.grid).insert({bucketInstanceId:r,featureIndex:i,collisionGroupID:n},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,e,r,i,n){const o=e?this.ignoredGrid:this.grid,a={bucketInstanceId:r,featureIndex:i,collisionGroupID:n};for(let e=0;e<t.length;e+=4)o.insertCircle(a,t[e],t[e+1],t[e+2])}projectAndGetPerspectiveRatio(e,r,i,n,o,a,s){const l=[r,i,n,1];let c=!1;if(n||this.transform.pitch>0){if(t.aA.transformMat4(l,l,e),this.fogState&&o&&"globe"!==s.name){const e=function(e,r,i,n,o,a){const s=a.calculateFogTileMatrix(o),l=[r,i,n];return t._.transformMat4(l,l,s),ie(e,t._.length(l),a.pitch,a._fov)}(this.fogState,r,i,n,o.toUnwrapped(),this.transform);c=e>.9}}else ur(l,l,e);const u=l[3];return{point:new t.P((l[0]/u+1)/2*this.transform.width+Yn,(-l[1]/u+1)/2*this.transform.height+Yn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(s)/u*.5,1.5),signedDistanceFromCamera:u,occluded:a&&l[2]>u||c}}isOffscreen(t,e,r,i){return r<Yn||t>=this.screenRightBoundary||i<Yn||e>this.screenBottomBoundary}isInsideGrid(t,e,r,i){return r>=0&&t<this.gridRightBoundary&&i>=0&&e<this.gridBottomBoundary}getViewportMatrix(){const e=t.ad.identity([]);return t.ad.translate(e,e,[-100,-100,0]),e}}class to{constructor(t,e,r,i){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):i&&r?1:0,this.placed=r}isHidden(){return 0===this.opacity&&!this.placed}}class eo{constructor(t,e,r,i,n,o=!1){this.text=new to(t?t.text:null,e,r,n),this.icon=new to(t?t.icon:null,e,i,n),this.clipped=o}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ro{constructor(t,e,r,i=!1){this.text=t,this.icon=e,this.skipFade=r,this.clipped=i}}class io{constructor(){this.invProjMatrix=t.ad.create(),this.viewportMatrix=t.ad.create(),this.circles=[]}}class no{constructor(t,e,r,i,n){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=r,this.bucketIndex=i,this.tileID=n}}class oo{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:t=>t.collisionGroupID===e}}return this.collisionGroups[t]}}function ao(e,r,i,n,o){const{horizontalAlign:a,verticalAlign:s}=t.bQ(e),l=-(a-.5)*r,c=-(s-.5)*i,u=t.bP(e,n);return new t.P(l+u[0]*o,c+u[1]*o)}function so(e,r,i,n,o){const a=new t.P(e,r);return i&&a._rotate(n?o:-o),a}class lo{constructor(t,e,r,i,n,o){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new Jn(this.transform,n),this.buildingIndex=o,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=e,this.retainedQueryData={},this.collisionGroups=new oo(r),this.collisionCircleArrays={},this.prevPlacement=i,i&&(i.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(e,r,i,n){const o=i.getBucket(r),a=i.latestFeatureIndex;if(!o||!a||r.fqid!==o.layerIds[0])return;const s=o.layers[0].layout,l=i.collisionBoxArray,c=Math.pow(2,this.transform.zoom-i.tileID.overscaledZ),u=i.tileSize/t.a3,h=i.tileID.toUnwrapped();this.transform.setProjection(o.projection);const A=(p=i.tileID,d=o.getProjection(),f=this.transform,d.name===this.projection?f.calculateProjMatrix(p.toUnwrapped()):vi(f,d,p));var p,d,f;const m="map"===s.get("text-pitch-alignment"),g="map"===s.get("text-rotation-alignment");r.compileFilter();const _=r.dynamicFilter(),y=r.dynamicFilterNeedsFeature(),v=this.transform.calculatePixelsToTileUnitsMatrix(i),x=$e(A,i.tileID.canonical,m,g,this.transform,o.getProjection(),v);let w=null;if(m){const e=Ye(A,i.tileID.canonical,m,g,this.transform,o.getProjection(),v);w=t.ad.multiply([],this.transform.labelPlaneMatrix,e)}let b=null;_&&i.latestFeatureIndex&&(b={unwrappedTileID:h,dynamicFilter:_,dynamicFilterNeedsFeature:y,featureIndex:i.latestFeatureIndex}),this.retainedQueryData[o.bucketInstanceId]=new no(o.bucketInstanceId,a,o.sourceLayerIndex,o.index,i.tileID);const B={bucket:o,layout:s,posMatrix:A,textLabelPlaneMatrix:x,labelToScreenMatrix:w,clippingData:b,scale:c,textPixelRatio:u,holdingForFade:i.holdingForFade(),collisionBoxArray:l,partiallyEvaluatedTextSize:t.aD(o.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:t.aD(o.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(n)for(const t of o.sortKeyRanges){const{sortKey:r,symbolInstanceStart:i,symbolInstanceEnd:n}=t;e.push({sortKey:r,symbolInstanceStart:i,symbolInstanceEnd:n,parameters:B})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:B})}attemptAnchorPlacement(t,e,r,i,n,o,a,s,l,c,u,h,A,p,d,f,m,g){const{textOffset0:_,textOffset1:y,crossTileID:v}=h,x=[_,y],w=ao(t,r,i,x,n),b=this.collisionIndex.placeCollisionBox(p,n,e,so(w.x,w.y,o,a,this.transform.angle),u,s,l,c.predicate);if(f){const t=p.getSymbolInstanceIconSize(g,this.transform.zoom,h.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(p,t,f,so(w.x,w.y,o,a,this.transform.angle),u,s,l,c.predicate).box.length)return}if(b.box.length>0){let e;return this.prevPlacement&&this.prevPlacement.variableOffsets[v]&&this.prevPlacement.placements[v]&&this.prevPlacement.placements[v].text&&(e=this.prevPlacement.variableOffsets[v].anchor),this.variableOffsets[v]={textOffset:x,width:r,height:i,anchor:t,textScale:n,prevAnchor:e},this.markUsedJustification(p,t,h,d),p.allowVerticalPlacement&&(this.markUsedOrientation(p,d,h),this.placedOrientations[v]=d),{shift:w,placedGlyphBoxes:b}}}placeLayerBucketPart(e,r,i,n){const{bucket:o,layout:a,posMatrix:s,textLabelPlaneMatrix:l,labelToScreenMatrix:c,clippingData:u,textPixelRatio:h,holdingForFade:A,collisionBoxArray:p,partiallyEvaluatedTextSize:d,partiallyEvaluatedIconSize:f,collisionGroup:m}=e.parameters,g=a.get("text-optional"),_=a.get("icon-optional"),y=a.get("text-allow-overlap"),v=a.get("icon-allow-overlap"),x="map"===a.get("text-rotation-alignment"),w="map"===a.get("text-pitch-alignment"),b="viewport-y"===a.get("symbol-z-order"),B=a.get("symbol-z-elevate");this.transform.setProjection(o.projection);let C=y&&(v||!o.hasIconData()||_),E=v&&(y||!o.hasTextData()||g);!o.collisionArrays&&p&&o.deserializeCollisionBoxes(p),i&&n&&o.updateCollisionDebugBuffers(this.transform.zoom,p);const T=(e,n,p)=>{const{crossTileID:b,numVerticalGlyphVertices:B}=e;if(u){const i={zoom:this.transform.zoom,pitch:this.transform.pitch};let n=null;if(u.dynamicFilterNeedsFeature){const t=this.retainedQueryData[o.bucketInstanceId];n=u.featureIndex.loadFeature({featureIndex:e.featureIndex,bucketIndex:t.bucketIndex,sourceLayerIndex:t.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,u.dynamicFilter)(i,n,this.retainedQueryData[o.bucketInstanceId].tileID.canonical,new t.P(e.tileAnchorX,e.tileAnchorY),this.transform.calculateDistanceTileData(u.unwrappedTileID)))return this.placements[b]=new ro(!1,!1,!1,!0),void r.add(b)}if(r.has(b))return;if(A)return void(this.placements[b]=new ro(!1,!1,!1));let T=!1,I=!1,S=!0,M=!1,F=!1,P=null,L={box:null,offscreen:null,occluded:null},D={box:null,offscreen:null,occluded:null},U=null,k=null,z=null,R=0,O=0,Q=0;p.textFeatureIndex?R=p.textFeatureIndex:e.useRuntimeCollisionCircles&&(R=e.featureIndex),p.verticalTextFeatureIndex&&(O=p.verticalTextFeatureIndex);const N=t=>{t.tileID=this.retainedQueryData[o.bucketInstanceId].tileID;const r=this.transform.elevation;t.elevation=e.zOffset+(r?r.getAtTileOffset(t.tileID,t.tileAnchorX,t.tileAnchorY):0)},V=p.textBox;if(V){N(V);const r=r=>{let i=t.aE.horizontal;if(o.allowVerticalPlacement&&!r&&this.prevPlacement){const t=this.prevPlacement.placedOrientations[b];t&&(this.placedOrientations[b]=t,i=t,this.markUsedOrientation(o,i,e))}return i},i=(e,r)=>{if(o.allowVerticalPlacement&&B>0&&p.verticalTextBox){for(const i of o.writingModes)if(i===t.aE.vertical?(L=r(),D=L):L=e(),L&&L.box&&L.box.length)break}else L=e()};if(a.get("text-variable-anchor")){let l=a.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[b]){const t=this.prevPlacement.variableOffsets[b];l.indexOf(t.anchor)>0&&(l=l.filter((e=>e!==t.anchor)),l.unshift(t.anchor))}const c=(t,r,i)=>{const a=o.getSymbolInstanceTextSize(d,e,this.transform.zoom,n),c=(t.x2-t.x1)*a+2*t.padding,u=(t.y2-t.y1)*a+2*t.padding,A=e.hasIconTextFit&&!v?r:null;A&&N(A);let p={box:[],offscreen:!1,occluded:!1};const g=y?2*l.length:l.length;for(let r=0;r<g;++r){const g=this.attemptAnchorPlacement(l[r%l.length],t,c,u,a,x,w,h,s,m,r>=l.length,e,n,o,i,A,d,f);if(g&&(p=g.placedGlyphBoxes,p&&p.box&&p.box.length)){T=!0,P=g.shift;break}}return p};i((()=>c(V,p.iconBox,t.aE.horizontal)),(()=>{const e=p.verticalTextBox;return e&&N(e),o.allowVerticalPlacement&&!(L&&L.box&&L.box.length)&&B>0&&e?c(e,p.verticalIconBox,t.aE.vertical):{box:null,offscreen:null,occluded:null}})),L&&(T=L.box,S=L.offscreen,M=L.occluded);const u=r(!(!L||!L.box));if(!T&&this.prevPlacement){const t=this.prevPlacement.variableOffsets[b];t&&(this.variableOffsets[b]=t,this.markUsedJustification(o,t.anchor,e,u))}}else{const a=(r,i)=>{const a=o.getSymbolInstanceTextSize(d,e,this.transform.zoom,n),l=this.collisionIndex.placeCollisionBox(o,a,r,new t.P(0,0),y,h,s,m.predicate);return l&&l.box&&l.box.length&&(this.markUsedOrientation(o,i,e),this.placedOrientations[b]=i),l};i((()=>a(V,t.aE.horizontal)),(()=>{const e=p.verticalTextBox;return o.allowVerticalPlacement&&B>0&&e?(N(e),a(e,t.aE.vertical)):{box:null,offscreen:null,occluded:null}})),r(!!(L&&L.box&&L.box.length))}}if(U=L,T=U&&U.box&&U.box.length>0,S=U&&U.offscreen,M=U&&U.occluded,e.useRuntimeCollisionCircles){const r=o.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex>=0?e.centerJustifiedTextSymbolIndex:e.verticalPlacedTextSymbolIndex),n=t.aF(o.textSizeData,d,r),u=a.get("text-padding");k=this.collisionIndex.placeCollisionCircles(o,y,r,o.lineVertexArray,o.glyphOffsetArray,n,s,l,c,i,w,m.predicate,e.collisionCircleDiameter*n/t.bN,u,this.retainedQueryData[o.bucketInstanceId].tileID),T=y||k.circles.length>0&&!k.collisionDetected,S=S&&k.offscreen,M=k.occluded}if(p.iconFeatureIndex&&(Q=p.iconFeatureIndex),p.iconBox){const r=r=>{N(r);const i=e.hasIconTextFit&&P?so(P.x,P.y,x,w,this.transform.angle):new t.P(0,0),n=o.getSymbolInstanceIconSize(f,this.transform.zoom,e.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(o,n,r,i,v,h,s,m.predicate)};D&&D.box&&D.box.length&&p.verticalIconBox?(z=r(p.verticalIconBox),I=z.box.length>0):(z=r(p.iconBox),I=z.box.length>0),S=S&&z.offscreen,F=z.occluded}const H=g||0===e.numHorizontalGlyphVertices&&0===B,j=_||0===e.numIconVertices;if(H||j?j?H||(I=I&&T):T=I&&T:I=T=I&&T,T&&U&&U.box&&this.collisionIndex.insertCollisionBox(U.box,a.get("text-ignore-placement"),o.bucketInstanceId,D&&D.box&&O?O:R,m.ID),I&&z&&this.collisionIndex.insertCollisionBox(z.box,a.get("icon-ignore-placement"),o.bucketInstanceId,Q,m.ID),k&&(T&&this.collisionIndex.insertCollisionCircles(k.circles,a.get("text-ignore-placement"),o.bucketInstanceId,R,m.ID),i)){const t=o.bucketInstanceId;let e=this.collisionCircleArrays[t];void 0===e&&(e=this.collisionCircleArrays[t]=new io);for(let t=0;t<k.circles.length;t+=4)e.circles.push(k.circles[t+0]),e.circles.push(k.circles[t+1]),e.circles.push(k.circles[t+2]),e.circles.push(k.collisionDetected?1:0)}const G="globe"!==o.projection.name;C=C&&(G||!M),E=E&&(G||!F),this.placements[b]=new ro(T||C,I||E,S||o.justReloaded),r.add(b)};if(B&&this.buildingIndex&&(this.buildingIndex.updateZOffset(o,this.retainedQueryData[o.bucketInstanceId].tileID),o.updateZOffset()),b){const e=o.getSortedSymbolIndexes(this.transform.angle);for(let t=e.length-1;t>=0;--t){const r=e[t];T(o.symbolInstances.get(r),r,o.collisionArrays[r])}o.hasAnyZOffset&&t.w(`${o.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(o.hasAnyZOffset){const t=o.getSortedIndexesByZOffset();for(let e=0;e<t.length;++e){const r=t[e];T(o.symbolInstances.get(r),r,o.collisionArrays[r])}}else for(let t=e.symbolInstanceStart;t<e.symbolInstanceEnd;t++)T(o.symbolInstances.get(t),t,o.collisionArrays[t]);if(i&&o.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[o.bucketInstanceId];t.ad.invert(e.invProjMatrix,s),e.viewportMatrix=this.collisionIndex.getViewportMatrix()}o.justReloaded=!1}markUsedJustification(e,r,i,n){const{leftJustifiedTextSymbolIndex:o,centerJustifiedTextSymbolIndex:a,rightJustifiedTextSymbolIndex:s,verticalPlacedTextSymbolIndex:l,crossTileID:c}=i,u=t.cJ(r),h=n===t.aE.vertical?l:"left"===u?o:"center"===u?a:"right"===u?s:-1;o>=0&&(e.text.placedSymbolArray.get(o).crossTileID=h>=0&&o!==h?0:c),a>=0&&(e.text.placedSymbolArray.get(a).crossTileID=h>=0&&a!==h?0:c),s>=0&&(e.text.placedSymbolArray.get(s).crossTileID=h>=0&&s!==h?0:c),l>=0&&(e.text.placedSymbolArray.get(l).crossTileID=h>=0&&l!==h?0:c)}markUsedOrientation(e,r,i){const n=r===t.aE.horizontal||r===t.aE.horizontalOnly?r:0,o=r===t.aE.vertical?r:0,{leftJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:s,rightJustifiedTextSymbolIndex:l,verticalPlacedTextSymbolIndex:c}=i,u=e.text.placedSymbolArray;a>=0&&(u.get(a).placedOrientation=n),s>=0&&(u.get(s).placedOrientation=n),l>=0&&(u.get(l).placedOrientation=n),c>=0&&(u.get(c).placedOrientation=o)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const e=this.prevPlacement;let r=!1;this.prevZoomAdjustment=e?e.zoomAdjustment(this.transform.zoom):0;const i=e?e.symbolFadeChange(t):1,n=e?e.opacities:{},o=e?e.variableOffsets:{},a=e?e.placedOrientations:{};for(const t in this.placements){const e=this.placements[t],o=n[t];o?(this.opacities[t]=new eo(o,i,e.text,e.icon,null,e.clipped),r=r||e.text!==o.text.placed||e.icon!==o.icon.placed):(this.opacities[t]=new eo(null,i,e.text,e.icon,e.skipFade,e.clipped),r=r||e.text||e.icon)}for(const t in n){const e=n[t];if(!this.opacities[t]){const n=new eo(e,i,!1,!1);n.isHidden()||(this.opacities[t]=n,r=r||e.text.placed||e.icon.placed)}}for(const t in o)this.variableOffsets[t]||!this.opacities[t]||this.opacities[t].isHidden()||(this.variableOffsets[t]=o[t]);for(const t in a)this.placedOrientations[t]||!this.opacities[t]||this.opacities[t].isHidden()||(this.placedOrientations[t]=a[t]);r?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)}updateLayerOpacities(t,e,r,i){const n=new Set;for(const o of e){const e=o.getBucket(t);e&&o.latestFeatureIndex&&t.fqid===e.layerIds[0]&&(this.updateBucketOpacities(e,n,o.collisionBoxArray,r,i,o.tileID),e.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(e,o.tileID),e.updateZOffset()))}}updateBucketOpacities(e,r,i,n,o,a){e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const s=e.layers[0].layout,l=!!e.layers[0].dynamicFilter(),c=new eo(null,0,!1,!1,!0),u=s.get("text-allow-overlap"),h=s.get("icon-allow-overlap"),A=s.get("text-variable-anchor"),p="map"===s.get("text-rotation-alignment"),d="map"===s.get("text-pitch-alignment"),f=new eo(null,0,u&&(h||!e.hasIconData()||s.get("icon-optional")),h&&(u||!e.hasTextData()||s.get("text-optional")),!0);!e.collisionArrays&&i&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(i);const m=(t,e,r)=>{for(let i=0;i<e/4;i++)t.opacityVertexArray.emplaceBack(r)};let g=0;o&&e.updateReplacement(a,o);for(let i=0;i<e.symbolInstances.length;i++){const s=e.symbolInstances.get(i),{numHorizontalGlyphVertices:u,numVerticalGlyphVertices:h,crossTileID:_,numIconVertices:y,tileAnchorX:v,tileAnchorY:x}=s,w=r.has(_);let b=this.opacities[_];w?b=c:b||(b=f,this.opacities[_]=b),r.add(_);const B=u>0||h>0,C=y>0,E=this.placedOrientations[_],T=E===t.aE.vertical,I=E===t.aE.horizontal||E===t.aE.horizontalOnly;!B&&!C||b.isHidden()||g++;let S=!1;if((B||C)&&o)for(const r of e.activeReplacements){if(r.order<n||r.order===1/0||!(r.clipMask&t.cu.Symbol))continue;if(r.min.x>v||v>r.max.x||r.min.y>x||x>r.max.y)continue;const e=t.cH(v,x,a.canonical,r.footprintTileId.canonical);if(S=t.cI(e,r),S)break}if(B){const t=S?yo:_o(b.text);m(e.text,u,T?yo:t),m(e.text,h,I?yo:t);const r=b.text.isHidden(),{leftJustifiedTextSymbolIndex:i,centerJustifiedTextSymbolIndex:n,rightJustifiedTextSymbolIndex:o,verticalPlacedTextSymbolIndex:a}=s,l=e.text.placedSymbolArray,c=r||T?1:0;i>=0&&(l.get(i).hidden=c),n>=0&&(l.get(n).hidden=c),o>=0&&(l.get(o).hidden=c),a>=0&&(l.get(a).hidden=r||I?1:0);const A=this.variableOffsets[_];A&&this.markUsedJustification(e,A.anchor,s,E);const p=this.placedOrientations[_];p&&(this.markUsedJustification(e,"left",s,p),this.markUsedOrientation(e,p,s))}if(C){const t=S?yo:_o(b.icon),{placedIconSymbolIndex:r,verticalPlacedIconSymbolIndex:i}=s,n=e.icon.placedSymbolArray,o=b.icon.isHidden()?1:0;r>=0&&(m(e.icon,y,T?yo:t),n.get(r).hidden=o),i>=0&&(m(e.icon,s.numVerticalIconVertices,I?yo:t),n.get(i).hidden=o)}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const r=e.collisionArrays[i];if(r){let i=new t.P(0,0),n=!0;if(r.textBox||r.verticalTextBox){if(A){const t=this.variableOffsets[_];t?(i=ao(t.anchor,t.width,t.height,t.textOffset,t.textScale),p&&i._rotate(d?this.transform.angle:-this.transform.angle)):n=!1}l&&(n=!b.clipped),r.textBox&&co(e.textCollisionBox.collisionVertexArray,b.text.placed,!n||T,i.x,i.y),r.verticalTextBox&&co(e.textCollisionBox.collisionVertexArray,b.text.placed,!n||I,i.x,i.y)}const o=n&&Boolean(!I&&r.verticalIconBox);r.iconBox&&co(e.iconCollisionBox.collisionVertexArray,b.icon.placed,o,s.hasIconTextFit?i.x:0,s.hasIconTextFit?i.y:0),r.verticalIconBox&&co(e.iconCollisionBox.collisionVertexArray,b.icon.placed,!o,s.hasIconTextFit?i.x:0,s.hasIconTextFit?i.y:0)}}}if(e.fullyClipped=0===g,e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=t.invProjMatrix,e.placementViewportMatrix=t.viewportMatrix,e.collisionCircleArray=t.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,e){const r=this.zoomAtLastRecencyCheck===e?1-this.zoomAdjustment(e):1;return this.zoomAtLastRecencyCheck=e,this.commitTime+this.fadeDuration*r>t}setStale(){this.stale=!0}}function co(t,e,r,i,n){t.emplaceBack(e?1:0,r?1:0,i||0,n||0),t.emplaceBack(e?1:0,r?1:0,i||0,n||0),t.emplaceBack(e?1:0,r?1:0,i||0,n||0),t.emplaceBack(e?1:0,r?1:0,i||0,n||0)}const uo=Math.pow(2,25),ho=Math.pow(2,24),Ao=Math.pow(2,17),po=Math.pow(2,16),fo=Math.pow(2,9),mo=Math.pow(2,8),go=Math.pow(2,1);function _o(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;const e=t.placed?1:0,r=Math.floor(127*t.opacity);return r*uo+e*ho+r*Ao+e*po+r*fo+e*mo+r*go+e}const yo=0;class vo{constructor(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,e,r,i,n){const o=this._bucketParts;for(;this._currentTileIndex<t.length;)if(e.getBucketParts(o,i,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,n())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort(((t,e)=>t.sortKey-e.sortKey)));this._currentPartIndex<o.length;){const t=o[this._currentPartIndex];if(e.placeLayerBucketPart(t,this._seenCrossTileIDs,r,0===t.symbolInstanceStart),this._currentPartIndex++,n())return!0}return!1}}class xo{constructor(t,e,r,i,n,o,a,s,l){this.placement=new lo(t,n,o,a,s,l),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=r,this._showCollisionBoxes=i,this._done=!1}isDone(){return this._done}continuePlacement(e,r,i,n){const o=t.e.now(),a=()=>{const e=t.e.now()-o;return!this._forceFullPlacement&&e>2};for(;this._currentPlacementIndex>=0;){const o=r[e[this._currentPlacementIndex]],s=this.placement.collisionIndex.transform.zoom;if("symbol"===o.type&&(!o.minzoom||o.minzoom<=s)&&(!o.maxzoom||o.maxzoom>s)){const e=o,r=e.layout.get("symbol-z-elevate"),s=this._inProgressLayer=this._inProgressLayer||new vo(e),l=t.al(o.source,o.scope);if(s.continuePlacement(r?n[l]:i[l],this.placement,this._showCollisionBoxes,o,a))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const wo=512/t.a3/2;class bo{constructor(e,r,i){this.tileID=e,this.bucketInstanceId=i,this.index=new t.cK(r.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const n=e.canonical.x*t.a3,o=e.canonical.y*t.a3;for(let t=0;t<r.length;t++){const{key:e,crossTileID:i,tileAnchorX:a,tileAnchorY:s}=r.get(t),l=Math.floor((n+a)*wo),c=Math.floor((o+s)*wo);this.index.add(l,c),this.keys.push(e),this.crossTileIDs.push(i)}this.index.finish()}findMatches(e,r,i){const n=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z),o=wo/Math.pow(2,r.canonical.z-this.tileID.canonical.z),a=r.canonical.x*t.a3,s=r.canonical.y*t.a3;for(let t=0;t<e.length;t++){const r=e.get(t);if(r.crossTileID)continue;const{key:l,tileAnchorX:c,tileAnchorY:u}=r,h=Math.floor((a+c)*o),A=Math.floor((s+u)*o),p=this.index.range(h-n,A-n,h+n,A+n);for(const t of p){const e=this.crossTileIDs[t];if(this.keys[t]===l&&!i.has(e)){i.add(e),r.crossTileID=e;break}}}}}class Bo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Co{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const e=Math.round((t-this.lng)/360);if(0!==e)for(const t in this.indexes){const r=this.indexes[t],i={};for(const t in r){const n=r[t];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+e),i[n.tileID.key]=n}this.indexes[t]=i}this.lng=t}addBucket(t,e,r){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let t=0;t<e.symbolInstances.length;t++)e.symbolInstances.get(t).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const i=this.usedCrossTileIDs[t.overscaledZ];for(const r in this.indexes){const n=this.indexes[r];if(Number(r)>t.overscaledZ)for(const r in n){const o=n[r];o.tileID.isChildOf(t)&&o.findMatches(e.symbolInstances,t,i)}else{const o=n[t.scaledTo(Number(r)).key];o&&o.findMatches(e.symbolInstances,t,i)}}for(let t=0;t<e.symbolInstances.length;t++){const n=e.symbolInstances.get(t);n.crossTileID||(n.crossTileID=r.generate(),i.add(n.crossTileID))}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new bo(t,e.symbolInstances,e.bucketInstanceId),!0}removeBucketCrossTileIDs(t,e){for(const r of e.crossTileIDs)this.usedCrossTileIDs[t].delete(r)}removeStaleBuckets(t){let e=!1;for(const r in this.indexes){const i=this.indexes[r];for(const n in i)t[i[n].bucketInstanceId]||(this.removeBucketCrossTileIDs(r,i[n]),delete i[n],e=!0)}return e}}class Eo{constructor(){this.layerIndexes={},this.crossTileIDs=new Bo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,e,r,i){let n=this.layerIndexes[t.fqid];void 0===n&&(n=this.layerIndexes[t.fqid]=new Co);let o=!1;const a={};"globe"!==i.name&&n.handleWrapJump(r);for(const r of e){const e=r.getBucket(t);e&&t.fqid===e.layerIds[0]&&(e.bucketInstanceId||(e.bucketInstanceId=++this.maxBucketInstanceId),n.addBucket(r.tileID,e,this.crossTileIDs)&&(o=!0),a[e.bucketInstanceId]=!0)}return n.removeStaleBuckets(a)&&(o=!0),o}pruneUnusedLayers(t){const e={};t.forEach((t=>{e[t]=!0}));for(const t in this.layerIndexes)e[t]||delete this.layerIndexes[t]}}const To=new t.N({data:new t.O(t.L.colorTheme.data)}),Io=(t,e)=>Wt(t,e&&e.filter((t=>"source.canvas"!==t.identifier))),So=t.ah(Vn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),Mo=t.ah(Vn,["setCenter","setZoom","setBearing","setPitch"]),Fo={version:8,layers:[],sources:{}},Po={duration:300,delay:0};class Lo extends t.E{constructor(e,r={}){super(),this.map=e,this.scope=r.scope||"",this.globalId=null,this.fragments=[],this.importDepth=r.importDepth||0,this.importsCache=r.importsCache||new Map,this.resolvedImports=r.resolvedImports||new Set,this.transition=t.W({},Po),this._buildingIndex=new On(this),this.crossTileSymbolIndex=new Eo,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerIndices=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=r.styleChanges||new _,this.dispatcher=r.dispatcher?r.dispatcher:new t.bw(t.bx(),this),r.imageManager?this.imageManager=r.imageManager:(this.imageManager=new ht,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=r.glyphManager?r.glyphManager:new t.cM(e._requestManager,r.localFontFamily?t.cN.all:r.localIdeographFontFamily?t.cN.ideographs:t.cN.none,r.localFontFamily||r.localIdeographFontFamily),r.modelManager?this.modelManager=r.modelManager:(this.modelManager=new ct(e._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null},this._styleColorThemeForScope={},this.options=r.configOptions?r.configOptions:new Map,this._configDependentLayers=r.configDependentLayers?r.configDependentLayers:new Set,this._config=r.config,this._initialConfig=r.initialConfig,this.dispatcher.broadcast("setReferrer",t.cO());const i=this;this._rtlTextPluginCallback=Lo.registerForPluginStateChange((e=>{i.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:e.pluginStatus,pluginURL:e.pluginURL},((e,r)=>{if(t.cP(e),r&&r.every((t=>t)))for(const t in i._sourceCaches){const e=i._sourceCaches[t],r=e.getSource().type;"vector"!==r&&"geojson"!==r||e.reload()}}))})),this.on("data",(t=>{if("source"!==t.dataType||"metadata"!==t.sourceDataType)return;const e=this.getOwnSource(t.sourceId);if(e&&e.vectorLayerIds)for(const t in this._layers){const r=this._layers[t];r.source===e.id&&this._validateLayer(r)}}))}load(t){return t?("string"==typeof t?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(e){if(!e)return null;if("string"==typeof e){if(t.cQ(e))return e;const r=t.cR(e);if(!r.startsWith("http"))try{return new URL(r,location.href).toString()}catch(t){return r}return r}return`json://${t.cS(JSON.stringify(e))}`}_diffStyle(e,r,i){this.globalId=this._getGlobalId(e);const n=(t,e)=>{try{e(null,this.setState(t,i))}catch(t){e(t,!1)}};if("string"==typeof e){const i=this.map._requestManager.normalizeStyleURL(e),o=this.map._requestManager.transformRequest(i,t.R.Style);t.g(o,((e,i)=>{e?this.fire(new t.d(e)):i&&n(i,r)}))}else"object"==typeof e&&n(e,r)}loadURL(e,r={}){this.fire(new t.f("dataloading",{dataType:"style"}));const i="boolean"==typeof r.validate?r.validate:!t.cQ(e);this.globalId=this._getGlobalId(e),e=this.map._requestManager.normalizeStyleURL(e,r.accessToken),this.resolvedImports.add(e);const n=this.importsCache.get(e);if(n)return this._load(n,i);const o=this.map._requestManager.transformRequest(e,t.R.Style);this._request=t.g(o,((r,n)=>{if(this._request=null,r)this.fire(new t.d(r));else if(n)return this.importsCache.set(e,n),this._load(n,i)}))}loadJSON(e,r={}){this.fire(new t.f("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(e),this._request=t.e.frame((()=>{this._request=null,this._load(e,!1!==r.validate)}))}loadEmpty(){this.fire(new t.f("dataloading",{dataType:"style"})),this._load(Fo,!1)}_loadImports(e,r,i){if(this.importDepth>=4)return t.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const n=[];for(const t of e){const e=this._createFragmentStyle(t),o=new Promise((t=>{e.once("style.import.load",t),e.once("error",t)})).then((()=>this.mergeAll()));if(n.push(o),this.resolvedImports.has(t.url)){e.loadEmpty();continue}const a=t.data||this.importsCache.get(t.url);a?(e.loadJSON(a,{validate:r}),this._isInternalStyle(a)&&(e.globalId=null)):t.url?e.loadURL(t.url,{validate:r}):e.loadEmpty();const s={style:e,id:t.id,config:t.config};if(i){const t=this.fragments.findIndex((({id:t})=>t===i));this.fragments=this.fragments.slice(0,t).concat(s).concat(this.fragments.slice(t))}else this.fragments.push(s)}return Promise.allSettled(n)}getImportGlobalIds(t=this,e=new Set){for(const r of t.fragments)r.style.globalId&&e.add(r.style.globalId),this.getImportGlobalIds(r.style,e);return[...e.values()]}_createFragmentStyle(e){const r=this.scope?t.al(e.id,this.scope):e.id;let i;const n=this._initialConfig&&this._initialConfig[r];(e.config||n)&&(i=t.W({},e.config,n));const o=new Lo(this.map,{scope:r,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:i,configOptions:this.options,configDependentLayers:this._configDependentLayers});return o.setEventedParent(this.map,{style:o}),o}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&!1!==t.fragment)}_load(e,r){const i=e.schema;if(this._isInternalStyle(e)){const i=t.W({},Fo,{imports:[{id:"basemap",data:e,url:""}]});return void this._load(i,r)}if(this.updateConfig(this._config,i),r&&Io(this,zt(e)))return;this._loaded=!0,this.stylesheet=t.cT(e);const n=()=>{for(const t in e.sources)this.addSource(t,e.sources[t],{validate:!1,isInitialLoad:!0});e.sprite?this._loadSprite(e.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(e.glyphs,this.scope);const i=Nn(this.stylesheet.layers);if(this._order=i.map((t=>t.id)),this.stylesheet.light&&t.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const t=this.stylesheet.lights[0];this.light=new $t(t.properties,t.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new $t(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const e of i){const r=t.cY(e,this.scope,this._styleColorTheme.lut,this.options);r.isConfigDependent&&this._configDependentLayers.add(r.fqid),r.setEventedParent(this,{layer:{id:r.id}}),this._layers[r.id]=r,this._serializedLayers[r.id]=r.serialize();const i=this.getOwnLayerSourceCache(r),n=!!this.directionalLight&&this.directionalLight.shadowsEnabled();i&&r.canCastShadows()&&n&&(i.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const n=this.stylesheet.terrain;n&&(this.checkCanvasFingerprintNoise(),this.terrainSetForDrapingOnly()||this._createTerrain(n,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new t.f("data",{dataType:"style"}));const o=this.isRootStyle();e.imports?this._loadImports(e.imports,r).then((()=>{this._reloadImports(),this.fire(new t.f(o?"style.load":"style.import.load"))})):(this._reloadImports(),this.fire(new t.f(o?"style.load":"style.import.load")))},o=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=o,o){const e=this._evaluateColorThemeData(o);this._loadColorTheme(e).then((()=>{n()})).catch((e=>{t.w(`Couldn't load color theme from the stylesheet: ${e}`),n()}))}else this._styleColorTheme.lut=null,n()}isRootStyle(){return 0===this.importDepth}mergeAll(){let e,r,i,n,o,a,s,l;const c={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((t=>{if(t.stylesheet){if(null!=t.light&&(e=t.light),t.stylesheet.lights)for(const e of t.stylesheet.lights)"ambient"===e.type&&null!=t.ambientLight&&(r=t.ambientLight),"directional"===e.type&&null!=t.directionalLight&&(i=t.directionalLight);n=this._prioritizeTerrain(n,t.terrain,t.stylesheet.terrain),t.stylesheet.fog&&null!=t.fog&&(o=t.fog),null!=t.stylesheet.camera&&(l=t.stylesheet.camera),null!=t.stylesheet.projection&&(a=t.stylesheet.projection),null!=t.stylesheet.transition&&(s=t.stylesheet.transition),c[t.scope]=t._styleColorTheme}})),this.light=e,this.ambientLight=r,this.directionalLight=i,this.fog=o,this._styleColorThemeForScope=c,null===n?delete this.terrain:this.terrain=n,this.camera=l||{"camera-projection":"perspective"},this.projection=a||{name:"mercator"},this.transition=t.W({},Po,s),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const e=r=>{for(const t of r.fragments)e(t.style);t(r)};e(this)}_prioritizeTerrain(t,e,r){const i=t&&0===t.drapeRenderMode;return null===r?e&&0===e.drapeRenderMode?e:i?t:null:null!=e&&(!t||i||e&&1===e.drapeRenderMode)?e:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((e=>{t=this._prioritizeTerrain(t,e.terrain,e.stylesheet.terrain)})),null===t?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle((e=>{null!=e.stylesheet.projection&&(t=e.stylesheet.projection)})),this.projection=t||{name:"mercator"}}mergeSources(){const e={},r={},i={};this.forEachFragmentStyle((n=>{for(const r in n._sourceCaches){const i=t.al(r,n.scope);e[i]=n._sourceCaches[r]}for(const e in n._otherSourceCaches){const i=t.al(e,n.scope);r[i]=n._otherSourceCaches[e]}for(const e in n._symbolSourceCaches){const r=t.al(e,n.scope);i[r]=n._symbolSourceCaches[e]}})),this._mergedSourceCaches=e,this._mergedOtherSourceCaches=r,this._mergedSymbolSourceCaches=i}mergeLayers(){const e={},r=[],i={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((i=>{for(const n of i._order){const o=i._layers[n];if("slot"===o.type){const r=t.cU(n);if(e[r])continue;e[r]=[]}o.slot&&e[o.slot]?e[o.slot].push(o):r.push(o)}})),this._mergedOrder=[],this._clipLayerIndices=[];let n=0;const o=(r=[])=>{for(const a of r)if("slot"===a.type){const r=t.cU(a.id);e[r]&&o(e[r]),this._mergedSlots.push(r)}else{const e=t.al(a.id,a.scope);this._mergedOrder.push(e),i[e]=a,a.is3D()&&(this._has3DLayers=!0),"circle"===a.type&&(this._hasCircleLayers=!0),"symbol"===a.type&&(this._hasSymbolLayers=!0),"clip"===a.type&&this._clipLayerIndices.push(n),n++}};o(r),this._mergedLayers=i,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(e){return this.stylesheet.camera=t.W({},this.stylesheet.camera,e),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(e){return e.data?function(e,r,i){const n=t.W({},r);for(const e of Object.keys(t.L.colorTheme))void 0===n[e]&&(n[e]=t.L.colorTheme[e].default);const o=new t.U(To,e,new Map(i));return o.setTransitionOrValue(n,i),o.untransitioned().possiblyEvaluate(new t.X(0))}(this.scope,e,this.options).get("data"):null}_loadColorTheme(e){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const r=this._styleColorTheme.lutLoadingCorrelationID;return new Promise(((i,n)=>{const o="data:image/png;base64,";if(!e||0===e.length)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void i();let a=e;a.startsWith(o)||(a=o+a);const s="mapbox-reserved-lut",l=new Image;l.src=a,l.onerror=()=>{this._styleColorTheme.lutLoading=!1,n(new Error("Failed to load image data"))},l.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==r)return void i();this._styleColorTheme.lutLoading=!1;const{width:o,height:a,data:c}=t.e.getImageData(l);if(a>32)return void n(new Error("The height of the image must be less than or equal to 32 pixels."));if(o!==a*a)return void n(new Error("The width of the image must be equal to the height squared."));this.getImage(s)&&this.removeImage(s),this.addImage(s,{data:new t.i({width:o,height:a},c),pixelRatio:1,sdf:!1,version:0});const u=this.imageManager.getImage(s,this.scope);u?(this._styleColorTheme.lut={image:u.data,data:e},i()):n(new Error("Missing LUT image."))}}))}getLut(t){const e=this._styleColorThemeForScope[t];return e?e.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(e){this._spriteRequest=function(e,r,i){let n,o,a;const s=t.e.devicePixelRatio>1?"@2x":"";let l=t.g(r.transformRequest(r.normalizeSpriteURL(e,s,".json"),t.R.SpriteJSON),((t,e)=>{l=null,a||(a=t,n=e,u())})),c=t.h(r.transformRequest(r.normalizeSpriteURL(e,s,".png"),t.R.SpriteImage),((t,e)=>{c=null,a||(a=t,o=e,u())}));function u(){if(a)i(a);else if(n&&o){const e=t.e.getImageData(o),r={};for(const i in n){const{width:o,height:a,x:s,y:l,sdf:c,pixelRatio:u,stretchX:h,stretchY:A,content:p}=n[i],d=new t.i({width:o,height:a});t.i.copy(e,d,{x:s,y:l},{x:0,y:0},{width:o,height:a},null),r[i]={data:d,pixelRatio:u,sdf:c,stretchX:h,stretchY:A,content:p}}i(null,r)}}return{cancel(){l&&(l.cancel(),l=null),c&&(c.cancel(),c=null)}}}(e,this.map._requestManager,((e,r)=>{if(this._spriteRequest=null,e)this.fire(new t.d(e));else if(r)for(const t in r)this.imageManager.addImage(t,this.scope,r[t]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new t.f("data",{dataType:"style"}))}))}_validateLayer(e){const r=this.getOwnSource(e.source);if(!r)return;const i=e.sourceLayer;i&&("geojson"===r.type||r.vectorLayerIds&&-1===r.vectorLayerIds.indexOf(i))&&this.fire(new t.d(new Error(`Source layer "${i}" does not exist on source "${r.id}" as specified by style layer "${e.id}"`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded())return!1;if(!this.modelManager.isLoaded())return!1;if(this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((t,e)=>{const r=this.fragments[e];return r&&r.style&&(t.data=r.style.serialize()),t}))}_serializeSources(){const t={};for(const e in this._sourceCaches){const r=this._sourceCaches[e].getSource();t[r.id]||(t[r.id]=r.serialize())}return t}_serializeLayers(t){const e=[];for(const r of t){const t=this._layers[r];t&&"custom"!==t.type&&e.push(t.serialize())}return e}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions())return!0;if(this.hasFogTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(e){const r=this.getOwnLayer(e);if(r)return r;this.fire(new t.d(new Error(`The layer '${e}' does not exist in the map's style.`)))}_checkSource(e){const r=this.getOwnSource(e);if(r)return r;this.fire(new t.d(new Error(`The source '${e}' does not exist in the map's style.`)))}update(e){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(e),this.directionalLight&&this.directionalLight.recalculate(e);const r=this.calculateLightsBrightness();e.brightness=r||0,r!==this._brightness&&(this._brightness=r,this.dispatcher.broadcast("setBrightness",r));const i=this._changes.isDirty();let n=!1;if(this._changes.isDirty()){const t=this._changes.getLayerUpdatesByScope();for(const e in t){const{updatedIds:r,removedIds:i}=t[e];(r||i)&&(this._updateWorkerLayers(e,r,i),n=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(e),this.light&&this.light.updateTransitions(e),this.ambientLight&&this.ambientLight.updateTransitions(e),this.directionalLight&&this.directionalLight.updateTransitions(e),this.fog&&this.fog.updateTransitions(e),this._changes.reset()}const o={};for(const t in this._mergedSourceCaches){const e=this._mergedSourceCaches[t];o[t]=e.used,e.used=!1,e.tileCoverLift=0}for(const t of this._mergedOrder){const r=this._mergedLayers[t];if(r.recalculate(e,this._availableImages),!r.isHidden(e.zoom)){const t=this.getLayerSourceCache(r);t&&(t.used=!0,t.tileCoverLift=Math.max(t.tileCoverLift,r.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let t=r.minzoom||0;t<(r.maxzoom||25.5);t++){const t=this.map.painter;if(t){const i=r.getProgramIds();if(!i)continue;for(const n of i){const i=r.getDefaultProgramParams(n,e.zoom,this._styleColorTheme.lut);i&&(t.style=this,this.fog&&(t._fogVisible=!0,i.overrideFog=!0,t.getOrCreateProgram(n,i)),t._fogVisible=!1,i.overrideFog=!1,t.getOrCreateProgram(n,i),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(i.overrideRtt=!0,t.getOrCreateProgram(n,i)))}}}}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&n&&this.mergeLayers();for(const e in o){const r=this._mergedSourceCaches[e];o[e]!==r.used&&r.getSource().fire(new t.f("data",{sourceDataType:"visibility",dataType:"source",sourceId:r.getSource().id}))}this.light&&this.light.recalculate(e),this.terrain&&this.terrain.recalculate(e),this.fog&&this.fog.recalculate(e),this.z=e.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),i&&this.fire(new t.f("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=this._changes.getUpdatedImages();if(t.length){for(const e in this._sourceCaches)this._sourceCaches[e].reloadTilesForDependencies(["icons","patterns"],t);this._changes.resetUpdatedImages()}}_updateWorkerLayers(t,e,r){const i=this.getFragmentStyle(t);i&&this.dispatcher.broadcast("updateLayers",{layers:e?i._serializeLayers(e):[],scope:t,removedIds:r||[],options:i.options})}setState(r,i){if(this._checkLoaded(),Io(this,zt(r)))return!1;(r=t.cT(r)).layers=Nn(r.layers);const n=function(t,r){if(!t)return[{command:Vn.setStyle,args:[r]}];let i=[];try{if(!e(t.version,r.version))return[{command:Vn.setStyle,args:[r]}];if(e(t.center,r.center)||i.push({command:Vn.setCenter,args:[r.center]}),e(t.zoom,r.zoom)||i.push({command:Vn.setZoom,args:[r.zoom]}),e(t.bearing,r.bearing)||i.push({command:Vn.setBearing,args:[r.bearing]}),e(t.pitch,r.pitch)||i.push({command:Vn.setPitch,args:[r.pitch]}),e(t.sprite,r.sprite)||i.push({command:Vn.setSprite,args:[r.sprite]}),e(t.glyphs,r.glyphs)||i.push({command:Vn.setGlyphs,args:[r.glyphs]}),e(t.imports,r.imports)||function(t=[],r=[],i){r=r||[];const n=(t=t||[]).map(Zn),o=r.map(Zn),a=t.reduce(Wn,{}),s=r.reduce(Wn,{}),l=n.slice();let c,u,h,A;for(c=0,u=0;c<n.length;c++)h=n[c],s.hasOwnProperty(h)?u++:(i.push({command:Vn.removeImport,args:[h]}),l.splice(l.indexOf(h,u),1));for(c=0,u=0;c<o.length;c++)h=o[o.length-1-c],l[l.length-1-c]!==h&&(a.hasOwnProperty(h)?(i.push({command:Vn.removeImport,args:[h]}),l.splice(l.lastIndexOf(h,l.length-u),1)):u++,A=l[l.length-c],i.push({command:Vn.addImport,args:[s[h],A]}),l.splice(l.length-c,0,h));for(const t of r){const r=a[t.id];r&&!e(r,t)&&i.push({command:Vn.updateImport,args:[t.id,t]})}}(t.imports,r.imports,i),e(t.transition,r.transition)||i.push({command:Vn.setTransition,args:[r.transition]}),e(t.light,r.light)||i.push({command:Vn.setLight,args:[r.light]}),e(t.fog,r.fog)||i.push({command:Vn.setFog,args:[r.fog]}),e(t.projection,r.projection)||i.push({command:Vn.setProjection,args:[r.projection]}),e(t.lights,r.lights)||i.push({command:Vn.setLights,args:[r.lights]}),e(t.camera,r.camera)||i.push({command:Vn.setCamera,args:[r.camera]}),!e(t["color-theme"],r["color-theme"]))return[{command:Vn.setStyle,args:[r]}];const n={},o=[];!function(t,r,i,n){let o;for(o in r=r||{},t=t||{})t.hasOwnProperty(o)&&(r.hasOwnProperty(o)||jn(o,i,n));for(o in r){if(!r.hasOwnProperty(o))continue;const a=r[o];t.hasOwnProperty(o)?e(t[o],a)||("geojson"===t[o].type&&"geojson"===a.type&&Kn(t,r,o)?i.push({command:Vn.setGeoJSONSourceData,args:[o,a.data]}):Gn(o,r,i,n)):Hn(o,r,i)}}(t.sources,r.sources,o,n);const a=[];t.layers&&t.layers.forEach((t=>{t.source&&n[t.source]?i.push({command:Vn.removeLayer,args:[t.id]}):a.push(t)}));let s=t.terrain;s&&n[s.source]&&(i.push({command:Vn.setTerrain,args:[void 0]}),s=void 0),i=i.concat(o),e(s,r.terrain)||i.push({command:Vn.setTerrain,args:[r.terrain]}),function(t,r,i){r=r||[];const n=(t=t||[]).map(Zn),o=r.map(Zn),a=t.reduce(Wn,{}),s=r.reduce(Wn,{}),l=n.slice(),c=Object.create(null);let u,h,A,p,d,f,m;for(u=0,h=0;u<n.length;u++)A=n[u],s.hasOwnProperty(A)?h++:(i.push({command:Vn.removeLayer,args:[A]}),l.splice(l.indexOf(A,h),1));for(u=0,h=0;u<o.length;u++)A=o[o.length-1-u],l[l.length-1-u]!==A&&(a.hasOwnProperty(A)?(i.push({command:Vn.removeLayer,args:[A]}),l.splice(l.lastIndexOf(A,l.length-h),1)):h++,f=l[l.length-u],i.push({command:Vn.addLayer,args:[s[A],f]}),l.splice(l.length-u,0,A),c[A]=!0);for(u=0;u<o.length;u++)if(A=o[u],p=a[A],d=s[A],!c[A]&&!e(p,d))if(e(p.source,d.source)&&e(p["source-layer"],d["source-layer"])&&e(p.type,d.type)){for(m in qn(p.layout,d.layout,i,A,null,Vn.setLayoutProperty),qn(p.paint,d.paint,i,A,null,Vn.setPaintProperty),e(p.slot,d.slot)||i.push({command:Vn.setSlot,args:[A,d.slot]}),e(p.filter,d.filter)||i.push({command:Vn.setFilter,args:[A,d.filter]}),e(p.minzoom,d.minzoom)&&e(p.maxzoom,d.maxzoom)||i.push({command:Vn.setLayerZoomRange,args:[A,d.minzoom,d.maxzoom]}),p)p.hasOwnProperty(m)&&"layout"!==m&&"paint"!==m&&"filter"!==m&&"metadata"!==m&&"minzoom"!==m&&"maxzoom"!==m&&"slot"!==m&&(0===m.indexOf("paint.")?qn(p[m],d[m],i,A,m.slice(6),Vn.setPaintProperty):e(p[m],d[m])||i.push({command:Vn.setLayerProperty,args:[A,m,d[m]]}));for(m in d)d.hasOwnProperty(m)&&!p.hasOwnProperty(m)&&"layout"!==m&&"paint"!==m&&"filter"!==m&&"metadata"!==m&&"minzoom"!==m&&"maxzoom"!==m&&"slot"!==m&&(0===m.indexOf("paint.")?qn(p[m],d[m],i,A,m.slice(6),Vn.setPaintProperty):e(p[m],d[m])||i.push({command:Vn.setLayerProperty,args:[A,m,d[m]]}))}else i.push({command:Vn.removeLayer,args:[A]}),f=l[l.lastIndexOf(A)+1],i.push({command:Vn.addLayer,args:[d,f]})}(a,r.layers,i)}catch(t){console.warn("Unable to compute style diff:",t),i=[{command:Vn.setStyle,args:[r]}]}return i}(this.serialize(),r).filter((t=>!(t.command in Mo)));if(0===n.length)return!1;const o=n.filter((t=>!(t.command in So)));if(o.length>0)throw new Error(`Unimplemented: ${o.map((t=>t.command)).join(", ")}.`);const a=[];return n.forEach((t=>{a.push(this[t.command].apply(this,t.args))})),i&&Promise.all(a).then(i),this.stylesheet=r,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(e,r){return this.getImage(e)?this.fire(new t.d(new Error("An image with this name already exists."))):(this.imageManager.addImage(e,this.scope,r),this._afterImageUpdated(e),this)}updateImage(t,e){this.imageManager.updateImage(t,this.scope,e)}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(e){return this.getImage(e)?(this.imageManager.removeImage(e,this.scope),this._afterImageUpdated(e),this):this.fire(new t.d(new Error("No image with this name exists.")))}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(e),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new t.f("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,e,r={}){return this._checkLoaded(),this._validate(qt,`models.${t}`,e,null,r)||(this.modelManager.addModel(t,e,this.scope),this._changes.setDirty()),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(e){return this.hasModel(e)?(this.modelManager.removeModel(e,this.scope),this):this.fire(new t.d(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(e,r,i={}){if(this._checkLoaded(),void 0!==this.getOwnSource(e))throw new Error(`There is already a source with ID "${e}".`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(Rt,`sources.${e}`,r,null,i))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const n=Lr(e,r,this.dispatcher,this);n.scope=this.scope,n.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(n.id),source:n.serialize(),sourceId:n.id})));const o=e=>{const r=(e?"symbol:":"other:")+n.id,i=t.al(r,this.scope),o=this._sourceCaches[r]=new t.bv(i,n,e);(e?this._symbolSourceCaches:this._otherSourceCaches)[n.id]=o,o.onAdd(this.map)};o(!1),"vector"!==r.type&&"geojson"!==r.type||o(!0),n.onAdd&&n.onAdd(this.map),i.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(e){this._checkLoaded();const r=this.getOwnSource(e);if(!r)throw new Error("There is no source with this ID");for(const r in this._layers)if(this._layers[r].source===e)return this.fire(new t.d(new Error(`Source "${e}" cannot be removed while layer "${r}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===e)return this.fire(new t.d(new Error(`Source "${e}" cannot be removed while terrain is using it.`)));const i=this.getOwnSourceCaches(e);for(const e of i){const r=t.cU(e.id);delete this._sourceCaches[r],this._changes.discardSourceCacheUpdate(e.id),e.fire(new t.f("data",{sourceDataType:"metadata",dataType:"source",sourceId:e.getSource().id})),e.setEventedParent(null),e.clearTiles()}return delete this._otherSourceCaches[e],delete this._symbolSourceCaches[e],this.mergeSources(),r.setEventedParent(null),r.onRemove&&r.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,e){this._checkLoaded(),this.getOwnSource(t).setData(e),this._changes.setDirty()}getOwnSource(t){const e=this.getOwnSourceCache(t);return e&&e.getSource()}getOwnSources(){const t=[];for(const e in this._otherSourceCaches){const r=this.getOwnSourceCache(e);r&&t.push(r.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const e in t){const r=t[e]._tiles;for(const t in r){const e=r[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}}return!0}setLights(e){if(this._checkLoaded(),!e)return delete this.ambientLight,void delete this.directionalLight;const r=this._getTransitionParameters();for(const t of e){if(this._validate(Qt,"lights",t))return;switch(t.type){case"ambient":if(this.ambientLight){const e=this.ambientLight;e.set(t),e.updateTransitions(r)}else this.ambientLight=new ce(t,ue,this.scope,this.options);break;case"directional":if(this.directionalLight){const e=this.directionalLight;e.set(t),e.updateTransitions(r)}else this.directionalLight=new ce(t,he,this.scope,this.options)}}const i=new t.X(this.z||0,r);this.ambientLight&&this.ambientLight.recalculate(i),this.directionalLight&&this.directionalLight.recalculate(i),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const e=this.directionalLight,r=this.ambientLight;if(!e||!r)return;const i=t=>.2126*(t[0]<=.03928?t[0]/12.92:Math.pow((t[0]+.055)/1.055,2.4))+.7152*(t[1]<=.03928?t[1]/12.92:Math.pow((t[1]+.055)/1.055,2.4))+.0722*(t[2]<=.03928?t[2]/12.92:Math.pow((t[2]+.055)/1.055,2.4)),n=e.properties.get("color").toRenderColor(null).toArray01(),o=e.properties.get("intensity"),a=e.properties.get("direction"),s=1-t.ac(a.x,a.y,a.z)[2]/90,l=i(n)*o*s,c=r.properties.get("color").toRenderColor(null).toArray01(),u=r.properties.get("intensity");return(l+i(c)*u)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(e){if(!e)return this;if(t.cV(e)){const r=t.cW(e),i=this.fragments.find((({id:t})=>t===r));if(!i)throw new Error(`Style import not found: ${e}`);const n=t.cU(e);return i.style.getFragmentStyle(n)}{const t=this.fragments.find((({id:t})=>t===e));if(!t)throw new Error(`Style import not found: ${e}`);return t.style}}getConfigProperty(e,r){const i=this.getFragmentStyle(e);if(!i)return null;const n=t.al(r,i.scope),o=i.options.get(n),a=o?o.value||o.default:null;return a?a.serialize():null}setConfigProperty(e,r,i){const n=this.getFragmentStyle(e);if(!n)return;const o=n.stylesheet.schema;if(!o||!o[r])return;const a=t.y(i);if("success"!==a.result)return void Io(this,a.value);const s=a.value.expression,l=t.al(r,n.scope),c=n.options.get(l);if(!c)return;let u;const{minValue:h,maxValue:A,stepValue:p,type:d,values:f}=o[r],m=t.y(o[r].default);"success"===m.result&&(u=m.value.expression),u?(this.options.set(l,{...c,value:s,default:u,minValue:h,maxValue:A,stepValue:p,type:d,values:f}),this.updateConfigDependencies()):this.fire(new t.d(new Error(`No schema defined for the config option "${r}" in the "${e}" fragment.`)))}getConfig(e){const r=this.getFragmentStyle(e);if(!r)return null;const i=r.stylesheet.schema;if(!i)return null;const n={};for(const e in i){const i=t.al(e,r.scope),o=r.options.get(i),a=o?o.value||o.default:null;n[e]=a?a.serialize():null}return n}setConfig(t,e){const r=this.getFragmentStyle(t);r&&(r.updateConfig(e,r.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const e=this.getFragmentStyle(t);return e?e.stylesheet.schema:null}setSchema(t,e){const r=this.getFragmentStyle(t);r&&(r.stylesheet.schema=e,r.updateConfig(r._config,e),this.updateConfigDependencies())}updateConfig(e,r){if(this._config=e,e||r)if(r)for(const i in r){let n,o;const a=t.y(r[i].default);if("success"===a.result&&(n=a.value.expression),e&&void 0!==e[i]){const r=t.y(e[i]);"success"===r.result&&(o=r.value.expression)}const{minValue:s,maxValue:l,stepValue:c,type:u,values:h}=r[i];if(n){const e=t.al(i,this.scope);this.options.set(e,{default:n,value:o,minValue:s,maxValue:l,stepValue:c,type:u,values:h})}else this.fire(new t.d(new Error(`No schema defined for config option "${i}".`)))}else this.fire(new t.d(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const t of this._configDependentLayers){const e=this.getLayer(t);e&&(e.possiblyEvaluateVisibility(),this._updateLayer(e))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle((t=>{if(t._styleColorTheme.colorTheme){const e=t._evaluateColorThemeData(t._styleColorTheme.colorTheme);(!t._styleColorTheme.lut||t._styleColorTheme.lut&&e!==t._styleColorTheme.lut.data)&&t.setColorTheme(t._styleColorTheme.colorTheme)}})),this._changes.setDirty()}addLayer(e,r,i={}){this._checkLoaded();const n=e.id;if(this._layers[n])return void this.fire(new t.d(new Error(`Layer with id "${n}" already exists on this map`)));let o;if("custom"===e.type){if(Io(this,t.cX(e)))return;o=t.cY(e,this.scope,this._styleColorTheme.lut,this.options)}else{if("object"==typeof e.source&&(this.addSource(n,e.source),e=t.cT(e),e=t.W(e,{source:n})),this._validate(Ht,`layers.${n}`,e,{arrayIndex:-1},i))return;o=t.cY(e,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(o),o.setEventedParent(this,{layer:{id:n}}),this._serializedLayers[o.id]=o.serialize()}o.isConfigDependent&&this._configDependentLayers.add(o.fqid);let a=this._order.length;if(r){const e=this._order.indexOf(r);if(-1===e)return void this.fire(new t.d(new Error(`Layer with id "${r}" does not exist on this map.`)));o.slot===this._layers[r].slot?a=e:t.w(`Layer with id "${r}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(a,0,n),this._layerOrderChanged=!0,this._layers[n]=o;const s=this.getOwnLayerSourceCache(o),l=!!this.directionalLight&&this.directionalLight.shadowsEnabled();s&&o.canCastShadows()&&l&&(s.castsShadows=!0);const c=this._changes.getRemovedLayer(o);if(c&&o.source&&s&&"custom"!==o.type){this._changes.discardLayerRemoval(o);const e=t.al(o.source,o.scope);c.type!==o.type?this._changes.updateSourceCache(e,"clear"):(this._changes.updateSourceCache(e,"reload"),s.pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map),o.scope=this.scope,this.mergeLayers()}moveLayer(e,r){this._checkLoaded();const i=this._checkLayer(e);if(!i)return;if(e===r)return;const n=this._order.indexOf(e);this._order.splice(n,1);let o=this._order.length;if(r){const e=this._order.indexOf(r);if(-1===e)return void this.fire(new t.d(new Error(`Layer with id "${r}" does not exist on this map.`)));i.slot===this._layers[r].slot?o=e:t.w(`Layer with id "${r}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(o,0,e),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const e=this._checkLayer(t);if(!e)return;e.setEventedParent(null);const r=this._order.indexOf(t);this._order.splice(r,1),delete this._layers[t],delete this._serializedLayers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(e.fqid),this._changes.removeLayer(e);const i=this.getOwnLayerSourceCache(e);if(i&&i.castsShadows){let t=!1;for(const r in this._layers)if(this._layers[r].source===e.source&&this._layers[r].canCastShadows()){t=!0;break}i.castsShadows=t}e.onRemove&&e.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const e in this._layers)if(this._layers[e].type===t)return!0;return!1}setLayerZoomRange(t,e,r){this._checkLoaded();const i=this._checkLayer(t);i&&(i.minzoom===e&&i.maxzoom===r||(null!=e&&(i.minzoom=e),null!=r&&(i.maxzoom=r),this._updateLayer(i)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,e){this._checkLoaded();const r=this._checkLayer(t);r&&r.slot!==e&&(r.slot=e,this._updateLayer(r))}setFilter(r,i,n={}){this._checkLoaded();const o=this._checkLayer(r);if(o&&!e(o.filter,i))return null==i?(o.filter=void 0,void this._updateLayer(o)):void(this._validate(jt,`layers.${o.id}.filter`,i,{layerType:o.type},n)||(o.filter=t.cT(i),this._updateLayer(o)))}getFilter(e){const r=this._checkLayer(e);if(r)return t.cT(r.filter)}setLayoutProperty(r,i,n,o={}){this._checkLoaded();const a=this._checkLayer(r);if(a&&!e(a.getLayoutProperty(i),n)){if(null!=n&&(!o||!1!==o.validate)&&Io(a,Kt.call(zt,{key:`layers.${r}.layout.${i}`,layerType:a.type,objectKey:i,value:n,styleSpec:t.L,style:{glyphs:!0,sprite:!0}})))return;a.setLayoutProperty(i,n),a.isConfigDependent&&this._configDependentLayers.add(a.fqid),this._updateLayer(a)}}getLayoutProperty(t,e){const r=this._checkLayer(t);if(r)return r.getLayoutProperty(e)}setPaintProperty(r,i,n,o={}){this._checkLoaded();const a=this._checkLayer(r);if(!a)return;if(e(a.getPaintProperty(i),n))return;if(null!=n&&(!o||!1!==o.validate)&&Io(a,Gt.call(zt,{key:`layers.${r}.paint.${i}`,layerType:a.type,objectKey:i,value:n,styleSpec:t.L})))return;const s=a.setPaintProperty(i,n);a.isConfigDependent&&this._configDependentLayers.add(a.fqid),s&&this._updateLayer(a),this._changes.updatePaintProperties(a)}getPaintProperty(t,e){const r=this._checkLayer(t);if(r)return r.getPaintProperty(e)}setFeatureState(e,r){this._checkLoaded();const i=e.source,n=e.sourceLayer,o=this._checkSource(i);if(!o)return;const a=o.type;if("geojson"===a&&n)return void this.fire(new t.d(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===a&&!n)return void this.fire(new t.d(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===e.id&&this.fire(new t.d(new Error("The feature id parameter must be provided.")));const s=this.getOwnSourceCaches(i);for(const t of s)t.setFeatureState(n,e.id,r)}removeFeatureState(e,r){this._checkLoaded();const i=e.source,n=this._checkSource(i);if(!n)return;const o=n.type,a="vector"===o?e.sourceLayer:void 0;if("vector"===o&&!a)return void this.fire(new t.d(new Error("The sourceLayer parameter must be provided for vector source types.")));if(r&&"string"!=typeof e.id&&"number"!=typeof e.id)return void this.fire(new t.d(new Error("A feature id is required to remove its specific state property.")));const s=this.getOwnSourceCaches(i);for(const t of s)t.removeFeatureState(a,e.id,r)}getFeatureState(e){this._checkLoaded();const r=e.source,i=e.sourceLayer,n=this._checkSource(r);if(n){if("vector"!==n.type||i)return void 0===e.id&&this.fire(new t.d(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(r)[0].getFeatureState(i,e.id);this.fire(new t.d(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(e){return this.stylesheet.transition=t.W({},this.stylesheet.transition,e),this.transition=this.stylesheet.transition,this}getTransition(){return t.W({},this.stylesheet.transition)}serialize(){this._checkLoaded();const e=this.getTerrain(),r=e&&this.terrain&&this.terrain.scope===this.scope?e:this.stylesheet.terrain;return t.cZ({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:r,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(t=>void 0!==t))}_updateLayer(e){this._changes.updateLayer(e);const r=this.getLayerSourceCache(e),i=t.al(e.source,e.scope),n=this._changes.getUpdatedSourceCaches();e.source&&!n[i]&&r&&"raster"!==r.getSource().type&&(this._changes.updateSourceCache(i,"reload"),r.pause()),e.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const e=t=>"fill-extrusion"===this._mergedLayers[t].type||"model"===this._mergedLayers[t].type,r=this.order,i={},n=[];for(let o=r.length-1;o>=0;o--){const a=r[o];if(e(a)){i[a]=o;for(const e of t){const t=e[a];if(t)for(const e of t)n.push(e)}}}n.sort(((t,e)=>e.intersectionZ-t.intersectionZ));const o=[];for(let a=r.length-1;a>=0;a--){const s=r[a];if(e(s))for(let t=n.length-1;t>=0;t--){const e=n[t].feature;if(e.layer&&i[e.layer.id]<a)break;o.push(e),n.pop()}else for(const e of t){const t=e[s];if(t)for(const e of t)o.push(e.feature)}}return o}queryRenderedFeatures(e,r,i){r&&r.filter&&this._validate(jt,"queryRenderedFeatures.filter",r.filter,null,r),r.scope=this.scope,r.availableImages=this._availableImages,r.serializedLayers=this._serializedLayers;const n={};if(r&&r.layers){if(!Array.isArray(r.layers))return this.fire(new t.d(new Error("parameters.layers must be an Array."))),[];for(const e of r.layers){const r=this._mergedLayers[e];if(!r)return this.fire(new t.d(new Error(`The layer '${e}' does not exist in the map's style and cannot be queried for features.`))),[];n[r.source]=!0}}const o=[],a=r.serializedLayers||{},s=r&&r.layers?r.layers.some((t=>{const e=this.getLayer(t);return e&&e.is3D()})):this.has3DLayers(),l=Fn.createFromScreenPoints(e,i);for(const t in this._mergedSourceCaches){const e=this._mergedSourceCaches[t].getSource();if(!e||e.scope!==r.scope)continue;const c=this._mergedSourceCaches[t].getSource().id;r.layers&&!n[c]||o.push(kn(this._mergedSourceCaches[t],this._mergedLayers,a,l,r,i,s,!!this.map._showQueryGeometry))}return this.placement&&o.push(function(t,e,r,i,n,o,a){const s={},l=o.queryRenderedSymbols(i),c=[];for(const t of Object.keys(l).map(Number))c.push(a[t]);c.sort(Rn);for(const r of c){const i=r.featureIndex.lookupSymbolFeatures(l[r.bucketInstanceId],e,r.bucketIndex,r.sourceLayerIndex,n.filter,n.layers,n.availableImages,t);for(const t in i){const e=s[t]=s[t]||[],n=i[t];n.sort(((t,e)=>{const i=r.featureSortOrder;if(i){const r=i.indexOf(t.featureIndex);return i.indexOf(e.featureIndex)-r}return e.featureIndex-t.featureIndex}));for(const t of n)e.push(t)}}for(const e in s)s[e].forEach((i=>{const n=i.feature,o=r(t[e]);if(!o)return;const a=o.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=a}));return s}(this._mergedLayers,a,this.getLayerSourceCache.bind(this),l.screenGeometry,r,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(o)}querySourceFeatures(t,e){e&&e.filter&&this._validate(jt,"querySourceFeatures.filter",e.filter,null,e);const r=this.getOwnSourceCaches(t);let i=[];for(const t of r)i=i.concat(zn(t,e));return i}addSourceType(t,e,r){return Lo.getSourceType(t)?r(new Error(`A source type called "${t}" already exists.`)):(Lo.setSourceType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},r):r(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,r,i={}){this._checkLoaded();const n=this.light.getLight();let o=!1;for(const r in t)if(!e(t[r],n[r])){o=!0;break}if(!o)return;const a=this._getTransitionParameters();this.light.setLight(t,r,i),this.light.updateTransitions(a)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){void 0===this.disableElevatedTerrain&&(this.disableElevatedTerrain=t.e.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&t.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(r,i=1){if(this._checkLoaded(),!r)return this.terrainSetForDrapingOnly()&&0!==i||delete this.terrain,null===r?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let n=r;const o=null==r.source;if(1===i){if(this.disableElevatedTerrain)return;if("object"==typeof n.source){const e="terrain-dem-src";this.addSource(e,n.source),n=t.cT(n),n=t.W(n,{source:e})}const e=t.W({},n),r={};if(this.terrain&&o){e.source=this.terrain.get().source;const t=this.terrain?this.getFragmentStyle(this.terrain.scope):null;t&&(r.style=t.serialize())}if(this._validate(Nt,"terrain",e,r))return}if(!this.terrain||this.terrain.scope!==this.scope&&!o||this.terrain&&i!==this.terrain.drapeRenderMode){if(!n)return;this._createTerrain(n,i),this.fire(new t.f("data",{dataType:"style"}))}else{const i=this.terrain,o=i.get();for(const e of Object.keys(t.L.terrain))!n.hasOwnProperty(e)&&t.L.terrain[e].default&&(n[e]=t.L.terrain[e].default);for(const n in r)if(!e(r[n],o[n])){i.set(r,this.options),this.stylesheet.terrain=r;const e=this._getTransitionParameters({duration:0});i.updateTransitions(e),this.fire(new t.f("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const e=this.fog=new le(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=e.get();const r=this._getTransitionParameters({duration:0});e.updateTransitions(r)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask((()=>{for(const t of this.map._markers)t._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const r=this.fog;if(!e(r.get(),t)){r.set(t,this.options),this.stylesheet.fog=r.get();const e=this._getTransitionParameters({duration:0});r.updateTransitions(e)}}else this._createFog(t);this._markersNeedUpdate=!0}setColorTheme(e){this._checkLoaded();const r=()=>{for(const t in this._layers)this._layers[t].lut=this._styleColorTheme.lut;for(const t in this._sourceCaches)this._sourceCaches[t].clearTiles()};if(this._styleColorTheme.colorTheme=e,!e)return this._styleColorTheme.lut=null,void r();const i=this._evaluateColorThemeData(e);this._loadColorTheme(i).then((()=>{this.fire(new t.f("colorthemeset")),r()})).catch((e=>{t.w(`Couldn't set color theme: ${e}`)}))}_getTransitionParameters(e){return{now:t.e.now(),transition:t.W(this.transition,e)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],e=[];for(const r in this._mergedLayers)this.isLayerDraped(this._mergedLayers[r])?t.push(r):e.push(r);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...e)}_createTerrain(t,e){const r=this.terrain=new Jt(t,e,this.scope,this.options);1===e&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const i=this._getTransitionParameters({duration:0});r.updateTransitions(i)}_force3DLayerUpdate(){for(const t in this._layers){const e=this._layers[t];"fill-extrusion"===e.type&&this._updateLayer(e)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const e=this._layers[t];"symbol"===e.type&&this._updateLayer(e)}}_validate(e,r,i,n,o={}){if(o&&!1===o.validate)return!1;const a=t.W({},this.serialize());return Io(this,e.call(zt,t.W({key:r,style:a,value:i,styleSpec:t.L},n)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.c_.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(t){const e=this.getSourceCaches(t);for(const t of e)t.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const e=this.getSourceCaches(t);for(const t of e)t.resume(),t.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}updateSources(t){let e;this.directionalLight&&(e=xr(this.directionalLight));for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].update(t,void 0,void 0,e)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const e=this._sourceCaches[t];e.resume(),e.reload()}}_updatePlacement(e,r,i,n,o,a,s=!1){let l=!1,c=!1;const u={},h={};for(const e of this._mergedOrder){const i=this._mergedLayers[e];if("symbol"!==i.type)continue;const n=t.al(i.source,i.scope);let o=u[n];if(!o){const t=this.getLayerSourceCache(i);if(!t)continue;const e=t.getRenderableIds(!0).map((e=>t.getTileByID(e)));h[n]=e.slice(),o=u[n]=e.sort(((t,e)=>e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1)))}const a=this.crossTileSymbolIndex.addLayer(i,o,r.center.lng,r.projection);l=l||a}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),s=s||this._layerOrderChanged||0===n,this._layerOrderChanged&&this.fire(new t.f("neworder")),(s||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.e.now(),r.zoom))&&(this.pauseablePlacement=new xo(r,this._mergedOrder,s,i,n,o,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,u,h),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.e.now()),c=!0),l&&this.pauseablePlacement.placement.setStale()),c||l){this._buildingIndex.onNewFrame(r.zoom);for(let e=0;e<this._mergedOrder.length;e++){const r=this._mergedLayers[this._mergedOrder[e]];if("symbol"!==r.type)continue;const i=this.isLayerClipped(r)&&this._clipLayerIndices.some((t=>e<t));this.placement.updateLayerOpacities(r,u[t.al(r.source,r.scope)],e,i?a:null)}}let A=!1;for(const r of this._mergedOrder){const i=this._mergedLayers[r];if("symbol"!==i.type)continue;const n=u[t.al(i.source,i.scope)];for(const t of n){const r=t.getBucket(i);r&&t.latestFeatureIndex&&i.fqid===r.layerIds[0]&&(A=r.updateOcclusionOpacities(e.context,e.symbolParams,e._dt)||A)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.e.now())||A,occlusionQueryBasedOpacityChanged:A}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(e,r){this._checkLoaded();const i=this.stylesheet.imports=this.stylesheet.imports||[];if(-1!==i.findIndex((({id:t})=>t===e.id)))return void this.fire(new t.d(new Error(`Import with id '${e.id}' already exists in the map's style.`)));if(!r)return i.push(e),this._loadImports([e],!0);const n=i.findIndex((({id:t})=>t===r));return-1===n&&this.fire(new t.d(new Error(`Import with id "${r}" does not exist on this map.`))),this.stylesheet.imports=i.slice(0,n).concat(e).concat(i.slice(n)),this._loadImports([e],!0,r)}updateImport(t,r){this._checkLoaded();const i=this.stylesheet.imports||[],n=this.getImportIndex(t);return-1===n?this:"string"==typeof r?(this.setImportUrl(t,r),this):(r.url&&r.url!==i[n].url&&this.setImportUrl(t,r.url),e(r.config,i[n].config)||this.setImportConfig(t,r.config),e(r.data,i[n].data)||this.setImportData(t,r.data),this)}moveImport(t,e){this._checkLoaded();let r=this.stylesheet.imports||[];const i=this.getImportIndex(t);if(-1===i)return this;const n=this.getImportIndex(e);if(-1===n)return this;const o=r[i],a=this.fragments[i];return r=r.filter((({id:e})=>e!==t)),this.fragments=this.fragments.filter((({id:e})=>e!==t)),this.stylesheet.imports=r.slice(0,n).concat(o).concat(r.slice(n)),this.fragments=this.fragments.slice(0,n).concat(a).concat(this.fragments.slice(n)),this.mergeLayers(),this}setImportUrl(t,e){this._checkLoaded();const r=this.stylesheet.imports||[],i=this.getImportIndex(t);if(-1===i)return this;r[i].url=e;const n=this.fragments[i];return n.style=this._createFragmentStyle(r[i]),n.style.on("style.import.load",(()=>this.mergeAll())),n.style.loadURL(e),this}setImportData(t,e){this._checkLoaded();const r=this.getImportIndex(t),i=this.stylesheet.imports||[];return-1===r?this:e?(this.fragments[r].style.setState(e),this._reloadImports(),this):(delete i[r].data,this.setImportUrl(t,i[r].url))}setImportConfig(t,e){this._checkLoaded();const r=this.getImportIndex(t),i=this.stylesheet.imports||[];if(-1===r)return this;e?i[r].config=e:delete i[r].config;const n=this.fragments[r],o=n.style.stylesheet&&n.style.stylesheet.schema;return n.config=e,n.style.updateConfig(e,o),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const e=this.stylesheet.imports||[],r=this.getImportIndex(t);-1!==r&&(e.splice(r,1),this.fragments[r].style._remove(),this.fragments.splice(r,1),this._reloadImports())}getImportIndex(e){const r=(this.stylesheet.imports||[]).findIndex((t=>t.id===e));return-1===r&&this.fire(new t.d(new Error(`Import '${e}' does not exist in the map's style and cannot be updated.`))),r}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const e in this._mergedOtherSourceCaches){const r=this._mergedOtherSourceCaches[e];r&&t.push(r.getSource())}return t}getSource(t,e){const r=this.getSourceCache(t,e);return r&&r.getSource()}getLayerSource(t){const e=this.getLayerSourceCache(t);return e&&e.getSource()}getSourceCache(e,r){const i=t.al(e,r);return this._mergedOtherSourceCaches[i]}getLayerSourceCache(e){const r=t.al(e.source,e.scope);return"symbol"===e.type?this._mergedSymbolSourceCaches[r]:this._mergedOtherSourceCaches[r]}getSourceCaches(t){if(null==t)return Object.values(this._mergedSourceCaches);const e=[];return this._mergedOtherSourceCaches[t]&&e.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&e.push(this._mergedSymbolSourceCaches[t]),e}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const e in t){const r=t[e];"reload"===r?this.reloadSource(e):"clear"===r&&this.clearSource(e)}}updateLayers(t){const e=this._changes.getUpdatedPaintProperties();for(const r of e){const e=this.getLayer(r);e&&e.updateTransitions(t)}}getImages(t,e,r){this.imageManager.getImages(e.icons,e.scope,r),this._updateTilesForChangedImages();const i=t=>{t&&t.setDependencies(e.tileID.key,e.type,e.icons)};i(this._otherSourceCaches[e.source]),i(this._symbolSourceCaches[e.source])}getGlyphs(t,e,r){this.glyphManager.getGlyphs(e.stacks,e.scope,r)}getResource(e,r,i){return t.c$(r,i)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return"symbol"===t.type?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const e=[];return this._otherSourceCaches[t]&&e.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&e.push(this._symbolSourceCaches[t]),e}_isSourceCacheLoaded(e){const r=this.getOwnSourceCaches(e);return 0===r.length?(this.fire(new t.d(new Error(`There is no source with ID '${e}'`))),!1):r.every((t=>t.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(e,r){if(0===this._clipLayerIndices.length&&"fill-extrusion"!==e.type)return!1;const i="fill-extrusion"===e.type&&"building"===e.sourceLayer;let n=0;if(e.is3D()){if(i||r&&"batched-model"===r.type)return!0;"model"===e.type&&(n=t.cu.Model)}else"symbol"===e.type&&(n=t.cu.Symbol);for(const e of this._clipLayerIndices){const r=this._mergedLayers[this._mergedOrder[e]];if(!r)continue;const i=[];for(const e of r.layout.get("clip-layer-types"))i.push("model"===e?t.cu.Model:"symbol"===e?t.cu.Symbol:t.cu.FillExtrusion);for(const t of i)if(n&t)return!0}return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach((t=>{t.style._remove()})),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function Do(t,e){let r=!1,i=null;const n=()=>{i=null,r&&(t(),i=setTimeout(n,e),r=!1)};return()=>(r=!0,i||n(),i)}Lo.getSourceType=function(t){return Pr[t]},Lo.setSourceType=function(t,e){Pr[t]=e},Lo.registerForPluginStateChange=t.cL;class Uo{constructor(e){this._hashName=e&&encodeURIComponent(e),t.bp(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Do(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const e=ko(t);if(this._hashName){const t=this._hashName;let r=!1;const i=location.hash.slice(1).split("&").map((i=>{const n=i.split("=")[0];return n===t?(r=!0,`${n}=${e}`):i})).filter((t=>t));return r||i.push(`${t}=${e}`),`#${i.join("&")}`}return`#${e}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let e;return t.split("&").map((t=>t.split("="))).forEach((t=>{t[0]===this._hashName&&(e=t)})),(e&&e[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const e=this._getCurrentHash();if(e.length>=3&&!e.some((t=>isNaN(t)))){const r=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(e[3]||0):t.getBearing();return t.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:r,pitch:+(e[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function ko(t,e){const r=t.getCenter(),i=Math.round(100*t.getZoom())/100,n=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),o=Math.pow(10,n),a=Math.round(r.lng*o)/o,s=Math.round(r.lat*o)/o,l=t.getBearing(),c=t.getPitch();let u=e?`/${a}/${s}/${i}`:`${i}/${s}/${a}`;return(l||c)&&(u+="/"+Math.round(10*l)/10),c&&(u+=`/${Math.round(c)}`),u}const zo={linearity:.3,easing:t.d0(0,0,.3,1)},Ro=t.W({deceleration:2500,maxSpeed:1400},zo),Oo=t.W({deceleration:20,maxSpeed:1400},zo),Qo=t.W({deceleration:1e3,maxSpeed:360},zo),No=t.W({deceleration:1e3,maxSpeed:90},zo);class Vo{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:t.e.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,r=t.e.now();for(;e.length>0&&r-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._map._prefersReducedMotion())return;if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const r={zoom:0,bearing:0,pitch:0,pan:new t.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:t}of this._inertiaBuffer)r.zoom+=t.zoomDelta||0,r.bearing+=t.bearingDelta||0,r.pitch+=t.pitchDelta||0,t.panDelta&&r.pan._add(t.panDelta),t.around&&(r.around=t.around),t.pinchAround&&(r.pinchAround=t.pinchAround);const i=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,n={};if(r.pan.mag()){const o=jo(r.pan.mag(),i,t.W({},Ro,e||{}));n.offset=r.pan.mult(o.amount/r.pan.mag()),n.center=this._map.transform.center,Ho(n,o)}if(r.zoom){const t=jo(r.zoom,i,Oo);n.zoom=this._map.transform.zoom+t.amount,Ho(n,t)}if(r.bearing){const e=jo(r.bearing,i,Qo);n.bearing=this._map.transform.bearing+t.at(e.amount,-179,179),Ho(n,e)}if(r.pitch){const t=jo(r.pitch,i,No);n.pitch=this._map.transform.pitch+t.amount,Ho(n,t)}if(n.zoom||n.bearing){const t=void 0===r.pinchAround?r.around:r.pinchAround;n.around=t?this._map.unproject(t):this._map.getCenter()}return this.clear(),n.noMoveStart=!0,n}}function Ho(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function jo(e,r,i){const{maxSpeed:n,linearity:o,deceleration:a}=i,s=t.at(e*o/(r/1e3),-n,n),l=Math.abs(s)/(a*o);return{easing:i.easing,duration:1e3*l,amount:s*(l/2)}}class Go extends t.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,i,n={}){const o=d(r.getCanvasContainer(),i),a=r.unproject(o);super(e,t.W({point:o,lngLat:a,originalEvent:i},n)),this._defaultPrevented=!1,this.target=r}}class Ko extends t.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,i){const n="touchend"===e?i.changedTouches:i.touches,o=f(r.getCanvasContainer(),n),a=o.map((t=>r.unproject(t))),s=o.reduce(((t,e,r,i)=>t.add(e.div(i.length))),new t.P(0,0));super(e,{points:o,point:s,lngLats:a,lngLat:r.unproject(s),originalEvent:i}),this._defaultPrevented=!1}}class qo extends t.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,e){super("wheel",{originalEvent:e}),this._defaultPrevented=!1}}class Zo{constructor(t,e){this._map=t,this._clickTolerance=e.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new qo(this._map,t))}mousedown(t,e){return this._mousedownPos=e,this._firePreventable(new Go(t.type,this._map,t))}mouseup(t){this._map.fire(new Go(t.type,this._map,t))}preclick(e){const r=t.W({},e);r.type="preclick",this._map.fire(new Go(r.type,this._map,r))}click(t,e){this._mousedownPos&&this._mousedownPos.dist(e)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Go(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Go(t.type,this._map,t))}mouseover(t){this._map.fire(new Go(t.type,this._map,t))}mouseout(t){this._map.fire(new Go(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Ko(t.type,this._map,t))}touchmove(t){this._map.fire(new Ko(t.type,this._map,t))}touchend(t){this._map.fire(new Ko(t.type,this._map,t))}touchcancel(t){this._map.fire(new Ko(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Wo{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Go(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Go("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Go(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Xo{constructor(t,e){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=e.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(u(),this._startPos=this._lastPos=e,this._active=!0)}mousemoveWindow(t,e){if(!this._active)return;const r=e,i=this._startPos,n=this._lastPos;if(!i||!n||n.equals(r)||!this._box&&r.dist(i)<this._clickTolerance)return;this._lastPos=r,this._box||(this._box=o("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const a=Math.min(i.x,r.x),s=Math.max(i.x,r.x),l=Math.min(i.y,r.y),c=Math.max(i.y,r.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${a}px,${l}px)`,this._box.style.width=s-a+"px",this._box.style.height=c-l+"px")}))}mouseupWindow(e,r){if(!this._active)return;const i=this._startPos,n=r;if(i&&0===e.button){if(this.reset(),p(),i.x!==n.x||i.y!==n.y)return this._map.fire(new t.f("boxzoomend",{originalEvent:e})),{cameraAnimation:t=>t.fitScreenCoordinates(i,n,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",e)}}keydown(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),h(),delete this._startPos,delete this._lastPos}_fireEvent(e,r){return this._map.fire(new t.f(e,{originalEvent:r}))}}function $o(t,e){const r={};for(let i=0;i<t.length;i++)r[t[i].identifier]=e[i];return r}class Yo{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(e,r,i){(this.centroid||i.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=e.timeStamp),i.length===this.numTouches&&(this.centroid=function(e){const r=new t.P(0,0);for(const t of e)r._add(t);return r.div(e.length)}(r),this.touches=$o(i,r)))}touchmove(t,e,r){if(this.aborted||!this.centroid)return;const i=$o(r,e);for(const t in this.touches){const e=i[t];(!e||e.dist(this.touches[t])>30)&&(this.aborted=!0)}}touchend(t,e,r){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===r.length){const t=!this.aborted&&this.centroid;if(this.reset(),t)return t}}}class Jo{constructor(t){this.singleTap=new Yo(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,e,r){this.singleTap.touchstart(t,e,r)}touchmove(t,e,r){this.singleTap.touchmove(t,e,r)}touchend(t,e,r){const i=this.singleTap.touchend(t,e,r);if(i){const e=t.timeStamp-this.lastTime<500,r=!this.lastTap||this.lastTap.dist(i)<30;if(e&&r||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=i,this.count===this.numTaps)return this.reset(),i}}}class ta{constructor(){this._zoomIn=new Jo({numTouches:1,numTaps:2}),this._zoomOut=new Jo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,e,r){this._zoomIn.touchstart(t,e,r),this._zoomOut.touchstart(t,e,r)}touchmove(t,e,r){this._zoomIn.touchmove(t,e,r),this._zoomOut.touchmove(t,e,r)}touchend(t,e,r){const i=this._zoomIn.touchend(t,e,r),n=this._zoomOut.touchend(t,e,r);return i?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:e.getZoom()+1,around:e.unproject(i)},{originalEvent:t})}):n?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:e.getZoom()-1,around:e.unproject(n)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const ea={0:1,2:2};class ra{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,e){return!1}_move(t,e){return{}}mousedown(t,e){if(this._lastPoint)return;const r=m(t);this._correctButton(t,r)&&(this._lastPoint=e,this._eventButton=r)}mousemoveWindow(t,e){const r=this._lastPoint;if(r)if(t.preventDefault(),null!=this._eventButton&&function(t,e){const r=ea[e];return void 0===t.buttons||(t.buttons&r)!==r}(t,this._eventButton))this.reset();else if(this._moved||!(e.dist(r)<this._clickTolerance))return this._moved=!0,this._lastPoint=e,this._move(r,e)}mouseupWindow(t){this._lastPoint&&m(t)===this._eventButton&&(this._moved&&p(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ia extends ra{mousedown(t,e){super.mousedown(t,e),this._lastPoint&&(this._active=!0)}_correctButton(t,e){return 0===e&&!t.ctrlKey}_move(t,e){return{around:e,panDelta:e.sub(t)}}}class na extends ra{_correctButton(t,e){return 0===e&&t.ctrlKey||2===e}_move(t,e){const r=.8*(e.x-t.x);if(r)return this._active=!0,{bearingDelta:r}}contextmenu(t){t.preventDefault()}}class oa extends ra{_correctButton(t,e){return 0===e&&t.ctrlKey||2===e}_move(t,e){const r=-.5*(e.y-t.y);if(r)return this._active=!0,{pitchDelta:r}}contextmenu(t){t.preventDefault()}}class aa{constructor(e,r){this._map=e,this._el=e.getCanvasContainer(),this._minTouches=1,this._clickTolerance=r.clickTolerance||1,this.reset(),t.bp(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new t.P(0,0)}touchstart(t,e,r){return this._calculateTransform(t,e,r)}touchmove(e,r,i){if(this._active&&!(i.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===i.length&&!t.d1())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return e.cancelable&&e.preventDefault(),this._calculateTransform(e,r,i)}}touchend(t,e,r){this._calculateTransform(t,e,r),this._active&&r.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,r,i){i.length>0&&(this._active=!0);const n=$o(i,r),o=new t.P(0,0),a=new t.P(0,0);let s=0;for(const t in n){const e=n[t],r=this._touches[t];r&&(o._add(e),a._add(e.sub(r)),s++,n[t]=e)}if(this._touches=n,s<this._minTouches||!a.mag())return;const l=a.div(s);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:o.div(s),panDelta:l}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=o("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")}),500)}}class sa{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,e,r){return{}}touchstart(t,e,r){this._firstTwoTouches||r.length<2||(this._firstTwoTouches=[r[0].identifier,r[1].identifier],this._start([e[0],e[1]]))}touchmove(t,e,r){const i=this._firstTwoTouches;if(!i)return;t.preventDefault();const[n,o]=i,a=la(r,e,n),s=la(r,e,o);if(!a||!s)return;const l=this._aroundCenter?null:a.add(s).div(2);return this._move([a,s],l,t)}touchend(t,e,r){if(!this._firstTwoTouches)return;const[i,n]=this._firstTwoTouches,o=la(r,e,i),a=la(r,e,n);o&&a||(this._active&&p(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function la(t,e,r){for(let i=0;i<t.length;i++)if(t[i].identifier===r)return e[i]}function ca(t,e){return Math.log(t/e)/Math.LN2}class ua extends sa{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,e){const r=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(ca(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ca(this._distance,r),pinchAround:e}}}function ha(t,e){return 180*t.angleWith(e)/Math.PI}class Aa extends sa{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,e){const r=this._vector;if(this._vector=t[0].sub(t[1]),r&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:ha(this._vector,r),pinchAround:e}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const e=25/(Math.PI*this._minDiameter)*360,r=this._startVector;if(!r)return!1;const i=ha(t,r);return Math.abs(i)<e}}function pa(t){return Math.abs(t.y)>Math.abs(t.x)}class da extends sa{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,pa(t[0].sub(t[1]))&&(this._valid=!1)}_move(e,r,i){const n=this._lastPoints;if(!n)return;const o=e[0].sub(n[0]),a=e[1].sub(n[1]);return this._map._cooperativeGestures&&!t.d1()&&i.touches.length<3||(this._valid=this.gestureBeginsVertically(o,a,i.timeStamp),!this._valid)?void 0:(this._lastPoints=e,this._active=!0,{pitchDelta:(o.y+a.y)/2*-.5})}gestureBeginsVertically(t,e,r){if(void 0!==this._valid)return this._valid;const i=t.mag()>=2,n=e.mag()>=2;if(!i&&!n)return;if(!i||!n)return null==this._firstMove&&(this._firstMove=r),r-this._firstMove<100&&void 0;const o=t.y>0==e.y>0;return pa(t)&&pa(e)&&o}}const fa={panStep:100,bearingStep:15,pitchStep:10};class ma{constructor(){const t=fa;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let e=0,r=0,i=0,n=0,o=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?r=-1:(t.preventDefault(),n=-1);break;case 39:t.shiftKey?r=1:(t.preventDefault(),n=1);break;case 38:t.shiftKey?i=1:(t.preventDefault(),o=-1);break;case 40:t.shiftKey?i=-1:(t.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(r=0,i=0),{cameraAnimation:a=>{const s=a.getZoom();a.easeTo({duration:300,easeId:"keyboardHandler",easing:ga,zoom:e?Math.round(s)+e*(t.shiftKey?2:1):s,bearing:a.getBearing()+r*this._bearingStep,pitch:a.getPitch()+i*this._pitchStep,offset:[-n*this._panStep,-o*this._panStep],center:a.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ga(t){return t*(2-t)}const _a=4.000244140625,ya=1/450;class va{constructor(e,r){this._map=e,this._el=e.getCanvasContainer(),this._handler=r,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=ya,t.bp(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(e){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(e.ctrlKey||e.metaKey||this.isZooming()||t.d1()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let r=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const i=t.e.now(),n=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,0!==r&&r%_a==0?this._type="wheel":0!==r&&Math.abs(r)<4?this._type="trackpad":n>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(n*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),e.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=e,this._delta-=r,this._active||this._start(e)),e.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const e=d(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:e,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const e=this._map.transform;"wheel"===this._type&&e.projection.wrap&&(e._center.lng>=180||e._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const r=()=>e._terrainEnabled()&&this._aroundCoord?e.computeZoomRelativeTo(this._aroundCoord):e.zoom;if(0!==this._delta){const t="wheel"===this._type&&Math.abs(this._delta)>_a?this._wheelZoomRate:this._defaultZoomRate;let i=2/(1+Math.exp(-Math.abs(this._delta*t)));this._delta<0&&0!==i&&(i=1/i);const n=r(),o=Math.pow(2,n),a="number"==typeof this._targetZoom?e.zoomScale(this._targetZoom):o;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(a*i))),"wheel"===this._type&&(this._startZoom=n,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const i="number"==typeof this._targetZoom?this._targetZoom:r(),n=this._startZoom,o=this._easing;let a,s=!1;if("wheel"===this._type&&n&&o){const e=Math.min((t.e.now()-this._lastWheelEventTime)/200,1),r=o(e);a=t.a2(n,i,r),e<1?this._frameId||(this._frameId=!0):s=!0}else a=i,s=!0;this._active=!0,s&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200));let l=a-r();return l*this._lastDelta<0&&(l=0),{noInertia:!0,needsRenderFrame:!s,zoomDelta:l,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let r=t.d2;if(this._prevEase){const e=this._prevEase,i=(t.e.now()-e.start)/e.duration,n=e.easing(i+.01)-e.easing(i),o=.27/Math.sqrt(n*n+1e-4)*.01,a=Math.sqrt(.0729-o*o);r=t.d0(o,a,.25,1)}return this._prevEase={start:t.e.now(),duration:e,easing:r},r}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=o("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")}),200)}}class xa{constructor(t,e){this._clickZoom=t,this._tapZoom=e}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class wa{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,e){return t.preventDefault(),{cameraAnimation:r=>{r.easeTo({duration:300,zoom:r.getZoom()+(t.shiftKey?-1:1),around:r.unproject(e)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ba{constructor(){this._tap=new Jo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,e,r){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?r.length>0&&(this._swipePoint=e[0],this._swipeTouch=r[0].identifier):this._tap.touchstart(t,e,r))}touchmove(t,e,r){if(this._tapTime){if(this._swipePoint){if(r[0].identifier!==this._swipeTouch)return;const i=e[0],n=i.y-this._swipePoint.y;return this._swipePoint=i,t.preventDefault(),this._active=!0,{zoomDelta:n/128}}}else this._tap.touchmove(t,e,r)}touchend(t,e,r){this._tapTime?this._swipePoint&&0===r.length&&this.reset():this._tap.touchend(t,e,r)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ba{constructor(t,e,r){this._el=t,this._mousePan=e,this._touchPan=r}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ca{constructor(t,e,r){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=e,this._mousePitch=r}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ea{constructor(t,e,r,i){this._el=t,this._touchZoom=e,this._touchRotate=r,this._tapDragZoom=i,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ta=t=>t.zoom||t.drag||t.pitch||t.rotate;class Ia extends t.f{}class Sa{constructor(){this.constants=[1,1,.01],this.radius=0}setup(e,r){const i=t._.sub([],r,e);this.radius=t._.length(i[2]<0?t._.div([],i,this.constants):[i[0],i[1],0])}projectRay(e){t._.div(e,e,this.constants),t._.normalize(e,e),t._.mul(e,e,this.constants);const r=t._.scale([],e,this.radius);if(r[2]>0){const e=t._.scale([],[0,0,1],t._.dot(r,[0,0,1])),i=t._.scale([],t._.normalize([],[r[0],r[1],0]),this.radius),n=t._.add([],r,t._.scale([],t._.sub([],t._.add([],i,e),r),2));r[0]=n[0],r[1]=n[1]}return r}}function Ma(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}class Fa{constructor(e,r){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Vo(e),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Sa,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(r),t.bp(["handleEvent","handleWindowEvent"],this);const i=this._el;this._listeners=[[i,"touchstart",{passive:!0}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[window,"blur",void 0]];for(const[t,e,r]of this._listeners){const i=t===document?this.handleWindowEvent:this.handleEvent;t.addEventListener(e,i,r)}}destroy(){for(const[t,e,r]of this._listeners){const i=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(e,i,r)}}_addDefaultHandlers(t){const e=this._map,r=e.getCanvasContainer();this._add("mapEvent",new Zo(e,t));const i=e.boxZoom=new Xo(e,t);this._add("boxZoom",i);const n=new ta,o=new wa;e.doubleClickZoom=new xa(o,n),this._add("tapZoom",n),this._add("clickZoom",o);const a=new ba;this._add("tapDragZoom",a);const s=e.touchPitch=new da(e);this._add("touchPitch",s);const l=new na(t),c=new oa(t);e.dragRotate=new Ca(t,l,c),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);const u=new ia(t),h=new aa(e,t);e.dragPan=new Ba(r,u,h),this._add("mousePan",u),this._add("touchPan",h,["touchZoom","touchRotate"]);const A=new Aa,p=new ua;e.touchZoomRotate=new Ea(r,p,A,a),this._add("touchRotate",A,["touchPan","touchZoom"]),this._add("touchZoom",p,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Wo(e));const d=e.scrollZoom=new va(e,this);this._add("scrollZoom",d,["mousePan"]);const f=e.keyboard=new ma;this._add("keyboard",f);for(const r of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[r]&&e[r].enable(t[r])}_add(t,e,r){this._handlers.push({handlerName:t,handler:e,allowed:r}),this._handlersById[t]=e}stop(t){if(!this._updatingCamera){for(const{handler:t}of this._handlers)t.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ta(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,e,r){for(const i in t)if(i!==r&&(!e||e.indexOf(i)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const e=[];for(const r of t)this._el.contains(r.target)&&e.push(r);return e}handleEvent(t,e){this._updatingCamera=!0;const r="renderFrame"===t.type,i=r?void 0:t,n={needsRenderFrame:!1},o={},a={},s=t.touches?this._getMapTouches(t.touches):void 0,l=s?f(this._el,s):r?void 0:d(this._el,t);for(const{handlerName:r,handler:c,allowed:u}of this._handlers){if(!c.isEnabled())continue;let h;this._blockedByActive(a,u,r)?c.reset():c[e||t.type]&&(h=c[e||t.type](t,l,s),this.mergeHandlerResult(n,o,h,r,i),h&&h.needsRenderFrame&&this._triggerRenderFrame()),(h||c.isActive())&&(a[r]=c)}const c={};for(const t in this._previousActiveHandlers)a[t]||(c[t]=i);this._previousActiveHandlers=a,(Object.keys(c).length||Ma(n))&&(this._changes.push([n,o,c]),this._triggerRenderFrame()),(Object.keys(a).length||Ma(n))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:u}=n;u&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],u(this._map))}mergeHandlerResult(e,r,i,n,o){if(!i)return;t.W(e,i);const a={handlerName:n,originalEvent:i.originalEvent||o};void 0!==i.zoomDelta&&(r.zoom=a),void 0!==i.panDelta&&(r.drag=a),void 0!==i.pitchDelta&&(r.pitch=a),void 0!==i.bearingDelta&&(r.rotate=a)}_applyChanges(){const e={},r={},i={};for(const[n,o,a]of this._changes)n.panDelta&&(e.panDelta=(e.panDelta||new t.P(0,0))._add(n.panDelta)),n.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+n.zoomDelta),n.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+n.bearingDelta),n.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+n.pitchDelta),void 0!==n.around&&(e.around=n.around),void 0!==n.aroundCoord&&(e.aroundCoord=n.aroundCoord),void 0!==n.pinchAround&&(e.pinchAround=n.pinchAround),n.noInertia&&(e.noInertia=n.noInertia),t.W(r,o),t.W(i,a);this._updateMapTransform(e,r,i),this._changes=[]}_updateMapTransform(e,r,i){const n=this._map,o=n.transform,a=t=>[t.x,t.y,t.z];if((()=>{const t=this._eventsInProgress.drag;return t&&!this._handlersById[t.handlerName].isActive()})()&&!Ma(e)){const t=o.zoom;o.cameraElevationReference="sea",null!=this._originalZoom&&o._orthographicProjectionAtLowPitch&&"globe"!==o.projection.name&&0===o.pitch?(o.cameraElevationReference="ground",o.zoom=this._originalZoom):(o.recenterOnTerrain(),o.cameraElevationReference="ground"),t!==o.zoom&&this._map._update(!0)}if(o._isCameraConstrained&&n._stop(!0),!Ma(e))return void this._fireEvents(r,i,!0);let{panDelta:s,zoomDelta:l,bearingDelta:c,pitchDelta:u,around:h,aroundCoord:A,pinchAround:p}=e;o._isCameraConstrained&&(l>0&&(l=0),o._isCameraConstrained=!1),void 0!==p&&(h=p),(l||(t=>r[t]&&!this._eventsInProgress[t])("drag"))&&h&&(this._dragOrigin=a(o.pointCoordinate3D(h)),this._originalZoom=o.zoom,this._trackingEllipsoid.setup(o._camera.position,this._dragOrigin)),o.cameraElevationReference="sea",n._stop(!0),h=h||n.transform.centerPoint,c&&(o.bearing+=c),u&&(o.pitch+=u),o._updateCameraState();const d=[0,0,0];if(s)if("mercator"===o.projection.name){const t=this._trackingEllipsoid.projectRay(o.screenPointToMercatorRay(h).dir),e=this._trackingEllipsoid.projectRay(o.screenPointToMercatorRay(h.sub(s)).dir);d[0]=e[0]-t[0],d[1]=e[1]-t[1]}else{const e=o.pointCoordinate(h);if("globe"===o.projection.name){s=s.rotate(-o.angle);const r=o._pixelsPerMercatorPixel/o.worldSize;d[0]=-s.x*t.d3(t.ay(e.y))*r,d[1]=-s.y*t.d3(o.center.lat)*r}else{const t=o.pointCoordinate(h.sub(s));e&&t&&(d[0]=t.x-e.x,d[1]=t.y-e.y)}}const f=o.zoom,m=[0,0,0];if(l){const e=a(A||o.pointCoordinate3D(h)),r={dir:t._.normalize([],t._.sub([],e,o._camera.position))};if(r.dir[2]<0){const i=o.zoomDeltaToMovement(e,l);t._.scale(m,r.dir,i)}}const g=t._.add(d,d,m);o._translateCameraConstrained(g),l&&Math.abs(o.zoom-f)>1e-4&&o.recenterOnTerrain(),o.cameraElevationReference="ground",this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(r,i,!0)}_fireEvents(e,r,i){const n=Ta(this._eventsInProgress),o=Ta(e),a={};for(const t in e){const{originalEvent:r}=e[t];this._eventsInProgress[t]||(a[`${t}start`]=r),this._eventsInProgress[t]=e[t]}!n&&o&&this._fireEvent("movestart",o.originalEvent);for(const t in a)this._fireEvent(t,a[t]);o&&this._fireEvent("move",o.originalEvent);for(const t in e){const{originalEvent:r}=e[t];this._fireEvent(t,r)}const s={};let l;for(const t in this._eventsInProgress){const{handlerName:e,originalEvent:i}=this._eventsInProgress[t];this._handlersById[e].isActive()||(delete this._eventsInProgress[t],l=r[e]||i,s[`${t}end`]=l)}for(const t in s)this._fireEvent(t,s[t]);const c=Ta(this._eventsInProgress);if(i&&(n||o)&&!c){this._updatingCamera=!0;const e=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),r=t=>0!==t&&-this._bearingSnap<t&&t<this._bearingSnap;e?(r(e.bearing||this._map.getBearing())&&(e.bearing=0),this._map.easeTo(e,{originalEvent:l})):(this._map.fire(new t.f("moveend",{originalEvent:l})),r(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(e,r){this._map.fire(new t.f(e,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{this._frameId=void 0,this.handleEvent(new Ia("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Pa="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class La extends t.E{constructor(e,r){super(),this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=r.bearingSnap,this._respectPrefersReducedMotion=!1!==r.respectPrefersReducedMotion,t.bp(["_renderFrameCallback"],this)}getCenter(){return new t.aI(this.transform.center.lng,this.transform.center.lat)}setCenter(t,e){return this.jumpTo({center:t},e)}panBy(e,r,i){return e=t.P.convert(e).mult(-1),this.panTo(this.transform.center,t.W({offset:e},r),i)}panTo(e,r,i){return this.easeTo(t.W({center:e},r),i)}getZoom(){return this.transform.zoom}setZoom(t,e){return this.jumpTo({zoom:t},e),this}zoomTo(e,r,i){return this.easeTo(t.W({zoom:e},r),i)}zoomIn(t,e){return this.zoomTo(this.getZoom()+1,t,e),this}zoomOut(t,e){return this.zoomTo(this.getZoom()-1,t,e),this}getBearing(){return this.transform.bearing}setBearing(t,e){return this.jumpTo({bearing:t},e),this}getPadding(){return this.transform.padding}setPadding(t,e){return this.jumpTo({padding:t},e),this}rotateTo(e,r,i){return this.easeTo(t.W({bearing:e},r),i)}resetNorth(e,r){return this.rotateTo(0,t.W({duration:1e3},e),r),this}resetNorthPitch(e,r){return this.easeTo(t.W({bearing:0,pitch:0,duration:1e3},e),r),this}snapToNorth(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this}getPitch(){return this.transform.pitch}setPitch(t,e){return this.jumpTo({pitch:t},e),this}cameraForBounds(e,r){e=t.ai.convert(e);const i=r&&r.bearing||0,n=r&&r.pitch||0,o=e.getNorthWest(),a=e.getSouthEast();return this._cameraForBounds(this.transform,o,a,i,n,r)}_extendPadding(e){const r={top:0,right:0,bottom:0,left:0};return null==e?t.W({},r,this.transform.padding):"number"==typeof e?{top:e,bottom:e,right:e,left:e}:t.W({},r,e)}_extendCameraOptions(e){return(e=t.W({offset:[0,0],maxZoom:this.transform.maxZoom},e)).padding=this._extendPadding(e.padding),e}_minimumAABBFrustumDistance(t,e){const r=e.max[0]-e.min[0],i=e.max[1]-e.min[1];return r/i>t.aspect?r/(2*Math.tan(.5*t.fovX)*t.aspect):i/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(e,r,i,n,o,a){const s=e.clone(),l=this._extendCameraOptions(a);s.bearing=n,s.pitch=o;const c=t.aI.convert(r),u=t.aI.convert(i),h=.5*(c.lat+u.lat),A=.5*(c.lng+u.lng),p=t.d4(h,A),d=t._.normalize([],p),f=t._.normalize([],t._.cross([],d,[0,1,0])),m=t._.cross([],f,d),g=[f[0],f[1],f[2],0,m[0],m[1],m[2],0,d[0],d[1],d[2],0,0,0,0,1],_=[p,t.d4(c.lat,c.lng),t.d4(u.lat,c.lng),t.d4(u.lat,u.lng),t.d4(c.lat,u.lng),t.d4(h,c.lng),t.d4(h,u.lng),t.d4(c.lat,A),t.d4(u.lat,A)];let y=t.b6.fromPoints(_.map((e=>[t._.dot(f,e),t._.dot(m,e),t._.dot(d,e)])));const v=t._.transformMat4([],y.center,g);0===t._.squaredLength(v)&&t._.set(v,0,0,1),t._.normalize(v,v),t._.scale(v,v,t.cD),s.center=t.d5(v);const x=s.getWorldToCameraMatrix(),w=t.ad.invert(new Float64Array(16),x);y=t.b6.applyTransform(y,t.ad.multiply([],x,g));const b=this._extendAABB(y,s,l,n);if(!b)return void t.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");y=b,t._.transformMat4(v,v,x);const B=.5*(y.max[2]-y.min[2]),C=this._minimumAABBFrustumDistance(s,y),E=t._.scale([],[0,0,1],B),T=t._.add(E,v,E),I=C+(0===s.pitch?0:t._.distance(v,T)),S=s.globeCenterInViewSpace,M=t._.sub([],v,[S[0],S[1],S[2]]);t._.normalize(M,M),t._.scale(M,M,I);const F=t._.add([],v,M);t._.transformMat4(F,F,w);const P=t.d7/t.cD,L=t._.length(F),D=t.ax(Math.max(L*P-t.d7,Number.EPSILON),0),U=Math.min(s.zoomFromMercatorZAdjusted(D),l.maxZoom);return U>.5*(t.b1+t.aU)?(s.setProjection({name:"mercator"}),s.zoom=U,this._cameraForBounds(s,r,i,n,o,a)):{center:s.center,zoom:U,bearing:n,pitch:o}}_extendAABB(e,r,i,n){const o=.5*((i.padding.left||0)+(i.padding.right||0)),a=.5*((i.padding.top||0)+(i.padding.bottom||0)),s=a,l=o,c=o,u=a,h=r.width-(l+c),A=r.height-(s+u),p=t._.sub([],e.max,e.min),d=Math.min(h/p[0],A/p[1]),f=Math.min(r.scaleZoom(r.scale*d),i.maxZoom);if(isNaN(f))return null;const m=r.scale/r.zoomScale(f),g=new t.b6([e.min[0]-l*m,e.min[1]-u*m,e.min[2]],[e.max[0]+c*m,e.max[1]+s*m,e.max[2]]),_=("number"==typeof i.offset.x&&"number"==typeof i.offset.y?new t.P(i.offset.x,i.offset.y):t.P.convert(i.offset)).rotate(-t.ab(n));return g.center[0]-=_.x*m,g.center[1]+=_.y*m,g}queryTerrainElevation(e,r){const i=this.transform.elevation;return i?(r=t.W({},{exaggerated:!0},r),i.getAtPoint(t.Y.fromLngLat(e),null,r.exaggerated)):null}_cameraForBounds(e,r,i,n,o,a){if("globe"===e.projection.name)return this._cameraForBoundsOnGlobe(e,r,i,n,o,a);const s=e.clone(),l=this._extendCameraOptions(a);s.bearing=n,s.pitch=o;const c=t.aI.convert(r),u=t.aI.convert(i),h=new t.aI(c.lng,u.lat),A=new t.aI(u.lng,c.lat),p=s.project(c),d=s.project(u),f=this.queryTerrainElevation(c),m=this.queryTerrainElevation(u),g=this.queryTerrainElevation(h),_=this.queryTerrainElevation(A),y=[[p.x,p.y,Math.min(f||0,m||0,g||0,_||0)],[d.x,d.y,Math.max(f||0,m||0,g||0,_||0)]];let v=t.b6.fromPoints(y);const x=s.getWorldToCameraMatrix(),w=t.ad.invert(new Float64Array(16),x);v=t.b6.applyTransform(v,x);const b=this._extendAABB(v,s,l,n);if(!b)return void t.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");v=b;const B=.5*t._.sub([],v.max,v.min)[2],C=this._minimumAABBFrustumDistance(s,v),E=[0,0,1,0];t.aA.transformMat4(E,E,x),t.aA.normalize(E,E);const T=t._.scale([],E,C+B),I=t._.add([],v.center,T);t._.transformMat4(v.center,v.center,w),t._.transformMat4(I,I,w);const S=[v.center[0],v.center[1],I[2]*s.pixelsPerMeter];t._.scale(S,S,1/s.worldSize);const M=t.d6(S[0]),F=t.ay(S[1]),P=Math.min(s._zoomFromMercatorZ(S[2]),l.maxZoom),L=new t.aI(M,F);return s.mercatorFromTransition&&P<.5*(t.b1+t.aU)?(s.setProjection({name:"globe"}),s.zoom=P,this._cameraForBounds(s,r,i,n,o,a)):{center:L,zoom:P,bearing:n,pitch:o}}fitBounds(t,e,r){const i=this.cameraForBounds(t,e);return this._fitInternal(i,e,r)}fitScreenCoordinates(e,r,i,n,o){const a=t.P.convert(e),s=t.P.convert(r),l=new t.P(Math.min(a.x,s.x),Math.min(a.y,s.y)),c=new t.P(Math.max(a.x,s.x),Math.max(a.y,s.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(a,s))return this;const u=this.transform.pointLocation3D(l),h=this.transform.pointLocation3D(c),A=this.transform.pointLocation3D(new t.P(l.x,c.y)),p=this.transform.pointLocation3D(new t.P(c.x,l.y)),d=[Math.min(u.lng,h.lng,A.lng,p.lng),Math.min(u.lat,h.lat,A.lat,p.lat)],f=[Math.max(u.lng,h.lng,A.lng,p.lng),Math.max(u.lat,h.lat,A.lat,p.lat)],m=n&&n.pitch?n.pitch:this.getPitch(),g=this._cameraForBounds(this.transform,d,f,i,m,n);return this._fitInternal(g,n,o)}_fitInternal(e,r,i){return e?(r=t.W(e,r)).linear?this.easeTo(r,i):this.flyTo(r,i):this}jumpTo(e,r){this.stop();const i=e.preloadOnly?this.transform.clone():this.transform;let n=!1,o=!1,a=!1;if("zoom"in e&&i.zoom!==+e.zoom&&(n=!0,i.zoom=+e.zoom),void 0!==e.center&&(i.center=t.aI.convert(e.center)),"bearing"in e&&i.bearing!==+e.bearing&&(o=!0,i.bearing=+e.bearing),"pitch"in e&&i.pitch!==+e.pitch&&(a=!0,i.pitch=+e.pitch),null!=e.padding){const t="number"==typeof e.padding?this._extendPadding(e.padding):e.padding;i.isPaddingEqual(t)||(i.padding=t)}return e.preloadOnly?(this._preloadTiles(i),this):(this.fire(new t.f("movestart",r)).fire(new t.f("move",r)),n&&this.fire(new t.f("zoomstart",r)).fire(new t.f("zoom",r)).fire(new t.f("zoomend",r)),o&&this.fire(new t.f("rotatestart",r)).fire(new t.f("rotate",r)).fire(new t.f("rotateend",r)),a&&this.fire(new t.f("pitchstart",r)).fire(new t.f("pitch",r)).fire(new t.f("pitchend",r)),this.fire(new t.f("moveend",r)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||t.w(Pa),this.transform.getFreeCameraOptions()}setFreeCameraOptions(e,r){const i=this.transform;if(!i.projection.supportsFreeCamera)return t.w(Pa),this;this.stop();const n=i.zoom,o=i.pitch,a=i.bearing;i.setFreeCameraOptions(e);const s=n!==i.zoom,l=o!==i.pitch,c=a!==i.bearing;return this.fire(new t.f("movestart",r)).fire(new t.f("move",r)),s&&this.fire(new t.f("zoomstart",r)).fire(new t.f("zoom",r)).fire(new t.f("zoomend",r)),c&&this.fire(new t.f("rotatestart",r)).fire(new t.f("rotate",r)).fire(new t.f("rotateend",r)),l&&this.fire(new t.f("pitchstart",r)).fire(new t.f("pitch",r)).fire(new t.f("pitchend",r)),this.fire(new t.f("moveend",r)),this}easeTo(e,r){this._stop(!1,e.easeId),(!1===(e=t.W({offset:[0,0],duration:500,easing:t.d2},e)).animate||this._prefersReducedMotion(e))&&(e.duration=0);const i=this.transform,n=this.getZoom(),o=this.getBearing(),a=this.getPitch(),s=this.getPadding(),l="zoom"in e?+e.zoom:n,c="bearing"in e?this._normalizeBearing(e.bearing,o):o,u="pitch"in e?+e.pitch:a,h=this._extendPadding(e.padding),A=t.P.convert(e.offset);let p,d,f;if("globe"===i.projection.name){const r=t.Y.fromLngLat(i.center),n=A.rotate(-i.angle);r.x+=n.x/i.worldSize,r.y+=n.y/i.worldSize;const o=r.toLngLat(),a=t.aI.convert(e.center||o);this._normalizeCenter(a),p=i.centerPoint.add(n),d=new t.P(r.x,r.y).mult(i.worldSize),f=new t.P(t.aj(a.lng),t.ak(a.lat)).mult(i.worldSize).sub(d)}else{p=i.centerPoint.add(A);const r=i.pointLocation(p),n=t.aI.convert(e.center||r);this._normalizeCenter(n),d=i.project(r),f=i.project(n).sub(d)}const m=i.zoomScale(l-n);let g,_;e.around&&(g=t.aI.convert(e.around),_=i.locationPoint(g));const y=this._zooming||l!==n,v=this._rotating||o!==c,x=this._pitching||u!==a,w=!i.isPaddingEqual(h),b=i=>b=>{if(y&&(i.zoom=t.a2(n,l,b)),v&&(i.bearing=t.a2(o,c,b)),x&&(i.pitch=t.a2(a,u,b)),w&&(i.interpolatePadding(s,h,b),p=i.centerPoint.add(A)),g)i.setLocationAtPoint(g,_);else{const t=i.zoomScale(i.zoom-n),e=l>n?Math.min(2,m):Math.max(.5,m),r=Math.pow(e,1-b),o=i.unproject(d.add(f.mult(b*r)).mult(t));i.setLocationAtPoint(i.renderWorldCopies?o.wrap():o,p)}return e.preloadOnly||this._fireMoveEvents(r),i};if(e.preloadOnly){const t=this._emulate(b,e.duration,i);return this._preloadTiles(t),this}const B={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=y,this._rotating=v,this._pitching=x,this._padding=w,this._easeId=e.easeId,this._prepareEase(r,e.noMoveStart,B),this._ease(b(i),(t=>{"sea"===i.cameraElevationReference&&i.recenterOnTerrain(),this._afterEase(r,t)}),e),this}_prepareEase(e,r,i={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),r||i.moving||this.fire(new t.f("movestart",e)),this._zooming&&!i.zooming&&this.fire(new t.f("zoomstart",e)),this._rotating&&!i.rotating&&this.fire(new t.f("rotatestart",e)),this._pitching&&!i.pitching&&this.fire(new t.f("pitchstart",e))}_fireMoveEvents(e){this.fire(new t.f("move",e)),this._zooming&&this.fire(new t.f("zoom",e)),this._rotating&&this.fire(new t.f("rotate",e)),this._pitching&&this.fire(new t.f("pitch",e))}_afterEase(e,r){if(this._easeId&&r&&this._easeId===r)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const i=this._zooming,n=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,i&&this.fire(new t.f("zoomend",e)),n&&this.fire(new t.f("rotateend",e)),o&&this.fire(new t.f("pitchend",e)),this.fire(new t.f("moveend",e))}flyTo(e,r){if(this._prefersReducedMotion(e)){const i=t.ah(e,["center","zoom","bearing","pitch","around","padding"]);return this.jumpTo(i,r)}this.stop(),e=t.W({offset:[0,0],speed:1.2,curve:1.42,easing:t.d2},e);const i=this.transform,n=this.getZoom(),o=this.getBearing(),a=this.getPitch(),s=this.getPadding(),l="zoom"in e?t.at(+e.zoom,i.minZoom,i.maxZoom):n,c="bearing"in e?this._normalizeBearing(e.bearing,o):o,u="pitch"in e?+e.pitch:a,h=this._extendPadding(e.padding),A=i.zoomScale(l-n),p=t.P.convert(e.offset);let d=i.centerPoint.add(p);const f=i.pointLocation(d),m=t.aI.convert(e.center||f);this._normalizeCenter(m);const g=i.project(f),_=i.project(m).sub(g);let y=e.curve;const v=Math.max(i.width,i.height),x=v/A,w=_.mag();if("minZoom"in e){const r=t.at(Math.min(e.minZoom,n,l),i.minZoom,i.maxZoom),o=v/i.zoomScale(r-n);y=Math.sqrt(o/w*2)}const b=y*y;function B(t){const e=(x*x-v*v+(t?-1:1)*b*b*w*w)/(2*(t?x:v)*b*w);return Math.log(Math.sqrt(e*e+1)-e)}function C(t){return(Math.exp(t)-Math.exp(-t))/2}function E(t){return(Math.exp(t)+Math.exp(-t))/2}const T=B(0);let I=function(t){return E(T)/E(T+y*t)},S=function(t){return v*((E(T)*(C(e=T+y*t)/E(e))-C(T))/b)/w;var e},M=(B(1)-T)/y;if(Math.abs(w)<1e-6||!isFinite(M)){if(Math.abs(v-x)<1e-6)return this.easeTo(e,r);const t=x<v?-1:1;M=Math.abs(Math.log(x/v))/y,S=function(){return 0},I=function(e){return Math.exp(t*y*e)}}e.duration="duration"in e?+e.duration:1e3*M/("screenSpeed"in e?+e.screenSpeed/y:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0);const F=o!==c,P=u!==a,L=!i.isPaddingEqual(h),D=i=>A=>{const f=A*M,y=1/I(f);i.zoom=1===A?l:n+i.scaleZoom(y),F&&(i.bearing=t.a2(o,c,A)),P&&(i.pitch=t.a2(a,u,A)),L&&(i.interpolatePadding(s,h,A),d=i.centerPoint.add(p));const v=1===A?m:i.unproject(g.add(_.mult(S(f))).mult(y));return i.setLocationAtPoint(i.renderWorldCopies?v.wrap():v,d),i._updateCameraOnTerrain(),e.preloadOnly||this._fireMoveEvents(r),i};if(e.preloadOnly){const t=this._emulate(D,e.duration,i);return this._preloadTiles(t),this}return this._zooming=!0,this._rotating=F,this._pitching=P,this._padding=L,this._prepareEase(r,!1),this._ease(D(i),(()=>this._afterEase(r)),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,e){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const t=this._onEaseEnd;this._onEaseEnd=void 0,t.call(this,e)}if(!t){const t=this.handlers;t&&t.stop(!1)}return this}_ease(e,r,i){!1===i.animate||0===i.duration?(e(1),r()):(this._easeStart=t.e.now(),this._easeOptions=i,this._onEaseFrame=e,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const e=Math.min((t.e.now()-this._easeStart)/this._easeOptions.duration,1),r=this._onEaseFrame;r&&r(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(e,r){e=t.au(e,-180,180);const i=Math.abs(e-r);return Math.abs(e-360-r)<i&&(e-=360),Math.abs(e+360-r)<i&&(e+=360),e}_normalizeCenter(t){const e=this.transform;if(e.maxBounds)return;if("globe"!==e.projection.name&&!e.renderWorldCopies)return;const r=t.lng-e.center.lng;t.lng+=r>180?-360:r<-180?360:0}_prefersReducedMotion(e){return this._respectPrefersReducedMotion&&t.e.prefersReducedMotion&&!(e&&e.essential)}_emulate(t,e,r){const i=Math.ceil(15*e/1e3),n=[],o=t(r.clone());for(let t=0;t<=i;t++){const e=o(t/i);n.push(e.clone())}return n}_preloadTiles(t,e){}}class Da{constructor(e={}){this.options=e,t.bp(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const e=this.options&&this.options.compact;return this._map=t,this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=o("button","mapboxgl-ctrl-attrib-button",this._container),o("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=o("div","mapboxgl-ctrl-attrib-inner",this._container),e&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,e){const r=this._map._getUIString(`AttributionControl.${e}`);t.removeAttribute("title"),t.firstElementChild&&t.firstElementChild.setAttribute("title",r)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));const r=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||t.d8.ACCESS_TOKEN}];if(e){const i=r.reduce(((t,e,i)=>(e.value&&(t+=`${e.key}=${e.value}${i<r.length-1?"&":""}`),t)),"?");e.href=`${t.d8.FEEDBACK_URL}/${i}#${ko(this._map,!0)}`,e.rel="noopener nofollow",this._setElementTitle(e,"MapFeedback")}}_updateData(t){!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const t=this._map.style.stylesheet;this.styleOwner=t.owner,this.styleId=t.id}const e=this._map.style._mergedSourceCaches;for(const r in e){const i=e[r];if(i.used){const e=i.getSource();e.attribution&&t.indexOf(e.attribution)<0&&t.push(e.attribution)}}t.sort(((t,e)=>t.length-e.length)),t=t.filter(((e,r)=>{for(let i=r+1;i<t.length;i++)if(t[i].indexOf(e)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const r=t.join(" | ");r!==this._attribHTML&&(this._attribHTML=r,t.length?(this._innerContainer.innerHTML=r,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Ua{constructor(){t.bp(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=o("div","mapboxgl-ctrl");const e=o("a","mapboxgl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://www.mapbox.com/",e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(0===Object.entries(t).length)return!0;for(const e in t){const r=t[e].getSource();if(r.hasOwnProperty("mapbox_logo")&&!r.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const e=t[0];this._map.getCanvasContainer().offsetWidth<250?e.classList.add("mapboxgl-compact"):e.classList.remove("mapboxgl-compact")}}}class ka{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e}remove(t){const e=this._currentlyRunning,r=e?this._queue.concat(e):this._queue;for(const e of r)if(e.id===t)return void(e.cancelled=!0)}run(t=0){const e=this._currentlyRunning=this._queue;this._queue=[];for(const r of e)if(!r.cancelled&&(r.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function za(e,r,i){if(e=new t.aI(e.lng,e.lat),r){const n=new t.aI(e.lng-360,e.lat),o=new t.aI(e.lng+360,e.lat),a=360*Math.ceil(Math.abs(e.lng-i.center.lng)/360),s=i.locationPoint(e).distSqr(r),l=r.x<0||r.y<0||r.x>i.width||r.y>i.height;i.locationPoint(n).distSqr(r)<s&&(l||Math.abs(n.lng-i.center.lng)<a)?e=n:i.locationPoint(o).distSqr(r)<s&&(l||Math.abs(o.lng-i.center.lng)<a)&&(e=o)}for(;Math.abs(e.lng-i.center.lng)>180;){const t=i.locationPoint(e);if(t.x>=0&&t.y>=0&&t.x<=i.width&&t.y<=i.height)break;e.lng>i.center.lng?e.lng-=360:e.lng+=360}return e}const Ra={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Oa extends t.E{constructor(e,r){if(super(),(e instanceof HTMLElement||r)&&(e=t.W({element:e},r)),t.bp(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=e&&e.occludedOpacity||.2,e&&e.element)this._element=e.element,this._offset=t.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=o("div");const r=41,i=27,n=a("svg",{display:"block",height:r*this._scale+"px",width:i*this._scale+"px",viewBox:`0 0 ${i} ${r}`},this._element),s=a("radialGradient",{id:"shadowGradient"},a("defs",{},n));a("stop",{offset:"10%","stop-opacity":.4},s),a("stop",{offset:"100%","stop-opacity":.05},s),a("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},n),a("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},n),a("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},n),a("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},n),this._offset=t.P.convert(e&&e.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(t=>{t.preventDefault()})),this._element.addEventListener("mousedown",(t=>{t.preventDefault()}));const i=this._element.classList;for(const t in Ra)i.remove(`mapboxgl-marker-anchor-${t}`);i.add(`mapboxgl-marker-anchor-${this._anchor}`);const n=e&&e.className?e.className.trim().split(/\s+/):[];i.add(...n),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=t.aI.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const e=38.1,r=13.5,i=Math.sqrt(Math.pow(r,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-e],"bottom-left":[i,-1*(e-r+i)],"bottom-right":[-i,-1*(e-r+i)],left:[r,-1*(e-r)],right:[-r,-1*(e-r)]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const e=t.code,r=t.charCode||t.keyCode;"Space"!==e&&"Enter"!==e&&32!==r&&13!==r||this.togglePopup()}_onMapClick(t){const e=t.originalEvent.target,r=this._element;this._popup&&(e===r||r.contains(e))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,e=this._pos;if(!t||!e)return!1;const r=t.unproject(e),i=t.getFreeCameraOptions();if(!i.position)return!1;const n=i.position.toLngLat();return n.distanceTo(r)<.9*n.distanceTo(this._lngLat)}_evaluateOpacity(){const e=this._map;if(!e)return;const r=this._pos;if(!r||r.x<0||r.x>e.transform.width||r.y<0||r.y>e.transform.height)return void this._clearFadeTimer();const i=e.unproject(r);let n;e._showingGlobe()&&t.d9(e.transform,this._lngLat)?n=0:(n=1-e._queryFogOpacity(i),e.transform._terrainEnabled()&&e.getTerrain()&&this._behindTerrain()&&(n*=this._occludedOpacity)),this._element.style.opacity=`${n}`,this._element.style.pointerEvents=n>0?"auto":"none",this._popup&&this._popup._setOpacity(n),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const e=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${t.x}px,${t.y}px)\n            ${Ra[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${e.x}px,${e.y}px)\n        `}_calculateXYTransform(){const e=this._pos,r=this._map,i=this.getPitchAlignment();if(!r||!e||"map"!==i)return"";if(!r._showingGlobe()){const t=r.getPitch();return t?`rotateX(${t}deg)`:""}const n=t.b0(t.da(r.transform,this._lngLat)),o=e.sub(t.db(r.transform)),a=Math.abs(o.x)+Math.abs(o.y);if(0===a)return"";const s=n/a;return`rotateX(${-o.y*s}deg) rotateY(${o.x*s}deg)`}_calculateZTransform(){const e=this._pos,r=this._map;if(!r||!e)return"";let i=0;const n=this.getRotationAlignment();if("map"===n)if(r._showingGlobe()){const e=r.project(new t.aI(this._lngLat.lng,this._lngLat.lat+.001)),n=r.project(new t.aI(this._lngLat.lng,this._lngLat.lat-.001)).sub(e);i=t.b0(Math.atan2(n.y,n.x))-90}else i=-r.getBearing();else if("horizon"===n){const n=t.$(4,6,r.getZoom()),o=t.db(r.transform);o.y+=n*r.transform.height;const a=e.sub(o),s=t.b0(Math.atan2(a.y,a.x));i=(s>90?s-270:s+90)*(1-n)}return i+=this._rotation,i?`rotateZ(${i}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const e=this._map;e&&(e.transform.renderWorldCopies&&(this._lngLat=za(this._lngLat,this._pos,e.transform)),this._pos=e.project(this._lngLat),!0===t?this._updateFrameId=requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),e._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(e._showingGlobe()||e.getTerrain()||e.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(e){return this._offset=t.P.convert(e),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(e){const r=this._map;if(!r)return;const i=this._pointerdownPos,n=this._positionDelta;if(i&&n){if(!this._isDragging){const t=this._clickTolerance||r._clickTolerance;if(e.point.dist(i)<t)return;this._isDragging=!0}this._pos=e.point.sub(n),this._lngLat=r.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.f("dragstart"))),this.fire(new t.f("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const e=this._map;e&&(e.off("mousemove",this._onMove),e.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new t.f("dragend")),this._state="inactive"}_addDragHandler(t){const e=this._map,r=this._pos;e&&r&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(r),this._pointerdownPos=t.point,this._state="pending",e.on("mousemove",this._onMove),e.on("touchmove",this._onMove),e.once("mouseup",this._onUp),e.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const e=this._map;return e&&(t?(e.on("mousedown",this._addDragHandler),e.on("touchstart",this._addDragHandler)):(e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Qa={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Na=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Va(e=new t.P(0,0),r="bottom"){if("number"==typeof e){const i=Math.round(Math.sqrt(.5*Math.pow(e,2)));switch(r){case"top":return new t.P(0,e);case"top-left":return new t.P(i,i);case"top-right":return new t.P(-i,i);case"bottom":return new t.P(0,-e);case"bottom-left":return new t.P(i,-i);case"bottom-right":return new t.P(-i,-i);case"left":return new t.P(e,0);case"right":return new t.P(-e,0)}return new t.P(0,0)}return e instanceof t.P||Array.isArray(e)?t.P.convert(e):t.P.convert(e[r]||[0,0])}class Ha{constructor(t){this.jumpTo(t)}getValue(e){if(e<=this._startTime)return this._start;if(e>=this._endTime)return this._end;const r=t.b9((e-this._startTime)/(this._endTime-this._startTime));return this._start*(1-r)+this._end*r}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,e,r){this._start=this.getValue(e),this._end=t,this._startTime=e,this._endTime=e+r}}const ja={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Ga{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}const Ka={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},qa={showCompass:!0,showZoom:!0,visualizePitch:!1};class Za{constructor(e,r,i=!1){this._clickTolerance=10,this.element=r,this.mouseRotate=new na({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,i&&(this.mousePitch=new oa({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),t.bp(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),r.addEventListener("mousedown",this.mousedown),r.addEventListener("touchstart",this.touchstart,{passive:!1}),r.addEventListener("touchmove",this.touchmove),r.addEventListener("touchend",this.touchend),r.addEventListener("touchcancel",this.reset)}down(t,e){this.mouseRotate.mousedown(t,e),this.mousePitch&&this.mousePitch.mousedown(t,e),u()}move(t,e){const r=this.map,i=this.mouseRotate.mousemoveWindow(t,e),n=i&&i.bearingDelta;if(n&&r.setBearing(r.getBearing()+n),this.mousePitch){const i=this.mousePitch.mousemoveWindow(t,e),n=i&&i.pitchDelta;n&&r.setPitch(r.getPitch()+n)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){h(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(e){this.down(t.W({},e,{ctrlKey:!0,preventDefault:()=>e.preventDefault()}),d(this.element,e)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,d(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=f(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){1!==t.targetTouches.length?this.reset():(this._lastPos=f(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Wa={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Xa={maxWidth:100,unit:"metric"},$a={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Ya={version:t.dt,supported:r,setRTLTextPlugin:t.dv,getRTLTextPluginStatus:t.dw,Map:class extends La{constructor(e){t.dc.mark(t.dd.create);const r=e;if(null!=(e=t.W({},Ka,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(e.antialias&&t.de(window)&&(e.antialias=!1,t.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new pr(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),e),this._repaint=!!e.repaint,this._interactive=e.interactive,this._minTileCacheSize=e.minTileCacheSize,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=e.crossSourceCollisions,this._collectResourceTiming=e.collectResourceTiming,this._language=this._parseLanguage(e.language),this._worldview=e.worldview,this._renderTaskQueue=new ka,this._domRenderTaskQueue=new ka,this._controls=[],this._markers=[],this._popups=[],this._mapId=t.df(),this._locale=t.W({},ja,e.locale),this._clickTolerance=e.clickTolerance,this._cooperativeGestures=e.cooperativeGestures,this._performanceMetricsCollection=e.performanceMetricsCollection,this._tessellationStep=e.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Ha(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._lastDirtyFrameId=0,this._requestManager=new t.dg(e.transformRequest,e.accessToken,e.testMode),this._silenceAuthErrors=!!e.testMode,this._contextCreateOptions=e.contextCreateOptions?{...e.contextCreateOptions}:{},"string"==typeof e.container){const t=document.getElementById(e.container);if(!t)throw new Error(`Container '${e.container.toString()}' not found.`);this._container=t}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(this._container.childNodes.length>0&&t.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),e.maxBounds&&this.setMaxBounds(e.maxBounds),t.bp(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Ga),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},(()=>{this._update()})),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Fa(this,e),this._localFontFamily=e.localFontFamily,this._localIdeographFontFamily=e.localIdeographFontFamily,(e.style||!e.testMode)&&this.setStyle(e.style||t.d8.DEFAULT_STYLE,{config:e.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),e.projection&&this.setProjection(e.projection),e.hash&&(this._hash=new Uo("string"==typeof e.hash&&e.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){null==r.center&&null==r.zoom||(this.transform._unmodified=!1),this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch});const i=e.bounds;i&&(this.resize(),this.fitBounds(i,t.W({},e.fitBoundsOptions,{duration:0})))}this.resize(),e.attributionControl&&this.addControl(new Da({customAttribution:e.customAttribution})),this._logoControl=new Ua,this.addControl(this._logoControl,e.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()})),this.on("data",(e=>{this._update("style"===e.dataType),this.fire(new t.f(`${e.dataType}data`,e))})),this.on("dataloading",(e=>{this.fire(new t.f(`${e.dataType}dataloading`,e))}))}_getMapId(){return this._mapId}addControl(e,r){if(void 0===r&&(r=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new t.d(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const i=e.onAdd(this);this._controls.push(e);const n=this._controlPositions[r];return-1!==r.indexOf("bottom")?n.insertBefore(i,n.firstChild):n.appendChild(i),this}removeControl(e){if(!e||!e.onRemove)return this.fire(new t.d(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(e);return r>-1&&this._controls.splice(r,1),e.onRemove(this),this}hasControl(t){return this._controls.indexOf(t)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(e){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new t.f("movestart",e)).fire(new t.f("move",e)),this.fire(new t.f("resize",e)),r&&this.fire(new t.f("moveend",e)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(e){return this.transform.setMaxBounds(t.ai.convert(e)),this._update()}setMinZoom(e){if((e=e??-2)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e?this.setZoom(e):this.fire(new t.f("zoomstart")).fire(new t.f("zoom")).fire(new t.f("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e=e??22)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e?this.setZoom(e):this.fire(new t.f("zoomstart")).fire(new t.f("zoom")).fire(new t.f("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(e){if((e=e??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this._update(),this.getPitch()<e?this.setPitch(e):this.fire(new t.f("pitchstart")).fire(new t.f("pitch")).fire(new t.f("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(e){if((e=e??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this._update(),this.getPitch()>e?this.setPitch(e):this.fire(new t.f("pitchstart")).fire(new t.f("pitch")).fire(new t.f("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(t){return this.transform.renderWorldCopies=t,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(t){return"auto"===t?navigator.language:Array.isArray(t)?0===t.length?void 0:t.map((t=>"auto"===t?navigator.language:t)):t}setLanguage(t){const e=this._parseLanguage(t);if(!this.style||e===this._language)return this;this._language=e,this.style.reloadSources();for(const t of this._controls)t._setLanguage&&t._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(t){return this.style&&t!==this._worldview?(this._worldview=t,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(t){return this._lazyInitEmptyStyle(),t?"string"==typeof t&&(t={name:t}):t=null,this._useExplicitProjection=!!t,this._prioritizeAndUpdateProjection(t,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const e=this.transform,r=e.projection.name;let i;"globe"===r&&e.zoom>=t.aU?(e.setMercatorFromTransition(),i=!0):"mercator"===r&&e.zoom<t.aU&&(e.setProjection({name:"globe"}),i=!0),i&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(t,e){return this._updateProjection(t||e||{name:"mercator"})}_updateProjection(e){let r;return r="globe"===e.name&&this.transform.zoom>=t.aU?this.transform.setMercatorFromTransition():this.transform.setProjection(e),this.style.applyProjectionUpdate(),r&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(e){return this.transform.locationPoint3D(t.aI.convert(e))}unproject(e){return this.transform.pointLocation3D(t.P.convert(e))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(t,e,r){if("mouseenter"===t||"mouseover"===t){let i=!1;const n=n=>{const o=e.filter((t=>this.getLayer(t))),a=o.length?this.queryRenderedFeatures(n.point,{layers:o}):[];a.length?i||(i=!0,r.call(this,new Go(t,this,n.originalEvent,{features:a}))):i=!1},o=()=>{i=!1};return{layers:new Set(e),listener:r,delegates:{mousemove:n,mouseout:o}}}if("mouseleave"===t||"mouseout"===t){let i=!1;const n=n=>{const o=e.filter((t=>this.getLayer(t)));(o.length?this.queryRenderedFeatures(n.point,{layers:o}):[]).length?i=!0:i&&(i=!1,r.call(this,new Go(t,this,n.originalEvent)))},o=e=>{i&&(i=!1,r.call(this,new Go(t,this,e.originalEvent)))};return{layers:new Set(e),listener:r,delegates:{mousemove:n,mouseout:o}}}{const i=t=>{const i=e.filter((t=>this.getLayer(t))),n=i.length?this.queryRenderedFeatures(t.point,{layers:i}):[];n.length&&(t.features=n,r.call(this,t),delete t.features)};return{layers:new Set(e),listener:r,delegates:{[t]:i}}}}on(t,e,r){if("function"==typeof e||void 0===r)return super.on(t,e);if(Array.isArray(e)||(e=[e]),e)for(const t of e)if(!this._isValidId(t))return this;const i=this._createDelegatedListener(t,e,r);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(i);for(const t in i.delegates)this.on(t,i.delegates[t]);return this}once(t,e,r){if("function"==typeof e||void 0===r)return super.once(t,e);if(Array.isArray(e)||(e=[e]),e)for(const t of e)if(!this._isValidId(t))return this;const i=this._createDelegatedListener(t,e,r);for(const t in i.delegates)this.once(t,i.delegates[t]);return this}off(t,e,r){if("function"==typeof e||void 0===r)return super.off(t,e);const i=new Set(Array.isArray(e)?e:[e]);for(const t of i)if(!this._isValidId(t))return this;const n=(t,e)=>{if(t.size!==e.size)return!1;for(const r of t)if(!e.has(r))return!1;return!0},o=this._delegatedListeners?this._delegatedListeners[t]:void 0;return o&&(t=>{for(let e=0;e<t.length;e++){const o=t[e];if(o.listener===r&&n(o.layers,i)){for(const t in o.delegates)this.off(t,o.delegates[t]);return t.splice(e,1),this}}})(o),this}queryRenderedFeatures(e,r){if(!this.style)return[];if(void 0!==r||void 0===e||e instanceof t.P||Array.isArray(e)||(r=e,e=void 0),e=e||[[0,0],[this.transform.width,this.transform.height]],(r=r||{}).layers&&Array.isArray(r.layers))for(const t of r.layers)if(!this._isValidId(t))return[];return this.style.queryRenderedFeatures(e,r,this.transform)}querySourceFeatures(t,e){return this._isValidId(t)?this.style.querySourceFeatures(t,e):[]}isPointOnSurface(e){const{name:r}=this.transform.projection;return"globe"!==r&&"mercator"!==r&&t.w(`${r} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(t.P.convert(e))}setStyle(e,r){return r=t.W({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r),this.style&&e&&!1!==r.diff&&r.localFontFamily===this._localFontFamily&&r.localIdeographFontFamily===this._localIdeographFontFamily&&!r.config?(this.style._diffStyle(e,((i,n)=>{i?(t.w(`Unable to perform style diff: ${String(i.message||i.error||i)}. Rebuilding the style from scratch.`),this._updateStyle(e,r)):n&&this._update(!0)}),(()=>{this._postStyleLoadEvent()})),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(e,r))}_getUIString(t){const e=this._locale[t];if(null==e)throw new Error(`Missing UI string '${t}'`);return e}_updateStyle(e,r){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),e){const i=t.W({},r);r&&r.config&&(i.initialConfig=r.config,delete i.config),this.style=new Lo(this,i).load(e),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Lo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(t.w("There is no style added to the map."),!1)}_isValidId(e){return null==e?(this.fire(new t.d(new Error("IDs can't be empty."))),!1):!t.cV(e)||(this.fire(new t.d(new Error(`IDs can't contain special symbols: "${e}".`))),!1)}addSource(t,e){return this._isValidId(t)?(this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)):this}isSourceLoaded(t){return!!this._isValidId(t)&&!!this.style&&this.style._isSourceCacheLoaded(t)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(t,e,r){this._lazyInitEmptyStyle(),this.style.addSourceType(t,e,r)}removeSource(t){return this._isValidId(t)?(this.style.removeSource(t),this._updateTerrain(),this._update(!0)):this}getSource(t){return this._isValidId(t)?this.style.getOwnSource(t):null}addImage(e,r,{pixelRatio:i=1,sdf:n=!1,stretchX:o,stretchY:a,content:s}={}){if(this._lazyInitEmptyStyle(),r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap){const{width:l,height:c,data:u}=t.e.getImageData(r);this.style.addImage(e,{data:new t.i({width:l,height:c},u),pixelRatio:i,stretchX:o,stretchY:a,content:s,sdf:n,version:0})}else if(void 0===r.width||void 0===r.height)this.fire(new t.d(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:l,height:c}=r,u=r;this.style.addImage(e,{data:new t.i({width:l,height:c},new Uint8Array(u.data)),pixelRatio:i,stretchX:o,stretchY:a,content:s,sdf:n,version:0,userImage:u}),u.onAdd&&u.onAdd(this,e)}}updateImage(e,r){this._lazyInitEmptyStyle();const i=this.style.getImage(e);if(!i)return void this.fire(new t.d(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const n=r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap?t.e.getImageData(r):r,{width:o,height:a,data:s}=n;if(void 0===o||void 0===a)return void this.fire(new t.d(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(o!==i.data.width||a!==i.data.height)return void this.fire(new t.d(new Error(`The width and height of the updated image (${o}, ${a})\n                must be that same as the previous version of the image\n                (${i.data.width}, ${i.data.height})`)));const l=!(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap);i.data.replace(s,l),this.style.updateImage(e,i)}hasImage(e){return e?!!this.style&&!!this.style.getImage(e):(this.fire(new t.d(new Error("Missing required image id"))),!1)}removeImage(t){this.style.removeImage(t)}loadImage(e,r){t.h(this._requestManager.transformRequest(e,t.R.Image),((e,i)=>{r(e,i instanceof HTMLImageElement?t.e.getImageData(i):i)}))}listImages(){return this.style.listImages()}addModel(t,e){this._lazyInitEmptyStyle(),this.style.addModel(t,e)}hasModel(e){return e?this.style.hasModel(e):(this.fire(new t.d(new Error("Missing required model id"))),!1)}removeModel(t){this.style.removeModel(t)}listModels(){return this.style.listModels()}addLayer(t,e){return this._isValidId(t.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)):this}getSlot(t){const e=this.getLayer(t);return e&&e.slot||null}setSlot(t,e){return this.style.setSlot(t,e),this.style.mergeLayers(),this._update(!0)}addImport(t,e){return this.style.addImport(t,e),this}updateImport(t,e){return"string"!=typeof e&&e.id!==t?(this.removeImport(t),this.addImport(e)):(this.style.updateImport(t,e),this._update(!0))}removeImport(t){return this.style.removeImport(t),this}moveImport(t,e){return this.style.moveImport(t,e),this._update(!0)}moveLayer(t,e){return this._isValidId(t)?(this.style.moveLayer(t,e),this._update(!0)):this}removeLayer(t){return this._isValidId(t)?(this.style.removeLayer(t),this._update(!0)):this}getLayer(t){if(!this._isValidId(t))return null;const e=this.style.getOwnLayer(t);return e?e.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(t,e,r){return this._isValidId(t)?(this.style.setLayerZoomRange(t,e,r),this._update(!0)):this}setFilter(t,e,r={}){return this._isValidId(t)?(this.style.setFilter(t,e,r),this._update(!0)):this}getFilter(t){return this._isValidId(t)?this.style.getFilter(t):null}setPaintProperty(t,e,r,i={}){return this._isValidId(t)?(this.style.setPaintProperty(t,e,r,i),this._update(!0)):this}getPaintProperty(t,e){return this._isValidId(t)?this.style.getPaintProperty(t,e):null}setLayoutProperty(t,e,r,i={}){return this._isValidId(t)?(this.style.setLayoutProperty(t,e,r,i),this._update(!0)):this}getLayoutProperty(t,e){return this._isValidId(t)?this.style.getLayoutProperty(t,e):null}getSchema(t){return this.style.getSchema(t)}setSchema(t,e){return this.style.setSchema(t,e),this._update(!0)}getConfig(t){return this.style.getConfig(t)}setConfig(t,e){return this.style.setConfig(t,e),this._update(!0)}getConfigProperty(t,e){return this.style.getConfigProperty(t,e)}setConfigProperty(t,e,r){return this.style.setConfigProperty(t,e,r),this._update(!0)}setLights(t){if(this._lazyInitEmptyStyle(),t&&1===t.length&&"flat"===t[0].type){const e=t[0];e.properties?this.style.setFlatLight(e.properties,e.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(t),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const t=this.style.getLights()||[];return 0===t.length&&t.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),t}setLight(t,e={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:t}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(t){return this._lazyInitEmptyStyle(),!t&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(t),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(t){return this._lazyInitEmptyStyle(),this.style.setFog(t),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(t){return this._lazyInitEmptyStyle(),this.style.setColorTheme(t),this._update(!0)}setCamera(t){return this.style.setCamera(t),this._triggerCameraUpdate(t)}_triggerCameraUpdate(t){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===t["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(e){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(t.aI.convert(e),this.transform):0}setFeatureState(t,e){return this._isValidId(t.source)?(this.style.setFeatureState(t,e),this._update()):this}removeFeatureState(t,e){return this._isValidId(t.source)?(this.style.removeFeatureState(t,e),this._update()):this}getFeatureState(t){return this._isValidId(t.source)?this.style.getFeatureState(t):null}_updateContainerDimensions(){if(!this._container)return;const t=this._container.getBoundingClientRect().width||400,e=this._container.getBoundingClientRect().height||300;let r,i,n,o=this._container;for(;o&&(!i||!n);){const t=window.getComputedStyle(o).transform;t&&"none"!==t&&(r=t.match(/matrix.*\((.+)\)/)[1].split(", "),r[0]&&"0"!==r[0]&&"1"!==r[0]&&(i=r[0]),r[3]&&"0"!==r[3]&&"1"!==r[3]&&(n=r[3])),o=o.parentElement}this._containerWidth=i?Math.abs(t/i):t,this._containerHeight=n?Math.abs(e/n):e}_detectMissingCSS(){"rgb(250, 128, 114)"!==window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&t.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=o("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();const e=this._canvasContainer=o("div","mapboxgl-canvas-container",t);this._canvas=o("canvas","mapboxgl-canvas",e),this._interactive&&(e.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const r=this._controlContainer=o("div","mapboxgl-control-container",t),i=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((t=>{i[t]=o("div",`mapboxgl-ctrl-${t}`,r)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(e,r){const i=t.e.devicePixelRatio||1;this._canvas.width=i*Math.ceil(e),this._canvas.height=i*Math.ceil(r),this._canvas.style.width=`${e}px`,this._canvas.style.height=`${r}px`}_addMarker(t){this._markers.push(t)}_removeMarker(t){const e=this._markers.indexOf(t);-1!==e&&this._markers.splice(e,1)}_addPopup(t){this._popups.push(t)}_removePopup(t){const e=this._popups.indexOf(t);-1!==e&&this._popups.splice(e,1)}_setupPainter(){const e=t.W({},r.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl2",e);i?(t.dh(i,!0),this.painter=new Mn(i,this._contextCreateOptions,this.transform,this._tp),this.on("data",(t=>{"source"===t.dataType&&this.painter.setTileLoadedFlag(!0)})),t.di.testSupport(i)):this.fire(new t.d(new Error("Failed to initialize WebGL")))}_contextLost(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.f("webglcontextlost",{originalEvent:e}))}_contextRestored(e){this._setupPainter(),this.resize(),this._update(),this.fire(new t.f("webglcontextrestored",{originalEvent:e}))}_onMapScroll(t){if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty&&!this._occlusionOpacityChanged&&this._occlusionCriteriaSatisfied()}_update(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(t){return this._update(),this._renderTaskQueue.add(t)}_cancelRenderFrame(t){this._renderTaskQueue.remove(t)}_requestDomTask(t){!this.loaded()||this.loaded()&&!this.isMoving()?t():this._domRenderTaskQueue.add(t)}_render(e){let r;this.fire(new t.f("renderstart")),++this._frameId;const i=this.painter.context.extTimerQuery,n=t.e.now(),o=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(r=o.createQuery(),o.beginQuery(i.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(e),this._domRenderTaskQueue.run(e),this._removed)return;this._updateProjectionTransition();const a=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const e=this.transform.zoom,r=this.transform.pitch,i=t.e.now(),n=new t.X(e,{now:i,fadeDuration:a,pitch:r,transition:this.style.transition});this.style.update(n)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let s=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),s=this._updateAverageElevation(n),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):s=this._updateAverageElevation(n);const l=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,a,this._crossSourceCollisions,this.painter.replacementSource);if(l&&(this._placementDirty=l.needsRerender,this._occlusionOpacityChanged=l.occlusionQueryBasedOpacityChanged),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:a,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new t.f("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,t.dc.mark(t.dd.load),this.fire(new t.f("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const e=t.e.now()-n;o.endQuery(i.TIME_ELAPSED_EXT),setTimeout((()=>{const i=o.getQueryParameter(r,o.QUERY_RESULT)/1e6;o.deleteQuery(r),this.fire(new t.f("gpu-timing-frame",{cpuTime:e,gpuTime:i}))}),50)}if(this.listens("gpu-timing-layer")){const e=this.painter.collectGpuTimers();setTimeout((()=>{const r=this.painter.queryGpuTimers(e);this.fire(new t.f("gpu-timing-layer",{layerTimes:r}))}),50)}if(this.listens("gpu-timing-deferred-render")){const e=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const r=this.painter.queryGpuTimeDeferredRender(e);this.fire(new t.f("gpu-timing-deferred-render",{gpuTime:r}))}),50)}const c=this._sourcesDirty||this._styleDirty||this._placementDirty||this._occlusionOpacityChanged||s;if((this._sourcesDirty||this._styleDirty||s||this._occlusionOpacityChanged)&&(this._lastDirtyFrameId=this._frameId),c||this._repaint||!this._occlusionCriteriaSatisfied())this.triggerRepaint();else{const e=!this.isMoving()&&this.loaded();if(e&&(s=this._updateAverageElevation(n,!0)),s)this.triggerRepaint();else if(this._triggerFrame(!1),e&&(this.fire(new t.f("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const e=this._calculateSpeedIndex();this.fire(new t.f("speedindexcompleted",{speedIndex:e})),this.speedIndexTiming=!1}}this._loaded&&!this._fullyLoaded&&!c&&this._occlusionCriteriaSatisfied()&&(this._fullyLoaded=!0,t.dc.mark(t.dd.fullLoad),this._performanceMetricsCollection&&t.dj(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(t){for(const e of this._markers)t&&!this.getRenderWorldCopies()&&(e._lngLat=e._lngLat.wrap()),e._update();for(const e of this._popups)!t||this.getRenderWorldCopies()||e._trackPointer||(e._lngLat=e._lngLat.wrap()),e._update()}_updateAverageElevation(t,e=!1){const r=t=>(this.transform.averageElevation=t,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&r(0);const i=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(i||(e||t-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(t)){const e=this.transform.averageElevation;let n=this.transform.sampleAverageElevation();null!=this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(n)?n=0:this._averageElevationLastSampledAt=t;const o=Math.abs(e-n);if(o>1){if(this._isInitialLoad||i)return this._averageElevation.jumpTo(n),r(n);this._averageElevation.easeTo(n,t,300)}else if(o>1e-4)return this._averageElevation.jumpTo(n),r(n)}return!!this._averageElevation.isEasing(t)&&r(this._averageElevation.getValue(t))}_authenticate(){t.dk(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(e=>{if(e&&(e.message===t.dl||401===e.status)){const e=this.painter.context.gl;t.dh(e,!1),this._logoControl instanceof Ua&&this._logoControl._updateLogo(),e&&e.clear(e.DEPTH_BUFFER_BIT|e.COLOR_BUFFER_BIT|e.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new t.d(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),t.dm(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_postStyleLoadEvent(){this.style.globalId&&t.dn(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const t=this._isDragging();this.painter.updateTerrain(this.style,t)}_calculateSpeedIndex(){const t=this.painter.canvasCopy(),e=this.painter.getCanvasCopiesAndTimestamps();e.timeStamps.push(performance.now());const r=this.painter.context.gl,i=r.createFramebuffer();function n(t){r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0);const e=new Uint8Array(r.drawingBufferWidth*r.drawingBufferHeight*4);return r.readPixels(0,0,r.drawingBufferWidth,r.drawingBufferHeight,r.RGBA,r.UNSIGNED_BYTE,e),e}return r.bindFramebuffer(r.FRAMEBUFFER,i),this._canvasPixelComparison(n(t),e.canvasCopies.map(n),e.timeStamps)}_canvasPixelComparison(t,e,r){let i=r[1]-r[0];const n=t.length/4;for(let o=0;o<e.length;o++){const a=e[o];let s=0;for(let e=0;e<a.length;e+=4)a[e]===t[e]&&a[e+1]===t[e+1]&&a[e+2]===t[e+2]&&a[e+3]===t[e+3]&&(s+=1);i+=(r[o+2]-r[o+1])*(1-s/n)}return i}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),t.dp(this.painter.context.gl),t.dq.remove(),t.dr.remove(),this._removed=!0,this.fire(new t.f("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(e){this._renderNextFrame=this._renderNextFrame||e,this.style&&!this._frame&&(this._frame=t.e.frame((t=>{const e=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,e&&this._render(t)})))}_preloadTiles(e){const r=this.style?this.style.getSourceCaches():[];return t.ds(r,((t,r)=>t._preloadTiles(e,r)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(t){this._trackResize&&this.resize({originalEvent:t})._update()}_onVisibilityChange(){"hidden"===document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(t){this._showParseStatus!==t&&(this._showParseStatus=t,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(t){this._showTerrainWireframe!==t&&(this._showTerrainWireframe=t,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(t){this._showLayers2DWireframe!==t&&(this._showLayers2DWireframe=t,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(t){this._showLayers3DWireframe!==t&&(this._showLayers3DWireframe=t,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(t){this._speedIndexTiming!==t&&(this._speedIndexTiming=t,this._update())}get showPadding(){return!!this._showPadding}set showPadding(t){this._showPadding!==t&&(this._showPadding=t,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,this._tp.refreshUI(),t?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(t){this._repaint!==t&&(this._repaint=t,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(t){this._vertices=t,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(t){this._showTileAABBs!==t&&(this._showTileAABBs=t,this._tp.refreshUI(),t&&this._update())}_setCacheLimits(e,r){t.du(e,r)}_occlusionCriteriaSatisfied(){const t=this.style&&(this.style.has3DLayers()||this.style.terrain&&!this.style.disableElevatedTerrain);return!(this.style&&this.style.hasSymbolLayers()&&t&&this.painter)||this._frameId-this._lastDirtyFrameId>5+2*this.painter.symbolParams.occlusionQueryFrameWindow}get version(){return t.dt}},NavigationControl:class{constructor(e={}){this.options=t.W({},qa,e),this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(t.bp(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(t=>{this._map&&this._map.zoomIn({},{originalEvent:t})})),o("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(t=>{this._map&&this._map.zoomOut({},{originalEvent:t})})),o("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(t.bp(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(t=>{const e=this._map;e&&(this.options.visualizePitch?e.resetNorthPitch({},{originalEvent:t}):e.resetNorth({},{originalEvent:t}))})),this._compassIcon=o("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const t=this._map;if(!t)return;const e=t.getZoom(),r=e===t.getMaxZoom(),i=e===t.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=i,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",i.toString())}_rotateCompassArrow(){const t=this._map;if(!t)return;const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(t.transform.pitch*(Math.PI/180)),.5)}) rotateX(${t.transform.pitch}deg) rotateZ(${t.transform.angle*(180/Math.PI)}deg)`:`rotate(${t.transform.angle*(180/Math.PI)}deg)`;t._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=e)}))}onAdd(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),t.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&t.on("pitch",this._rotateCompassArrow),t.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Za(t,this._compass,this.options.visualizePitch)),this._container}onRemove(){const t=this._map;t&&(this._container.remove(),this.options.showZoom&&t.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&t.off("pitch",this._rotateCompassArrow),t.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(t,e){const r=o("button",t,this._container);return r.type="button",r.addEventListener("click",e),r}_setButtonTitle(t,e){if(!this._map)return;const r=this._map._getUIString(`NavigationControl.${e}`);t.setAttribute("aria-label",r),t.firstElementChild&&t.firstElementChild.setAttribute("title",r)}},GeolocateControl:class extends t.E{constructor(e={}){super();const r=navigator.geolocation;this.options=t.W({geolocation:r},Wa,e),t.bp(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Do(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(t){return this._map=t,this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(t){const e=(e=!!this.options.geolocation)=>{this._supportsGeolocation=e,t(e)};void 0!==this._supportsGeolocation?t(this._supportsGeolocation):void 0!==navigator.permissions?navigator.permissions.query({name:"geolocation"}).then((t=>e("denied"!==t.state))).catch((()=>e())):e()}_isOutOfMapMaxBounds(t){const e=this._map.getMaxBounds(),r=t.coords;return!!e&&(r.longitude<e.getWest()||r.longitude>e.getEast()||r.latitude<e.getSouth()||r.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new t.f("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new t.f("geolocate",e)),this._finish()}}_updateCamera(e){const r=new t.aI(e.coords.longitude,e.coords.latitude),i=e.coords.accuracy,n=this._map.getBearing(),o=t.W({bearing:n},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(i),o,{geolocateSource:!0})}_updateMarker(e){if(e){const r=new t.aI(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const e=this._map.transform,r=t.ax(1,e._center.lat)*e.worldSize,i=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${i}px`,this._circleElement.style.height=`${i}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(e){if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new t.f("error",e)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(e){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=o("button","mapboxgl-ctrl-geolocate",this._container),o("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===e){t.w("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=o("div","mapboxgl-user-location"),this._dotElement.appendChild(o("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(o("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Oa({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=o("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Oa({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(e=>{e.geolocateSource||"ACTIVE_LOCK"!==this._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new t.f("trackuserlocationend")))}))}}_onDeviceOrientation(t){this._userLocationDotMarker&&(t.webkitCompassHeading?this._heading=t.webkitCompassHeading:!0===t.absolute&&(this._heading=-1*t.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return t.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.f("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.f("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.f("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let t;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(t={maximumAge:6e5,timeout:0},this._noTimeout=!0):(t=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,t),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const t=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};"undefined"!=typeof DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((e=>{"granted"===e&&t()})).catch(console.error):t()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Da,ScaleControl:class{constructor(e={}){this.options=t.W({},Xa,e),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch(t){return!1}}(),t.bp(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const t=this.options.maxWidth||100,e=this._map,r=e._containerHeight/2,i=e._containerWidth/2-t/2,n=e.unproject([i,r]),o=e.unproject([i+t,r]),a=n.distanceTo(o);if("imperial"===this.options.unit){const e=3.2808*a;e>5280?this._setScale(t,e/5280,"mile"):this._setScale(t,e,"foot")}else"nautical"===this.options.unit?this._setScale(t,a/1852,"nautical-mile"):a>=1e3?this._setScale(t,a/1e3,"kilometer"):this._setScale(t,a,"meter")}_setScale(t,e,r){this._map._requestDomTask((()=>{const i=function(t){const e=Math.pow(10,`${Math.floor(t)}`.length-1);let r=t/e;return r=r>=10?10:r>=5?5:r>=3?3:r>=2?2:r>=1?1:function(t){const e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(r),e*r}(e),n=i/e;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==r?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:r}).format(i):`${i}&nbsp;${$a[r]}`,this._container.style.width=t*n+"px"}))}onAdd(t){return this._map=t,this._language=t.getLanguage(),this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(t){this._language=t,this._update()}setUnit(t){this.options.unit=t,this._update()}},FullscreenControl:class{constructor(e={}){this._fullscreen=!1,e&&e.container&&(e.container instanceof HTMLElement?this._container=e.container:t.w("Full screen control 'container' must be a DOM element.")),t.bp(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const t=this._fullscreenButton=o("button","mapboxgl-ctrl-fullscreen",this._controlContainer);o("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",t)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends t.E{constructor(e){super(),this.options=t.W(Object.create(Qa),e),t.bp(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(e&&e.className?e.className.trim().split(/\s+/):[])}addTo(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&e.on("preclick",this._onClose),this.options.closeOnMove&&e.on("move",this._onClose),e.on("remove",this.remove),this._update(),e._addPopup(this),this._focusFirstElement(),this._trackPointer?(e.on("mousemove",this._onMouseEvent),e.on("mouseup",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")):e.on("move",this._update),this.fire(new t.f("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const e=this._map;return e&&(e.off("move",this._update),e.off("move",this._onClose),e.off("preclick",this._onClose),e.off("click",this._onClose),e.off("remove",this.remove),e.off("mousemove",this._onMouseEvent),e.off("mouseup",this._onMouseEvent),e.off("drag",this._onMouseEvent),e._canvasContainer&&e._canvasContainer.classList.remove("mapboxgl-track-pointer"),e._removePopup(this),this._map=void 0),this.fire(new t.f("close")),this}getLngLat(){return this._lngLat}setLngLat(e){this._lngLat=t.aI.convert(e),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const t=this._map;return t&&(t.off("move",this._update),t.on("mousemove",this._onMouseEvent),t.on("drag",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(t){return this.setDOMContent(document.createTextNode(t))}setHTML(t){const e=document.createDocumentFragment(),r=document.createElement("body");let i;for(r.innerHTML=t;i=r.firstChild,i;)e.appendChild(i);return this.setDOMContent(e)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(t){return this.options.maxWidth=t,this._update(),this}setDOMContent(t){let e=this._content;if(e)for(;e.hasChildNodes();)e.firstChild&&e.removeChild(e.firstChild);else e=this._content=o("div","mapboxgl-popup-content",this._container||void 0);if(e.appendChild(t),this.options.closeButton){const t=this._closeButton=o("button","mapboxgl-popup-close-button",e);t.type="button",t.setAttribute("aria-label","Close popup"),t.setAttribute("aria-hidden","true"),t.innerHTML="&#215;",t.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(t){return this._classList.add(t),this._updateClassList(),this}removeClassName(t){return this._classList.delete(t),this._updateClassList(),this}setOffset(t){return this.options.offset=t,this._update(),this}toggleClassName(t){let e;return this._classList.delete(t)?e=!1:(this._classList.add(t),e=!0),this._updateClassList(),e}_onMouseEvent(t){this._update(t.point)}_getAnchor(t){if(this.options.anchor)return this.options.anchor;const e=this._map,r=this._container,i=this._pos;if(!e||!r||!i)return"bottom";const n=r.offsetWidth,o=r.offsetHeight,a=i.x<n/2,s=i.x>e.transform.width-n/2;if(i.y+t<o)return a?"top-left":s?"top-right":"top";if(i.y>e.transform.height-o){if(a)return"bottom-left";if(s)return"bottom-right"}return a?"left":s?"right":"bottom"}_updateClassList(){const t=this._container;if(!t)return;const e=[...this._classList];e.push("mapboxgl-popup"),this._anchor&&e.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&e.push("mapboxgl-popup-track-pointer"),t.className=e.join(" ")}_update(e){const r=this._map,i=this._content;if(!r||!this._lngLat&&!this._trackPointer||!i)return;let n=this._container;if(n||(n=this._container=o("div","mapboxgl-popup",r.getContainer()),this._tip=o("div","mapboxgl-popup-tip",n),n.appendChild(i)),this.options.maxWidth&&n.style.maxWidth!==this.options.maxWidth&&(n.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=za(this._lngLat,this._pos,r.transform)),!this._trackPointer||e){const i=this._pos=this._trackPointer&&e instanceof t.P?e:r.project(this._lngLat),n=Va(this.options.offset),o=this._anchor=this._getAnchor(n.y),a=Va(this.options.offset,o),s=i.add(a).round();r._requestDomTask((()=>{this._container&&o&&(this._container.style.transform=`${Ra[o]} translate(${s.x}px,${s.y}px)`)}))}if(!this._marker&&r._showingGlobe()){const e=t.d9(r.transform,this._lngLat)?0:1;this._setOpacity(e)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const t=this._container.querySelector(Na);t&&t.focus()}_onClose(){this.remove()}_setOpacity(t){this._container&&(this._container.style.opacity=`${t}`),this._content&&(this._content.style.pointerEvents=t?"auto":"none")}},Marker:Oa,Style:Lo,LngLat:t.aI,LngLatBounds:t.ai,Point:t.P,MercatorCoordinate:t.Y,FreeCameraOptions:Ke,Evented:t.E,config:t.d8,prewarm:t.dx,clearPrewarmedResources:t.dy,get accessToken(){return t.d8.ACCESS_TOKEN},set accessToken(e){t.d8.ACCESS_TOKEN=e},get baseApiUrl(){return t.d8.API_URL},set baseApiUrl(e){t.d8.API_URL=e},get workerCount(){return t.dz.workerCount},set workerCount(e){t.dz.workerCount=e},get maxParallelImageRequests(){return t.d8.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){t.d8.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage(e){t.dA(e)},get workerUrl(){return t.dB.workerUrl},set workerUrl(e){t.dB.workerUrl=e},get workerClass(){return t.dB.workerClass},set workerClass(e){t.dB.workerClass=e},get workerParams(){return t.dB.workerParams},set workerParams(e){t.dB.workerParams=e},get dracoUrl(){return t.dC()},set dracoUrl(e){t.dD(e)},get meshoptUrl(){return t.dE()},set meshoptUrl(e){t.dF(e)},setNow:t.e.setNow,restoreNow:t.e.restoreNow};return Ya})),r}()}));function jv(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,i=Xe(t);if(e){var n=Xe(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return We(this,r)}}function Gv(t){lu(t,"svelte-1k49t6h","div.svelte-1k49t6h{top:0;bottom:0}#map.svelte-1k49t6h{pointer-events:none}")}function Kv(t){var e;return{c:function(){_u(e=Au("div"),"id","map"),xu(e,"width","100%"),xu(e,"height","100vh"),_u(e,"class","svelte-1k49t6h")},m:function(r,i){cu(r,e,i),t[2](e)},p:Kc,i:Kc,o:Kc,d:function(r){r&&uu(e),t[2](null)}}}function qv(t,e,r){var i,n=e.mygeojson;return console.log(n),Tu((function(){console.log("here"),Hv.accessToken="pk.eyJ1Ijoic2FzaGFnYXJpYmFsZHkiLCJhIjoiY2xyajRlczBlMDhqMTJpcXF3dHJhdTVsNyJ9.P_6mX_qbcbxLDS1o_SxpFg",r(0,i=new Hv.Map({container:i,style:"mapbox://styles/sashagaribaldy/clxstrxes00qv01pf8dgl4o20",center:[50.224518,22.213995],zoom:2.5,maxZoom:5})),i.on("load",(function(){console.log("moooooo"),i.addSource("countries",{type:"geojson",data:n,generateId:!0}),i.addLayer({id:"countries-layer",type:"fill",source:"countries",paint:{"fill-color":{property:"number",stops:[[1,"#BEBEBE"],[100,"#989898"],[1e3,"#484840"]]},"fill-opacity":["case",["<",["get","number"],5],0,[">=",["get","number"],5],1,1]}}),i.addLayer({id:"borders",type:"line",source:"countries",paint:{"line-color":"#000","line-width":["case",["boolean",["feature-state","hover"],!1],1.5,0]}})}))})),t.$$set=function(t){"mygeojson"in t&&r(1,n=t.mygeojson)},[i,n,function(t){Mu[t?"unshift":"push"]((function(){r(0,i=t)}))}]}var Zv=function(t){qe(r,t);var e=jv(r);function r(t){var i;return je(this,r),Yu(Ge(i=e.call(this)),t,qv,Kv,$c,{mygeojson:1},Gv),i}return r}(Ju);function Wv(t,e,r){if(null!==t)for(var i,n,o,a,s,l,c,u,h=0,A=0,p=t.type,d="FeatureCollection"===p,f="Feature"===p,m=d?t.features.length:1,g=0;g<m;g++){s=(u=!!(c=d?t.features[g].geometry:f?t.geometry:t)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var _=0;_<s;_++){var y=0,v=0;if(null!==(a=u?c.geometries[_]:c)){l=a.coordinates;var x=a.type;switch(h=!r||"Polygon"!==x&&"MultiPolygon"!==x?0:1,x){case null:break;case"Point":if(!1===e(l,A,g,y,v))return!1;A++,y++;break;case"LineString":case"MultiPoint":for(i=0;i<l.length;i++){if(!1===e(l[i],A,g,y,v))return!1;A++,"MultiPoint"===x&&y++}"LineString"===x&&y++;break;case"Polygon":case"MultiLineString":for(i=0;i<l.length;i++){for(n=0;n<l[i].length-h;n++){if(!1===e(l[i][n],A,g,y,v))return!1;A++}"MultiLineString"===x&&y++,"Polygon"===x&&v++}"Polygon"===x&&y++;break;case"MultiPolygon":for(i=0;i<l.length;i++){for(v=0,n=0;n<l[i].length;n++){for(o=0;o<l[i][n].length-h;o++){if(!1===e(l[i][n][o],A,g,y,v))return!1;A++}v++}y++}break;case"GeometryCollection":for(i=0;i<a.geometries.length;i++)if(!1===Wv(a.geometries[i],e,r))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Xv(t){var e=[1/0,1/0,-1/0,-1/0];return Wv(t,(function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])})),e}Xv.default=Xv,kt({target:"String",proto:!0,forced:!Pa("includes")},{includes:function(t){return!!~String(m(this)).indexOf(Ma(t),arguments.length>1?arguments[1]:void 0)}}),kt({target:"Object",stat:!0},{fromEntries:function(t){var e={};return hn(t,(function(t,r){Xr(e,t,r)}),{AS_ENTRIES:!0}),e}}),a&&("g"!=/./g.flags||Jo.UNSUPPORTED_Y)&&P.f(RegExp.prototype,"flags",{configurable:!0,get:Wo});var $v=String.fromCharCode,Yv=String.fromCodePoint,Jv=!!Yv&&1!=Yv.length;kt({target:"String",stat:!0,forced:Jv},{fromCodePoint:function(t){for(var e,r=[],i=arguments.length,n=0;i>n;){if(e=+arguments[n++],gt(e,1114111)!==e)throw RangeError(e+" is not a valid code point");r.push(e<65536?$v(e):$v(55296+((e-=65536)>>10),e%1024+56320))}return r.join("")}}),kt({target:"String",proto:!0},{repeat:tf}),al("Uint8",(function(t){return function(e,r,i){return t(this,e,r,i)}})),al("Uint16",(function(t){return function(e,r,i){return t(this,e,r,i)}}));e((function(t,e){
/*!
	   * html2canvas 1.4.1 <https://html2canvas.hertzen.com>
	   * Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
	   * Released under MIT License
	   */
t.exports=function(){
/*! *****************************************************************************
	    Copyright (c) Microsoft Corporation.
	      Permission to use, copy, modify, and/or distribute this software for any
	    purpose with or without fee is hereby granted.
	      THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	    PERFORMANCE OF THIS SOFTWARE.
	    ***************************************************************************** */
var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};function e(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}var r=function(){return r=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},r.apply(this,arguments)};function i(t,e,r,i){function n(t){return t instanceof r?t:new r((function(e){e(t)}))}return new(r||(r=Promise))((function(r,o){function a(t){try{l(i.next(t))}catch(t){o(t)}}function s(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){t.done?r(t.value):n(t.value).then(a,s)}l((i=i.apply(t,e||[])).next())}))}function n(t,e){var r,i,n,o,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(t){return function(e){return l([t,e])}}function l(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((n=(n=a.trys).length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){a.label=o[1];break}if(6===o[0]&&a.label<n[1]){a.label=n[1],n=o;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(o);break}n[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}}function o(t,e,r){if(r||2===arguments.length)for(var i,n=0,o=e.length;n<o;n++)!i&&n in e||(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return t.concat(i||e)}for(var a=function(){function t(t,e,r,i){this.left=t,this.top=e,this.width=r,this.height=i}return t.prototype.add=function(e,r,i,n){return new t(this.left+e,this.top+r,this.width+i,this.height+n)},t.fromClientRect=function(e,r){return new t(r.left+e.windowBounds.left,r.top+e.windowBounds.top,r.width,r.height)},t.fromDOMRectList=function(e,r){var i=Array.from(r).find((function(t){return 0!==t.width}));return i?new t(i.left+e.windowBounds.left,i.top+e.windowBounds.top,i.width,i.height):t.EMPTY},t.EMPTY=new t(0,0,0,0),t}(),s=function(t,e){return a.fromClientRect(t,e.getBoundingClientRect())},l=function(t){var e=t.body,r=t.documentElement;if(!e||!r)throw new Error("Unable to get document size");var i=Math.max(Math.max(e.scrollWidth,r.scrollWidth),Math.max(e.offsetWidth,r.offsetWidth),Math.max(e.clientWidth,r.clientWidth)),n=Math.max(Math.max(e.scrollHeight,r.scrollHeight),Math.max(e.offsetHeight,r.offsetHeight),Math.max(e.clientHeight,r.clientHeight));return new a(0,0,i,n)},c=function(t){for(var e=[],r=0,i=t.length;r<i;){var n=t.charCodeAt(r++);if(n>=55296&&n<=56319&&r<i){var o=t.charCodeAt(r++);56320==(64512&o)?e.push(((1023&n)<<10)+(1023&o)+65536):(e.push(n),r--)}else e.push(n)}return e},u=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,t);var r=t.length;if(!r)return"";for(var i=[],n=-1,o="";++n<r;){var a=t[n];a<=65535?i.push(a):(a-=65536,i.push(55296+(a>>10),a%1024+56320)),(n+1===r||i.length>16384)&&(o+=String.fromCharCode.apply(String,i),i.length=0)}return o},h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",A="undefined"==typeof Uint8Array?[]:new Uint8Array(256),p=0;p<h.length;p++)A[h.charCodeAt(p)]=p;for(var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f="undefined"==typeof Uint8Array?[]:new Uint8Array(256),m=0;m<d.length;m++)f[d.charCodeAt(m)]=m;for(var g=function(t){var e,r,i,n,o,a=.75*t.length,s=t.length,l=0;"="===t[t.length-1]&&(a--,"="===t[t.length-2]&&a--);var c="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.slice?new ArrayBuffer(a):new Array(a),u=Array.isArray(c)?c:new Uint8Array(c);for(e=0;e<s;e+=4)r=f[t.charCodeAt(e)],i=f[t.charCodeAt(e+1)],n=f[t.charCodeAt(e+2)],o=f[t.charCodeAt(e+3)],u[l++]=r<<2|i>>4,u[l++]=(15&i)<<4|n>>2,u[l++]=(3&n)<<6|63&o;return c},_=function(t){for(var e=t.length,r=[],i=0;i<e;i+=2)r.push(t[i+1]<<8|t[i]);return r},y=function(t){for(var e=t.length,r=[],i=0;i<e;i+=4)r.push(t[i+3]<<24|t[i+2]<<16|t[i+1]<<8|t[i]);return r},v=5,x=11,w=2,b=65536>>v,B=(1<<v)-1,C=b+(1024>>v)+32,E=65536>>x,T=(1<<x-v)-1,I=function(t,e,r){return t.slice?t.slice(e,r):new Uint16Array(Array.prototype.slice.call(t,e,r))},S=function(t,e,r){return t.slice?t.slice(e,r):new Uint32Array(Array.prototype.slice.call(t,e,r))},M=function(t,e){var r=g(t),i=Array.isArray(r)?y(r):new Uint32Array(r),n=Array.isArray(r)?_(r):new Uint16Array(r),o=24,a=I(n,o/2,i[4]/2),s=2===i[5]?I(n,(o+i[4])/2):S(i,Math.ceil((o+i[4])/4));return new F(i[0],i[1],i[2],i[3],a,s)},F=function(){function t(t,e,r,i,n,o){this.initialValue=t,this.errorValue=e,this.highStart=r,this.highValueIndex=i,this.index=n,this.data=o}return t.prototype.get=function(t){var e;if(t>=0){if(t<55296||t>56319&&t<=65535)return e=((e=this.index[t>>v])<<w)+(t&B),this.data[e];if(t<=65535)return e=((e=this.index[b+(t-55296>>v)])<<w)+(t&B),this.data[e];if(t<this.highStart)return e=C-E+(t>>x),e=this.index[e],e+=t>>v&T,e=((e=this.index[e])<<w)+(t&B),this.data[e];if(t<=1114111)return this.data[this.highValueIndex]}return this.errorValue},t}(),P="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",L="undefined"==typeof Uint8Array?[]:new Uint8Array(256),D=0;D<P.length;D++)L[P.charCodeAt(D)]=D;var U=50,k=1,z=2,R=3,O=4,Q=5,N=7,V=8,H=9,j=10,G=11,K=12,q=13,Z=14,W=15,X=16,$=17,Y=18,J=19,tt=20,et=21,rt=22,it=23,nt=24,ot=25,at=26,st=27,lt=28,ct=29,ut=30,ht=31,At=32,pt=33,dt=34,ft=35,mt=36,gt=37,_t=38,yt=39,vt=40,xt=41,wt=42,bt=43,Bt=[9001,65288],Ct="!",Et="×",Tt="÷",It=M("KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA=="),St=[ut,mt],Mt=[k,z,R,Q],Ft=[j,V],Pt=[st,at],Lt=Mt.concat(Ft),Dt=[_t,yt,vt,dt,ft],Ut=[W,q],kt=function(t,e){void 0===e&&(e="strict");var r=[],i=[],n=[];return t.forEach((function(t,o){var a=It.get(t);if(a>U?(n.push(!0),a-=U):n.push(!1),-1!==["normal","auto","loose"].indexOf(e)&&-1!==[8208,8211,12316,12448].indexOf(t))return i.push(o),r.push(X);if(a===O||a===G){if(0===o)return i.push(o),r.push(ut);var s=r[o-1];return-1===Lt.indexOf(s)?(i.push(i[o-1]),r.push(s)):(i.push(o),r.push(ut))}return i.push(o),a===ht?r.push("strict"===e?et:gt):a===wt||a===ct?r.push(ut):a===bt?t>=131072&&t<=196605||t>=196608&&t<=262141?r.push(gt):r.push(ut):void r.push(a)})),[i,r,n]},zt=function(t,e,r,i){var n=i[r];if(Array.isArray(t)?-1!==t.indexOf(n):t===n)for(var o=r;o<=i.length;){if((l=i[++o])===e)return!0;if(l!==j)break}if(n===j)for(o=r;o>0;){var a=i[--o];if(Array.isArray(t)?-1!==t.indexOf(a):t===a)for(var s=r;s<=i.length;){var l;if((l=i[++s])===e)return!0;if(l!==j)break}if(a!==j)break}return!1},Rt=function(t,e){for(var r=t;r>=0;){var i=e[r];if(i!==j)return i;r--}return 0},Ot=function(t,e,r,i,n){if(0===r[i])return Et;var o=i-1;if(Array.isArray(n)&&!0===n[o])return Et;var a=o-1,s=o+1,l=e[o],c=a>=0?e[a]:0,u=e[s];if(l===z&&u===R)return Et;if(-1!==Mt.indexOf(l))return Ct;if(-1!==Mt.indexOf(u))return Et;if(-1!==Ft.indexOf(u))return Et;if(Rt(o,e)===V)return Tt;if(It.get(t[o])===G)return Et;if((l===At||l===pt)&&It.get(t[s])===G)return Et;if(l===N||u===N)return Et;if(l===H)return Et;if(-1===[j,q,W].indexOf(l)&&u===H)return Et;if(-1!==[$,Y,J,nt,lt].indexOf(u))return Et;if(Rt(o,e)===rt)return Et;if(zt(it,rt,o,e))return Et;if(zt([$,Y],et,o,e))return Et;if(zt(K,K,o,e))return Et;if(l===j)return Tt;if(l===it||u===it)return Et;if(u===X||l===X)return Tt;if(-1!==[q,W,et].indexOf(u)||l===Z)return Et;if(c===mt&&-1!==Ut.indexOf(l))return Et;if(l===lt&&u===mt)return Et;if(u===tt)return Et;if(-1!==St.indexOf(u)&&l===ot||-1!==St.indexOf(l)&&u===ot)return Et;if(l===st&&-1!==[gt,At,pt].indexOf(u)||-1!==[gt,At,pt].indexOf(l)&&u===at)return Et;if(-1!==St.indexOf(l)&&-1!==Pt.indexOf(u)||-1!==Pt.indexOf(l)&&-1!==St.indexOf(u))return Et;if(-1!==[st,at].indexOf(l)&&(u===ot||-1!==[rt,W].indexOf(u)&&e[s+1]===ot)||-1!==[rt,W].indexOf(l)&&u===ot||l===ot&&-1!==[ot,lt,nt].indexOf(u))return Et;if(-1!==[ot,lt,nt,$,Y].indexOf(u))for(var h=o;h>=0;){if((A=e[h])===ot)return Et;if(-1===[lt,nt].indexOf(A))break;h--}if(-1!==[st,at].indexOf(u))for(h=-1!==[$,Y].indexOf(l)?a:o;h>=0;){var A;if((A=e[h])===ot)return Et;if(-1===[lt,nt].indexOf(A))break;h--}if(_t===l&&-1!==[_t,yt,dt,ft].indexOf(u)||-1!==[yt,dt].indexOf(l)&&-1!==[yt,vt].indexOf(u)||-1!==[vt,ft].indexOf(l)&&u===vt)return Et;if(-1!==Dt.indexOf(l)&&-1!==[tt,at].indexOf(u)||-1!==Dt.indexOf(u)&&l===st)return Et;if(-1!==St.indexOf(l)&&-1!==St.indexOf(u))return Et;if(l===nt&&-1!==St.indexOf(u))return Et;if(-1!==St.concat(ot).indexOf(l)&&u===rt&&-1===Bt.indexOf(t[s])||-1!==St.concat(ot).indexOf(u)&&l===Y)return Et;if(l===xt&&u===xt){for(var p=r[o],d=1;p>0&&e[--p]===xt;)d++;if(d%2!=0)return Et}return l===At&&u===pt?Et:Tt},Qt=function(t,e){e||(e={lineBreak:"normal",wordBreak:"normal"});var r=kt(t,e.lineBreak),i=r[0],n=r[1],o=r[2];"break-all"!==e.wordBreak&&"break-word"!==e.wordBreak||(n=n.map((function(t){return-1!==[ot,ut,wt].indexOf(t)?gt:t})));var a="keep-all"===e.wordBreak?o.map((function(e,r){return e&&t[r]>=19968&&t[r]<=40959})):void 0;return[i,n,a]},Nt=function(){function t(t,e,r,i){this.codePoints=t,this.required=e===Ct,this.start=r,this.end=i}return t.prototype.slice=function(){return u.apply(void 0,this.codePoints.slice(this.start,this.end))},t}(),Vt=function(t,e){var r=c(t),i=Qt(r,e),n=i[0],o=i[1],a=i[2],s=r.length,l=0,u=0;return{next:function(){if(u>=s)return{done:!0,value:null};for(var t=Et;u<s&&(t=Ot(r,o,n,++u,a))===Et;);if(t!==Et||u===s){var e=new Nt(r,t,l,u);return l=u,{value:e,done:!1}}return{done:!0,value:null}}}},Ht=1,jt=2,Gt=4,Kt=8,qt=10,Zt=47,Wt=92,Xt=9,$t=32,Yt=34,Jt=61,te=35,ee=36,re=37,ie=39,ne=40,oe=41,ae=95,se=45,le=33,ce=60,ue=62,he=64,Ae=91,pe=93,de=61,fe=123,me=63,ge=125,_e=124,ye=126,ve=128,xe=65533,we=42,be=43,Be=44,Ce=58,Ee=59,Te=46,Ie=0,Se=8,Me=11,Fe=14,Pe=31,Le=127,De=-1,Ue=48,ke=97,ze=101,Re=102,Oe=117,Qe=122,Ne=65,Ve=69,He=70,je=85,Ge=90,Ke=function(t){return t>=Ue&&t<=57},qe=function(t){return t>=55296&&t<=57343},We=function(t){return Ke(t)||t>=Ne&&t<=He||t>=ke&&t<=Re},Xe=function(t){return t>=ke&&t<=Qe},$e=function(t){return t>=Ne&&t<=Ge},Ye=function(t){return Xe(t)||$e(t)},Je=function(t){return t>=ve},tr=function(t){return t===qt||t===Xt||t===$t},er=function(t){return Ye(t)||Je(t)||t===ae},rr=function(t){return er(t)||Ke(t)||t===se},ir=function(t){return t>=Ie&&t<=Se||t===Me||t>=Fe&&t<=Pe||t===Le},nr=function(t,e){return t===Wt&&e!==qt},or=function(t,e,r){return t===se?er(e)||nr(e,r):!!er(t)||!(t!==Wt||!nr(t,e))},ar=function(t,e,r){return t===be||t===se?!!Ke(e)||e===Te&&Ke(r):Ke(t===Te?e:t)},sr=function(t){var e=0,r=1;t[e]!==be&&t[e]!==se||(t[e]===se&&(r=-1),e++);for(var i=[];Ke(t[e]);)i.push(t[e++]);var n=i.length?parseInt(u.apply(void 0,i),10):0;t[e]===Te&&e++;for(var o=[];Ke(t[e]);)o.push(t[e++]);var a=o.length,s=a?parseInt(u.apply(void 0,o),10):0;t[e]!==Ve&&t[e]!==ze||e++;var l=1;t[e]!==be&&t[e]!==se||(t[e]===se&&(l=-1),e++);for(var c=[];Ke(t[e]);)c.push(t[e++]);var h=c.length?parseInt(u.apply(void 0,c),10):0;return r*(n+s*Math.pow(10,-a))*Math.pow(10,l*h)},lr={type:2},cr={type:3},ur={type:4},hr={type:13},Ar={type:8},pr={type:21},dr={type:9},fr={type:10},mr={type:11},gr={type:12},_r={type:14},yr={type:23},vr={type:1},xr={type:25},wr={type:24},br={type:26},Br={type:27},Cr={type:28},Er={type:29},Tr={type:31},Ir={type:32},Sr=function(){function t(){this._value=[]}return t.prototype.write=function(t){this._value=this._value.concat(c(t))},t.prototype.read=function(){for(var t=[],e=this.consumeToken();e!==Ir;)t.push(e),e=this.consumeToken();return t},t.prototype.consumeToken=function(){var t=this.consumeCodePoint();switch(t){case Yt:return this.consumeStringToken(Yt);case te:var e=this.peekCodePoint(0),r=this.peekCodePoint(1),i=this.peekCodePoint(2);if(rr(e)||nr(r,i)){var n=or(e,r,i)?jt:Ht;return{type:5,value:this.consumeName(),flags:n}}break;case ee:if(this.peekCodePoint(0)===Jt)return this.consumeCodePoint(),hr;break;case ie:return this.consumeStringToken(ie);case ne:return lr;case oe:return cr;case we:if(this.peekCodePoint(0)===Jt)return this.consumeCodePoint(),_r;break;case be:if(ar(t,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(t),this.consumeNumericToken();break;case Be:return ur;case se:var o=t,a=this.peekCodePoint(0),s=this.peekCodePoint(1);if(ar(o,a,s))return this.reconsumeCodePoint(t),this.consumeNumericToken();if(or(o,a,s))return this.reconsumeCodePoint(t),this.consumeIdentLikeToken();if(a===se&&s===ue)return this.consumeCodePoint(),this.consumeCodePoint(),wr;break;case Te:if(ar(t,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(t),this.consumeNumericToken();break;case Zt:if(this.peekCodePoint(0)===we)for(this.consumeCodePoint();;){var l=this.consumeCodePoint();if(l===we&&(l=this.consumeCodePoint())===Zt)return this.consumeToken();if(l===De)return this.consumeToken()}break;case Ce:return br;case Ee:return Br;case ce:if(this.peekCodePoint(0)===le&&this.peekCodePoint(1)===se&&this.peekCodePoint(2)===se)return this.consumeCodePoint(),this.consumeCodePoint(),xr;break;case he:var c=this.peekCodePoint(0),h=this.peekCodePoint(1),A=this.peekCodePoint(2);if(or(c,h,A))return{type:7,value:this.consumeName()};break;case Ae:return Cr;case Wt:if(nr(t,this.peekCodePoint(0)))return this.reconsumeCodePoint(t),this.consumeIdentLikeToken();break;case pe:return Er;case de:if(this.peekCodePoint(0)===Jt)return this.consumeCodePoint(),Ar;break;case fe:return mr;case ge:return gr;case Oe:case je:var p=this.peekCodePoint(0),d=this.peekCodePoint(1);return p!==be||!We(d)&&d!==me||(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(t),this.consumeIdentLikeToken();case _e:if(this.peekCodePoint(0)===Jt)return this.consumeCodePoint(),dr;if(this.peekCodePoint(0)===_e)return this.consumeCodePoint(),pr;break;case ye:if(this.peekCodePoint(0)===Jt)return this.consumeCodePoint(),fr;break;case De:return Ir}return tr(t)?(this.consumeWhiteSpace(),Tr):Ke(t)?(this.reconsumeCodePoint(t),this.consumeNumericToken()):er(t)?(this.reconsumeCodePoint(t),this.consumeIdentLikeToken()):{type:6,value:u(t)}},t.prototype.consumeCodePoint=function(){var t=this._value.shift();return void 0===t?-1:t},t.prototype.reconsumeCodePoint=function(t){this._value.unshift(t)},t.prototype.peekCodePoint=function(t){return t>=this._value.length?-1:this._value[t]},t.prototype.consumeUnicodeRangeToken=function(){for(var t=[],e=this.consumeCodePoint();We(e)&&t.length<6;)t.push(e),e=this.consumeCodePoint();for(var r=!1;e===me&&t.length<6;)t.push(e),e=this.consumeCodePoint(),r=!0;if(r)return{type:30,start:parseInt(u.apply(void 0,t.map((function(t){return t===me?Ue:t}))),16),end:parseInt(u.apply(void 0,t.map((function(t){return t===me?He:t}))),16)};var i=parseInt(u.apply(void 0,t),16);if(this.peekCodePoint(0)===se&&We(this.peekCodePoint(1))){this.consumeCodePoint(),e=this.consumeCodePoint();for(var n=[];We(e)&&n.length<6;)n.push(e),e=this.consumeCodePoint();return{type:30,start:i,end:parseInt(u.apply(void 0,n),16)}}return{type:30,start:i,end:i}},t.prototype.consumeIdentLikeToken=function(){var t=this.consumeName();return"url"===t.toLowerCase()&&this.peekCodePoint(0)===ne?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===ne?(this.consumeCodePoint(),{type:19,value:t}):{type:20,value:t}},t.prototype.consumeUrlToken=function(){var t=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===De)return{type:22,value:""};var e=this.peekCodePoint(0);if(e===ie||e===Yt){var r=this.consumeStringToken(this.consumeCodePoint());return 0===r.type&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===De||this.peekCodePoint(0)===oe)?(this.consumeCodePoint(),{type:22,value:r.value}):(this.consumeBadUrlRemnants(),yr)}for(;;){var i=this.consumeCodePoint();if(i===De||i===oe)return{type:22,value:u.apply(void 0,t)};if(tr(i))return this.consumeWhiteSpace(),this.peekCodePoint(0)===De||this.peekCodePoint(0)===oe?(this.consumeCodePoint(),{type:22,value:u.apply(void 0,t)}):(this.consumeBadUrlRemnants(),yr);if(i===Yt||i===ie||i===ne||ir(i))return this.consumeBadUrlRemnants(),yr;if(i===Wt){if(!nr(i,this.peekCodePoint(0)))return this.consumeBadUrlRemnants(),yr;t.push(this.consumeEscapedCodePoint())}else t.push(i)}},t.prototype.consumeWhiteSpace=function(){for(;tr(this.peekCodePoint(0));)this.consumeCodePoint()},t.prototype.consumeBadUrlRemnants=function(){for(;;){var t=this.consumeCodePoint();if(t===oe||t===De)return;nr(t,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},t.prototype.consumeStringSlice=function(t){for(var e=5e4,r="";t>0;){var i=Math.min(e,t);r+=u.apply(void 0,this._value.splice(0,i)),t-=i}return this._value.shift(),r},t.prototype.consumeStringToken=function(t){for(var e="",r=0;;){var i=this._value[r];if(i===De||void 0===i||i===t)return{type:0,value:e+=this.consumeStringSlice(r)};if(i===qt)return this._value.splice(0,r),vr;if(i===Wt){var n=this._value[r+1];n!==De&&void 0!==n&&(n===qt?(e+=this.consumeStringSlice(r),r=-1,this._value.shift()):nr(i,n)&&(e+=this.consumeStringSlice(r),e+=u(this.consumeEscapedCodePoint()),r=-1))}r++}},t.prototype.consumeNumber=function(){var t=[],e=Gt,r=this.peekCodePoint(0);for(r!==be&&r!==se||t.push(this.consumeCodePoint());Ke(this.peekCodePoint(0));)t.push(this.consumeCodePoint());r=this.peekCodePoint(0);var i=this.peekCodePoint(1);if(r===Te&&Ke(i))for(t.push(this.consumeCodePoint(),this.consumeCodePoint()),e=Kt;Ke(this.peekCodePoint(0));)t.push(this.consumeCodePoint());r=this.peekCodePoint(0),i=this.peekCodePoint(1);var n=this.peekCodePoint(2);if((r===Ve||r===ze)&&((i===be||i===se)&&Ke(n)||Ke(i)))for(t.push(this.consumeCodePoint(),this.consumeCodePoint()),e=Kt;Ke(this.peekCodePoint(0));)t.push(this.consumeCodePoint());return[sr(t),e]},t.prototype.consumeNumericToken=function(){var t=this.consumeNumber(),e=t[0],r=t[1],i=this.peekCodePoint(0),n=this.peekCodePoint(1),o=this.peekCodePoint(2);return or(i,n,o)?{type:15,number:e,flags:r,unit:this.consumeName()}:i===re?(this.consumeCodePoint(),{type:16,number:e,flags:r}):{type:17,number:e,flags:r}},t.prototype.consumeEscapedCodePoint=function(){var t=this.consumeCodePoint();if(We(t)){for(var e=u(t);We(this.peekCodePoint(0))&&e.length<6;)e+=u(this.consumeCodePoint());tr(this.peekCodePoint(0))&&this.consumeCodePoint();var r=parseInt(e,16);return 0===r||qe(r)||r>1114111?xe:r}return t===De?xe:t},t.prototype.consumeName=function(){for(var t="";;){var e=this.consumeCodePoint();if(rr(e))t+=u(e);else{if(!nr(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),t;t+=u(this.consumeEscapedCodePoint())}}},t}(),Mr=function(){function t(t){this._tokens=t}return t.create=function(e){var r=new Sr;return r.write(e),new t(r.read())},t.parseValue=function(e){return t.create(e).parseComponentValue()},t.parseValues=function(e){return t.create(e).parseComponentValues()},t.prototype.parseComponentValue=function(){for(var t=this.consumeToken();31===t.type;)t=this.consumeToken();if(32===t.type)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(t);var e=this.consumeComponentValue();do{t=this.consumeToken()}while(31===t.type);if(32===t.type)return e;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},t.prototype.parseComponentValues=function(){for(var t=[];;){var e=this.consumeComponentValue();if(32===e.type)return t;t.push(e),t.push()}},t.prototype.consumeComponentValue=function(){var t=this.consumeToken();switch(t.type){case 11:case 28:case 2:return this.consumeSimpleBlock(t.type);case 19:return this.consumeFunction(t)}return t},t.prototype.consumeSimpleBlock=function(t){for(var e={type:t,values:[]},r=this.consumeToken();;){if(32===r.type||Or(r,t))return e;this.reconsumeToken(r),e.values.push(this.consumeComponentValue()),r=this.consumeToken()}},t.prototype.consumeFunction=function(t){for(var e={name:t.value,values:[],type:18};;){var r=this.consumeToken();if(32===r.type||3===r.type)return e;this.reconsumeToken(r),e.values.push(this.consumeComponentValue())}},t.prototype.consumeToken=function(){var t=this._tokens.shift();return void 0===t?Ir:t},t.prototype.reconsumeToken=function(t){this._tokens.unshift(t)},t}(),Fr=function(t){return 15===t.type},Pr=function(t){return 17===t.type},Lr=function(t){return 20===t.type},Dr=function(t){return 0===t.type},Ur=function(t,e){return Lr(t)&&t.value===e},kr=function(t){return 31!==t.type},zr=function(t){return 31!==t.type&&4!==t.type},Rr=function(t){var e=[],r=[];return t.forEach((function(t){if(4===t.type){if(0===r.length)throw new Error("Error parsing function args, zero tokens for arg");return e.push(r),void(r=[])}31!==t.type&&r.push(t)})),r.length&&e.push(r),e},Or=function(t,e){return 11===e&&12===t.type||28===e&&29===t.type||2===e&&3===t.type},Qr=function(t){return 17===t.type||15===t.type},Nr=function(t){return 16===t.type||Qr(t)},Vr=function(t){return t.length>1?[t[0],t[1]]:[t[0]]},Hr={type:17,number:0,flags:Gt},jr={type:16,number:50,flags:Gt},Gr={type:16,number:100,flags:Gt},Kr=function(t,e,r){var i=t[0],n=t[1];return[qr(i,e),qr(void 0!==n?n:i,r)]},qr=function(t,e){if(16===t.type)return t.number/100*e;if(Fr(t))switch(t.unit){case"rem":case"em":return 16*t.number;default:return t.number}return t.number},Zr="deg",Wr="grad",Xr="rad",$r="turn",Yr={name:"angle",parse:function(t,e){if(15===e.type)switch(e.unit){case Zr:return Math.PI*e.number/180;case Wr:return Math.PI/200*e.number;case Xr:return e.number;case $r:return 2*Math.PI*e.number}throw new Error("Unsupported angle type")}},Jr=function(t){return 15===t.type&&(t.unit===Zr||t.unit===Wr||t.unit===Xr||t.unit===$r)},ti=function(t){switch(t.filter(Lr).map((function(t){return t.value})).join(" ")){case"to bottom right":case"to right bottom":case"left top":case"top left":return[Hr,Hr];case"to top":case"bottom":return ei(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[Hr,Gr];case"to right":case"left":return ei(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[Gr,Gr];case"to bottom":case"top":return ei(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[Gr,Hr];case"to left":case"right":return ei(270)}return 0},ei=function(t){return Math.PI*t/180},ri={name:"color",parse:function(t,e){if(18===e.type){var r=ui[e.name];if(void 0===r)throw new Error('Attempting to parse an unsupported color function "'+e.name+'"');return r(t,e.values)}if(5===e.type){if(3===e.value.length){var i=e.value.substring(0,1),n=e.value.substring(1,2),o=e.value.substring(2,3);return oi(parseInt(i+i,16),parseInt(n+n,16),parseInt(o+o,16),1)}if(4===e.value.length){i=e.value.substring(0,1),n=e.value.substring(1,2),o=e.value.substring(2,3);var a=e.value.substring(3,4);return oi(parseInt(i+i,16),parseInt(n+n,16),parseInt(o+o,16),parseInt(a+a,16)/255)}if(6===e.value.length)return i=e.value.substring(0,2),n=e.value.substring(2,4),o=e.value.substring(4,6),oi(parseInt(i,16),parseInt(n,16),parseInt(o,16),1);if(8===e.value.length)return i=e.value.substring(0,2),n=e.value.substring(2,4),o=e.value.substring(4,6),a=e.value.substring(6,8),oi(parseInt(i,16),parseInt(n,16),parseInt(o,16),parseInt(a,16)/255)}if(20===e.type){var s=Ai[e.value.toUpperCase()];if(void 0!==s)return s}return Ai.TRANSPARENT}},ii=function(t){return!(255&t)},ni=function(t){var e=255&t,r=255&t>>8,i=255&t>>16,n=255&t>>24;return e<255?"rgba("+n+","+i+","+r+","+e/255+")":"rgb("+n+","+i+","+r+")"},oi=function(t,e,r,i){return(t<<24|e<<16|r<<8|Math.round(255*i))>>>0},ai=function(t,e){if(17===t.type)return t.number;if(16===t.type){var r=3===e?1:255;return 3===e?t.number/100*r:Math.round(t.number/100*r)}return 0},si=function(t,e){var r=e.filter(zr);if(3===r.length){var i=r.map(ai),n=i[0],o=i[1],a=i[2];return oi(n,o,a,1)}if(4===r.length){var s=r.map(ai),l=(n=s[0],o=s[1],a=s[2],s[3]);return oi(n,o,a,l)}return 0};function li(t,e,r){return r<0&&(r+=1),r>=1&&(r-=1),r<1/6?(e-t)*r*6+t:r<.5?e:r<2/3?6*(e-t)*(2/3-r)+t:t}var ci=function(t,e){var r=e.filter(zr),i=r[0],n=r[1],o=r[2],a=r[3],s=(17===i.type?ei(i.number):Yr.parse(t,i))/(2*Math.PI),l=Nr(n)?n.number/100:0,c=Nr(o)?o.number/100:0,u=void 0!==a&&Nr(a)?qr(a,1):1;if(0===l)return oi(255*c,255*c,255*c,1);var h=c<=.5?c*(l+1):c+l-c*l,A=2*c-h,p=li(A,h,s+1/3),d=li(A,h,s),f=li(A,h,s-1/3);return oi(255*p,255*d,255*f,u)},ui={hsl:ci,hsla:ci,rgb:si,rgba:si},hi=function(t,e){return ri.parse(t,Mr.create(e).parseComponentValue())},Ai={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},pi={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(t,e){return e.map((function(t){if(Lr(t))switch(t.value){case"padding-box":return 1;case"content-box":return 2}return 0}))}},di={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},fi=function(t,e){var r=ri.parse(t,e[0]),i=e[1];return i&&Nr(i)?{color:r,stop:i}:{color:r,stop:null}},mi=function(t,e){var r=t[0],i=t[t.length-1];null===r.stop&&(r.stop=Hr),null===i.stop&&(i.stop=Gr);for(var n=[],o=0,a=0;a<t.length;a++){var s=t[a].stop;if(null!==s){var l=qr(s,e);l>o?n.push(l):n.push(o),o=l}else n.push(null)}var c=null;for(a=0;a<n.length;a++){var u=n[a];if(null===u)null===c&&(c=a);else if(null!==c){for(var h=a-c,A=(u-n[c-1])/(h+1),p=1;p<=h;p++)n[c+p-1]=A*p;c=null}}return t.map((function(t,r){return{color:t.color,stop:Math.max(Math.min(1,n[r]/e),0)}}))},gi=function(t,e,r){var i=e/2,n=r/2,o=qr(t[0],e)-i,a=n-qr(t[1],r);return(Math.atan2(a,o)+2*Math.PI)%(2*Math.PI)},_i=function(t,e,r){var i="number"==typeof t?t:gi(t,e,r),n=Math.abs(e*Math.sin(i))+Math.abs(r*Math.cos(i)),o=e/2,a=r/2,s=n/2,l=Math.sin(i-Math.PI/2)*s,c=Math.cos(i-Math.PI/2)*s;return[n,o-c,o+c,a-l,a+l]},yi=function(t,e){return Math.sqrt(t*t+e*e)},vi=function(t,e,r,i,n){return[[0,0],[0,e],[t,0],[t,e]].reduce((function(t,e){var o=e[0],a=e[1],s=yi(r-o,i-a);return(n?s<t.optimumDistance:s>t.optimumDistance)?{optimumCorner:e,optimumDistance:s}:t}),{optimumDistance:n?1/0:-1/0,optimumCorner:null}).optimumCorner},xi=function(t,e,r,i,n){var o=0,a=0;switch(t.size){case 0:0===t.shape?o=a=Math.min(Math.abs(e),Math.abs(e-i),Math.abs(r),Math.abs(r-n)):1===t.shape&&(o=Math.min(Math.abs(e),Math.abs(e-i)),a=Math.min(Math.abs(r),Math.abs(r-n)));break;case 2:if(0===t.shape)o=a=Math.min(yi(e,r),yi(e,r-n),yi(e-i,r),yi(e-i,r-n));else if(1===t.shape){var s=Math.min(Math.abs(r),Math.abs(r-n))/Math.min(Math.abs(e),Math.abs(e-i)),l=vi(i,n,e,r,!0),c=l[0],u=l[1];a=s*(o=yi(c-e,(u-r)/s))}break;case 1:0===t.shape?o=a=Math.max(Math.abs(e),Math.abs(e-i),Math.abs(r),Math.abs(r-n)):1===t.shape&&(o=Math.max(Math.abs(e),Math.abs(e-i)),a=Math.max(Math.abs(r),Math.abs(r-n)));break;case 3:if(0===t.shape)o=a=Math.max(yi(e,r),yi(e,r-n),yi(e-i,r),yi(e-i,r-n));else if(1===t.shape){s=Math.max(Math.abs(r),Math.abs(r-n))/Math.max(Math.abs(e),Math.abs(e-i));var h=vi(i,n,e,r,!1);c=h[0],u=h[1],a=s*(o=yi(c-e,(u-r)/s))}}return Array.isArray(t.size)&&(o=qr(t.size[0],i),a=2===t.size.length?qr(t.size[1],n):o),[o,a]},wi=function(t,e){var r=ei(180),i=[];return Rr(e).forEach((function(e,n){if(0===n){var o=e[0];if(20===o.type&&-1!==["top","left","right","bottom"].indexOf(o.value))return void(r=ti(e));if(Jr(o))return void(r=(Yr.parse(t,o)+ei(270))%ei(360))}var a=fi(t,e);i.push(a)})),{angle:r,stops:i,type:1}},bi=function(t,e){var r=ei(180),i=[],n=1,o=0,a=3,s=[];return Rr(e).forEach((function(e,r){var o=e[0];if(0===r){if(Lr(o)&&"linear"===o.value)return void(n=1);if(Lr(o)&&"radial"===o.value)return void(n=2)}if(18===o.type)if("from"===o.name){var a=ri.parse(t,o.values[0]);i.push({stop:Hr,color:a})}else if("to"===o.name)a=ri.parse(t,o.values[0]),i.push({stop:Gr,color:a});else if("color-stop"===o.name){var s=o.values.filter(zr);if(2===s.length){a=ri.parse(t,s[1]);var l=s[0];Pr(l)&&i.push({stop:{type:16,number:100*l.number,flags:l.flags},color:a})}}})),1===n?{angle:(r+ei(180))%ei(360),stops:i,type:n}:{size:a,shape:o,stops:i,position:s,type:n}},Bi="closest-side",Ci="farthest-side",Ei="closest-corner",Ti="farthest-corner",Ii="circle",Si="ellipse",Mi="cover",Fi="contain",Pi=function(t,e){var r=0,i=3,n=[],o=[];return Rr(e).forEach((function(e,a){var s=!0;if(0===a?s=e.reduce((function(t,e){if(Lr(e))switch(e.value){case"center":return o.push(jr),!1;case"top":case"left":return o.push(Hr),!1;case"right":case"bottom":return o.push(Gr),!1}else if(Nr(e)||Qr(e))return o.push(e),!1;return t}),s):1===a&&(s=e.reduce((function(t,e){if(Lr(e))switch(e.value){case Ii:return r=0,!1;case Si:return r=1,!1;case Fi:case Bi:return i=0,!1;case Ci:return i=1,!1;case Ei:return i=2,!1;case Mi:case Ti:return i=3,!1}else if(Qr(e)||Nr(e))return Array.isArray(i)||(i=[]),i.push(e),!1;return t}),s)),s){var l=fi(t,e);n.push(l)}})),{size:i,shape:r,stops:n,position:o,type:2}},Li=function(t){return 1===t.type},Di=function(t){return 2===t.type},Ui={name:"image",parse:function(t,e){if(22===e.type){var r={url:e.value,type:0};return t.cache.addImage(e.value),r}if(18===e.type){var i=Ri[e.name];if(void 0===i)throw new Error('Attempting to parse an unsupported image function "'+e.name+'"');return i(t,e.values)}throw new Error("Unsupported image type "+e.type)}};function ki(t){return!(20===t.type&&"none"===t.value||18===t.type&&!Ri[t.name])}var zi,Ri={"linear-gradient":function(t,e){var r=ei(180),i=[];return Rr(e).forEach((function(e,n){if(0===n){var o=e[0];if(20===o.type&&"to"===o.value)return void(r=ti(e));if(Jr(o))return void(r=Yr.parse(t,o))}var a=fi(t,e);i.push(a)})),{angle:r,stops:i,type:1}},"-moz-linear-gradient":wi,"-ms-linear-gradient":wi,"-o-linear-gradient":wi,"-webkit-linear-gradient":wi,"radial-gradient":function(t,e){var r=0,i=3,n=[],o=[];return Rr(e).forEach((function(e,a){var s=!0;if(0===a){var l=!1;s=e.reduce((function(t,e){if(l)if(Lr(e))switch(e.value){case"center":return o.push(jr),t;case"top":case"left":return o.push(Hr),t;case"right":case"bottom":return o.push(Gr),t}else(Nr(e)||Qr(e))&&o.push(e);else if(Lr(e))switch(e.value){case Ii:return r=0,!1;case Si:return r=1,!1;case"at":return l=!0,!1;case Bi:return i=0,!1;case Mi:case Ci:return i=1,!1;case Fi:case Ei:return i=2,!1;case Ti:return i=3,!1}else if(Qr(e)||Nr(e))return Array.isArray(i)||(i=[]),i.push(e),!1;return t}),s)}if(s){var c=fi(t,e);n.push(c)}})),{size:i,shape:r,stops:n,position:o,type:2}},"-moz-radial-gradient":Pi,"-ms-radial-gradient":Pi,"-o-radial-gradient":Pi,"-webkit-radial-gradient":Pi,"-webkit-gradient":bi},Oi={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(t,e){if(0===e.length)return[];var r=e[0];return 20===r.type&&"none"===r.value?[]:e.filter((function(t){return zr(t)&&ki(t)})).map((function(e){return Ui.parse(t,e)}))}},Qi={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(t,e){return e.map((function(t){if(Lr(t))switch(t.value){case"padding-box":return 1;case"content-box":return 2}return 0}))}},Ni={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(t,e){return Rr(e).map((function(t){return t.filter(Nr)})).map(Vr)}},Vi={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(t,e){return Rr(e).map((function(t){return t.filter(Lr).map((function(t){return t.value})).join(" ")})).map(Hi)}},Hi=function(t){switch(t){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;default:return 0}};!function(t){t.AUTO="auto",t.CONTAIN="contain",t.COVER="cover"}(zi||(zi={}));var ji,Gi={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(t,e){return Rr(e).map((function(t){return t.filter(Ki)}))}},Ki=function(t){return Lr(t)||Nr(t)},qi=function(t){return{name:"border-"+t+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},Zi=qi("top"),Wi=qi("right"),Xi=qi("bottom"),$i=qi("left"),Yi=function(t){return{name:"border-radius-"+t,initialValue:"0 0",prefix:!1,type:1,parse:function(t,e){return Vr(e.filter(Nr))}}},Ji=Yi("top-left"),tn=Yi("top-right"),en=Yi("bottom-right"),rn=Yi("bottom-left"),nn=function(t){return{name:"border-"+t+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(t,e){switch(e){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},on=nn("top"),an=nn("right"),sn=nn("bottom"),ln=nn("left"),cn=function(t){return{name:"border-"+t+"-width",initialValue:"0",type:0,prefix:!1,parse:function(t,e){return Fr(e)?e.number:0}}},un=cn("top"),hn=cn("right"),An=cn("bottom"),pn=cn("left"),dn={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},fn={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(t,e){return"rtl"===e?1:0}},mn={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(t,e){return e.filter(Lr).reduce((function(t,e){return t|gn(e.value)}),0)}},gn=function(t){switch(t){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},_n={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(t,e){switch(e){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},yn={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(t,e){return 20===e.type&&"normal"===e.value?0:17===e.type||15===e.type?e.number:0}};!function(t){t.NORMAL="normal",t.STRICT="strict"}(ji||(ji={}));var vn,xn={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(t,e){return"strict"===e?ji.STRICT:ji.NORMAL}},wn={name:"line-height",initialValue:"normal",prefix:!1,type:4},bn=function(t,e){return Lr(t)&&"normal"===t.value?1.2*e:17===t.type?e*t.number:Nr(t)?qr(t,e):e},Bn={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(t,e){return 20===e.type&&"none"===e.value?null:Ui.parse(t,e)}},Cn={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(t,e){return"inside"===e?0:1}},En={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(t,e){switch(e){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;default:return-1}}},Tn=function(t){return{name:"margin-"+t,initialValue:"0",prefix:!1,type:4}},In=Tn("top"),Sn=Tn("right"),Mn=Tn("bottom"),Fn=Tn("left"),Pn={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(t,e){return e.filter(Lr).map((function(t){switch(t.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;default:return 0}}))}},Ln={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(t,e){return"break-word"===e?"break-word":"normal"}},Dn=function(t){return{name:"padding-"+t,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},Un=Dn("top"),kn=Dn("right"),zn=Dn("bottom"),Rn=Dn("left"),On={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(t,e){switch(e){case"right":return 2;case"center":case"justify":return 1;default:return 0}}},Qn={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(t,e){switch(e){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},Nn={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(t,e){return 1===e.length&&Ur(e[0],"none")?[]:Rr(e).map((function(e){for(var r={color:Ai.TRANSPARENT,offsetX:Hr,offsetY:Hr,blur:Hr},i=0,n=0;n<e.length;n++){var o=e[n];Qr(o)?(0===i?r.offsetX=o:1===i?r.offsetY=o:r.blur=o,i++):r.color=ri.parse(t,o)}return r}))}},Vn={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(t,e){switch(e){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},Hn={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(t,e){if(20===e.type&&"none"===e.value)return null;if(18===e.type){var r=jn[e.name];if(void 0===r)throw new Error('Attempting to parse an unsupported transform function "'+e.name+'"');return r(e.values)}return null}},jn={matrix:function(t){var e=t.filter((function(t){return 17===t.type})).map((function(t){return t.number}));return 6===e.length?e:null},matrix3d:function(t){var e=t.filter((function(t){return 17===t.type})).map((function(t){return t.number})),r=e[0],i=e[1];e[2],e[3];var n=e[4],o=e[5];e[6],e[7],e[8],e[9],e[10],e[11];var a=e[12],s=e[13];return e[14],e[15],16===e.length?[r,i,n,o,a,s]:null}},Gn={type:16,number:50,flags:Gt},Kn=[Gn,Gn],qn={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(t,e){var r=e.filter(Nr);return 2!==r.length?Kn:[r[0],r[1]]}},Zn={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(t,e){switch(e){case"hidden":return 1;case"collapse":return 2;default:return 0}}};!function(t){t.NORMAL="normal",t.BREAK_ALL="break-all",t.KEEP_ALL="keep-all"}(vn||(vn={}));for(var Wn={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(t,e){switch(e){case"break-all":return vn.BREAK_ALL;case"keep-all":return vn.KEEP_ALL;default:return vn.NORMAL}}},Xn={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(t,e){if(20===e.type)return{auto:!0,order:0};if(Pr(e))return{auto:!1,order:e.number};throw new Error("Invalid z-index number parsed")}},$n={name:"time",parse:function(t,e){if(15===e.type)switch(e.unit.toLowerCase()){case"s":return 1e3*e.number;case"ms":return e.number}throw new Error("Unsupported time type")}},Yn={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(t,e){return Pr(e)?e.number:1}},Jn={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},to={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(t,e){return e.filter(Lr).map((function(t){switch(t.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0})).filter((function(t){return 0!==t}))}},eo={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(t,e){var r=[],i=[];return e.forEach((function(t){switch(t.type){case 20:case 0:r.push(t.value);break;case 17:r.push(t.number.toString());break;case 4:i.push(r.join(" ")),r.length=0}})),r.length&&i.push(r.join(" ")),i.map((function(t){return-1===t.indexOf(" ")?t:"'"+t+"'"}))}},ro={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},io={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(t,e){return Pr(e)?e.number:Lr(e)&&"bold"===e.value?700:400}},no={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(t,e){return e.filter(Lr).map((function(t){return t.value}))}},oo={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(t,e){switch(e){case"oblique":return"oblique";case"italic":return"italic";default:return"normal"}}},ao=function(t,e){return!!(t&e)},so={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(t,e){if(0===e.length)return[];var r=e[0];return 20===r.type&&"none"===r.value?[]:e}},lo={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(t,e){if(0===e.length)return null;var r=e[0];if(20===r.type&&"none"===r.value)return null;for(var i=[],n=e.filter(kr),o=0;o<n.length;o++){var a=n[o],s=n[o+1];if(20===a.type){var l=s&&Pr(s)?s.number:1;i.push({counter:a.value,increment:l})}}return i}},co={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(t,e){if(0===e.length)return[];for(var r=[],i=e.filter(kr),n=0;n<i.length;n++){var o=i[n],a=i[n+1];if(Lr(o)&&"none"!==o.value){var s=a&&Pr(a)?a.number:0;r.push({counter:o.value,reset:s})}}return r}},uo={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(t,e){return e.filter(Fr).map((function(e){return $n.parse(t,e)}))}},ho={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(t,e){if(0===e.length)return null;var r=e[0];if(20===r.type&&"none"===r.value)return null;var i=[],n=e.filter(Dr);if(n.length%2!=0)return null;for(var o=0;o<n.length;o+=2){var a=n[o].value,s=n[o+1].value;i.push({open:a,close:s})}return i}},Ao=function(t,e,r){if(!t)return"";var i=t[Math.min(e,t.length-1)];return i?r?i.open:i.close:""},po={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(t,e){return 1===e.length&&Ur(e[0],"none")?[]:Rr(e).map((function(e){for(var r={color:255,offsetX:Hr,offsetY:Hr,blur:Hr,spread:Hr,inset:!1},i=0,n=0;n<e.length;n++){var o=e[n];Ur(o,"inset")?r.inset=!0:Qr(o)?(0===i?r.offsetX=o:1===i?r.offsetY=o:2===i?r.blur=o:r.spread=o,i++):r.color=ri.parse(t,o)}return r}))}},fo={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(t,e){var r=[0,1,2],i=[];return e.filter(Lr).forEach((function(t){switch(t.value){case"stroke":i.push(1);break;case"fill":i.push(0);break;case"markers":i.push(2)}})),r.forEach((function(t){-1===i.indexOf(t)&&i.push(t)})),i}},mo={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},go={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(t,e){return Fr(e)?e.number:0}},_o=function(){function t(t,e){var r,i;this.animationDuration=xo(t,uo,e.animationDuration),this.backgroundClip=xo(t,pi,e.backgroundClip),this.backgroundColor=xo(t,di,e.backgroundColor),this.backgroundImage=xo(t,Oi,e.backgroundImage),this.backgroundOrigin=xo(t,Qi,e.backgroundOrigin),this.backgroundPosition=xo(t,Ni,e.backgroundPosition),this.backgroundRepeat=xo(t,Vi,e.backgroundRepeat),this.backgroundSize=xo(t,Gi,e.backgroundSize),this.borderTopColor=xo(t,Zi,e.borderTopColor),this.borderRightColor=xo(t,Wi,e.borderRightColor),this.borderBottomColor=xo(t,Xi,e.borderBottomColor),this.borderLeftColor=xo(t,$i,e.borderLeftColor),this.borderTopLeftRadius=xo(t,Ji,e.borderTopLeftRadius),this.borderTopRightRadius=xo(t,tn,e.borderTopRightRadius),this.borderBottomRightRadius=xo(t,en,e.borderBottomRightRadius),this.borderBottomLeftRadius=xo(t,rn,e.borderBottomLeftRadius),this.borderTopStyle=xo(t,on,e.borderTopStyle),this.borderRightStyle=xo(t,an,e.borderRightStyle),this.borderBottomStyle=xo(t,sn,e.borderBottomStyle),this.borderLeftStyle=xo(t,ln,e.borderLeftStyle),this.borderTopWidth=xo(t,un,e.borderTopWidth),this.borderRightWidth=xo(t,hn,e.borderRightWidth),this.borderBottomWidth=xo(t,An,e.borderBottomWidth),this.borderLeftWidth=xo(t,pn,e.borderLeftWidth),this.boxShadow=xo(t,po,e.boxShadow),this.color=xo(t,dn,e.color),this.direction=xo(t,fn,e.direction),this.display=xo(t,mn,e.display),this.float=xo(t,_n,e.cssFloat),this.fontFamily=xo(t,eo,e.fontFamily),this.fontSize=xo(t,ro,e.fontSize),this.fontStyle=xo(t,oo,e.fontStyle),this.fontVariant=xo(t,no,e.fontVariant),this.fontWeight=xo(t,io,e.fontWeight),this.letterSpacing=xo(t,yn,e.letterSpacing),this.lineBreak=xo(t,xn,e.lineBreak),this.lineHeight=xo(t,wn,e.lineHeight),this.listStyleImage=xo(t,Bn,e.listStyleImage),this.listStylePosition=xo(t,Cn,e.listStylePosition),this.listStyleType=xo(t,En,e.listStyleType),this.marginTop=xo(t,In,e.marginTop),this.marginRight=xo(t,Sn,e.marginRight),this.marginBottom=xo(t,Mn,e.marginBottom),this.marginLeft=xo(t,Fn,e.marginLeft),this.opacity=xo(t,Yn,e.opacity);var n=xo(t,Pn,e.overflow);this.overflowX=n[0],this.overflowY=n[n.length>1?1:0],this.overflowWrap=xo(t,Ln,e.overflowWrap),this.paddingTop=xo(t,Un,e.paddingTop),this.paddingRight=xo(t,kn,e.paddingRight),this.paddingBottom=xo(t,zn,e.paddingBottom),this.paddingLeft=xo(t,Rn,e.paddingLeft),this.paintOrder=xo(t,fo,e.paintOrder),this.position=xo(t,Qn,e.position),this.textAlign=xo(t,On,e.textAlign),this.textDecorationColor=xo(t,Jn,null!==(r=e.textDecorationColor)&&void 0!==r?r:e.color),this.textDecorationLine=xo(t,to,null!==(i=e.textDecorationLine)&&void 0!==i?i:e.textDecoration),this.textShadow=xo(t,Nn,e.textShadow),this.textTransform=xo(t,Vn,e.textTransform),this.transform=xo(t,Hn,e.transform),this.transformOrigin=xo(t,qn,e.transformOrigin),this.visibility=xo(t,Zn,e.visibility),this.webkitTextStrokeColor=xo(t,mo,e.webkitTextStrokeColor),this.webkitTextStrokeWidth=xo(t,go,e.webkitTextStrokeWidth),this.wordBreak=xo(t,Wn,e.wordBreak),this.zIndex=xo(t,Xn,e.zIndex)}return t.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&0===this.visibility},t.prototype.isTransparent=function(){return ii(this.backgroundColor)},t.prototype.isTransformed=function(){return null!==this.transform},t.prototype.isPositioned=function(){return 0!==this.position},t.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},t.prototype.isFloating=function(){return 0!==this.float},t.prototype.isInlineLevel=function(){return ao(this.display,4)||ao(this.display,33554432)||ao(this.display,268435456)||ao(this.display,536870912)||ao(this.display,67108864)||ao(this.display,134217728)},t}(),yo=function(){function t(t,e){this.content=xo(t,so,e.content),this.quotes=xo(t,ho,e.quotes)}return t}(),vo=function(){function t(t,e){this.counterIncrement=xo(t,lo,e.counterIncrement),this.counterReset=xo(t,co,e.counterReset)}return t}(),xo=function(t,e,r){var i=new Sr,n=null!=r?r.toString():e.initialValue;i.write(n);var o=new Mr(i.read());switch(e.type){case 2:var a=o.parseComponentValue();return e.parse(t,Lr(a)?a.value:e.initialValue);case 0:return e.parse(t,o.parseComponentValue());case 1:return e.parse(t,o.parseComponentValues());case 4:return o.parseComponentValue();case 3:switch(e.format){case"angle":return Yr.parse(t,o.parseComponentValue());case"color":return ri.parse(t,o.parseComponentValue());case"image":return Ui.parse(t,o.parseComponentValue());case"length":var s=o.parseComponentValue();return Qr(s)?s:Hr;case"length-percentage":var l=o.parseComponentValue();return Nr(l)?l:Hr;case"time":return $n.parse(t,o.parseComponentValue())}}},wo="data-html2canvas-debug",bo=function(t){switch(t.getAttribute(wo)){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},Bo=function(t,e){var r=bo(t);return 1===r||e===r},Co=function(){function t(t,e){this.context=t,this.textNodes=[],this.elements=[],this.flags=0,Bo(e,3),this.styles=new _o(t,window.getComputedStyle(e,null)),As(e)&&(this.styles.animationDuration.some((function(t){return t>0}))&&(e.style.animationDuration="0s"),null!==this.styles.transform&&(e.style.transform="none")),this.bounds=s(this.context,e),Bo(e,4)&&(this.flags|=16)}return t}(),Eo="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",To="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Io="undefined"==typeof Uint8Array?[]:new Uint8Array(256),So=0;So<To.length;So++)Io[To.charCodeAt(So)]=So;for(var Mo=function(t){var e,r,i,n,o,a=.75*t.length,s=t.length,l=0;"="===t[t.length-1]&&(a--,"="===t[t.length-2]&&a--);var c="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.slice?new ArrayBuffer(a):new Array(a),u=Array.isArray(c)?c:new Uint8Array(c);for(e=0;e<s;e+=4)r=Io[t.charCodeAt(e)],i=Io[t.charCodeAt(e+1)],n=Io[t.charCodeAt(e+2)],o=Io[t.charCodeAt(e+3)],u[l++]=r<<2|i>>4,u[l++]=(15&i)<<4|n>>2,u[l++]=(3&n)<<6|63&o;return c},Fo=function(t){for(var e=t.length,r=[],i=0;i<e;i+=2)r.push(t[i+1]<<8|t[i]);return r},Po=function(t){for(var e=t.length,r=[],i=0;i<e;i+=4)r.push(t[i+3]<<24|t[i+2]<<16|t[i+1]<<8|t[i]);return r},Lo=5,Do=11,Uo=2,ko=65536>>Lo,zo=(1<<Lo)-1,Ro=ko+(1024>>Lo)+32,Oo=65536>>Do,Qo=(1<<Do-Lo)-1,No=function(t,e,r){return t.slice?t.slice(e,r):new Uint16Array(Array.prototype.slice.call(t,e,r))},Vo=function(t,e,r){return t.slice?t.slice(e,r):new Uint32Array(Array.prototype.slice.call(t,e,r))},Ho=function(t,e){var r=Mo(t),i=Array.isArray(r)?Po(r):new Uint32Array(r),n=Array.isArray(r)?Fo(r):new Uint16Array(r),o=24,a=No(n,o/2,i[4]/2),s=2===i[5]?No(n,(o+i[4])/2):Vo(i,Math.ceil((o+i[4])/4));return new jo(i[0],i[1],i[2],i[3],a,s)},jo=function(){function t(t,e,r,i,n,o){this.initialValue=t,this.errorValue=e,this.highStart=r,this.highValueIndex=i,this.index=n,this.data=o}return t.prototype.get=function(t){var e;if(t>=0){if(t<55296||t>56319&&t<=65535)return e=((e=this.index[t>>Lo])<<Uo)+(t&zo),this.data[e];if(t<=65535)return e=((e=this.index[ko+(t-55296>>Lo)])<<Uo)+(t&zo),this.data[e];if(t<this.highStart)return e=Ro-Oo+(t>>Do),e=this.index[e],e+=t>>Lo&Qo,e=((e=this.index[e])<<Uo)+(t&zo),this.data[e];if(t<=1114111)return this.data[this.highValueIndex]}return this.errorValue},t}(),Go="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ko="undefined"==typeof Uint8Array?[]:new Uint8Array(256),qo=0;qo<Go.length;qo++)Ko[Go.charCodeAt(qo)]=qo;var Zo,Wo=1,Xo=2,$o=3,Yo=4,Jo=5,ta=7,ea=8,ra=9,ia=10,na=11,oa=12,aa=13,sa=14,la=15,ca=function(t){for(var e=[],r=0,i=t.length;r<i;){var n=t.charCodeAt(r++);if(n>=55296&&n<=56319&&r<i){var o=t.charCodeAt(r++);56320==(64512&o)?e.push(((1023&n)<<10)+(1023&o)+65536):(e.push(n),r--)}else e.push(n)}return e},ua=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,t);var r=t.length;if(!r)return"";for(var i=[],n=-1,o="";++n<r;){var a=t[n];a<=65535?i.push(a):(a-=65536,i.push(55296+(a>>10),a%1024+56320)),(n+1===r||i.length>16384)&&(o+=String.fromCharCode.apply(String,i),i.length=0)}return o},ha=Ho(Eo),Aa="×",pa="÷",da=function(t){return ha.get(t)},fa=function(t,e,r){var i=r-2,n=e[i],o=e[r-1],a=e[r];if(o===Xo&&a===$o)return Aa;if(o===Xo||o===$o||o===Yo)return pa;if(a===Xo||a===$o||a===Yo)return pa;if(o===ea&&-1!==[ea,ra,na,oa].indexOf(a))return Aa;if(!(o!==na&&o!==ra||a!==ra&&a!==ia))return Aa;if((o===oa||o===ia)&&a===ia)return Aa;if(a===aa||a===Jo)return Aa;if(a===ta)return Aa;if(o===Wo)return Aa;if(o===aa&&a===sa){for(;n===Jo;)n=e[--i];if(n===sa)return Aa}if(o===la&&a===la){for(var s=0;n===la;)s++,n=e[--i];if(s%2==0)return Aa}return pa},ma=function(t){var e=ca(t),r=e.length,i=0,n=0,o=e.map(da);return{next:function(){if(i>=r)return{done:!0,value:null};for(var t=Aa;i<r&&(t=fa(e,o,++i))===Aa;);if(t!==Aa||i===r){var a=ua.apply(null,e.slice(n,i));return n=i,{value:a,done:!1}}return{done:!0,value:null}}}},ga=function(t){for(var e,r=ma(t),i=[];!(e=r.next()).done;)e.value&&i.push(e.value.slice());return i},_a=function(t){var e=123;if(t.createRange){var r=t.createRange();if(r.getBoundingClientRect){var i=t.createElement("boundtest");i.style.height=e+"px",i.style.display="block",t.body.appendChild(i),r.selectNode(i);var n=r.getBoundingClientRect(),o=Math.round(n.height);if(t.body.removeChild(i),o===e)return!0}}return!1},ya=function(t){var e=t.createElement("boundtest");e.style.width="50px",e.style.display="block",e.style.fontSize="12px",e.style.letterSpacing="0px",e.style.wordSpacing="0px",t.body.appendChild(e);var r=t.createRange();e.innerHTML="function"==typeof"".repeat?"&#128104;".repeat(10):"";var i=e.firstChild,n=c(i.data).map((function(t){return u(t)})),o=0,a={},s=n.every((function(t,e){r.setStart(i,o),r.setEnd(i,o+t.length);var n=r.getBoundingClientRect();o+=t.length;var s=n.x>a.x||n.y>a.y;return a=n,0===e||s}));return t.body.removeChild(e),s},va=function(){return void 0!==(new Image).crossOrigin},xa=function(){return"string"==typeof(new XMLHttpRequest).responseType},wa=function(t){var e=new Image,r=t.createElement("canvas"),i=r.getContext("2d");if(!i)return!1;e.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{i.drawImage(e,0,0),r.toDataURL()}catch(t){return!1}return!0},ba=function(t){return 0===t[0]&&255===t[1]&&0===t[2]&&255===t[3]},Ba=function(t){var e=t.createElement("canvas"),r=100;e.width=r,e.height=r;var i=e.getContext("2d");if(!i)return Promise.reject(!1);i.fillStyle="rgb(0, 255, 0)",i.fillRect(0,0,r,r);var n=new Image,o=e.toDataURL();n.src=o;var a=Ca(r,r,0,0,n);return i.fillStyle="red",i.fillRect(0,0,r,r),Ea(a).then((function(e){i.drawImage(e,0,0);var n=i.getImageData(0,0,r,r).data;i.fillStyle="red",i.fillRect(0,0,r,r);var a=t.createElement("div");return a.style.backgroundImage="url("+o+")",a.style.height=r+"px",ba(n)?Ea(Ca(r,r,0,0,a)):Promise.reject(!1)})).then((function(t){return i.drawImage(t,0,0),ba(i.getImageData(0,0,r,r).data)})).catch((function(){return!1}))},Ca=function(t,e,r,i,n){var o="http://www.w3.org/2000/svg",a=document.createElementNS(o,"svg"),s=document.createElementNS(o,"foreignObject");return a.setAttributeNS(null,"width",t.toString()),a.setAttributeNS(null,"height",e.toString()),s.setAttributeNS(null,"width","100%"),s.setAttributeNS(null,"height","100%"),s.setAttributeNS(null,"x",r.toString()),s.setAttributeNS(null,"y",i.toString()),s.setAttributeNS(null,"externalResourcesRequired","true"),a.appendChild(s),s.appendChild(n),a},Ea=function(t){return new Promise((function(e,r){var i=new Image;i.onload=function(){return e(i)},i.onerror=r,i.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(t))}))},Ta={get SUPPORT_RANGE_BOUNDS(){var t=_a(document);return Object.defineProperty(Ta,"SUPPORT_RANGE_BOUNDS",{value:t}),t},get SUPPORT_WORD_BREAKING(){var t=Ta.SUPPORT_RANGE_BOUNDS&&ya(document);return Object.defineProperty(Ta,"SUPPORT_WORD_BREAKING",{value:t}),t},get SUPPORT_SVG_DRAWING(){var t=wa(document);return Object.defineProperty(Ta,"SUPPORT_SVG_DRAWING",{value:t}),t},get SUPPORT_FOREIGNOBJECT_DRAWING(){var t="function"==typeof Array.from&&"function"==typeof window.fetch?Ba(document):Promise.resolve(!1);return Object.defineProperty(Ta,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:t}),t},get SUPPORT_CORS_IMAGES(){var t=va();return Object.defineProperty(Ta,"SUPPORT_CORS_IMAGES",{value:t}),t},get SUPPORT_RESPONSE_TYPE(){var t=xa();return Object.defineProperty(Ta,"SUPPORT_RESPONSE_TYPE",{value:t}),t},get SUPPORT_CORS_XHR(){var t="withCredentials"in new XMLHttpRequest;return Object.defineProperty(Ta,"SUPPORT_CORS_XHR",{value:t}),t},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var t=!("undefined"==typeof Intl||!Intl.Segmenter);return Object.defineProperty(Ta,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:t}),t}},Ia=function(){function t(t,e){this.text=t,this.bounds=e}return t}(),Sa=function(t,e,r,i){var n=Da(e,r),o=[],s=0;return n.forEach((function(e){if(r.textDecorationLine.length||e.trim().length>0)if(Ta.SUPPORT_RANGE_BOUNDS){var n=Fa(i,s,e.length).getClientRects();if(n.length>1){var l=Pa(e),c=0;l.forEach((function(e){o.push(new Ia(e,a.fromDOMRectList(t,Fa(i,c+s,e.length).getClientRects()))),c+=e.length}))}else o.push(new Ia(e,a.fromDOMRectList(t,n)))}else{var u=i.splitText(e.length);o.push(new Ia(e,Ma(t,i))),i=u}else Ta.SUPPORT_RANGE_BOUNDS||(i=i.splitText(e.length));s+=e.length})),o},Ma=function(t,e){var r=e.ownerDocument;if(r){var i=r.createElement("html2canvaswrapper");i.appendChild(e.cloneNode(!0));var n=e.parentNode;if(n){n.replaceChild(i,e);var o=s(t,i);return i.firstChild&&n.replaceChild(i.firstChild,i),o}}return a.EMPTY},Fa=function(t,e,r){var i=t.ownerDocument;if(!i)throw new Error("Node has no owner document");var n=i.createRange();return n.setStart(t,e),n.setEnd(t,e+r),n},Pa=function(t){if(Ta.SUPPORT_NATIVE_TEXT_SEGMENTATION){var e=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(e.segment(t)).map((function(t){return t.segment}))}return ga(t)},La=function(t,e){if(Ta.SUPPORT_NATIVE_TEXT_SEGMENTATION){var r=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(r.segment(t)).map((function(t){return t.segment}))}return ka(t,e)},Da=function(t,e){return 0!==e.letterSpacing?Pa(t):La(t,e)},Ua=[32,160,4961,65792,65793,4153,4241],ka=function(t,e){for(var r,i=Vt(t,{lineBreak:e.lineBreak,wordBreak:"break-word"===e.overflowWrap?"break-word":e.wordBreak}),n=[],o=function(){if(r.value){var t=r.value.slice(),e=c(t),i="";e.forEach((function(t){-1===Ua.indexOf(t)?i+=u(t):(i.length&&n.push(i),n.push(u(t)),i="")})),i.length&&n.push(i)}};!(r=i.next()).done;)o();return n},za=function(){function t(t,e,r){this.text=Ra(e.data,r.textTransform),this.textBounds=Sa(t,this.text,r,e)}return t}(),Ra=function(t,e){switch(e){case 1:return t.toLowerCase();case 3:return t.replace(Oa,Qa);case 2:return t.toUpperCase();default:return t}},Oa=/(^|\s|:|-|\(|\))([a-z])/g,Qa=function(t,e,r){return t.length>0?e+r.toUpperCase():t},Na=function(t){function r(e,r){var i=t.call(this,e,r)||this;return i.src=r.currentSrc||r.src,i.intrinsicWidth=r.naturalWidth,i.intrinsicHeight=r.naturalHeight,i.context.cache.addImage(i.src),i}return e(r,t),r}(Co),Va=function(t){function r(e,r){var i=t.call(this,e,r)||this;return i.canvas=r,i.intrinsicWidth=r.width,i.intrinsicHeight=r.height,i}return e(r,t),r}(Co),Ha=function(t){function r(e,r){var i=t.call(this,e,r)||this,n=new XMLSerializer,o=s(e,r);return r.setAttribute("width",o.width+"px"),r.setAttribute("height",o.height+"px"),i.svg="data:image/svg+xml,"+encodeURIComponent(n.serializeToString(r)),i.intrinsicWidth=r.width.baseVal.value,i.intrinsicHeight=r.height.baseVal.value,i.context.cache.addImage(i.svg),i}return e(r,t),r}(Co),ja=function(t){function r(e,r){var i=t.call(this,e,r)||this;return i.value=r.value,i}return e(r,t),r}(Co),Ga=function(t){function r(e,r){var i=t.call(this,e,r)||this;return i.start=r.start,i.reversed="boolean"==typeof r.reversed&&!0===r.reversed,i}return e(r,t),r}(Co),Ka=[{type:15,flags:0,unit:"px",number:3}],qa=[{type:16,flags:0,number:50}],Za=function(t){return t.width>t.height?new a(t.left+(t.width-t.height)/2,t.top,t.height,t.height):t.width<t.height?new a(t.left,t.top+(t.height-t.width)/2,t.width,t.width):t},Wa=function(t){var e=t.type===Ya?new Array(t.value.length+1).join("•"):t.value;return 0===e.length?t.placeholder||"":e},Xa="checkbox",$a="radio",Ya="password",Ja=707406591,ts=function(t){function r(e,r){var i=t.call(this,e,r)||this;switch(i.type=r.type.toLowerCase(),i.checked=r.checked,i.value=Wa(r),i.type!==Xa&&i.type!==$a||(i.styles.backgroundColor=3739148031,i.styles.borderTopColor=i.styles.borderRightColor=i.styles.borderBottomColor=i.styles.borderLeftColor=2779096575,i.styles.borderTopWidth=i.styles.borderRightWidth=i.styles.borderBottomWidth=i.styles.borderLeftWidth=1,i.styles.borderTopStyle=i.styles.borderRightStyle=i.styles.borderBottomStyle=i.styles.borderLeftStyle=1,i.styles.backgroundClip=[0],i.styles.backgroundOrigin=[0],i.bounds=Za(i.bounds)),i.type){case Xa:i.styles.borderTopRightRadius=i.styles.borderTopLeftRadius=i.styles.borderBottomRightRadius=i.styles.borderBottomLeftRadius=Ka;break;case $a:i.styles.borderTopRightRadius=i.styles.borderTopLeftRadius=i.styles.borderBottomRightRadius=i.styles.borderBottomLeftRadius=qa}return i}return e(r,t),r}(Co),es=function(t){function r(e,r){var i=t.call(this,e,r)||this,n=r.options[r.selectedIndex||0];return i.value=n&&n.text||"",i}return e(r,t),r}(Co),rs=function(t){function r(e,r){var i=t.call(this,e,r)||this;return i.value=r.value,i}return e(r,t),r}(Co),is=function(t){function r(e,r){var i=t.call(this,e,r)||this;i.src=r.src,i.width=parseInt(r.width,10)||0,i.height=parseInt(r.height,10)||0,i.backgroundColor=i.styles.backgroundColor;try{if(r.contentWindow&&r.contentWindow.document&&r.contentWindow.document.documentElement){i.tree=ss(e,r.contentWindow.document.documentElement);var n=r.contentWindow.document.documentElement?hi(e,getComputedStyle(r.contentWindow.document.documentElement).backgroundColor):Ai.TRANSPARENT,o=r.contentWindow.document.body?hi(e,getComputedStyle(r.contentWindow.document.body).backgroundColor):Ai.TRANSPARENT;i.backgroundColor=ii(n)?ii(o)?i.styles.backgroundColor:o:n}}catch(t){}return i}return e(r,t),r}(Co),ns=["OL","UL","MENU"],os=function t(e,r,i,n){for(var o=r.firstChild,a=void 0;o;o=a)if(a=o.nextSibling,us(o)&&o.data.trim().length>0)i.textNodes.push(new za(e,o,i.styles));else if(hs(o))if(Is(o)&&o.assignedNodes)o.assignedNodes().forEach((function(r){return t(e,r,i,n)}));else{var s=as(e,o);s.styles.isVisible()&&(ls(o,s,n)?s.flags|=4:cs(s.styles)&&(s.flags|=2),-1!==ns.indexOf(o.tagName)&&(s.flags|=8),i.elements.push(s),o.slot,o.shadowRoot?t(e,o.shadowRoot,s,n):Es(o)||_s(o)||Ts(o)||t(e,o,s,n))}},as=function(t,e){return ws(e)?new Na(t,e):vs(e)?new Va(t,e):_s(e)?new Ha(t,e):ds(e)?new ja(t,e):fs(e)?new Ga(t,e):ms(e)?new ts(t,e):Ts(e)?new es(t,e):Es(e)?new rs(t,e):bs(e)?new is(t,e):new Co(t,e)},ss=function(t,e){var r=as(t,e);return r.flags|=4,os(t,e,r,r),r},ls=function(t,e,r){return e.styles.isPositionedWithZIndex()||e.styles.opacity<1||e.styles.isTransformed()||ys(t)&&r.styles.isTransparent()},cs=function(t){return t.isPositioned()||t.isFloating()},us=function(t){return t.nodeType===Node.TEXT_NODE},hs=function(t){return t.nodeType===Node.ELEMENT_NODE},As=function(t){return hs(t)&&void 0!==t.style&&!ps(t)},ps=function(t){return"object"===Ze(t.className)},ds=function(t){return"LI"===t.tagName},fs=function(t){return"OL"===t.tagName},ms=function(t){return"INPUT"===t.tagName},gs=function(t){return"HTML"===t.tagName},_s=function(t){return"svg"===t.tagName},ys=function(t){return"BODY"===t.tagName},vs=function(t){return"CANVAS"===t.tagName},xs=function(t){return"VIDEO"===t.tagName},ws=function(t){return"IMG"===t.tagName},bs=function(t){return"IFRAME"===t.tagName},Bs=function(t){return"STYLE"===t.tagName},Cs=function(t){return"SCRIPT"===t.tagName},Es=function(t){return"TEXTAREA"===t.tagName},Ts=function(t){return"SELECT"===t.tagName},Is=function(t){return"SLOT"===t.tagName},Ss=function(t){return t.tagName.indexOf("-")>0},Ms=function(){function t(){this.counters={}}return t.prototype.getCounterValue=function(t){var e=this.counters[t];return e&&e.length?e[e.length-1]:1},t.prototype.getCounterValues=function(t){var e=this.counters[t];return e||[]},t.prototype.pop=function(t){var e=this;t.forEach((function(t){return e.counters[t].pop()}))},t.prototype.parse=function(t){var e=this,r=t.counterIncrement,i=t.counterReset,n=!0;null!==r&&r.forEach((function(t){var r=e.counters[t.counter];r&&0!==t.increment&&(n=!1,r.length||r.push(1),r[Math.max(0,r.length-1)]+=t.increment)}));var o=[];return n&&i.forEach((function(t){var r=e.counters[t.counter];o.push(t.counter),r||(r=e.counters[t.counter]=[]),r.push(t.reset)})),o},t}(),Fs={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},Ps={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["Ք","Փ","Ւ","Ց","Ր","Տ","Վ","Ս","Ռ","Ջ","Պ","Չ","Ո","Շ","Ն","Յ","Մ","Ճ","Ղ","Ձ","Հ","Կ","Ծ","Խ","Լ","Ի","Ժ","Թ","Ը","Է","Զ","Ե","Դ","Գ","Բ","Ա"]},Ls={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["י׳","ט׳","ח׳","ז׳","ו׳","ה׳","ד׳","ג׳","ב׳","א׳","ת","ש","ר","ק","צ","פ","ע","ס","נ","מ","ל","כ","יט","יח","יז","טז","טו","י","ט","ח","ז","ו","ה","ד","ג","ב","א"]},Ds={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["ჵ","ჰ","ჯ","ჴ","ხ","ჭ","წ","ძ","ც","ჩ","შ","ყ","ღ","ქ","ფ","ჳ","ტ","ს","რ","ჟ","პ","ო","ჲ","ნ","მ","ლ","კ","ი","თ","ჱ","ზ","ვ","ე","დ","გ","ბ","ა"]},Us=function(t,e,r,i,n,o){return t<e||t>r?Zs(t,n,o.length>0):i.integers.reduce((function(e,r,n){for(;t>=r;)t-=r,e+=i.values[n];return e}),"")+o},ks=function(t,e,r,i){var n="";do{r||t--,n=i(t)+n,t/=e}while(t*e>=e);return n},zs=function(t,e,r,i,n){var o=r-e+1;return(t<0?"-":"")+(ks(Math.abs(t),o,i,(function(t){return u(Math.floor(t%o)+e)}))+n)},Rs=function(t,e,r){void 0===r&&(r=". ");var i=e.length;return ks(Math.abs(t),i,!1,(function(t){return e[Math.floor(t%i)]}))+r},Os=1,Qs=2,Ns=4,Vs=8,Hs=function(t,e,r,i,n,o){if(t<-9999||t>9999)return Zs(t,4,n.length>0);var a=Math.abs(t),s=n;if(0===a)return e[0]+s;for(var l=0;a>0&&l<=4;l++){var c=a%10;0===c&&ao(o,Os)&&""!==s?s=e[c]+s:c>1||1===c&&0===l||1===c&&1===l&&ao(o,Qs)||1===c&&1===l&&ao(o,Ns)&&t>100||1===c&&l>1&&ao(o,Vs)?s=e[c]+(l>0?r[l-1]:"")+s:1===c&&l>0&&(s=r[l-1]+s),a=Math.floor(a/10)}return(t<0?i:"")+s},js="十百千萬",Gs="拾佰仟萬",Ks="マイナス",qs="마이너스",Zs=function(t,e,r){var i=r?". ":"",n=r?"、":"",o=r?", ":"",a=r?" ":"";switch(e){case 0:return"•"+a;case 1:return"◦"+a;case 2:return"◾"+a;case 5:var s=zs(t,48,57,!0,i);return s.length<4?"0"+s:s;case 4:return Rs(t,"〇一二三四五六七八九",n);case 6:return Us(t,1,3999,Fs,3,i).toLowerCase();case 7:return Us(t,1,3999,Fs,3,i);case 8:return zs(t,945,969,!1,i);case 9:return zs(t,97,122,!1,i);case 10:return zs(t,65,90,!1,i);case 11:return zs(t,1632,1641,!0,i);case 12:case 49:return Us(t,1,9999,Ps,3,i);case 35:return Us(t,1,9999,Ps,3,i).toLowerCase();case 13:return zs(t,2534,2543,!0,i);case 14:case 30:return zs(t,6112,6121,!0,i);case 15:return Rs(t,"子丑寅卯辰巳午未申酉戌亥",n);case 16:return Rs(t,"甲乙丙丁戊己庚辛壬癸",n);case 17:case 48:return Hs(t,"零一二三四五六七八九",js,"負",n,Qs|Ns|Vs);case 47:return Hs(t,"零壹貳參肆伍陸柒捌玖",Gs,"負",n,Os|Qs|Ns|Vs);case 42:return Hs(t,"零一二三四五六七八九",js,"负",n,Qs|Ns|Vs);case 41:return Hs(t,"零壹贰叁肆伍陆柒捌玖",Gs,"负",n,Os|Qs|Ns|Vs);case 26:return Hs(t,"〇一二三四五六七八九","十百千万",Ks,n,0);case 25:return Hs(t,"零壱弐参四伍六七八九","拾百千万",Ks,n,Os|Qs|Ns);case 31:return Hs(t,"영일이삼사오육칠팔구","십백천만",qs,o,Os|Qs|Ns);case 33:return Hs(t,"零一二三四五六七八九","十百千萬",qs,o,0);case 32:return Hs(t,"零壹貳參四五六七八九","拾百千",qs,o,Os|Qs|Ns);case 18:return zs(t,2406,2415,!0,i);case 20:return Us(t,1,19999,Ds,3,i);case 21:return zs(t,2790,2799,!0,i);case 22:return zs(t,2662,2671,!0,i);case 22:return Us(t,1,10999,Ls,3,i);case 23:return Rs(t,"あいうえおかきくけこさしすせそたちつてとなにぬねのはひふへほまみむめもやゆよらりるれろわゐゑをん");case 24:return Rs(t,"いろはにほへとちりぬるをわかよたれそつねならむうゐのおくやまけふこえてあさきゆめみしゑひもせす");case 27:return zs(t,3302,3311,!0,i);case 28:return Rs(t,"アイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワヰヱヲン",n);case 29:return Rs(t,"イロハニホヘトチリヌルヲワカヨタレソツネナラムウヰノオクヤマケフコエテアサキユメミシヱヒモセス",n);case 34:return zs(t,3792,3801,!0,i);case 37:return zs(t,6160,6169,!0,i);case 38:return zs(t,4160,4169,!0,i);case 39:return zs(t,2918,2927,!0,i);case 40:return zs(t,1776,1785,!0,i);case 43:return zs(t,3046,3055,!0,i);case 44:return zs(t,3174,3183,!0,i);case 45:return zs(t,3664,3673,!0,i);case 46:return zs(t,3872,3881,!0,i);default:return zs(t,48,57,!0,i)}},Ws="data-html2canvas-ignore",Xs=function(){function t(t,e,r){if(this.context=t,this.options=r,this.scrolledElements=[],this.referenceElement=e,this.counters=new Ms,this.quoteDepth=0,!e.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(e.ownerDocument.documentElement,!1)}return t.prototype.toIFrame=function(t,e){var r=this,o=Ys(t,e);if(!o.contentWindow)return Promise.reject("Unable to find iframe window");var a=t.defaultView.pageXOffset,s=t.defaultView.pageYOffset,l=o.contentWindow,c=l.document,u=el(o).then((function(){return i(r,void 0,void 0,(function(){var t,r;return n(this,(function(i){switch(i.label){case 0:return this.scrolledElements.forEach(al),l&&(l.scrollTo(e.left,e.top),!/(iPad|iPhone|iPod)/g.test(navigator.userAgent)||l.scrollY===e.top&&l.scrollX===e.left||(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(l.scrollX-e.left,l.scrollY-e.top,0,0))),t=this.options.onclone,void 0===(r=this.clonedReferenceElement)?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:c.fonts&&c.fonts.ready?[4,c.fonts.ready]:[3,2];case 1:i.sent(),i.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,tl(c)]:[3,4];case 3:i.sent(),i.label=4;case 4:return"function"==typeof t?[2,Promise.resolve().then((function(){return t(c,r)})).then((function(){return o}))]:[2,o]}}))}))}));return c.open(),c.write(nl(document.doctype)+"<html></html>"),ol(this.referenceElement.ownerDocument,a,s),c.replaceChild(c.adoptNode(this.documentElement),c.documentElement),c.close(),u},t.prototype.createElementClone=function(t){if(Bo(t,2),vs(t))return this.createCanvasClone(t);if(xs(t))return this.createVideoClone(t);if(Bs(t))return this.createStyleClone(t);var e=t.cloneNode(!1);return ws(e)&&(ws(t)&&t.currentSrc&&t.currentSrc!==t.src&&(e.src=t.currentSrc,e.srcset=""),"lazy"===e.loading&&(e.loading="eager")),Ss(e)?this.createCustomElementClone(e):e},t.prototype.createCustomElementClone=function(t){var e=document.createElement("html2canvascustomelement");return il(t.style,e),e},t.prototype.createStyleClone=function(t){try{var e=t.sheet;if(e&&e.cssRules){var r=[].slice.call(e.cssRules,0).reduce((function(t,e){return e&&"string"==typeof e.cssText?t+e.cssText:t}),""),i=t.cloneNode(!1);return i.textContent=r,i}}catch(t){if(this.context.logger.error("Unable to access cssRules property",t),"SecurityError"!==t.name)throw t}return t.cloneNode(!1)},t.prototype.createCanvasClone=function(t){var e;if(this.options.inlineImages&&t.ownerDocument){var r=t.ownerDocument.createElement("img");try{return r.src=t.toDataURL(),r}catch(e){this.context.logger.info("Unable to inline canvas contents, canvas is tainted",t)}}var i=t.cloneNode(!1);try{i.width=t.width,i.height=t.height;var n=t.getContext("2d"),o=i.getContext("2d");if(o)if(!this.options.allowTaint&&n)o.putImageData(n.getImageData(0,0,t.width,t.height),0,0);else{var a=null!==(e=t.getContext("webgl2"))&&void 0!==e?e:t.getContext("webgl");if(a){var s=a.getContextAttributes();!1===(null==s?void 0:s.preserveDrawingBuffer)&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",t)}o.drawImage(t,0,0)}return i}catch(e){this.context.logger.info("Unable to clone canvas as it is tainted",t)}return i},t.prototype.createVideoClone=function(t){var e=t.ownerDocument.createElement("canvas");e.width=t.offsetWidth,e.height=t.offsetHeight;var r=e.getContext("2d");try{return r&&(r.drawImage(t,0,0,e.width,e.height),this.options.allowTaint||r.getImageData(0,0,e.width,e.height)),e}catch(e){this.context.logger.info("Unable to clone video as it is tainted",t)}var i=t.ownerDocument.createElement("canvas");return i.width=t.offsetWidth,i.height=t.offsetHeight,i},t.prototype.appendChildNode=function(t,e,r){hs(e)&&(Cs(e)||e.hasAttribute(Ws)||"function"==typeof this.options.ignoreElements&&this.options.ignoreElements(e))||this.options.copyStyles&&hs(e)&&Bs(e)||t.appendChild(this.cloneNode(e,r))},t.prototype.cloneChildNodes=function(t,e,r){for(var i=this,n=t.shadowRoot?t.shadowRoot.firstChild:t.firstChild;n;n=n.nextSibling)if(hs(n)&&Is(n)&&"function"==typeof n.assignedNodes){var o=n.assignedNodes();o.length&&o.forEach((function(t){return i.appendChildNode(e,t,r)}))}else this.appendChildNode(e,n,r)},t.prototype.cloneNode=function(t,e){if(us(t))return document.createTextNode(t.data);if(!t.ownerDocument)return t.cloneNode(!1);var r=t.ownerDocument.defaultView;if(r&&hs(t)&&(As(t)||ps(t))){var i=this.createElementClone(t);i.style.transitionProperty="none";var n=r.getComputedStyle(t),o=r.getComputedStyle(t,":before"),a=r.getComputedStyle(t,":after");this.referenceElement===t&&As(i)&&(this.clonedReferenceElement=i),ys(i)&&Al(i);var s=this.counters.parse(new vo(this.context,n)),l=this.resolvePseudoContent(t,i,o,Zo.BEFORE);Ss(t)&&(e=!0),xs(t)||this.cloneChildNodes(t,i,e),l&&i.insertBefore(l,i.firstChild);var c=this.resolvePseudoContent(t,i,a,Zo.AFTER);return c&&i.appendChild(c),this.counters.pop(s),(n&&(this.options.copyStyles||ps(t))&&!bs(t)||e)&&il(n,i),0===t.scrollTop&&0===t.scrollLeft||this.scrolledElements.push([i,t.scrollLeft,t.scrollTop]),(Es(t)||Ts(t))&&(Es(i)||Ts(i))&&(i.value=t.value),i}return t.cloneNode(!1)},t.prototype.resolvePseudoContent=function(t,e,r,i){var n=this;if(r){var o=r.content,a=e.ownerDocument;if(a&&o&&"none"!==o&&"-moz-alt-content"!==o&&"none"!==r.display){this.counters.parse(new vo(this.context,r));var s=new yo(this.context,r),l=a.createElement("html2canvaspseudoelement");il(r,l),s.content.forEach((function(e){if(0===e.type)l.appendChild(a.createTextNode(e.value));else if(22===e.type){var r=a.createElement("img");r.src=e.value,r.style.opacity="1",l.appendChild(r)}else if(18===e.type){if("attr"===e.name){var i=e.values.filter(Lr);i.length&&l.appendChild(a.createTextNode(t.getAttribute(i[0].value)||""))}else if("counter"===e.name){var o=e.values.filter(zr),c=o[0],u=o[1];if(c&&Lr(c)){var h=n.counters.getCounterValue(c.value),A=u&&Lr(u)?En.parse(n.context,u.value):3;l.appendChild(a.createTextNode(Zs(h,A,!1)))}}else if("counters"===e.name){var p=e.values.filter(zr),d=(c=p[0],p[1]);if(u=p[2],c&&Lr(c)){var f=n.counters.getCounterValues(c.value),m=u&&Lr(u)?En.parse(n.context,u.value):3,g=d&&0===d.type?d.value:"",_=f.map((function(t){return Zs(t,m,!1)})).join(g);l.appendChild(a.createTextNode(_))}}}else if(20===e.type)switch(e.value){case"open-quote":l.appendChild(a.createTextNode(Ao(s.quotes,n.quoteDepth++,!0)));break;case"close-quote":l.appendChild(a.createTextNode(Ao(s.quotes,--n.quoteDepth,!1)));break;default:l.appendChild(a.createTextNode(e.value))}})),l.className=cl+" "+ul;var c=i===Zo.BEFORE?" "+cl:" "+ul;return ps(e)?e.className.baseValue+=c:e.className+=c,l}}},t.destroy=function(t){return!!t.parentNode&&(t.parentNode.removeChild(t),!0)},t}();!function(t){t[t.BEFORE=0]="BEFORE",t[t.AFTER=1]="AFTER"}(Zo||(Zo={}));var $s,Ys=function(t,e){var r=t.createElement("iframe");return r.className="html2canvas-container",r.style.visibility="hidden",r.style.position="fixed",r.style.left="-10000px",r.style.top="0px",r.style.border="0",r.width=e.width.toString(),r.height=e.height.toString(),r.scrolling="no",r.setAttribute(Ws,"true"),t.body.appendChild(r),r},Js=function(t){return new Promise((function(e){t.complete?e():t.src?(t.onload=e,t.onerror=e):e()}))},tl=function(t){return Promise.all([].slice.call(t.images,0).map(Js))},el=function(t){return new Promise((function(e,r){var i=t.contentWindow;if(!i)return r("No window assigned for iframe");var n=i.document;i.onload=t.onload=function(){i.onload=t.onload=null;var r=setInterval((function(){n.body.childNodes.length>0&&"complete"===n.readyState&&(clearInterval(r),e(t))}),50)}}))},rl=["all","d","content"],il=function(t,e){for(var r=t.length-1;r>=0;r--){var i=t.item(r);-1===rl.indexOf(i)&&e.style.setProperty(i,t.getPropertyValue(i))}return e},nl=function(t){var e="";return t&&(e+="<!DOCTYPE ",t.name&&(e+=t.name),t.internalSubset&&(e+=t.internalSubset),t.publicId&&(e+='"'+t.publicId+'"'),t.systemId&&(e+='"'+t.systemId+'"'),e+=">"),e},ol=function(t,e,r){t&&t.defaultView&&(e!==t.defaultView.pageXOffset||r!==t.defaultView.pageYOffset)&&t.defaultView.scrollTo(e,r)},al=function(t){var e=t[0],r=t[1],i=t[2];e.scrollLeft=r,e.scrollTop=i},sl=":before",ll=":after",cl="___html2canvas___pseudoelement_before",ul="___html2canvas___pseudoelement_after",hl='{\n    content: "" !important;\n    display: none !important;\n}',Al=function(t){pl(t,"."+cl+sl+hl+"\n         ."+ul+ll+hl)},pl=function(t,e){var r=t.ownerDocument;if(r){var i=r.createElement("style");i.textContent=e,t.appendChild(i)}},dl=function(){function t(){}return t.getOrigin=function(e){var r=t._link;return r?(r.href=e,r.href=r.href,r.protocol+r.hostname+r.port):"about:blank"},t.isSameOrigin=function(e){return t.getOrigin(e)===t._origin},t.setContext=function(e){t._link=e.document.createElement("a"),t._origin=t.getOrigin(e.location.href)},t._origin="about:blank",t}(),fl=function(){function t(t,e){this.context=t,this._options=e,this._cache={}}return t.prototype.addImage=function(t){var e=Promise.resolve();return this.has(t)?e:wl(t)||yl(t)?((this._cache[t]=this.loadImage(t)).catch((function(){})),e):e},t.prototype.match=function(t){return this._cache[t]},t.prototype.loadImage=function(t){return i(this,void 0,void 0,(function(){var e,r,i,o,a=this;return n(this,(function(n){switch(n.label){case 0:return e=dl.isSameOrigin(t),r=!vl(t)&&!0===this._options.useCORS&&Ta.SUPPORT_CORS_IMAGES&&!e,i=!vl(t)&&!e&&!wl(t)&&"string"==typeof this._options.proxy&&Ta.SUPPORT_CORS_XHR&&!r,e||!1!==this._options.allowTaint||vl(t)||wl(t)||i||r?(o=t,i?[4,this.proxy(o)]:[3,2]):[2];case 1:o=n.sent(),n.label=2;case 2:return this.context.logger.debug("Added image "+t.substring(0,256)),[4,new Promise((function(t,e){var i=new Image;i.onload=function(){return t(i)},i.onerror=e,(xl(o)||r)&&(i.crossOrigin="anonymous"),i.src=o,!0===i.complete&&setTimeout((function(){return t(i)}),500),a._options.imageTimeout>0&&setTimeout((function(){return e("Timed out ("+a._options.imageTimeout+"ms) loading image")}),a._options.imageTimeout)}))];case 3:return[2,n.sent()]}}))}))},t.prototype.has=function(t){return void 0!==this._cache[t]},t.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},t.prototype.proxy=function(t){var e=this,r=this._options.proxy;if(!r)throw new Error("No proxy defined");var i=t.substring(0,256);return new Promise((function(n,o){var a=Ta.SUPPORT_RESPONSE_TYPE?"blob":"text",s=new XMLHttpRequest;s.onload=function(){if(200===s.status)if("text"===a)n(s.response);else{var t=new FileReader;t.addEventListener("load",(function(){return n(t.result)}),!1),t.addEventListener("error",(function(t){return o(t)}),!1),t.readAsDataURL(s.response)}else o("Failed to proxy resource "+i+" with status code "+s.status)},s.onerror=o;var l=r.indexOf("?")>-1?"&":"?";if(s.open("GET",""+r+l+"url="+encodeURIComponent(t)+"&responseType="+a),"text"!==a&&s instanceof XMLHttpRequest&&(s.responseType=a),e._options.imageTimeout){var c=e._options.imageTimeout;s.timeout=c,s.ontimeout=function(){return o("Timed out ("+c+"ms) proxying "+i)}}s.send()}))},t}(),ml=/^data:image\/svg\+xml/i,gl=/^data:image\/.*;base64,/i,_l=/^data:image\/.*/i,yl=function(t){return Ta.SUPPORT_SVG_DRAWING||!bl(t)},vl=function(t){return _l.test(t)},xl=function(t){return gl.test(t)},wl=function(t){return"blob"===t.substr(0,4)},bl=function(t){return"svg"===t.substr(-3).toLowerCase()||ml.test(t)},Bl=function(){function t(t,e){this.type=0,this.x=t,this.y=e}return t.prototype.add=function(e,r){return new t(this.x+e,this.y+r)},t}(),Cl=function(t,e,r){return new Bl(t.x+(e.x-t.x)*r,t.y+(e.y-t.y)*r)},El=function(){function t(t,e,r,i){this.type=1,this.start=t,this.startControl=e,this.endControl=r,this.end=i}return t.prototype.subdivide=function(e,r){var i=Cl(this.start,this.startControl,e),n=Cl(this.startControl,this.endControl,e),o=Cl(this.endControl,this.end,e),a=Cl(i,n,e),s=Cl(n,o,e),l=Cl(a,s,e);return r?new t(this.start,i,a,l):new t(l,s,o,this.end)},t.prototype.add=function(e,r){return new t(this.start.add(e,r),this.startControl.add(e,r),this.endControl.add(e,r),this.end.add(e,r))},t.prototype.reverse=function(){return new t(this.end,this.endControl,this.startControl,this.start)},t}(),Tl=function(t){return 1===t.type},Il=function(){function t(t){var e=t.styles,r=t.bounds,i=Kr(e.borderTopLeftRadius,r.width,r.height),n=i[0],o=i[1],a=Kr(e.borderTopRightRadius,r.width,r.height),s=a[0],l=a[1],c=Kr(e.borderBottomRightRadius,r.width,r.height),u=c[0],h=c[1],A=Kr(e.borderBottomLeftRadius,r.width,r.height),p=A[0],d=A[1],f=[];f.push((n+s)/r.width),f.push((p+u)/r.width),f.push((o+d)/r.height),f.push((l+h)/r.height);var m=Math.max.apply(Math,f);m>1&&(n/=m,o/=m,s/=m,l/=m,u/=m,h/=m,p/=m,d/=m);var g=r.width-s,_=r.height-h,y=r.width-u,v=r.height-d,x=e.borderTopWidth,w=e.borderRightWidth,b=e.borderBottomWidth,B=e.borderLeftWidth,C=qr(e.paddingTop,t.bounds.width),E=qr(e.paddingRight,t.bounds.width),T=qr(e.paddingBottom,t.bounds.width),I=qr(e.paddingLeft,t.bounds.width);this.topLeftBorderDoubleOuterBox=n>0||o>0?Sl(r.left+B/3,r.top+x/3,n-B/3,o-x/3,$s.TOP_LEFT):new Bl(r.left+B/3,r.top+x/3),this.topRightBorderDoubleOuterBox=n>0||o>0?Sl(r.left+g,r.top+x/3,s-w/3,l-x/3,$s.TOP_RIGHT):new Bl(r.left+r.width-w/3,r.top+x/3),this.bottomRightBorderDoubleOuterBox=u>0||h>0?Sl(r.left+y,r.top+_,u-w/3,h-b/3,$s.BOTTOM_RIGHT):new Bl(r.left+r.width-w/3,r.top+r.height-b/3),this.bottomLeftBorderDoubleOuterBox=p>0||d>0?Sl(r.left+B/3,r.top+v,p-B/3,d-b/3,$s.BOTTOM_LEFT):new Bl(r.left+B/3,r.top+r.height-b/3),this.topLeftBorderDoubleInnerBox=n>0||o>0?Sl(r.left+2*B/3,r.top+2*x/3,n-2*B/3,o-2*x/3,$s.TOP_LEFT):new Bl(r.left+2*B/3,r.top+2*x/3),this.topRightBorderDoubleInnerBox=n>0||o>0?Sl(r.left+g,r.top+2*x/3,s-2*w/3,l-2*x/3,$s.TOP_RIGHT):new Bl(r.left+r.width-2*w/3,r.top+2*x/3),this.bottomRightBorderDoubleInnerBox=u>0||h>0?Sl(r.left+y,r.top+_,u-2*w/3,h-2*b/3,$s.BOTTOM_RIGHT):new Bl(r.left+r.width-2*w/3,r.top+r.height-2*b/3),this.bottomLeftBorderDoubleInnerBox=p>0||d>0?Sl(r.left+2*B/3,r.top+v,p-2*B/3,d-2*b/3,$s.BOTTOM_LEFT):new Bl(r.left+2*B/3,r.top+r.height-2*b/3),this.topLeftBorderStroke=n>0||o>0?Sl(r.left+B/2,r.top+x/2,n-B/2,o-x/2,$s.TOP_LEFT):new Bl(r.left+B/2,r.top+x/2),this.topRightBorderStroke=n>0||o>0?Sl(r.left+g,r.top+x/2,s-w/2,l-x/2,$s.TOP_RIGHT):new Bl(r.left+r.width-w/2,r.top+x/2),this.bottomRightBorderStroke=u>0||h>0?Sl(r.left+y,r.top+_,u-w/2,h-b/2,$s.BOTTOM_RIGHT):new Bl(r.left+r.width-w/2,r.top+r.height-b/2),this.bottomLeftBorderStroke=p>0||d>0?Sl(r.left+B/2,r.top+v,p-B/2,d-b/2,$s.BOTTOM_LEFT):new Bl(r.left+B/2,r.top+r.height-b/2),this.topLeftBorderBox=n>0||o>0?Sl(r.left,r.top,n,o,$s.TOP_LEFT):new Bl(r.left,r.top),this.topRightBorderBox=s>0||l>0?Sl(r.left+g,r.top,s,l,$s.TOP_RIGHT):new Bl(r.left+r.width,r.top),this.bottomRightBorderBox=u>0||h>0?Sl(r.left+y,r.top+_,u,h,$s.BOTTOM_RIGHT):new Bl(r.left+r.width,r.top+r.height),this.bottomLeftBorderBox=p>0||d>0?Sl(r.left,r.top+v,p,d,$s.BOTTOM_LEFT):new Bl(r.left,r.top+r.height),this.topLeftPaddingBox=n>0||o>0?Sl(r.left+B,r.top+x,Math.max(0,n-B),Math.max(0,o-x),$s.TOP_LEFT):new Bl(r.left+B,r.top+x),this.topRightPaddingBox=s>0||l>0?Sl(r.left+Math.min(g,r.width-w),r.top+x,g>r.width+w?0:Math.max(0,s-w),Math.max(0,l-x),$s.TOP_RIGHT):new Bl(r.left+r.width-w,r.top+x),this.bottomRightPaddingBox=u>0||h>0?Sl(r.left+Math.min(y,r.width-B),r.top+Math.min(_,r.height-b),Math.max(0,u-w),Math.max(0,h-b),$s.BOTTOM_RIGHT):new Bl(r.left+r.width-w,r.top+r.height-b),this.bottomLeftPaddingBox=p>0||d>0?Sl(r.left+B,r.top+Math.min(v,r.height-b),Math.max(0,p-B),Math.max(0,d-b),$s.BOTTOM_LEFT):new Bl(r.left+B,r.top+r.height-b),this.topLeftContentBox=n>0||o>0?Sl(r.left+B+I,r.top+x+C,Math.max(0,n-(B+I)),Math.max(0,o-(x+C)),$s.TOP_LEFT):new Bl(r.left+B+I,r.top+x+C),this.topRightContentBox=s>0||l>0?Sl(r.left+Math.min(g,r.width+B+I),r.top+x+C,g>r.width+B+I?0:s-B+I,l-(x+C),$s.TOP_RIGHT):new Bl(r.left+r.width-(w+E),r.top+x+C),this.bottomRightContentBox=u>0||h>0?Sl(r.left+Math.min(y,r.width-(B+I)),r.top+Math.min(_,r.height+x+C),Math.max(0,u-(w+E)),h-(b+T),$s.BOTTOM_RIGHT):new Bl(r.left+r.width-(w+E),r.top+r.height-(b+T)),this.bottomLeftContentBox=p>0||d>0?Sl(r.left+B+I,r.top+v,Math.max(0,p-(B+I)),d-(b+T),$s.BOTTOM_LEFT):new Bl(r.left+B+I,r.top+r.height-(b+T))}return t}();!function(t){t[t.TOP_LEFT=0]="TOP_LEFT",t[t.TOP_RIGHT=1]="TOP_RIGHT",t[t.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",t[t.BOTTOM_LEFT=3]="BOTTOM_LEFT"}($s||($s={}));var Sl=function(t,e,r,i,n){var o=(Math.sqrt(2)-1)/3*4,a=r*o,s=i*o,l=t+r,c=e+i;switch(n){case $s.TOP_LEFT:return new El(new Bl(t,c),new Bl(t,c-s),new Bl(l-a,e),new Bl(l,e));case $s.TOP_RIGHT:return new El(new Bl(t,e),new Bl(t+a,e),new Bl(l,c-s),new Bl(l,c));case $s.BOTTOM_RIGHT:return new El(new Bl(l,e),new Bl(l,e+s),new Bl(t+a,c),new Bl(t,c));case $s.BOTTOM_LEFT:default:return new El(new Bl(l,c),new Bl(l-a,c),new Bl(t,e+s),new Bl(t,e))}},Ml=function(t){return[t.topLeftBorderBox,t.topRightBorderBox,t.bottomRightBorderBox,t.bottomLeftBorderBox]},Fl=function(t){return[t.topLeftContentBox,t.topRightContentBox,t.bottomRightContentBox,t.bottomLeftContentBox]},Pl=function(t){return[t.topLeftPaddingBox,t.topRightPaddingBox,t.bottomRightPaddingBox,t.bottomLeftPaddingBox]},Ll=function(){function t(t,e,r){this.offsetX=t,this.offsetY=e,this.matrix=r,this.type=0,this.target=6}return t}(),Dl=function(){function t(t,e){this.path=t,this.target=e,this.type=1}return t}(),Ul=function(){function t(t){this.opacity=t,this.type=2,this.target=6}return t}(),kl=function(t){return 0===t.type},zl=function(t){return 1===t.type},Rl=function(t){return 2===t.type},Ol=function(t,e){return t.length===e.length&&t.some((function(t,r){return t===e[r]}))},Ql=function(t,e,r,i,n){return t.map((function(t,o){switch(o){case 0:return t.add(e,r);case 1:return t.add(e+i,r);case 2:return t.add(e+i,r+n);case 3:return t.add(e,r+n)}return t}))},Nl=function(){function t(t){this.element=t,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return t}(),Vl=function(){function t(t,e){if(this.container=t,this.parent=e,this.effects=[],this.curves=new Il(this.container),this.container.styles.opacity<1&&this.effects.push(new Ul(this.container.styles.opacity)),null!==this.container.styles.transform){var r=this.container.bounds.left+this.container.styles.transformOrigin[0].number,i=this.container.bounds.top+this.container.styles.transformOrigin[1].number,n=this.container.styles.transform;this.effects.push(new Ll(r,i,n))}if(0!==this.container.styles.overflowX){var o=Ml(this.curves),a=Pl(this.curves);Ol(o,a)?this.effects.push(new Dl(o,6)):(this.effects.push(new Dl(o,2)),this.effects.push(new Dl(a,4)))}}return t.prototype.getEffects=function(t){for(var e=-1===[2,3].indexOf(this.container.styles.position),r=this.parent,i=this.effects.slice(0);r;){var n=r.effects.filter((function(t){return!zl(t)}));if(e||0!==r.container.styles.position||!r.parent){if(i.unshift.apply(i,n),e=-1===[2,3].indexOf(r.container.styles.position),0!==r.container.styles.overflowX){var o=Ml(r.curves),a=Pl(r.curves);Ol(o,a)||i.unshift(new Dl(a,6))}}else i.unshift.apply(i,n);r=r.parent}return i.filter((function(e){return ao(e.target,t)}))},t}(),Hl=function t(e,r,i,n){e.container.elements.forEach((function(o){var a=ao(o.flags,4),s=ao(o.flags,2),l=new Vl(o,e);ao(o.styles.display,2048)&&n.push(l);var c=ao(o.flags,8)?[]:n;if(a||s){var u=a||o.styles.isPositioned()?i:r,h=new Nl(l);if(o.styles.isPositioned()||o.styles.opacity<1||o.styles.isTransformed()){var A=o.styles.zIndex.order;if(A<0){var p=0;u.negativeZIndex.some((function(t,e){return A>t.element.container.styles.zIndex.order?(p=e,!1):p>0})),u.negativeZIndex.splice(p,0,h)}else if(A>0){var d=0;u.positiveZIndex.some((function(t,e){return A>=t.element.container.styles.zIndex.order?(d=e+1,!1):d>0})),u.positiveZIndex.splice(d,0,h)}else u.zeroOrAutoZIndexOrTransformedOrOpacity.push(h)}else o.styles.isFloating()?u.nonPositionedFloats.push(h):u.nonPositionedInlineLevel.push(h);t(l,h,a?h:i,c)}else o.styles.isInlineLevel()?r.inlineLevel.push(l):r.nonInlineLevel.push(l),t(l,r,i,c);ao(o.flags,8)&&jl(o,c)}))},jl=function(t,e){for(var r=t instanceof Ga?t.start:1,i=t instanceof Ga&&t.reversed,n=0;n<e.length;n++){var o=e[n];o.container instanceof ja&&"number"==typeof o.container.value&&0!==o.container.value&&(r=o.container.value),o.listValue=Zs(r,o.container.styles.listStyleType,!0),r+=i?-1:1}},Gl=function(t){var e=new Vl(t,null),r=new Nl(e),i=[];return Hl(e,r,r,i),jl(e.container,i),r},Kl=function(t,e){switch(e){case 0:return $l(t.topLeftBorderBox,t.topLeftPaddingBox,t.topRightBorderBox,t.topRightPaddingBox);case 1:return $l(t.topRightBorderBox,t.topRightPaddingBox,t.bottomRightBorderBox,t.bottomRightPaddingBox);case 2:return $l(t.bottomRightBorderBox,t.bottomRightPaddingBox,t.bottomLeftBorderBox,t.bottomLeftPaddingBox);default:return $l(t.bottomLeftBorderBox,t.bottomLeftPaddingBox,t.topLeftBorderBox,t.topLeftPaddingBox)}},ql=function(t,e){switch(e){case 0:return $l(t.topLeftBorderBox,t.topLeftBorderDoubleOuterBox,t.topRightBorderBox,t.topRightBorderDoubleOuterBox);case 1:return $l(t.topRightBorderBox,t.topRightBorderDoubleOuterBox,t.bottomRightBorderBox,t.bottomRightBorderDoubleOuterBox);case 2:return $l(t.bottomRightBorderBox,t.bottomRightBorderDoubleOuterBox,t.bottomLeftBorderBox,t.bottomLeftBorderDoubleOuterBox);default:return $l(t.bottomLeftBorderBox,t.bottomLeftBorderDoubleOuterBox,t.topLeftBorderBox,t.topLeftBorderDoubleOuterBox)}},Zl=function(t,e){switch(e){case 0:return $l(t.topLeftBorderDoubleInnerBox,t.topLeftPaddingBox,t.topRightBorderDoubleInnerBox,t.topRightPaddingBox);case 1:return $l(t.topRightBorderDoubleInnerBox,t.topRightPaddingBox,t.bottomRightBorderDoubleInnerBox,t.bottomRightPaddingBox);case 2:return $l(t.bottomRightBorderDoubleInnerBox,t.bottomRightPaddingBox,t.bottomLeftBorderDoubleInnerBox,t.bottomLeftPaddingBox);default:return $l(t.bottomLeftBorderDoubleInnerBox,t.bottomLeftPaddingBox,t.topLeftBorderDoubleInnerBox,t.topLeftPaddingBox)}},Wl=function(t,e){switch(e){case 0:return Xl(t.topLeftBorderStroke,t.topRightBorderStroke);case 1:return Xl(t.topRightBorderStroke,t.bottomRightBorderStroke);case 2:return Xl(t.bottomRightBorderStroke,t.bottomLeftBorderStroke);default:return Xl(t.bottomLeftBorderStroke,t.topLeftBorderStroke)}},Xl=function(t,e){var r=[];return Tl(t)?r.push(t.subdivide(.5,!1)):r.push(t),Tl(e)?r.push(e.subdivide(.5,!0)):r.push(e),r},$l=function(t,e,r,i){var n=[];return Tl(t)?n.push(t.subdivide(.5,!1)):n.push(t),Tl(r)?n.push(r.subdivide(.5,!0)):n.push(r),Tl(i)?n.push(i.subdivide(.5,!0).reverse()):n.push(i),Tl(e)?n.push(e.subdivide(.5,!1).reverse()):n.push(e),n},Yl=function(t){var e=t.bounds,r=t.styles;return e.add(r.borderLeftWidth,r.borderTopWidth,-(r.borderRightWidth+r.borderLeftWidth),-(r.borderTopWidth+r.borderBottomWidth))},Jl=function(t){var e=t.styles,r=t.bounds,i=qr(e.paddingLeft,r.width),n=qr(e.paddingRight,r.width),o=qr(e.paddingTop,r.width),a=qr(e.paddingBottom,r.width);return r.add(i+e.borderLeftWidth,o+e.borderTopWidth,-(e.borderRightWidth+e.borderLeftWidth+i+n),-(e.borderTopWidth+e.borderBottomWidth+o+a))},tc=function(t,e){return 0===t?e.bounds:2===t?Jl(e):Yl(e)},ec=function(t,e){return 0===t?e.bounds:2===t?Jl(e):Yl(e)},rc=function(t,e,r){var i=tc(ac(t.styles.backgroundOrigin,e),t),n=ec(ac(t.styles.backgroundClip,e),t),o=oc(ac(t.styles.backgroundSize,e),r,i),a=o[0],s=o[1],l=Kr(ac(t.styles.backgroundPosition,e),i.width-a,i.height-s);return[sc(ac(t.styles.backgroundRepeat,e),l,o,i,n),Math.round(i.left+l[0]),Math.round(i.top+l[1]),a,s]},ic=function(t){return Lr(t)&&t.value===zi.AUTO},nc=function(t){return"number"==typeof t},oc=function(t,e,r){var i=e[0],n=e[1],o=e[2],a=t[0],s=t[1];if(!a)return[0,0];if(Nr(a)&&s&&Nr(s))return[qr(a,r.width),qr(s,r.height)];var l=nc(o);if(Lr(a)&&(a.value===zi.CONTAIN||a.value===zi.COVER))return nc(o)?r.width/r.height<o!=(a.value===zi.COVER)?[r.width,r.width/o]:[r.height*o,r.height]:[r.width,r.height];var c=nc(i),u=nc(n),h=c||u;if(ic(a)&&(!s||ic(s)))return c&&u?[i,n]:l||h?h&&l?[c?i:n*o,u?n:i/o]:[c?i:r.width,u?n:r.height]:[r.width,r.height];if(l){var A=0,p=0;return Nr(a)?A=qr(a,r.width):Nr(s)&&(p=qr(s,r.height)),ic(a)?A=p*o:s&&!ic(s)||(p=A/o),[A,p]}var d=null,f=null;if(Nr(a)?d=qr(a,r.width):s&&Nr(s)&&(f=qr(s,r.height)),null===d||s&&!ic(s)||(f=c&&u?d/i*n:r.height),null!==f&&ic(a)&&(d=c&&u?f/n*i:r.width),null!==d&&null!==f)return[d,f];throw new Error("Unable to calculate background-size for element")},ac=function(t,e){var r=t[e];return void 0===r?t[0]:r},sc=function(t,e,r,i,n){var o=e[0],a=e[1],s=r[0],l=r[1];switch(t){case 2:return[new Bl(Math.round(i.left),Math.round(i.top+a)),new Bl(Math.round(i.left+i.width),Math.round(i.top+a)),new Bl(Math.round(i.left+i.width),Math.round(l+i.top+a)),new Bl(Math.round(i.left),Math.round(l+i.top+a))];case 3:return[new Bl(Math.round(i.left+o),Math.round(i.top)),new Bl(Math.round(i.left+o+s),Math.round(i.top)),new Bl(Math.round(i.left+o+s),Math.round(i.height+i.top)),new Bl(Math.round(i.left+o),Math.round(i.height+i.top))];case 1:return[new Bl(Math.round(i.left+o),Math.round(i.top+a)),new Bl(Math.round(i.left+o+s),Math.round(i.top+a)),new Bl(Math.round(i.left+o+s),Math.round(i.top+a+l)),new Bl(Math.round(i.left+o),Math.round(i.top+a+l))];default:return[new Bl(Math.round(n.left),Math.round(n.top)),new Bl(Math.round(n.left+n.width),Math.round(n.top)),new Bl(Math.round(n.left+n.width),Math.round(n.height+n.top)),new Bl(Math.round(n.left),Math.round(n.height+n.top))]}},lc="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",cc="Hidden Text",uc=function(){function t(t){this._data={},this._document=t}return t.prototype.parseMetrics=function(t,e){var r=this._document.createElement("div"),i=this._document.createElement("img"),n=this._document.createElement("span"),o=this._document.body;r.style.visibility="hidden",r.style.fontFamily=t,r.style.fontSize=e,r.style.margin="0",r.style.padding="0",r.style.whiteSpace="nowrap",o.appendChild(r),i.src=lc,i.width=1,i.height=1,i.style.margin="0",i.style.padding="0",i.style.verticalAlign="baseline",n.style.fontFamily=t,n.style.fontSize=e,n.style.margin="0",n.style.padding="0",n.appendChild(this._document.createTextNode(cc)),r.appendChild(n),r.appendChild(i);var a=i.offsetTop-n.offsetTop+2;r.removeChild(n),r.appendChild(this._document.createTextNode(cc)),r.style.lineHeight="normal",i.style.verticalAlign="super";var s=i.offsetTop-r.offsetTop+2;return o.removeChild(r),{baseline:a,middle:s}},t.prototype.getMetrics=function(t,e){var r=t+" "+e;return void 0===this._data[r]&&(this._data[r]=this.parseMetrics(t,e)),this._data[r]},t}(),hc=function(){function t(t,e){this.context=t,this.options=e}return t}(),Ac=1e4,pc=function(t){function r(e,r){var i=t.call(this,e,r)||this;return i._activeEffects=[],i.canvas=r.canvas?r.canvas:document.createElement("canvas"),i.ctx=i.canvas.getContext("2d"),r.canvas||(i.canvas.width=Math.floor(r.width*r.scale),i.canvas.height=Math.floor(r.height*r.scale),i.canvas.style.width=r.width+"px",i.canvas.style.height=r.height+"px"),i.fontMetrics=new uc(document),i.ctx.scale(i.options.scale,i.options.scale),i.ctx.translate(-r.x,-r.y),i.ctx.textBaseline="bottom",i._activeEffects=[],i.context.logger.debug("Canvas renderer initialized ("+r.width+"x"+r.height+") with scale "+r.scale),i}return e(r,t),r.prototype.applyEffects=function(t){for(var e=this;this._activeEffects.length;)this.popEffect();t.forEach((function(t){return e.applyEffect(t)}))},r.prototype.applyEffect=function(t){this.ctx.save(),Rl(t)&&(this.ctx.globalAlpha=t.opacity),kl(t)&&(this.ctx.translate(t.offsetX,t.offsetY),this.ctx.transform(t.matrix[0],t.matrix[1],t.matrix[2],t.matrix[3],t.matrix[4],t.matrix[5]),this.ctx.translate(-t.offsetX,-t.offsetY)),zl(t)&&(this.path(t.path),this.ctx.clip()),this._activeEffects.push(t)},r.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},r.prototype.renderStack=function(t){return i(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return t.element.container.styles.isVisible()?[4,this.renderStackContent(t)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},r.prototype.renderNode=function(t){return i(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return ao(t.container.flags,16),t.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(t)]:[3,3];case 1:return e.sent(),[4,this.renderNodeContent(t)];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))},r.prototype.renderTextWithLetterSpacing=function(t,e,r){var i=this;0===e?this.ctx.fillText(t.text,t.bounds.left,t.bounds.top+r):Pa(t.text).reduce((function(e,n){return i.ctx.fillText(n,e,t.bounds.top+r),e+i.ctx.measureText(n).width}),t.bounds.left)},r.prototype.createFontStyle=function(t){var e=t.fontVariant.filter((function(t){return"normal"===t||"small-caps"===t})).join(""),r=_c(t.fontFamily).join(", "),i=Fr(t.fontSize)?""+t.fontSize.number+t.fontSize.unit:t.fontSize.number+"px";return[[t.fontStyle,e,t.fontWeight,i,r].join(" "),r,i]},r.prototype.renderTextNode=function(t,e){return i(this,void 0,void 0,(function(){var r,i,o,a,s,l,c,u,h=this;return n(this,(function(n){return r=this.createFontStyle(e),i=r[0],o=r[1],a=r[2],this.ctx.font=i,this.ctx.direction=1===e.direction?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",s=this.fontMetrics.getMetrics(o,a),l=s.baseline,c=s.middle,u=e.paintOrder,t.textBounds.forEach((function(t){u.forEach((function(r){switch(r){case 0:h.ctx.fillStyle=ni(e.color),h.renderTextWithLetterSpacing(t,e.letterSpacing,l);var i=e.textShadow;i.length&&t.text.trim().length&&(i.slice(0).reverse().forEach((function(r){h.ctx.shadowColor=ni(r.color),h.ctx.shadowOffsetX=r.offsetX.number*h.options.scale,h.ctx.shadowOffsetY=r.offsetY.number*h.options.scale,h.ctx.shadowBlur=r.blur.number,h.renderTextWithLetterSpacing(t,e.letterSpacing,l)})),h.ctx.shadowColor="",h.ctx.shadowOffsetX=0,h.ctx.shadowOffsetY=0,h.ctx.shadowBlur=0),e.textDecorationLine.length&&(h.ctx.fillStyle=ni(e.textDecorationColor||e.color),e.textDecorationLine.forEach((function(e){switch(e){case 1:h.ctx.fillRect(t.bounds.left,Math.round(t.bounds.top+l),t.bounds.width,1);break;case 2:h.ctx.fillRect(t.bounds.left,Math.round(t.bounds.top),t.bounds.width,1);break;case 3:h.ctx.fillRect(t.bounds.left,Math.ceil(t.bounds.top+c),t.bounds.width,1)}})));break;case 1:e.webkitTextStrokeWidth&&t.text.trim().length&&(h.ctx.strokeStyle=ni(e.webkitTextStrokeColor),h.ctx.lineWidth=e.webkitTextStrokeWidth,h.ctx.lineJoin=window.chrome?"miter":"round",h.ctx.strokeText(t.text,t.bounds.left,t.bounds.top+l)),h.ctx.strokeStyle="",h.ctx.lineWidth=0,h.ctx.lineJoin="miter"}}))})),[2]}))}))},r.prototype.renderReplacedElement=function(t,e,r){if(r&&t.intrinsicWidth>0&&t.intrinsicHeight>0){var i=Jl(t),n=Pl(e);this.path(n),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(r,0,0,t.intrinsicWidth,t.intrinsicHeight,i.left,i.top,i.width,i.height),this.ctx.restore()}},r.prototype.renderNodeContent=function(t){return i(this,void 0,void 0,(function(){var e,i,o,s,l,c,u,h,A,p,d,f,m,g,_,y,v,x;return n(this,(function(n){switch(n.label){case 0:this.applyEffects(t.getEffects(4)),e=t.container,i=t.curves,o=e.styles,s=0,l=e.textNodes,n.label=1;case 1:return s<l.length?(c=l[s],[4,this.renderTextNode(c,o)]):[3,4];case 2:n.sent(),n.label=3;case 3:return s++,[3,1];case 4:if(!(e instanceof Na))return[3,8];n.label=5;case 5:return n.trys.push([5,7,,8]),[4,this.context.cache.match(e.src)];case 6:return _=n.sent(),this.renderReplacedElement(e,i,_),[3,8];case 7:return n.sent(),this.context.logger.error("Error loading image "+e.src),[3,8];case 8:if(e instanceof Va&&this.renderReplacedElement(e,i,e.canvas),!(e instanceof Ha))return[3,12];n.label=9;case 9:return n.trys.push([9,11,,12]),[4,this.context.cache.match(e.svg)];case 10:return _=n.sent(),this.renderReplacedElement(e,i,_),[3,12];case 11:return n.sent(),this.context.logger.error("Error loading svg "+e.svg.substring(0,255)),[3,12];case 12:return e instanceof is&&e.tree?[4,new r(this.context,{scale:this.options.scale,backgroundColor:e.backgroundColor,x:0,y:0,width:e.width,height:e.height}).render(e.tree)]:[3,14];case 13:u=n.sent(),e.width&&e.height&&this.ctx.drawImage(u,0,0,e.width,e.height,e.bounds.left,e.bounds.top,e.bounds.width,e.bounds.height),n.label=14;case 14:if(e instanceof ts&&(h=Math.min(e.bounds.width,e.bounds.height),e.type===Xa?e.checked&&(this.ctx.save(),this.path([new Bl(e.bounds.left+.39363*h,e.bounds.top+.79*h),new Bl(e.bounds.left+.16*h,e.bounds.top+.5549*h),new Bl(e.bounds.left+.27347*h,e.bounds.top+.44071*h),new Bl(e.bounds.left+.39694*h,e.bounds.top+.5649*h),new Bl(e.bounds.left+.72983*h,e.bounds.top+.23*h),new Bl(e.bounds.left+.84*h,e.bounds.top+.34085*h),new Bl(e.bounds.left+.39363*h,e.bounds.top+.79*h)]),this.ctx.fillStyle=ni(Ja),this.ctx.fill(),this.ctx.restore()):e.type===$a&&e.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(e.bounds.left+h/2,e.bounds.top+h/2,h/4,0,2*Math.PI,!0),this.ctx.fillStyle=ni(Ja),this.ctx.fill(),this.ctx.restore())),dc(e)&&e.value.length){switch(A=this.createFontStyle(o),v=A[0],p=A[1],d=this.fontMetrics.getMetrics(v,p).baseline,this.ctx.font=v,this.ctx.fillStyle=ni(o.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=mc(e.styles.textAlign),x=Jl(e),f=0,e.styles.textAlign){case 1:f+=x.width/2;break;case 2:f+=x.width}m=x.add(f,0,0,-x.height/2+1),this.ctx.save(),this.path([new Bl(x.left,x.top),new Bl(x.left+x.width,x.top),new Bl(x.left+x.width,x.top+x.height),new Bl(x.left,x.top+x.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new Ia(e.value,m),o.letterSpacing,d),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!ao(e.styles.display,2048))return[3,20];if(null===e.styles.listStyleImage)return[3,19];if(0!==(g=e.styles.listStyleImage).type)return[3,18];_=void 0,y=g.url,n.label=15;case 15:return n.trys.push([15,17,,18]),[4,this.context.cache.match(y)];case 16:return _=n.sent(),this.ctx.drawImage(_,e.bounds.left-(_.width+10),e.bounds.top),[3,18];case 17:return n.sent(),this.context.logger.error("Error loading list-style-image "+y),[3,18];case 18:return[3,20];case 19:t.listValue&&-1!==e.styles.listStyleType&&(v=this.createFontStyle(o)[0],this.ctx.font=v,this.ctx.fillStyle=ni(o.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",x=new a(e.bounds.left,e.bounds.top+qr(e.styles.paddingTop,e.bounds.width),e.bounds.width,bn(o.lineHeight,o.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new Ia(t.listValue,x),o.letterSpacing,bn(o.lineHeight,o.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),n.label=20;case 20:return[2]}}))}))},r.prototype.renderStackContent=function(t){return i(this,void 0,void 0,(function(){var e,r,i,o,a,s,l,c,u,h,A,p,d,f,m;return n(this,(function(n){switch(n.label){case 0:return ao(t.element.container.flags,16),[4,this.renderNodeBackgroundAndBorders(t.element)];case 1:n.sent(),e=0,r=t.negativeZIndex,n.label=2;case 2:return e<r.length?(m=r[e],[4,this.renderStack(m)]):[3,5];case 3:n.sent(),n.label=4;case 4:return e++,[3,2];case 5:return[4,this.renderNodeContent(t.element)];case 6:n.sent(),i=0,o=t.nonInlineLevel,n.label=7;case 7:return i<o.length?(m=o[i],[4,this.renderNode(m)]):[3,10];case 8:n.sent(),n.label=9;case 9:return i++,[3,7];case 10:a=0,s=t.nonPositionedFloats,n.label=11;case 11:return a<s.length?(m=s[a],[4,this.renderStack(m)]):[3,14];case 12:n.sent(),n.label=13;case 13:return a++,[3,11];case 14:l=0,c=t.nonPositionedInlineLevel,n.label=15;case 15:return l<c.length?(m=c[l],[4,this.renderStack(m)]):[3,18];case 16:n.sent(),n.label=17;case 17:return l++,[3,15];case 18:u=0,h=t.inlineLevel,n.label=19;case 19:return u<h.length?(m=h[u],[4,this.renderNode(m)]):[3,22];case 20:n.sent(),n.label=21;case 21:return u++,[3,19];case 22:A=0,p=t.zeroOrAutoZIndexOrTransformedOrOpacity,n.label=23;case 23:return A<p.length?(m=p[A],[4,this.renderStack(m)]):[3,26];case 24:n.sent(),n.label=25;case 25:return A++,[3,23];case 26:d=0,f=t.positiveZIndex,n.label=27;case 27:return d<f.length?(m=f[d],[4,this.renderStack(m)]):[3,30];case 28:n.sent(),n.label=29;case 29:return d++,[3,27];case 30:return[2]}}))}))},r.prototype.mask=function(t){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(t.slice(0).reverse()),this.ctx.closePath()},r.prototype.path=function(t){this.ctx.beginPath(),this.formatPath(t),this.ctx.closePath()},r.prototype.formatPath=function(t){var e=this;t.forEach((function(t,r){var i=Tl(t)?t.start:t;0===r?e.ctx.moveTo(i.x,i.y):e.ctx.lineTo(i.x,i.y),Tl(t)&&e.ctx.bezierCurveTo(t.startControl.x,t.startControl.y,t.endControl.x,t.endControl.y,t.end.x,t.end.y)}))},r.prototype.renderRepeat=function(t,e,r,i){this.path(t),this.ctx.fillStyle=e,this.ctx.translate(r,i),this.ctx.fill(),this.ctx.translate(-r,-i)},r.prototype.resizeImage=function(t,e,r){var i;if(t.width===e&&t.height===r)return t;var n=(null!==(i=this.canvas.ownerDocument)&&void 0!==i?i:document).createElement("canvas");return n.width=Math.max(1,e),n.height=Math.max(1,r),n.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,e,r),n},r.prototype.renderBackgroundImage=function(t){return i(this,void 0,void 0,(function(){var e,r,i,o,a,s;return n(this,(function(l){switch(l.label){case 0:e=t.styles.backgroundImage.length-1,r=function(r){var o,a,s,l,c,u,h,A,p,d,f,m,g,_,y,v,x,w,b,B,C,E,T,I,S,M,F,P,L,D,U;return n(this,(function(n){switch(n.label){case 0:if(0!==r.type)return[3,5];o=void 0,a=r.url,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,i.context.cache.match(a)];case 2:return o=n.sent(),[3,4];case 3:return n.sent(),i.context.logger.error("Error loading background-image "+a),[3,4];case 4:return o&&(s=rc(t,e,[o.width,o.height,o.width/o.height]),v=s[0],E=s[1],T=s[2],b=s[3],B=s[4],_=i.ctx.createPattern(i.resizeImage(o,b,B),"repeat"),i.renderRepeat(v,_,E,T)),[3,6];case 5:Li(r)?(l=rc(t,e,[null,null,null]),v=l[0],E=l[1],T=l[2],b=l[3],B=l[4],c=_i(r.angle,b,B),u=c[0],h=c[1],A=c[2],p=c[3],d=c[4],(f=document.createElement("canvas")).width=b,f.height=B,m=f.getContext("2d"),g=m.createLinearGradient(h,p,A,d),mi(r.stops,u).forEach((function(t){return g.addColorStop(t.stop,ni(t.color))})),m.fillStyle=g,m.fillRect(0,0,b,B),b>0&&B>0&&(_=i.ctx.createPattern(f,"repeat"),i.renderRepeat(v,_,E,T))):Di(r)&&(y=rc(t,e,[null,null,null]),v=y[0],x=y[1],w=y[2],b=y[3],B=y[4],C=0===r.position.length?[jr]:r.position,E=qr(C[0],b),T=qr(C[C.length-1],B),I=xi(r,E,T,b,B),S=I[0],M=I[1],S>0&&M>0&&(F=i.ctx.createRadialGradient(x+E,w+T,0,x+E,w+T,S),mi(r.stops,2*S).forEach((function(t){return F.addColorStop(t.stop,ni(t.color))})),i.path(v),i.ctx.fillStyle=F,S!==M?(P=t.bounds.left+.5*t.bounds.width,L=t.bounds.top+.5*t.bounds.height,U=1/(D=M/S),i.ctx.save(),i.ctx.translate(P,L),i.ctx.transform(1,0,0,D,0,0),i.ctx.translate(-P,-L),i.ctx.fillRect(x,U*(w-L)+L,b,B*U),i.ctx.restore()):i.ctx.fill())),n.label=6;case 6:return e--,[2]}}))},i=this,o=0,a=t.styles.backgroundImage.slice(0).reverse(),l.label=1;case 1:return o<a.length?(s=a[o],[5,r(s)]):[3,4];case 2:l.sent(),l.label=3;case 3:return o++,[3,1];case 4:return[2]}}))}))},r.prototype.renderSolidBorder=function(t,e,r){return i(this,void 0,void 0,(function(){return n(this,(function(i){return this.path(Kl(r,e)),this.ctx.fillStyle=ni(t),this.ctx.fill(),[2]}))}))},r.prototype.renderDoubleBorder=function(t,e,r,o){return i(this,void 0,void 0,(function(){var i,a;return n(this,(function(n){switch(n.label){case 0:return e<3?[4,this.renderSolidBorder(t,r,o)]:[3,2];case 1:return n.sent(),[2];case 2:return i=ql(o,r),this.path(i),this.ctx.fillStyle=ni(t),this.ctx.fill(),a=Zl(o,r),this.path(a),this.ctx.fill(),[2]}}))}))},r.prototype.renderNodeBackgroundAndBorders=function(t){return i(this,void 0,void 0,(function(){var e,r,i,o,a,s,l,c,u=this;return n(this,(function(n){switch(n.label){case 0:return this.applyEffects(t.getEffects(2)),e=t.container.styles,r=!ii(e.backgroundColor)||e.backgroundImage.length,i=[{style:e.borderTopStyle,color:e.borderTopColor,width:e.borderTopWidth},{style:e.borderRightStyle,color:e.borderRightColor,width:e.borderRightWidth},{style:e.borderBottomStyle,color:e.borderBottomColor,width:e.borderBottomWidth},{style:e.borderLeftStyle,color:e.borderLeftColor,width:e.borderLeftWidth}],o=fc(ac(e.backgroundClip,0),t.curves),r||e.boxShadow.length?(this.ctx.save(),this.path(o),this.ctx.clip(),ii(e.backgroundColor)||(this.ctx.fillStyle=ni(e.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(t.container)]):[3,2];case 1:n.sent(),this.ctx.restore(),e.boxShadow.slice(0).reverse().forEach((function(e){u.ctx.save();var r=Ml(t.curves),i=e.inset?0:Ac,n=Ql(r,-i+(e.inset?1:-1)*e.spread.number,(e.inset?1:-1)*e.spread.number,e.spread.number*(e.inset?-2:2),e.spread.number*(e.inset?-2:2));e.inset?(u.path(r),u.ctx.clip(),u.mask(n)):(u.mask(r),u.ctx.clip(),u.path(n)),u.ctx.shadowOffsetX=e.offsetX.number+i,u.ctx.shadowOffsetY=e.offsetY.number,u.ctx.shadowColor=ni(e.color),u.ctx.shadowBlur=e.blur.number,u.ctx.fillStyle=e.inset?ni(e.color):"rgba(0,0,0,1)",u.ctx.fill(),u.ctx.restore()})),n.label=2;case 2:a=0,s=0,l=i,n.label=3;case 3:return s<l.length?0!==(c=l[s]).style&&!ii(c.color)&&c.width>0?2!==c.style?[3,5]:[4,this.renderDashedDottedBorder(c.color,c.width,a,t.curves,2)]:[3,11]:[3,13];case 4:return n.sent(),[3,11];case 5:return 3!==c.style?[3,7]:[4,this.renderDashedDottedBorder(c.color,c.width,a,t.curves,3)];case 6:return n.sent(),[3,11];case 7:return 4!==c.style?[3,9]:[4,this.renderDoubleBorder(c.color,c.width,a,t.curves)];case 8:return n.sent(),[3,11];case 9:return[4,this.renderSolidBorder(c.color,a,t.curves)];case 10:n.sent(),n.label=11;case 11:a++,n.label=12;case 12:return s++,[3,3];case 13:return[2]}}))}))},r.prototype.renderDashedDottedBorder=function(t,e,r,o,a){return i(this,void 0,void 0,(function(){var i,s,l,c,u,h,A,p,d,f,m,g,_,y,v,x;return n(this,(function(n){return this.ctx.save(),i=Wl(o,r),s=Kl(o,r),2===a&&(this.path(s),this.ctx.clip()),Tl(s[0])?(l=s[0].start.x,c=s[0].start.y):(l=s[0].x,c=s[0].y),Tl(s[1])?(u=s[1].end.x,h=s[1].end.y):(u=s[1].x,h=s[1].y),A=0===r||2===r?Math.abs(l-u):Math.abs(c-h),this.ctx.beginPath(),3===a?this.formatPath(i):this.formatPath(s.slice(0,2)),p=e<3?3*e:2*e,d=e<3?2*e:e,3===a&&(p=e,d=e),f=!0,A<=2*p?f=!1:A<=2*p+d?(p*=m=A/(2*p+d),d*=m):(g=Math.floor((A+d)/(p+d)),_=(A-g*p)/(g-1),d=(y=(A-(g+1)*p)/g)<=0||Math.abs(d-_)<Math.abs(d-y)?_:y),f&&(3===a?this.ctx.setLineDash([0,p+d]):this.ctx.setLineDash([p,d])),3===a?(this.ctx.lineCap="round",this.ctx.lineWidth=e):this.ctx.lineWidth=2*e+1.1,this.ctx.strokeStyle=ni(t),this.ctx.stroke(),this.ctx.setLineDash([]),2===a&&(Tl(s[0])&&(v=s[3],x=s[0],this.ctx.beginPath(),this.formatPath([new Bl(v.end.x,v.end.y),new Bl(x.start.x,x.start.y)]),this.ctx.stroke()),Tl(s[1])&&(v=s[1],x=s[2],this.ctx.beginPath(),this.formatPath([new Bl(v.end.x,v.end.y),new Bl(x.start.x,x.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]}))}))},r.prototype.render=function(t){return i(this,void 0,void 0,(function(){var e;return n(this,(function(r){switch(r.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=ni(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),e=Gl(t),[4,this.renderStack(e)];case 1:return r.sent(),this.applyEffects([]),[2,this.canvas]}}))}))},r}(hc),dc=function(t){return t instanceof rs||t instanceof es||t instanceof ts&&t.type!==$a&&t.type!==Xa},fc=function(t,e){switch(t){case 0:return Ml(e);case 2:return Fl(e);default:return Pl(e)}},mc=function(t){switch(t){case 1:return"center";case 2:return"right";default:return"left"}},gc=["-apple-system","system-ui"],_c=function(t){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?t.filter((function(t){return-1===gc.indexOf(t)})):t},yc=function(t){function r(e,r){var i=t.call(this,e,r)||this;return i.canvas=r.canvas?r.canvas:document.createElement("canvas"),i.ctx=i.canvas.getContext("2d"),i.options=r,i.canvas.width=Math.floor(r.width*r.scale),i.canvas.height=Math.floor(r.height*r.scale),i.canvas.style.width=r.width+"px",i.canvas.style.height=r.height+"px",i.ctx.scale(i.options.scale,i.options.scale),i.ctx.translate(-r.x,-r.y),i.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+r.width+"x"+r.height+" at "+r.x+","+r.y+") with scale "+r.scale),i}return e(r,t),r.prototype.render=function(t){return i(this,void 0,void 0,(function(){var e,r;return n(this,(function(i){switch(i.label){case 0:return e=Ca(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,t),[4,vc(e)];case 1:return r=i.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=ni(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(r,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}}))}))},r}(hc),vc=function(t){return new Promise((function(e,r){var i=new Image;i.onload=function(){e(i)},i.onerror=r,i.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(t))}))},xc=function(){function t(t){var e=t.id,r=t.enabled;this.id=e,this.enabled=r,this.start=Date.now()}return t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.debug?console.debug.apply(console,o([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t))},t.prototype.getTime=function(){return Date.now()-this.start},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&"undefined"!=typeof window&&window.console&&"function"==typeof console.info&&console.info.apply(console,o([this.id,this.getTime()+"ms"],t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.warn?console.warn.apply(console,o([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.error?console.error.apply(console,o([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t))},t.instances={},t}(),wc=function(){function t(e,r){var i;this.windowBounds=r,this.instanceName="#"+t.instanceCount++,this.logger=new xc({id:this.instanceName,enabled:e.logging}),this.cache=null!==(i=e.cache)&&void 0!==i?i:new fl(this,e)}return t.instanceCount=1,t}(),bc=function(t,e){return void 0===e&&(e={}),Bc(t,e)};"undefined"!=typeof window&&dl.setContext(window);var Bc=function(t,e){return i(void 0,void 0,void 0,(function(){var i,o,c,u,h,A,p,d,f,m,g,_,y,v,x,w,b,B,C,E,T,I,S,M,F,P,L,D,U,k,z,R,O,Q,N,V,H,j;return n(this,(function(n){switch(n.label){case 0:if(!t||"object"!==Ze(t))return[2,Promise.reject("Invalid element provided as first argument")];if(!(i=t.ownerDocument))throw new Error("Element is not attached to a Document");if(!(o=i.defaultView))throw new Error("Document is not attached to a Window");return c={allowTaint:null!==(I=e.allowTaint)&&void 0!==I&&I,imageTimeout:null!==(S=e.imageTimeout)&&void 0!==S?S:15e3,proxy:e.proxy,useCORS:null!==(M=e.useCORS)&&void 0!==M&&M},u=r({logging:null===(F=e.logging)||void 0===F||F,cache:e.cache},c),h={windowWidth:null!==(P=e.windowWidth)&&void 0!==P?P:o.innerWidth,windowHeight:null!==(L=e.windowHeight)&&void 0!==L?L:o.innerHeight,scrollX:null!==(D=e.scrollX)&&void 0!==D?D:o.pageXOffset,scrollY:null!==(U=e.scrollY)&&void 0!==U?U:o.pageYOffset},A=new a(h.scrollX,h.scrollY,h.windowWidth,h.windowHeight),p=new wc(u,A),d=null!==(k=e.foreignObjectRendering)&&void 0!==k&&k,f={allowTaint:null!==(z=e.allowTaint)&&void 0!==z&&z,onclone:e.onclone,ignoreElements:e.ignoreElements,inlineImages:d,copyStyles:d},p.logger.debug("Starting document clone with size "+A.width+"x"+A.height+" scrolled to "+-A.left+","+-A.top),m=new Xs(p,t,f),(g=m.clonedReferenceElement)?[4,m.toIFrame(i,A)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return _=n.sent(),y=ys(g)||gs(g)?l(g.ownerDocument):s(p,g),v=y.width,x=y.height,w=y.left,b=y.top,B=Cc(p,g,e.backgroundColor),C={canvas:e.canvas,backgroundColor:B,scale:null!==(O=null!==(R=e.scale)&&void 0!==R?R:o.devicePixelRatio)&&void 0!==O?O:1,x:(null!==(Q=e.x)&&void 0!==Q?Q:0)+w,y:(null!==(N=e.y)&&void 0!==N?N:0)+b,width:null!==(V=e.width)&&void 0!==V?V:Math.ceil(v),height:null!==(H=e.height)&&void 0!==H?H:Math.ceil(x)},d?(p.logger.debug("Document cloned, using foreign object rendering"),[4,new yc(p,C).render(g)]):[3,3];case 2:return E=n.sent(),[3,5];case 3:return p.logger.debug("Document cloned, element located at "+w+","+b+" with size "+v+"x"+x+" using computed rendering"),p.logger.debug("Starting DOM parsing"),T=ss(p,g),B===T.styles.backgroundColor&&(T.styles.backgroundColor=Ai.TRANSPARENT),p.logger.debug("Starting renderer for element at "+C.x+","+C.y+" with size "+C.width+"x"+C.height),[4,new pc(p,C).render(T)];case 4:E=n.sent(),n.label=5;case 5:return(null===(j=e.removeContainer)||void 0===j||j)&&(Xs.destroy(_)||p.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),p.logger.debug("Finished rendering"),[2,E]}}))}))},Cc=function(t,e,r){var i=e.ownerDocument,n=i.documentElement?hi(t,getComputedStyle(i.documentElement).backgroundColor):Ai.TRANSPARENT,o=i.body?hi(t,getComputedStyle(i.body).backgroundColor):Ai.TRANSPARENT,a="string"==typeof r?hi(t,r):null===r?Ai.TRANSPARENT:4294967295;return e===i.documentElement?ii(n)?ii(o)?a:o:n:a};return bc}()}));var tx=Zl.right,ex=Ee("reduceRight");kt({target:"Array",proto:!0,forced:!ex||!Dn&&re>79&&re<83},{reduceRight:function(t){return tx(this,t,arguments.length,arguments.length>1?arguments[1]:void 0)}}),kt({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991});var rx=cn.onFreeze,ix=Object.freeze,nx=o((function(){ix(1)}));kt({target:"Object",stat:!0,forced:nx,sham:!ln},{freeze:function(t){return ix&&y(t)?ix(rx(t)):t}});var ox=S.f,ax=o((function(){ox(1)}));kt({target:"Object",stat:!0,forced:!a||ax,sham:!a},{getOwnPropertyDescriptor:function(t,e){return ox(_(t),e)}});var sx=nr.f,lx=o((function(){return!Object.getOwnPropertyNames(1)}));kt({target:"Object",stat:!0,forced:lx},{getOwnPropertyNames:sx});var cx=Object.isExtensible,ux=o((function(){cx(1)}));kt({target:"Object",stat:!0,forced:ux},{isExtensible:function(t){return!!y(t)&&(!cx||cx(t))}});var hx=Object.isFrozen,Ax=o((function(){hx(1)}));kt({target:"Object",stat:!0,forced:Ax},{isFrozen:function(t){return!y(t)||!!hx&&hx(t)}});var px=Object.isSealed,dx=o((function(){px(1)}));kt({target:"Object",stat:!0,forced:dx},{isSealed:function(t){return!y(t)||!!px&&px(t)}});var fx=cn.onFreeze,mx=Object.preventExtensions,gx=o((function(){mx(1)}));kt({target:"Object",stat:!0,forced:gx,sham:!ln},{preventExtensions:function(t){return mx&&y(t)?mx(fx(t)):t}});var _x=cn.onFreeze,yx=Object.seal,vx=o((function(){yx(1)}));kt({target:"Object",stat:!0,forced:vx,sham:!ln},{seal:function(t){return yx&&y(t)?yx(_x(t)):t}});var xx=S.f,wx="".endsWith,bx=Math.min,Bx=Pa("endsWith"),Cx=!Bx&&!!function(){var t=xx(String.prototype,"endsWith");return t&&!t.writable}();kt({target:"String",proto:!0,forced:!Cx&&!Bx},{endsWith:function(t){var e=String(m(this));Ma(t);var r=arguments.length>1?arguments[1]:void 0,i=dt(e.length),n=void 0===r?i:bx(dt(r),i),o=String(t);return wx?wx.call(e,o,n):e.slice(n-o.length,n)===o}}),kt({target:"String",proto:!0,forced:qa("fixed")},{fixed:function(){return Ka(this,"tt","","")}}),kt({target:"String",proto:!0,forced:qa("sub")},{sub:function(){return Ka(this,"sub","","")}}),al("Int8",(function(t){return function(e,r,i){return t(this,e,r,i)}})),al("Int16",(function(t){return function(e,r,i){return t(this,e,r,i)}})),al("Uint8",(function(t){return function(e,r,i){return t(this,e,r,i)}}),!0);var Ex=Kt("iterator"),Tx=!o((function(){var t=new URL("b?a=1&b=2&c=3","http://a"),e=t.searchParams,r="";return t.pathname="c%20d",e.forEach((function(t,i){e.delete("b"),r+=i+t})),!e.sort||"http://a/c%20d?a=1&c=3"!==t.href||"3"!==e.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!e[Ex]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://тест").host||"#%D0%B1"!==new URL("http://a#б").hash||"a1c3"!==r||"x"!==new URL("http://x",void 0).host})),Ix=2147483647,Sx=/[^\0-\u007E]/,Mx=/[.\u3002\uFF0E\uFF61]/g,Fx="Overflow: input needs wider integers to process",Px=Math.floor,Lx=String.fromCharCode,Dx=function(t){return t+22+75*(t<26)},Ux=function(t,e,r){var i=0;for(t=r?Px(t/700):t>>1,t+=Px(t/e);t>455;i+=36)t=Px(t/35);return Px(i+36*t/(t+38))},kx=function(t){var e=[];t=function(t){for(var e=[],r=0,i=t.length;r<i;){var n=t.charCodeAt(r++);if(n>=55296&&n<=56319&&r<i){var o=t.charCodeAt(r++);56320==(64512&o)?e.push(((1023&n)<<10)+(1023&o)+65536):(e.push(n),r--)}else e.push(n)}return e}(t);var r,i,n=t.length,o=128,a=0,s=72;for(r=0;r<t.length;r++)(i=t[r])<128&&e.push(Lx(i));var l=e.length,c=l;for(l&&e.push("-");c<n;){var u=Ix;for(r=0;r<t.length;r++)(i=t[r])>=o&&i<u&&(u=i);var h=c+1;if(u-o>Px((Ix-a)/h))throw RangeError(Fx);for(a+=(u-o)*h,o=u,r=0;r<t.length;r++){if((i=t[r])<o&&++a>Ix)throw RangeError(Fx);if(i==o){for(var A=a,p=36;;p+=36){var d=p<=s?1:p>=s+26?26:p-s;if(A<d)break;var f=A-d,m=36-d;e.push(Lx(Dx(d+f%m))),A=Px(f/m)}e.push(Lx(Dx(A))),s=Ux(a,h,c==l),a=0,++c}}++a,++o}return e.join("")},zx=function(t){var e=mi(t);if("function"!=typeof e)throw TypeError(String(t)+" is not iterable");return M(e.call(t))},Rx=ct("fetch"),Ox=ct("Headers"),Qx=Kt("iterator"),Nx="URLSearchParams",Vx=Nx+"Iterator",Hx=ot.set,jx=ot.getterFor(Nx),Gx=ot.getterFor(Vx),Kx=/\+/g,qx=Array(4),Zx=function(t){return qx[t-1]||(qx[t-1]=RegExp("((?:%[\\da-f]{2}){"+t+"})","gi"))},Wx=function(t){try{return decodeURIComponent(t)}catch(e){return t}},Xx=function(t){var e=t.replace(Kx," "),r=4;try{return decodeURIComponent(e)}catch(t){for(;r;)e=e.replace(Zx(r--),Wx);return e}},$x=/[!'()~]|%20/g,Yx={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Jx=function(t){return Yx[t]},tw=function(t){return encodeURIComponent(t).replace($x,Jx)},ew=function(t,e){if(e)for(var r,i,n=e.split("&"),o=0;o<n.length;)(r=n[o++]).length&&(i=r.split("="),t.push({key:Xx(i.shift()),value:Xx(i.join("="))}))},rw=function(t){this.entries.length=0,ew(this.entries,t)},iw=function(t,e){if(t<e)throw TypeError("Not enough arguments")},nw=zi((function(t,e){Hx(this,{type:Vx,iterator:zx(jx(t).entries),kind:e})}),"Iterator",(function(){var t=Gx(this),e=t.kind,r=t.iterator.next(),i=r.value;return r.done||(r.value="keys"===e?i.key:"values"===e?i.value:[i.key,i.value]),r})),ow=function(){An(this,ow,Nx);var t,e,r,i,n,o,a,s,l,c=arguments.length>0?arguments[0]:void 0,u=[];if(Hx(this,{type:Nx,entries:u,updateURL:function(){},updateSearchParams:rw}),void 0!==c)if(y(c))if("function"==typeof(t=mi(c)))for(r=(e=t.call(c)).next;!(i=r.call(e)).done;){if((a=(o=(n=zx(M(i.value))).next).call(n)).done||(s=o.call(n)).done||!o.call(n).done)throw TypeError("Expected sequence with length 2");u.push({key:a.value+"",value:s.value+""})}else for(l in c)w(c,l)&&u.push({key:l,value:c[l]+""});else ew(u,"string"==typeof c?"?"===c.charAt(0)?c.slice(1):c:c+"")},aw=ow.prototype;fn(aw,{append:function(t,e){iw(arguments.length,2);var r=jx(this);r.entries.push({key:t+"",value:e+""}),r.updateURL()},delete:function(t){iw(arguments.length,1);for(var e=jx(this),r=e.entries,i=t+"",n=0;n<r.length;)r[n].key===i?r.splice(n,1):n++;e.updateURL()},get:function(t){iw(arguments.length,1);for(var e=jx(this).entries,r=t+"",i=0;i<e.length;i++)if(e[i].key===r)return e[i].value;return null},getAll:function(t){iw(arguments.length,1);for(var e=jx(this).entries,r=t+"",i=[],n=0;n<e.length;n++)e[n].key===r&&i.push(e[n].value);return i},has:function(t){iw(arguments.length,1);for(var e=jx(this).entries,r=t+"",i=0;i<e.length;)if(e[i++].key===r)return!0;return!1},set:function(t,e){iw(arguments.length,1);for(var r,i=jx(this),n=i.entries,o=!1,a=t+"",s=e+"",l=0;l<n.length;l++)(r=n[l]).key===a&&(o?n.splice(l--,1):(o=!0,r.value=s));o||n.push({key:a,value:s}),i.updateURL()},sort:function(){var t,e,r,i=jx(this),n=i.entries,o=n.slice();for(n.length=0,r=0;r<o.length;r++){for(t=o[r],e=0;e<r;e++)if(n[e].key>t.key){n.splice(e,0,t);break}e===r&&n.push(t)}i.updateURL()},forEach:function(t){for(var e,r=jx(this).entries,i=Rt(t,arguments.length>1?arguments[1]:void 0,3),n=0;n<r.length;)i((e=r[n++]).value,e.key,this)},keys:function(){return new nw(this,"keys")},values:function(){return new nw(this,"values")},entries:function(){return new nw(this,"entries")}},{enumerable:!0}),at(aw,Qx,aw.entries),at(aw,"toString",(function(){for(var t,e=jx(this).entries,r=[],i=0;i<e.length;)t=e[i++],r.push(tw(t.key)+"="+tw(t.value));return r.join("&")}),{enumerable:!0}),ur(ow,Nx),kt({global:!0,forced:!Tx},{URLSearchParams:ow}),Tx||"function"!=typeof Rx||"function"!=typeof Ox||kt({global:!0,enumerable:!0,forced:!0},{fetch:function(t){var e,r,i,n=[t];return arguments.length>1&&(y(e=arguments[1])&&(r=e.body,di(r)===Nx&&((i=e.headers?new Ox(e.headers):new Ox).has("content-type")||i.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),e=ge(e,{body:h(0,String(r)),headers:h(0,i)}))),n.push(e)),Rx.apply(this,n)}});var sw,lw={URLSearchParams:ow,getState:jx},cw=la.codeAt,uw=n.URL,hw=lw.URLSearchParams,Aw=lw.getState,pw=ot.set,dw=ot.getterFor("URL"),fw=Math.floor,mw=Math.pow,gw="Invalid scheme",_w="Invalid host",yw="Invalid port",vw=/[A-Za-z]/,xw=/[\d+-.A-Za-z]/,ww=/\d/,bw=/^(0x|0X)/,Bw=/^[0-7]+$/,Cw=/^\d+$/,Ew=/^[\dA-Fa-f]+$/,Tw=/[\u0000\t\u000A\u000D #%/:?@[\\]]/,Iw=/[\u0000\t\u000A\u000D #/:?@[\\]]/,Sw=/^[\u0000-\u001F ]+|[\u0000-\u001F ]+$/g,Mw=/[\t\u000A\u000D]/g,Fw=function(t,e){var r,i,n;if("["==e.charAt(0)){if("]"!=e.charAt(e.length-1))return _w;if(!(r=Lw(e.slice(1,-1))))return _w;t.host=r}else if(Nw(t)){if(e=function(t){var e,r,i=[],n=t.toLowerCase().replace(Mx,".").split(".");for(e=0;e<n.length;e++)r=n[e],i.push(Sx.test(r)?"xn--"+kx(r):r);return i.join(".")}(e),Tw.test(e))return _w;if(null===(r=Pw(e)))return _w;t.host=r}else{if(Iw.test(e))return _w;for(r="",i=gi(e),n=0;n<i.length;n++)r+=Ow(i[n],Uw);t.host=r}},Pw=function(t){var e,r,i,n,o,a,s,l=t.split(".");if(l.length&&""==l[l.length-1]&&l.pop(),(e=l.length)>4)return t;for(r=[],i=0;i<e;i++){if(""==(n=l[i]))return t;if(o=10,n.length>1&&"0"==n.charAt(0)&&(o=bw.test(n)?16:8,n=n.slice(8==o?1:2)),""===n)a=0;else{if(!(10==o?Cw:8==o?Bw:Ew).test(n))return t;a=parseInt(n,o)}r.push(a)}for(i=0;i<e;i++)if(a=r[i],i==e-1){if(a>=mw(256,5-e))return null}else if(a>255)return null;for(s=r.pop(),i=0;i<r.length;i++)s+=r[i]*mw(256,3-i);return s},Lw=function(t){var e,r,i,n,o,a,s,l=[0,0,0,0,0,0,0,0],c=0,u=null,h=0,A=function(){return t.charAt(h)};if(":"==A()){if(":"!=t.charAt(1))return;h+=2,u=++c}for(;A();){if(8==c)return;if(":"!=A()){for(e=r=0;r<4&&Ew.test(A());)e=16*e+parseInt(A(),16),h++,r++;if("."==A()){if(0==r)return;if(h-=r,c>6)return;for(i=0;A();){if(n=null,i>0){if(!("."==A()&&i<4))return;h++}if(!ww.test(A()))return;for(;ww.test(A());){if(o=parseInt(A(),10),null===n)n=o;else{if(0==n)return;n=10*n+o}if(n>255)return;h++}l[c]=256*l[c]+n,2!=++i&&4!=i||c++}if(4!=i)return;break}if(":"==A()){if(h++,!A())return}else if(A())return;l[c++]=e}else{if(null!==u)return;h++,u=++c}}if(null!==u)for(a=c-u,c=7;0!=c&&a>0;)s=l[c],l[c--]=l[u+a-1],l[u+--a]=s;else if(8!=c)return;return l},Dw=function(t){var e,r,i,n;if("number"==typeof t){for(e=[],r=0;r<4;r++)e.unshift(t%256),t=fw(t/256);return e.join(".")}if("object"==typeof t){for(e="",i=function(t){for(var e=null,r=1,i=null,n=0,o=0;o<8;o++)0!==t[o]?(n>r&&(e=i,r=n),i=null,n=0):(null===i&&(i=o),++n);return n>r&&(e=i,r=n),e}(t),r=0;r<8;r++)n&&0===t[r]||(n&&(n=!1),i===r?(e+=r?":":"::",n=!0):(e+=t[r].toString(16),r<7&&(e+=":")));return"["+e+"]"}return t},Uw={},kw=Cn({},Uw,{" ":1,'"':1,"<":1,">":1,"`":1}),zw=Cn({},kw,{"#":1,"?":1,"{":1,"}":1}),Rw=Cn({},zw,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Ow=function(t,e){var r=cw(t,0);return r>32&&r<127&&!w(e,t)?t:encodeURIComponent(t)},Qw={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Nw=function(t){return w(Qw,t.scheme)},Vw=function(t){return""!=t.username||""!=t.password},Hw=function(t){return!t.host||t.cannotBeABaseURL||"file"==t.scheme},jw=function(t,e){var r;return 2==t.length&&vw.test(t.charAt(0))&&(":"==(r=t.charAt(1))||!e&&"|"==r)},Gw=function(t){var e;return t.length>1&&jw(t.slice(0,2))&&(2==t.length||"/"===(e=t.charAt(2))||"\\"===e||"?"===e||"#"===e)},Kw=function(t){var e=t.path,r=e.length;!r||"file"==t.scheme&&1==r&&jw(e[0],!0)||e.pop()},qw=function(t){return"."===t||"%2e"===t.toLowerCase()},Zw={},Ww={},Xw={},$w={},Yw={},Jw={},tb={},eb={},rb={},ib={},nb={},ob={},ab={},sb={},lb={},cb={},ub={},hb={},Ab={},pb={},db={},fb=function(t,e,r,i){var n,o,a,s,l,c=r||Zw,u=0,h="",A=!1,p=!1,d=!1;for(r||(t.scheme="",t.username="",t.password="",t.host=null,t.port=null,t.path=[],t.query=null,t.fragment=null,t.cannotBeABaseURL=!1,e=e.replace(Sw,"")),e=e.replace(Mw,""),n=gi(e);u<=n.length;){switch(o=n[u],c){case Zw:if(!o||!vw.test(o)){if(r)return gw;c=Xw;continue}h+=o.toLowerCase(),c=Ww;break;case Ww:if(o&&(xw.test(o)||"+"==o||"-"==o||"."==o))h+=o.toLowerCase();else{if(":"!=o){if(r)return gw;h="",c=Xw,u=0;continue}if(r&&(Nw(t)!=w(Qw,h)||"file"==h&&(Vw(t)||null!==t.port)||"file"==t.scheme&&!t.host))return;if(t.scheme=h,r)return void(Nw(t)&&Qw[t.scheme]==t.port&&(t.port=null));h="","file"==t.scheme?c=sb:Nw(t)&&i&&i.scheme==t.scheme?c=$w:Nw(t)?c=eb:"/"==n[u+1]?(c=Yw,u++):(t.cannotBeABaseURL=!0,t.path.push(""),c=Ab)}break;case Xw:if(!i||i.cannotBeABaseURL&&"#"!=o)return gw;if(i.cannotBeABaseURL&&"#"==o){t.scheme=i.scheme,t.path=i.path.slice(),t.query=i.query,t.fragment="",t.cannotBeABaseURL=!0,c=db;break}c="file"==i.scheme?sb:Jw;continue;case $w:if("/"!=o||"/"!=n[u+1]){c=Jw;continue}c=rb,u++;break;case Yw:if("/"==o){c=ib;break}c=hb;continue;case Jw:if(t.scheme=i.scheme,o==sw)t.username=i.username,t.password=i.password,t.host=i.host,t.port=i.port,t.path=i.path.slice(),t.query=i.query;else if("/"==o||"\\"==o&&Nw(t))c=tb;else if("?"==o)t.username=i.username,t.password=i.password,t.host=i.host,t.port=i.port,t.path=i.path.slice(),t.query="",c=pb;else{if("#"!=o){t.username=i.username,t.password=i.password,t.host=i.host,t.port=i.port,t.path=i.path.slice(),t.path.pop(),c=hb;continue}t.username=i.username,t.password=i.password,t.host=i.host,t.port=i.port,t.path=i.path.slice(),t.query=i.query,t.fragment="",c=db}break;case tb:if(!Nw(t)||"/"!=o&&"\\"!=o){if("/"!=o){t.username=i.username,t.password=i.password,t.host=i.host,t.port=i.port,c=hb;continue}c=ib}else c=rb;break;case eb:if(c=rb,"/"!=o||"/"!=h.charAt(u+1))continue;u++;break;case rb:if("/"!=o&&"\\"!=o){c=ib;continue}break;case ib:if("@"==o){A&&(h="%40"+h),A=!0,a=gi(h);for(var f=0;f<a.length;f++){var m=a[f];if(":"!=m||d){var g=Ow(m,Rw);d?t.password+=g:t.username+=g}else d=!0}h=""}else if(o==sw||"/"==o||"?"==o||"#"==o||"\\"==o&&Nw(t)){if(A&&""==h)return"Invalid authority";u-=gi(h).length+1,h="",c=nb}else h+=o;break;case nb:case ob:if(r&&"file"==t.scheme){c=cb;continue}if(":"!=o||p){if(o==sw||"/"==o||"?"==o||"#"==o||"\\"==o&&Nw(t)){if(Nw(t)&&""==h)return _w;if(r&&""==h&&(Vw(t)||null!==t.port))return;if(s=Fw(t,h))return s;if(h="",c=ub,r)return;continue}"["==o?p=!0:"]"==o&&(p=!1),h+=o}else{if(""==h)return _w;if(s=Fw(t,h))return s;if(h="",c=ab,r==ob)return}break;case ab:if(!ww.test(o)){if(o==sw||"/"==o||"?"==o||"#"==o||"\\"==o&&Nw(t)||r){if(""!=h){var _=parseInt(h,10);if(_>65535)return yw;t.port=Nw(t)&&_===Qw[t.scheme]?null:_,h=""}if(r)return;c=ub;continue}return yw}h+=o;break;case sb:if(t.scheme="file","/"==o||"\\"==o)c=lb;else{if(!i||"file"!=i.scheme){c=hb;continue}if(o==sw)t.host=i.host,t.path=i.path.slice(),t.query=i.query;else if("?"==o)t.host=i.host,t.path=i.path.slice(),t.query="",c=pb;else{if("#"!=o){Gw(n.slice(u).join(""))||(t.host=i.host,t.path=i.path.slice(),Kw(t)),c=hb;continue}t.host=i.host,t.path=i.path.slice(),t.query=i.query,t.fragment="",c=db}}break;case lb:if("/"==o||"\\"==o){c=cb;break}i&&"file"==i.scheme&&!Gw(n.slice(u).join(""))&&(jw(i.path[0],!0)?t.path.push(i.path[0]):t.host=i.host),c=hb;continue;case cb:if(o==sw||"/"==o||"\\"==o||"?"==o||"#"==o){if(!r&&jw(h))c=hb;else if(""==h){if(t.host="",r)return;c=ub}else{if(s=Fw(t,h))return s;if("localhost"==t.host&&(t.host=""),r)return;h="",c=ub}continue}h+=o;break;case ub:if(Nw(t)){if(c=hb,"/"!=o&&"\\"!=o)continue}else if(r||"?"!=o)if(r||"#"!=o){if(o!=sw&&(c=hb,"/"!=o))continue}else t.fragment="",c=db;else t.query="",c=pb;break;case hb:if(o==sw||"/"==o||"\\"==o&&Nw(t)||!r&&("?"==o||"#"==o)){if(".."===(l=(l=h).toLowerCase())||"%2e."===l||".%2e"===l||"%2e%2e"===l?(Kw(t),"/"==o||"\\"==o&&Nw(t)||t.path.push("")):qw(h)?"/"==o||"\\"==o&&Nw(t)||t.path.push(""):("file"==t.scheme&&!t.path.length&&jw(h)&&(t.host&&(t.host=""),h=h.charAt(0)+":"),t.path.push(h)),h="","file"==t.scheme&&(o==sw||"?"==o||"#"==o))for(;t.path.length>1&&""===t.path[0];)t.path.shift();"?"==o?(t.query="",c=pb):"#"==o&&(t.fragment="",c=db)}else h+=Ow(o,zw);break;case Ab:"?"==o?(t.query="",c=pb):"#"==o?(t.fragment="",c=db):o!=sw&&(t.path[0]+=Ow(o,Uw));break;case pb:r||"#"!=o?o!=sw&&("'"==o&&Nw(t)?t.query+="%27":t.query+="#"==o?"%23":Ow(o,Uw)):(t.fragment="",c=db);break;case db:o!=sw&&(t.fragment+=Ow(o,kw))}u++}},mb=function(t){var e,r,i=An(this,mb,"URL"),n=arguments.length>1?arguments[1]:void 0,o=String(t),s=pw(i,{type:"URL"});if(void 0!==n)if(n instanceof mb)e=dw(n);else if(r=fb(e={},String(n)))throw TypeError(r);if(r=fb(s,o,null,e))throw TypeError(r);var l=s.searchParams=new hw,c=Aw(l);c.updateSearchParams(s.query),c.updateURL=function(){s.query=String(l)||null},a||(i.href=_b.call(i),i.origin=yb.call(i),i.protocol=vb.call(i),i.username=xb.call(i),i.password=wb.call(i),i.host=bb.call(i),i.hostname=Bb.call(i),i.port=Cb.call(i),i.pathname=Eb.call(i),i.search=Tb.call(i),i.searchParams=Ib.call(i),i.hash=Sb.call(i))},gb=mb.prototype,_b=function(){var t=dw(this),e=t.scheme,r=t.username,i=t.password,n=t.host,o=t.port,a=t.path,s=t.query,l=t.fragment,c=e+":";return null!==n?(c+="//",Vw(t)&&(c+=r+(i?":"+i:"")+"@"),c+=Dw(n),null!==o&&(c+=":"+o)):"file"==e&&(c+="//"),c+=t.cannotBeABaseURL?a[0]:a.length?"/"+a.join("/"):"",null!==s&&(c+="?"+s),null!==l&&(c+="#"+l),c},yb=function(){var t=dw(this),e=t.scheme,r=t.port;if("blob"==e)try{return new URL(e.path[0]).origin}catch(t){return"null"}return"file"!=e&&Nw(t)?e+"://"+Dw(t.host)+(null!==r?":"+r:""):"null"},vb=function(){return dw(this).scheme+":"},xb=function(){return dw(this).username},wb=function(){return dw(this).password},bb=function(){var t=dw(this),e=t.host,r=t.port;return null===e?"":null===r?Dw(e):Dw(e)+":"+r},Bb=function(){var t=dw(this).host;return null===t?"":Dw(t)},Cb=function(){var t=dw(this).port;return null===t?"":String(t)},Eb=function(){var t=dw(this),e=t.path;return t.cannotBeABaseURL?e[0]:e.length?"/"+e.join("/"):""},Tb=function(){var t=dw(this).query;return t?"?"+t:""},Ib=function(){return dw(this).searchParams},Sb=function(){var t=dw(this).fragment;return t?"#"+t:""},Mb=function(t,e){return{get:t,set:e,configurable:!0,enumerable:!0}};if(a&&ce(gb,{href:Mb(_b,(function(t){var e=dw(this),r=String(t),i=fb(e,r);if(i)throw TypeError(i);Aw(e.searchParams).updateSearchParams(e.query)})),origin:Mb(yb),protocol:Mb(vb,(function(t){var e=dw(this);fb(e,String(t)+":",Zw)})),username:Mb(xb,(function(t){var e=dw(this),r=gi(String(t));if(!Hw(e)){e.username="";for(var i=0;i<r.length;i++)e.username+=Ow(r[i],Rw)}})),password:Mb(wb,(function(t){var e=dw(this),r=gi(String(t));if(!Hw(e)){e.password="";for(var i=0;i<r.length;i++)e.password+=Ow(r[i],Rw)}})),host:Mb(bb,(function(t){var e=dw(this);e.cannotBeABaseURL||fb(e,String(t),nb)})),hostname:Mb(Bb,(function(t){var e=dw(this);e.cannotBeABaseURL||fb(e,String(t),ob)})),port:Mb(Cb,(function(t){var e=dw(this);Hw(e)||(""==(t=String(t))?e.port=null:fb(e,t,ab))})),pathname:Mb(Eb,(function(t){var e=dw(this);e.cannotBeABaseURL||(e.path=[],fb(e,t+"",ub))})),search:Mb(Tb,(function(t){var e=dw(this);""==(t=String(t))?e.query=null:("?"==t.charAt(0)&&(t=t.slice(1)),e.query="",fb(e,t,pb)),Aw(e.searchParams).updateSearchParams(e.query)})),searchParams:Mb(Ib),hash:Mb(Sb,(function(t){var e=dw(this);""!=(t=String(t))?("#"==t.charAt(0)&&(t=t.slice(1)),e.fragment="",fb(e,t,db)):e.fragment=null}))}),at(gb,"toJSON",(function(){return _b.call(this)}),{enumerable:!0}),at(gb,"toString",(function(){return _b.call(this)}),{enumerable:!0}),uw){var Fb=uw.createObjectURL,Pb=uw.revokeObjectURL;Fb&&at(mb,"createObjectURL",(function(t){return Fb.apply(uw,arguments)})),Pb&&at(mb,"revokeObjectURL",(function(t){return Pb.apply(uw,arguments)}))}ur(mb,"URL"),kt({global:!0,forced:!Tx,sham:!a},{URL:mb}),kt({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return URL.prototype.toString.call(this)}});"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var Lb,Db,Ub,kb=(Lb=function(t,e){t.exports=function(){var t,e,r;function i(i,n){if(t)if(e){var o="var sharedChunk = {}; ("+t+")(sharedChunk); ("+e+")(sharedChunk);",a={};t(a),r=n(a),"undefined"!=typeof window&&(r.workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"})))}else e=n;else t=n}return i(["exports"],(function(t){function e(t,e){return t(e={exports:{}},e.exports),e.exports}var r=i;function i(t,e,r,i){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(i-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=i,this.p2x=r,this.p2y=i}i.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},i.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},i.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},i.prototype.solveCurveX=function(t,e){var r,i,n,o,a;for(void 0===e&&(e=1e-6),n=t,a=0;a<8;a++){if(o=this.sampleCurveX(n)-t,Math.abs(o)<e)return n;var s=this.sampleCurveDerivativeX(n);if(Math.abs(s)<1e-6)break;n-=o/s}if((n=t)<(r=0))return r;if(n>(i=1))return i;for(;r<i;){if(o=this.sampleCurveX(n),Math.abs(o-t)<e)return n;t>o?r=n:i=n,n=.5*(i-r)+r}return n},i.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var n=o;function o(t,e){this.x=t,this.y=e}o.prototype={clone:function(){return new o(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),i=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=i,this},_rotateAround:function(t,e){var r=Math.cos(t),i=Math.sin(t),n=e.y+i*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-i*(this.y-e.y),this.y=n,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},o.convert=function(t){return t instanceof o?t:Array.isArray(t)?new o(t[0],t[1]):t};var a="undefined"!=typeof self?self:{},s=Math.pow(2,53)-1;function l(t,e,i,n){var o=new r(t,e,i,n);return function(t){return o.solve(t)}}var c=l(.25,.1,.25,1);function u(t,e,r){return Math.min(r,Math.max(e,t))}function h(t,e,r){var i=r-e,n=((t-e)%i+i)%i+e;return n===e?r:n}function A(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];for(var i=0,n=e;i<n.length;i+=1){var o=n[i];for(var a in o)t[a]=o[a]}return t}var p=1;function d(){return p++}function f(){return function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function m(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function g(t,e){t.forEach((function(t){e[t]&&(e[t]=e[t].bind(e))}))}function _(t,e){return-1!==t.indexOf(e,t.length-e.length)}function y(t,e,r){var i={};for(var n in t)i[n]=e.call(r||this,t[n],n,t);return i}function v(t,e,r){var i={};for(var n in t)e.call(r||this,t[n],n,t)&&(i[n]=t[n]);return i}function x(t){return Array.isArray(t)?t.map(x):"object"==Ze(t)&&t?y(t,x):t}var w={};function b(t){w[t]||("undefined"!=typeof console&&console.warn(t),w[t]=!0)}function B(t,e,r){return(r.y-t.y)*(e.x-t.x)>(e.y-t.y)*(r.x-t.x)}function C(t){for(var e=0,r=0,i=t.length,n=i-1,o=void 0,a=void 0;r<i;n=r++)e+=((a=t[n]).x-(o=t[r]).x)*(o.y+a.y);return e}function E(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function T(t){var e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(function(t,r,i,n){var o=i||n;return e[r]=!o||o.toLowerCase(),""})),e["max-age"]){var r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}var I=null;function S(t){if(null==I){var e=t.navigator?t.navigator.userAgent:null;I=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return I}function M(t){try{var e=a[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(t){return!1}}var F,P,L,D,U=a.performance&&a.performance.now?a.performance.now.bind(a.performance):Date.now.bind(Date),k=a.requestAnimationFrame||a.mozRequestAnimationFrame||a.webkitRequestAnimationFrame||a.msRequestAnimationFrame,z=a.cancelAnimationFrame||a.mozCancelAnimationFrame||a.webkitCancelAnimationFrame||a.msCancelAnimationFrame,R={now:U,frame:function(t){var e=k(t);return{cancel:function(){return z(e)}}},getImageData:function(t,e){void 0===e&&(e=0);var r=a.document.createElement("canvas"),i=r.getContext("2d");if(!i)throw new Error("failed to create canvas 2d context");return r.width=t.width,r.height=t.height,i.drawImage(t,0,0,t.width,t.height),i.getImageData(-e,-e,t.width+2*e,t.height+2*e)},resolveURL:function(t){return F||(F=a.document.createElement("a")),F.href=t,F.href},hardwareConcurrency:a.navigator&&a.navigator.hardwareConcurrency||4,get devicePixelRatio(){return a.devicePixelRatio},get prefersReducedMotion(){return!!a.matchMedia&&(null==P&&(P=a.matchMedia("(prefers-reduced-motion: reduce)")),P.matches)}},O={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Q={supported:!1,testSupport:function(t){!N&&D&&(V?H(t):L=t)}},N=!1,V=!1;function H(t){var e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,D),t.isContextLost())return;Q.supported=!0}catch(t){}t.deleteTexture(e),N=!0}a.document&&((D=a.document.createElement("img")).onload=function(){L&&H(L),L=null,V=!0},D.onerror=function(){N=!0,L=null},D.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var j="01",G=function(t,e){this._transformRequestFn=t,this._customAccessToken=e,this._createSkuToken()};function K(t){return 0===t.indexOf("mapbox:")}G.prototype._createSkuToken=function(){var t=function(){for(var t="",e=0;e<10;e++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",j,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},G.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},G.prototype.transformRequest=function(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}},G.prototype.normalizeStyleURL=function(t,e){if(!K(t))return t;var r=X(t);return r.path="/styles/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||e)},G.prototype.normalizeGlyphsURL=function(t,e){if(!K(t))return t;var r=X(t);return r.path="/fonts/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||e)},G.prototype.normalizeSourceURL=function(t,e){if(!K(t))return t;var r=X(t);return r.path="/v4/"+r.authority+".json",r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||e)},G.prototype.normalizeSpriteURL=function(t,e,r,i){var n=X(t);return K(t)?(n.path="/styles/v1"+n.path+"/sprite"+e+r,this._makeAPIURL(n,this._customAccessToken||i)):(n.path+=""+e+r,$(n))},G.prototype.normalizeTileURL=function(t,e){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!K(t))return t;var r=X(t);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,(R.devicePixelRatio>=2||512===e?"@2x":"")+(Q.supported?".webp":"$1")),r.path=r.path.replace(/^.+\/v4\//,"/"),r.path="/v4"+r.path;var i=this._customAccessToken||function(t){for(var e=0,r=t;e<r.length;e+=1){var i=r[e].match(/^access_token=(.*)$/);if(i)return i[1]}return null}(r.params)||O.ACCESS_TOKEN;return O.REQUIRE_ACCESS_TOKEN&&i&&this._skuToken&&r.params.push("sku="+this._skuToken),this._makeAPIURL(r,i)},G.prototype.canonicalizeTileURL=function(t,e){var r=X(t);if(!r.path.match(/(^\/v4\/)/)||!r.path.match(/\.[\w]+$/))return t;var i="mapbox://tiles/";i+=r.path.replace("/v4/","");var n=r.params;return e&&(n=n.filter((function(t){return!t.match(/^access_token=/)}))),n.length&&(i+="?"+n.join("&")),i},G.prototype.canonicalizeTileset=function(t,e){for(var r=!!e&&K(e),i=[],n=0,o=t.tiles||[];n<o.length;n+=1){var a=o[n];Z(a)?i.push(this.canonicalizeTileURL(a,r)):i.push(a)}return i},G.prototype._makeAPIURL=function(t,e){var r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",i=X(O.API_URL);if(t.protocol=i.protocol,t.authority=i.authority,"http"===t.protocol){var n=t.params.indexOf("secure");n>=0&&t.params.splice(n,1)}if("/"!==i.path&&(t.path=""+i.path+t.path),!O.REQUIRE_ACCESS_TOKEN)return $(t);if(!(e=e||O.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+r);if("s"===e[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+r);return t.params=t.params.filter((function(t){return-1===t.indexOf("access_token")})),t.params.push("access_token="+e),$(t)};var q=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function Z(t){return q.test(t)}var W=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function X(t){var e=t.match(W);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function $(t){var e=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+e}function Y(t){if(!t)return null;var e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(a.atob(e[1]).split("").map((function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)})).join("")))}catch(t){return null}}var J=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};J.prototype.getStorageKey=function(t){var e,r=Y(O.ACCESS_TOKEN);return e=r&&r.u?a.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(function(t,e){return String.fromCharCode(Number("0x"+e))}))):O.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+e:"mapbox.eventData:"+e},J.prototype.fetchEventData=function(){var t=M("localStorage"),e=this.getStorageKey(),r=this.getStorageKey("uuid");if(t)try{var i=a.localStorage.getItem(e);i&&(this.eventData=JSON.parse(i));var n=a.localStorage.getItem(r);n&&(this.anonId=n)}catch(t){b("Unable to read from LocalStorage")}},J.prototype.saveEventData=function(){var t=M("localStorage"),e=this.getStorageKey(),r=this.getStorageKey("uuid");if(t)try{a.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&a.localStorage.setItem(e,JSON.stringify(this.eventData))}catch(t){b("Unable to write to LocalStorage")}},J.prototype.processRequests=function(t){},J.prototype.postEvent=function(t,e,r,i){var n=this;if(O.EVENTS_URL){var o=X(O.EVENTS_URL);o.params.push("access_token="+(i||O.ACCESS_TOKEN||""));var a={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:j,userId:this.anonId},s=e?A(a,e):a,l={url:$(o),headers:{"Content-Type":"text/plain"},body:JSON.stringify([s])};this.pendingRequest=xt(l,(function(t){n.pendingRequest=null,r(t),n.saveEventData(),n.processRequests(i)}))}},J.prototype.queueRequest=function(t,e){this.queue.push(t),this.processRequests(e)};var tt,et,rt=function(t){function e(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.postMapLoadEvent=function(t,e,r,i){this.skuToken=r,(O.EVENTS_URL&&i||O.ACCESS_TOKEN&&Array.isArray(t)&&t.some((function(t){return K(t)||Z(t)})))&&this.queueRequest({id:e,timestamp:Date.now()},i)},e.prototype.processRequests=function(t){var e=this;if(!this.pendingRequest&&0!==this.queue.length){var r=this.queue.shift(),i=r.id,n=r.timestamp;i&&this.success[i]||(this.anonId||this.fetchEventData(),m(this.anonId)||(this.anonId=f()),this.postEvent(n,{skuToken:this.skuToken},(function(t){t||i&&(e.success[i]=!0)}),t))}},e}(J),it=new(function(t){function e(e){t.call(this,"appUserTurnstile"),this._customAccessToken=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.postTurnstileEvent=function(t,e){O.EVENTS_URL&&O.ACCESS_TOKEN&&Array.isArray(t)&&t.some((function(t){return K(t)||Z(t)}))&&this.queueRequest(Date.now(),e)},e.prototype.processRequests=function(t){var e=this;if(!this.pendingRequest&&0!==this.queue.length){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var r=Y(O.ACCESS_TOKEN),i=r?r.u:O.ACCESS_TOKEN,n=i!==this.eventData.tokenU;m(this.anonId)||(this.anonId=f(),n=!0);var o=this.queue.shift();if(this.eventData.lastSuccess){var a=new Date(this.eventData.lastSuccess),s=new Date(o),l=(o-this.eventData.lastSuccess)/864e5;n=n||l>=1||l<-1||a.getDate()!==s.getDate()}else n=!0;if(!n)return this.processRequests();this.postEvent(o,{"enabled.telemetry":!1},(function(t){t||(e.eventData.lastSuccess=o,e.eventData.tokenU=i)}),t)}},e}(J)),nt=it.postTurnstileEvent.bind(it),ot=new rt,at=ot.postMapLoadEvent.bind(ot),st=500,lt=50;function ct(){a.caches&&!tt&&(tt=a.caches.open("mapbox-tiles"))}function ut(t){var e=t.indexOf("?");return e<0?t:t.slice(0,e)}var ht,At=1/0;function pt(){return null==ht&&(ht=a.OffscreenCanvas&&new a.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof a.createImageBitmap),ht}var dt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(dt);var ft,mt,gt=function(t){function e(e,r,i){401===r&&Z(i)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,e),this.status=r,this.url=i,this.name=this.constructor.name,this.message=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},e}(Error),_t=E()?function(){return self.worker&&self.worker.referrer}:function(){return("blob:"===a.location.protocol?a.parent:a).location.href},yt=function(t,e){if(!(/^file:/.test(r=t.url)||/^file:/.test(_t())&&!/^\w+:/.test(r))){if(a.fetch&&a.Request&&a.AbortController&&a.Request.prototype.hasOwnProperty("signal"))return function(t,e){var r,i=new a.AbortController,n=new a.Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:_t(),signal:i.signal}),o=!1,s=!1,l=(r=n.url).indexOf("sku=")>0&&Z(r);"json"===t.type&&n.headers.set("Accept","application/json");var c=function(r,i,o){if(!s){if(r&&"SecurityError"!==r.message&&b(r),i&&o)return u(i);var c=Date.now();a.fetch(n).then((function(r){if(r.ok){var i=l?r.clone():null;return u(r,i,c)}return e(new gt(r.statusText,r.status,t.url))})).catch((function(t){20!==t.code&&e(new Error(t.message))}))}},u=function(r,i,l){("arrayBuffer"===t.type?r.arrayBuffer():"json"===t.type?r.json():r.text()).then((function(t){s||(i&&l&&function(t,e,r){if(ct(),tt){var i={status:e.status,statusText:e.statusText,headers:new a.Headers};e.headers.forEach((function(t,e){return i.headers.set(e,t)}));var n=T(e.headers.get("Cache-Control")||"");n["no-store"]||(n["max-age"]&&i.headers.set("Expires",new Date(r+1e3*n["max-age"]).toUTCString()),new Date(i.headers.get("Expires")).getTime()-r<42e4||function(t,e){if(void 0===et)try{new Response(new ReadableStream),et=!0}catch(t){et=!1}et?e(t.body):t.blob().then(e)}(e,(function(e){var r=new a.Response(e,i);ct(),tt&&tt.then((function(e){return e.put(ut(t.url),r)})).catch((function(t){return b(t.message)}))})))}}(n,i,l),o=!0,e(null,t,r.headers.get("Cache-Control"),r.headers.get("Expires")))})).catch((function(t){s||e(new Error(t.message))}))};return l?function(t,e){if(ct(),!tt)return e(null);var r=ut(t.url);tt.then((function(t){t.match(r).then((function(i){var n=function(t){if(!t)return!1;var e=new Date(t.headers.get("Expires")||0),r=T(t.headers.get("Cache-Control")||"");return e>Date.now()&&!r["no-cache"]}(i);t.delete(r),n&&t.put(r,i.clone()),e(null,i,n)})).catch(e)})).catch(e)}(n,c):c(null,null),{cancel:function(){s=!0,o||i.abort()}}}(t,e);if(E()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var r;return function(t,e){var r=new a.XMLHttpRequest;for(var i in r.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(r.responseType="arraybuffer"),t.headers)r.setRequestHeader(i,t.headers[i]);return"json"===t.type&&(r.responseType="text",r.setRequestHeader("Accept","application/json")),r.withCredentials="include"===t.credentials,r.onerror=function(){e(new Error(r.statusText))},r.onload=function(){if((r.status>=200&&r.status<300||0===r.status)&&null!==r.response){var i=r.response;if("json"===t.type)try{i=JSON.parse(r.response)}catch(t){return e(t)}e(null,i,r.getResponseHeader("Cache-Control"),r.getResponseHeader("Expires"))}else e(new gt(r.statusText,r.status,t.url))},r.send(t.body),{cancel:function(){return r.abort()}}}(t,e)},vt=function(t,e){return yt(A(t,{type:"arrayBuffer"}),e)},xt=function(t,e){return yt(A(t,{method:"POST"}),e)},wt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";ft=[],mt=0;var bt=function t(e,r){if(Q.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),mt>=O.MAX_PARALLEL_IMAGE_REQUESTS){var i={requestParameters:e,callback:r,cancelled:!1,cancel:function(){this.cancelled=!0}};return ft.push(i),i}mt++;var n=!1,o=function(){if(!n)for(n=!0,mt--;ft.length&&mt<O.MAX_PARALLEL_IMAGE_REQUESTS;){var e=ft.shift();e.cancelled||(e.cancel=t(e.requestParameters,e.callback).cancel)}},s=vt(e,(function(t,e,i,n){o(),t?r(t):e&&(pt()?function(t,e){var r=new a.Blob([new Uint8Array(t)],{type:"image/png"});a.createImageBitmap(r).then((function(t){e(null,t)})).catch((function(t){e(new Error("Could not load image because of "+t.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))}))}(e,r):function(t,e,r,i){var n=new a.Image,o=a.URL;n.onload=function(){e(null,n),o.revokeObjectURL(n.src),n.onload=null,a.requestAnimationFrame((function(){n.src=wt}))},n.onerror=function(){return e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var s=new a.Blob([new Uint8Array(t)],{type:"image/png"});n.cacheControl=r,n.expires=i,n.src=t.byteLength?o.createObjectURL(s):wt}(e,r,i,n))}));return{cancel:function(){s.cancel(),o()}}};function Bt(t,e,r){r[t]&&-1!==r[t].indexOf(e)||(r[t]=r[t]||[],r[t].push(e))}function Ct(t,e,r){if(r&&r[t]){var i=r[t].indexOf(e);-1!==i&&r[t].splice(i,1)}}var Et=function(t,e){void 0===e&&(e={}),A(this,e),this.type=t},Tt=function(t){function e(e,r){void 0===r&&(r={}),t.call(this,"error",A({error:e},r))}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Et),It=function(){};It.prototype.on=function(t,e){return this._listeners=this._listeners||{},Bt(t,e,this._listeners),this},It.prototype.off=function(t,e){return Ct(t,e,this._listeners),Ct(t,e,this._oneTimeListeners),this},It.prototype.once=function(t,e){return this._oneTimeListeners=this._oneTimeListeners||{},Bt(t,e,this._oneTimeListeners),this},It.prototype.fire=function(t,e){"string"==typeof t&&(t=new Et(t,e||{}));var r=t.type;if(this.listens(r)){t.target=this;for(var i=0,n=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];i<n.length;i+=1)n[i].call(this,t);for(var o=0,a=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];o<a.length;o+=1){var s=a[o];Ct(r,s,this._oneTimeListeners),s.call(this,t)}var l=this._eventedParent;l&&(A(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),l.fire(t))}else t instanceof Tt&&console.error(t.error);return this},It.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},It.prototype.setEventedParent=function(t,e){return this._eventedParent=t,this._eventedParentData=e,this};var St={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Mt=function(t,e,r,i){this.message=(t?t+": ":"")+r,i&&(this.identifier=i),null!=e&&e.__line__&&(this.line=e.__line__)};function Ft(t){var e=t.value;return e?[new Mt(t.key,e,"constants have been deprecated as of v8")]:[]}function Pt(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];for(var i=0,n=e;i<n.length;i+=1){var o=n[i];for(var a in o)t[a]=o[a]}return t}function Lt(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Dt(t){if(Array.isArray(t))return t.map(Dt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var e={};for(var r in t)e[r]=Dt(t[r]);return e}return Lt(t)}var Ut=function(t){function e(e,r){t.call(this,r),this.message=r,this.key=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Error),kt=function(t,e){void 0===e&&(e=[]),this.parent=t,this.bindings={};for(var r=0,i=e;r<i.length;r+=1){var n=i[r];this.bindings[n[0]]=n[1]}};kt.prototype.concat=function(t){return new kt(this,t)},kt.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},kt.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var zt={kind:"null"},Rt={kind:"number"},Ot={kind:"string"},Qt={kind:"boolean"},Nt={kind:"color"},Vt={kind:"object"},Ht={kind:"value"},jt={kind:"collator"},Gt={kind:"formatted"},Kt={kind:"resolvedImage"};function qt(t,e){return{kind:"array",itemType:t,N:e}}function Zt(t){if("array"===t.kind){var e=Zt(t.itemType);return"number"==typeof t.N?"array<"+e+", "+t.N+">":"value"===t.itemType.kind?"array":"array<"+e+">"}return t.kind}var Wt=[zt,Rt,Ot,Qt,Nt,Gt,Vt,qt(Ht),Kt];function Xt(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Xt(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(var r=0,i=Wt;r<i.length;r+=1)if(!Xt(i[r],e))return null}return"Expected "+Zt(t)+" but found "+Zt(e)+" instead."}function $t(t,e){return e.some((function(e){return e.kind===t.kind}))}function Yt(t,e){return e.some((function(e){return"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==Ze(t):e===Ze(t)}))}var Jt=e((function(t,e){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function i(t){return(t=Math.round(t))<0?0:t>255?255:t}function n(t){return i("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function o(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function a(t,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?t+(e-t)*r*6:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}try{e.parseCSSColor=function(t){var e,s=t.replace(/ /g,"").toLowerCase();if(s in r)return r[s].slice();if("#"===s[0])return 4===s.length?(e=parseInt(s.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===s.length&&(e=parseInt(s.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var l=s.indexOf("("),c=s.indexOf(")");if(-1!==l&&c+1===s.length){var u=s.substr(0,l),h=s.substr(l+1,c-(l+1)).split(","),A=1;switch(u){case"rgba":if(4!==h.length)return null;A=o(h.pop());case"rgb":return 3!==h.length?null:[n(h[0]),n(h[1]),n(h[2]),A];case"hsla":if(4!==h.length)return null;A=o(h.pop());case"hsl":if(3!==h.length)return null;var p=(parseFloat(h[0])%360+360)%360/360,d=o(h[1]),f=o(h[2]),m=f<=.5?f*(d+1):f+d-f*d,g=2*f-m;return[i(255*a(g,m,p+1/3)),i(255*a(g,m,p)),i(255*a(g,m,p-1/3)),A];default:return null}}return null}}catch(t){}})).parseCSSColor,te=function(t,e,r,i){void 0===i&&(i=1),this.r=t,this.g=e,this.b=r,this.a=i};te.parse=function(t){if(t){if(t instanceof te)return t;if("string"==typeof t){var e=Jt(t);if(e)return new te(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3])}}},te.prototype.toString=function(){var t=this.toArray(),e=t[1],r=t[2],i=t[3];return"rgba("+Math.round(t[0])+","+Math.round(e)+","+Math.round(r)+","+i+")"},te.prototype.toArray=function(){var t=this.a;return 0===t?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},te.black=new te(0,0,0,1),te.white=new te(1,1,1,1),te.transparent=new te(0,0,0,0),te.red=new te(1,0,0,1);var ee=function(t,e,r){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};ee.prototype.compare=function(t,e){return this.collator.compare(t,e)},ee.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var re=function(t,e,r,i,n){this.text=t,this.image=e,this.scale=r,this.fontStack=i,this.textColor=n},ie=function(t){this.sections=t};ie.fromString=function(t){return new ie([new re(t,null,null,null,null)])},ie.prototype.isEmpty=function(){return 0===this.sections.length||!this.sections.some((function(t){return 0!==t.text.length||t.image&&0!==t.image.name.length}))},ie.factory=function(t){return t instanceof ie?t:ie.fromString(t)},ie.prototype.toString=function(){return 0===this.sections.length?"":this.sections.map((function(t){return t.text})).join("")},ie.prototype.serialize=function(){for(var t=["format"],e=0,r=this.sections;e<r.length;e+=1){var i=r[e];if(i.image)t.push(["image",i.image.name]);else{t.push(i.text);var n={};i.fontStack&&(n["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(n["font-scale"]=i.scale),i.textColor&&(n["text-color"]=["rgba"].concat(i.textColor.toArray())),t.push(n)}}return t};var ne=function(t){this.name=t.name,this.available=t.available};function oe(t,e,r,i){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof r&&r>=0&&r<=255?void 0===i||"number"==typeof i&&i>=0&&i<=1?null:"Invalid rgba value ["+[t,e,r,i].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+("number"==typeof i?[t,e,r,i]:[t,e,r]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function ae(t){if(null===t)return!0;if("string"==typeof t)return!0;if("boolean"==typeof t)return!0;if("number"==typeof t)return!0;if(t instanceof te)return!0;if(t instanceof ee)return!0;if(t instanceof ie)return!0;if(t instanceof ne)return!0;if(Array.isArray(t)){for(var e=0,r=t;e<r.length;e+=1)if(!ae(r[e]))return!1;return!0}if("object"==Ze(t)){for(var i in t)if(!ae(t[i]))return!1;return!0}return!1}function se(t){if(null===t)return zt;if("string"==typeof t)return Ot;if("boolean"==typeof t)return Qt;if("number"==typeof t)return Rt;if(t instanceof te)return Nt;if(t instanceof ee)return jt;if(t instanceof ie)return Gt;if(t instanceof ne)return Kt;if(Array.isArray(t)){for(var e,r=t.length,i=0,n=t;i<n.length;i+=1){var o=se(n[i]);if(e){if(e===o)continue;e=Ht;break}e=o}return qt(e||Ht,r)}return Vt}function le(t){var e=Ze(t);return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof te||t instanceof ie||t instanceof ne?t.toString():JSON.stringify(t)}ne.prototype.toString=function(){return this.name},ne.fromString=function(t){return t?new ne({name:t,available:!1}):null},ne.prototype.serialize=function(){return["image",this.name]};var ce=function(t,e){this.type=t,this.value=e};ce.parse=function(t,e){if(2!==t.length)return e.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!ae(t[1]))return e.error("invalid value");var r=t[1],i=se(r),n=e.expectedType;return"array"!==i.kind||0!==i.N||!n||"array"!==n.kind||"number"==typeof n.N&&0!==n.N||(i=n),new ce(i,r)},ce.prototype.evaluate=function(){return this.value},ce.prototype.eachChild=function(){},ce.prototype.outputDefined=function(){return!0},ce.prototype.serialize=function(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof te?["rgba"].concat(this.value.toArray()):this.value instanceof ie?this.value.serialize():this.value};var ue=function(t){this.name="ExpressionEvaluationError",this.message=t};ue.prototype.toJSON=function(){return this.message};var he={string:Ot,number:Rt,boolean:Qt,object:Vt},Ae=function(t,e){this.type=t,this.args=e};Ae.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var r,i=1,n=t[0];if("array"===n){var o,a;if(t.length>2){var s=t[1];if("string"!=typeof s||!(s in he)||"object"===s)return e.error('The item type argument of "array" must be one of string, number, boolean',1);o=he[s],i++}else o=Ht;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);a=t[2],i++}r=qt(o,a)}else r=he[n];for(var l=[];i<t.length;i++){var c=e.parse(t[i],i,Ht);if(!c)return null;l.push(c)}return new Ae(r,l)},Ae.prototype.evaluate=function(t){for(var e=0;e<this.args.length;e++){var r=this.args[e].evaluate(t);if(!Xt(this.type,se(r)))return r;if(e===this.args.length-1)throw new ue("Expected value to be of type "+Zt(this.type)+", but found "+Zt(se(r))+" instead.")}return null},Ae.prototype.eachChild=function(t){this.args.forEach(t)},Ae.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},Ae.prototype.serialize=function(){var t=this.type,e=[t.kind];if("array"===t.kind){var r=t.itemType;if("string"===r.kind||"number"===r.kind||"boolean"===r.kind){e.push(r.kind);var i=t.N;("number"==typeof i||this.args.length>1)&&e.push(i)}}return e.concat(this.args.map((function(t){return t.serialize()})))};var pe=function(t){this.type=Gt,this.sections=t};pe.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var r=t[1];if(!Array.isArray(r)&&"object"==Ze(r))return e.error("First argument must be an image or text section.");for(var i=[],n=!1,o=1;o<=t.length-1;++o){var a=t[o];if(n&&"object"==Ze(a)&&!Array.isArray(a)){n=!1;var s=null;if(a["font-scale"]&&!(s=e.parse(a["font-scale"],1,Rt)))return null;var l=null;if(a["text-font"]&&!(l=e.parse(a["text-font"],1,qt(Ot))))return null;var c=null;if(a["text-color"]&&!(c=e.parse(a["text-color"],1,Nt)))return null;var u=i[i.length-1];u.scale=s,u.font=l,u.textColor=c}else{var h=e.parse(t[o],1,Ht);if(!h)return null;var A=h.type.kind;if("string"!==A&&"value"!==A&&"null"!==A&&"resolvedImage"!==A)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");n=!0,i.push({content:h,scale:null,font:null,textColor:null})}}return new pe(i)},pe.prototype.evaluate=function(t){return new ie(this.sections.map((function(e){var r=e.content.evaluate(t);return se(r)===Kt?new re("",r,null,null,null):new re(le(r),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)})))},pe.prototype.eachChild=function(t){for(var e=0,r=this.sections;e<r.length;e+=1){var i=r[e];t(i.content),i.scale&&t(i.scale),i.font&&t(i.font),i.textColor&&t(i.textColor)}},pe.prototype.outputDefined=function(){return!1},pe.prototype.serialize=function(){for(var t=["format"],e=0,r=this.sections;e<r.length;e+=1){var i=r[e];t.push(i.content.serialize());var n={};i.scale&&(n["font-scale"]=i.scale.serialize()),i.font&&(n["text-font"]=i.font.serialize()),i.textColor&&(n["text-color"]=i.textColor.serialize()),t.push(n)}return t};var de=function(t){this.type=Kt,this.input=t};de.parse=function(t,e){if(2!==t.length)return e.error("Expected two arguments.");var r=e.parse(t[1],1,Ot);return r?new de(r):e.error("No image name provided.")},de.prototype.evaluate=function(t){var e=this.input.evaluate(t),r=ne.fromString(e);return r&&t.availableImages&&(r.available=t.availableImages.indexOf(e)>-1),r},de.prototype.eachChild=function(t){t(this.input)},de.prototype.outputDefined=function(){return!1},de.prototype.serialize=function(){return["image",this.input.serialize()]};var fe={"to-boolean":Qt,"to-color":Nt,"to-number":Rt,"to-string":Ot},me=function(t,e){this.type=t,this.args=e};me.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var r=t[0];if(("to-boolean"===r||"to-string"===r)&&2!==t.length)return e.error("Expected one argument.");for(var i=fe[r],n=[],o=1;o<t.length;o++){var a=e.parse(t[o],o,Ht);if(!a)return null;n.push(a)}return new me(i,n)},me.prototype.evaluate=function(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){for(var e,r,i=0,n=this.args;i<n.length;i+=1){if(r=null,(e=n[i].evaluate(t))instanceof te)return e;if("string"==typeof e){var o=t.parseColor(e);if(o)return o}else if(Array.isArray(e)&&!(r=e.length<3||e.length>4?"Invalid rbga value "+JSON.stringify(e)+": expected an array containing either three or four numeric values.":oe(e[0],e[1],e[2],e[3])))return new te(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new ue(r||"Could not parse color from value '"+("string"==typeof e?e:String(JSON.stringify(e)))+"'")}if("number"===this.type.kind){for(var a=null,s=0,l=this.args;s<l.length;s+=1){if(null===(a=l[s].evaluate(t)))return 0;var c=Number(a);if(!isNaN(c))return c}throw new ue("Could not convert "+JSON.stringify(a)+" to number.")}return"formatted"===this.type.kind?ie.fromString(le(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?ne.fromString(le(this.args[0].evaluate(t))):le(this.args[0].evaluate(t))},me.prototype.eachChild=function(t){this.args.forEach(t)},me.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},me.prototype.serialize=function(){if("formatted"===this.type.kind)return new pe([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new de(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild((function(e){t.push(e.serialize())})),t};var ge=["Unknown","Point","LineString","Polygon"],_e=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};_e.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},_e.prototype.geometryType=function(){return this.feature?"number"==typeof this.feature.type?ge[this.feature.type]:this.feature.type:null},_e.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},_e.prototype.canonicalID=function(){return this.canonical},_e.prototype.properties=function(){return this.feature&&this.feature.properties||{}},_e.prototype.parseColor=function(t){var e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=te.parse(t)),e};var ye=function(t,e,r,i){this.name=t,this.type=e,this._evaluate=r,this.args=i};ye.prototype.evaluate=function(t){return this._evaluate(t,this.args)},ye.prototype.eachChild=function(t){this.args.forEach(t)},ye.prototype.outputDefined=function(){return!1},ye.prototype.serialize=function(){return[this.name].concat(this.args.map((function(t){return t.serialize()})))},ye.parse=function(t,e){var r,i=t[0],n=ye.definitions[i];if(!n)return e.error('Unknown expression "'+i+'". If you wanted a literal array, use ["literal", [...]].',0);for(var o=Array.isArray(n)?n[0]:n.type,a=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,s=a.filter((function(e){var r=e[0];return!Array.isArray(r)||r.length===t.length-1})),l=null,c=0,u=s;c<u.length;c+=1){var h=u[c],A=h[0],p=h[1];l=new Ne(e.registry,e.path,null,e.scope);for(var d=[],f=!1,m=1;m<t.length;m++){var g=t[m],_=Array.isArray(A)?A[m-1]:A.type,y=l.parse(g,1+d.length,_);if(!y){f=!0;break}d.push(y)}if(!f)if(Array.isArray(A)&&A.length!==d.length)l.error("Expected "+A.length+" arguments, but found "+d.length+" instead.");else{for(var v=0;v<d.length;v++){var x=Array.isArray(A)?A[v]:A.type,w=d[v];l.concat(v+1).checkSubtype(x,w.type)}if(0===l.errors.length)return new ye(i,o,p,d)}}if(1===s.length)(r=e.errors).push.apply(r,l.errors);else{for(var b=(s.length?s:a).map((function(t){var e;return e=t[0],Array.isArray(e)?"("+e.map(Zt).join(", ")+")":"("+Zt(e.type)+"...)"})).join(" | "),B=[],C=1;C<t.length;C++){var E=e.parse(t[C],1+B.length);if(!E)return null;B.push(Zt(E.type))}e.error("Expected arguments of type "+b+", but found ("+B.join(", ")+") instead.")}return null},ye.register=function(t,e){for(var r in ye.definitions=e,e)t[r]=ye};var ve=function(t,e,r){this.type=jt,this.locale=r,this.caseSensitive=t,this.diacriticSensitive=e};function xe(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function we(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function be(t,e){var r=(180+t[0])/360,i=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,n=Math.pow(2,e.z);return[Math.round(r*n*8192),Math.round(i*n*8192)]}function Be(t,e,r){return e[1]>t[1]!=r[1]>t[1]&&t[0]<(r[0]-e[0])*(t[1]-e[1])/(r[1]-e[1])+e[0]}function Ce(t,e){for(var r,i,n,o,a,s,l,c=!1,u=0,h=e.length;u<h;u++)for(var A=e[u],p=0,d=A.length;p<d-1;p++){if((o=(r=t)[0]-(i=A[p])[0])*(l=r[1]-(n=A[p+1])[1])-(s=r[0]-n[0])*(a=r[1]-i[1])==0&&o*s<=0&&a*l<=0)return!1;Be(t,A[p],A[p+1])&&(c=!c)}return c}function Ee(t,e){for(var r=0;r<e.length;r++)if(Ce(t,e[r]))return!0;return!1}function Te(t,e,r,i){var n=i[0]-r[0],o=i[1]-r[1],a=(t[0]-r[0])*o-n*(t[1]-r[1]),s=(e[0]-r[0])*o-n*(e[1]-r[1]);return a>0&&s<0||a<0&&s>0}function Ie(t,e,r){for(var i=0,n=r;i<n.length;i+=1)for(var o=n[i],a=0;a<o.length-1;++a)if((h=[(u=o[a+1])[0]-(c=o[a])[0],u[1]-c[1]])[0]*(A=[(l=e)[0]-(s=t)[0],l[1]-s[1]])[1]-h[1]*A[0]!=0&&Te(s,l,c,u)&&Te(c,u,s,l))return!0;var s,l,c,u,h,A;return!1}function Se(t,e){for(var r=0;r<t.length;++r)if(!Ce(t[r],e))return!1;for(var i=0;i<t.length-1;++i)if(Ie(t[i],t[i+1],e))return!1;return!0}function Me(t,e){for(var r=0;r<e.length;r++)if(Se(t,e[r]))return!0;return!1}function Fe(t,e,r){for(var i=[],n=0;n<t.length;n++){for(var o=[],a=0;a<t[n].length;a++){var s=be(t[n][a],r);xe(e,s),o.push(s)}i.push(o)}return i}function Pe(t,e,r){for(var i=[],n=0;n<t.length;n++){var o=Fe(t[n],e,r);i.push(o)}return i}function Le(t,e,r,i){if(t[0]<r[0]||t[0]>r[2]){var n=.5*i,o=t[0]-r[0]>n?-i:r[0]-t[0]>n?i:0;0===o&&(o=t[0]-r[2]>n?-i:r[2]-t[0]>n?i:0),t[0]+=o}xe(e,t)}function De(t,e,r,i){for(var n=8192*Math.pow(2,i.z),o=[8192*i.x,8192*i.y],a=[],s=0,l=t;s<l.length;s+=1)for(var c=0,u=l[s];c<u.length;c+=1){var h=u[c],A=[h.x+o[0],h.y+o[1]];Le(A,e,r,n),a.push(A)}return a}function Ue(t,e,r,i){for(var n,o=8192*Math.pow(2,i.z),a=[8192*i.x,8192*i.y],s=[],l=0,c=t;l<c.length;l+=1){for(var u=[],h=0,A=c[l];h<A.length;h+=1){var p=A[h],d=[p.x+a[0],p.y+a[1]];xe(e,d),u.push(d)}s.push(u)}if(e[2]-e[0]<=o/2){(n=e)[0]=n[1]=1/0,n[2]=n[3]=-1/0;for(var f=0,m=s;f<m.length;f+=1)for(var g=0,_=m[f];g<_.length;g+=1)Le(_[g],e,r,o)}return s}ve.parse=function(t,e){if(2!==t.length)return e.error("Expected one argument.");var r=t[1];if("object"!=Ze(r)||Array.isArray(r))return e.error("Collator options argument must be an object.");var i=e.parse(void 0!==r["case-sensitive"]&&r["case-sensitive"],1,Qt);if(!i)return null;var n=e.parse(void 0!==r["diacritic-sensitive"]&&r["diacritic-sensitive"],1,Qt);if(!n)return null;var o=null;return r.locale&&!(o=e.parse(r.locale,1,Ot))?null:new ve(i,n,o)},ve.prototype.evaluate=function(t){return new ee(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},ve.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},ve.prototype.outputDefined=function(){return!1},ve.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var ke=function(t,e){this.type=Qt,this.geojson=t,this.geometries=e};function ze(t){if(t instanceof ye){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof ke)return!1;var e=!0;return t.eachChild((function(t){e&&!ze(t)&&(e=!1)})),e}function Re(t){if(t instanceof ye&&"feature-state"===t.name)return!1;var e=!0;return t.eachChild((function(t){e&&!Re(t)&&(e=!1)})),e}function Oe(t,e){if(t instanceof ye&&e.indexOf(t.name)>=0)return!1;var r=!0;return t.eachChild((function(t){r&&!Oe(t,e)&&(r=!1)})),r}ke.parse=function(t,e){if(2!==t.length)return e.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(ae(t[1])){var r=t[1];if("FeatureCollection"===r.type)for(var i=0;i<r.features.length;++i){var n=r.features[i].geometry.type;if("Polygon"===n||"MultiPolygon"===n)return new ke(r,r.features[i].geometry)}else if("Feature"===r.type){var o=r.geometry.type;if("Polygon"===o||"MultiPolygon"===o)return new ke(r,r.geometry)}else if("Polygon"===r.type||"MultiPolygon"===r.type)return new ke(r,r)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")},ke.prototype.evaluate=function(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){var r=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],n=t.canonicalID();if("Polygon"===e.type){var o=Fe(e.coordinates,i,n),a=De(t.geometry(),r,i,n);if(!we(r,i))return!1;for(var s=0,l=a;s<l.length;s+=1)if(!Ce(l[s],o))return!1}if("MultiPolygon"===e.type){var c=Pe(e.coordinates,i,n),u=De(t.geometry(),r,i,n);if(!we(r,i))return!1;for(var h=0,A=u;h<A.length;h+=1)if(!Ee(A[h],c))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){var r=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],n=t.canonicalID();if("Polygon"===e.type){var o=Fe(e.coordinates,i,n),a=Ue(t.geometry(),r,i,n);if(!we(r,i))return!1;for(var s=0,l=a;s<l.length;s+=1)if(!Se(l[s],o))return!1}if("MultiPolygon"===e.type){var c=Pe(e.coordinates,i,n),u=Ue(t.geometry(),r,i,n);if(!we(r,i))return!1;for(var h=0,A=u;h<A.length;h+=1)if(!Me(A[h],c))return!1}return!0}(t,this.geometries)}return!1},ke.prototype.eachChild=function(){},ke.prototype.outputDefined=function(){return!0},ke.prototype.serialize=function(){return["within",this.geojson]};var Qe=function(t,e){this.type=e.type,this.name=t,this.boundExpression=e};Qe.parse=function(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");var r=t[1];return e.scope.has(r)?new Qe(r,e.scope.get(r)):e.error('Unknown variable "'+r+'". Make sure "'+r+'" has been bound in an enclosing "let" expression before using it.',1)},Qe.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},Qe.prototype.eachChild=function(){},Qe.prototype.outputDefined=function(){return!1},Qe.prototype.serialize=function(){return["var",this.name]};var Ne=function(t,e,r,i,n){void 0===e&&(e=[]),void 0===i&&(i=new kt),void 0===n&&(n=[]),this.registry=t,this.path=e,this.key=e.map((function(t){return"["+t+"]"})).join(""),this.scope=i,this.errors=n,this.expectedType=r};function Ve(t,e){for(var r,i=t.length-1,n=0,o=i,a=0;n<=o;)if((r=t[a=Math.floor((n+o)/2)])<=e){if(a===i||e<t[a+1])return a;n=a+1}else{if(!(r>e))throw new ue("Input is not a number.");o=a-1}return 0}Ne.prototype.parse=function(t,e,r,i,n){return void 0===n&&(n={}),e?this.concat(e,r,i)._parse(t,n):this._parse(t,n)},Ne.prototype._parse=function(t,e){function r(t,e,r){return"assert"===r?new Ae(e,[t]):"coerce"===r?new me(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var i=t[0];if("string"!=typeof i)return this.error("Expression name must be a string, but found "+Ze(i)+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var n=this.registry[i];if(n){var o=n.parse(t,this);if(!o)return null;if(this.expectedType){var a=this.expectedType,s=o.type;if("string"!==a.kind&&"number"!==a.kind&&"boolean"!==a.kind&&"object"!==a.kind&&"array"!==a.kind||"value"!==s.kind)if("color"!==a.kind&&"formatted"!==a.kind&&"resolvedImage"!==a.kind||"value"!==s.kind&&"string"!==s.kind){if(this.checkSubtype(a,s))return null}else o=r(o,a,e.typeAnnotation||"coerce");else o=r(o,a,e.typeAnnotation||"assert")}if(!(o instanceof ce)&&"resolvedImage"!==o.type.kind&&function t(e){if(e instanceof Qe)return t(e.boundExpression);if(e instanceof ye&&"error"===e.name)return!1;if(e instanceof ve)return!1;if(e instanceof ke)return!1;var r=e instanceof me||e instanceof Ae,i=!0;return e.eachChild((function(e){i=r?i&&t(e):i&&e instanceof ce})),!!i&&ze(e)&&Oe(e,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(o)){var l=new _e;try{o=new ce(o.type,o.evaluate(l))}catch(t){return this.error(t.message),null}}return o}return this.error('Unknown expression "'+i+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==Ze(t)?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+Ze(t)+" instead.")},Ne.prototype.concat=function(t,e,r){var i="number"==typeof t?this.path.concat(t):this.path,n=r?this.scope.concat(r):this.scope;return new Ne(this.registry,i,e||null,n,this.errors)},Ne.prototype.error=function(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];var i=""+this.key+e.map((function(t){return"["+t+"]"})).join("");this.errors.push(new Ut(i,t))},Ne.prototype.checkSubtype=function(t,e){var r=Xt(t,e);return r&&this.error(r),r};var He=function(t,e,r){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(var i=0,n=r;i<n.length;i+=1){var o=n[i],a=o[1];this.labels.push(o[0]),this.outputs.push(a)}};function je(t,e,r){return t*(1-r)+e*r}He.parse=function(t,e){if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");var r=e.parse(t[1],1,Rt);if(!r)return null;var i=[],n=null;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);for(var o=1;o<t.length;o+=2){var a=1===o?-1/0:t[o],s=t[o+1],l=o,c=o+1;if("number"!=typeof a)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',l);if(i.length&&i[i.length-1][0]>=a)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',l);var u=e.parse(s,c,n);if(!u)return null;n=n||u.type,i.push([a,u])}return new He(n,r,i)},He.prototype.evaluate=function(t){var e=this.labels,r=this.outputs;if(1===e.length)return r[0].evaluate(t);var i=this.input.evaluate(t);if(i<=e[0])return r[0].evaluate(t);var n=e.length;return i>=e[n-1]?r[n-1].evaluate(t):r[Ve(e,i)].evaluate(t)},He.prototype.eachChild=function(t){t(this.input);for(var e=0,r=this.outputs;e<r.length;e+=1)t(r[e])},He.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))},He.prototype.serialize=function(){for(var t=["step",this.input.serialize()],e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t};var Ge=Object.freeze({__proto__:null,number:je,color:function(t,e,r){return new te(je(t.r,e.r,r),je(t.g,e.g,r),je(t.b,e.b,r),je(t.a,e.a,r))},array:function(t,e,r){return t.map((function(t,i){return je(t,e[i],r)}))}}),Ke=6/29*3*(6/29),qe=Math.PI/180,We=180/Math.PI;function Xe(t){return t>.008856451679035631?Math.pow(t,1/3):t/Ke+4/29}function $e(t){return t>6/29?t*t*t:Ke*(t-4/29)}function Ye(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Je(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function tr(t){var e=Je(t.r),r=Je(t.g),i=Je(t.b),n=Xe((.4124564*e+.3575761*r+.1804375*i)/.95047),o=Xe((.2126729*e+.7151522*r+.072175*i)/1);return{l:116*o-16,a:500*(n-o),b:200*(o-Xe((.0193339*e+.119192*r+.9503041*i)/1.08883)),alpha:t.a}}function er(t){var e=(t.l+16)/116,r=isNaN(t.a)?e:e+t.a/500,i=isNaN(t.b)?e:e-t.b/200;return e=1*$e(e),r=.95047*$e(r),i=1.08883*$e(i),new te(Ye(3.2404542*r-1.5371385*e-.4985314*i),Ye(-.969266*r+1.8760108*e+.041556*i),Ye(.0556434*r-.2040259*e+1.0572252*i),t.alpha)}function rr(t,e,r){var i=e-t;return t+r*(i>180||i<-180?i-360*Math.round(i/360):i)}var ir={forward:tr,reverse:er,interpolate:function(t,e,r){return{l:je(t.l,e.l,r),a:je(t.a,e.a,r),b:je(t.b,e.b,r),alpha:je(t.alpha,e.alpha,r)}}},nr={forward:function(t){var e=tr(t),r=e.l,i=e.a,n=e.b,o=Math.atan2(n,i)*We;return{h:o<0?o+360:o,c:Math.sqrt(i*i+n*n),l:r,alpha:t.a}},reverse:function(t){var e=t.h*qe,r=t.c;return er({l:t.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:t.alpha})},interpolate:function(t,e,r){return{h:rr(t.h,e.h,r),c:je(t.c,e.c,r),l:je(t.l,e.l,r),alpha:je(t.alpha,e.alpha,r)}}},or=Object.freeze({__proto__:null,lab:ir,hcl:nr}),ar=function(t,e,r,i,n){this.type=t,this.operator=e,this.interpolation=r,this.input=i,this.labels=[],this.outputs=[];for(var o=0,a=n;o<a.length;o+=1){var s=a[o],l=s[1];this.labels.push(s[0]),this.outputs.push(l)}};function sr(t,e,r,i){var n=i-r,o=t-r;return 0===n?0:1===e?o/n:(Math.pow(e,o)-1)/(Math.pow(e,n)-1)}ar.interpolationFactor=function(t,e,i,n){var o=0;if("exponential"===t.name)o=sr(e,t.base,i,n);else if("linear"===t.name)o=sr(e,1,i,n);else if("cubic-bezier"===t.name){var a=t.controlPoints;o=new r(a[0],a[1],a[2],a[3]).solve(sr(e,1,i,n))}return o},ar.parse=function(t,e){var r=t[0],i=t[1],n=t[2],o=t.slice(3);if(!Array.isArray(i)||0===i.length)return e.error("Expected an interpolation type expression.",1);if("linear"===i[0])i={name:"linear"};else if("exponential"===i[0]){var a=i[1];if("number"!=typeof a)return e.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:a}}else{if("cubic-bezier"!==i[0])return e.error("Unknown interpolation type "+String(i[0]),1,0);var s=i.slice(1);if(4!==s.length||s.some((function(t){return"number"!=typeof t||t<0||t>1})))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:s}}if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(n=e.parse(n,2,Rt)))return null;var l=[],c=null;"interpolate-hcl"===r||"interpolate-lab"===r?c=Nt:e.expectedType&&"value"!==e.expectedType.kind&&(c=e.expectedType);for(var u=0;u<o.length;u+=2){var h=o[u],A=o[u+1],p=u+3,d=u+4;if("number"!=typeof h)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',p);if(l.length&&l[l.length-1][0]>=h)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',p);var f=e.parse(A,d,c);if(!f)return null;c=c||f.type,l.push([h,f])}return"number"===c.kind||"color"===c.kind||"array"===c.kind&&"number"===c.itemType.kind&&"number"==typeof c.N?new ar(c,r,i,n,l):e.error("Type "+Zt(c)+" is not interpolatable.")},ar.prototype.evaluate=function(t){var e=this.labels,r=this.outputs;if(1===e.length)return r[0].evaluate(t);var i=this.input.evaluate(t);if(i<=e[0])return r[0].evaluate(t);var n=e.length;if(i>=e[n-1])return r[n-1].evaluate(t);var o=Ve(e,i),a=ar.interpolationFactor(this.interpolation,i,e[o],e[o+1]),s=r[o].evaluate(t),l=r[o+1].evaluate(t);return"interpolate"===this.operator?Ge[this.type.kind.toLowerCase()](s,l,a):"interpolate-hcl"===this.operator?nr.reverse(nr.interpolate(nr.forward(s),nr.forward(l),a)):ir.reverse(ir.interpolate(ir.forward(s),ir.forward(l),a))},ar.prototype.eachChild=function(t){t(this.input);for(var e=0,r=this.outputs;e<r.length;e+=1)t(r[e])},ar.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))},ar.prototype.serialize=function(){var t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var e=[this.operator,t,this.input.serialize()],r=0;r<this.labels.length;r++)e.push(this.labels[r],this.outputs[r].serialize());return e};var lr=function(t,e){this.type=t,this.args=e};lr.parse=function(t,e){if(t.length<2)return e.error("Expectected at least one argument.");var r=null,i=e.expectedType;i&&"value"!==i.kind&&(r=i);for(var n=[],o=0,a=t.slice(1);o<a.length;o+=1){var s=e.parse(a[o],1+n.length,r,void 0,{typeAnnotation:"omit"});if(!s)return null;r=r||s.type,n.push(s)}var l=i&&n.some((function(t){return Xt(i,t.type)}));return new lr(l?Ht:r,n)},lr.prototype.evaluate=function(t){for(var e,r=null,i=0,n=0,o=this.args;n<o.length&&(i++,(r=o[n].evaluate(t))&&r instanceof ne&&!r.available&&(e||(e=r.name),r=null,i===this.args.length&&(r=e)),null===r);n+=1);return r},lr.prototype.eachChild=function(t){this.args.forEach(t)},lr.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},lr.prototype.serialize=function(){var t=["coalesce"];return this.eachChild((function(e){t.push(e.serialize())})),t};var cr=function(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e};cr.prototype.evaluate=function(t){return this.result.evaluate(t)},cr.prototype.eachChild=function(t){for(var e=0,r=this.bindings;e<r.length;e+=1)t(r[e][1]);t(this.result)},cr.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var r=[],i=1;i<t.length-1;i+=2){var n=t[i];if("string"!=typeof n)return e.error("Expected string, but found "+Ze(n)+" instead.",i);if(/[^a-zA-Z0-9_]/.test(n))return e.error("Variable names must contain only alphanumeric characters or '_'.",i);var o=e.parse(t[i+1],i+1);if(!o)return null;r.push([n,o])}var a=e.parse(t[t.length-1],t.length-1,e.expectedType,r);return a?new cr(r,a):null},cr.prototype.outputDefined=function(){return this.result.outputDefined()},cr.prototype.serialize=function(){for(var t=["let"],e=0,r=this.bindings;e<r.length;e+=1){var i=r[e];t.push(i[0],i[1].serialize())}return t.push(this.result.serialize()),t};var ur=function(t,e,r){this.type=t,this.index=e,this.input=r};ur.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,Rt),i=e.parse(t[2],2,qt(e.expectedType||Ht));return r&&i?new ur(i.type.itemType,r,i):null},ur.prototype.evaluate=function(t){var e=this.index.evaluate(t),r=this.input.evaluate(t);if(e<0)throw new ue("Array index out of bounds: "+e+" < 0.");if(e>=r.length)throw new ue("Array index out of bounds: "+e+" > "+(r.length-1)+".");if(e!==Math.floor(e))throw new ue("Array index must be an integer, but found "+e+" instead.");return r[e]},ur.prototype.eachChild=function(t){t(this.index),t(this.input)},ur.prototype.outputDefined=function(){return!1},ur.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var hr=function(t,e){this.type=Qt,this.needle=t,this.haystack=e};hr.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,Ht),i=e.parse(t[2],2,Ht);return r&&i?$t(r.type,[Qt,Ot,Rt,zt,Ht])?new hr(r,i):e.error("Expected first argument to be of type boolean, string, number or null, but found "+Zt(r.type)+" instead"):null},hr.prototype.evaluate=function(t){var e=this.needle.evaluate(t),r=this.haystack.evaluate(t);if(!r)return!1;if(!Yt(e,["boolean","string","number","null"]))throw new ue("Expected first argument to be of type boolean, string, number or null, but found "+Zt(se(e))+" instead.");if(!Yt(r,["string","array"]))throw new ue("Expected second argument to be of type array or string, but found "+Zt(se(r))+" instead.");return r.indexOf(e)>=0},hr.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},hr.prototype.outputDefined=function(){return!0},hr.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Ar=function(t,e,r){this.type=Rt,this.needle=t,this.haystack=e,this.fromIndex=r};Ar.parse=function(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,Ht),i=e.parse(t[2],2,Ht);if(!r||!i)return null;if(!$t(r.type,[Qt,Ot,Rt,zt,Ht]))return e.error("Expected first argument to be of type boolean, string, number or null, but found "+Zt(r.type)+" instead");if(4===t.length){var n=e.parse(t[3],3,Rt);return n?new Ar(r,i,n):null}return new Ar(r,i)},Ar.prototype.evaluate=function(t){var e=this.needle.evaluate(t),r=this.haystack.evaluate(t);if(!Yt(e,["boolean","string","number","null"]))throw new ue("Expected first argument to be of type boolean, string, number or null, but found "+Zt(se(e))+" instead.");if(!Yt(r,["string","array"]))throw new ue("Expected second argument to be of type array or string, but found "+Zt(se(r))+" instead.");if(this.fromIndex){var i=this.fromIndex.evaluate(t);return r.indexOf(e,i)}return r.indexOf(e)},Ar.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},Ar.prototype.outputDefined=function(){return!1},Ar.prototype.serialize=function(){if(null!=this.fromIndex&&void 0!==this.fromIndex){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var pr=function(t,e,r,i,n,o){this.inputType=t,this.type=e,this.input=r,this.cases=i,this.outputs=n,this.otherwise=o};pr.parse=function(t,e){if(t.length<5)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return e.error("Expected an even number of arguments.");var r,i;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);for(var n={},o=[],a=2;a<t.length-1;a+=2){var s=t[a],l=t[a+1];Array.isArray(s)||(s=[s]);var c=e.concat(a);if(0===s.length)return c.error("Expected at least one branch label.");for(var u=0,h=s;u<h.length;u+=1){var A=h[u];if("number"!=typeof A&&"string"!=typeof A)return c.error("Branch labels must be numbers or strings.");if("number"==typeof A&&Math.abs(A)>Number.MAX_SAFE_INTEGER)return c.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if("number"==typeof A&&Math.floor(A)!==A)return c.error("Numeric branch labels must be integer values.");if(r){if(c.checkSubtype(r,se(A)))return null}else r=se(A);if(void 0!==n[String(A)])return c.error("Branch labels must be unique.");n[String(A)]=o.length}var p=e.parse(l,a,i);if(!p)return null;i=i||p.type,o.push(p)}var d=e.parse(t[1],1,Ht);if(!d)return null;var f=e.parse(t[t.length-1],t.length-1,i);return f?"value"!==d.type.kind&&e.concat(1).checkSubtype(r,d.type)?null:new pr(r,i,d,n,o,f):null},pr.prototype.evaluate=function(t){var e=this.input.evaluate(t);return(se(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)},pr.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},pr.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))&&this.otherwise.outputDefined()},pr.prototype.serialize=function(){for(var t=this,e=["match",this.input.serialize()],r=[],i={},n=0,o=Object.keys(this.cases).sort();n<o.length;n+=1){var a=o[n];void 0===(h=i[this.cases[a]])?(i[this.cases[a]]=r.length,r.push([this.cases[a],[a]])):r[h][1].push(a)}for(var s=function(e){return"number"===t.inputType.kind?Number(e):e},l=0,c=r;l<c.length;l+=1){var u=c[l],h=u[0],A=u[1];e.push(1===A.length?s(A[0]):A.map(s)),e.push(this.outputs[outputIndex$1].serialize())}return e.push(this.otherwise.serialize()),e};var dr=function(t,e,r){this.type=t,this.branches=e,this.otherwise=r};dr.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return e.error("Expected an odd number of arguments.");var r;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(var i=[],n=1;n<t.length-1;n+=2){var o=e.parse(t[n],n,Qt);if(!o)return null;var a=e.parse(t[n+1],n+1,r);if(!a)return null;i.push([o,a]),r=r||a.type}var s=e.parse(t[t.length-1],t.length-1,r);return s?new dr(r,i,s):null},dr.prototype.evaluate=function(t){for(var e=0,r=this.branches;e<r.length;e+=1){var i=r[e],n=i[1];if(i[0].evaluate(t))return n.evaluate(t)}return this.otherwise.evaluate(t)},dr.prototype.eachChild=function(t){for(var e=0,r=this.branches;e<r.length;e+=1){var i=r[e],n=i[1];t(i[0]),t(n)}t(this.otherwise)},dr.prototype.outputDefined=function(){return this.branches.every((function(t){return t[1].outputDefined()}))&&this.otherwise.outputDefined()},dr.prototype.serialize=function(){var t=["case"];return this.eachChild((function(e){t.push(e.serialize())})),t};var fr=function(t,e,r,i){this.type=t,this.input=e,this.beginIndex=r,this.endIndex=i};function mr(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function gr(t,e,r,i){return 0===i.compare(e,r)}function _r(t,e,r){var i="=="!==t&&"!="!==t;return function(){function n(t,e,r){this.type=Qt,this.lhs=t,this.rhs=e,this.collator=r,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}return n.parse=function(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");var r=t[0],o=e.parse(t[1],1,Ht);if(!o)return null;if(!mr(r,o.type))return e.concat(1).error('"'+r+"\" comparisons are not supported for type '"+Zt(o.type)+"'.");var a=e.parse(t[2],2,Ht);if(!a)return null;if(!mr(r,a.type))return e.concat(2).error('"'+r+"\" comparisons are not supported for type '"+Zt(a.type)+"'.");if(o.type.kind!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return e.error("Cannot compare types '"+Zt(o.type)+"' and '"+Zt(a.type)+"'.");i&&("value"===o.type.kind&&"value"!==a.type.kind?o=new Ae(a.type,[o]):"value"!==o.type.kind&&"value"===a.type.kind&&(a=new Ae(o.type,[a])));var s=null;if(4===t.length){if("string"!==o.type.kind&&"string"!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return e.error("Cannot use collator to compare non-string types.");if(!(s=e.parse(t[3],3,jt)))return null}return new n(o,a,s)},n.prototype.evaluate=function(n){var o=this.lhs.evaluate(n),a=this.rhs.evaluate(n);if(i&&this.hasUntypedArgument){var s=se(o),l=se(a);if(s.kind!==l.kind||"string"!==s.kind&&"number"!==s.kind)throw new ue('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+s.kind+", "+l.kind+") instead.")}if(this.collator&&!i&&this.hasUntypedArgument){var c=se(o),u=se(a);if("string"!==c.kind||"string"!==u.kind)return e(n,o,a)}return this.collator?r(n,o,a,this.collator.evaluate(n)):e(n,o,a)},n.prototype.eachChild=function(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)},n.prototype.outputDefined=function(){return!0},n.prototype.serialize=function(){var e=[t];return this.eachChild((function(t){e.push(t.serialize())})),e},n}()}fr.parse=function(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,Ht),i=e.parse(t[2],2,Rt);if(!r||!i)return null;if(!$t(r.type,[qt(Ht),Ot,Ht]))return e.error("Expected first argument to be of type array or string, but found "+Zt(r.type)+" instead");if(4===t.length){var n=e.parse(t[3],3,Rt);return n?new fr(r.type,r,i,n):null}return new fr(r.type,r,i)},fr.prototype.evaluate=function(t){var e=this.input.evaluate(t),r=this.beginIndex.evaluate(t);if(!Yt(e,["string","array"]))throw new ue("Expected first argument to be of type array or string, but found "+Zt(se(e))+" instead.");if(this.endIndex){var i=this.endIndex.evaluate(t);return e.slice(r,i)}return e.slice(r)},fr.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},fr.prototype.outputDefined=function(){return!1},fr.prototype.serialize=function(){if(null!=this.endIndex&&void 0!==this.endIndex){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var yr=_r("==",(function(t,e,r){return e===r}),gr),vr=_r("!=",(function(t,e,r){return e!==r}),(function(t,e,r,i){return!gr(0,e,r,i)})),xr=_r("<",(function(t,e,r){return e<r}),(function(t,e,r,i){return i.compare(e,r)<0})),wr=_r(">",(function(t,e,r){return e>r}),(function(t,e,r,i){return i.compare(e,r)>0})),br=_r("<=",(function(t,e,r){return e<=r}),(function(t,e,r,i){return i.compare(e,r)<=0})),Br=_r(">=",(function(t,e,r){return e>=r}),(function(t,e,r,i){return i.compare(e,r)>=0})),Cr=function(t,e,r,i,n){this.type=Ot,this.number=t,this.locale=e,this.currency=r,this.minFractionDigits=i,this.maxFractionDigits=n};Cr.parse=function(t,e){if(3!==t.length)return e.error("Expected two arguments.");var r=e.parse(t[1],1,Rt);if(!r)return null;var i=t[2];if("object"!=Ze(i)||Array.isArray(i))return e.error("NumberFormat options argument must be an object.");var n=null;if(i.locale&&!(n=e.parse(i.locale,1,Ot)))return null;var o=null;if(i.currency&&!(o=e.parse(i.currency,1,Ot)))return null;var a=null;if(i["min-fraction-digits"]&&!(a=e.parse(i["min-fraction-digits"],1,Rt)))return null;var s=null;return i["max-fraction-digits"]&&!(s=e.parse(i["max-fraction-digits"],1,Rt))?null:new Cr(r,n,o,a,s)},Cr.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},Cr.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},Cr.prototype.outputDefined=function(){return!1},Cr.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var Er=function(t){this.type=Rt,this.input=t};Er.parse=function(t,e){if(2!==t.length)return e.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1);return r?"array"!==r.type.kind&&"string"!==r.type.kind&&"value"!==r.type.kind?e.error("Expected argument of type string or array, but found "+Zt(r.type)+" instead."):new Er(r):null},Er.prototype.evaluate=function(t){var e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new ue("Expected value to be of type string or array, but found "+Zt(se(e))+" instead.")},Er.prototype.eachChild=function(t){t(this.input)},Er.prototype.outputDefined=function(){return!1},Er.prototype.serialize=function(){var t=["length"];return this.eachChild((function(e){t.push(e.serialize())})),t};var Tr={"==":yr,"!=":vr,">":wr,"<":xr,">=":Br,"<=":br,array:Ae,at:ur,boolean:Ae,case:dr,coalesce:lr,collator:ve,format:pe,image:de,in:hr,"index-of":Ar,interpolate:ar,"interpolate-hcl":ar,"interpolate-lab":ar,length:Er,let:cr,literal:ce,match:pr,number:Ae,"number-format":Cr,object:Ae,slice:fr,step:He,string:Ae,"to-boolean":me,"to-color":me,"to-number":me,"to-string":me,var:Qe,within:ke};function Ir(t,e){var r=e[0],i=e[1],n=e[2],o=e[3];r=r.evaluate(t),i=i.evaluate(t),n=n.evaluate(t);var a=o?o.evaluate(t):1,s=oe(r,i,n,a);if(s)throw new ue(s);return new te(r/255*a,i/255*a,n/255*a,a)}function Sr(t,e){return t in e}function Mr(t,e){var r=e[t];return void 0===r?null:r}function Fr(t){return{type:t}}function Pr(t){return{result:"success",value:t}}function Lr(t){return{result:"error",value:t}}function Dr(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function Ur(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function kr(t){return!!t.expression&&t.expression.interpolated}function zr(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":Ze(t)}function Rr(t){return"object"==Ze(t)&&null!==t&&!Array.isArray(t)}function Or(t){return t}function Qr(t,e,r){return void 0!==t?t:void 0!==e?e:void 0!==r?r:void 0}function Nr(t,e,r,i,n){return Qr(Ze(r)===n?i[r]:void 0,t.default,e.default)}function Vr(t,e,r){if("number"!==zr(r))return Qr(t.default,e.default);var i=t.stops.length;if(1===i)return t.stops[0][1];if(r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[i-1][0])return t.stops[i-1][1];var n=Ve(t.stops.map((function(t){return t[0]})),r);return t.stops[n][1]}function Hr(t,e,r){var i=void 0!==t.base?t.base:1;if("number"!==zr(r))return Qr(t.default,e.default);var n=t.stops.length;if(1===n)return t.stops[0][1];if(r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[n-1][0])return t.stops[n-1][1];var o=Ve(t.stops.map((function(t){return t[0]})),r),a=function(t,e,r,i){var n=i-r,o=t-r;return 0===n?0:1===e?o/n:(Math.pow(e,o)-1)/(Math.pow(e,n)-1)}(r,i,t.stops[o][0],t.stops[o+1][0]),s=t.stops[o][1],l=t.stops[o+1][1],c=Ge[e.type]||Or;if(t.colorSpace&&"rgb"!==t.colorSpace){var u=or[t.colorSpace];c=function(t,e){return u.reverse(u.interpolate(u.forward(t),u.forward(e),a))}}return"function"==typeof s.evaluate?{evaluate:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var r=s.evaluate.apply(void 0,t),i=l.evaluate.apply(void 0,t);if(void 0!==r&&void 0!==i)return c(r,i,a)}}:c(s,l,a)}function jr(t,e,r){return"color"===e.type?r=te.parse(r):"formatted"===e.type?r=ie.fromString(r.toString()):"resolvedImage"===e.type?r=ne.fromString(r.toString()):zr(r)===e.type||"enum"===e.type&&e.values[r]||(r=void 0),Qr(r,t.default,e.default)}ye.register(Tr,{error:[{kind:"error"},[Ot],function(t,e){throw new ue(e[0].evaluate(t))}],typeof:[Ot,[Ht],function(t,e){return Zt(se(e[0].evaluate(t)))}],"to-rgba":[qt(Rt,4),[Nt],function(t,e){return e[0].evaluate(t).toArray()}],rgb:[Nt,[Rt,Rt,Rt],Ir],rgba:[Nt,[Rt,Rt,Rt,Rt],Ir],has:{type:Qt,overloads:[[[Ot],function(t,e){return Sr(e[0].evaluate(t),t.properties())}],[[Ot,Vt],function(t,e){var r=e[1];return Sr(e[0].evaluate(t),r.evaluate(t))}]]},get:{type:Ht,overloads:[[[Ot],function(t,e){return Mr(e[0].evaluate(t),t.properties())}],[[Ot,Vt],function(t,e){var r=e[1];return Mr(e[0].evaluate(t),r.evaluate(t))}]]},"feature-state":[Ht,[Ot],function(t,e){return Mr(e[0].evaluate(t),t.featureState||{})}],properties:[Vt,[],function(t){return t.properties()}],"geometry-type":[Ot,[],function(t){return t.geometryType()}],id:[Ht,[],function(t){return t.id()}],zoom:[Rt,[],function(t){return t.globals.zoom}],"heatmap-density":[Rt,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Rt,[],function(t){return t.globals.lineProgress||0}],accumulated:[Ht,[],function(t){return void 0===t.globals.accumulated?null:t.globals.accumulated}],"+":[Rt,Fr(Rt),function(t,e){for(var r=0,i=0,n=e;i<n.length;i+=1)r+=n[i].evaluate(t);return r}],"*":[Rt,Fr(Rt),function(t,e){for(var r=1,i=0,n=e;i<n.length;i+=1)r*=n[i].evaluate(t);return r}],"-":{type:Rt,overloads:[[[Rt,Rt],function(t,e){var r=e[1];return e[0].evaluate(t)-r.evaluate(t)}],[[Rt],function(t,e){return-e[0].evaluate(t)}]]},"/":[Rt,[Rt,Rt],function(t,e){var r=e[1];return e[0].evaluate(t)/r.evaluate(t)}],"%":[Rt,[Rt,Rt],function(t,e){var r=e[1];return e[0].evaluate(t)%r.evaluate(t)}],ln2:[Rt,[],function(){return Math.LN2}],pi:[Rt,[],function(){return Math.PI}],e:[Rt,[],function(){return Math.E}],"^":[Rt,[Rt,Rt],function(t,e){var r=e[1];return Math.pow(e[0].evaluate(t),r.evaluate(t))}],sqrt:[Rt,[Rt],function(t,e){return Math.sqrt(e[0].evaluate(t))}],log10:[Rt,[Rt],function(t,e){return Math.log(e[0].evaluate(t))/Math.LN10}],ln:[Rt,[Rt],function(t,e){return Math.log(e[0].evaluate(t))}],log2:[Rt,[Rt],function(t,e){return Math.log(e[0].evaluate(t))/Math.LN2}],sin:[Rt,[Rt],function(t,e){return Math.sin(e[0].evaluate(t))}],cos:[Rt,[Rt],function(t,e){return Math.cos(e[0].evaluate(t))}],tan:[Rt,[Rt],function(t,e){return Math.tan(e[0].evaluate(t))}],asin:[Rt,[Rt],function(t,e){return Math.asin(e[0].evaluate(t))}],acos:[Rt,[Rt],function(t,e){return Math.acos(e[0].evaluate(t))}],atan:[Rt,[Rt],function(t,e){return Math.atan(e[0].evaluate(t))}],min:[Rt,Fr(Rt),function(t,e){return Math.min.apply(Math,e.map((function(e){return e.evaluate(t)})))}],max:[Rt,Fr(Rt),function(t,e){return Math.max.apply(Math,e.map((function(e){return e.evaluate(t)})))}],abs:[Rt,[Rt],function(t,e){return Math.abs(e[0].evaluate(t))}],round:[Rt,[Rt],function(t,e){var r=e[0].evaluate(t);return r<0?-Math.round(-r):Math.round(r)}],floor:[Rt,[Rt],function(t,e){return Math.floor(e[0].evaluate(t))}],ceil:[Rt,[Rt],function(t,e){return Math.ceil(e[0].evaluate(t))}],"filter-==":[Qt,[Ot,Ht],function(t,e){var r=e[0],i=e[1];return t.properties()[r.value]===i.value}],"filter-id-==":[Qt,[Ht],function(t,e){var r=e[0];return t.id()===r.value}],"filter-type-==":[Qt,[Ot],function(t,e){var r=e[0];return t.geometryType()===r.value}],"filter-<":[Qt,[Ot,Ht],function(t,e){var r=e[0],i=e[1],n=t.properties()[r.value],o=i.value;return Ze(n)==Ze(o)&&n<o}],"filter-id-<":[Qt,[Ht],function(t,e){var r=e[0],i=t.id(),n=r.value;return Ze(i)==Ze(n)&&i<n}],"filter->":[Qt,[Ot,Ht],function(t,e){var r=e[0],i=e[1],n=t.properties()[r.value],o=i.value;return Ze(n)==Ze(o)&&n>o}],"filter-id->":[Qt,[Ht],function(t,e){var r=e[0],i=t.id(),n=r.value;return Ze(i)==Ze(n)&&i>n}],"filter-<=":[Qt,[Ot,Ht],function(t,e){var r=e[0],i=e[1],n=t.properties()[r.value],o=i.value;return Ze(n)==Ze(o)&&n<=o}],"filter-id-<=":[Qt,[Ht],function(t,e){var r=e[0],i=t.id(),n=r.value;return Ze(i)==Ze(n)&&i<=n}],"filter->=":[Qt,[Ot,Ht],function(t,e){var r=e[0],i=e[1],n=t.properties()[r.value],o=i.value;return Ze(n)==Ze(o)&&n>=o}],"filter-id->=":[Qt,[Ht],function(t,e){var r=e[0],i=t.id(),n=r.value;return Ze(i)==Ze(n)&&i>=n}],"filter-has":[Qt,[Ht],function(t,e){return e[0].value in t.properties()}],"filter-has-id":[Qt,[],function(t){return null!==t.id()&&void 0!==t.id()}],"filter-type-in":[Qt,[qt(Ot)],function(t,e){return e[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[Qt,[qt(Ht)],function(t,e){return e[0].value.indexOf(t.id())>=0}],"filter-in-small":[Qt,[Ot,qt(Ht)],function(t,e){var r=e[0];return e[1].value.indexOf(t.properties()[r.value])>=0}],"filter-in-large":[Qt,[Ot,qt(Ht)],function(t,e){var r=e[0],i=e[1];return function(t,e,r,i){for(;r<=i;){var n=r+i>>1;if(e[n]===t)return!0;e[n]>t?i=n-1:r=n+1}return!1}(t.properties()[r.value],i.value,0,i.value.length-1)}],all:{type:Qt,overloads:[[[Qt,Qt],function(t,e){var r=e[1];return e[0].evaluate(t)&&r.evaluate(t)}],[Fr(Qt),function(t,e){for(var r=0,i=e;r<i.length;r+=1)if(!i[r].evaluate(t))return!1;return!0}]]},any:{type:Qt,overloads:[[[Qt,Qt],function(t,e){var r=e[1];return e[0].evaluate(t)||r.evaluate(t)}],[Fr(Qt),function(t,e){for(var r=0,i=e;r<i.length;r+=1)if(i[r].evaluate(t))return!0;return!1}]]},"!":[Qt,[Qt],function(t,e){return!e[0].evaluate(t)}],"is-supported-script":[Qt,[Ot],function(t,e){var r=t.globals&&t.globals.isSupportedScript;return!r||r(e[0].evaluate(t))}],upcase:[Ot,[Ot],function(t,e){return e[0].evaluate(t).toUpperCase()}],downcase:[Ot,[Ot],function(t,e){return e[0].evaluate(t).toLowerCase()}],concat:[Ot,Fr(Ht),function(t,e){return e.map((function(e){return le(e.evaluate(t))})).join("")}],"resolved-locale":[Ot,[jt],function(t,e){return e[0].evaluate(t).resolvedLocale()}]});var Gr=function(t,e){this.expression=t,this._warningHistory={},this._evaluator=new _e,this._defaultValue=e?function(t){return"color"===t.type&&Rr(t.default)?new te(0,0,0,0):"color"===t.type?te.parse(t.default)||null:void 0===t.default?null:t.default}(e):null,this._enumValues=e&&"enum"===e.type?e.values:null};function Kr(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Tr}function qr(t,e){var r=new Ne(Tr,[],e?function(t){var e={color:Nt,string:Ot,number:Rt,enum:Ot,boolean:Qt,formatted:Gt,resolvedImage:Kt};return"array"===t.type?qt(e[t.value]||Ht,t.length):e[t.type]}(e):void 0),i=r.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return i?Pr(new Gr(i,e)):Lr(r.errors)}Gr.prototype.evaluateWithoutErrorHandling=function(t,e,r,i,n,o){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=r,this._evaluator.canonical=i,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o,this.expression.evaluate(this._evaluator)},Gr.prototype.evaluate=function(t,e,r,i,n,o){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=r||null,this._evaluator.canonical=i,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o||null;try{var a=this.expression.evaluate(this._evaluator);if(null==a||"number"==typeof a&&a!=a)return this._defaultValue;if(this._enumValues&&!(a in this._enumValues))throw new ue("Expected value to be one of "+Object.keys(this._enumValues).map((function(t){return JSON.stringify(t)})).join(", ")+", but found "+JSON.stringify(a)+" instead.");return a}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}};var Zr=function(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!Re(e.expression)};Zr.prototype.evaluateWithoutErrorHandling=function(t,e,r,i,n,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r,i,n,o)},Zr.prototype.evaluate=function(t,e,r,i,n,o){return this._styleExpression.evaluate(t,e,r,i,n,o)};var Wr=function(t,e,r,i){this.kind=t,this.zoomStops=r,this._styleExpression=e,this.isStateDependent="camera"!==t&&!Re(e.expression),this.interpolationType=i};function Xr(t,e){if("error"===(t=qr(t,e)).result)return t;var r=t.value.expression,i=ze(r);if(!i&&!Dr(e))return Lr([new Ut("","data expressions not supported")]);var n=Oe(r,["zoom"]);if(!n&&!Ur(e))return Lr([new Ut("","zoom expressions not supported")]);var o=function t(e){var r=null;if(e instanceof cr)r=t(e.result);else if(e instanceof lr)for(var i=0,n=e.args;i<n.length&&!(r=t(n[i]));i+=1);else(e instanceof He||e instanceof ar)&&e.input instanceof ye&&"zoom"===e.input.name&&(r=e);return r instanceof Ut||e.eachChild((function(e){var i=t(e);i instanceof Ut?r=i:!r&&i?r=new Ut("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&i&&r!==i&&(r=new Ut("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),r}(r);return o||n?o instanceof Ut?Lr([o]):o instanceof ar&&!kr(e)?Lr([new Ut("",'"interpolate" expressions cannot be used with this property')]):Pr(o?new Wr(i?"camera":"composite",t.value,o.labels,o instanceof ar?o.interpolation:void 0):new Zr(i?"constant":"source",t.value)):Lr([new Ut("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Wr.prototype.evaluateWithoutErrorHandling=function(t,e,r,i,n,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r,i,n,o)},Wr.prototype.evaluate=function(t,e,r,i,n,o){return this._styleExpression.evaluate(t,e,r,i,n,o)},Wr.prototype.interpolationFactor=function(t,e,r){return this.interpolationType?ar.interpolationFactor(this.interpolationType,t,e,r):0};var $r=function(t,e){this._parameters=t,this._specification=e,Pt(this,function t(e,r){var i,n,o,a="color"===r.type,s=e.stops&&"object"==Ze(e.stops[0][0]),l=s||!(s||void 0!==e.property),c=e.type||(kr(r)?"exponential":"interval");if(a&&((e=Pt({},e)).stops&&(e.stops=e.stops.map((function(t){return[t[0],te.parse(t[1])]}))),e.default=te.parse(e.default?e.default:r.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!or[e.colorSpace])throw new Error("Unknown color space: "+e.colorSpace);if("exponential"===c)i=Hr;else if("interval"===c)i=Vr;else if("categorical"===c){i=Nr,n=Object.create(null);for(var u=0,h=e.stops;u<h.length;u+=1){var A=h[u];n[A[0]]=A[1]}o=Ze(e.stops[0][0])}else{if("identity"!==c)throw new Error('Unknown function type "'+c+'"');i=jr}if(s){for(var p={},d=[],f=0;f<e.stops.length;f++){var m=e.stops[f],g=m[0].zoom;void 0===p[g]&&(p[g]={zoom:g,type:e.type,property:e.property,default:e.default,stops:[]},d.push(g)),p[g].stops.push([m[0].value,m[1]])}for(var _=[],y=0,v=d;y<v.length;y+=1){var x=v[y];_.push([p[x].zoom,t(p[x],r)])}var w={name:"linear"};return{kind:"composite",interpolationType:w,interpolationFactor:ar.interpolationFactor.bind(void 0,w),zoomStops:_.map((function(t){return t[0]})),evaluate:function(t,i){var n=t.zoom;return Hr({stops:_,base:e.base},r,n).evaluate(n,i)}}}if(l){var b="exponential"===c?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:b,interpolationFactor:ar.interpolationFactor.bind(void 0,b),zoomStops:e.stops.map((function(t){return t[0]})),evaluate:function(t){return i(e,r,t.zoom,n,o)}}}return{kind:"source",evaluate:function(t,a){var s=a&&a.properties?a.properties[e.property]:void 0;return void 0===s?Qr(e.default,r.default):i(e,r,s,n,o)}}}(this._parameters,this._specification))};function Yr(t){var e=t.key,r=t.value,i=t.valueSpec||{},n=t.objectElementValidators||{},o=t.style,a=t.styleSpec,s=[],l=zr(r);if("object"!==l)return[new Mt(e,r,"object expected, "+l+" found")];for(var c in r){var u=c.split(".")[0],h=i[u]||i["*"],A=void 0;if(n[u])A=n[u];else if(i[u])A=bi;else if(n["*"])A=n["*"];else{if(!i["*"]){s.push(new Mt(e,r[c],'unknown property "'+c+'"'));continue}A=bi}s=s.concat(A({key:(e&&e+".")+c,value:r[c],valueSpec:h,style:o,styleSpec:a,object:r,objectKey:c},r))}for(var p in i)n[p]||i[p].required&&void 0===i[p].default&&void 0===r[p]&&s.push(new Mt(e,r,'missing required property "'+p+'"'));return s}function Jr(t){var e=t.value,r=t.valueSpec,i=t.style,n=t.styleSpec,o=t.key,a=t.arrayElementValidator||bi;if("array"!==zr(e))return[new Mt(o,e,"array expected, "+zr(e)+" found")];if(r.length&&e.length!==r.length)return[new Mt(o,e,"array length "+r.length+" expected, length "+e.length+" found")];if(r["min-length"]&&e.length<r["min-length"])return[new Mt(o,e,"array length at least "+r["min-length"]+" expected, length "+e.length+" found")];var s={type:r.value,values:r.values};n.$version<7&&(s.function=r.function),"object"===zr(r.value)&&(s=r.value);for(var l=[],c=0;c<e.length;c++)l=l.concat(a({array:e,arrayIndex:c,value:e[c],valueSpec:s,style:i,styleSpec:n,key:o+"["+c+"]"}));return l}function ti(t){var e=t.key,r=t.value,i=t.valueSpec,n=zr(r);return"number"===n&&r!=r&&(n="NaN"),"number"!==n?[new Mt(e,r,"number expected, "+n+" found")]:"minimum"in i&&r<i.minimum?[new Mt(e,r,r+" is less than the minimum value "+i.minimum)]:"maximum"in i&&r>i.maximum?[new Mt(e,r,r+" is greater than the maximum value "+i.maximum)]:[]}function ei(t){var e,r,i,n=t.valueSpec,o=Lt(t.value.type),a={},s="categorical"!==o&&void 0===t.value.property,l=!s,c="array"===zr(t.value.stops)&&"array"===zr(t.value.stops[0])&&"object"===zr(t.value.stops[0][0]),u=Yr({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===o)return[new Mt(t.key,t.value,'identity function may not have a "stops" property')];var e=[],r=t.value;return e=e.concat(Jr({key:t.key,value:r,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===zr(r)&&0===r.length&&e.push(new Mt(t.key,r,"array must have at least one stop")),e},default:function(t){return bi({key:t.key,value:t.value,valueSpec:n,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===o&&s&&u.push(new Mt(t.key,t.value,'missing required property "property"')),"identity"===o||t.value.stops||u.push(new Mt(t.key,t.value,'missing required property "stops"')),"exponential"===o&&t.valueSpec.expression&&!kr(t.valueSpec)&&u.push(new Mt(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(l&&!Dr(t.valueSpec)?u.push(new Mt(t.key,t.value,"property functions not supported")):s&&!Ur(t.valueSpec)&&u.push(new Mt(t.key,t.value,"zoom functions not supported"))),"categorical"!==o&&!c||void 0!==t.value.property||u.push(new Mt(t.key,t.value,'"property" property is required')),u;function h(t){var e=[],o=t.value,s=t.key;if("array"!==zr(o))return[new Mt(s,o,"array expected, "+zr(o)+" found")];if(2!==o.length)return[new Mt(s,o,"array length 2 expected, length "+o.length+" found")];if(c){if("object"!==zr(o[0]))return[new Mt(s,o,"object expected, "+zr(o[0])+" found")];if(void 0===o[0].zoom)return[new Mt(s,o,"object stop key must have zoom")];if(void 0===o[0].value)return[new Mt(s,o,"object stop key must have value")];if(i&&i>Lt(o[0].zoom))return[new Mt(s,o[0].zoom,"stop zoom values must appear in ascending order")];Lt(o[0].zoom)!==i&&(i=Lt(o[0].zoom),r=void 0,a={}),e=e.concat(Yr({key:s+"[0]",value:o[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:ti,value:A}}))}else e=e.concat(A({key:s+"[0]",value:o[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},o));return Kr(Dt(o[1]))?e.concat([new Mt(s+"[1]",o[1],"expressions are not allowed in function stops.")]):e.concat(bi({key:s+"[1]",value:o[1],valueSpec:n,style:t.style,styleSpec:t.styleSpec}))}function A(t,i){var s=zr(t.value),l=Lt(t.value),c=null!==t.value?t.value:i;if(e){if(s!==e)return[new Mt(t.key,c,s+" stop domain type must match previous stop domain type "+e)]}else e=s;if("number"!==s&&"string"!==s&&"boolean"!==s)return[new Mt(t.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==o){var u="number expected, "+s+" found";return Dr(n)&&void 0===o&&(u+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Mt(t.key,c,u)]}return"categorical"!==o||"number"!==s||isFinite(l)&&Math.floor(l)===l?"categorical"!==o&&"number"===s&&void 0!==r&&l<r?[new Mt(t.key,c,"stop domain values must appear in ascending order")]:(r=l,"categorical"===o&&l in a?[new Mt(t.key,c,"stop domain values must be unique")]:(a[l]=!0,[])):[new Mt(t.key,c,"integer expected, found "+l)]}}function ri(t){var e=("property"===t.expressionContext?Xr:qr)(Dt(t.value),t.valueSpec);if("error"===e.result)return e.value.map((function(e){return new Mt(""+t.key+e.key,t.value,e.message)}));var r=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!r.outputDefined())return[new Mt(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if("property"===t.expressionContext&&"layout"===t.propertyType&&!Re(r))return[new Mt(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext&&!Re(r))return[new Mt(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!Oe(r,["zoom","feature-state"]))return[new Mt(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!ze(r))return[new Mt(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ii(t){var e=t.key,r=t.value,i=t.valueSpec,n=[];return Array.isArray(i.values)?-1===i.values.indexOf(Lt(r))&&n.push(new Mt(e,r,"expected one of ["+i.values.join(", ")+"], "+JSON.stringify(r)+" found")):-1===Object.keys(i.values).indexOf(Lt(r))&&n.push(new Mt(e,r,"expected one of ["+Object.keys(i.values).join(", ")+"], "+JSON.stringify(r)+" found")),n}function ni(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var e=0,r=t.slice(1);e<r.length;e+=1){var i=r[e];if(!ni(i)&&"boolean"!=typeof i)return!1}return!0;default:return!0}}$r.deserialize=function(t){return new $r(t._parameters,t._specification)},$r.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var oi={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ai(t){if(null==t)return{filter:function(){return!0},needGeometry:!1};ni(t)||(t=li(t));var e=qr(t,oi);if("error"===e.result)throw new Error(e.value.map((function(t){return t.key+": "+t.message})).join(", "));return{filter:function(t,r,i){return e.value.evaluate(t,r,{},i)},needGeometry:function t(e){if(!Array.isArray(e))return!1;if("within"===e[0])return!0;for(var r=1;r<e.length;r++)if(t(e[r]))return!0;return!1}(t)}}function si(t,e){return t<e?-1:t>e?1:0}function li(t){if(!t)return!0;var e,r=t[0];return t.length<=1?"any"!==r:"=="===r?ci(t[1],t[2],"=="):"!="===r?Ai(ci(t[1],t[2],"==")):"<"===r||">"===r||"<="===r||">="===r?ci(t[1],t[2],r):"any"===r?(e=t.slice(1),["any"].concat(e.map(li))):"all"===r?["all"].concat(t.slice(1).map(li)):"none"===r?["all"].concat(t.slice(1).map(li).map(Ai)):"in"===r?ui(t[1],t.slice(2)):"!in"===r?Ai(ui(t[1],t.slice(2))):"has"===r?hi(t[1]):"!has"===r?Ai(hi(t[1])):"within"!==r||t}function ci(t,e,r){switch(t){case"$type":return["filter-type-"+r,e];case"$id":return["filter-id-"+r,e];default:return["filter-"+r,t,e]}}function ui(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((function(t){return Ze(t)!=Ze(e[0])}))?["filter-in-large",t,["literal",e.sort(si)]]:["filter-in-small",t,["literal",e]]}}function hi(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Ai(t){return["!",t]}function pi(t){return ni(Dt(t.value))?ri(Pt({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(e){var r=e.value,i=e.key;if("array"!==zr(r))return[new Mt(i,r,"array expected, "+zr(r)+" found")];var n,o=e.styleSpec,a=[];if(r.length<1)return[new Mt(i,r,"filter array must have at least 1 element")];switch(a=a.concat(ii({key:i+"[0]",value:r[0],valueSpec:o.filter_operator,style:e.style,styleSpec:e.styleSpec})),Lt(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&"$type"===Lt(r[1])&&a.push(new Mt(i,r,'"$type" cannot be use with operator "'+r[0]+'"'));case"==":case"!=":3!==r.length&&a.push(new Mt(i,r,'filter array for operator "'+r[0]+'" must have 3 elements'));case"in":case"!in":r.length>=2&&"string"!==(n=zr(r[1]))&&a.push(new Mt(i+"[1]",r[1],"string expected, "+n+" found"));for(var s=2;s<r.length;s++)n=zr(r[s]),"$type"===Lt(r[1])?a=a.concat(ii({key:i+"["+s+"]",value:r[s],valueSpec:o.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==n&&"number"!==n&&"boolean"!==n&&a.push(new Mt(i+"["+s+"]",r[s],"string, number, or boolean expected, "+n+" found"));break;case"any":case"all":case"none":for(var l=1;l<r.length;l++)a=a.concat(t({key:i+"["+l+"]",value:r[l],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":n=zr(r[1]),2!==r.length?a.push(new Mt(i,r,'filter array for "'+r[0]+'" operator must have 2 elements')):"string"!==n&&a.push(new Mt(i+"[1]",r[1],"string expected, "+n+" found"));break;case"within":n=zr(r[1]),2!==r.length?a.push(new Mt(i,r,'filter array for "'+r[0]+'" operator must have 2 elements')):"object"!==n&&a.push(new Mt(i+"[1]",r[1],"object expected, "+n+" found"))}return a}(t)}function di(t,e){var r=t.key,i=t.style,n=t.styleSpec,o=t.value,a=t.objectKey,s=n[e+"_"+t.layerType];if(!s)return[];var l=a.match(/^(.*)-transition$/);if("paint"===e&&l&&s[l[1]]&&s[l[1]].transition)return bi({key:r,value:o,valueSpec:n.transition,style:i,styleSpec:n});var c,u=t.valueSpec||s[a];if(!u)return[new Mt(r,o,'unknown property "'+a+'"')];if("string"===zr(o)&&Dr(u)&&!u.tokens&&(c=/^{([^}]+)}$/.exec(o)))return[new Mt(r,o,'"'+a+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(c[1])+" }`.")];var h=[];return"symbol"===t.layerType&&("text-field"===a&&i&&!i.glyphs&&h.push(new Mt(r,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&Rr(Dt(o))&&"identity"===Lt(o.type)&&h.push(new Mt(r,o,'"text-font" does not support identity functions'))),h.concat(bi({key:t.key,value:o,valueSpec:u,style:i,styleSpec:n,expressionContext:"property",propertyType:e,propertyKey:a}))}function fi(t){return di(t,"paint")}function mi(t){return di(t,"layout")}function gi(t){var e=[],r=t.value,i=t.key,n=t.style,o=t.styleSpec;r.type||r.ref||e.push(new Mt(i,r,'either "type" or "ref" is required'));var a,s=Lt(r.type),l=Lt(r.ref);if(r.id)for(var c=Lt(r.id),u=0;u<t.arrayIndex;u++){var h=n.layers[u];Lt(h.id)===c&&e.push(new Mt(i,r.id,'duplicate layer id "'+r.id+'", previously used at line '+h.id.__line__))}if("ref"in r)["type","source","source-layer","filter","layout"].forEach((function(t){t in r&&e.push(new Mt(i,r[t],'"'+t+'" is prohibited for ref layers'))})),n.layers.forEach((function(t){Lt(t.id)===l&&(a=t)})),a?a.ref?e.push(new Mt(i,r.ref,"ref cannot reference another ref layer")):s=Lt(a.type):e.push(new Mt(i,r.ref,'ref layer "'+l+'" not found'));else if("background"!==s)if(r.source){var A=n.sources&&n.sources[r.source],p=A&&Lt(A.type);A?"vector"===p&&"raster"===s?e.push(new Mt(i,r.source,'layer "'+r.id+'" requires a raster source')):"raster"===p&&"raster"!==s?e.push(new Mt(i,r.source,'layer "'+r.id+'" requires a vector source')):"vector"!==p||r["source-layer"]?"raster-dem"===p&&"hillshade"!==s?e.push(new Mt(i,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!r.paint||!r.paint["line-gradient"]||"geojson"===p&&A.lineMetrics||e.push(new Mt(i,r,'layer "'+r.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):e.push(new Mt(i,r,'layer "'+r.id+'" must specify a "source-layer"')):e.push(new Mt(i,r.source,'source "'+r.source+'" not found'))}else e.push(new Mt(i,r,'missing required property "source"'));return e=e.concat(Yr({key:i,value:r,valueSpec:o.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return bi({key:i+".type",value:r.type,valueSpec:o.layer.type,style:t.style,styleSpec:t.styleSpec,object:r,objectKey:"type"})},filter:pi,layout:function(t){return Yr({layer:r,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return mi(Pt({layerType:s},t))}}})},paint:function(t){return Yr({layer:r,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return fi(Pt({layerType:s},t))}}})}}}))}function _i(t){var e=t.value,r=t.key,i=zr(e);return"string"!==i?[new Mt(r,e,"string expected, "+i+" found")]:[]}var yi={promoteId:function(t){var e=t.key,r=t.value;if("string"===zr(r))return _i({key:e,value:r});var i=[];for(var n in r)i.push.apply(i,_i({key:e+"."+n,value:r[n]}));return i}};function vi(t){var e=t.value,r=t.key,i=t.styleSpec,n=t.style;if(!e.type)return[new Mt(r,e,'"type" is required')];var o,a=Lt(e.type);switch(a){case"vector":case"raster":case"raster-dem":return Yr({key:r,value:e,valueSpec:i["source_"+a.replace("-","_")],style:t.style,styleSpec:i,objectElementValidators:yi});case"geojson":if(o=Yr({key:r,value:e,valueSpec:i.source_geojson,style:n,styleSpec:i,objectElementValidators:yi}),e.cluster)for(var s in e.clusterProperties){var l=e.clusterProperties[s],c=l[0],u="string"==typeof c?[c,["accumulated"],["get",s]]:c;o.push.apply(o,ri({key:r+"."+s+".map",value:l[1],expressionContext:"cluster-map"})),o.push.apply(o,ri({key:r+"."+s+".reduce",value:u,expressionContext:"cluster-reduce"}))}return o;case"video":return Yr({key:r,value:e,valueSpec:i.source_video,style:n,styleSpec:i});case"image":return Yr({key:r,value:e,valueSpec:i.source_image,style:n,styleSpec:i});case"canvas":return[new Mt(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ii({key:r+".type",value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:n,styleSpec:i})}}function xi(t){var e=t.value,r=t.styleSpec,i=r.light,n=t.style,o=[],a=zr(e);if(void 0===e)return o;if("object"!==a)return o.concat([new Mt("light",e,"object expected, "+a+" found")]);for(var s in e){var l=s.match(/^(.*)-transition$/);o=o.concat(l&&i[l[1]]&&i[l[1]].transition?bi({key:s,value:e[s],valueSpec:r.transition,style:n,styleSpec:r}):i[s]?bi({key:s,value:e[s],valueSpec:i[s],style:n,styleSpec:r}):[new Mt(s,e[s],'unknown property "'+s+'"')])}return o}var wi={"*":function(){return[]},array:Jr,boolean:function(t){var e=t.value,r=t.key,i=zr(e);return"boolean"!==i?[new Mt(r,e,"boolean expected, "+i+" found")]:[]},number:ti,color:function(t){var e=t.key,r=t.value,i=zr(r);return"string"!==i?[new Mt(e,r,"color expected, "+i+" found")]:null===Jt(r)?[new Mt(e,r,'color expected, "'+r+'" found')]:[]},constants:Ft,enum:ii,filter:pi,function:ei,layer:gi,object:Yr,source:vi,light:xi,string:_i,formatted:function(t){return 0===_i(t).length?[]:ri(t)},resolvedImage:function(t){return 0===_i(t).length?[]:ri(t)}};function bi(t){var e=t.value,r=t.valueSpec,i=t.styleSpec;return r.expression&&Rr(Lt(e))?ei(t):r.expression&&Kr(Dt(e))?ri(t):r.type&&wi[r.type]?wi[r.type](t):Yr(Pt({},t,{valueSpec:r.type?i[r.type]:r}))}function Bi(t){var e=t.value,r=t.key,i=_i(t);return i.length||(-1===e.indexOf("{fontstack}")&&i.push(new Mt(r,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&i.push(new Mt(r,e,'"glyphs" url must include a "{range}" token'))),i}function Ci(t,e){void 0===e&&(e=St);var r=[];return r=r.concat(bi({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Bi,"*":function(){return[]}}})),t.constants&&(r=r.concat(Ft({key:"constants",value:t.constants,style:t,styleSpec:e}))),Ei(r)}function Ei(t){return[].concat(t).sort((function(t,e){return t.line-e.line}))}function Ti(t){return function(){for(var e=[],r=arguments.length;r--;)e[r]=arguments[r];return Ei(t.apply(this,e))}}Ci.source=Ti(vi),Ci.light=Ti(xi),Ci.layer=Ti(gi),Ci.filter=Ti(pi),Ci.paintProperty=Ti(fi),Ci.layoutProperty=Ti(mi);var Ii=Ci,Si=Ii.light,Mi=Ii.paintProperty,Fi=Ii.layoutProperty;function Pi(t,e){var r=!1;if(e&&e.length)for(var i=0,n=e;i<n.length;i+=1)t.fire(new Tt(new Error(n[i].message))),r=!0;return r}var Li=Di;function Di(t,e,r){var i=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var n=new Int32Array(this.arrayBuffer);t=n[0],this.d=(e=n[1])+2*(r=n[2]);for(var o=0;o<this.d*this.d;o++){var a=n[3+o],s=n[3+o+1];i.push(a===s?null:n.subarray(a,s))}var l=n[3+i.length+1];this.keys=n.subarray(n[3+i.length],l),this.bboxes=n.subarray(l),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var c=0;c<this.d*this.d;c++)i.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=r,this.scale=e/t,this.uid=0;var u=r/e*t;this.min=-u,this.max=t+u}Di.prototype.insert=function(t,e,r,i,n){this._forEachCell(e,r,i,n,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(i),this.bboxes.push(n)},Di.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Di.prototype._insertCell=function(t,e,r,i,n,o){this.cells[n].push(o)},Di.prototype.query=function(t,e,r,i,n){var o=this.min,a=this.max;if(t<=o&&e<=o&&a<=r&&a<=i&&!n)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(t,e,r,i,this._queryCell,s,{},n),s},Di.prototype._queryCell=function(t,e,r,i,n,o,a,s){var l=this.cells[n];if(null!==l)for(var c=this.keys,u=this.bboxes,h=0;h<l.length;h++){var A=l[h];if(void 0===a[A]){var p=4*A;(s?s(u[p+0],u[p+1],u[p+2],u[p+3]):t<=u[p+2]&&e<=u[p+3]&&r>=u[p+0]&&i>=u[p+1])?(a[A]=!0,o.push(c[A])):a[A]=!1}}},Di.prototype._forEachCell=function(t,e,r,i,n,o,a,s){for(var l=this._convertToCellCoord(t),c=this._convertToCellCoord(e),u=this._convertToCellCoord(r),h=this._convertToCellCoord(i),A=l;A<=u;A++)for(var p=c;p<=h;p++){var d=this.d*p+A;if((!s||s(this._convertFromCellCoord(A),this._convertFromCellCoord(p),this._convertFromCellCoord(A+1),this._convertFromCellCoord(p+1)))&&n.call(this,t,e,r,i,d,o,a,s))return}},Di.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Di.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Di.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,r=0,i=0;i<this.cells.length;i++)r+=this.cells[i].length;var n=new Int32Array(e+r+this.keys.length+this.bboxes.length);n[0]=this.extent,n[1]=this.n,n[2]=this.padding;for(var o=e,a=0;a<t.length;a++){var s=t[a];n[3+a]=o,n.set(s,o),o+=s.length}return n[3+t.length]=o,n.set(this.keys,o),n[3+t.length+1]=o+=this.keys.length,n.set(this.bboxes,o),o+=this.bboxes.length,n.buffer};var Ui=a.ImageData,ki=a.ImageBitmap,zi={};function Ri(t,e,r){void 0===r&&(r={}),Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),zi[t]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}for(var Oi in Ri("Object",Object),Li.serialize=function(t,e){var r=t.toArrayBuffer();return e&&e.push(r),{buffer:r}},Li.deserialize=function(t){return new Li(t.buffer)},Ri("Grid",Li),Ri("Color",te),Ri("Error",Error),Ri("ResolvedImage",ne),Ri("StylePropertyFunction",$r),Ri("StyleExpression",Gr,{omit:["_evaluator"]}),Ri("ZoomDependentExpression",Wr),Ri("ZoomConstantExpression",Zr),Ri("CompoundExpression",ye,{omit:["_evaluate"]}),Tr)Tr[Oi]._classRegistryKey||Ri("Expression_"+Oi,Tr[Oi]);function Qi(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function Ni(t){return ki&&t instanceof ki}function Vi(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Qi(t)||Ni(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){var r=t;return e&&e.push(r.buffer),r}if(t instanceof Ui)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){for(var i=[],n=0,o=t;n<o.length;n+=1)i.push(Vi(o[n],e));return i}if("object"==Ze(t)){var a=t.constructor,s=a._classRegistryKey;if(!s)throw new Error("can't serialize object of unregistered class");var l=a.serialize?a.serialize(t,e):{};if(!a.serialize){for(var c in t)if(t.hasOwnProperty(c)&&!(zi[s].omit.indexOf(c)>=0)){var u=t[c];l[c]=zi[s].shallow.indexOf(c)>=0?u:Vi(u,e)}t instanceof Error&&(l.message=t.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(l.$name=s),l}throw new Error("can't serialize object of type "+Ze(t))}function Hi(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Qi(t)||Ni(t)||ArrayBuffer.isView(t)||t instanceof Ui)return t;if(Array.isArray(t))return t.map(Hi);if("object"==Ze(t)){var e=t.$name||"Object",r=zi[e].klass;if(!r)throw new Error("can't deserialize unregistered class "+e);if(r.deserialize)return r.deserialize(t);for(var i=Object.create(r.prototype),n=0,o=Object.keys(t);n<o.length;n+=1){var a=o[n];if("$name"!==a){var s=t[a];i[a]=zi[e].shallow.indexOf(a)>=0?s:Hi(s)}}return i}throw new Error("can't deserialize object of type "+Ze(t))}var ji=function(){this.first=!0};ji.prototype.update=function(t,e){var r=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=r,!0))};var Gi={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function Ki(t){for(var e=0,r=t;e<r.length;e+=1)if(qi(r[e].charCodeAt(0)))return!0;return!1}function qi(t){return!(746!==t&&747!==t&&(t<4352||!(Gi["Bopomofo Extended"](t)||Gi.Bopomofo(t)||Gi["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Gi["CJK Compatibility Ideographs"](t)||Gi["CJK Compatibility"](t)||Gi["CJK Radicals Supplement"](t)||Gi["CJK Strokes"](t)||!(!Gi["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||Gi["CJK Unified Ideographs Extension A"](t)||Gi["CJK Unified Ideographs"](t)||Gi["Enclosed CJK Letters and Months"](t)||Gi["Hangul Compatibility Jamo"](t)||Gi["Hangul Jamo Extended-A"](t)||Gi["Hangul Jamo Extended-B"](t)||Gi["Hangul Jamo"](t)||Gi["Hangul Syllables"](t)||Gi.Hiragana(t)||Gi["Ideographic Description Characters"](t)||Gi.Kanbun(t)||Gi["Kangxi Radicals"](t)||Gi["Katakana Phonetic Extensions"](t)||Gi.Katakana(t)&&12540!==t||!(!Gi["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!Gi["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Gi["Unified Canadian Aboriginal Syllabics"](t)||Gi["Unified Canadian Aboriginal Syllabics Extended"](t)||Gi["Vertical Forms"](t)||Gi["Yijing Hexagram Symbols"](t)||Gi["Yi Syllables"](t)||Gi["Yi Radicals"](t))))}function Zi(t){return!(qi(t)||(e=t,Gi["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||Gi["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||Gi["Letterlike Symbols"](e)||Gi["Number Forms"](e)||Gi["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||Gi["Control Pictures"](e)&&9251!==e||Gi["Optical Character Recognition"](e)||Gi["Enclosed Alphanumerics"](e)||Gi["Geometric Shapes"](e)||Gi["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Gi["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Gi["CJK Symbols and Punctuation"](e)||Gi.Katakana(e)||Gi["Private Use Area"](e)||Gi["CJK Compatibility Forms"](e)||Gi["Small Form Variants"](e)||Gi["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e}function Wi(t){return t>=1424&&t<=2303||Gi["Arabic Presentation Forms-A"](t)||Gi["Arabic Presentation Forms-B"](t)}function Xi(t,e){return!(!e&&Wi(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Gi.Khmer(t))}function $i(t){for(var e=0,r=t;e<r.length;e+=1)if(Wi(r[e].charCodeAt(0)))return!0;return!1}var Yi=null,Ji="unavailable",tn=null,en=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(Ji="error"),Yi&&Yi(t)};function rn(){nn.fire(new Et("pluginStateChange",{pluginStatus:Ji,pluginURL:tn}))}var nn=new It,on=function(){return Ji},an=function(){if("deferred"!==Ji||!tn)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ji="loading",rn(),tn&&vt({url:tn},(function(t){t?en(t):(Ji="loaded",rn())}))},sn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return"loaded"===Ji||null!=sn.applyArabicShaping},isLoading:function(){return"loading"===Ji},setState:function(t){Ji=t.pluginStatus,tn=t.pluginURL},isParsed:function(){return null!=sn.applyArabicShaping&&null!=sn.processBidirectionalText&&null!=sn.processStyledBidirectionalText},getPluginURL:function(){return tn}},ln=function(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ji,this.transition={})};ln.prototype.isSupportedScript=function(t){return function(t,e){for(var r=0,i=t;r<i.length;r+=1)if(!Xi(i[r].charCodeAt(0),e))return!1;return!0}(t,sn.isLoaded())},ln.prototype.crossFadingFactor=function(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},ln.prototype.getCrossfadeParameters=function(){var t=this.zoom,e=t-Math.floor(t),r=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*e}};var cn=function(t,e){this.property=t,this.value=e,this.expression=function(t,e){if(Rr(t))return new $r(t,e);if(Kr(t)){var r=Xr(t,e);if("error"===r.result)throw new Error(r.value.map((function(t){return t.key+": "+t.message})).join(", "));return r.value}var i=t;return"string"==typeof t&&"color"===e.type&&(i=te.parse(t)),{kind:"constant",evaluate:function(){return i}}}(void 0===e?t.specification.default:e,t.specification)};cn.prototype.isDataDriven=function(){return"source"===this.expression.kind||"composite"===this.expression.kind},cn.prototype.possiblyEvaluate=function(t,e,r){return this.property.possiblyEvaluate(this,t,e,r)};var un=function(t){this.property=t,this.value=new cn(t,void 0)};un.prototype.transitioned=function(t,e){return new An(this.property,this.value,e,A({},t.transition,this.transition),t.now)},un.prototype.untransitioned=function(){return new An(this.property,this.value,null,{},0)};var hn=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};hn.prototype.getValue=function(t){return x(this._values[t].value.value)},hn.prototype.setValue=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new un(this._values[t].property)),this._values[t].value=new cn(this._values[t].property,null===e?void 0:x(e))},hn.prototype.getTransition=function(t){return x(this._values[t].transition)},hn.prototype.setTransition=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new un(this._values[t].property)),this._values[t].transition=x(e)||void 0},hn.prototype.serialize=function(){for(var t={},e=0,r=Object.keys(this._values);e<r.length;e+=1){var i=r[e],n=this.getValue(i);void 0!==n&&(t[i]=n);var o=this.getTransition(i);void 0!==o&&(t[i+"-transition"]=o)}return t},hn.prototype.transitioned=function(t,e){for(var r=new pn(this._properties),i=0,n=Object.keys(this._values);i<n.length;i+=1){var o=n[i];r._values[o]=this._values[o].transitioned(t,e._values[o])}return r},hn.prototype.untransitioned=function(){for(var t=new pn(this._properties),e=0,r=Object.keys(this._values);e<r.length;e+=1){var i=r[e];t._values[i]=this._values[i].untransitioned()}return t};var An=function(t,e,r,i,n){this.property=t,this.value=e,this.begin=n+i.delay||0,this.end=this.begin+i.duration||0,t.specification.transition&&(i.delay||i.duration)&&(this.prior=r)};An.prototype.possiblyEvaluate=function(t,e,r){var i=t.now||0,n=this.value.possiblyEvaluate(t,e,r),o=this.prior;if(o){if(i>this.end)return this.prior=null,n;if(this.value.isDataDriven())return this.prior=null,n;if(i<this.begin)return o.possiblyEvaluate(t,e,r);var a=(i-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(t,e,r),n,function(t){if(t<=0)return 0;if(t>=1)return 1;var e=t*t,r=e*t;return 4*(t<.5?r:3*(t-e)+r-.75)}(a))}return n};var pn=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};pn.prototype.possiblyEvaluate=function(t,e,r){for(var i=new mn(this._properties),n=0,o=Object.keys(this._values);n<o.length;n+=1){var a=o[n];i._values[a]=this._values[a].possiblyEvaluate(t,e,r)}return i},pn.prototype.hasTransition=function(){for(var t=0,e=Object.keys(this._values);t<e.length;t+=1)if(this._values[e[t]].prior)return!0;return!1};var dn=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};dn.prototype.getValue=function(t){return x(this._values[t].value)},dn.prototype.setValue=function(t,e){this._values[t]=new cn(this._values[t].property,null===e?void 0:x(e))},dn.prototype.serialize=function(){for(var t={},e=0,r=Object.keys(this._values);e<r.length;e+=1){var i=r[e],n=this.getValue(i);void 0!==n&&(t[i]=n)}return t},dn.prototype.possiblyEvaluate=function(t,e,r){for(var i=new mn(this._properties),n=0,o=Object.keys(this._values);n<o.length;n+=1){var a=o[n];i._values[a]=this._values[a].possiblyEvaluate(t,e,r)}return i};var fn=function(t,e,r){this.property=t,this.value=e,this.parameters=r};fn.prototype.isConstant=function(){return"constant"===this.value.kind},fn.prototype.constantOr=function(t){return"constant"===this.value.kind?this.value.value:t},fn.prototype.evaluate=function(t,e,r,i){return this.property.evaluate(this.value,this.parameters,t,e,r,i)};var mn=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};mn.prototype.get=function(t){return this._values[t]};var gn=function(t){this.specification=t};gn.prototype.possiblyEvaluate=function(t,e){return t.expression.evaluate(e)},gn.prototype.interpolate=function(t,e,r){var i=Ge[this.specification.type];return i?i(t,e,r):t};var _n=function(t,e){this.specification=t,this.overrides=e};_n.prototype.possiblyEvaluate=function(t,e,r,i){return new fn(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},r,i)}:t.expression,e)},_n.prototype.interpolate=function(t,e,r){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new fn(this,{kind:"constant",value:void 0},t.parameters);var i=Ge[this.specification.type];return i?new fn(this,{kind:"constant",value:i(t.value.value,e.value.value,r)},t.parameters):t},_n.prototype.evaluate=function(t,e,r,i,n,o){return"constant"===t.kind?t.value:t.evaluate(e,r,i,n,o)};var yn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.possiblyEvaluate=function(t,e,r,i){if(void 0===t.value)return new fn(this,{kind:"constant",value:void 0},e);if("constant"===t.expression.kind){var n=t.expression.evaluate(e,null,{},r,i),o="resolvedImage"===t.property.specification.type&&"string"!=typeof n?n.name:n,a=this._calculate(o,o,o,e);return new fn(this,{kind:"constant",value:a},e)}if("camera"===t.expression.kind){var s=this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e);return new fn(this,{kind:"constant",value:s},e)}return new fn(this,t.expression,e)},e.prototype.evaluate=function(t,e,r,i,n,o){if("source"===t.kind){var a=t.evaluate(e,r,i,n,o);return this._calculate(a,a,a,e)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(e.zoom)-1},r,i),t.evaluate({zoom:Math.floor(e.zoom)},r,i),t.evaluate({zoom:Math.floor(e.zoom)+1},r,i),e):t.value},e.prototype._calculate=function(t,e,r,i){return i.zoom>i.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:r,to:e}},e.prototype.interpolate=function(t){return t},e}(_n),vn=function(t){this.specification=t};vn.prototype.possiblyEvaluate=function(t,e,r,i){if(void 0!==t.value){if("constant"===t.expression.kind){var n=t.expression.evaluate(e,null,{},r,i);return this._calculate(n,n,n,e)}return this._calculate(t.expression.evaluate(new ln(Math.floor(e.zoom-1),e)),t.expression.evaluate(new ln(Math.floor(e.zoom),e)),t.expression.evaluate(new ln(Math.floor(e.zoom+1),e)),e)}},vn.prototype._calculate=function(t,e,r,i){return i.zoom>i.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:r,to:e}},vn.prototype.interpolate=function(t){return t};var xn=function(t){this.specification=t};xn.prototype.possiblyEvaluate=function(t,e,r,i){return!!t.expression.evaluate(e,null,{},r,i)},xn.prototype.interpolate=function(){return!1};var wn=function(t){for(var e in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var r=t[e];r.specification.overridable&&this.overridableProperties.push(e);var i=this.defaultPropertyValues[e]=new cn(r,void 0),n=this.defaultTransitionablePropertyValues[e]=new un(r);this.defaultTransitioningPropertyValues[e]=n.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=i.possiblyEvaluate({})}};Ri("DataDrivenProperty",_n),Ri("DataConstantProperty",gn),Ri("CrossFadedDataDrivenProperty",yn),Ri("CrossFadedProperty",vn),Ri("ColorRampProperty",xn);var bn=function(t){function e(e,r){if(t.call(this),this.id=e.id,this.type=e.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new dn(r.layout)),r.paint)){for(var i in this._transitionablePaint=new hn(r.paint),e.paint)this.setPaintProperty(i,e.paint[i],{validate:!1});for(var n in e.layout)this.setLayoutProperty(n,e.layout[n],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new mn(r.paint)}}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},e.prototype.getLayoutProperty=function(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)},e.prototype.setLayoutProperty=function(t,e,r){void 0===r&&(r={}),null!=e&&this._validate(Fi,"layers."+this.id+".layout."+t,t,e,r)||("visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility=e)},e.prototype.getPaintProperty=function(t){return _(t,"-transition")?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)},e.prototype.setPaintProperty=function(t,e,r){if(void 0===r&&(r={}),null!=e&&this._validate(Mi,"layers."+this.id+".paint."+t,t,e,r))return!1;if(_(t,"-transition"))return this._transitionablePaint.setTransition(t.slice(0,-11),e||void 0),!1;var i=this._transitionablePaint._values[t],n="cross-faded-data-driven"===i.property.specification["property-type"],o=i.value.isDataDriven(),a=i.value;this._transitionablePaint.setValue(t,e),this._handleSpecialPaintPropertyUpdate(t);var s=this._transitionablePaint._values[t].value;return s.isDataDriven()||o||n||this._handleOverridablePaintPropertyUpdate(t,a,s)},e.prototype._handleSpecialPaintPropertyUpdate=function(t){},e.prototype._handleOverridablePaintPropertyUpdate=function(t,e,r){return!1},e.prototype.isHidden=function(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility},e.prototype.updateTransitions=function(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)},e.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},e.prototype.recalculate=function(t,e){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,e)},e.prototype.serialize=function(){var t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),v(t,(function(t,e){return!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)}))},e.prototype._validate=function(t,e,r,i,n){return void 0===n&&(n={}),(!n||!1!==n.validate)&&Pi(this,t.call(Ii,{key:e,layerType:this.type,objectKey:r,value:i,styleSpec:St,style:{glyphs:!0,sprite:!0}}))},e.prototype.is3D=function(){return!1},e.prototype.isTileClipped=function(){return!1},e.prototype.hasOffscreenPass=function(){return!1},e.prototype.resize=function(){},e.prototype.isStateDependent=function(){for(var t in this.paint._values){var e=this.paint.get(t);if(e instanceof fn&&Dr(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1},e}(It),Bn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Cn=function(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},En=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Tn(t,e){void 0===e&&(e=1);var r=0,i=0;return{members:t.map((function(t){var n=Bn[t.type].BYTES_PER_ELEMENT,o=r=In(r,Math.max(e,n)),a=t.components||1;return i=Math.max(i,n),r+=n*a,{name:t.name,type:t.type,components:a,offset:o}})),size:In(r,Math.max(i,e)),alignment:e}}function In(t,e){return Math.ceil(t/e)*e}En.serialize=function(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},En.deserialize=function(t){var e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e},En.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},En.prototype.clear=function(){this.length=0},En.prototype.resize=function(t){this.reserve(t),this.length=t},En.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}},En.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Sn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var r=this.length;return this.resize(r+1),this.emplace(r,t,e)},e.prototype.emplace=function(t,e,r){var i=2*t;return this.int16[i+0]=e,this.int16[i+1]=r,t},e}(En);Sn.prototype.bytesPerElement=4,Ri("StructArrayLayout2i4",Sn);var Mn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,i){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,r,i)},e.prototype.emplace=function(t,e,r,i,n){var o=4*t;return this.int16[o+0]=e,this.int16[o+1]=r,this.int16[o+2]=i,this.int16[o+3]=n,t},e}(En);Mn.prototype.bytesPerElement=8,Ri("StructArrayLayout4i8",Mn);var Fn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,i,n,o){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,r,i,n,o)},e.prototype.emplace=function(t,e,r,i,n,o,a){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=r,this.int16[s+2]=i,this.int16[s+3]=n,this.int16[s+4]=o,this.int16[s+5]=a,t},e}(En);Fn.prototype.bytesPerElement=12,Ri("StructArrayLayout2i4i12",Fn);var Pn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,i,n,o){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,r,i,n,o)},e.prototype.emplace=function(t,e,r,i,n,o,a){var s=4*t,l=8*t;return this.int16[s+0]=e,this.int16[s+1]=r,this.uint8[l+4]=i,this.uint8[l+5]=n,this.uint8[l+6]=o,this.uint8[l+7]=a,t},e}(En);Pn.prototype.bytesPerElement=8,Ri("StructArrayLayout2i4ub8",Pn);var Ln=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var r=this.length;return this.resize(r+1),this.emplace(r,t,e)},e.prototype.emplace=function(t,e,r){var i=2*t;return this.float32[i+0]=e,this.float32[i+1]=r,t},e}(En);Ln.prototype.bytesPerElement=8,Ri("StructArrayLayout2f8",Ln);var Dn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,i,n,o,a,s,l,c){var u=this.length;return this.resize(u+1),this.emplace(u,t,e,r,i,n,o,a,s,l,c)},e.prototype.emplace=function(t,e,r,i,n,o,a,s,l,c,u){var h=10*t;return this.uint16[h+0]=e,this.uint16[h+1]=r,this.uint16[h+2]=i,this.uint16[h+3]=n,this.uint16[h+4]=o,this.uint16[h+5]=a,this.uint16[h+6]=s,this.uint16[h+7]=l,this.uint16[h+8]=c,this.uint16[h+9]=u,t},e}(En);Dn.prototype.bytesPerElement=20,Ri("StructArrayLayout10ui20",Dn);var Un=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,i,n,o,a,s,l,c,u,h){var A=this.length;return this.resize(A+1),this.emplace(A,t,e,r,i,n,o,a,s,l,c,u,h)},e.prototype.emplace=function(t,e,r,i,n,o,a,s,l,c,u,h,A){var p=12*t;return this.int16[p+0]=e,this.int16[p+1]=r,this.int16[p+2]=i,this.int16[p+3]=n,this.uint16[p+4]=o,this.uint16[p+5]=a,this.uint16[p+6]=s,this.uint16[p+7]=l,this.int16[p+8]=c,this.int16[p+9]=u,this.int16[p+10]=h,this.int16[p+11]=A,t},e}(En);Un.prototype.bytesPerElement=24,Ri("StructArrayLayout4i4ui4i24",Un);var kn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,r)},e.prototype.emplace=function(t,e,r,i){var n=3*t;return this.float32[n+0]=e,this.float32[n+1]=r,this.float32[n+2]=i,t},e}(En);kn.prototype.bytesPerElement=12,Ri("StructArrayLayout3f12",kn);var zn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.uint32[1*t+0]=e,t},e}(En);zn.prototype.bytesPerElement=4,Ri("StructArrayLayout1ul4",zn);var Rn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,i,n,o,a,s,l){var c=this.length;return this.resize(c+1),this.emplace(c,t,e,r,i,n,o,a,s,l)},e.prototype.emplace=function(t,e,r,i,n,o,a,s,l,c){var u=10*t,h=5*t;return this.int16[u+0]=e,this.int16[u+1]=r,this.int16[u+2]=i,this.int16[u+3]=n,this.int16[u+4]=o,this.int16[u+5]=a,this.uint32[h+3]=s,this.uint16[u+8]=l,this.uint16[u+9]=c,t},e}(En);Rn.prototype.bytesPerElement=20,Ri("StructArrayLayout6i1ul2ui20",Rn);var On=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,i,n,o){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,r,i,n,o)},e.prototype.emplace=function(t,e,r,i,n,o,a){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=r,this.int16[s+2]=i,this.int16[s+3]=n,this.int16[s+4]=o,this.int16[s+5]=a,t},e}(En);On.prototype.bytesPerElement=12,Ri("StructArrayLayout2i2i2i12",On);var Qn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,i,n){var o=this.length;return this.resize(o+1),this.emplace(o,t,e,r,i,n)},e.prototype.emplace=function(t,e,r,i,n,o){var a=4*t,s=8*t;return this.float32[a+0]=e,this.float32[a+1]=r,this.float32[a+2]=i,this.int16[s+6]=n,this.int16[s+7]=o,t},e}(En);Qn.prototype.bytesPerElement=16,Ri("StructArrayLayout2f1f2i16",Qn);var Nn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,i){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,r,i)},e.prototype.emplace=function(t,e,r,i,n){var o=12*t,a=3*t;return this.uint8[o+0]=e,this.uint8[o+1]=r,this.float32[a+1]=i,this.float32[a+2]=n,t},e}(En);Nn.prototype.bytesPerElement=12,Ri("StructArrayLayout2ub2f12",Nn);var Vn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,r)},e.prototype.emplace=function(t,e,r,i){var n=3*t;return this.uint16[n+0]=e,this.uint16[n+1]=r,this.uint16[n+2]=i,t},e}(En);Vn.prototype.bytesPerElement=6,Ri("StructArrayLayout3ui6",Vn);var Hn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,i,n,o,a,s,l,c,u,h,A,p,d,f,m){var g=this.length;return this.resize(g+1),this.emplace(g,t,e,r,i,n,o,a,s,l,c,u,h,A,p,d,f,m)},e.prototype.emplace=function(t,e,r,i,n,o,a,s,l,c,u,h,A,p,d,f,m,g){var _=24*t,y=12*t,v=48*t;return this.int16[_+0]=e,this.int16[_+1]=r,this.uint16[_+2]=i,this.uint16[_+3]=n,this.uint32[y+2]=o,this.uint32[y+3]=a,this.uint32[y+4]=s,this.uint16[_+10]=l,this.uint16[_+11]=c,this.uint16[_+12]=u,this.float32[y+7]=h,this.float32[y+8]=A,this.uint8[v+36]=p,this.uint8[v+37]=d,this.uint8[v+38]=f,this.uint32[y+10]=m,this.int16[_+22]=g,t},e}(En);Hn.prototype.bytesPerElement=48,Ri("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Hn);var jn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,i,n,o,a,s,l,c,u,h,A,p,d,f,m,g,_,y,v,x,w,b,B,C,E,T){var I=this.length;return this.resize(I+1),this.emplace(I,t,e,r,i,n,o,a,s,l,c,u,h,A,p,d,f,m,g,_,y,v,x,w,b,B,C,E,T)},e.prototype.emplace=function(t,e,r,i,n,o,a,s,l,c,u,h,A,p,d,f,m,g,_,y,v,x,w,b,B,C,E,T,I){var S=34*t,M=17*t;return this.int16[S+0]=e,this.int16[S+1]=r,this.int16[S+2]=i,this.int16[S+3]=n,this.int16[S+4]=o,this.int16[S+5]=a,this.int16[S+6]=s,this.int16[S+7]=l,this.uint16[S+8]=c,this.uint16[S+9]=u,this.uint16[S+10]=h,this.uint16[S+11]=A,this.uint16[S+12]=p,this.uint16[S+13]=d,this.uint16[S+14]=f,this.uint16[S+15]=m,this.uint16[S+16]=g,this.uint16[S+17]=_,this.uint16[S+18]=y,this.uint16[S+19]=v,this.uint16[S+20]=x,this.uint16[S+21]=w,this.uint16[S+22]=b,this.uint32[M+12]=B,this.float32[M+13]=C,this.float32[M+14]=E,this.float32[M+15]=T,this.float32[M+16]=I,t},e}(En);jn.prototype.bytesPerElement=68,Ri("StructArrayLayout8i15ui1ul4f68",jn);var Gn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.float32[1*t+0]=e,t},e}(En);Gn.prototype.bytesPerElement=4,Ri("StructArrayLayout1f4",Gn);var Kn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,r)},e.prototype.emplace=function(t,e,r,i){var n=3*t;return this.int16[n+0]=e,this.int16[n+1]=r,this.int16[n+2]=i,t},e}(En);Kn.prototype.bytesPerElement=6,Ri("StructArrayLayout3i6",Kn);var qn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,r)},e.prototype.emplace=function(t,e,r,i){var n=4*t;return this.uint32[2*t+0]=e,this.uint16[n+2]=r,this.uint16[n+3]=i,t},e}(En);qn.prototype.bytesPerElement=8,Ri("StructArrayLayout1ul2ui8",qn);var Zn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var r=this.length;return this.resize(r+1),this.emplace(r,t,e)},e.prototype.emplace=function(t,e,r){var i=2*t;return this.uint16[i+0]=e,this.uint16[i+1]=r,t},e}(En);Zn.prototype.bytesPerElement=4,Ri("StructArrayLayout2ui4",Zn);var Wn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.uint16[1*t+0]=e,t},e}(En);Wn.prototype.bytesPerElement=2,Ri("StructArrayLayout1ui2",Wn);var Xn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,i){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,r,i)},e.prototype.emplace=function(t,e,r,i,n){var o=4*t;return this.float32[o+0]=e,this.float32[o+1]=r,this.float32[o+2]=i,this.float32[o+3]=n,t},e}(En);Xn.prototype.bytesPerElement=16,Ri("StructArrayLayout4f16",Xn);var $n=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return r.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},r.x1.get=function(){return this._structArray.int16[this._pos2+2]},r.y1.get=function(){return this._structArray.int16[this._pos2+3]},r.x2.get=function(){return this._structArray.int16[this._pos2+4]},r.y2.get=function(){return this._structArray.int16[this._pos2+5]},r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.anchorPoint.get=function(){return new n(this.anchorPointX,this.anchorPointY)},Object.defineProperties(e.prototype,r),e}(Cn);$n.prototype.size=20;var Yn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new $n(this,t)},e}(Rn);Ri("CollisionBoxArray",Yn);var Jn=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},r.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},r.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},r.segment.get=function(){return this._structArray.uint16[this._pos2+10]},r.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},r.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},r.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},r.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},r.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},r.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},r.placedOrientation.set=function(t){this._structArray.uint8[this._pos1+37]=t},r.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},r.hidden.set=function(t){this._structArray.uint8[this._pos1+38]=t},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},r.crossTileID.set=function(t){this._structArray.uint32[this._pos4+10]=t},r.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(e.prototype,r),e}(Cn);Jn.prototype.size=48;var to=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new Jn(this,t)},e}(Hn);Ri("PlacedSymbolArray",to);var eo=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},r.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},r.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},r.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},r.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},r.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},r.key.get=function(){return this._structArray.uint16[this._pos2+8]},r.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},r.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},r.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},r.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},r.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},r.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},r.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},r.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},r.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},r.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},r.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},r.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},r.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},r.crossTileID.set=function(t){this._structArray.uint32[this._pos4+12]=t},r.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},r.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},r.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},r.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(e.prototype,r),e}(Cn);eo.prototype.size=68;var ro=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new eo(this,t)},e}(jn);Ri("SymbolInstanceArray",ro);var io=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getoffsetX=function(t){return this.float32[1*t+0]},e}(Gn);Ri("GlyphOffsetArray",io);var no=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getx=function(t){return this.int16[3*t+0]},e.prototype.gety=function(t){return this.int16[3*t+1]},e.prototype.gettileUnitDistanceFromAnchor=function(t){return this.int16[3*t+2]},e}(Kn);Ri("SymbolLineVertexArray",no);var oo=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(e.prototype,r),e}(Cn);oo.prototype.size=8;var ao=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new oo(this,t)},e}(qn);Ri("FeatureIndexArray",ao);var so=Tn([{name:"a_pos",components:2,type:"Int16"}],4).members,lo=function(t){void 0===t&&(t=[]),this.segments=t};function co(t,e){return 256*(t=u(Math.floor(t),0,255))+u(Math.floor(e),0,255)}lo.prototype.prepareSegment=function(t,e,r,i){var n=this.segments[this.segments.length-1];return t>lo.MAX_VERTEX_ARRAY_LENGTH&&b("Max vertices per segment is "+lo.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!n||n.vertexLength+t>lo.MAX_VERTEX_ARRAY_LENGTH||n.sortKey!==i)&&(n={vertexOffset:e.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},void 0!==i&&(n.sortKey=i),this.segments.push(n)),n},lo.prototype.get=function(){return this.segments},lo.prototype.destroy=function(){for(var t=0,e=this.segments;t<e.length;t+=1){var r=e[t];for(var i in r.vaos)r.vaos[i].destroy()}},lo.simpleSegment=function(t,e,r,i){return new lo([{vertexOffset:t,primitiveOffset:e,vertexLength:r,primitiveLength:i,vaos:{},sortKey:0}])},lo.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ri("SegmentVector",lo);var uo=Tn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),ho=e((function(t){t.exports=function(t,e){var r,i,n,o,a,s,l,c;for(i=t.length-(r=3&t.length),n=e,a=3432918353,s=461845907,c=0;c<i;)l=255&t.charCodeAt(c)|(255&t.charCodeAt(++c))<<8|(255&t.charCodeAt(++c))<<16|(255&t.charCodeAt(++c))<<24,++c,n=27492+(65535&(o=5*(65535&(n=(n^=l=(65535&(l=(l=(65535&l)*a+(((l>>>16)*a&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<13|n>>>19))+((5*(n>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,r){case 3:l^=(255&t.charCodeAt(c+2))<<16;case 2:l^=(255&t.charCodeAt(c+1))<<8;case 1:n^=l=(65535&(l=(l=(65535&(l^=255&t.charCodeAt(c)))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295}return n^=t.length,n=2246822507*(65535&(n^=n>>>16))+((2246822507*(n>>>16)&65535)<<16)&4294967295,n=3266489909*(65535&(n^=n>>>13))+((3266489909*(n>>>16)&65535)<<16)&4294967295,(n^=n>>>16)>>>0}})),Ao=e((function(t){t.exports=function(t,e){for(var r,i=t.length,n=e^i,o=0;i>=4;)r=1540483477*(65535&(r=255&t.charCodeAt(o)|(255&t.charCodeAt(++o))<<8|(255&t.charCodeAt(++o))<<16|(255&t.charCodeAt(++o))<<24))+((1540483477*(r>>>16)&65535)<<16),n=1540483477*(65535&n)+((1540483477*(n>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),i-=4,++o;switch(i){case 3:n^=(255&t.charCodeAt(o+2))<<16;case 2:n^=(255&t.charCodeAt(o+1))<<8;case 1:n=1540483477*(65535&(n^=255&t.charCodeAt(o)))+((1540483477*(n>>>16)&65535)<<16)}return n=1540483477*(65535&(n^=n>>>13))+((1540483477*(n>>>16)&65535)<<16),(n^=n>>>15)>>>0}})),po=ho,fo=Ao;po.murmur3=ho,po.murmur2=fo;var mo=function(){this.ids=[],this.positions=[],this.indexed=!1};mo.prototype.add=function(t,e,r,i){this.ids.push(_o(t)),this.positions.push(e,r,i)},mo.prototype.getPositions=function(t){for(var e=_o(t),r=0,i=this.ids.length-1;r<i;){var n=r+i>>1;this.ids[n]>=e?i=n:r=n+1}for(var o=[];this.ids[r]===e;)o.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return o},mo.serialize=function(t,e){var r=new Float64Array(t.ids),i=new Uint32Array(t.positions);return function t(e,r,i,n){for(;i<n;){for(var o=e[i+n>>1],a=i-1,s=n+1;;){do{a++}while(e[a]<o);do{s--}while(e[s]>o);if(a>=s)break;yo(e,a,s),yo(r,3*a,3*s),yo(r,3*a+1,3*s+1),yo(r,3*a+2,3*s+2)}s-i<n-s?(t(e,r,i,s),i=s+1):(t(e,r,s+1,n),n=s)}}(r,i,0,r.length-1),e&&e.push(r.buffer,i.buffer),{ids:r,positions:i}},mo.deserialize=function(t){var e=new mo;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e};var go=Math.pow(2,53)-1;function _o(t){var e=+t;return!isNaN(e)&&e<=go?e:po(String(t))}function yo(t,e,r){var i=t[e];t[e]=t[r],t[r]=i}Ri("FeaturePositionMap",mo);var vo=function(t,e){this.gl=t.gl,this.location=e},xo=function(t){function e(e,r){t.call(this,e,r),this.current=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))},e}(vo),wo=function(t){function e(e,r){t.call(this,e,r),this.current=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))},e}(vo),bo=function(t){function e(e,r){t.call(this,e,r),this.current=[0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))},e}(vo),Bo=function(t){function e(e,r){t.call(this,e,r),this.current=[0,0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))},e}(vo),Co=function(t){function e(e,r){t.call(this,e,r),this.current=[0,0,0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))},e}(vo),Eo=function(t){function e(e,r){t.call(this,e,r),this.current=te.transparent}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))},e}(vo),To=new Float32Array(16),Io=function(t){function e(e,r){t.call(this,e,r),this.current=To}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(var e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}},e}(vo);function So(t){return[co(255*t.r,255*t.g),co(255*t.b,255*t.a)]}var Mo=function(t,e,r){this.value=t,this.uniformNames=e.map((function(t){return"u_"+t})),this.type=r};Mo.prototype.setUniform=function(t,e,r){t.set(r.constantOr(this.value))},Mo.prototype.getBinding=function(t,e,r){return"color"===this.type?new Eo(t,e):new wo(t,e)};var Fo=function(t,e){this.uniformNames=e.map((function(t){return"u_"+t})),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Fo.prototype.setConstantPatternPositions=function(t,e){this.pixelRatioFrom=e.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=e.tlbr,this.patternTo=t.tlbr},Fo.prototype.setUniform=function(t,e,r,i){var n="u_pattern_to"===i?this.patternTo:"u_pattern_from"===i?this.patternFrom:"u_pixel_ratio_to"===i?this.pixelRatioTo:"u_pixel_ratio_from"===i?this.pixelRatioFrom:null;n&&t.set(n)},Fo.prototype.getBinding=function(t,e,r){return"u_pattern"===r.substr(0,9)?new Co(t,e):new wo(t,e)};var Po=function(t,e,r,i){this.expression=t,this.type=r,this.maxValue=0,this.paintVertexAttributes=e.map((function(t){return{name:"a_"+t,type:"Float32",components:"color"===r?2:1,offset:0}})),this.paintVertexArray=new i};Po.prototype.populatePaintArray=function(t,e,r,i,n){var o=this.paintVertexArray.length,a=this.expression.evaluate(new ln(0),e,{},i,[],n);this.paintVertexArray.resize(t),this._setPaintValue(o,t,a)},Po.prototype.updatePaintArray=function(t,e,r,i){var n=this.expression.evaluate({zoom:0},r,i);this._setPaintValue(t,e,n)},Po.prototype._setPaintValue=function(t,e,r){if("color"===this.type)for(var i=So(r),n=t;n<e;n++)this.paintVertexArray.emplace(n,i[0],i[1]);else{for(var o=t;o<e;o++)this.paintVertexArray.emplace(o,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}},Po.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Po.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Lo=function(t,e,r,i,n,o){this.expression=t,this.uniformNames=e.map((function(t){return"u_"+t+"_t"})),this.type=r,this.useIntegerZoom=i,this.zoom=n,this.maxValue=0,this.paintVertexAttributes=e.map((function(t){return{name:"a_"+t,type:"Float32",components:"color"===r?4:2,offset:0}})),this.paintVertexArray=new o};Lo.prototype.populatePaintArray=function(t,e,r,i,n){var o=this.expression.evaluate(new ln(this.zoom),e,{},i,[],n),a=this.expression.evaluate(new ln(this.zoom+1),e,{},i,[],n),s=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(s,t,o,a)},Lo.prototype.updatePaintArray=function(t,e,r,i){var n=this.expression.evaluate({zoom:this.zoom},r,i),o=this.expression.evaluate({zoom:this.zoom+1},r,i);this._setPaintValue(t,e,n,o)},Lo.prototype._setPaintValue=function(t,e,r,i){if("color"===this.type)for(var n=So(r),o=So(i),a=t;a<e;a++)this.paintVertexArray.emplace(a,n[0],n[1],o[0],o[1]);else{for(var s=t;s<e;s++)this.paintVertexArray.emplace(s,r,i);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(i))}},Lo.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Lo.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Lo.prototype.setUniform=function(t,e){var r=this.useIntegerZoom?Math.floor(e.zoom):e.zoom,i=u(this.expression.interpolationFactor(r,this.zoom,this.zoom+1),0,1);t.set(i)},Lo.prototype.getBinding=function(t,e,r){return new wo(t,e)};var Do=function(t,e,r,i,n,o){this.expression=t,this.type=e,this.useIntegerZoom=r,this.zoom=i,this.layerId=o,this.zoomInPaintVertexArray=new n,this.zoomOutPaintVertexArray=new n};Do.prototype.populatePaintArray=function(t,e,r){var i=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(i,t,e.patterns&&e.patterns[this.layerId],r)},Do.prototype.updatePaintArray=function(t,e,r,i,n){this._setPaintValues(t,e,r.patterns&&r.patterns[this.layerId],n)},Do.prototype._setPaintValues=function(t,e,r,i){if(i&&r){var n=i[r.min],o=i[r.mid],a=i[r.max];if(n&&o&&a)for(var s=t;s<e;s++)this.zoomInPaintVertexArray.emplace(s,o.tl[0],o.tl[1],o.br[0],o.br[1],n.tl[0],n.tl[1],n.br[0],n.br[1],o.pixelRatio,n.pixelRatio),this.zoomOutPaintVertexArray.emplace(s,o.tl[0],o.tl[1],o.br[0],o.br[1],a.tl[0],a.tl[1],a.br[0],a.br[1],o.pixelRatio,a.pixelRatio)}},Do.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,uo.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,uo.members,this.expression.isStateDependent))},Do.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Uo=function(t,e,r){this.binders={},this._buffers=[];var i=[];for(var n in t.paint._values)if(r(n)){var o=t.paint.get(n);if(o instanceof fn&&Dr(o.property.specification)){var a=zo(n,t.type),s=o.value,l=o.property.specification.type,c=o.property.useIntegerZoom,u=o.property.specification["property-type"],h="cross-faded"===u||"cross-faded-data-driven"===u;if("constant"===s.kind)this.binders[n]=h?new Fo(s.value,a):new Mo(s.value,a,l),i.push("/u_"+n);else if("source"===s.kind||h){var A=Ro(n,l,"source");this.binders[n]=h?new Do(s,l,c,e,A,t.id):new Po(s,a,l,A),i.push("/a_"+n)}else{var p=Ro(n,l,"composite");this.binders[n]=new Lo(s,a,l,c,e,p),i.push("/z_"+n)}}}this.cacheKey=i.sort().join("")};Uo.prototype.getMaxValue=function(t){var e=this.binders[t];return e instanceof Po||e instanceof Lo?e.maxValue:0},Uo.prototype.populatePaintArrays=function(t,e,r,i,n){for(var o in this.binders){var a=this.binders[o];(a instanceof Po||a instanceof Lo||a instanceof Do)&&a.populatePaintArray(t,e,r,i,n)}},Uo.prototype.setConstantPatternPositions=function(t,e){for(var r in this.binders){var i=this.binders[r];i instanceof Fo&&i.setConstantPatternPositions(t,e)}},Uo.prototype.updatePaintArrays=function(t,e,r,i,n){var o=!1;for(var a in t)for(var s=0,l=e.getPositions(a);s<l.length;s+=1){var c=l[s],u=r.feature(c.index);for(var h in this.binders){var A=this.binders[h];if((A instanceof Po||A instanceof Lo||A instanceof Do)&&!0===A.expression.isStateDependent){var p=i.paint.get(h);A.expression=p.value,A.updatePaintArray(c.start,c.end,u,t[a],n),o=!0}}}return o},Uo.prototype.defines=function(){var t=[];for(var e in this.binders){var r=this.binders[e];(r instanceof Mo||r instanceof Fo)&&t.push.apply(t,r.uniformNames.map((function(t){return"#define HAS_UNIFORM_"+t})))}return t},Uo.prototype.getBinderAttributes=function(){var t=[];for(var e in this.binders){var r=this.binders[e];if(r instanceof Po||r instanceof Lo)for(var i=0;i<r.paintVertexAttributes.length;i++)t.push(r.paintVertexAttributes[i].name);else if(r instanceof Do)for(var n=0;n<uo.members.length;n++)t.push(uo.members[n].name)}return t},Uo.prototype.getBinderUniforms=function(){var t=[];for(var e in this.binders){var r=this.binders[e];if(r instanceof Mo||r instanceof Fo||r instanceof Lo)for(var i=0,n=r.uniformNames;i<n.length;i+=1)t.push(n[i])}return t},Uo.prototype.getPaintVertexBuffers=function(){return this._buffers},Uo.prototype.getUniforms=function(t,e){var r=[];for(var i in this.binders){var n=this.binders[i];if(n instanceof Mo||n instanceof Fo||n instanceof Lo)for(var o=0,a=n.uniformNames;o<a.length;o+=1){var s=a[o];if(e[s]){var l=n.getBinding(t,e[s],s);r.push({name:s,property:i,binding:l})}}}return r},Uo.prototype.setUniforms=function(t,e,r,i){for(var n=0,o=e;n<o.length;n+=1){var a=o[n],s=a.name,l=a.property;this.binders[l].setUniform(a.binding,i,r.get(l),s)}},Uo.prototype.updatePaintBuffers=function(t){for(var e in this._buffers=[],this.binders){var r=this.binders[e];if(t&&r instanceof Do){var i=2===t.fromScale?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer;i&&this._buffers.push(i)}else(r instanceof Po||r instanceof Lo)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}},Uo.prototype.upload=function(t){for(var e in this.binders){var r=this.binders[e];(r instanceof Po||r instanceof Lo||r instanceof Do)&&r.upload(t)}this.updatePaintBuffers()},Uo.prototype.destroy=function(){for(var t in this.binders){var e=this.binders[t];(e instanceof Po||e instanceof Lo||e instanceof Do)&&e.destroy()}};var ko=function(t,e,r){void 0===r&&(r=function(){return!0}),this.programConfigurations={};for(var i=0,n=t;i<n.length;i+=1){var o=n[i];this.programConfigurations[o.id]=new Uo(o,e,r)}this.needsUpload=!1,this._featureMap=new mo,this._bufferOffset=0};function zo(t,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(e+"-","").replace(/-/g,"_")]}function Ro(t,e,r){var i={color:{source:Ln,composite:Xn},number:{source:Gn,composite:Ln}},n=function(t){return{"line-pattern":{source:Dn,composite:Dn},"fill-pattern":{source:Dn,composite:Dn},"fill-extrusion-pattern":{source:Dn,composite:Dn}}[t]}(t);return n&&n[r]||i[e][r]}ko.prototype.populatePaintArrays=function(t,e,r,i,n,o){for(var a in this.programConfigurations)this.programConfigurations[a].populatePaintArrays(t,e,i,n,o);void 0!==e.id&&this._featureMap.add(e.id,r,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},ko.prototype.updatePaintArrays=function(t,e,r,i){for(var n=0,o=r;n<o.length;n+=1){var a=o[n];this.needsUpload=this.programConfigurations[a.id].updatePaintArrays(t,this._featureMap,e,a,i)||this.needsUpload}},ko.prototype.get=function(t){return this.programConfigurations[t]},ko.prototype.upload=function(t){if(this.needsUpload){for(var e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}},ko.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},Ri("ConstantBinder",Mo),Ri("CrossFadedConstantBinder",Fo),Ri("SourceExpressionBinder",Po),Ri("CrossFadedCompositeBinder",Do),Ri("CompositeExpressionBinder",Lo),Ri("ProgramConfiguration",Uo,{omit:["_buffers"]}),Ri("ProgramConfigurationSet",ko);var Oo=Math.pow(2,14)-1,Qo=-Oo-1;function No(t){for(var e=8192/t.extent,r=t.loadGeometry(),i=0;i<r.length;i++)for(var n=r[i],o=0;o<n.length;o++){var a=n[o],s=Math.round(a.x*e),l=Math.round(a.y*e);a.x=u(s,Qo,Oo),a.y=u(l,Qo,Oo),(s<a.x||s>a.x+1||l<a.y||l>a.y+1)&&b("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return r}function Vo(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?No(t):[]}}function Ho(t,e,r,i,n){t.emplaceBack(2*e+(i+1)/2,2*r+(n+1)/2)}var jo=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Sn,this.indexArray=new Vn,this.segments=new lo,this.programConfigurations=new ko(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};function Go(t,e){for(var r=0;r<t.length;r++)if(ta(e,t[r]))return!0;for(var i=0;i<e.length;i++)if(ta(t,e[i]))return!0;return!!Wo(t,e)}function Ko(t,e,r){return!!ta(t,e)||!!$o(e,t,r)}function qo(t,e){if(1===t.length)return Jo(e,t[0]);for(var r=0;r<e.length;r++)for(var i=e[r],n=0;n<i.length;n++)if(ta(t,i[n]))return!0;for(var o=0;o<t.length;o++)if(Jo(e,t[o]))return!0;for(var a=0;a<e.length;a++)if(Wo(t,e[a]))return!0;return!1}function Zo(t,e,r){if(t.length>1){if(Wo(t,e))return!0;for(var i=0;i<e.length;i++)if($o(e[i],t,r))return!0}for(var n=0;n<t.length;n++)if($o(t[n],e,r))return!0;return!1}function Wo(t,e){if(0===t.length||0===e.length)return!1;for(var r=0;r<t.length-1;r++)for(var i=t[r],n=t[r+1],o=0;o<e.length-1;o++)if(Xo(i,n,e[o],e[o+1]))return!0;return!1}function Xo(t,e,r,i){return B(t,r,i)!==B(e,r,i)&&B(t,e,r)!==B(t,e,i)}function $o(t,e,r){var i=r*r;if(1===e.length)return t.distSqr(e[0])<i;for(var n=1;n<e.length;n++)if(Yo(t,e[n-1],e[n])<i)return!0;return!1}function Yo(t,e,r){var i=e.distSqr(r);if(0===i)return t.distSqr(e);var n=((t.x-e.x)*(r.x-e.x)+(t.y-e.y)*(r.y-e.y))/i;return t.distSqr(n<0?e:n>1?r:r.sub(e)._mult(n)._add(e))}function Jo(t,e){for(var r,i,n,o=!1,a=0;a<t.length;a++)for(var s=0,l=(r=t[a]).length-1;s<r.length;l=s++)(i=r[s]).y>e.y!=(n=r[l]).y>e.y&&e.x<(n.x-i.x)*(e.y-i.y)/(n.y-i.y)+i.x&&(o=!o);return o}function ta(t,e){for(var r=!1,i=0,n=t.length-1;i<t.length;n=i++){var o=t[i],a=t[n];o.y>e.y!=a.y>e.y&&e.x<(a.x-o.x)*(e.y-o.y)/(a.y-o.y)+o.x&&(r=!r)}return r}function ea(t,e,r){var i=r[0],n=r[2];if(t.x<i.x&&e.x<i.x||t.x>n.x&&e.x>n.x||t.y<i.y&&e.y<i.y||t.y>n.y&&e.y>n.y)return!1;var o=B(t,e,r[0]);return o!==B(t,e,r[1])||o!==B(t,e,r[2])||o!==B(t,e,r[3])}function ra(t,e,r){var i=e.paint.get(t).value;return"constant"===i.kind?i.value:r.programConfigurations.get(e.id).getMaxValue(t)}function ia(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function na(t,e,r,i,o){if(!e[0]&&!e[1])return t;var a=n.convert(e)._mult(o);"viewport"===r&&a._rotate(-i);for(var s=[],l=0;l<t.length;l++)s.push(t[l].sub(a));return s}jo.prototype.populate=function(t,e,r){var i=this.layers[0],n=[],o=null;"circle"===i.type&&(o=i.layout.get("circle-sort-key"));for(var a=0,s=t;a<s.length;a+=1){var l=s[a],c=l.feature,u=l.id,h=l.index,A=l.sourceLayerIndex,p=this.layers[0]._featureFilter.needGeometry,d=Vo(c,p);if(this.layers[0]._featureFilter.filter(new ln(this.zoom),d,r)){var f=o?o.evaluate(d,{},r):void 0,m={id:u,properties:c.properties,type:c.type,sourceLayerIndex:A,index:h,geometry:p?d.geometry:No(c),patterns:{},sortKey:f};n.push(m)}}o&&n.sort((function(t,e){return t.sortKey-e.sortKey}));for(var g=0,_=n;g<_.length;g+=1){var y=_[g],v=y.geometry,x=y.index,w=y.sourceLayerIndex,b=t[x].feature;this.addFeature(y,v,x,r),e.featureIndex.insert(b,v,x,w,this.index)}},jo.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r)},jo.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},jo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},jo.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,so),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},jo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},jo.prototype.addFeature=function(t,e,r,i){for(var n=0,o=e;n<o.length;n+=1)for(var a=0,s=o[n];a<s.length;a+=1){var l=s[a],c=l.x,u=l.y;if(!(c<0||c>=8192||u<0||u>=8192)){var h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),A=h.vertexLength;Ho(this.layoutVertexArray,c,u,-1,-1),Ho(this.layoutVertexArray,c,u,1,-1),Ho(this.layoutVertexArray,c,u,1,1),Ho(this.layoutVertexArray,c,u,-1,1),this.indexArray.emplaceBack(A,A+1,A+2),this.indexArray.emplaceBack(A,A+3,A+2),h.vertexLength+=4,h.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,{},i)},Ri("CircleBucket",jo,{omit:["layers"]});var oa=new wn({"circle-sort-key":new _n(St.layout_circle["circle-sort-key"])}),aa={paint:new wn({"circle-radius":new _n(St.paint_circle["circle-radius"]),"circle-color":new _n(St.paint_circle["circle-color"]),"circle-blur":new _n(St.paint_circle["circle-blur"]),"circle-opacity":new _n(St.paint_circle["circle-opacity"]),"circle-translate":new gn(St.paint_circle["circle-translate"]),"circle-translate-anchor":new gn(St.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new gn(St.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new gn(St.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new _n(St.paint_circle["circle-stroke-width"]),"circle-stroke-color":new _n(St.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new _n(St.paint_circle["circle-stroke-opacity"])}),layout:oa},sa="undefined"!=typeof Float32Array?Float32Array:Array;function la(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ca(t,e,r){var i=e[0],n=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=e[6],u=e[7],h=e[8],A=e[9],p=e[10],d=e[11],f=e[12],m=e[13],g=e[14],_=e[15],y=r[0],v=r[1],x=r[2],w=r[3];return t[0]=y*i+v*s+x*h+w*f,t[1]=y*n+v*l+x*A+w*m,t[2]=y*o+v*c+x*p+w*g,t[3]=y*a+v*u+x*d+w*_,t[4]=(y=r[4])*i+(v=r[5])*s+(x=r[6])*h+(w=r[7])*f,t[5]=y*n+v*l+x*A+w*m,t[6]=y*o+v*c+x*p+w*g,t[7]=y*a+v*u+x*d+w*_,t[8]=(y=r[8])*i+(v=r[9])*s+(x=r[10])*h+(w=r[11])*f,t[9]=y*n+v*l+x*A+w*m,t[10]=y*o+v*c+x*p+w*g,t[11]=y*a+v*u+x*d+w*_,t[12]=(y=r[12])*i+(v=r[13])*s+(x=r[14])*h+(w=r[15])*f,t[13]=y*n+v*l+x*A+w*m,t[14]=y*o+v*c+x*p+w*g,t[15]=y*a+v*u+x*d+w*_,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,e=0,r=arguments.length;r--;)e+=t[r]*t[r];return Math.sqrt(e)});var ua,ha,Aa=ca;function pa(t,e,r){var i=e[0],n=e[1],o=e[2],a=e[3];return t[0]=r[0]*i+r[4]*n+r[8]*o+r[12]*a,t[1]=r[1]*i+r[5]*n+r[9]*o+r[13]*a,t[2]=r[2]*i+r[6]*n+r[10]*o+r[14]*a,t[3]=r[3]*i+r[7]*n+r[11]*o+r[15]*a,t}ua=new sa(3),sa!=Float32Array&&(ua[0]=0,ua[1]=0,ua[2]=0),ha=new sa(4),sa!=Float32Array&&(ha[0]=0,ha[1]=0,ha[2]=0,ha[3]=0);var da=(function(){var t=new sa(2);sa!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function e(e){t.call(this,e,aa)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new jo(t)},e.prototype.queryRadius=function(t){var e=t;return ra("circle-radius",this,e)+ra("circle-stroke-width",this,e)+ia(this.paint.get("circle-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,i,n,o,a,s){for(var l=na(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,a),c=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r),u="map"===this.paint.get("circle-pitch-alignment"),h=u?l:function(t,e){return t.map((function(t){return fa(t,e)}))}(l,s),A=u?c*a:c,p=0,d=i;p<d.length;p+=1)for(var f=0,m=d[p];f<m.length;f+=1){var g=m[f],_=u?g:fa(g,s),y=A,v=pa([],[g.x,g.y,0,1],s);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?y*=v[3]/o.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(y*=o.cameraToCenterDistance/v[3]),Ko(h,_,y))return!0}return!1},e}(bn));function fa(t,e){var r=pa([],[t.x,t.y,0,1],e);return new n(r[0]/r[3],r[1]/r[3])}var ma=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(jo);function ga(t,e,r,i){var n=e.width,o=e.height;if(i){if(i instanceof Uint8ClampedArray)i=new Uint8Array(i.buffer);else if(i.length!==n*o*r)throw new RangeError("mismatched image size")}else i=new Uint8Array(n*o*r);return t.width=n,t.height=o,t.data=i,t}function _a(t,e,r){var i=e.width,n=e.height;if(i!==t.width||n!==t.height){var o=ga({},{width:i,height:n},r);ya(t,o,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,i),height:Math.min(t.height,n)},r),t.width=i,t.height=n,t.data=o.data}}function ya(t,e,r,i,n,o){if(0===n.width||0===n.height)return e;if(n.width>t.width||n.height>t.height||r.x>t.width-n.width||r.y>t.height-n.height)throw new RangeError("out of range source coordinates for image copy");if(n.width>e.width||n.height>e.height||i.x>e.width-n.width||i.y>e.height-n.height)throw new RangeError("out of range destination coordinates for image copy");for(var a=t.data,s=e.data,l=0;l<n.height;l++)for(var c=((r.y+l)*t.width+r.x)*o,u=((i.y+l)*e.width+i.x)*o,h=0;h<n.width*o;h++)s[u+h]=a[c+h];return e}Ri("HeatmapBucket",ma,{omit:["layers"]});var va=function(t,e){ga(this,t,1,e)};va.prototype.resize=function(t){_a(this,t,1)},va.prototype.clone=function(){return new va({width:this.width,height:this.height},new Uint8Array(this.data))},va.copy=function(t,e,r,i,n){ya(t,e,r,i,n,1)};var xa=function(t,e){ga(this,t,4,e)};xa.prototype.resize=function(t){_a(this,t,4)},xa.prototype.replace=function(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},xa.prototype.clone=function(){return new xa({width:this.width,height:this.height},new Uint8Array(this.data))},xa.copy=function(t,e,r,i,n){ya(t,e,r,i,n,4)},Ri("AlphaImage",va),Ri("RGBAImage",xa);var wa={paint:new wn({"heatmap-radius":new _n(St.paint_heatmap["heatmap-radius"]),"heatmap-weight":new _n(St.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new gn(St.paint_heatmap["heatmap-intensity"]),"heatmap-color":new xn(St.paint_heatmap["heatmap-color"]),"heatmap-opacity":new gn(St.paint_heatmap["heatmap-opacity"])})};function ba(t){var e={},r=t.resolution||256,i=t.clips?t.clips.length:1,n=t.image||new xa({width:r,height:i}),o=function(r,i,o){e[t.evaluationKey]=o;var a=t.expression.evaluate(e);n.data[r+i+0]=Math.floor(255*a.r/a.a),n.data[r+i+1]=Math.floor(255*a.g/a.a),n.data[r+i+2]=Math.floor(255*a.b/a.a),n.data[r+i+3]=Math.floor(255*a.a)};if(t.clips)for(var a=0,s=0;a<i;++a,s+=4*r)for(var l=0,c=0;l<r;l++,c+=4){var u=l/(r-1),h=t.clips[a];o(s,c,h.start*(1-u)+h.end*u)}else for(var A=0,p=0;A<r;A++,p+=4)o(0,p,A/(r-1));return n}var Ba=function(t){function e(e){t.call(this,e,wa),this._updateColorRamp()}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new ma(t)},e.prototype._handleSpecialPaintPropertyUpdate=function(t){"heatmap-color"===t&&this._updateColorRamp()},e.prototype._updateColorRamp=function(){this.colorRamp=ba({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},e.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility},e}(bn),Ca={paint:new wn({"hillshade-illumination-direction":new gn(St.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new gn(St.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new gn(St.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new gn(St.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new gn(St.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new gn(St.paint_hillshade["hillshade-accent-color"])})},Ea=function(t){function e(e){t.call(this,e,Ca)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility},e}(bn),Ta=Tn([{name:"a_pos",components:2,type:"Int16"}],4).members,Ia=Ma,Sa=Ma;function Ma(t,e,r){r=r||2;var i,n,o,a,s,l,c,u=e&&e.length,h=u?e[0]*r:t.length,A=Fa(t,0,h,r,!0),p=[];if(!A||A.next===A.prev)return p;if(u&&(A=function(t,e,r,i){var n,o,a,s=[];for(n=0,o=e.length;n<o;n++)(a=Fa(t,e[n]*i,n<o-1?e[n+1]*i:t.length,i,!1))===a.next&&(a.steiner=!0),s.push(Va(a));for(s.sort(Ra),n=0;n<s.length;n++)Oa(s[n],r),r=Pa(r,r.next);return r}(t,e,A,r)),t.length>80*r){i=o=t[0],n=a=t[1];for(var d=r;d<h;d+=r)(s=t[d])<i&&(i=s),(l=t[d+1])<n&&(n=l),s>o&&(o=s),l>a&&(a=l);c=0!==(c=Math.max(o-i,a-n))?1/c:0}return La(A,p,r,i,n,c),p}function Fa(t,e,r,i,n){var o,a;if(n===es(t,e,r,i)>0)for(o=e;o<r;o+=i)a=Ya(o,t[o],t[o+1],a);else for(o=r-i;o>=e;o-=i)a=Ya(o,t[o],t[o+1],a);return a&&Ka(a,a.next)&&(Ja(a),a=a.next),a}function Pa(t,e){if(!t)return t;e||(e=t);var r,i=t;do{if(r=!1,i.steiner||!Ka(i,i.next)&&0!==Ga(i.prev,i,i.next))i=i.next;else{if(Ja(i),(i=e=i.prev)===i.next)break;r=!0}}while(r||i!==e);return e}function La(t,e,r,i,n,o,a){if(t){!a&&o&&function(t,e,r,i){var n=t;do{null===n.z&&(n.z=Na(n.x,n.y,e,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e,r,i,n,o,a,s,l,c=1;do{for(r=t,t=null,o=null,a=0;r;){for(a++,i=r,s=0,e=0;e<c&&(s++,i=i.nextZ);e++);for(l=c;s>0||l>0&&i;)0!==s&&(0===l||!i||r.z<=i.z)?(n=r,r=r.nextZ,s--):(n=i,i=i.nextZ,l--),o?o.nextZ=n:t=n,n.prevZ=o,o=n;r=i}o.nextZ=null,c*=2}while(a>1)}(n)}(t,i,n,o);for(var s,l,c=t;t.prev!==t.next;)if(s=t.prev,l=t.next,o?Ua(t,i,n,o):Da(t))e.push(s.i/r),e.push(t.i/r),e.push(l.i/r),Ja(t),t=l.next,c=l.next;else if((t=l)===c){a?1===a?La(t=ka(Pa(t),e,r),e,r,i,n,o,2):2===a&&za(t,e,r,i,n,o):La(Pa(t),e,r,i,n,o,1);break}}}function Da(t){var e=t.prev,r=t,i=t.next;if(Ga(e,r,i)>=0)return!1;for(var n=t.next.next;n!==t.prev;){if(Ha(e.x,e.y,r.x,r.y,i.x,i.y,n.x,n.y)&&Ga(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function Ua(t,e,r,i){var n=t.prev,o=t,a=t.next;if(Ga(n,o,a)>=0)return!1;for(var s=n.x>o.x?n.x>a.x?n.x:a.x:o.x>a.x?o.x:a.x,l=n.y>o.y?n.y>a.y?n.y:a.y:o.y>a.y?o.y:a.y,c=Na(n.x<o.x?n.x<a.x?n.x:a.x:o.x<a.x?o.x:a.x,n.y<o.y?n.y<a.y?n.y:a.y:o.y<a.y?o.y:a.y,e,r,i),u=Na(s,l,e,r,i),h=t.prevZ,A=t.nextZ;h&&h.z>=c&&A&&A.z<=u;){if(h!==t.prev&&h!==t.next&&Ha(n.x,n.y,o.x,o.y,a.x,a.y,h.x,h.y)&&Ga(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,A!==t.prev&&A!==t.next&&Ha(n.x,n.y,o.x,o.y,a.x,a.y,A.x,A.y)&&Ga(A.prev,A,A.next)>=0)return!1;A=A.nextZ}for(;h&&h.z>=c;){if(h!==t.prev&&h!==t.next&&Ha(n.x,n.y,o.x,o.y,a.x,a.y,h.x,h.y)&&Ga(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;A&&A.z<=u;){if(A!==t.prev&&A!==t.next&&Ha(n.x,n.y,o.x,o.y,a.x,a.y,A.x,A.y)&&Ga(A.prev,A,A.next)>=0)return!1;A=A.nextZ}return!0}function ka(t,e,r){var i=t;do{var n=i.prev,o=i.next.next;!Ka(n,o)&&qa(n,i,i.next,o)&&Xa(n,o)&&Xa(o,n)&&(e.push(n.i/r),e.push(i.i/r),e.push(o.i/r),Ja(i),Ja(i.next),i=t=o),i=i.next}while(i!==t);return Pa(i)}function za(t,e,r,i,n,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&ja(a,s)){var l=$a(a,s);return a=Pa(a,a.next),l=Pa(l,l.next),La(a,e,r,i,n,o),void La(l,e,r,i,n,o)}s=s.next}a=a.next}while(a!==t)}function Ra(t,e){return t.x-e.x}function Oa(t,e){if(e=function(t,e){var r,i=e,n=t.x,o=t.y,a=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var s=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=n&&s>a){if(a=s,s===n){if(o===i.y)return i;if(o===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!r)return null;if(n===a)return r;var l,c=r,u=r.x,h=r.y,A=1/0;i=r;do{n>=i.x&&i.x>=u&&n!==i.x&&Ha(o<h?n:a,o,u,h,o<h?a:n,o,i.x,i.y)&&(l=Math.abs(o-i.y)/(n-i.x),Xa(i,t)&&(l<A||l===A&&(i.x>r.x||i.x===r.x&&Qa(r,i)))&&(r=i,A=l)),i=i.next}while(i!==c);return r}(t,e)){var r=$a(e,t);Pa(e,e.next),Pa(r,r.next)}}function Qa(t,e){return Ga(t.prev,t,e.prev)<0&&Ga(e.next,t,t.next)<0}function Na(t,e,r,i,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Va(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function Ha(t,e,r,i,n,o,a,s){return(n-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(i-s)-(r-a)*(e-s)>=0&&(r-a)*(o-s)-(n-a)*(i-s)>=0}function ja(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&qa(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(Xa(t,e)&&Xa(e,t)&&function(t,e){var r=t,i=!1,n=(t.x+e.x)/2,o=(t.y+e.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&n<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==t);return i}(t,e)&&(Ga(t.prev,t,e.prev)||Ga(t,e.prev,e))||Ka(t,e)&&Ga(t.prev,t,t.next)>0&&Ga(e.prev,e,e.next)>0)}function Ga(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Ka(t,e){return t.x===e.x&&t.y===e.y}function qa(t,e,r,i){var n=Wa(Ga(t,e,r)),o=Wa(Ga(t,e,i)),a=Wa(Ga(r,i,t)),s=Wa(Ga(r,i,e));return n!==o&&a!==s||!(0!==n||!Za(t,r,e))||!(0!==o||!Za(t,i,e))||!(0!==a||!Za(r,t,i))||!(0!==s||!Za(r,e,i))}function Za(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Wa(t){return t>0?1:t<0?-1:0}function Xa(t,e){return Ga(t.prev,t,t.next)<0?Ga(t,e,t.next)>=0&&Ga(t,t.prev,e)>=0:Ga(t,e,t.prev)<0||Ga(t,t.next,e)<0}function $a(t,e){var r=new ts(t.i,t.x,t.y),i=new ts(e.i,e.x,e.y),n=t.next,o=e.prev;return t.next=e,e.prev=t,r.next=n,n.prev=r,i.next=r,r.prev=i,o.next=i,i.prev=o,i}function Ya(t,e,r,i){var n=new ts(t,e,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function Ja(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function ts(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function es(t,e,r,i){for(var n=0,o=e,a=r-i;o<r;o+=i)n+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return n}function rs(t,e,r,i,n){!function t(e,r,i,n,o){for(;n>i;){if(n-i>600){var a=n-i+1,s=r-i+1,l=Math.log(a),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(a-c)/a)*(s-a/2<0?-1:1);t(e,r,Math.max(i,Math.floor(r-s*c/a+u)),Math.min(n,Math.floor(r+(a-s)*c/a+u)),o)}var h=e[r],A=i,p=n;for(is(e,i,r),o(e[n],h)>0&&is(e,i,n);A<p;){for(is(e,A,p),A++,p--;o(e[A],h)<0;)A++;for(;o(e[p],h)>0;)p--}0===o(e[i],h)?is(e,i,p):is(e,++p,n),p<=r&&(i=p+1),r<=p&&(n=p-1)}}(t,e,r||0,i||t.length-1,n||ns)}function is(t,e,r){var i=t[e];t[e]=t[r],t[r]=i}function ns(t,e){return t<e?-1:t>e?1:0}function os(t,e){var r=t.length;if(r<=1)return[t];for(var i,n,o=[],a=0;a<r;a++){var s=C(t[a]);0!==s&&(t[a].area=Math.abs(s),void 0===n&&(n=s<0),n===s<0?(i&&o.push(i),i=[t[a]]):i.push(t[a]))}if(i&&o.push(i),e>1)for(var l=0;l<o.length;l++)o[l].length<=e||(rs(o[l],e,1,o[l].length-1,as),o[l]=o[l].slice(0,e));return o}function as(t,e){return e.area-t.area}function ss(t,e,r){for(var i=r.patternDependencies,n=!1,o=0,a=e;o<a.length;o+=1){var s=a[o].paint.get(t+"-pattern");s.isConstant()||(n=!0);var l=s.constantOr(null);l&&(n=!0,i[l.to]=!0,i[l.from]=!0)}return n}function ls(t,e,r,i,n){for(var o=n.patternDependencies,a=0,s=e;a<s.length;a+=1){var l=s[a],c=l.paint.get(t+"-pattern").value;if("constant"!==c.kind){var u=c.evaluate({zoom:i-1},r,{},n.availableImages),h=c.evaluate({zoom:i},r,{},n.availableImages),A=c.evaluate({zoom:i+1},r,{},n.availableImages);h=h&&h.name?h.name:h,A=A&&A.name?A.name:A,o[u=u&&u.name?u.name:u]=!0,o[h]=!0,o[A]=!0,r.patterns[l.id]={min:u,mid:h,max:A}}}return r}Ma.deviation=function(t,e,r,i){var n=e&&e.length,o=Math.abs(es(t,0,n?e[0]*r:t.length,r));if(n)for(var a=0,s=e.length;a<s;a++)o-=Math.abs(es(t,e[a]*r,a<s-1?e[a+1]*r:t.length,r));var l=0;for(a=0;a<i.length;a+=3){var c=i[a]*r,u=i[a+1]*r,h=i[a+2]*r;l+=Math.abs((t[c]-t[h])*(t[u+1]-t[c+1])-(t[c]-t[u])*(t[h+1]-t[c+1]))}return 0===o&&0===l?0:Math.abs((l-o)/o)},Ma.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},i=0,n=0;n<t.length;n++){for(var o=0;o<t[n].length;o++)for(var a=0;a<e;a++)r.vertices.push(t[n][o][a]);n>0&&r.holes.push(i+=t[n-1].length)}return r},Ia.default=Sa;var cs=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Sn,this.indexArray=new Vn,this.indexArray2=new Zn,this.programConfigurations=new ko(t.layers,t.zoom),this.segments=new lo,this.segments2=new lo,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};cs.prototype.populate=function(t,e,r){this.hasPattern=ss("fill",this.layers,e);for(var i=this.layers[0].layout.get("fill-sort-key"),n=[],o=0,a=t;o<a.length;o+=1){var s=a[o],l=s.feature,c=s.id,u=s.index,h=s.sourceLayerIndex,A=this.layers[0]._featureFilter.needGeometry,p=Vo(l,A);if(this.layers[0]._featureFilter.filter(new ln(this.zoom),p,r)){var d=i?i.evaluate(p,{},r,e.availableImages):void 0,f={id:c,properties:l.properties,type:l.type,sourceLayerIndex:h,index:u,geometry:A?p.geometry:No(l),patterns:{},sortKey:d};n.push(f)}}i&&n.sort((function(t,e){return t.sortKey-e.sortKey}));for(var m=0,g=n;m<g.length;m+=1){var _=g[m],y=_.geometry,v=_.index,x=_.sourceLayerIndex;if(this.hasPattern){var w=ls("fill",this.layers,_,this.zoom,e);this.patternFeatures.push(w)}else this.addFeature(_,y,v,r,{});e.featureIndex.insert(t[v].feature,y,v,x,this.index)}},cs.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r)},cs.prototype.addFeatures=function(t,e,r){for(var i=0,n=this.patternFeatures;i<n.length;i+=1){var o=n[i];this.addFeature(o,o.geometry,o.index,e,r)}},cs.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},cs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},cs.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ta),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},cs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},cs.prototype.addFeature=function(t,e,r,i,n){for(var o=0,a=os(e,500);o<a.length;o+=1){for(var s=a[o],l=0,c=0,u=s;c<u.length;c+=1)l+=u[c].length;for(var h=this.segments.prepareSegment(l,this.layoutVertexArray,this.indexArray),A=h.vertexLength,p=[],d=[],f=0,m=s;f<m.length;f+=1){var g=m[f];if(0!==g.length){g!==s[0]&&d.push(p.length/2);var _=this.segments2.prepareSegment(g.length,this.layoutVertexArray,this.indexArray2),y=_.vertexLength;this.layoutVertexArray.emplaceBack(g[0].x,g[0].y),this.indexArray2.emplaceBack(y+g.length-1,y),p.push(g[0].x),p.push(g[0].y);for(var v=1;v<g.length;v++)this.layoutVertexArray.emplaceBack(g[v].x,g[v].y),this.indexArray2.emplaceBack(y+v-1,y+v),p.push(g[v].x),p.push(g[v].y);_.vertexLength+=g.length,_.primitiveLength+=g.length}}for(var x=Ia(p,d),w=0;w<x.length;w+=3)this.indexArray.emplaceBack(A+x[w],A+x[w+1],A+x[w+2]);h.vertexLength+=l,h.primitiveLength+=x.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,n,i)},Ri("FillBucket",cs,{omit:["layers","patternFeatures"]});var us=new wn({"fill-sort-key":new _n(St.layout_fill["fill-sort-key"])}),hs={paint:new wn({"fill-antialias":new gn(St.paint_fill["fill-antialias"]),"fill-opacity":new _n(St.paint_fill["fill-opacity"]),"fill-color":new _n(St.paint_fill["fill-color"]),"fill-outline-color":new _n(St.paint_fill["fill-outline-color"]),"fill-translate":new gn(St.paint_fill["fill-translate"]),"fill-translate-anchor":new gn(St.paint_fill["fill-translate-anchor"]),"fill-pattern":new yn(St.paint_fill["fill-pattern"])}),layout:us},As=function(t){function e(e){t.call(this,e,hs)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.recalculate=function(e,r){t.prototype.recalculate.call(this,e,r);var i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},e.prototype.createBucket=function(t){return new cs(t)},e.prototype.queryRadius=function(){return ia(this.paint.get("fill-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,i,n,o,a){return qo(na(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,a),i)},e.prototype.isTileClipped=function(){return!0},e}(bn),ps=Tn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,ds=fs;function fs(t,e,r,i,n){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=i,this._values=n,t.readFields(ms,this,e)}function ms(t,e,r){1==t?e.id=r.readVarint():2==t?function(t,e){for(var r=t.readVarint()+t.pos;t.pos<r;){var i=e._keys[t.readVarint()],n=e._values[t.readVarint()];e.properties[i]=n}}(r,e):3==t?e.type=r.readVarint():4==t&&(e._geometry=r.pos)}function gs(t){for(var e,r,i=0,n=0,o=t.length,a=o-1;n<o;a=n++)i+=((r=t[a]).x-(e=t[n]).x)*(e.y+r.y);return i}fs.types=["Unknown","Point","LineString","Polygon"],fs.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,i=1,o=0,a=0,s=0,l=[];t.pos<r;){if(o<=0){var c=t.readVarint();i=7&c,o=c>>3}if(o--,1===i||2===i)a+=t.readSVarint(),s+=t.readSVarint(),1===i&&(e&&l.push(e),e=[]),e.push(new n(a,s));else{if(7!==i)throw new Error("unknown command "+i);e&&e.push(e[0].clone())}}return e&&l.push(e),l},fs.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,i=0,n=0,o=0,a=1/0,s=-1/0,l=1/0,c=-1/0;t.pos<e;){if(i<=0){var u=t.readVarint();r=7&u,i=u>>3}if(i--,1===r||2===r)(n+=t.readSVarint())<a&&(a=n),n>s&&(s=n),(o+=t.readSVarint())<l&&(l=o),o>c&&(c=o);else if(7!==r)throw new Error("unknown command "+r)}return[a,l,s,c]},fs.prototype.toGeoJSON=function(t,e,r){var i,n,o=this.extent*Math.pow(2,r),a=this.extent*t,s=this.extent*e,l=this.loadGeometry(),c=fs.types[this.type];function u(t){for(var e=0;e<t.length;e++){var r=t[e];t[e]=[360*(r.x+a)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(r.y+s)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(i=0;i<l.length;i++)h[i]=l[i][0];u(l=h);break;case 2:for(i=0;i<l.length;i++)u(l[i]);break;case 3:for(l=function(t){var e=t.length;if(e<=1)return[t];for(var r,i,n=[],o=0;o<e;o++){var a=gs(t[o]);0!==a&&(void 0===i&&(i=a<0),i===a<0?(r&&n.push(r),r=[t[o]]):r.push(t[o]))}return r&&n.push(r),n}(l),i=0;i<l.length;i++)for(n=0;n<l[i].length;n++)u(l[i][n])}1===l.length?l=l[0]:c="Multi"+c;var A={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(A.id=this.id),A};var _s=ys;function ys(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(vs,this,e),this.length=this._features.length}function vs(t,e,r){15===t?e.version=r.readVarint():1===t?e.name=r.readString():5===t?e.extent=r.readVarint():2===t?e._features.push(r.pos):3===t?e._keys.push(r.readString()):4===t&&e._values.push(function(t){for(var e=null,r=t.readVarint()+t.pos;t.pos<r;){var i=t.readVarint()>>3;e=1===i?t.readString():2===i?t.readFloat():3===i?t.readDouble():4===i?t.readVarint64():5===i?t.readVarint():6===i?t.readSVarint():7===i?t.readBoolean():null}return e}(r))}function xs(t,e,r){if(3===t){var i=new _s(r,r.readVarint()+r.pos);i.length&&(e[i.name]=i)}}ys.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new ds(this._pbf,e,this.extent,this._keys,this._values)};var ws={VectorTile:function(t,e){this.layers=t.readFields(xs,{},e)},VectorTileFeature:ds,VectorTileLayer:_s},bs=ws.VectorTileFeature.types,Bs=Math.pow(2,13);function Cs(t,e,r,i,n,o,a,s){t.emplaceBack(e,r,2*Math.floor(i*Bs)+a,n*Bs*2,o*Bs*2,Math.round(s))}var Es=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Fn,this.indexArray=new Vn,this.programConfigurations=new ko(t.layers,t.zoom),this.segments=new lo,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};function Ts(t,e){return t.x===e.x&&(t.x<0||t.x>8192)||t.y===e.y&&(t.y<0||t.y>8192)}Es.prototype.populate=function(t,e,r){this.features=[],this.hasPattern=ss("fill-extrusion",this.layers,e);for(var i=0,n=t;i<n.length;i+=1){var o=n[i],a=o.feature,s=o.id,l=o.index,c=o.sourceLayerIndex,u=this.layers[0]._featureFilter.needGeometry,h=Vo(a,u);if(this.layers[0]._featureFilter.filter(new ln(this.zoom),h,r)){var A={id:s,sourceLayerIndex:c,index:l,geometry:u?h.geometry:No(a),properties:a.properties,type:a.type,patterns:{}};this.hasPattern?this.features.push(ls("fill-extrusion",this.layers,A,this.zoom,e)):this.addFeature(A,A.geometry,l,r,{}),e.featureIndex.insert(a,A.geometry,l,c,this.index,!0)}}},Es.prototype.addFeatures=function(t,e,r){for(var i=0,n=this.features;i<n.length;i+=1){var o=n[i];this.addFeature(o,o.geometry,o.index,e,r)}},Es.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r)},Es.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Es.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Es.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ps),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Es.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Es.prototype.addFeature=function(t,e,r,i,n){for(var o=0,a=os(e,500);o<a.length;o+=1){for(var s=a[o],l=0,c=0,u=s;c<u.length;c+=1)l+=u[c].length;for(var h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),A=0,p=s;A<p.length;A+=1){var d=p[A];if(0!==d.length&&!((P=d).every((function(t){return t.x<0}))||P.every((function(t){return t.x>8192}))||P.every((function(t){return t.y<0}))||P.every((function(t){return t.y>8192}))))for(var f=0,m=0;m<d.length;m++){var g=d[m];if(m>=1){var _=d[m-1];if(!Ts(g,_)){h.vertexLength+4>lo.MAX_VERTEX_ARRAY_LENGTH&&(h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var y=g.sub(_)._perp()._unit(),v=_.dist(g);f+v>32768&&(f=0),Cs(this.layoutVertexArray,g.x,g.y,y.x,y.y,0,0,f),Cs(this.layoutVertexArray,g.x,g.y,y.x,y.y,0,1,f),Cs(this.layoutVertexArray,_.x,_.y,y.x,y.y,0,0,f+=v),Cs(this.layoutVertexArray,_.x,_.y,y.x,y.y,0,1,f);var x=h.vertexLength;this.indexArray.emplaceBack(x,x+2,x+1),this.indexArray.emplaceBack(x+1,x+2,x+3),h.vertexLength+=4,h.primitiveLength+=2}}}}if(h.vertexLength+l>lo.MAX_VERTEX_ARRAY_LENGTH&&(h=this.segments.prepareSegment(l,this.layoutVertexArray,this.indexArray)),"Polygon"===bs[t.type]){for(var w=[],b=[],B=h.vertexLength,C=0,E=s;C<E.length;C+=1){var T=E[C];if(0!==T.length){T!==s[0]&&b.push(w.length/2);for(var I=0;I<T.length;I++){var S=T[I];Cs(this.layoutVertexArray,S.x,S.y,0,0,1,1,0),w.push(S.x),w.push(S.y)}}}for(var M=Ia(w,b),F=0;F<M.length;F+=3)this.indexArray.emplaceBack(B+M[F],B+M[F+2],B+M[F+1]);h.primitiveLength+=M.length/3,h.vertexLength+=l}}var P;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,n,i)},Ri("FillExtrusionBucket",Es,{omit:["layers","features"]});var Is={paint:new wn({"fill-extrusion-opacity":new gn(St["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new _n(St["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new gn(St["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new gn(St["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new yn(St["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new _n(St["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new _n(St["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new gn(St["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Ss=function(t){function e(e){t.call(this,e,Is)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new Es(t)},e.prototype.queryRadius=function(){return ia(this.paint.get("fill-extrusion-translate"))},e.prototype.is3D=function(){return!0},e.prototype.queryIntersectsFeature=function(t,e,r,i,o,a,s,l){var c=na(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),a.angle,s),u=this.paint.get("fill-extrusion-height").evaluate(e,r),h=this.paint.get("fill-extrusion-base").evaluate(e,r),A=function(t,e){for(var r=[],i=0,o=t;i<o.length;i+=1){var a=o[i],s=[a.x,a.y,0,1];pa(s,s,e),r.push(new n(s[0]/s[3],s[1]/s[3]))}return r}(c,l),p=function(t,e,r,i){for(var o=[],a=[],s=i[8]*e,l=i[9]*e,c=i[10]*e,u=i[11]*e,h=i[8]*r,A=i[9]*r,p=i[10]*r,d=i[11]*r,f=0,m=t;f<m.length;f+=1){for(var g=[],_=[],y=0,v=m[f];y<v.length;y+=1){var x=v[y],w=x.x,b=x.y,B=i[0]*w+i[4]*b+i[12],C=i[1]*w+i[5]*b+i[13],E=i[2]*w+i[6]*b+i[14],T=i[3]*w+i[7]*b+i[15],I=E+c,S=T+u,M=B+h,F=C+A,P=E+p,L=T+d,D=new n((B+s)/S,(C+l)/S);D.z=I/S,g.push(D);var U=new n(M/L,F/L);U.z=P/L,_.push(U)}o.push(g),a.push(_)}return[o,a]}(i,h,u,l);return function(t,e,r){var i=1/0;qo(r,e)&&(i=Fs(r,e[0]));for(var n=0;n<e.length;n++)for(var o=e[n],a=t[n],s=0;s<o.length-1;s++){var l=o[s],c=[l,o[s+1],a[s+1],a[s],l];Go(r,c)&&(i=Math.min(i,Fs(r,c)))}return i!==1/0&&i}(p[0],p[1],A)},e}(bn);function Ms(t,e){return t.x*e.x+t.y*e.y}function Fs(t,e){if(1===t.length){for(var r,i=0,n=e[i++];!r||n.equals(r);)if(!(r=e[i++]))return 1/0;for(;i<e.length;i++){var o=e[i],a=t[0],s=r.sub(n),l=o.sub(n),c=a.sub(n),u=Ms(s,s),h=Ms(s,l),A=Ms(l,l),p=Ms(c,s),d=Ms(c,l),f=u*A-h*h,m=(A*p-h*d)/f,g=(u*d-h*p)/f,_=n.z*(1-m-g)+r.z*m+o.z*g;if(isFinite(_))return _}return 1/0}for(var y=1/0,v=0,x=e;v<x.length;v+=1)y=Math.min(y,x[v].z);return y}var Ps=Tn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Ls=Tn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Ds=ws.VectorTileFeature.types,Us=Math.cos(Math.PI/180*37.5),ks=Math.pow(2,14)/.5,zs=function(t){var e=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((function(t){e.gradients[t.id]={}})),this.layoutVertexArray=new Pn,this.layoutVertexArray2=new Ln,this.indexArray=new Vn,this.programConfigurations=new ko(t.layers,t.zoom),this.segments=new lo,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};zs.prototype.populate=function(t,e,r){this.hasPattern=ss("line",this.layers,e);for(var i=this.layers[0].layout.get("line-sort-key"),n=[],o=0,a=t;o<a.length;o+=1){var s=a[o],l=s.feature,c=s.id,u=s.index,h=s.sourceLayerIndex,A=this.layers[0]._featureFilter.needGeometry,p=Vo(l,A);if(this.layers[0]._featureFilter.filter(new ln(this.zoom),p,r)){var d=i?i.evaluate(p,{},r):void 0,f={id:c,properties:l.properties,type:l.type,sourceLayerIndex:h,index:u,geometry:A?p.geometry:No(l),patterns:{},sortKey:d};n.push(f)}}i&&n.sort((function(t,e){return t.sortKey-e.sortKey}));for(var m=0,g=n;m<g.length;m+=1){var _=g[m],y=_.geometry,v=_.index,x=_.sourceLayerIndex;if(this.hasPattern){var w=ls("line",this.layers,_,this.zoom,e);this.patternFeatures.push(w)}else this.addFeature(_,y,v,r,{});e.featureIndex.insert(t[v].feature,y,v,x,this.index)}},zs.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r)},zs.prototype.addFeatures=function(t,e,r){for(var i=0,n=this.patternFeatures;i<n.length;i+=1){var o=n[i];this.addFeature(o,o.geometry,o.index,e,r)}},zs.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},zs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},zs.prototype.upload=function(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Ls)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ps),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},zs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},zs.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},zs.prototype.addFeature=function(t,e,r,i,n){var o=this.layers[0].layout,a=o.get("line-join").evaluate(t,{}),s=o.get("line-cap"),l=o.get("line-miter-limit"),c=o.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var u=0,h=e;u<h.length;u+=1)this.addLine(h[u],t,a,s,l,c);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,n,i)},zs.prototype.addLine=function(t,e,r,i,n,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var a=0;a<t.length-1;a++)this.totalDistance+=t[a].dist(t[a+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var s="Polygon"===Ds[e.type],l=t.length;l>=2&&t[l-1].equals(t[l-2]);)l--;for(var c=0;c<l-1&&t[c].equals(t[c+1]);)c++;if(!(l<(s?3:2))){"bevel"===r&&(n=1.05);var u,h=this.overscaling<=16?122880/(512*this.overscaling):0,A=this.segments.prepareSegment(10*l,this.layoutVertexArray,this.indexArray),p=void 0,d=void 0,f=void 0,m=void 0;this.e1=this.e2=-1,s&&(m=t[c].sub(u=t[l-2])._unit()._perp());for(var g=c;g<l;g++)if(!(d=g===l-1?s?t[c+1]:void 0:t[g+1])||!t[g].equals(d)){m&&(f=m),u&&(p=u),u=t[g],m=d?d.sub(u)._unit()._perp():f;var _=(f=f||m).add(m);0===_.x&&0===_.y||_._unit();var y=f.x*m.x+f.y*m.y,v=_.x*m.x+_.y*m.y,x=0!==v?1/v:1/0,w=2*Math.sqrt(2-2*v),b=v<Us&&p&&d,B=f.x*m.y-f.y*m.x>0;if(b&&g>c){var C=u.dist(p);if(C>2*h){var E=u.sub(u.sub(p)._mult(h/C)._round());this.updateDistance(p,E),this.addCurrentVertex(E,f,0,0,A),p=E}}var T=p&&d,I=T?r:s?"butt":i;if(T&&"round"===I&&(x<o?I="miter":x<=2&&(I="fakeround")),"miter"===I&&x>n&&(I="bevel"),"bevel"===I&&(x>2&&(I="flipbevel"),x<n&&(I="miter")),p&&this.updateDistance(p,u),"miter"===I)_._mult(x),this.addCurrentVertex(u,_,0,0,A);else if("flipbevel"===I){if(x>100)_=m.mult(-1);else{var S=x*f.add(m).mag()/f.sub(m).mag();_._perp()._mult(S*(B?-1:1))}this.addCurrentVertex(u,_,0,0,A),this.addCurrentVertex(u,_.mult(-1),0,0,A)}else if("bevel"===I||"fakeround"===I){var M=-Math.sqrt(x*x-1),F=B?M:0,P=B?0:M;if(p&&this.addCurrentVertex(u,f,F,P,A),"fakeround"===I)for(var L=Math.round(180*w/Math.PI/20),D=1;D<L;D++){var U=D/L;if(.5!==U){var k=U-.5;U+=U*k*(U-1)*((1.0904+y*(y*(3.55645-1.43519*y)-3.2452))*k*k+(.848013+y*(.215638*y-1.06021)))}var z=m.sub(f)._mult(U)._add(f)._unit()._mult(B?-1:1);this.addHalfVertex(u,z.x,z.y,!1,B,0,A)}d&&this.addCurrentVertex(u,m,-F,-P,A)}else if("butt"===I)this.addCurrentVertex(u,_,0,0,A);else if("square"===I){var R=p?1:-1;this.addCurrentVertex(u,_,R,R,A)}else"round"===I&&(p&&(this.addCurrentVertex(u,f,0,0,A),this.addCurrentVertex(u,f,1,1,A,!0)),d&&(this.addCurrentVertex(u,m,-1,-1,A,!0),this.addCurrentVertex(u,m,0,0,A)));if(b&&g<l-1){var O=u.dist(d);if(O>2*h){var Q=u.add(d.sub(u)._mult(h/O)._round());this.updateDistance(u,Q),this.addCurrentVertex(Q,m,0,0,A),u=Q}}}}},zs.prototype.addCurrentVertex=function(t,e,r,i,n,o){void 0===o&&(o=!1);var a=e.y*i-e.x,s=-e.y-e.x*i;this.addHalfVertex(t,e.x+e.y*r,e.y-e.x*r,o,!1,r,n),this.addHalfVertex(t,a,s,o,!0,-i,n),this.distance>ks/2&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(t,e,r,i,n,o))},zs.prototype.addHalfVertex=function(t,e,r,i,n,o,a){var s=.5*(this.lineClips?this.scaledDistance*(ks-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(i?1:0),(t.y<<1)+(n?1:0),Math.round(63*e)+128,Math.round(63*r)+128,1+(0===o?0:o<0?-1:1)|(63&s)<<2,s>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var l=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,l),a.primitiveLength++),n?this.e2=l:this.e1=l},zs.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},zs.prototype.updateDistance=function(t,e){this.distance+=t.dist(e),this.updateScaledDistance()},Ri("LineBucket",zs,{omit:["layers","patternFeatures"]});var Rs=new wn({"line-cap":new gn(St.layout_line["line-cap"]),"line-join":new _n(St.layout_line["line-join"]),"line-miter-limit":new gn(St.layout_line["line-miter-limit"]),"line-round-limit":new gn(St.layout_line["line-round-limit"]),"line-sort-key":new _n(St.layout_line["line-sort-key"])}),Os={paint:new wn({"line-opacity":new _n(St.paint_line["line-opacity"]),"line-color":new _n(St.paint_line["line-color"]),"line-translate":new gn(St.paint_line["line-translate"]),"line-translate-anchor":new gn(St.paint_line["line-translate-anchor"]),"line-width":new _n(St.paint_line["line-width"]),"line-gap-width":new _n(St.paint_line["line-gap-width"]),"line-offset":new _n(St.paint_line["line-offset"]),"line-blur":new _n(St.paint_line["line-blur"]),"line-dasharray":new vn(St.paint_line["line-dasharray"]),"line-pattern":new yn(St.paint_line["line-pattern"]),"line-gradient":new xn(St.paint_line["line-gradient"])}),layout:Rs},Qs=new(function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.possiblyEvaluate=function(e,r){return r=new ln(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),t.prototype.possiblyEvaluate.call(this,e,r)},e.prototype.evaluate=function(e,r,i,n){return r=A({},r,{zoom:Math.floor(r.zoom)}),t.prototype.evaluate.call(this,e,r,i,n)},e}(_n))(Os.paint.properties["line-width"].specification);Qs.useIntegerZoom=!0;var Ns=function(t){function e(e){t.call(this,e,Os),this.gradientVersion=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._handleSpecialPaintPropertyUpdate=function(t){"line-gradient"===t&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof He,this.gradientVersion=(this.gradientVersion+1)%s)},e.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},e.prototype.recalculate=function(e,r){t.prototype.recalculate.call(this,e,r),this.paint._values["line-floorwidth"]=Qs.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)},e.prototype.createBucket=function(t){return new zs(t)},e.prototype.queryRadius=function(t){var e=t,r=Vs(ra("line-width",this,e),ra("line-gap-width",this,e)),i=ra("line-offset",this,e);return r/2+Math.abs(i)+ia(this.paint.get("line-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,i,o,a,s){var l=na(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),a.angle,s),c=s/2*Vs(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),u=this.paint.get("line-offset").evaluate(e,r);return u&&(i=function(t,e){for(var r=[],i=new n(0,0),o=0;o<t.length;o++){for(var a=t[o],s=[],l=0;l<a.length;l++){var c=a[l],u=a[l+1],h=0===l?i:c.sub(a[l-1])._unit()._perp(),A=l===a.length-1?i:u.sub(c)._unit()._perp(),p=h._add(A)._unit();p._mult(1/(p.x*A.x+p.y*A.y)),s.push(p._mult(e)._add(c))}r.push(s)}return r}(i,u*s)),function(t,e,r){for(var i=0;i<e.length;i++){var n=e[i];if(t.length>=3)for(var o=0;o<n.length;o++)if(ta(t,n[o]))return!0;if(Zo(t,n,r))return!0}return!1}(l,i,c)},e.prototype.isTileClipped=function(){return!0},e}(bn);function Vs(t,e){return e>0?e+2*t:t}var Hs=Tn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),js=Tn([{name:"a_projected_pos",components:3,type:"Float32"}],4),Gs=(Tn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Tn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Ks=(Tn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Tn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),qs=Tn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Zs(t,e,r){return t.sections.forEach((function(t){t.text=function(t,e,r){var i=e.layout.get("text-transform").evaluate(r,{});return"uppercase"===i?t=t.toLocaleUpperCase():"lowercase"===i&&(t=t.toLocaleLowerCase()),sn.applyArabicShaping&&(t=sn.applyArabicShaping(t)),t}(t.text,e,r)})),t}Tn([{name:"triangle",components:3,type:"Uint16"}]),Tn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Tn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Tn([{type:"Float32",name:"offsetX"}]),Tn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Ws={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"},Xs=function(t,e,r,i,n){var o,a,s=8*n-i-1,l=(1<<s)-1,c=l>>1,u=-7,h=r?n-1:0,A=r?-1:1,p=t[e+h];for(h+=A,o=p&(1<<-u)-1,p>>=-u,u+=s;u>0;o=256*o+t[e+h],h+=A,u-=8);for(a=o&(1<<-u)-1,o>>=-u,u+=i;u>0;a=256*a+t[e+h],h+=A,u-=8);if(0===o)o=1-c;else{if(o===l)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,i),o-=c}return(p?-1:1)*a*Math.pow(2,o-i)},$s=function(t,e,r,i,n,o){var a,s,l,c=8*o-n-1,u=(1<<c)-1,h=u>>1,A=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:o-1,d=i?1:-1,f=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=u):(a=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-a))<1&&(a--,l*=2),(e+=a+h>=1?A/l:A*Math.pow(2,1-h))*l>=2&&(a++,l/=2),a+h>=u?(s=0,a=u):a+h>=1?(s=(e*l-1)*Math.pow(2,n),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,n),a=0));n>=8;t[r+p]=255&s,p+=d,s/=256,n-=8);for(a=a<<n|s,c+=n;c>0;t[r+p]=255&a,p+=d,a/=256,c-=8);t[r+p-d]|=128*f},Ys=Js;function Js(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Js.Varint=0,Js.Fixed64=1,Js.Bytes=2,Js.Fixed32=5;var tl="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function el(t){return t.type===Js.Bytes?t.readVarint()+t.pos:t.pos+1}function rl(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function il(t,e,r){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(i);for(var n=r.pos-1;n>=t;n--)r.buf[n+i]=r.buf[n]}function nl(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function ol(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function al(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function sl(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function ll(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function cl(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function ul(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function hl(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function Al(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function pl(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function dl(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function fl(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function ml(t,e,r){1===t&&r.readMessage(gl,e)}function gl(t,e,r){if(3===t){var i=r.readMessage(_l,{}),n=i.width,o=i.height,a=i.left,s=i.top,l=i.advance;e.push({id:i.id,bitmap:new va({width:n+6,height:o+6},i.bitmap),metrics:{width:n,height:o,left:a,top:s,advance:l}})}}function _l(t,e,r){1===t?e.id=r.readVarint():2===t?e.bitmap=r.readBytes():3===t?e.width=r.readVarint():4===t?e.height=r.readVarint():5===t?e.left=r.readSVarint():6===t?e.top=r.readSVarint():7===t&&(e.advance=r.readVarint())}function yl(t){for(var e=0,r=0,i=0,n=t;i<n.length;i+=1){var o=n[i];e+=o.w*o.h,r=Math.max(r,o.w)}t.sort((function(t,e){return e.h-t.h}));for(var a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}],s=0,l=0,c=0,u=t;c<u.length;c+=1)for(var h=u[c],A=a.length-1;A>=0;A--){var p=a[A];if(!(h.w>p.w||h.h>p.h)){if(h.x=p.x,h.y=p.y,l=Math.max(l,h.y+h.h),s=Math.max(s,h.x+h.w),h.w===p.w&&h.h===p.h){var d=a.pop();A<a.length&&(a[A]=d)}else h.h===p.h?(p.x+=h.w,p.w-=h.w):h.w===p.w?(p.y+=h.h,p.h-=h.h):(a.push({x:p.x+h.w,y:p.y,w:p.w-h.w,h:h.h}),p.y+=h.h,p.h-=h.h);break}}return{w:s,h:l,fill:e/(s*l)||0}}Js.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var i=this.readVarint(),n=i>>3,o=this.pos;this.type=7&i,t(n,e,this),this.pos===o&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=pl(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=fl(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=pl(this.buf,this.pos)+4294967296*pl(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=pl(this.buf,this.pos)+4294967296*fl(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=Xs(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Xs(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,i=this.buf;return e=127&(r=i[this.pos++]),r<128?e:(e|=(127&(r=i[this.pos++]))<<7,r<128?e:(e|=(127&(r=i[this.pos++]))<<14,r<128?e:(e|=(127&(r=i[this.pos++]))<<21,r<128?e:function(t,e,r){var i,n,o=r.buf;if(i=(112&(n=o[r.pos++]))>>4,n<128)return rl(t,i,e);if(i|=(127&(n=o[r.pos++]))<<3,n<128)return rl(t,i,e);if(i|=(127&(n=o[r.pos++]))<<10,n<128)return rl(t,i,e);if(i|=(127&(n=o[r.pos++]))<<17,n<128)return rl(t,i,e);if(i|=(127&(n=o[r.pos++]))<<24,n<128)return rl(t,i,e);if(i|=(1&(n=o[r.pos++]))<<31,n<128)return rl(t,i,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=i[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&tl?function(t,e,r){return tl.decode(t.subarray(e,r))}(this.buf,e,t):function(t,e,r){for(var i="",n=e;n<r;){var o,a,s,l=t[n],c=null,u=l>239?4:l>223?3:l>191?2:1;if(n+u>r)break;1===u?l<128&&(c=l):2===u?128==(192&(o=t[n+1]))&&(c=(31&l)<<6|63&o)<=127&&(c=null):3===u?(a=t[n+2],128==(192&(o=t[n+1]))&&128==(192&a)&&((c=(15&l)<<12|(63&o)<<6|63&a)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(a=t[n+2],s=t[n+3],128==(192&(o=t[n+1]))&&128==(192&a)&&128==(192&s)&&((c=(15&l)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,i+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),i+=String.fromCharCode(c),n+=u}return i}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Js.Bytes)return t.push(this.readVarint(e));var r=el(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Js.Bytes)return t.push(this.readSVarint());var e=el(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Js.Bytes)return t.push(this.readBoolean());var e=el(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Js.Bytes)return t.push(this.readFloat());var e=el(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Js.Bytes)return t.push(this.readDouble());var e=el(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Js.Bytes)return t.push(this.readFixed32());var e=el(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Js.Bytes)return t.push(this.readSFixed32());var e=el(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Js.Bytes)return t.push(this.readFixed64());var e=el(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Js.Bytes)return t.push(this.readSFixed64());var e=el(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Js.Varint)for(;this.buf[this.pos++]>127;);else if(e===Js.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Js.Fixed32)this.pos+=4;else{if(e!==Js.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),dl(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),dl(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),dl(this.buf,-1&t,this.pos),dl(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),dl(this.buf,-1&t,this.pos),dl(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var r,i;if(t>=0?(r=t%4294967296|0,i=t/4294967296|0):(i=~(-t/4294967296),4294967295^(r=~(-t%4294967296))?r=r+1|0:(r=0,i=i+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,r){r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,r.buf[r.pos]=127&(t>>>=7)}(r,0,e),function(t,e){var r=(7&t)<<4;e.buf[e.pos++]|=r|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(i,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,r){for(var i,n,o=0;o<e.length;o++){if((i=e.charCodeAt(o))>55295&&i<57344){if(!n){i>56319||o+1===e.length?(t[r++]=239,t[r++]=191,t[r++]=189):n=i;continue}if(i<56320){t[r++]=239,t[r++]=191,t[r++]=189,n=i;continue}i=n-55296<<10|i-56320|65536,n=null}else n&&(t[r++]=239,t[r++]=191,t[r++]=189,n=null);i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:(i<65536?t[r++]=i>>12|224:(t[r++]=i>>18|240,t[r++]=i>>12&63|128),t[r++]=i>>6&63|128),t[r++]=63&i|128)}return r}(this.buf,t,this.pos);var r=this.pos-e;r>=128&&il(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),$s(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),$s(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var i=this.pos-r;i>=128&&il(r,i,this),this.pos=r-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,r){this.writeTag(t,Js.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,nl,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,ol,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,ll,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,al,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,sl,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,cl,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,ul,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,hl,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,Al,e)},writeBytesField:function(t,e){this.writeTag(t,Js.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Js.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Js.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Js.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Js.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Js.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Js.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Js.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Js.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Js.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var vl=function(t,e){var r=e.pixelRatio,i=e.version,n=e.stretchX,o=e.stretchY,a=e.content;this.paddedRect=t,this.pixelRatio=r,this.stretchX=n,this.stretchY=o,this.content=a,this.version=i},xl={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};xl.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},xl.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},xl.tlbr.get=function(){return this.tl.concat(this.br)},xl.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(vl.prototype,xl);var wl=function(t,e){var r={},i={};this.haveRenderCallbacks=[];var n=[];this.addImages(t,r,n),this.addImages(e,i,n);var o=yl(n),a=new xa({width:o.w||1,height:o.h||1});for(var s in t){var l=t[s],c=r[s].paddedRect;xa.copy(l.data,a,{x:0,y:0},{x:c.x+1,y:c.y+1},l.data)}for(var u in e){var h=e[u],A=i[u].paddedRect,p=A.x+1,d=A.y+1,f=h.data.width,m=h.data.height;xa.copy(h.data,a,{x:0,y:0},{x:p,y:d},h.data),xa.copy(h.data,a,{x:0,y:m-1},{x:p,y:d-1},{width:f,height:1}),xa.copy(h.data,a,{x:0,y:0},{x:p,y:d+m},{width:f,height:1}),xa.copy(h.data,a,{x:f-1,y:0},{x:p-1,y:d},{width:1,height:m}),xa.copy(h.data,a,{x:0,y:0},{x:p+f,y:d},{width:1,height:m})}this.image=a,this.iconPositions=r,this.patternPositions=i};wl.prototype.addImages=function(t,e,r){for(var i in t){var n=t[i],o={x:0,y:0,w:n.data.width+2,h:n.data.height+2};r.push(o),e[i]=new vl(o,n),n.hasRenderCallback&&this.haveRenderCallbacks.push(i)}},wl.prototype.patchUpdatedImages=function(t,e){for(var r in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[r],t.getImage(r),e),this.patchUpdatedImage(this.patternPositions[r],t.getImage(r),e)},wl.prototype.patchUpdatedImage=function(t,e,r){if(t&&e&&t.version!==e.version){t.version=e.version;var i=t.tl;r.update(e.data,void 0,{x:i[0],y:i[1]})}},Ri("ImagePosition",vl),Ri("ImageAtlas",wl);var bl={horizontal:1,vertical:2,horizontalOnly:3},Bl=function(){this.scale=1,this.fontStack="",this.imageName=null};Bl.forText=function(t,e){var r=new Bl;return r.scale=t||1,r.fontStack=e,r},Bl.forImage=function(t){var e=new Bl;return e.imageName=t,e};var Cl=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function El(t,e,r,i,n,o,a,s,l,c,u,h,A,p,d,f){var m,g=Cl.fromFeature(t,n);h===bl.vertical&&g.verticalizePunctuation();var _=sn.processBidirectionalText,y=sn.processStyledBidirectionalText;if(_&&1===g.sections.length){m=[];for(var v=0,x=_(g.toString(),Ll(g,c,o,e,i,p,d));v<x.length;v+=1){var w=x[v],b=new Cl;b.text=w,b.sections=g.sections;for(var B=0;B<w.length;B++)b.sectionIndex.push(0);m.push(b)}}else if(y){m=[];for(var C=0,E=y(g.text,g.sectionIndex,Ll(g,c,o,e,i,p,d));C<E.length;C+=1){var T=E[C],I=new Cl;I.text=T[0],I.sectionIndex=T[1],I.sections=g.sections,m.push(I)}}else m=function(t,e){for(var r=[],i=t.text,n=0,o=0,a=e;o<a.length;o+=1){var s=a[o];r.push(t.substring(n,s)),n=s}return n<i.length&&r.push(t.substring(n,i.length)),r}(g,Ll(g,c,o,e,i,p,d));var S=[],M={positionedLines:S,text:g.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:h,iconsInText:!1,verticalizable:!1};return function(t,e,r,i,n,o,a,s,l,c,u,h){for(var A=0,p=-17,d=0,f=0,m="right"===s?1:"left"===s?0:.5,g=0,_=0,y=n;_<y.length;_+=1){var v=y[_];v.trim();var x=v.getMaxScale(),w=24*(x-1),b={positionedGlyphs:[],lineOffset:0};t.positionedLines[g]=b;var B=b.positionedGlyphs,C=0;if(v.length()){for(var E=0;E<v.length();E++){var T=v.getSection(E),I=v.getSectionIndex(E),S=v.getCharCode(E),M=0,F=null,P=null,L=null,D=24,U=!(l===bl.horizontal||!u&&!qi(S)||u&&(Tl[S]||(j=S,Gi.Arabic(j)||Gi["Arabic Supplement"](j)||Gi["Arabic Extended-A"](j)||Gi["Arabic Presentation Forms-A"](j)||Gi["Arabic Presentation Forms-B"](j))));if(T.imageName){var k=i[T.imageName];if(!k)continue;L=T.imageName,t.iconsInText=t.iconsInText||!0,P=k.paddedRect;var z=k.displaySize;T.scale=24*T.scale/h,M=w+(24-z[1]*T.scale),D=(F={width:z[0],height:z[1],left:1,top:-3,advance:U?z[1]:z[0]}).advance;var R=U?z[0]*T.scale-24*x:z[1]*T.scale-24*x;R>0&&R>C&&(C=R)}else{var O=r[T.fontStack],Q=O&&O[S];if(Q&&Q.rect)P=Q.rect,F=Q.metrics;else{var N=e[T.fontStack],V=N&&N[S];if(!V)continue;F=V.metrics}M=24*(x-T.scale)}U?(t.verticalizable=!0,B.push({glyph:S,imageName:L,x:A,y:p+M,vertical:U,scale:T.scale,fontStack:T.fontStack,sectionIndex:I,metrics:F,rect:P}),A+=D*T.scale+c):(B.push({glyph:S,imageName:L,x:A,y:p+M,vertical:U,scale:T.scale,fontStack:T.fontStack,sectionIndex:I,metrics:F,rect:P}),A+=F.advance*T.scale+c)}0!==B.length&&(d=Math.max(A-c,d),Ul(B,0,B.length-1,m,C)),A=0;var H=o*x+C;b.lineOffset=Math.max(C,w),p+=H,f=Math.max(H,f),++g}else p+=o,++g}var j,G=p- -17,K=Dl(a),q=K.horizontalAlign,Z=K.verticalAlign;(function(t,e,r,i,n,o,a,s,l){var c,u=(e-r)*n;c=o!==a?-s*i- -17:(-i*l+.5)*a;for(var h=0,A=t;h<A.length;h+=1)for(var p=0,d=A[h].positionedGlyphs;p<d.length;p+=1){var f=d[p];f.x+=u,f.y+=c}})(t.positionedLines,m,q,Z,d,f,o,G,n.length),t.top+=-Z*G,t.bottom=t.top+G,t.left+=-q*d,t.right=t.left+d}(M,e,r,i,m,a,s,l,h,c,A,f),!function(t){for(var e=0,r=t;e<r.length;e+=1)if(0!==r[e].positionedGlyphs.length)return!1;return!0}(S)&&M}Cl.fromFeature=function(t,e){for(var r=new Cl,i=0;i<t.sections.length;i++){var n=t.sections[i];n.image?r.addImageSection(n):r.addTextSection(n,e)}return r},Cl.prototype.length=function(){return this.text.length},Cl.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},Cl.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},Cl.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},Cl.prototype.verticalizePunctuation=function(){this.text=function(t){for(var e="",r=0;r<t.length;r++){var i=t.charCodeAt(r+1)||null,n=t.charCodeAt(r-1)||null;e+=i&&Zi(i)&&!Ws[t[r+1]]||n&&Zi(n)&&!Ws[t[r-1]]||!Ws[t[r]]?t[r]:Ws[t[r]]}return e}(this.text)},Cl.prototype.trim=function(){for(var t=0,e=0;e<this.text.length&&Tl[this.text.charCodeAt(e)];e++)t++;for(var r=this.text.length,i=this.text.length-1;i>=0&&i>=t&&Tl[this.text.charCodeAt(i)];i--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)},Cl.prototype.substring=function(t,e){var r=new Cl;return r.text=this.text.substring(t,e),r.sectionIndex=this.sectionIndex.slice(t,e),r.sections=this.sections,r},Cl.prototype.toString=function(){return this.text},Cl.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce((function(e,r){return Math.max(e,t.sections[r].scale)}),0)},Cl.prototype.addTextSection=function(t,e){this.text+=t.text,this.sections.push(Bl.forText(t.scale,t.fontStack||e));for(var r=this.sections.length-1,i=0;i<t.text.length;++i)this.sectionIndex.push(r)},Cl.prototype.addImageSection=function(t){var e=t.image?t.image.name:"";if(0!==e.length){var r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(Bl.forImage(e)),this.sectionIndex.push(this.sections.length-1)):b("Reached maximum number of images 6401")}else b("Can't add FormattedSection with an empty image.")},Cl.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Tl={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Il={};function Sl(t,e,r,i,n,o){if(e.imageName){var a=i[e.imageName];return a?a.displaySize[0]*e.scale*24/o+n:0}var s=r[e.fontStack],l=s&&s[t];return l?l.metrics.advance*e.scale+n:0}function Ml(t,e,r,i){var n=Math.pow(t-e,2);return i?t<e?n/2:2*n:n+Math.abs(r)*r}function Fl(t,e,r){var i=0;return 10===t&&(i-=1e4),r&&(i+=150),40!==t&&65288!==t||(i+=50),41!==e&&65289!==e||(i+=50),i}function Pl(t,e,r,i,n,o){for(var a=null,s=Ml(e,r,n,o),l=0,c=i;l<c.length;l+=1){var u=c[l],h=Ml(e-u.x,r,n,o)+u.badness;h<=s&&(a=u,s=h)}return{index:t,x:e,priorBreak:a,badness:s}}function Ll(t,e,r,i,n,o,a){if("point"!==o)return[];if(!t)return[];for(var s,l=[],c=function(t,e,r,i,n,o){for(var a=0,s=0;s<t.length();s++){var l=t.getSection(s);a+=Sl(t.getCharCode(s),l,i,n,e,o)}return a/Math.max(1,Math.ceil(a/r))}(t,e,r,i,n,a),u=t.text.indexOf("​")>=0,h=0,A=0;A<t.length();A++){var p=t.getSection(A),d=t.getCharCode(A);if(Tl[d]||(h+=Sl(d,p,i,n,e,a)),A<t.length()-1){var f=!((s=d)<11904||!(Gi["Bopomofo Extended"](s)||Gi.Bopomofo(s)||Gi["CJK Compatibility Forms"](s)||Gi["CJK Compatibility Ideographs"](s)||Gi["CJK Compatibility"](s)||Gi["CJK Radicals Supplement"](s)||Gi["CJK Strokes"](s)||Gi["CJK Symbols and Punctuation"](s)||Gi["CJK Unified Ideographs Extension A"](s)||Gi["CJK Unified Ideographs"](s)||Gi["Enclosed CJK Letters and Months"](s)||Gi["Halfwidth and Fullwidth Forms"](s)||Gi.Hiragana(s)||Gi["Ideographic Description Characters"](s)||Gi["Kangxi Radicals"](s)||Gi["Katakana Phonetic Extensions"](s)||Gi.Katakana(s)||Gi["Vertical Forms"](s)||Gi["Yi Radicals"](s)||Gi["Yi Syllables"](s)));(Il[d]||f||p.imageName)&&l.push(Pl(A+1,h,c,l,Fl(d,t.getCharCode(A+1),f&&u),!1))}}return function t(e){return e?t(e.priorBreak).concat(e.index):[]}(Pl(t.length(),h,c,l,0,!0))}function Dl(t){var e=.5,r=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Ul(t,e,r,i,n){if(i||n)for(var o=t[r],a=(t[r].x+o.metrics.advance*o.scale)*i,s=e;s<=r;s++)t[s].x-=a,t[s].y+=n}function kl(t,e,r,i,n,o){var a,s=t.image;if(s.content){var l=s.content,c=s.pixelRatio||1;a=[l[0]/c,l[1]/c,s.displaySize[0]-l[2]/c,s.displaySize[1]-l[3]/c]}var u,h,A,p,d=e.left*o,f=e.right*o;"width"===r||"both"===r?(p=n[0]+d-i[3],h=n[0]+f+i[1]):h=(p=n[0]+(d+f-s.displaySize[0])/2)+s.displaySize[0];var m=e.top*o,g=e.bottom*o;return"height"===r||"both"===r?(u=n[1]+m-i[0],A=n[1]+g+i[2]):A=(u=n[1]+(m+g-s.displaySize[1])/2)+s.displaySize[1],{image:s,top:u,right:h,bottom:A,left:p,collisionPadding:a}}Il[10]=!0,Il[32]=!0,Il[38]=!0,Il[40]=!0,Il[41]=!0,Il[43]=!0,Il[45]=!0,Il[47]=!0,Il[173]=!0,Il[183]=!0,Il[8203]=!0,Il[8208]=!0,Il[8211]=!0,Il[8231]=!0;var zl=function(t){function e(e,r,i,n){t.call(this,e,r),this.angle=i,void 0!==n&&(this.segment=n)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.clone=function(){return new e(this.x,this.y,this.angle,this.segment)},e}(n);function Rl(t,e){var r=e.expression;if("constant"===r.kind)return{kind:"constant",layoutSize:r.evaluate(new ln(t+1))};if("source"===r.kind)return{kind:"source"};for(var i=r.zoomStops,n=r.interpolationType,o=0;o<i.length&&i[o]<=t;)o++;for(var a=o=Math.max(0,o-1);a<i.length&&i[a]<t+1;)a++;a=Math.min(i.length-1,a);var s=i[o],l=i[a];return"composite"===r.kind?{kind:"composite",minZoom:s,maxZoom:l,interpolationType:n}:{kind:"camera",minZoom:s,maxZoom:l,minSize:r.evaluate(new ln(s)),maxSize:r.evaluate(new ln(l)),interpolationType:n}}function Ol(t,e,r){var i=e.uSize,n=r.lowerSize;return"source"===t.kind?n/128:"composite"===t.kind?je(n/128,r.upperSize/128,e.uSizeT):i}function Ql(t,e){var r=0,i=0;if("constant"===t.kind)i=t.layoutSize;else if("source"!==t.kind){var n=t.interpolationType,o=n?u(ar.interpolationFactor(n,e,t.minZoom,t.maxZoom),0,1):0;"camera"===t.kind?i=je(t.minSize,t.maxSize,o):r=o}return{uSizeT:r,uSize:i}}Ri("Anchor",zl);var Nl=Object.freeze({__proto__:null,getSizeData:Rl,evaluateSizeForFeature:Ol,evaluateSizeForZoom:Ql,SIZE_PACK_FACTOR:128});function Vl(t,e,r,i,n){if(void 0===e.segment)return!0;for(var o=e,a=e.segment+1,s=0;s>-r/2;){if(--a<0)return!1;s-=t[a].dist(o),o=t[a]}s+=t[a].dist(t[a+1]),a++;for(var l=[],c=0;s<r/2;){var u=t[a],h=t[a+1];if(!h)return!1;var A=t[a-1].angleTo(u)-u.angleTo(h);for(A=Math.abs((A+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:s,angleDelta:A}),c+=A;s-l[0].distance>i;)c-=l.shift().angleDelta;if(c>n)return!1;a++,s+=u.dist(h)}return!0}function Hl(t){for(var e=0,r=0;r<t.length-1;r++)e+=t[r].dist(t[r+1]);return e}function jl(t,e,r){return t?.6*e*r:0}function Gl(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function Kl(t,e,r,i,n,o){for(var a=jl(r,n,o),s=Gl(r,i)*o,l=0,c=Hl(t)/2,u=0;u<t.length-1;u++){var h=t[u],A=t[u+1],p=h.dist(A);if(l+p>c){var d=(c-l)/p,f=je(h.x,A.x,d),m=je(h.y,A.y,d),g=new zl(f,m,A.angleTo(h),u);return g._round(),!a||Vl(t,g,s,a,e)?g:void 0}l+=p}}function ql(t,e,r,i,n,o,a,s,l){var c=jl(i,o,a),u=Gl(i,n),h=u*a,A=0===t[0].x||t[0].x===l||0===t[0].y||t[0].y===l;return e-h<e/4&&(e=h+e/4),function t(e,r,i,n,o,a,s,l,c){for(var u=a/2,h=Hl(e),A=0,p=r-i,d=[],f=0;f<e.length-1;f++){for(var m=e[f],g=e[f+1],_=m.dist(g),y=g.angleTo(m);p+i<A+_;){var v=((p+=i)-A)/_,x=je(m.x,g.x,v),w=je(m.y,g.y,v);if(x>=0&&x<c&&w>=0&&w<c&&p-u>=0&&p+u<=h){var b=new zl(x,w,y,f);b._round(),n&&!Vl(e,b,a,n,o)||d.push(b)}}A+=_}return l||d.length||s||(d=t(e,A/2,i,n,o,a,s,!0,c)),d}(t,A?e/2*s%e:(u/2+2*o)*a*s%e,e,c,r,h,A,!1,l)}function Zl(t,e,r,i,o){for(var a=[],s=0;s<t.length;s++)for(var l=t[s],c=void 0,u=0;u<l.length-1;u++){var h=l[u],A=l[u+1];h.x<e&&A.x<e||(h.x<e?h=new n(e,h.y+(e-h.x)/(A.x-h.x)*(A.y-h.y))._round():A.x<e&&(A=new n(e,h.y+(e-h.x)/(A.x-h.x)*(A.y-h.y))._round()),h.y<r&&A.y<r||(h.y<r?h=new n(h.x+(r-h.y)/(A.y-h.y)*(A.x-h.x),r)._round():A.y<r&&(A=new n(h.x+(r-h.y)/(A.y-h.y)*(A.x-h.x),r)._round()),h.x>=i&&A.x>=i||(h.x>=i?h=new n(i,h.y+(i-h.x)/(A.x-h.x)*(A.y-h.y))._round():A.x>=i&&(A=new n(i,h.y+(i-h.x)/(A.x-h.x)*(A.y-h.y))._round()),h.y>=o&&A.y>=o||(h.y>=o?h=new n(h.x+(o-h.y)/(A.y-h.y)*(A.x-h.x),o)._round():A.y>=o&&(A=new n(h.x+(o-h.y)/(A.y-h.y)*(A.x-h.x),o)._round()),c&&h.equals(c[c.length-1])||a.push(c=[h]),c.push(A)))))}return a}function Wl(t,e,r,i){var o=[],a=t.image,s=a.pixelRatio,l=a.paddedRect.w-2,c=a.paddedRect.h-2,u=t.right-t.left,h=t.bottom-t.top,A=a.stretchX||[[0,l]],p=a.stretchY||[[0,c]],d=function(t,e){return t+e[1]-e[0]},f=A.reduce(d,0),m=p.reduce(d,0),g=l-f,_=c-m,y=0,v=f,x=0,w=m,b=0,B=g,C=0,E=_;if(a.content&&i){var T=a.content;y=Xl(A,0,T[0]),x=Xl(p,0,T[1]),v=Xl(A,T[0],T[2]),w=Xl(p,T[1],T[3]),b=T[0]-y,C=T[1]-x,B=T[2]-T[0]-v,E=T[3]-T[1]-w}var I=function(i,o,l,c){var A=Yl(i.stretch-y,v,u,t.left),p=Jl(i.fixed-b,B,i.stretch,f),d=Yl(o.stretch-x,w,h,t.top),g=Jl(o.fixed-C,E,o.stretch,m),_=Yl(l.stretch-y,v,u,t.left),T=Jl(l.fixed-b,B,l.stretch,f),I=Yl(c.stretch-x,w,h,t.top),S=Jl(c.fixed-C,E,c.stretch,m),M=new n(A,d),F=new n(_,d),P=new n(_,I),L=new n(A,I),D=new n(p/s,g/s),U=new n(T/s,S/s),k=e*Math.PI/180;if(k){var z=Math.sin(k),R=Math.cos(k),O=[R,-z,z,R];M._matMult(O),F._matMult(O),L._matMult(O),P._matMult(O)}var Q=i.stretch+i.fixed,N=o.stretch+o.fixed;return{tl:M,tr:F,bl:L,br:P,tex:{x:a.paddedRect.x+1+Q,y:a.paddedRect.y+1+N,w:l.stretch+l.fixed-Q,h:c.stretch+c.fixed-N},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:D,pixelOffsetBR:U,minFontScaleX:B/s/u,minFontScaleY:E/s/h,isSDF:r}};if(i&&(a.stretchX||a.stretchY))for(var S=$l(A,g,f),M=$l(p,_,m),F=0;F<S.length-1;F++)for(var P=S[F],L=S[F+1],D=0;D<M.length-1;D++)o.push(I(P,M[D],L,M[D+1]));else o.push(I({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:l+1},{fixed:0,stretch:c+1}));return o}function Xl(t,e,r){for(var i=0,n=0,o=t;n<o.length;n+=1){var a=o[n];i+=Math.max(e,Math.min(r,a[1]))-Math.max(e,Math.min(r,a[0]))}return i}function $l(t,e,r){for(var i=[{fixed:-1,stretch:0}],n=0,o=t;n<o.length;n+=1){var a=o[n],s=a[0],l=a[1],c=i[i.length-1];i.push({fixed:s-c.stretch,stretch:c.stretch}),i.push({fixed:s-c.stretch,stretch:c.stretch+(l-s)})}return i.push({fixed:e+1,stretch:r}),i}function Yl(t,e,r,i){return t/e*r+i}function Jl(t,e,r,i){return t-e*r/i}var tc=function(t,e,r,i,o,a,s,l,c,u){if(this.boxStartIndex=t.length,c){var h=a.top,A=a.bottom,p=a.collisionPadding;p&&(h-=p[1],A+=p[3]);var d=A-h;d>0&&(d=Math.max(10,d),this.circleDiameter=d)}else{var f=a.top*s-l,m=a.bottom*s+l,g=a.left*s-l,_=a.right*s+l,y=a.collisionPadding;if(y&&(g-=y[0]*s,f-=y[1]*s,_+=y[2]*s,m+=y[3]*s),u){var v=new n(g,f),x=new n(_,f),w=new n(g,m),b=new n(_,m),B=u*Math.PI/180;v._rotate(B),x._rotate(B),w._rotate(B),b._rotate(B),g=Math.min(v.x,x.x,w.x,b.x),_=Math.max(v.x,x.x,w.x,b.x),f=Math.min(v.y,x.y,w.y,b.y),m=Math.max(v.y,x.y,w.y,b.y)}t.emplaceBack(e.x,e.y,g,f,_,m,r,i,o)}this.boxEndIndex=t.length},ec=function(t,e){if(void 0===t&&(t=[]),void 0===e&&(e=rc),this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)};function rc(t,e){return t<e?-1:t>e?1:0}function ic(t,e,r){void 0===e&&(e=1),void 0===r&&(r=!1);for(var i=1/0,o=1/0,a=-1/0,s=-1/0,l=t[0],c=0;c<l.length;c++){var u=l[c];(!c||u.x<i)&&(i=u.x),(!c||u.y<o)&&(o=u.y),(!c||u.x>a)&&(a=u.x),(!c||u.y>s)&&(s=u.y)}var h=Math.min(a-i,s-o),A=h/2,p=new ec([],nc);if(0===h)return new n(i,o);for(var d=i;d<a;d+=h)for(var f=o;f<s;f+=h)p.push(new oc(d+A,f+A,A,t));for(var m=function(t){for(var e=0,r=0,i=0,n=t[0],o=0,a=n.length,s=a-1;o<a;s=o++){var l=n[o],c=n[s],u=l.x*c.y-c.x*l.y;r+=(l.x+c.x)*u,i+=(l.y+c.y)*u,e+=3*u}return new oc(r/e,i/e,0,t)}(t),g=p.length;p.length;){var _=p.pop();(_.d>m.d||!m.d)&&(m=_,r&&console.log("found best %d after %d probes",Math.round(1e4*_.d)/1e4,g)),_.max-m.d<=e||(p.push(new oc(_.p.x-(A=_.h/2),_.p.y-A,A,t)),p.push(new oc(_.p.x+A,_.p.y-A,A,t)),p.push(new oc(_.p.x-A,_.p.y+A,A,t)),p.push(new oc(_.p.x+A,_.p.y+A,A,t)),g+=4)}return r&&(console.log("num probes: "+g),console.log("best distance: "+m.d)),m.p}function nc(t,e){return e.max-t.max}function oc(t,e,r,i){this.p=new n(t,e),this.h=r,this.d=function(t,e){for(var r=!1,i=1/0,n=0;n<e.length;n++)for(var o=e[n],a=0,s=o.length,l=s-1;a<s;l=a++){var c=o[a],u=o[l];c.y>t.y!=u.y>t.y&&t.x<(u.x-c.x)*(t.y-c.y)/(u.y-c.y)+c.x&&(r=!r),i=Math.min(i,Yo(t,c,u))}return(r?1:-1)*Math.sqrt(i)}(this.p,i),this.max=this.d+this.h*Math.SQRT2}ec.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},ec.prototype.pop=function(){if(0!==this.length){var t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}},ec.prototype.peek=function(){return this.data[0]},ec.prototype._up=function(t){for(var e=this.data,r=this.compare,i=e[t];t>0;){var n=t-1>>1,o=e[n];if(r(i,o)>=0)break;e[t]=o,t=n}e[t]=i},ec.prototype._down=function(t){for(var e=this.data,r=this.compare,i=this.length>>1,n=e[t];t<i;){var o=1+(t<<1),a=e[o],s=o+1;if(s<this.length&&r(e[s],a)<0&&(o=s,a=e[s]),r(a,n)>=0)break;e[t]=a,t=o}e[t]=n};var ac=Number.POSITIVE_INFINITY;function sc(t,e){return e[1]!==ac?function(t,e,r){var i=0,n=0;switch(e=Math.abs(e),r=Math.abs(r),t){case"top-right":case"top-left":case"top":n=r-7;break;case"bottom-right":case"bottom-left":case"bottom":n=7-r}switch(t){case"top-right":case"bottom-right":case"right":i=-e;break;case"top-left":case"bottom-left":case"left":i=e}return[i,n]}(t,e[0],e[1]):function(t,e){var r=0,i=0;e<0&&(e=0);var n=e/Math.sqrt(2);switch(t){case"top-right":case"top-left":i=n-7;break;case"bottom-right":case"bottom-left":i=7-n;break;case"bottom":i=7-e;break;case"top":i=e-7}switch(t){case"top-right":case"bottom-right":r=-n;break;case"top-left":case"bottom-left":r=n;break;case"left":r=e;break;case"right":r=-e}return[r,i]}(t,e[0])}function lc(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function cc(t,e,r,i,o,a,s,l,c,u,h,A,p,d,f){var m=function(t,e,r,i,o,a,s,l){for(var c=i.layout.get("text-rotate").evaluate(a,{})*Math.PI/180,u=[],h=0,A=e.positionedLines;h<A.length;h+=1)for(var p=A[h],d=0,f=p.positionedGlyphs;d<f.length;d+=1){var m=f[d];if(m.rect){var g=m.rect||{},_=4,y=!0,v=1,x=0,w=(o||l)&&m.vertical,b=m.metrics.advance*m.scale/2;if(l&&e.verticalizable&&(x=p.lineOffset/2-(m.imageName?-(24-m.metrics.width*m.scale)/2:24*(m.scale-1))),m.imageName){var B=s[m.imageName];y=B.sdf,_=1/(v=B.pixelRatio)}var C=o?[m.x+b,m.y]:[0,0],E=o?[0,0]:[m.x+b+r[0],m.y+r[1]-x],T=[0,0];w&&(T=E,E=[0,0]);var I=(m.metrics.left-_)*m.scale-b+E[0],S=(-m.metrics.top-_)*m.scale+E[1],M=I+g.w*m.scale/v,F=S+g.h*m.scale/v,P=new n(I,S),L=new n(M,S),D=new n(I,F),U=new n(M,F);if(w){var k=new n(-b,b- -17),z=-Math.PI/2,R=12-b,O=new n(22-R,-(m.imageName?R:0)),Q=new(Function.prototype.bind.apply(n,[null].concat(T)));P._rotateAround(z,k)._add(O)._add(Q),L._rotateAround(z,k)._add(O)._add(Q),D._rotateAround(z,k)._add(O)._add(Q),U._rotateAround(z,k)._add(O)._add(Q)}if(c){var N=Math.sin(c),V=Math.cos(c),H=[V,-N,N,V];P._matMult(H),L._matMult(H),D._matMult(H),U._matMult(H)}var j=new n(0,0),G=new n(0,0);u.push({tl:P,tr:L,bl:D,br:U,tex:g,writingMode:e.writingMode,glyphOffset:C,sectionIndex:m.sectionIndex,isSDF:y,pixelOffsetTL:j,pixelOffsetBR:G,minFontScaleX:0,minFontScaleY:0})}}return u}(0,r,l,o,a,s,i,t.allowVerticalPlacement),g=t.textSizeData,_=null;"source"===g.kind?(_=[128*o.layout.get("text-size").evaluate(s,{})])[0]>32640&&b(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):"composite"===g.kind&&((_=[128*d.compositeTextSizes[0].evaluate(s,{},f),128*d.compositeTextSizes[1].evaluate(s,{},f)])[0]>32640||_[1]>32640)&&b(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,m,_,l,a,s,u,e,c.lineStartIndex,c.lineLength,p,f);for(var y=0,v=h;y<v.length;y+=1)A[v[y]]=t.text.placedSymbolArray.length-1;return 4*m.length}function uc(t){for(var e in t)return t[e];return null}function hc(t,e,r,i){var n=t.compareText;if(e in n){for(var o=n[e],a=o.length-1;a>=0;a--)if(i.dist(o[a])<r)return!0}else n[e]=[];return n[e].push(i),!1}var Ac=ws.VectorTileFeature.types,pc=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function dc(t,e,r,i,n,o,a,s,l,c,u,h,A){var p=s?Math.min(32640,Math.round(s[0])):0,d=s?Math.min(32640,Math.round(s[1])):0;t.emplaceBack(e,r,Math.round(32*i),Math.round(32*n),o,a,(p<<1)+(l?1:0),d,16*c,16*u,256*h,256*A)}function fc(t,e,r){t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r)}function mc(t){for(var e=0,r=t.sections;e<r.length;e+=1)if($i(r[e].text))return!0;return!1}var gc=function(t){this.layoutVertexArray=new Un,this.indexArray=new Vn,this.programConfigurations=t,this.segments=new lo,this.dynamicLayoutVertexArray=new kn,this.opacityVertexArray=new zn,this.placedSymbolArray=new to};gc.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length},gc.prototype.upload=function(t,e,r,i){this.isEmpty()||(r&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Hs.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,js.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,pc,!0),this.opacityVertexBuffer.itemSize=1),(r||i)&&this.programConfigurations.upload(t))},gc.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Ri("SymbolBuffers",gc);var _c=function(t,e,r){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new r,this.segments=new lo,this.collisionVertexArray=new Nn};_c.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Gs.members,!0)},_c.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Ri("CollisionBuffers",_c);var yc=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=la([]),this.placementViewportMatrix=la([]);var e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Rl(this.zoom,e["text-size"]),this.iconSizeData=Rl(this.zoom,e["icon-size"]);var r=this.layers[0].layout,i=r.get("symbol-sort-key"),n=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==n&&void 0!==i.constantOr(1),this.sortFeaturesByY=("viewport-y"===n||"auto"===n&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===r.get("symbol-placement")&&(this.writingModes=r.get("text-writing-mode").map((function(t){return bl[t]}))),this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id})),this.sourceID=t.sourceID};yc.prototype.createArrays=function(){this.text=new gc(new ko(this.layers,this.zoom,(function(t){return/^text/.test(t)}))),this.icon=new gc(new ko(this.layers,this.zoom,(function(t){return/^icon/.test(t)}))),this.glyphOffsetArray=new io,this.lineVertexArray=new no,this.symbolInstances=new ro},yc.prototype.calculateGlyphDependencies=function(t,e,r,i,n){for(var o=0;o<t.length;o++)if(e[t.charCodeAt(o)]=!0,(r||i)&&n){var a=Ws[t.charAt(o)];a&&(e[a.charCodeAt(0)]=!0)}},yc.prototype.populate=function(t,e,r){var i=this.layers[0],n=i.layout,o=n.get("text-font"),a=n.get("text-field"),s=n.get("icon-image"),l=("constant"!==a.value.kind||a.value.value instanceof ie&&!a.value.value.isEmpty()||a.value.value.toString().length>0)&&("constant"!==o.value.kind||o.value.value.length>0),c="constant"!==s.value.kind||!!s.value.value||Object.keys(s.parameters).length>0,u=n.get("symbol-sort-key");if(this.features=[],l||c){for(var h=e.iconDependencies,A=e.glyphDependencies,p=e.availableImages,d=new ln(this.zoom),f=0,m=t;f<m.length;f+=1){var g=m[f],_=g.feature,y=g.id,v=g.index,x=g.sourceLayerIndex,w=i._featureFilter.needGeometry,b=Vo(_,w);if(i._featureFilter.filter(d,b,r)){w||(b.geometry=No(_));var B=void 0;if(l){var C=i.getValueAndResolveTokens("text-field",b,r,p),E=ie.factory(C);mc(E)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===on()||this.hasRTLText&&sn.isParsed())&&(B=Zs(E,i,b))}var T=void 0;if(c){var I=i.getValueAndResolveTokens("icon-image",b,r,p);T=I instanceof ne?I:ne.fromString(I)}if(B||T){var S=this.sortFeaturesByKey?u.evaluate(b,{},r):void 0;if(this.features.push({id:y,text:B,icon:T,index:v,sourceLayerIndex:x,geometry:b.geometry,properties:_.properties,type:Ac[_.type],sortKey:S}),T&&(h[T.name]=!0),B){var M=o.evaluate(b,{},r).join(","),F="map"===n.get("text-rotation-alignment")&&"point"!==n.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(bl.vertical)>=0;for(var P=0,L=B.sections;P<L.length;P+=1){var D=L[P];if(D.image)h[D.image.name]=!0;else{var U=Ki(B.toString()),k=D.fontStack||M,z=A[k]=A[k]||{};this.calculateGlyphDependencies(D.text,z,F,this.allowVerticalPlacement,U)}}}}}}"line"===n.get("symbol-placement")&&(this.features=function(t){var e={},r={},i=[],n=0;function o(e){i.push(t[e]),n++}function a(t,e,n){var o=r[t];return delete r[t],r[e]=o,i[o].geometry[0].pop(),i[o].geometry[0]=i[o].geometry[0].concat(n[0]),o}function s(t,r,n){var o=e[r];return delete e[r],e[t]=o,i[o].geometry[0].shift(),i[o].geometry[0]=n[0].concat(i[o].geometry[0]),o}function l(t,e,r){var i=r?e[0][e[0].length-1]:e[0][0];return t+":"+i.x+":"+i.y}for(var c=0;c<t.length;c++){var u=t[c],h=u.geometry,A=u.text?u.text.toString():null;if(A){var p=l(A,h),d=l(A,h,!0);if(p in r&&d in e&&r[p]!==e[d]){var f=s(p,d,h),m=a(p,d,i[f].geometry);delete e[p],delete r[d],r[l(A,i[m].geometry,!0)]=m,i[f].geometry=null}else p in r?a(p,d,h):d in e?s(p,d,h):(o(c),e[p]=n-1,r[d]=n-1)}else o(c)}return i.filter((function(t){return t.geometry}))}(this.features)),this.sortFeaturesByKey&&this.features.sort((function(t,e){return t.sortKey-e.sortKey}))}},yc.prototype.update=function(t,e,r){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,r),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,r))},yc.prototype.isEmpty=function(){return 0===this.symbolInstances.length&&!this.hasRTLText},yc.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},yc.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},yc.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},yc.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},yc.prototype.addToLineVertexArray=function(t,e){var r=this.lineVertexArray.length;if(void 0!==t.segment){for(var i=t.dist(e[t.segment+1]),n=t.dist(e[t.segment]),o={},a=t.segment+1;a<e.length;a++)o[a]={x:e[a].x,y:e[a].y,tileUnitDistanceFromAnchor:i},a<e.length-1&&(i+=e[a+1].dist(e[a]));for(var s=t.segment||0;s>=0;s--)o[s]={x:e[s].x,y:e[s].y,tileUnitDistanceFromAnchor:n},s>0&&(n+=e[s-1].dist(e[s]));for(var l=0;l<e.length;l++){var c=o[l];this.lineVertexArray.emplaceBack(c.x,c.y,c.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}},yc.prototype.addSymbols=function(t,e,r,i,n,o,a,s,l,c,u,h){for(var A=t.indexArray,p=t.layoutVertexArray,d=t.segments.prepareSegment(4*e.length,p,A,this.canOverlap?o.sortKey:void 0),f=this.glyphOffsetArray.length,m=d.vertexLength,g=this.allowVerticalPlacement&&a===bl.vertical?Math.PI/2:0,_=o.text&&o.text.sections,y=0;y<e.length;y++){var v=e[y],x=v.tl,w=v.tr,b=v.bl,B=v.br,C=v.tex,E=v.pixelOffsetTL,T=v.pixelOffsetBR,I=v.minFontScaleX,S=v.minFontScaleY,M=v.glyphOffset,F=v.isSDF,P=v.sectionIndex,L=d.vertexLength,D=M[1];dc(p,s.x,s.y,x.x,D+x.y,C.x,C.y,r,F,E.x,E.y,I,S),dc(p,s.x,s.y,w.x,D+w.y,C.x+C.w,C.y,r,F,T.x,E.y,I,S),dc(p,s.x,s.y,b.x,D+b.y,C.x,C.y+C.h,r,F,E.x,T.y,I,S),dc(p,s.x,s.y,B.x,D+B.y,C.x+C.w,C.y+C.h,r,F,T.x,T.y,I,S),fc(t.dynamicLayoutVertexArray,s,g),A.emplaceBack(L,L+1,L+2),A.emplaceBack(L+1,L+2,L+3),d.vertexLength+=4,d.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(M[0]),y!==e.length-1&&P===e[y+1].sectionIndex||t.programConfigurations.populatePaintArrays(p.length,o,o.index,{},h,_&&_[P])}t.placedSymbolArray.emplaceBack(s.x,s.y,f,this.glyphOffsetArray.length-f,m,l,c,s.segment,r?r[0]:0,r?r[1]:0,i[0],i[1],a,0,!1,0,u)},yc.prototype._addCollisionDebugVertex=function(t,e,r,i,n,o){return e.emplaceBack(0,0),t.emplaceBack(r.x,r.y,i,n,Math.round(o.x),Math.round(o.y))},yc.prototype.addCollisionDebugVertices=function(t,e,r,i,o,a,s){var l=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),c=l.vertexLength,u=o.layoutVertexArray,h=o.collisionVertexArray,A=s.anchorX,p=s.anchorY;this._addCollisionDebugVertex(u,h,a,A,p,new n(t,e)),this._addCollisionDebugVertex(u,h,a,A,p,new n(r,e)),this._addCollisionDebugVertex(u,h,a,A,p,new n(r,i)),this._addCollisionDebugVertex(u,h,a,A,p,new n(t,i)),l.vertexLength+=4;var d=o.indexArray;d.emplaceBack(c,c+1),d.emplaceBack(c+1,c+2),d.emplaceBack(c+2,c+3),d.emplaceBack(c+3,c),l.primitiveLength+=4},yc.prototype.addDebugCollisionBoxes=function(t,e,r,i){for(var n=t;n<e;n++){var o=this.collisionBoxArray.get(n);this.addCollisionDebugVertices(o.x1,o.y1,o.x2,o.y2,i?this.textCollisionBox:this.iconCollisionBox,o.anchorPoint,r)}},yc.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new _c(On,Ks.members,Zn),this.iconCollisionBox=new _c(On,Ks.members,Zn);for(var t=0;t<this.symbolInstances.length;t++){var e=this.symbolInstances.get(t);this.addDebugCollisionBoxes(e.textBoxStartIndex,e.textBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.verticalTextBoxStartIndex,e.verticalTextBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.iconBoxStartIndex,e.iconBoxEndIndex,e,!1),this.addDebugCollisionBoxes(e.verticalIconBoxStartIndex,e.verticalIconBoxEndIndex,e,!1)}},yc.prototype._deserializeCollisionBoxesForSymbol=function(t,e,r,i,n,o,a,s,l){for(var c={},u=e;u<r;u++){var h=t.get(u);c.textBox={x1:h.x1,y1:h.y1,x2:h.x2,y2:h.y2,anchorPointX:h.anchorPointX,anchorPointY:h.anchorPointY},c.textFeatureIndex=h.featureIndex;break}for(var A=i;A<n;A++){var p=t.get(A);c.verticalTextBox={x1:p.x1,y1:p.y1,x2:p.x2,y2:p.y2,anchorPointX:p.anchorPointX,anchorPointY:p.anchorPointY},c.verticalTextFeatureIndex=p.featureIndex;break}for(var d=o;d<a;d++){var f=t.get(d);c.iconBox={x1:f.x1,y1:f.y1,x2:f.x2,y2:f.y2,anchorPointX:f.anchorPointX,anchorPointY:f.anchorPointY},c.iconFeatureIndex=f.featureIndex;break}for(var m=s;m<l;m++){var g=t.get(m);c.verticalIconBox={x1:g.x1,y1:g.y1,x2:g.x2,y2:g.y2,anchorPointX:g.anchorPointX,anchorPointY:g.anchorPointY},c.verticalIconFeatureIndex=g.featureIndex;break}return c},yc.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var e=0;e<this.symbolInstances.length;e++){var r=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}},yc.prototype.hasTextData=function(){return this.text.segments.get().length>0},yc.prototype.hasIconData=function(){return this.icon.segments.get().length>0},yc.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},yc.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},yc.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},yc.prototype.addIndicesForPlacedSymbol=function(t,e){for(var r=t.placedSymbolArray.get(e),i=r.vertexStartIndex+4*r.numGlyphs,n=r.vertexStartIndex;n<i;n+=4)t.indexArray.emplaceBack(n,n+1,n+2),t.indexArray.emplaceBack(n+1,n+2,n+3)},yc.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;for(var e=Math.sin(t),r=Math.cos(t),i=[],n=[],o=[],a=0;a<this.symbolInstances.length;++a){o.push(a);var s=this.symbolInstances.get(a);i.push(0|Math.round(e*s.anchorX+r*s.anchorY)),n.push(s.featureIndex)}return o.sort((function(t,e){return i[t]-i[e]||n[e]-n[t]})),o},yc.prototype.addToSortKeyRanges=function(t,e){var r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===e?r.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1})},yc.prototype.sortFeatures=function(t){var e=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var r=0,i=this.symbolInstanceIndexes;r<i.length;r+=1){var n=this.symbolInstances.get(i[r]);this.featureSortOrder.push(n.featureIndex),[n.rightJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.leftJustifiedTextSymbolIndex].forEach((function(t,r,i){t>=0&&i.indexOf(t)===r&&e.addIndicesForPlacedSymbol(e.text,t)})),n.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,n.verticalPlacedTextSymbolIndex),n.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.placedIconSymbolIndex),n.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Ri("SymbolBucket",yc,{omit:["layers","collisionBoxArray","features","compareText"]}),yc.MAX_GLYPHS=65535,yc.addDynamicAttributes=fc;var vc=new wn({"symbol-placement":new gn(St.layout_symbol["symbol-placement"]),"symbol-spacing":new gn(St.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new gn(St.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new _n(St.layout_symbol["symbol-sort-key"]),"symbol-z-order":new gn(St.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new gn(St.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new gn(St.layout_symbol["icon-ignore-placement"]),"icon-optional":new gn(St.layout_symbol["icon-optional"]),"icon-rotation-alignment":new gn(St.layout_symbol["icon-rotation-alignment"]),"icon-size":new _n(St.layout_symbol["icon-size"]),"icon-text-fit":new gn(St.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new gn(St.layout_symbol["icon-text-fit-padding"]),"icon-image":new _n(St.layout_symbol["icon-image"]),"icon-rotate":new _n(St.layout_symbol["icon-rotate"]),"icon-padding":new gn(St.layout_symbol["icon-padding"]),"icon-keep-upright":new gn(St.layout_symbol["icon-keep-upright"]),"icon-offset":new _n(St.layout_symbol["icon-offset"]),"icon-anchor":new _n(St.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new gn(St.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new gn(St.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new gn(St.layout_symbol["text-rotation-alignment"]),"text-field":new _n(St.layout_symbol["text-field"]),"text-font":new _n(St.layout_symbol["text-font"]),"text-size":new _n(St.layout_symbol["text-size"]),"text-max-width":new _n(St.layout_symbol["text-max-width"]),"text-line-height":new gn(St.layout_symbol["text-line-height"]),"text-letter-spacing":new _n(St.layout_symbol["text-letter-spacing"]),"text-justify":new _n(St.layout_symbol["text-justify"]),"text-radial-offset":new _n(St.layout_symbol["text-radial-offset"]),"text-variable-anchor":new gn(St.layout_symbol["text-variable-anchor"]),"text-anchor":new _n(St.layout_symbol["text-anchor"]),"text-max-angle":new gn(St.layout_symbol["text-max-angle"]),"text-writing-mode":new gn(St.layout_symbol["text-writing-mode"]),"text-rotate":new _n(St.layout_symbol["text-rotate"]),"text-padding":new gn(St.layout_symbol["text-padding"]),"text-keep-upright":new gn(St.layout_symbol["text-keep-upright"]),"text-transform":new _n(St.layout_symbol["text-transform"]),"text-offset":new _n(St.layout_symbol["text-offset"]),"text-allow-overlap":new gn(St.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new gn(St.layout_symbol["text-ignore-placement"]),"text-optional":new gn(St.layout_symbol["text-optional"])}),xc={paint:new wn({"icon-opacity":new _n(St.paint_symbol["icon-opacity"]),"icon-color":new _n(St.paint_symbol["icon-color"]),"icon-halo-color":new _n(St.paint_symbol["icon-halo-color"]),"icon-halo-width":new _n(St.paint_symbol["icon-halo-width"]),"icon-halo-blur":new _n(St.paint_symbol["icon-halo-blur"]),"icon-translate":new gn(St.paint_symbol["icon-translate"]),"icon-translate-anchor":new gn(St.paint_symbol["icon-translate-anchor"]),"text-opacity":new _n(St.paint_symbol["text-opacity"]),"text-color":new _n(St.paint_symbol["text-color"],{runtimeType:Nt,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new _n(St.paint_symbol["text-halo-color"]),"text-halo-width":new _n(St.paint_symbol["text-halo-width"]),"text-halo-blur":new _n(St.paint_symbol["text-halo-blur"]),"text-translate":new gn(St.paint_symbol["text-translate"]),"text-translate-anchor":new gn(St.paint_symbol["text-translate-anchor"])}),layout:vc},wc=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:zt,this.defaultValue=t};wc.prototype.evaluate=function(t){if(t.formattedSection){var e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},wc.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},wc.prototype.outputDefined=function(){return!1},wc.prototype.serialize=function(){return null},Ri("FormatSectionOverride",wc,{omit:["defaultValue"]});var bc=function(t){function e(e){t.call(this,e,xc)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.recalculate=function(e,r){if(t.prototype.recalculate.call(this,e,r),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){var i=this.layout.get("text-writing-mode");if(i){for(var n=[],o=0,a=i;o<a.length;o+=1){var s=a[o];n.indexOf(s)<0&&n.push(s)}this.layout._values["text-writing-mode"]=n}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},e.prototype.getValueAndResolveTokens=function(t,e,r,i){var n=this.layout.get(t).evaluate(e,{},r,i),o=this._unevaluatedLayout._values[t];return o.isDataDriven()||Kr(o.value)||!n?n:function(t,e){return e.replace(/{([^{}]+)}/g,(function(e,r){return r in t?String(t[r]):""}))}(e.properties,n)},e.prototype.createBucket=function(t){return new yc(t)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype._setPaintOverrides=function(){for(var t=0,r=xc.paint.overridableProperties;t<r.length;t+=1){var i=r[t];if(e.hasPaintOverride(this.layout,i)){var n,o=this.paint.get(i),a=new wc(o),s=new Gr(a,o.property.specification);n="constant"===o.value.kind||"source"===o.value.kind?new Zr("source",s):new Wr("composite",s,o.value.zoomStops,o.value._interpolationType),this.paint._values[i]=new fn(o.property,n,o.parameters)}}},e.prototype._handleOverridablePaintPropertyUpdate=function(t,r,i){return!(!this.layout||r.isDataDriven()||i.isDataDriven())&&e.hasPaintOverride(this.layout,t)},e.hasPaintOverride=function(t,e){var r=t.get("text-field"),i=xc.paint.properties[e],n=!1,o=function(t){for(var e=0,r=t;e<r.length;e+=1)if(i.overrides&&i.overrides.hasOverride(r[e]))return void(n=!0)};if("constant"===r.value.kind&&r.value.value instanceof ie)o(r.value.value.sections);else if("source"===r.value.kind){var a=function t(e){n||(e instanceof ce&&se(e.value)===Gt?o(e.value.sections):e instanceof pe?o(e.sections):e.eachChild(t))},s=r.value;s._styleExpression&&a(s._styleExpression.expression)}return n},e}(bn),Bc={paint:new wn({"background-color":new gn(St.paint_background["background-color"]),"background-pattern":new vn(St.paint_background["background-pattern"]),"background-opacity":new gn(St.paint_background["background-opacity"])})},Cc=function(t){function e(e){t.call(this,e,Bc)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(bn),Ec={paint:new wn({"raster-opacity":new gn(St.paint_raster["raster-opacity"]),"raster-hue-rotate":new gn(St.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new gn(St.paint_raster["raster-brightness-min"]),"raster-brightness-max":new gn(St.paint_raster["raster-brightness-max"]),"raster-saturation":new gn(St.paint_raster["raster-saturation"]),"raster-contrast":new gn(St.paint_raster["raster-contrast"]),"raster-resampling":new gn(St.paint_raster["raster-resampling"]),"raster-fade-duration":new gn(St.paint_raster["raster-fade-duration"])})},Tc=function(t){function e(e){t.call(this,e,Ec)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(bn),Ic=function(t){function e(e){t.call(this,e,{}),this.implementation=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.is3D=function(){return"3d"===this.implementation.renderingMode},e.prototype.hasOffscreenPass=function(){return void 0!==this.implementation.prerender},e.prototype.recalculate=function(){},e.prototype.updateTransitions=function(){},e.prototype.hasTransition=function(){},e.prototype.serialize=function(){},e.prototype.onAdd=function(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)},e.prototype.onRemove=function(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)},e}(bn),Sc={circle:da,heatmap:Ba,hillshade:Ea,fill:As,"fill-extrusion":Ss,line:Ns,symbol:bc,background:Cc,raster:Tc},Mc=a.HTMLImageElement,Fc=a.HTMLCanvasElement,Pc=a.HTMLVideoElement,Lc=a.ImageData,Dc=a.ImageBitmap,Uc=function(t,e,r,i){this.context=t,this.format=r,this.texture=t.gl.createTexture(),this.update(e,i)};Uc.prototype.update=function(t,e,r){var i=t.width,n=t.height,o=!(this.size&&this.size[0]===i&&this.size[1]===n||r),a=this.context,s=a.gl;if(this.useMipmap=Boolean(e&&e.useMipmap),s.bindTexture(s.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!e||!1!==e.premultiply)),o)this.size=[i,n],t instanceof Mc||t instanceof Fc||t instanceof Pc||t instanceof Lc||Dc&&t instanceof Dc?s.texImage2D(s.TEXTURE_2D,0,this.format,this.format,s.UNSIGNED_BYTE,t):s.texImage2D(s.TEXTURE_2D,0,this.format,i,n,0,this.format,s.UNSIGNED_BYTE,t.data);else{var l=r||{x:0,y:0},c=l.x,u=l.y;t instanceof Mc||t instanceof Fc||t instanceof Pc||t instanceof Lc||Dc&&t instanceof Dc?s.texSubImage2D(s.TEXTURE_2D,0,c,u,s.RGBA,s.UNSIGNED_BYTE,t):s.texSubImage2D(s.TEXTURE_2D,0,c,u,i,n,s.RGBA,s.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&s.generateMipmap(s.TEXTURE_2D)},Uc.prototype.bind=function(t,e,r){var i=this.context.gl;i.bindTexture(i.TEXTURE_2D,this.texture),r!==i.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(r=i.LINEAR),t!==this.filter&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,r||t),this.filter=t),e!==this.wrap&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,e),this.wrap=e)},Uc.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Uc.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var kc=function(t){var e=this;this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){e._triggered=!1,e._callback()})};kc.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((function(){t._triggered=!1,t._callback()}),0))},kc.prototype.remove=function(){delete this._channel,this._callback=function(){}};var zc=function(t,e,r){this.target=t,this.parent=e,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},g(["receive","process"],this),this.invoker=new kc(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=E()?t:a};function Rc(t,e,r){var i=2*Math.PI*6378137/256/Math.pow(2,r);return[t*i-2*Math.PI*6378137/2,e*i-2*Math.PI*6378137/2]}zc.prototype.send=function(t,e,r,i,n){var o=this;void 0===n&&(n=!1);var a=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[a]=r);var s=S(this.globalScope)?void 0:[];return this.target.postMessage({id:a,type:t,hasCallback:!!r,targetMapId:i,mustQueue:n,sourceMapId:this.mapId,data:Vi(e,s)},s),{cancel:function(){r&&delete o.callbacks[a],o.target.postMessage({id:a,type:"<cancel>",targetMapId:i,sourceMapId:o.mapId})}}},zc.prototype.receive=function(t){var e=t.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){delete this.tasks[r];var i=this.cancelCallbacks[r];delete this.cancelCallbacks[r],i&&i()}else E()||e.mustQueue?(this.tasks[r]=e,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,e)},zc.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),e=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(t,e)}},zc.prototype.processTask=function(t,e){var r=this;if("<response>"===e.type){var i=this.callbacks[t];delete this.callbacks[t],i&&(e.error?i(Hi(e.error)):i(null,Hi(e.data)))}else{var n=!1,o=S(this.globalScope)?void 0:[],a=e.hasCallback?function(e,i){n=!0,delete r.cancelCallbacks[t],r.target.postMessage({id:t,type:"<response>",sourceMapId:r.mapId,error:e?Vi(e):null,data:Vi(i,o)},o)}:function(t){n=!0},s=null,l=Hi(e.data);if(this.parent[e.type])s=this.parent[e.type](e.sourceMapId,l,a);else if(this.parent.getWorkerSource){var c=e.type.split(".");s=this.parent.getWorkerSource(e.sourceMapId,c[0],l.source)[c[1]](l,a)}else a(new Error("Could not find function "+e.type));!n&&s&&s.cancel&&(this.cancelCallbacks[t]=s.cancel)}},zc.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Oc=function(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};Oc.prototype.setNorthEast=function(t){return this._ne=t instanceof Qc?new Qc(t.lng,t.lat):Qc.convert(t),this},Oc.prototype.setSouthWest=function(t){return this._sw=t instanceof Qc?new Qc(t.lng,t.lat):Qc.convert(t),this},Oc.prototype.extend=function(t){var e,r,i=this._sw,n=this._ne;if(t instanceof Qc)e=t,r=t;else{if(!(t instanceof Oc))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(Oc.convert(t)):this.extend(Qc.convert(t)):this;if(r=t._ne,!(e=t._sw)||!r)return this}return i||n?(i.lng=Math.min(e.lng,i.lng),i.lat=Math.min(e.lat,i.lat),n.lng=Math.max(r.lng,n.lng),n.lat=Math.max(r.lat,n.lat)):(this._sw=new Qc(e.lng,e.lat),this._ne=new Qc(r.lng,r.lat)),this},Oc.prototype.getCenter=function(){return new Qc((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Oc.prototype.getSouthWest=function(){return this._sw},Oc.prototype.getNorthEast=function(){return this._ne},Oc.prototype.getNorthWest=function(){return new Qc(this.getWest(),this.getNorth())},Oc.prototype.getSouthEast=function(){return new Qc(this.getEast(),this.getSouth())},Oc.prototype.getWest=function(){return this._sw.lng},Oc.prototype.getSouth=function(){return this._sw.lat},Oc.prototype.getEast=function(){return this._ne.lng},Oc.prototype.getNorth=function(){return this._ne.lat},Oc.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Oc.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Oc.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Oc.prototype.contains=function(t){var e=Qc.convert(t),r=e.lng,i=e.lat,n=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(n=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=i&&i<=this._ne.lat&&n},Oc.convert=function(t){return!t||t instanceof Oc?t:new Oc(t)};var Qc=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: ("+t+", "+e+")");if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Qc.prototype.wrap=function(){return new Qc(h(this.lng,-180,180),this.lat)},Qc.prototype.toArray=function(){return[this.lng,this.lat]},Qc.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Qc.prototype.distanceTo=function(t){var e=Math.PI/180,r=this.lat*e,i=t.lat*e,n=Math.sin(r)*Math.sin(i)+Math.cos(r)*Math.cos(i)*Math.cos((t.lng-this.lng)*e);return 6371008.8*Math.acos(Math.min(n,1))},Qc.prototype.toBounds=function(t){void 0===t&&(t=0);var e=360*t/40075017,r=e/Math.cos(Math.PI/180*this.lat);return new Oc(new Qc(this.lng-r,this.lat-e),new Qc(this.lng+r,this.lat+e))},Qc.convert=function(t){if(t instanceof Qc)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new Qc(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==Ze(t)&&null!==t)return new Qc(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Nc=2*Math.PI*6371008.8;function Vc(t){return Nc*Math.cos(t*Math.PI/180)}function Hc(t){return(180+t)/360}function jc(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Gc(t,e){return t/Vc(e)}function Kc(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var qc=function(t,e,r){void 0===r&&(r=0),this.x=+t,this.y=+e,this.z=+r};qc.fromLngLat=function(t,e){void 0===e&&(e=0);var r=Qc.convert(t);return new qc(Hc(r.lng),jc(r.lat),Gc(e,r.lat))},qc.prototype.toLngLat=function(){return new Qc(360*this.x-180,Kc(this.y))},qc.prototype.toAltitude=function(){return this.z*Vc(Kc(this.y))},qc.prototype.meterInMercatorCoordinateUnits=function(){return 1/Nc*(t=Kc(this.y),1/Math.cos(t*Math.PI/180));var t};var Zc=function(t,e,r){this.z=t,this.x=e,this.y=r,this.key=$c(0,t,t,e,r)};Zc.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},Zc.prototype.url=function(t,e){var r,i,n,o,a,s=(i=this.y,n=this.z,o=Rc(256*(r=this.x),256*(i=Math.pow(2,n)-i-1),n),a=Rc(256*(r+1),256*(i+1),n),o[0]+","+o[1]+","+a[0]+","+a[1]),l=function(t,e,r){for(var i,n="",o=t;o>0;o--)n+=(e&(i=1<<o-1)?1:0)+(r&i?2:0);return n}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",s)},Zc.prototype.getTilePoint=function(t){var e=Math.pow(2,this.z);return new n(8192*(t.x*e-this.x),8192*(t.y*e-this.y))},Zc.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Wc=function(t,e){this.wrap=t,this.canonical=e,this.key=$c(t,e.z,e.z,e.x,e.y)},Xc=function(t,e,r,i,n){this.overscaledZ=t,this.wrap=e,this.canonical=new Zc(r,+i,+n),this.key=$c(e,t,r,i,n)};function $c(t,e,r,i,n){(t*=2)<0&&(t=-1*t-1);var o=1<<r;return(o*o*t+o*n+i).toString(36)+r.toString(36)+e.toString(36)}Xc.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},Xc.prototype.scaledTo=function(t){var e=this.canonical.z-t;return t>this.canonical.z?new Xc(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Xc(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)},Xc.prototype.calculateScaledKey=function(t,e){var r=this.canonical.z-t;return t>this.canonical.z?$c(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y):$c(this.wrap*+e,t,t,this.canonical.x>>r,this.canonical.y>>r)},Xc.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e},Xc.prototype.children=function(t){if(this.overscaledZ>=t)return[new Xc(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var e=this.canonical.z+1,r=2*this.canonical.x,i=2*this.canonical.y;return[new Xc(e,this.wrap,e,r,i),new Xc(e,this.wrap,e,r+1,i),new Xc(e,this.wrap,e,r,i+1),new Xc(e,this.wrap,e,r+1,i+1)]},Xc.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},Xc.prototype.wrapped=function(){return new Xc(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Xc.prototype.unwrapTo=function(t){return new Xc(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},Xc.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Xc.prototype.toUnwrapped=function(){return new Wc(this.wrap,this.canonical)},Xc.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Xc.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new qc(t.x-this.wrap,t.y))},Ri("CanonicalTileID",Zc),Ri("OverscaledTileID",Xc,{omit:["posMatrix"]});var Yc=function(t,e,r){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(r&&"mapbox"!==r&&"terrarium"!==r)return b('"'+r+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=e.height;var i=this.dim=e.height-2;this.data=new Uint32Array(e.data.buffer),this.encoding=r||"mapbox";for(var n=0;n<i;n++)this.data[this._idx(-1,n)]=this.data[this._idx(0,n)],this.data[this._idx(i,n)]=this.data[this._idx(i-1,n)],this.data[this._idx(n,-1)]=this.data[this._idx(n,0)],this.data[this._idx(n,i)]=this.data[this._idx(n,i-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(i,-1)]=this.data[this._idx(i-1,0)],this.data[this._idx(-1,i)]=this.data[this._idx(0,i-1)],this.data[this._idx(i,i)]=this.data[this._idx(i-1,i-1)]};Yc.prototype.get=function(t,e){var r=new Uint8Array(this.data.buffer),i=4*this._idx(t,e);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(r[i],r[i+1],r[i+2])},Yc.prototype.getUnpackVector=function(){return"terrarium"===this.encoding?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Yc.prototype._idx=function(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)},Yc.prototype._unpackMapbox=function(t,e,r){return(256*t*256+256*e+r)/10-1e4},Yc.prototype._unpackTerrarium=function(t,e,r){return 256*t+e+r/256-32768},Yc.prototype.getPixels=function(){return new xa({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Yc.prototype.backfillBorder=function(t,e,r){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var i=e*this.dim,n=e*this.dim+this.dim,o=r*this.dim,a=r*this.dim+this.dim;switch(e){case-1:i=n-1;break;case 1:n=i+1}switch(r){case-1:o=a-1;break;case 1:a=o+1}for(var s=-e*this.dim,l=-r*this.dim,c=o;c<a;c++)for(var u=i;u<n;u++)this.data[this._idx(u,c)]=t.data[this._idx(u+s,c+l)]},Ri("DEMData",Yc);var Jc=function(t){this._stringToNumber={},this._numberToString=[];for(var e=0;e<t.length;e++){var r=t[e];this._stringToNumber[r]=e,this._numberToString[e]=r}};Jc.prototype.encode=function(t){return this._stringToNumber[t]},Jc.prototype.decode=function(t){return this._numberToString[t]};var tu=function(t,e,r,i,n){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=r,t._y=i,this.properties=t.properties,this.id=n},eu={geometry:{configurable:!0}};eu.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},eu.geometry.set=function(t){this._geometry=t},tu.prototype.toJSON=function(){var t={geometry:this.geometry};for(var e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t},Object.defineProperties(tu.prototype,eu);var ru=function(){this.state={},this.stateChanges={},this.deletedStates={}};ru.prototype.updateState=function(t,e,r){var i=String(e);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][i]=this.stateChanges[t][i]||{},A(this.stateChanges[t][i],r),null===this.deletedStates[t])for(var n in this.deletedStates[t]={},this.state[t])n!==i&&(this.deletedStates[t][n]=null);else if(this.deletedStates[t]&&null===this.deletedStates[t][i])for(var o in this.deletedStates[t][i]={},this.state[t][i])r[o]||(this.deletedStates[t][i][o]=null);else for(var a in r)this.deletedStates[t]&&this.deletedStates[t][i]&&null===this.deletedStates[t][i][a]&&delete this.deletedStates[t][i][a]},ru.prototype.removeFeatureState=function(t,e,r){if(null!==this.deletedStates[t]){var i=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},r&&void 0!==e)null!==this.deletedStates[t][i]&&(this.deletedStates[t][i]=this.deletedStates[t][i]||{},this.deletedStates[t][i][r]=null);else if(void 0!==e)if(this.stateChanges[t]&&this.stateChanges[t][i])for(r in this.deletedStates[t][i]={},this.stateChanges[t][i])this.deletedStates[t][i][r]=null;else this.deletedStates[t][i]=null;else this.deletedStates[t]=null}},ru.prototype.getState=function(t,e){var r=String(e),i=A({},(this.state[t]||{})[r],(this.stateChanges[t]||{})[r]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){var n=this.deletedStates[t][e];if(null===n)return{};for(var o in n)delete i[o]}return i},ru.prototype.initializeTileState=function(t,e){t.setFeatureState(this.state,e)},ru.prototype.coalesceChanges=function(t,e){var r={};for(var i in this.stateChanges){this.state[i]=this.state[i]||{};var n={};for(var o in this.stateChanges[i])this.state[i][o]||(this.state[i][o]={}),A(this.state[i][o],this.stateChanges[i][o]),n[o]=this.state[i][o];r[i]=n}for(var a in this.deletedStates){this.state[a]=this.state[a]||{};var s={};if(null===this.deletedStates[a])for(var l in this.state[a])s[l]={},this.state[a][l]={};else for(var c in this.deletedStates[a]){if(null===this.deletedStates[a][c])this.state[a][c]={};else for(var u=0,h=Object.keys(this.deletedStates[a][c]);u<h.length;u+=1)delete this.state[a][c][h[u]];s[c]=this.state[a][c]}r[a]=r[a]||{},A(r[a],s)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(r).length)for(var p in t)t[p].setFeatureState(r,e)};var iu=function(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Li(8192,16,0),this.grid3D=new Li(8192,16,0),this.featureIndexArray=new ao,this.promoteId=e};function nu(t,e,r,i,n){return y(t,(function(t,o){var a=e instanceof mn?e.get(o):null;return a&&a.evaluate?a.evaluate(r,i,n):a}))}function ou(t){for(var e=1/0,r=1/0,i=-1/0,n=-1/0,o=0,a=t;o<a.length;o+=1){var s=a[o];e=Math.min(e,s.x),r=Math.min(r,s.y),i=Math.max(i,s.x),n=Math.max(n,s.y)}return{minX:e,minY:r,maxX:i,maxY:n}}function au(t,e){return e-t}iu.prototype.insert=function(t,e,r,i,n,o){var a=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,i,n);for(var s=o?this.grid3D:this.grid,l=0;l<e.length;l++){for(var c=e[l],u=[1/0,1/0,-1/0,-1/0],h=0;h<c.length;h++){var A=c[h];u[0]=Math.min(u[0],A.x),u[1]=Math.min(u[1],A.y),u[2]=Math.max(u[2],A.x),u[3]=Math.max(u[3],A.y)}u[0]<8192&&u[1]<8192&&u[2]>=0&&u[3]>=0&&s.insert(a,u[0],u[1],u[2],u[3])}},iu.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new ws.VectorTile(new Ys(this.rawTileData)).layers,this.sourceLayerCoder=new Jc(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},iu.prototype.query=function(t,e,r,i){var o=this;this.loadVTLayers();for(var a=t.params||{},s=8192/t.tileSize/t.scale,l=ai(a.filter),c=t.queryGeometry,u=t.queryPadding*s,h=ou(c),A=this.grid.query(h.minX-u,h.minY-u,h.maxX+u,h.maxY+u),p=ou(t.cameraQueryGeometry),d=0,f=this.grid3D.query(p.minX-u,p.minY-u,p.maxX+u,p.maxY+u,(function(e,r,i,o){return function(t,e,r,i,o){for(var a=0,s=t;a<s.length;a+=1){var l=s[a];if(e<=l.x&&r<=l.y&&i>=l.x&&o>=l.y)return!0}var c=[new n(e,r),new n(e,o),new n(i,o),new n(i,r)];if(t.length>2)for(var u=0,h=c;u<h.length;u+=1)if(ta(t,h[u]))return!0;for(var A=0;A<t.length-1;A++)if(ea(t[A],t[A+1],c))return!0;return!1}(t.cameraQueryGeometry,e-u,r-u,i+u,o+u)}));d<f.length;d+=1)A.push(f[d]);A.sort(au);for(var m,g={},_=function(n){var u=A[n];if(u!==m){m=u;var h=o.featureIndexArray.get(u),p=null;o.loadMatchingFeature(g,h.bucketIndex,h.sourceLayerIndex,h.featureIndex,l,a.layers,a.availableImages,e,r,i,(function(e,r,i){return p||(p=No(e)),r.queryIntersectsFeature(c,e,i,p,o.z,t.transform,s,t.pixelPosMatrix)}))}},y=0;y<A.length;y++)_(y);return g},iu.prototype.loadMatchingFeature=function(t,e,r,i,n,o,a,s,l,c,u){var h=this.bucketLayerIDs[e];if(!o||function(t,e){for(var r=0;r<t.length;r++)if(e.indexOf(t[r])>=0)return!0;return!1}(o,h)){var p=this.sourceLayerCoder.decode(r),d=this.vtLayers[p].feature(i);if(n.needGeometry){var f=Vo(d,!0);if(!n.filter(new ln(this.tileID.overscaledZ),f,this.tileID.canonical))return}else if(!n.filter(new ln(this.tileID.overscaledZ),d))return;for(var m=this.getId(d,p),g=0;g<h.length;g++){var _=h[g];if(!(o&&o.indexOf(_)<0)){var y=s[_];if(y){var v={};void 0!==m&&c&&(v=c.getState(y.sourceLayer||"_geojsonTileLayer",m));var x=A({},l[_]);x.paint=nu(x.paint,y.paint,d,v,a),x.layout=nu(x.layout,y.layout,d,v,a);var w=!u||u(d,y,v);if(w){var b=new tu(d,this.z,this.x,this.y,m);b.layer=x;var B=t[_];void 0===B&&(B=t[_]=[]),B.push({featureIndex:i,feature:b,intersectionZ:w})}}}}}},iu.prototype.lookupSymbolFeatures=function(t,e,r,i,n,o,a,s){var l={};this.loadVTLayers();for(var c=ai(n),u=0,h=t;u<h.length;u+=1)this.loadMatchingFeature(l,r,i,h[u],c,o,a,s,e);return l},iu.prototype.hasLayer=function(t){for(var e=0,r=this.bucketLayerIDs;e<r.length;e+=1)for(var i=0,n=r[e];i<n.length;i+=1)if(t===n[i])return!0;return!1},iu.prototype.getId=function(t,e){var r=t.id;return this.promoteId&&"boolean"==typeof(r=t.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[e]])&&(r=Number(r)),r},Ri("FeatureIndex",iu,{omit:["rawTileData","sourceLayerCoder"]});var su=function(t,e){this.tileID=t,this.uid=d(),this.uses=0,this.tileSize=e,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};su.prototype.registerFadeDuration=function(t){var e=t+this.timeAdded;e<R.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e)},su.prototype.wasRequested=function(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state},su.prototype.loadVectorData=function(t,e,r){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var i in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,e){var r={};if(!e)return r;for(var i=function(){var t=o[n],i=t.layerIds.map((function(t){return e.getLayer(t)})).filter(Boolean);if(0!==i.length){t.layers=i,t.stateDependentLayerIds&&(t.stateDependentLayers=t.stateDependentLayerIds.map((function(t){return i.filter((function(e){return e.id===t}))[0]})));for(var a=0,s=i;a<s.length;a+=1)r[s[a].id]=t}},n=0,o=t;n<o.length;n+=1)i();return r}(t.buckets,e.style),this.hasSymbolBuckets=!1,this.buckets){var n=this.buckets[i];if(n instanceof yc){if(this.hasSymbolBuckets=!0,!r)break;n.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var o in this.buckets){var a=this.buckets[o];if(a instanceof yc&&a.hasRTLText){this.hasRTLText=!0,sn.isLoading()||sn.isLoaded()||"deferred"!==on()||an();break}}for(var s in this.queryPadding=0,this.buckets){var l=this.buckets[s];this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(s).queryRadius(l))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new Yn},su.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},su.prototype.getBucket=function(t){return this.buckets[t.id]},su.prototype.upload=function(t){for(var e in this.buckets){var r=this.buckets[e];r.uploadPending()&&r.upload(t)}var i=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Uc(t,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Uc(t,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null)},su.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},su.prototype.queryRenderedFeatures=function(t,e,r,i,n,o,a,s,l,c){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:i,cameraQueryGeometry:n,scale:o,tileSize:this.tileSize,pixelPosMatrix:c,transform:s,params:a,queryPadding:this.queryPadding*l},t,e,r):{}},su.prototype.querySourceFeatures=function(t,e){var r=this.latestFeatureIndex;if(r&&r.rawTileData){var i=r.loadVTLayers(),n=e?e.sourceLayer:"",o=i._geojsonTileLayer||i[n];if(o)for(var a=ai(e&&e.filter),s=this.tileID.canonical,l=s.z,c=s.x,u=s.y,h={z:l,x:c,y:u},A=0;A<o.length;A++){var p=o.feature(A);if(a.needGeometry){var d=Vo(p,!0);if(!a.filter(new ln(this.tileID.overscaledZ),d,this.tileID.canonical))continue}else if(!a.filter(new ln(this.tileID.overscaledZ),p))continue;var f=r.getId(p,n),m=new tu(p,l,c,u,f);m.tile=h,t.push(m)}}},su.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},su.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},su.prototype.setExpiryData=function(t){var e=this.expirationTime;if(t.cacheControl){var r=T(t.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var i=Date.now(),n=!1;if(this.expirationTime>i)n=!1;else if(e)if(this.expirationTime<e)n=!0;else{var o=this.expirationTime-e;o?this.expirationTime=i+Math.max(o,3e4):n=!0}else n=!0;n?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},su.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)},su.prototype.setFeatureState=function(t,e){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(t).length){var r=this.latestFeatureIndex.loadVTLayers();for(var i in this.buckets)if(e.style.hasLayer(i)){var n=this.buckets[i],o=n.layers[0].sourceLayer||"_geojsonTileLayer",a=r[o],s=t[o];if(a&&s&&0!==Object.keys(s).length){n.update(s,a,this.imageAtlas&&this.imageAtlas.patternPositions||{});var l=e&&e.style&&e.style.getLayer(i);l&&(this.queryPadding=Math.max(this.queryPadding,l.queryRadius(n)))}}}},su.prototype.holdingForFade=function(){return void 0!==this.symbolFadeHoldUntil},su.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<R.now()},su.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},su.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=R.now()+t},su.prototype.setDependencies=function(t,e){for(var r={},i=0,n=e;i<n.length;i+=1)r[n[i]]=!0;this.dependencies[t]=r},su.prototype.hasDependency=function(t,e){for(var r=0,i=t;r<i.length;r+=1){var n=this.dependencies[i[r]];if(n)for(var o=0,a=e;o<a.length;o+=1)if(n[a[o]])return!0}return!1};var lu=a.performance,cu=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},lu.mark(this._marks.start)};cu.prototype.finish=function(){lu.mark(this._marks.end);var t=lu.getEntriesByName(this._marks.measure);return 0===t.length&&(lu.measure(this._marks.measure,this._marks.start,this._marks.end),t=lu.getEntriesByName(this._marks.measure),lu.clearMarks(this._marks.start),lu.clearMarks(this._marks.end),lu.clearMeasures(this._marks.measure)),t},t.Actor=zc,t.AlphaImage=va,t.CanonicalTileID=Zc,t.CollisionBoxArray=Yn,t.Color=te,t.DEMData=Yc,t.DataConstantProperty=gn,t.DictionaryCoder=Jc,t.EXTENT=8192,t.ErrorEvent=Tt,t.EvaluationParameters=ln,t.Event=Et,t.Evented=It,t.FeatureIndex=iu,t.FillBucket=cs,t.FillExtrusionBucket=Es,t.ImageAtlas=wl,t.ImagePosition=vl,t.LineBucket=zs,t.LngLat=Qc,t.LngLatBounds=Oc,t.MercatorCoordinate=qc,t.ONE_EM=24,t.OverscaledTileID=Xc,t.Point=n,t.Point$1=n,t.Properties=wn,t.Protobuf=Ys,t.RGBAImage=xa,t.RequestManager=G,t.RequestPerformance=cu,t.ResourceType=dt,t.SegmentVector=lo,t.SourceFeatureState=ru,t.StructArrayLayout1ui2=Wn,t.StructArrayLayout2f1f2i16=Qn,t.StructArrayLayout2i4=Sn,t.StructArrayLayout3ui6=Vn,t.StructArrayLayout4i8=Mn,t.SymbolBucket=yc,t.Texture=Uc,t.Tile=su,t.Transitionable=hn,t.Uniform1f=wo,t.Uniform1i=xo,t.Uniform2f=bo,t.Uniform3f=Bo,t.Uniform4f=Co,t.UniformColor=Eo,t.UniformMatrix4f=Io,t.UnwrappedTileID=Wc,t.ValidationError=Mt,t.WritingMode=bl,t.ZoomHistory=ji,t.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t},t.addDynamicAttributes=fc,t.asyncAll=function(t,e,r){if(!t.length)return r(null,[]);var i=t.length,n=new Array(t.length),o=null;t.forEach((function(t,a){e(t,(function(t,e){t&&(o=t),n[a]=e,0==--i&&r(o,n)}))}))},t.bezier=l,t.bindAll=g,t.browser=R,t.cacheEntryPossiblyAdded=function(t){++At>lt&&(t.getActor().send("enforceCacheSizeLimit",st),At=0)},t.clamp=u,t.clearTileCache=function(t){var e=a.caches.delete("mapbox-tiles");t&&e.catch(t).then((function(){return t()}))},t.clipLine=Zl,t.clone=function(t){var e=new sa(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.clone$1=x,t.clone$2=function(t){var e=new sa(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},t.collisionCircleLayout=qs,t.config=O,t.create=function(){var t=new sa(16);return sa!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},t.create$1=function(){var t=new sa(9);return sa!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},t.create$2=function(){var t=new sa(4);return sa!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},t.createCommonjsModule=e,t.createExpression=qr,t.createLayout=Tn,t.createStyleLayer=function(t){return"custom"===t.type?new Ic(t):new Sc[t.type](t)},t.cross=function(t,e,r){var i=e[0],n=e[1],o=e[2],a=r[0],s=r[1],l=r[2];return t[0]=n*l-o*s,t[1]=o*a-i*l,t[2]=i*s-n*a,t},t.deepEqual=function t(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(var i=0;i<e.length;i++)if(!t(e[i],r[i]))return!1;return!0}if("object"==Ze(e)&&null!==e&&null!==r){if("object"!=Ze(r))return!1;if(Object.keys(e).length!==Object.keys(r).length)return!1;for(var n in e)if(!t(e[n],r[n]))return!1;return!0}return e===r},t.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},t.dot$1=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},t.ease=c,t.emitValidationErrors=Pi,t.endsWith=_,t.enforceCacheSizeLimit=function(t){ct(),tt&&tt.then((function(e){e.keys().then((function(r){for(var i=0;i<r.length-t;i++)e.delete(r[i])}))}))},t.evaluateSizeForFeature=Ol,t.evaluateSizeForZoom=Ql,t.evaluateVariableOffset=sc,t.evented=nn,t.extend=A,t.featureFilter=ai,t.filterObject=v,t.fromRotation=function(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=-r,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},t.getAnchorAlignment=Dl,t.getAnchorJustification=lc,t.getArrayBuffer=vt,t.getImage=bt,t.getJSON=function(t,e){return yt(A(t,{type:"json"}),e)},t.getRTLTextPluginStatus=on,t.getReferrer=_t,t.getVideo=function(t,e){var r,i,n=a.document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(var o=0;o<t.length;o++){var s=a.document.createElement("source");r=t[o],i=void 0,(i=a.document.createElement("a")).href=r,(i.protocol!==a.document.location.protocol||i.host!==a.document.location.host)&&(n.crossOrigin="Anonymous"),s.src=t[o],n.appendChild(s)}return{cancel:function(){}}},t.identity=la,t.invert=function(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],a=e[4],s=e[5],l=e[6],c=e[7],u=e[8],h=e[9],A=e[10],p=e[11],d=e[12],f=e[13],m=e[14],g=e[15],_=r*s-i*a,y=r*l-n*a,v=r*c-o*a,x=i*l-n*s,w=i*c-o*s,b=n*c-o*l,B=u*f-h*d,C=u*m-A*d,E=u*g-p*d,T=h*m-A*f,I=h*g-p*f,S=A*g-p*m,M=_*S-y*I+v*T+x*E-w*C+b*B;return M?(t[0]=(s*S-l*I+c*T)*(M=1/M),t[1]=(n*I-i*S-o*T)*M,t[2]=(f*b-m*w+g*x)*M,t[3]=(A*w-h*b-p*x)*M,t[4]=(l*E-a*S-c*C)*M,t[5]=(r*S-n*E+o*C)*M,t[6]=(m*v-d*b-g*y)*M,t[7]=(u*b-A*v+p*y)*M,t[8]=(a*I-s*E+c*B)*M,t[9]=(i*E-r*I-o*B)*M,t[10]=(d*w-f*v+g*_)*M,t[11]=(h*v-u*w-p*_)*M,t[12]=(s*C-a*T-l*B)*M,t[13]=(r*T-i*C+n*B)*M,t[14]=(f*y-d*x-m*_)*M,t[15]=(u*x-h*y+A*_)*M,t):null},t.isChar=Gi,t.isMapboxURL=K,t.keysDifference=function(t,e){var r=[];for(var i in t)i in e||r.push(i);return r},t.makeRequest=yt,t.mapObject=y,t.mercatorXfromLng=Hc,t.mercatorYfromLat=jc,t.mercatorZfromAltitude=Gc,t.mul=Aa,t.multiply=ca,t.mvt=ws,t.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},t.normalize=function(t,e){var r=e[0],i=e[1],n=e[2],o=r*r+i*i+n*n;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t},t.number=je,t.offscreenCanvasSupported=pt,t.ortho=function(t,e,r,i,n,o,a){var s=1/(e-r),l=1/(i-n),c=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+r)*s,t[13]=(n+i)*l,t[14]=(a+o)*c,t[15]=1,t},t.parseGlyphPBF=function(t){return new Ys(t).readFields(ml,[])},t.pbf=Ys,t.performSymbolLayout=function(t,e,r,i,n,o,a){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var s=t.layers[0].layout,l=t.layers[0]._unevaluatedLayout._values,c={};if("composite"===t.textSizeData.kind){var u=t.textSizeData,h=u.maxZoom;c.compositeTextSizes=[l["text-size"].possiblyEvaluate(new ln(u.minZoom),a),l["text-size"].possiblyEvaluate(new ln(h),a)]}if("composite"===t.iconSizeData.kind){var A=t.iconSizeData,p=A.maxZoom;c.compositeIconSizes=[l["icon-size"].possiblyEvaluate(new ln(A.minZoom),a),l["icon-size"].possiblyEvaluate(new ln(p),a)]}c.layoutTextSize=l["text-size"].possiblyEvaluate(new ln(t.zoom+1),a),c.layoutIconSize=l["icon-size"].possiblyEvaluate(new ln(t.zoom+1),a),c.textMaxSize=l["text-size"].possiblyEvaluate(new ln(18));for(var d=24*s.get("text-line-height"),f="map"===s.get("text-rotation-alignment")&&"point"!==s.get("symbol-placement"),m=s.get("text-keep-upright"),g=s.get("text-size"),_=function(){var o=v[y],l=s.get("text-font").evaluate(o,{},a).join(","),u=g.evaluate(o,{},a),h=c.layoutTextSize.evaluate(o,{},a),A=c.layoutIconSize.evaluate(o,{},a),p={horizontal:{},vertical:void 0},_=o.text,x=[0,0];if(_){var w=_.toString(),B=24*s.get("text-letter-spacing").evaluate(o,{},a),C=function(t){for(var e=0,r=t;e<r.length;e+=1)if(i=r[e].charCodeAt(0),Gi.Arabic(i)||Gi["Arabic Supplement"](i)||Gi["Arabic Extended-A"](i)||Gi["Arabic Presentation Forms-A"](i)||Gi["Arabic Presentation Forms-B"](i))return!1;var i;return!0}(w)?B:0,E=s.get("text-anchor").evaluate(o,{},a),T=s.get("text-variable-anchor");if(!T){var I=s.get("text-radial-offset").evaluate(o,{},a);x=I?sc(E,[24*I,ac]):s.get("text-offset").evaluate(o,{},a).map((function(t){return 24*t}))}var S=f?"center":s.get("text-justify").evaluate(o,{},a),M=s.get("symbol-placement"),F="point"===M?24*s.get("text-max-width").evaluate(o,{},a):0,P=function(){t.allowVerticalPlacement&&Ki(w)&&(p.vertical=El(_,e,r,n,l,F,d,E,"left",C,x,bl.vertical,!0,M,h,u))};if(!f&&T){for(var L="auto"===S?T.map((function(t){return lc(t)})):[S],D=!1,U=0;U<L.length;U++){var k=L[U];if(!p.horizontal[k])if(D)p.horizontal[k]=p.horizontal[0];else{var z=El(_,e,r,n,l,F,d,"center",k,C,x,bl.horizontal,!1,M,h,u);z&&(p.horizontal[k]=z,D=1===z.positionedLines.length)}}P()}else{"auto"===S&&(S=lc(E));var R=El(_,e,r,n,l,F,d,E,S,C,x,bl.horizontal,!1,M,h,u);R&&(p.horizontal[S]=R),P(),Ki(w)&&f&&m&&(p.vertical=El(_,e,r,n,l,F,d,E,S,C,x,bl.vertical,!1,M,h,u))}}var O,Q,N,V,H,j,G=void 0,K=!1;if(o.icon&&o.icon.name){var q=i[o.icon.name];q&&(O=n[o.icon.name],Q=s.get("icon-offset").evaluate(o,{},a),N=s.get("icon-anchor").evaluate(o,{},a),V=Dl(N),H=Q[0]-O.displaySize[0]*V.horizontalAlign,j=Q[1]-O.displaySize[1]*V.verticalAlign,G={image:O,top:j,bottom:j+O.displaySize[1],left:H,right:H+O.displaySize[0]},K=q.sdf,void 0===t.sdfIcons?t.sdfIcons=q.sdf:t.sdfIcons!==q.sdf&&b("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(q.pixelRatio!==t.pixelRatio||0!==s.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}var Z=uc(p.horizontal)||p.vertical;t.iconsInText=!!Z&&Z.iconsInText,(Z||G)&&function(t,e,r,i,n,o,a,s,l,c,u){var h=o.textMaxSize.evaluate(e,{});void 0===h&&(h=a);var A,p=t.layers[0].layout,d=p.get("icon-offset").evaluate(e,{},u),f=uc(r.horizontal),m=a/24,g=t.tilePixelRatio*m,_=t.tilePixelRatio*h/24,y=t.tilePixelRatio*s,v=t.tilePixelRatio*p.get("symbol-spacing"),x=p.get("text-padding")*t.tilePixelRatio,w=p.get("icon-padding")*t.tilePixelRatio,B=p.get("text-max-angle")/180*Math.PI,C="map"===p.get("text-rotation-alignment")&&"point"!==p.get("symbol-placement"),E="map"===p.get("icon-rotation-alignment")&&"point"!==p.get("symbol-placement"),T=p.get("symbol-placement"),I=v/2,S=p.get("icon-text-fit");i&&"none"!==S&&(t.allowVerticalPlacement&&r.vertical&&(A=kl(i,r.vertical,S,p.get("icon-text-fit-padding"),d,m)),f&&(i=kl(i,f,S,p.get("icon-text-fit-padding"),d,m)));var M=function(s,h){h.x<0||h.x>=8192||h.y<0||h.y>=8192||function(t,e,r,i,n,o,a,s,l,c,u,h,A,p,d,f,m,g,_,y,v,x,w,B,C){var E,T,I,S,M,F=t.addToLineVertexArray(e,r),P=0,L=0,D=0,U=0,k=-1,z=-1,R={},O=po(""),Q=0,N=0;if(void 0===s._unevaluatedLayout.getValue("text-radial-offset")?(Q=(E=s.layout.get("text-offset").evaluate(v,{},B).map((function(t){return 24*t})))[0],N=E[1]):(Q=24*s.layout.get("text-radial-offset").evaluate(v,{},B),N=ac),t.allowVerticalPlacement&&i.vertical){var V=s.layout.get("text-rotate").evaluate(v,{},B)+90;S=new tc(l,e,c,u,h,i.vertical,A,p,d,V),a&&(M=new tc(l,e,c,u,h,a,m,g,d,V))}if(n){var H=s.layout.get("icon-rotate").evaluate(v,{}),j="none"!==s.layout.get("icon-text-fit"),G=Wl(n,H,w,j),K=a?Wl(a,H,w,j):void 0;I=new tc(l,e,c,u,h,n,m,g,!1,H),P=4*G.length;var q=t.iconSizeData,Z=null;"source"===q.kind?(Z=[128*s.layout.get("icon-size").evaluate(v,{})])[0]>32640&&b(t.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):"composite"===q.kind&&((Z=[128*x.compositeIconSizes[0].evaluate(v,{},B),128*x.compositeIconSizes[1].evaluate(v,{},B)])[0]>32640||Z[1]>32640)&&b(t.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),t.addSymbols(t.icon,G,Z,y,_,v,!1,e,F.lineStartIndex,F.lineLength,-1,B),k=t.icon.placedSymbolArray.length-1,K&&(L=4*K.length,t.addSymbols(t.icon,K,Z,y,_,v,bl.vertical,e,F.lineStartIndex,F.lineLength,-1,B),z=t.icon.placedSymbolArray.length-1)}for(var W in i.horizontal){var X=i.horizontal[W];if(!T){O=po(X.text);var $=s.layout.get("text-rotate").evaluate(v,{},B);T=new tc(l,e,c,u,h,X,A,p,d,$)}var Y=1===X.positionedLines.length;if(D+=cc(t,e,X,o,s,d,v,f,F,i.vertical?bl.horizontal:bl.horizontalOnly,Y?Object.keys(i.horizontal):[W],R,k,x,B),Y)break}i.vertical&&(U+=cc(t,e,i.vertical,o,s,d,v,f,F,bl.vertical,["vertical"],R,z,x,B));var J=T?T.boxStartIndex:t.collisionBoxArray.length,tt=T?T.boxEndIndex:t.collisionBoxArray.length,et=S?S.boxStartIndex:t.collisionBoxArray.length,rt=S?S.boxEndIndex:t.collisionBoxArray.length,it=I?I.boxStartIndex:t.collisionBoxArray.length,nt=I?I.boxEndIndex:t.collisionBoxArray.length,ot=M?M.boxStartIndex:t.collisionBoxArray.length,at=M?M.boxEndIndex:t.collisionBoxArray.length,st=-1,lt=function(t,e){return t&&t.circleDiameter?Math.max(t.circleDiameter,e):e};st=lt(T,st),st=lt(S,st),st=lt(I,st);var ct=(st=lt(M,st))>-1?1:0;ct&&(st*=C/24),t.glyphOffsetArray.length>=yc.MAX_GLYPHS&&b("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==v.sortKey&&t.addToSortKeyRanges(t.symbolInstances.length,v.sortKey),t.symbolInstances.emplaceBack(e.x,e.y,R.right>=0?R.right:-1,R.center>=0?R.center:-1,R.left>=0?R.left:-1,R.vertical||-1,k,z,O,J,tt,et,rt,it,nt,ot,at,c,D,U,P,L,ct,0,A,Q,N,st)}(t,h,s,r,i,n,A,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,g,x,C,l,y,w,E,d,e,o,c,u,a)};if("line"===T)for(var F=0,P=Zl(e.geometry,0,0,8192,8192);F<P.length;F+=1)for(var L=P[F],D=0,U=ql(L,v,B,r.vertical||f,i,24,_,t.overscaling,8192);D<U.length;D+=1){var k=U[D];f&&hc(t,f.text,I,k)||M(L,k)}else if("line-center"===T)for(var z=0,R=e.geometry;z<R.length;z+=1){var O=R[z];if(O.length>1){var Q=Kl(O,B,r.vertical||f,i,24,_);Q&&M(O,Q)}}else if("Polygon"===e.type)for(var N=0,V=os(e.geometry,0);N<V.length;N+=1){var H=V[N],j=ic(H,16);M(H[0],new zl(j.x,j.y,0))}else if("LineString"===e.type)for(var G=0,K=e.geometry;G<K.length;G+=1){var q=K[G];M(q,new zl(q[0].x,q[0].y,0))}else if("Point"===e.type)for(var Z=0,W=e.geometry;Z<W.length;Z+=1)for(var X=0,$=W[Z];X<$.length;X+=1){var Y=$[X];M([Y],new zl(Y.x,Y.y,0))}}(t,o,p,G,i,c,h,A,x,K,a)},y=0,v=t.features;y<v.length;y+=1)_();o&&t.generateCollisionDebugBuffers()},t.perspective=function(t,e,r,i,n){var o,a=1/Math.tan(e/2);return t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(t[10]=(n+i)*(o=1/(i-n)),t[14]=2*n*i*o):(t[10]=-1,t[14]=-2*i),t},t.pick=function(t,e){for(var r={},i=0;i<e.length;i++){var n=e[i];n in t&&(r[n]=t[n])}return r},t.plugin=sn,t.polygonIntersectsPolygon=Go,t.postMapLoadEvent=at,t.postTurnstileEvent=nt,t.potpack=yl,t.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.register=Ri,t.registerForPluginStateChange=function(t){return t({pluginStatus:Ji,pluginURL:tn}),nn.on("pluginStateChange",t),t},t.renderColorRamp=ba,t.rotate=function(t,e,r){var i=e[0],n=e[1],o=e[2],a=e[3],s=Math.sin(r),l=Math.cos(r);return t[0]=i*l+o*s,t[1]=n*l+a*s,t[2]=i*-s+o*l,t[3]=n*-s+a*l,t},t.rotateX=function(t,e,r){var i=Math.sin(r),n=Math.cos(r),o=e[4],a=e[5],s=e[6],l=e[7],c=e[8],u=e[9],h=e[10],A=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*n+c*i,t[5]=a*n+u*i,t[6]=s*n+h*i,t[7]=l*n+A*i,t[8]=c*n-o*i,t[9]=u*n-a*i,t[10]=h*n-s*i,t[11]=A*n-l*i,t},t.rotateZ=function(t,e,r){var i=Math.sin(r),n=Math.cos(r),o=e[0],a=e[1],s=e[2],l=e[3],c=e[4],u=e[5],h=e[6],A=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*n+c*i,t[1]=a*n+u*i,t[2]=s*n+h*i,t[3]=l*n+A*i,t[4]=c*n-o*i,t[5]=u*n-a*i,t[6]=h*n-s*i,t[7]=A*n-l*i,t},t.scale=function(t,e,r){var i=r[0],n=r[1],o=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.scale$1=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},t.scale$2=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},t.setCacheLimits=function(t,e){st=t,lt=e},t.setRTLTextPlugin=function(t,e,r){if(void 0===r&&(r=!1),"deferred"===Ji||"loading"===Ji||"loaded"===Ji)throw new Error("setRTLTextPlugin cannot be called multiple times.");tn=R.resolveURL(t),Ji="deferred",Yi=e,rn(),r||an()},t.sphericalToCartesian=function(t){var e=t[0],r=t[1],i=t[2];return r+=90,r*=Math.PI/180,i*=Math.PI/180,{x:e*Math.cos(r)*Math.sin(i),y:e*Math.sin(r)*Math.sin(i),z:e*Math.cos(i)}},t.sqrLen=function(t){var e=t[0],r=t[1];return e*e+r*r},t.styleSpec=St,t.sub=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t},t.symbolSize=Nl,t.transformMat3=function(t,e,r){var i=e[0],n=e[1],o=e[2];return t[0]=i*r[0]+n*r[3]+o*r[6],t[1]=i*r[1]+n*r[4]+o*r[7],t[2]=i*r[2]+n*r[5]+o*r[8],t},t.transformMat4=pa,t.translate=function(t,e,r){var i,n,o,a,s,l,c,u,h,A,p,d,f=r[0],m=r[1],g=r[2];return e===t?(t[12]=e[0]*f+e[4]*m+e[8]*g+e[12],t[13]=e[1]*f+e[5]*m+e[9]*g+e[13],t[14]=e[2]*f+e[6]*m+e[10]*g+e[14],t[15]=e[3]*f+e[7]*m+e[11]*g+e[15]):(n=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=e[6],u=e[7],h=e[8],A=e[9],p=e[10],d=e[11],t[0]=i=e[0],t[1]=n,t[2]=o,t[3]=a,t[4]=s,t[5]=l,t[6]=c,t[7]=u,t[8]=h,t[9]=A,t[10]=p,t[11]=d,t[12]=i*f+s*m+h*g+e[12],t[13]=n*f+l*m+A*g+e[13],t[14]=o*f+c*m+p*g+e[14],t[15]=a*f+u*m+d*g+e[15]),t},t.triggerPluginCompletionEvent=en,t.uniqueId=d,t.validateCustomStyleLayer=function(t){var e=[],r=t.id;return void 0===r&&e.push({message:"layers."+r+': missing required property "id"'}),void 0===t.render&&e.push({message:"layers."+r+': missing required method "render"'}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:"layers."+r+': property "renderingMode" must be either "2d" or "3d"'}),e},t.validateLight=Si,t.validateStyle=Ii,t.values=function(t){var e=[];for(var r in t)e.push(t[r]);return e},t.vectorTile=ws,t.version="1.13.2",t.warnOnce=b,t.webpSupported=Q,t.window=a,t.wrap=h})),i(["./shared"],(function(t){function e(t){var r=Ze(t);if("number"===r||"boolean"===r||"string"===r||null==t)return JSON.stringify(t);if(Array.isArray(t)){for(var i="[",n=0,o=t;n<o.length;n+=1)i+=e(o[n])+",";return i+"]"}for(var a=Object.keys(t).sort(),s="{",l=0;l<a.length;l++)s+=JSON.stringify(a[l])+":"+e(t[a[l]])+",";return s+"}"}function r(r){for(var i="",n=0,o=t.refProperties;n<o.length;n+=1)i+="/"+e(r[o[n]]);return i}var i=function(t){this.keyCache={},t&&this.replace(t)};i.prototype.replace=function(t){this._layerConfigs={},this._layers={},this.update(t,[])},i.prototype.update=function(e,i){for(var n=this,o=0,a=e;o<a.length;o+=1){var s=a[o];this._layerConfigs[s.id]=s;var l=this._layers[s.id]=t.createStyleLayer(s);l._featureFilter=t.featureFilter(l.filter),this.keyCache[s.id]&&delete this.keyCache[s.id]}for(var c=0,u=i;c<u.length;c+=1){var h=u[c];delete this.keyCache[h],delete this._layerConfigs[h],delete this._layers[h]}this.familiesBySource={};for(var A=0,p=function(t,e){for(var i={},n=0;n<t.length;n++){var o=e&&e[t[n].id]||r(t[n]);e&&(e[t[n].id]=o);var a=i[o];a||(a=i[o]=[]),a.push(t[n])}var s=[];for(var l in i)s.push(i[l]);return s}(t.values(this._layerConfigs),this.keyCache);A<p.length;A+=1){var d=p[A].map((function(t){return n._layers[t.id]})),f=d[0];if("none"!==f.visibility){var m=f.source||"",g=this.familiesBySource[m];g||(g=this.familiesBySource[m]={});var _=f.sourceLayer||"_geojsonTileLayer",y=g[_];y||(y=g[_]=[]),y.push(d)}}};var n=function(e){var r={},i=[];for(var n in e){var o=e[n],a=r[n]={};for(var s in o){var l=o[+s];if(l&&0!==l.bitmap.width&&0!==l.bitmap.height){var c={x:0,y:0,w:l.bitmap.width+2,h:l.bitmap.height+2};i.push(c),a[s]={rect:c,metrics:l.metrics}}}}var u=t.potpack(i),h=new t.AlphaImage({width:u.w||1,height:u.h||1});for(var A in e){var p=e[A];for(var d in p){var f=p[+d];if(f&&0!==f.bitmap.width&&0!==f.bitmap.height){var m=r[A][d].rect;t.AlphaImage.copy(f.bitmap,h,{x:0,y:0},{x:m.x+1,y:m.y+1},f.bitmap)}}}this.image=h,this.positions=r};t.register("GlyphAtlas",n);var o=function(e){this.tileID=new t.OverscaledTileID(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId};function a(e,r,i){for(var n=new t.EvaluationParameters(r),o=0,a=e;o<a.length;o+=1)a[o].recalculate(n,i)}function s(e,r){var i=t.getArrayBuffer(e.request,(function(e,i,n,o){e?r(e):i&&r(null,{vectorTile:new t.vectorTile.VectorTile(new t.pbf(i)),rawData:i,cacheControl:n,expires:o})}));return function(){i.cancel(),r()}}o.prototype.parse=function(e,r,i,o,s){var l=this;this.status="parsing",this.data=e,this.collisionBoxArray=new t.CollisionBoxArray;var c=new t.DictionaryCoder(Object.keys(e.layers).sort()),u=new t.FeatureIndex(this.tileID,this.promoteId);u.bucketLayerIDs=[];var h,A,p,d,f={},m={featureIndex:u,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:i},g=r.familiesBySource[this.source];for(var _ in g){var y=e.layers[_];if(y){1===y.version&&t.warnOnce('Vector tile source "'+this.source+'" layer "'+_+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var v=c.encode(_),x=[],w=0;w<y.length;w++){var b=y.feature(w),B=u.getId(b,_);x.push({feature:b,id:B,index:w,sourceLayerIndex:v})}for(var C=0,E=g[_];C<E.length;C+=1){var T=E[C],I=T[0];I.minzoom&&this.zoom<Math.floor(I.minzoom)||I.maxzoom&&this.zoom>=I.maxzoom||"none"!==I.visibility&&(a(T,this.zoom,i),(f[I.id]=I.createBucket({index:u.bucketLayerIDs.length,layers:T,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:v,sourceID:this.source})).populate(x,m,this.tileID.canonical),u.bucketLayerIDs.push(T.map((function(t){return t.id}))))}}}var S=t.mapObject(m.glyphDependencies,(function(t){return Object.keys(t).map(Number)}));Object.keys(S).length?o.send("getGlyphs",{uid:this.uid,stacks:S},(function(t,e){h||(h=t,A=e,P.call(l))})):A={};var M=Object.keys(m.iconDependencies);M.length?o.send("getImages",{icons:M,source:this.source,tileID:this.tileID,type:"icons"},(function(t,e){h||(h=t,p=e,P.call(l))})):p={};var F=Object.keys(m.patternDependencies);function P(){if(h)return s(h);if(A&&p&&d){var e=new n(A),r=new t.ImageAtlas(p,d);for(var o in f){var l=f[o];l instanceof t.SymbolBucket?(a(l.layers,this.zoom,i),t.performSymbolLayout(l,A,e.positions,p,r.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):l.hasPattern&&(l instanceof t.LineBucket||l instanceof t.FillBucket||l instanceof t.FillExtrusionBucket)&&(a(l.layers,this.zoom,i),l.addFeatures(m,this.tileID.canonical,r.patternPositions))}this.status="done",s(null,{buckets:t.values(f).filter((function(t){return!t.isEmpty()})),featureIndex:u,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,imageAtlas:r,glyphMap:this.returnDependencies?A:null,iconMap:this.returnDependencies?p:null,glyphPositions:this.returnDependencies?e.positions:null})}}F.length?o.send("getImages",{icons:F,source:this.source,tileID:this.tileID,type:"patterns"},(function(t,e){h||(h=t,d=e,P.call(l))})):d={},P.call(this)};var l=function(t,e,r,i){this.actor=t,this.layerIndex=e,this.availableImages=r,this.loadVectorData=i||s,this.loading={},this.loaded={}};l.prototype.loadTile=function(e,r){var i=this,n=e.uid;this.loading||(this.loading={});var a=!!(e&&e.request&&e.request.collectResourceTiming)&&new t.RequestPerformance(e.request),s=this.loading[n]=new o(e);s.abort=this.loadVectorData(e,(function(e,o){if(delete i.loading[n],e||!o)return s.status="done",i.loaded[n]=s,r(e);var l=o.rawData,c={};o.expires&&(c.expires=o.expires),o.cacheControl&&(c.cacheControl=o.cacheControl);var u={};if(a){var h=a.finish();h&&(u.resourceTiming=JSON.parse(JSON.stringify(h)))}s.vectorTile=o.vectorTile,s.parse(o.vectorTile,i.layerIndex,i.availableImages,i.actor,(function(e,i){if(e||!i)return r(e);r(null,t.extend({rawTileData:l.slice(0)},i,c,u))})),i.loaded=i.loaded||{},i.loaded[n]=s}))},l.prototype.reloadTile=function(t,e){var r=this,i=this.loaded,n=t.uid,o=this;if(i&&i[n]){var a=i[n];a.showCollisionBoxes=t.showCollisionBoxes;var s=function(t,i){var n=a.reloadCallback;n&&(delete a.reloadCallback,a.parse(a.vectorTile,o.layerIndex,r.availableImages,o.actor,n)),e(t,i)};"parsing"===a.status?a.reloadCallback=s:"done"===a.status&&(a.vectorTile?a.parse(a.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}},l.prototype.abortTile=function(t,e){var r=this.loading,i=t.uid;r&&r[i]&&r[i].abort&&(r[i].abort(),delete r[i]),e()},l.prototype.removeTile=function(t,e){var r=this.loaded,i=t.uid;r&&r[i]&&delete r[i],e()};var c=t.window.ImageBitmap,u=function(){this.loaded={}};function h(t,e){if(0!==t.length){A(t[0],e);for(var r=1;r<t.length;r++)A(t[r],!e)}}function A(t,e){for(var r=0,i=0,n=t.length,o=n-1;i<n;o=i++)r+=(t[i][0]-t[o][0])*(t[o][1]+t[i][1]);r>=0!=!!e&&t.reverse()}u.prototype.loadTile=function(e,r){var i=e.uid,n=e.encoding,o=e.rawImageData,a=c&&o instanceof c?this.getImageData(o):o,s=new t.DEMData(i,a,n);this.loaded=this.loaded||{},this.loaded[i]=s,r(null,s)},u.prototype.getImageData=function(e){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);var r=this.offscreenCanvasContext.getImageData(-1,-1,e.width+2,e.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new t.RGBAImage({width:r.width,height:r.height},r.data)},u.prototype.removeTile=function(t){var e=this.loaded,r=t.uid;e&&e[r]&&delete e[r]};var p=t.vectorTile.VectorTileFeature.prototype.toGeoJSON,d=function(e){this._feature=e,this.extent=t.EXTENT,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))};d.prototype.loadGeometry=function(){if(1===this._feature.type){for(var e=[],r=0,i=this._feature.geometry;r<i.length;r+=1){var n=i[r];e.push([new t.Point$1(n[0],n[1])])}return e}for(var o=[],a=0,s=this._feature.geometry;a<s.length;a+=1){for(var l=[],c=0,u=s[a];c<u.length;c+=1){var h=u[c];l.push(new t.Point$1(h[0],h[1]))}o.push(l)}return o},d.prototype.toGeoJSON=function(t,e,r){return p.call(this,t,e,r)};var f=function(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.EXTENT,this.length=e.length,this._features=e};f.prototype.feature=function(t){return new d(this._features[t])};var m=t.vectorTile.VectorTileFeature,g=_;function _(t,e){this.options=e||{},this.features=t,this.length=t.length}function y(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}_.prototype.feature=function(t){return new y(this.features[t],this.options.extent)},y.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var r=0;r<e.length;r++){for(var i=e[r],n=[],o=0;o<i.length;o++)n.push(new t.Point$1(i[o][0],i[o][1]));this.geometry.push(n)}return this.geometry},y.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,r=-1/0,i=1/0,n=-1/0,o=0;o<t.length;o++)for(var a=t[o],s=0;s<a.length;s++){var l=a[s];e=Math.min(e,l.x),r=Math.max(r,l.x),i=Math.min(i,l.y),n=Math.max(n,l.y)}return[e,i,r,n]},y.prototype.toGeoJSON=m.prototype.toGeoJSON;var v=w,x=g;function w(e){var r=new t.pbf;return function(t,e){for(var r in t.layers)e.writeMessage(3,b,t.layers[r])}(e,r),r.finish()}function b(t,e){var r;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var i={keys:[],values:[],keycache:{},valuecache:{}};for(r=0;r<t.length;r++)i.feature=t.feature(r),e.writeMessage(2,B,i);var n=i.keys;for(r=0;r<n.length;r++)e.writeStringField(3,n[r]);var o=i.values;for(r=0;r<o.length;r++)e.writeMessage(4,S,o[r])}function B(t,e){var r=t.feature;void 0!==r.id&&e.writeVarintField(1,r.id),e.writeMessage(2,C,t),e.writeVarintField(3,r.type),e.writeMessage(4,I,r)}function C(t,e){var r=t.feature,i=t.keys,n=t.values,o=t.keycache,a=t.valuecache;for(var s in r.properties){var l=o[s];void 0===l&&(i.push(s),o[s]=l=i.length-1),e.writeVarint(l);var c=r.properties[s],u=Ze(c);"string"!==u&&"boolean"!==u&&"number"!==u&&(c=JSON.stringify(c));var h=u+":"+c,A=a[h];void 0===A&&(n.push(c),a[h]=A=n.length-1),e.writeVarint(A)}}function E(t,e){return(e<<3)+(7&t)}function T(t){return t<<1^t>>31}function I(t,e){for(var r=t.loadGeometry(),i=t.type,n=0,o=0,a=r.length,s=0;s<a;s++){var l=r[s],c=1;1===i&&(c=l.length),e.writeVarint(E(1,c));for(var u=3===i?l.length-1:l.length,h=0;h<u;h++){1===h&&1!==i&&e.writeVarint(E(2,u-1));var A=l[h].x-n,p=l[h].y-o;e.writeVarint(T(A)),e.writeVarint(T(p)),n+=A,o+=p}3===i&&e.writeVarint(E(7,1))}}function S(t,e){var r=Ze(t);"string"===r?e.writeStringField(1,t):"boolean"===r?e.writeBooleanField(7,t):"number"===r&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}function M(t,e,r,i){F(t,r,i),F(e,2*r,2*i),F(e,2*r+1,2*i+1)}function F(t,e,r){var i=t[e];t[e]=t[r],t[r]=i}function P(t,e,r,i){var n=t-r,o=e-i;return n*n+o*o}v.fromVectorTileJs=w,v.fromGeojsonVt=function(t,e){e=e||{};var r={};for(var i in t)r[i]=new g(t[i].features,e),r[i].name=i,r[i].version=e.version,r[i].extent=e.extent;return w({layers:r})},v.GeoJSONWrapper=x;var L=function(t){return t[0]},D=function(t){return t[1]},U=function(t,e,r,i,n){void 0===e&&(e=L),void 0===r&&(r=D),void 0===i&&(i=64),void 0===n&&(n=Float64Array),this.nodeSize=i,this.points=t;for(var o=t.length<65536?Uint16Array:Uint32Array,a=this.ids=new o(t.length),s=this.coords=new n(2*t.length),l=0;l<t.length;l++)a[l]=l,s[2*l]=e(t[l]),s[2*l+1]=r(t[l]);!function t(e,r,i,n,o,a){if(!(o-n<=i)){var s=n+o>>1;!function t(e,r,i,n,o,a){for(;o>n;){if(o-n>600){var s=o-n+1,l=i-n+1,c=Math.log(s),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(s-u)/s)*(l-s/2<0?-1:1);t(e,r,i,Math.max(n,Math.floor(i-l*u/s+h)),Math.min(o,Math.floor(i+(s-l)*u/s+h)),a)}var A=r[2*i+a],p=n,d=o;for(M(e,r,n,i),r[2*o+a]>A&&M(e,r,n,o);p<d;){for(M(e,r,p,d),p++,d--;r[2*p+a]<A;)p++;for(;r[2*d+a]>A;)d--}r[2*n+a]===A?M(e,r,n,d):M(e,r,++d,o),d<=i&&(n=d+1),i<=d&&(o=d-1)}}(e,r,s,n,o,a%2),t(e,r,i,n,s-1,a+1),t(e,r,i,s+1,o,a+1)}}(a,s,i,0,a.length-1,0)};U.prototype.range=function(t,e,r,i){return function(t,e,r,i,n,o,a){for(var s,l,c=[0,t.length-1,0],u=[];c.length;){var h=c.pop(),A=c.pop(),p=c.pop();if(A-p<=a)for(var d=p;d<=A;d++)l=e[2*d+1],(s=e[2*d])>=r&&s<=n&&l>=i&&l<=o&&u.push(t[d]);else{var f=Math.floor((p+A)/2);l=e[2*f+1],(s=e[2*f])>=r&&s<=n&&l>=i&&l<=o&&u.push(t[f]);var m=(h+1)%2;(0===h?r<=s:i<=l)&&(c.push(p),c.push(f-1),c.push(m)),(0===h?n>=s:o>=l)&&(c.push(f+1),c.push(A),c.push(m))}}return u}(this.ids,this.coords,t,e,r,i,this.nodeSize)},U.prototype.within=function(t,e,r){return function(t,e,r,i,n,o){for(var a=[0,t.length-1,0],s=[],l=n*n;a.length;){var c=a.pop(),u=a.pop(),h=a.pop();if(u-h<=o)for(var A=h;A<=u;A++)P(e[2*A],e[2*A+1],r,i)<=l&&s.push(t[A]);else{var p=Math.floor((h+u)/2),d=e[2*p],f=e[2*p+1];P(d,f,r,i)<=l&&s.push(t[p]);var m=(c+1)%2;(0===c?r-n<=d:i-n<=f)&&(a.push(h),a.push(p-1),a.push(m)),(0===c?r+n>=d:i+n>=f)&&(a.push(p+1),a.push(u),a.push(m))}}return s}(this.ids,this.coords,t,e,r,this.nodeSize)};var k={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(t){return t}},z=function(t){this.options=j(Object.create(k),t),this.trees=new Array(this.options.maxZoom+1)};function R(t,e,r,i,n){return{x:t,y:e,zoom:1/0,id:r,parentId:-1,numPoints:i,properties:n}}function O(t,e){var r=t.geometry.coordinates,i=r[1];return{x:V(r[0]),y:H(i),zoom:1/0,index:e,parentId:-1}}function Q(t){return{type:"Feature",id:t.id,properties:N(t),geometry:{type:"Point",coordinates:[(i=t.x,360*(i-.5)),(e=t.y,r=(180-360*e)*Math.PI/180,360*Math.atan(Math.exp(r))/Math.PI-90)]}};var e,r,i}function N(t){var e=t.numPoints,r=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return j(j({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:r})}function V(t){return t/360+.5}function H(t){var e=Math.sin(t*Math.PI/180),r=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return r<0?0:r>1?1:r}function j(t,e){for(var r in e)t[r]=e[r];return t}function G(t){return t.x}function K(t){return t.y}function q(t,e,r,i,n,o){var a=n-r,s=o-i;if(0!==a||0!==s){var l=((t-r)*a+(e-i)*s)/(a*a+s*s);l>1?(r=n,i=o):l>0&&(r+=a*l,i+=s*l)}return(a=t-r)*a+(s=e-i)*s}function Z(t,e,r,i){var n={id:void 0===t?null:t,type:e,geometry:r,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,r=t.type;if("Point"===r||"MultiPoint"===r||"LineString"===r)W(t,e);else if("Polygon"===r||"MultiLineString"===r)for(var i=0;i<e.length;i++)W(t,e[i]);else if("MultiPolygon"===r)for(i=0;i<e.length;i++)for(var n=0;n<e[i].length;n++)W(t,e[i][n])}(n),n}function W(t,e){for(var r=0;r<e.length;r+=3)t.minX=Math.min(t.minX,e[r]),t.minY=Math.min(t.minY,e[r+1]),t.maxX=Math.max(t.maxX,e[r]),t.maxY=Math.max(t.maxY,e[r+1])}function X(t,e,r,i){if(e.geometry){var n=e.geometry.coordinates,o=e.geometry.type,a=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),s=[],l=e.id;if(r.promoteId?l=e.properties[r.promoteId]:r.generateId&&(l=i||0),"Point"===o)$(n,s);else if("MultiPoint"===o)for(var c=0;c<n.length;c++)$(n[c],s);else if("LineString"===o)Y(n,s,a,!1);else if("MultiLineString"===o){if(r.lineMetrics){for(c=0;c<n.length;c++)Y(n[c],s=[],a,!1),t.push(Z(l,"LineString",s,e.properties));return}J(n,s,a,!1)}else if("Polygon"===o)J(n,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(c=0;c<e.geometry.geometries.length;c++)X(t,{id:l,geometry:e.geometry.geometries[c],properties:e.properties},r,i);return}throw new Error("Input data is not a valid GeoJSON object.")}for(c=0;c<n.length;c++){var u=[];J(n[c],u,a,!0),s.push(u)}}t.push(Z(l,o,s,e.properties))}}function $(t,e){e.push(tt(t[0])),e.push(et(t[1])),e.push(0)}function Y(t,e,r,i){for(var n,o,a=0,s=0;s<t.length;s++){var l=tt(t[s][0]),c=et(t[s][1]);e.push(l),e.push(c),e.push(0),s>0&&(a+=i?(n*c-l*o)/2:Math.sqrt(Math.pow(l-n,2)+Math.pow(c-o,2))),n=l,o=c}var u=e.length-3;e[2]=1,function t(e,r,i,n){for(var o,a=n,s=i-r>>1,l=i-r,c=e[r],u=e[r+1],h=e[i],A=e[i+1],p=r+3;p<i;p+=3){var d=q(e[p],e[p+1],c,u,h,A);if(d>a)o=p,a=d;else if(d===a){var f=Math.abs(p-s);f<l&&(o=p,l=f)}}a>n&&(o-r>3&&t(e,r,o,n),e[o+2]=a,i-o>3&&t(e,o,i,n))}(e,0,u,r),e[u+2]=1,e.size=Math.abs(a),e.start=0,e.end=e.size}function J(t,e,r,i){for(var n=0;n<t.length;n++){var o=[];Y(t[n],o,r,i),e.push(o)}}function tt(t){return t/360+.5}function et(t){var e=Math.sin(t*Math.PI/180),r=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return r<0?0:r>1?1:r}function rt(t,e,r,i,n,o,a,s){if(i/=e,o>=(r/=e)&&a<i)return t;if(a<r||o>=i)return null;for(var l=[],c=0;c<t.length;c++){var u=t[c],h=u.geometry,A=u.type,p=0===n?u.minX:u.minY,d=0===n?u.maxX:u.maxY;if(p>=r&&d<i)l.push(u);else if(!(d<r||p>=i)){var f=[];if("Point"===A||"MultiPoint"===A)it(h,f,r,i,n);else if("LineString"===A)nt(h,f,r,i,n,!1,s.lineMetrics);else if("MultiLineString"===A)at(h,f,r,i,n,!1);else if("Polygon"===A)at(h,f,r,i,n,!0);else if("MultiPolygon"===A)for(var m=0;m<h.length;m++){var g=[];at(h[m],g,r,i,n,!0),g.length&&f.push(g)}if(f.length){if(s.lineMetrics&&"LineString"===A){for(m=0;m<f.length;m++)l.push(Z(u.id,A,f[m],u.tags));continue}"LineString"!==A&&"MultiLineString"!==A||(1===f.length?(A="LineString",f=f[0]):A="MultiLineString"),"Point"!==A&&"MultiPoint"!==A||(A=3===f.length?"Point":"MultiPoint"),l.push(Z(u.id,A,f,u.tags))}}}return l.length?l:null}function it(t,e,r,i,n){for(var o=0;o<t.length;o+=3){var a=t[o+n];a>=r&&a<=i&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function nt(t,e,r,i,n,o,a){for(var s,l,c=ot(t),u=0===n?lt:ct,h=t.start,A=0;A<t.length-3;A+=3){var p=t[A],d=t[A+1],f=t[A+2],m=t[A+3],g=t[A+4],_=0===n?p:d,y=0===n?m:g,v=!1;a&&(s=Math.sqrt(Math.pow(p-m,2)+Math.pow(d-g,2))),_<r?y>r&&(l=u(c,p,d,m,g,r),a&&(c.start=h+s*l)):_>i?y<i&&(l=u(c,p,d,m,g,i),a&&(c.start=h+s*l)):st(c,p,d,f),y<r&&_>=r&&(l=u(c,p,d,m,g,r),v=!0),y>i&&_<=i&&(l=u(c,p,d,m,g,i),v=!0),!o&&v&&(a&&(c.end=h+s*l),e.push(c),c=ot(t)),a&&(h+=s)}var x=t.length-3;p=t[x],d=t[x+1],f=t[x+2],(_=0===n?p:d)>=r&&_<=i&&st(c,p,d,f),x=c.length-3,o&&x>=3&&(c[x]!==c[0]||c[x+1]!==c[1])&&st(c,c[0],c[1],c[2]),c.length&&e.push(c)}function ot(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function at(t,e,r,i,n,o){for(var a=0;a<t.length;a++)nt(t[a],e,r,i,n,o,!1)}function st(t,e,r,i){t.push(e),t.push(r),t.push(i)}function lt(t,e,r,i,n,o){var a=(o-e)/(i-e);return t.push(o),t.push(r+(n-r)*a),t.push(1),a}function ct(t,e,r,i,n,o){var a=(o-r)/(n-r);return t.push(e+(i-e)*a),t.push(o),t.push(1),a}function ut(t,e){for(var r=[],i=0;i<t.length;i++){var n,o=t[i],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)n=ht(o.geometry,e);else if("MultiLineString"===a||"Polygon"===a){n=[];for(var s=0;s<o.geometry.length;s++)n.push(ht(o.geometry[s],e))}else if("MultiPolygon"===a)for(n=[],s=0;s<o.geometry.length;s++){for(var l=[],c=0;c<o.geometry[s].length;c++)l.push(ht(o.geometry[s][c],e));n.push(l)}r.push(Z(o.id,a,n,o.tags))}return r}function ht(t,e){var r=[];r.size=t.size,void 0!==t.start&&(r.start=t.start,r.end=t.end);for(var i=0;i<t.length;i+=3)r.push(t[i]+e,t[i+1],t[i+2]);return r}function At(t,e){if(t.transformed)return t;var r,i,n,o=1<<t.z,a=t.x,s=t.y;for(r=0;r<t.features.length;r++){var l=t.features[r],c=l.geometry,u=l.type;if(l.geometry=[],1===u)for(i=0;i<c.length;i+=2)l.geometry.push(pt(c[i],c[i+1],e,o,a,s));else for(i=0;i<c.length;i++){var h=[];for(n=0;n<c[i].length;n+=2)h.push(pt(c[i][n],c[i][n+1],e,o,a,s));l.geometry.push(h)}}return t.transformed=!0,t}function pt(t,e,r,i,n,o){return[Math.round(r*(t*i-n)),Math.round(r*(e*i-o))]}function dt(t,e,r,i,n){for(var o=e===n.maxZoom?0:n.tolerance/((1<<e)*n.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:i,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<t.length;s++){a.numFeatures++,ft(a,t[s],o,n);var l=t[s].minX,c=t[s].minY,u=t[s].maxX,h=t[s].maxY;l<a.minX&&(a.minX=l),c<a.minY&&(a.minY=c),u>a.maxX&&(a.maxX=u),h>a.maxY&&(a.maxY=h)}return a}function ft(t,e,r,i){var n=e.geometry,o=e.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<n.length;s+=3)a.push(n[s]),a.push(n[s+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)mt(a,n,t,r,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<n.length;s++)mt(a,n[s],t,r,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var l=0;l<n.length;l++){var c=n[l];for(s=0;s<c.length;s++)mt(a,c[s],t,r,!0,0===s)}if(a.length){var u=e.tags||null;if("LineString"===o&&i.lineMetrics){for(var h in u={},e.tags)u[h]=e.tags[h];u.mapbox_clip_start=n.start/n.size,u.mapbox_clip_end=n.end/n.size}var A={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:u};null!==e.id&&(A.id=e.id),t.features.push(A)}}function mt(t,e,r,i,n,o){var a=i*i;if(i>0&&e.size<(n?a:i))r.numPoints+=e.length/3;else{for(var s=[],l=0;l<e.length;l+=3)(0===i||e[l+2]>a)&&(r.numSimplified++,s.push(e[l]),s.push(e[l+1])),r.numPoints++;n&&function(t,e){for(var r=0,i=0,n=t.length,o=n-2;i<n;o=i,i+=2)r+=(t[i]-t[o])*(t[i+1]+t[o+1]);if(r>0===e)for(i=0,n=t.length;i<n/2;i+=2){var a=t[i],s=t[i+1];t[i]=t[n-2-i],t[i+1]=t[n-1-i],t[n-2-i]=a,t[n-1-i]=s}}(s,o),t.push(s)}}function gt(t,e){var r=(e=this.options=function(t,e){for(var r in e)t[r]=e[r];return t}(Object.create(this.options),e)).debug;if(r&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var i,n,o,a,s,l,c=function(t,e){var r=[];if("FeatureCollection"===t.type)for(var i=0;i<t.features.length;i++)X(r,t.features[i],e,i);else X(r,"Feature"===t.type?t:{geometry:t},e);return r}(t,e);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(i=c,n=e,o=n.buffer/n.extent,a=i,s=rt(i,1,-1-o,o,0,-1,2,n),l=rt(i,1,1-o,2+o,0,-1,2,n),(s||l)&&(a=rt(i,1,-o,1+o,0,-1,2,n)||[],s&&(a=ut(s,1).concat(a)),l&&(a=a.concat(ut(l,-1)))),c=a).length&&this.splitTile(c,0,0,0),r&&(c.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function _t(t,e,r){return 32*((1<<t)*r+e)+t}function yt(t,e){var r=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);var i=this._geoJSONIndex.getTile(r.z,r.x,r.y);if(!i)return e(null,null);var n=new f(i.features),o=v(n);0===o.byteOffset&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),e(null,{vectorTile:n,rawData:o.buffer})}z.prototype.load=function(t){var e=this.options,r=e.log,i=e.minZoom,n=e.maxZoom,o=e.nodeSize;r&&console.time("total time");var a="prepare "+t.length+" points";r&&console.time(a),this.points=t;for(var s=[],l=0;l<t.length;l++)t[l].geometry&&s.push(O(t[l],l));this.trees[n+1]=new U(s,G,K,o,Float32Array),r&&console.timeEnd(a);for(var c=n;c>=i;c--){var u=+Date.now();s=this._cluster(s,c),this.trees[c]=new U(s,G,K,o,Float32Array),r&&console.log("z%d: %d clusters in %dms",c,s.length,+Date.now()-u)}return r&&console.timeEnd("total time"),this},z.prototype.getClusters=function(t,e){var r=((t[0]+180)%360+360)%360-180,i=Math.max(-90,Math.min(90,t[1])),n=180===t[2]?180:((t[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)r=-180,n=180;else if(r>n){var a=this.getClusters([r,i,180,o],e),s=this.getClusters([-180,i,n,o],e);return a.concat(s)}for(var l=this.trees[this._limitZoom(e)],c=[],u=0,h=l.range(V(r),H(o),V(n),H(i));u<h.length;u+=1){var A=l.points[h[u]];c.push(A.numPoints?Q(A):this.points[A.index])}return c},z.prototype.getChildren=function(t){var e=this._getOriginId(t),r=this._getOriginZoom(t),i="No cluster with the specified id.",n=this.trees[r];if(!n)throw new Error(i);var o=n.points[e];if(!o)throw new Error(i);for(var a=this.options.radius/(this.options.extent*Math.pow(2,r-1)),s=[],l=0,c=n.within(o.x,o.y,a);l<c.length;l+=1){var u=n.points[c[l]];u.parentId===t&&s.push(u.numPoints?Q(u):this.points[u.index])}if(0===s.length)throw new Error(i);return s},z.prototype.getLeaves=function(t,e,r){var i=[];return this._appendLeaves(i,t,e=e||10,r=r||0,0),i},z.prototype.getTile=function(t,e,r){var i=this.trees[this._limitZoom(t)],n=Math.pow(2,t),o=this.options,a=o.radius/o.extent,s=(r-a)/n,l=(r+1+a)/n,c={features:[]};return this._addTileFeatures(i.range((e-a)/n,s,(e+1+a)/n,l),i.points,e,r,n,c),0===e&&this._addTileFeatures(i.range(1-a/n,s,1,l),i.points,n,r,n,c),e===n-1&&this._addTileFeatures(i.range(0,s,a/n,l),i.points,-1,r,n,c),c.features.length?c:null},z.prototype.getClusterExpansionZoom=function(t){for(var e=this._getOriginZoom(t)-1;e<=this.options.maxZoom;){var r=this.getChildren(t);if(e++,1!==r.length)break;t=r[0].properties.cluster_id}return e},z.prototype._appendLeaves=function(t,e,r,i,n){for(var o=0,a=this.getChildren(e);o<a.length;o+=1){var s=a[o],l=s.properties;if(l&&l.cluster?n+l.point_count<=i?n+=l.point_count:n=this._appendLeaves(t,l.cluster_id,r,i,n):n<i?n++:t.push(s),t.length===r)break}return n},z.prototype._addTileFeatures=function(t,e,r,i,n,o){for(var a=0,s=t;a<s.length;a+=1){var l=e[s[a]],c=l.numPoints,u={type:1,geometry:[[Math.round(this.options.extent*(l.x*n-r)),Math.round(this.options.extent*(l.y*n-i))]],tags:c?N(l):this.points[l.index].properties},h=void 0;c?h=l.id:this.options.generateId?h=l.index:this.points[l.index].id&&(h=this.points[l.index].id),void 0!==h&&(u.id=h),o.features.push(u)}},z.prototype._limitZoom=function(t){return Math.max(this.options.minZoom,Math.min(+t,this.options.maxZoom+1))},z.prototype._cluster=function(t,e){for(var r=[],i=this.options,n=i.reduce,o=i.minPoints,a=i.radius/(i.extent*Math.pow(2,e)),s=0;s<t.length;s++){var l=t[s];if(!(l.zoom<=e)){l.zoom=e;for(var c=this.trees[e+1],u=c.within(l.x,l.y,a),h=l.numPoints||1,A=h,p=0,d=u;p<d.length;p+=1){var f=c.points[d[p]];f.zoom>e&&(A+=f.numPoints||1)}if(A>=o){for(var m=l.x*h,g=l.y*h,_=n&&h>1?this._map(l,!0):null,y=(s<<5)+(e+1)+this.points.length,v=0,x=u;v<x.length;v+=1){var w=c.points[x[v]];if(!(w.zoom<=e)){w.zoom=e;var b=w.numPoints||1;m+=w.x*b,g+=w.y*b,w.parentId=y,n&&(_||(_=this._map(l,!0)),n(_,this._map(w)))}}l.parentId=y,r.push(R(m/A,g/A,y,A,_))}else if(r.push(l),A>1)for(var B=0,C=u;B<C.length;B+=1){var E=c.points[C[B]];E.zoom<=e||(E.zoom=e,r.push(E))}}}return r},z.prototype._getOriginId=function(t){return t-this.points.length>>5},z.prototype._getOriginZoom=function(t){return(t-this.points.length)%32},z.prototype._map=function(t,e){if(t.numPoints)return e?j({},t.properties):t.properties;var r=this.points[t.index].properties,i=this.options.map(r);return e&&i===r?j({},i):i},gt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},gt.prototype.splitTile=function(t,e,r,i,n,o,a){for(var s=[t,e,r,i],l=this.options,c=l.debug;s.length;){i=s.pop(),r=s.pop(),e=s.pop(),t=s.pop();var u=1<<e,h=_t(e,r,i),A=this.tiles[h];if(!A&&(c>1&&console.time("creation"),A=this.tiles[h]=dt(t,e,r,i,l),this.tileCoords.push({z:e,x:r,y:i}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,r,i,A.numFeatures,A.numPoints,A.numSimplified),console.timeEnd("creation"));var p="z"+e;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(A.source=t,n){if(e===l.maxZoom||e===n)continue;var d=1<<n-e;if(r!==Math.floor(o/d)||i!==Math.floor(a/d))continue}else if(e===l.indexMaxZoom||A.numPoints<=l.indexMaxPoints)continue;if(A.source=null,0!==t.length){c>1&&console.time("clipping");var f,m,g,_,y,v,x=.5*l.buffer/l.extent,w=.5-x,b=.5+x,B=1+x;f=m=g=_=null,y=rt(t,u,r-x,r+b,0,A.minX,A.maxX,l),v=rt(t,u,r+w,r+B,0,A.minX,A.maxX,l),t=null,y&&(f=rt(y,u,i-x,i+b,1,A.minY,A.maxY,l),m=rt(y,u,i+w,i+B,1,A.minY,A.maxY,l),y=null),v&&(g=rt(v,u,i-x,i+b,1,A.minY,A.maxY,l),_=rt(v,u,i+w,i+B,1,A.minY,A.maxY,l),v=null),c>1&&console.timeEnd("clipping"),s.push(f||[],e+1,2*r,2*i),s.push(m||[],e+1,2*r,2*i+1),s.push(g||[],e+1,2*r+1,2*i),s.push(_||[],e+1,2*r+1,2*i+1)}}},gt.prototype.getTile=function(t,e,r){var i=this.options,n=i.extent,o=i.debug;if(t<0||t>24)return null;var a=1<<t,s=_t(t,e=(e%a+a)%a,r);if(this.tiles[s])return At(this.tiles[s],n);o>1&&console.log("drilling down to z%d-%d-%d",t,e,r);for(var l,c=t,u=e,h=r;!l&&c>0;)c--,u=Math.floor(u/2),h=Math.floor(h/2),l=this.tiles[_t(c,u,h)];return l&&l.source?(o>1&&console.log("found parent tile z%d-%d-%d",c,u,h),o>1&&console.time("drilling down"),this.splitTile(l.source,c,u,h,t,e,r),o>1&&console.timeEnd("drilling down"),this.tiles[s]?At(this.tiles[s],n):null):null};var vt=function(e){function r(t,r,i,n){e.call(this,t,r,i,yt),n&&(this.loadGeoJSON=n)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.loadData=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=e,this._pendingLoadDataParams=t,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},r.prototype._loadData=function(){var e=this;if(this._pendingCallback&&this._pendingLoadDataParams){var r=this._pendingCallback,i=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var n=!!(i&&i.request&&i.request.collectResourceTiming)&&new t.RequestPerformance(i.request);this.loadGeoJSON(i,(function(o,a){if(o||!a)return r(o);if("object"!=Ze(a))return r(new Error("Input data given to '"+i.source+"' is not a valid GeoJSON object."));!function t(e,r){var i,n=e&&e.type;if("FeatureCollection"===n)for(i=0;i<e.features.length;i++)t(e.features[i],r);else if("GeometryCollection"===n)for(i=0;i<e.geometries.length;i++)t(e.geometries[i],r);else if("Feature"===n)t(e.geometry,r);else if("Polygon"===n)h(e.coordinates,r);else if("MultiPolygon"===n)for(i=0;i<e.coordinates.length;i++)h(e.coordinates[i],r);return e}(a,!0);try{if(i.filter){var s=t.createExpression(i.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===s.result)throw new Error(s.value.map((function(t){return t.key+": "+t.message})).join(", "));var l=a.features.filter((function(t){return s.value.evaluate({zoom:0},t)}));a={type:"FeatureCollection",features:l}}e._geoJSONIndex=i.cluster?new z(function(e){var r=e.superclusterOptions,i=e.clusterProperties;if(!i||!r)return r;for(var n={},o={},a={accumulated:null,zoom:0},s={properties:null},l=Object.keys(i),c=0,u=l;c<u.length;c+=1){var h=u[c],A=i[h],p=A[0],d=t.createExpression(A[1]),f=t.createExpression("string"==typeof p?[p,["accumulated"],["get",h]]:p);n[h]=d.value,o[h]=f.value}return r.map=function(t){s.properties=t;for(var e={},r=0,i=l;r<i.length;r+=1){var o=i[r];e[o]=n[o].evaluate(a,s)}return e},r.reduce=function(t,e){s.properties=e;for(var r=0,i=l;r<i.length;r+=1){var n=i[r];a.accumulated=t[n],t[n]=o[n].evaluate(a,s)}},r}(i)).load(a.features):(c=a,u=i.geojsonVtOptions,new gt(c,u))}catch(c){return r(c)}var c,u;e.loaded={};var A={};if(n){var p=n.finish();p&&(A.resourceTiming={},A.resourceTiming[i.source]=JSON.parse(JSON.stringify(p)))}r(null,A)}))}},r.prototype.coalesce=function(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData())},r.prototype.reloadTile=function(t,r){var i=this.loaded;return i&&i[t.uid]?e.prototype.reloadTile.call(this,t,r):this.loadTile(t,r)},r.prototype.loadGeoJSON=function(e,r){if(e.request)t.getJSON(e.request,r);else{if("string"!=typeof e.data)return r(new Error("Input data given to '"+e.source+"' is not a valid GeoJSON object."));try{return r(null,JSON.parse(e.data))}catch(t){return r(new Error("Input data given to '"+e.source+"' is not a valid GeoJSON object."))}}},r.prototype.removeSource=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),e()},r.prototype.getClusterExpansionZoom=function(t,e){try{e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId))}catch(t){e(t)}},r.prototype.getClusterChildren=function(t,e){try{e(null,this._geoJSONIndex.getChildren(t.clusterId))}catch(t){e(t)}},r.prototype.getClusterLeaves=function(t,e){try{e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset))}catch(t){e(t)}},r}(l),xt=function(e){var r=this;this.self=e,this.actor=new t.Actor(e,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:l,geojson:vt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(t,e){if(r.workerSourceTypes[t])throw new Error('Worker source with name "'+t+'" already registered.');r.workerSourceTypes[t]=e},this.self.registerRTLTextPlugin=function(e){if(t.plugin.isParsed())throw new Error("RTL text plugin already registered.");t.plugin.applyArabicShaping=e.applyArabicShaping,t.plugin.processBidirectionalText=e.processBidirectionalText,t.plugin.processStyledBidirectionalText=e.processStyledBidirectionalText}};return xt.prototype.setReferrer=function(t,e){this.referrer=e},xt.prototype.setImages=function(t,e,r){for(var i in this.availableImages[t]=e,this.workerSources[t]){var n=this.workerSources[t][i];for(var o in n)n[o].availableImages=e}r()},xt.prototype.setLayers=function(t,e,r){this.getLayerIndex(t).replace(e),r()},xt.prototype.updateLayers=function(t,e,r){this.getLayerIndex(t).update(e.layers,e.removedIds),r()},xt.prototype.loadTile=function(t,e,r){this.getWorkerSource(t,e.type,e.source).loadTile(e,r)},xt.prototype.loadDEMTile=function(t,e,r){this.getDEMWorkerSource(t,e.source).loadTile(e,r)},xt.prototype.reloadTile=function(t,e,r){this.getWorkerSource(t,e.type,e.source).reloadTile(e,r)},xt.prototype.abortTile=function(t,e,r){this.getWorkerSource(t,e.type,e.source).abortTile(e,r)},xt.prototype.removeTile=function(t,e,r){this.getWorkerSource(t,e.type,e.source).removeTile(e,r)},xt.prototype.removeDEMTile=function(t,e){this.getDEMWorkerSource(t,e.source).removeTile(e)},xt.prototype.removeSource=function(t,e,r){if(this.workerSources[t]&&this.workerSources[t][e.type]&&this.workerSources[t][e.type][e.source]){var i=this.workerSources[t][e.type][e.source];delete this.workerSources[t][e.type][e.source],void 0!==i.removeSource?i.removeSource(e,r):r()}},xt.prototype.loadWorkerSource=function(t,e,r){try{this.self.importScripts(e.url),r()}catch(t){r(t.toString())}},xt.prototype.syncRTLPluginState=function(e,r,i){try{t.plugin.setState(r);var n=t.plugin.getPluginURL();if(t.plugin.isLoaded()&&!t.plugin.isParsed()&&null!=n){this.self.importScripts(n);var o=t.plugin.isParsed();i(o?void 0:new Error("RTL Text Plugin failed to import scripts from "+n),o)}}catch(t){i(t.toString())}},xt.prototype.getAvailableImages=function(t){var e=this.availableImages[t];return e||(e=[]),e},xt.prototype.getLayerIndex=function(t){var e=this.layerIndexes[t];return e||(e=this.layerIndexes[t]=new i),e},xt.prototype.getWorkerSource=function(t,e,r){var i=this;return this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][e]||(this.workerSources[t][e]={}),this.workerSources[t][e][r]||(this.workerSources[t][e][r]=new this.workerSourceTypes[e]({send:function(e,r,n){i.actor.send(e,r,n,t)}},this.getLayerIndex(t),this.getAvailableImages(t))),this.workerSources[t][e][r]},xt.prototype.getDEMWorkerSource=function(t,e){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][e]||(this.demWorkerSources[t][e]=new u),this.demWorkerSources[t][e]},xt.prototype.enforceCacheSizeLimit=function(e,r){t.enforceCacheSizeLimit(r)},"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new xt(self)),xt})),i(["./shared"],(function(t){var e=t.createCommonjsModule((function(t){function e(t){return!r(t)}function r(t){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var t,e,r=new Blob([""],{type:"text/javascript"}),i=URL.createObjectURL(r);try{e=new Worker(i),t=!0}catch(e){t=!1}return e&&e.terminate(),URL.revokeObjectURL(i),t}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var t=document.createElement("canvas");t.width=t.height=1;var e=t.getContext("2d");if(!e)return!1;var r=e.getImageData(0,0,1,1);return r&&r.width===t.width}()?(void 0===i[r=t&&t.failIfMajorPerformanceCaveat]&&(i[r]=function(t){var r,i,n,o=(r=t,i=document.createElement("canvas"),(n=Object.create(e.webGLContextAttributes)).failIfMajorPerformanceCaveat=r,i.probablySupportsContext?i.probablySupportsContext("webgl",n)||i.probablySupportsContext("experimental-webgl",n):i.supportsContext?i.supportsContext("webgl",n)||i.supportsContext("experimental-webgl",n):i.getContext("webgl",n)||i.getContext("experimental-webgl",n));if(!o)return!1;var a=o.createShader(o.VERTEX_SHADER);return!(!a||o.isContextLost())&&(o.shaderSource(a,"void main() {}"),o.compileShader(a),!0===o.getShaderParameter(a,o.COMPILE_STATUS))}(r)),i[r]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var r}t.exports?t.exports=e:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=e,window.mapboxgl.notSupportedReason=r);var i={};e.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}})),r={create:function(e,r,i){var n=t.window.document.createElement(e);return void 0!==r&&(n.className=r),i&&i.appendChild(n),n},createNS:function(e,r){return t.window.document.createElementNS(e,r)}},i=t.window.document&&t.window.document.documentElement.style;function n(t){if(!i)return t[0];for(var e=0;e<t.length;e++)if(t[e]in i)return t[e];return t[0]}var o,a=n(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);r.disableDrag=function(){i&&a&&(o=i[a],i[a]="none")},r.enableDrag=function(){i&&a&&(i[a]=o)};var s=n(["transform","WebkitTransform"]);r.setTransform=function(t,e){t.style[s]=e};var l=!1;try{var c=Object.defineProperty({},"passive",{get:function(){l=!0}});t.window.addEventListener("test",c,c),t.window.removeEventListener("test",c,c)}catch(t){l=!1}r.addEventListener=function(t,e,r,i){void 0===i&&(i={}),t.addEventListener(e,r,"passive"in i&&l?i:i.capture)},r.removeEventListener=function(t,e,r,i){void 0===i&&(i={}),t.removeEventListener(e,r,"passive"in i&&l?i:i.capture)};var u=function e(r){r.preventDefault(),r.stopPropagation(),t.window.removeEventListener("click",e,!0)};function h(t){var e=t.userImage;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}r.suppressClick=function(){t.window.addEventListener("click",u,!0),t.window.setTimeout((function(){t.window.removeEventListener("click",u,!0)}),0)},r.mousePos=function(e,r){var i=e.getBoundingClientRect();return new t.Point(r.clientX-i.left-e.clientLeft,r.clientY-i.top-e.clientTop)},r.touchPos=function(e,r){for(var i=e.getBoundingClientRect(),n=[],o=0;o<r.length;o++)n.push(new t.Point(r[o].clientX-i.left-e.clientLeft,r[o].clientY-i.top-e.clientTop));return n},r.mouseButton=function(e){return void 0!==t.window.InstallTrigger&&2===e.button&&e.ctrlKey&&t.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button},r.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)};var A=function(e){function r(){e.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.RGBAImage({width:1,height:1}),this.dirty=!0}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.isLoaded=function(){return this.loaded},r.prototype.setLoaded=function(t){if(this.loaded!==t&&(this.loaded=t,t)){for(var e=0,r=this.requestors;e<r.length;e+=1){var i=r[e];this._notify(i.ids,i.callback)}this.requestors=[]}},r.prototype.getImage=function(t){return this.images[t]},r.prototype.addImage=function(t,e){this._validate(t,e)&&(this.images[t]=e)},r.prototype._validate=function(e,r){var i=!0;return this._validateStretch(r.stretchX,r.data&&r.data.width)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "stretchX" value'))),i=!1),this._validateStretch(r.stretchY,r.data&&r.data.height)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "stretchY" value'))),i=!1),this._validateContent(r.content,r)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "content" value'))),i=!1),i},r.prototype._validateStretch=function(t,e){if(!t)return!0;for(var r=0,i=0,n=t;i<n.length;i+=1){var o=n[i];if(o[0]<r||o[1]<o[0]||e<o[1])return!1;r=o[1]}return!0},r.prototype._validateContent=function(t,e){return!(t&&(4!==t.length||t[0]<0||e.data.width<t[0]||t[1]<0||e.data.height<t[1]||t[2]<0||e.data.width<t[2]||t[3]<0||e.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))},r.prototype.updateImage=function(t,e){e.version=this.images[t].version+1,this.images[t]=e,this.updatedImages[t]=!0},r.prototype.removeImage=function(t){var e=this.images[t];delete this.images[t],delete this.patterns[t],e.userImage&&e.userImage.onRemove&&e.userImage.onRemove()},r.prototype.listImages=function(){return Object.keys(this.images)},r.prototype.getImages=function(t,e){var r=!0;if(!this.isLoaded())for(var i=0,n=t;i<n.length;i+=1)this.images[n[i]]||(r=!1);this.isLoaded()||r?this._notify(t,e):this.requestors.push({ids:t,callback:e})},r.prototype._notify=function(e,r){for(var i={},n=0,o=e;n<o.length;n+=1){var a=o[n];this.images[a]||this.fire(new t.Event("styleimagemissing",{id:a}));var s=this.images[a];s?i[a]={data:s.data.clone(),pixelRatio:s.pixelRatio,sdf:s.sdf,version:s.version,stretchX:s.stretchX,stretchY:s.stretchY,content:s.content,hasRenderCallback:Boolean(s.userImage&&s.userImage.render)}:t.warnOnce('Image "'+a+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}r(null,i)},r.prototype.getPixelSize=function(){var t=this.atlasImage;return{width:t.width,height:t.height}},r.prototype.getPattern=function(e){var r=this.patterns[e],i=this.getImage(e);if(!i)return null;if(r&&r.position.version===i.version)return r.position;if(r)r.position.version=i.version;else{var n={w:i.data.width+2,h:i.data.height+2,x:0,y:0},o=new t.ImagePosition(n,i);this.patterns[e]={bin:n,position:o}}return this._updatePatternAtlas(),this.patterns[e].position},r.prototype.bind=function(e){var r=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new t.Texture(e,this.atlasImage,r.RGBA),this.atlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)},r.prototype._updatePatternAtlas=function(){var e=[];for(var r in this.patterns)e.push(this.patterns[r].bin);var i=t.potpack(e),n=i.w,o=i.h,a=this.atlasImage;for(var s in a.resize({width:n||1,height:o||1}),this.patterns){var l=this.patterns[s].bin,c=l.x+1,u=l.y+1,h=this.images[s].data,A=h.width,p=h.height;t.RGBAImage.copy(h,a,{x:0,y:0},{x:c,y:u},{width:A,height:p}),t.RGBAImage.copy(h,a,{x:0,y:p-1},{x:c,y:u-1},{width:A,height:1}),t.RGBAImage.copy(h,a,{x:0,y:0},{x:c,y:u+p},{width:A,height:1}),t.RGBAImage.copy(h,a,{x:A-1,y:0},{x:c-1,y:u},{width:1,height:p}),t.RGBAImage.copy(h,a,{x:0,y:0},{x:c+A,y:u},{width:1,height:p})}this.dirty=!0},r.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},r.prototype.dispatchRenderCallbacks=function(t){for(var e=0,r=t;e<r.length;e+=1){var i=r[e];if(!this.callbackDispatchedThisFrame[i]){this.callbackDispatchedThisFrame[i]=!0;var n=this.images[i];h(n)&&this.updateImage(i,n)}}},r}(t.Evented),p=m,d=m,f=1e20;function m(t,e,r,i,n,o){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=i||.25,this.fontFamily=n||"sans-serif",this.fontWeight=o||"normal",this.radius=r||8;var a=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.d=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Int16Array(a),this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function g(t,e,r,i,n,o,a){for(var s=0;s<e;s++){for(var l=0;l<r;l++)i[l]=t[l*e+s];for(_(i,n,o,a,r),l=0;l<r;l++)t[l*e+s]=n[l]}for(l=0;l<r;l++){for(s=0;s<e;s++)i[s]=t[l*e+s];for(_(i,n,o,a,e),s=0;s<e;s++)t[l*e+s]=Math.sqrt(n[s])}}function _(t,e,r,i,n){r[0]=0,i[0]=-f,i[1]=+f;for(var o=1,a=0;o<n;o++){for(var s=(t[o]+o*o-(t[r[a]]+r[a]*r[a]))/(2*o-2*r[a]);s<=i[a];)a--,s=(t[o]+o*o-(t[r[a]]+r[a]*r[a]))/(2*o-2*r[a]);r[++a]=o,i[a]=s,i[a+1]=+f}for(o=0,a=0;o<n;o++){for(;i[a+1]<o;)a++;e[o]=(o-r[a])*(o-r[a])+t[r[a]]}}m.prototype.draw=function(t){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(t,this.buffer,this.middle);for(var e=this.ctx.getImageData(0,0,this.size,this.size),r=new Uint8ClampedArray(this.size*this.size),i=0;i<this.size*this.size;i++){var n=e.data[4*i+3]/255;this.gridOuter[i]=1===n?0:0===n?f:Math.pow(Math.max(0,.5-n),2),this.gridInner[i]=1===n?f:0===n?0:Math.pow(Math.max(0,n-.5),2)}for(g(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),g(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),i=0;i<this.size*this.size;i++)r[i]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[i]-this.gridInner[i])/this.radius+this.cutoff))));return r},p.default=d;var y=function(t,e){this.requestManager=t,this.localIdeographFontFamily=e,this.entries={}};y.prototype.setURL=function(t){this.url=t},y.prototype.getGlyphs=function(e,r){var i=this,n=[];for(var o in e)for(var a=0,s=e[o];a<s.length;a+=1)n.push({stack:o,id:s[a]});t.asyncAll(n,(function(t,e){var r=t.stack,n=t.id,o=i.entries[r];o||(o=i.entries[r]={glyphs:{},requests:{},ranges:{}});var a=o.glyphs[n];if(void 0===a){if(a=i._tinySDF(o,r,n))return o.glyphs[n]=a,void e(null,{stack:r,id:n,glyph:a});var s=Math.floor(n/256);if(256*s>65535)e(new Error("glyphs > 65535 not supported"));else if(o.ranges[s])e(null,{stack:r,id:n,glyph:a});else{var l=o.requests[s];l||(l=o.requests[s]=[],y.loadGlyphRange(r,s,i.url,i.requestManager,(function(t,e){if(e){for(var r in e)i._doesCharSupportLocalGlyph(+r)||(o.glyphs[+r]=e[+r]);o.ranges[s]=!0}for(var n=0,a=l;n<a.length;n+=1)(0,a[n])(t,e);delete o.requests[s]}))),l.push((function(t,i){t?e(t):i&&e(null,{stack:r,id:n,glyph:i[n]||null})}))}}else e(null,{stack:r,id:n,glyph:a})}),(function(t,e){if(t)r(t);else if(e){for(var i={},n=0,o=e;n<o.length;n+=1){var a=o[n],s=a.stack,l=a.id,c=a.glyph;(i[s]||(i[s]={}))[l]=c&&{id:c.id,bitmap:c.bitmap.clone(),metrics:c.metrics}}r(null,i)}}))},y.prototype._doesCharSupportLocalGlyph=function(e){return!!this.localIdeographFontFamily&&(t.isChar["CJK Unified Ideographs"](e)||t.isChar["Hangul Syllables"](e)||t.isChar.Hiragana(e)||t.isChar.Katakana(e))},y.prototype._tinySDF=function(e,r,i){var n=this.localIdeographFontFamily;if(n&&this._doesCharSupportLocalGlyph(i)){var o=e.tinySDF;if(!o){var a="400";/bold/i.test(r)?a="900":/medium/i.test(r)?a="500":/light/i.test(r)&&(a="200"),o=e.tinySDF=new y.TinySDF(24,3,8,.25,n,a)}return{id:i,bitmap:new t.AlphaImage({width:30,height:30},o.draw(String.fromCharCode(i))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},y.loadGlyphRange=function(e,r,i,n,o){var a=256*r,s=a+255,l=n.transformRequest(n.normalizeGlyphsURL(i).replace("{fontstack}",e).replace("{range}",a+"-"+s),t.ResourceType.Glyphs);t.getArrayBuffer(l,(function(e,r){if(e)o(e);else if(r){for(var i={},n=0,a=t.parseGlyphPBF(r);n<a.length;n+=1){var s=a[n];i[s.id]=s}o(null,i)}}))},y.TinySDF=p;var v=function(){this.specification=t.styleSpec.light.position};v.prototype.possiblyEvaluate=function(e,r){return t.sphericalToCartesian(e.expression.evaluate(r))},v.prototype.interpolate=function(e,r,i){return{x:t.number(e.x,r.x,i),y:t.number(e.y,r.y,i),z:t.number(e.z,r.z,i)}};var x=new t.Properties({anchor:new t.DataConstantProperty(t.styleSpec.light.anchor),position:new v,color:new t.DataConstantProperty(t.styleSpec.light.color),intensity:new t.DataConstantProperty(t.styleSpec.light.intensity)}),w=function(e){function r(r){e.call(this),this._transitionable=new t.Transitionable(x),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.getLight=function(){return this._transitionable.serialize()},r.prototype.setLight=function(e,r){if(void 0===r&&(r={}),!this._validate(t.validateLight,e,r))for(var i in e){var n=e[i];t.endsWith(i,"-transition")?this._transitionable.setTransition(i.slice(0,-11),n):this._transitionable.setValue(i,n)}},r.prototype.updateTransitions=function(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)},r.prototype.hasTransition=function(){return this._transitioning.hasTransition()},r.prototype.recalculate=function(t){this.properties=this._transitioning.possiblyEvaluate(t)},r.prototype._validate=function(e,r,i){return(!i||!1!==i.validate)&&t.emitValidationErrors(this,e.call(t.validateStyle,t.extend({value:r,style:{glyphs:!0,sprite:!0},styleSpec:t.styleSpec})))},r}(t.Evented),b=function(t,e){this.width=t,this.height=e,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};b.prototype.getDash=function(t,e){var r=t.join(",")+String(e);return this.dashEntry[r]||(this.dashEntry[r]=this.addDash(t,e)),this.dashEntry[r]},b.prototype.getDashRanges=function(t,e,r){var i=[],n=t.length%2==1?-t[t.length-1]*r:0,o=t[0]*r,a=!0;i.push({left:n,right:o,isDash:a,zeroLength:0===t[0]});for(var s=t[0],l=1;l<t.length;l++){var c=t[l];i.push({left:n=s*r,right:o=(s+=c)*r,isDash:a=!a,zeroLength:0===c})}return i},b.prototype.addRoundDash=function(t,e,r){for(var i=e/2,n=-r;n<=r;n++)for(var o=this.width*(this.nextRow+r+n),a=0,s=t[a],l=0;l<this.width;l++){l/s.right>1&&(s=t[++a]);var c=Math.abs(l-s.left),u=Math.abs(l-s.right),h=Math.min(c,u),A=void 0,p=n/r*(i+1);if(s.isDash){var d=i-Math.abs(p);A=Math.sqrt(h*h+d*d)}else A=i-Math.sqrt(h*h+p*p);this.data[o+l]=Math.max(0,Math.min(255,A+128))}},b.prototype.addRegularDash=function(t){for(var e=t.length-1;e>=0;--e){var r=t[e],i=t[e+1];r.zeroLength?t.splice(e,1):i&&i.isDash===r.isDash&&(i.left=r.left,t.splice(e,1))}var n=t[0],o=t[t.length-1];n.isDash===o.isDash&&(n.left=o.left-this.width,o.right=n.right+this.width);for(var a=this.width*this.nextRow,s=0,l=t[s],c=0;c<this.width;c++){c/l.right>1&&(l=t[++s]);var u=Math.abs(c-l.left),h=Math.abs(c-l.right),A=Math.min(u,h);this.data[a+c]=Math.max(0,Math.min(255,(l.isDash?A:-A)+128))}},b.prototype.addDash=function(e,r){var i=r?7:0,n=2*i+1;if(this.nextRow+n>this.height)return t.warnOnce("LineAtlas out of space"),null;for(var o=0,a=0;a<e.length;a++)o+=e[a];if(0!==o){var s=this.width/o,l=this.getDashRanges(e,this.width,s);r?this.addRoundDash(l,s,i):this.addRegularDash(l)}var c={y:(this.nextRow+i+.5)/this.height,height:2*i/this.height,width:o};return this.nextRow+=n,this.dirty=!0,c},b.prototype.bind=function(t){var e=t.gl;this.texture?(e.bindTexture(e.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.width,this.height,e.ALPHA,e.UNSIGNED_BYTE,this.data))):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.ALPHA,this.width,this.height,0,e.ALPHA,e.UNSIGNED_BYTE,this.data))};var B=function e(r,i){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=t.uniqueId();for(var n=this.workerPool.acquire(this.id),o=0;o<n.length;o++){var a=new e.Actor(n[o],i,this.id);a.name="Worker "+o,this.actors.push(a)}};function C(e,r,i){var n=function(n,o){if(n)return i(n);if(o){var a=t.pick(t.extend(o,e),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);o.vector_layers&&(a.vectorLayers=o.vector_layers,a.vectorLayerIds=a.vectorLayers.map((function(t){return t.id}))),a.tiles=r.canonicalizeTileset(a,e.url),i(null,a)}};return e.url?t.getJSON(r.transformRequest(r.normalizeSourceURL(e.url),t.ResourceType.Source),n):t.browser.frame((function(){return n(null,e)}))}B.prototype.broadcast=function(e,r,i){t.asyncAll(this.actors,(function(t,i){t.send(e,r,i)}),i=i||function(){})},B.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},B.prototype.remove=function(){this.actors.forEach((function(t){t.remove()})),this.actors=[],this.workerPool.release(this.id)},B.Actor=t.Actor;var E=function(e,r,i){this.bounds=t.LngLatBounds.convert(this.validateBounds(e)),this.minzoom=r||0,this.maxzoom=i||24};E.prototype.validateBounds=function(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]},E.prototype.contains=function(e){var r=Math.pow(2,e.z),i=Math.floor(t.mercatorXfromLng(this.bounds.getWest())*r),n=Math.floor(t.mercatorYfromLat(this.bounds.getNorth())*r),o=Math.ceil(t.mercatorXfromLng(this.bounds.getEast())*r),a=Math.ceil(t.mercatorYfromLat(this.bounds.getSouth())*r);return e.x>=i&&e.x<o&&e.y>=n&&e.y<a};var T=function(e){function r(r,i,n,o){if(e.call(this),this.id=r,this.dispatcher=n,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.extend(this,t.pick(i,["url","scheme","tileSize","promoteId"])),this._options=t.extend({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(o)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.load=function(){var e=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=C(this._options,this.map._requestManager,(function(r,i){e._tileJSONRequest=null,e._loaded=!0,r?e.fire(new t.ErrorEvent(r)):i&&(t.extend(e,i),i.bounds&&(e.tileBounds=new E(i.bounds,e.minzoom,e.maxzoom)),t.postTurnstileEvent(i.tiles,e.map._requestManager._customAccessToken),t.postMapLoadEvent(i.tiles,e.map._getMapId(),e.map._requestManager._skuToken,e.map._requestManager._customAccessToken),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))}))},r.prototype.loaded=function(){return this._loaded},r.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},r.prototype.onAdd=function(t){this.map=t,this.load()},r.prototype.setSourceProperty=function(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},r.prototype.setTiles=function(t){var e=this;return this.setSourceProperty((function(){e._options.tiles=t})),this},r.prototype.setUrl=function(t){var e=this;return this.setSourceProperty((function(){e.url=t,e._options.url=t})),this},r.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},r.prototype.serialize=function(){return t.extend({},this._options)},r.prototype.loadTile=function(e,r){var i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),n={request:this.map._requestManager.transformRequest(i,t.ResourceType.Tile),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function o(i,n){return delete e.request,e.aborted?r(null):i&&404!==i.status?r(i):(n&&n.resourceTiming&&(e.resourceTiming=n.resourceTiming),this.map._refreshExpiredTiles&&n&&e.setExpiryData(n),e.loadVectorData(n,this.map.painter),t.cacheEntryPossiblyAdded(this.dispatcher),r(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}n.request.collectResourceTiming=this._collectResourceTiming,e.actor&&"expired"!==e.state?"loading"===e.state?e.reloadCallback=r:e.request=e.actor.send("reloadTile",n,o.bind(this)):(e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",n,o.bind(this)))},r.prototype.abortTile=function(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)},r.prototype.unloadTile=function(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)},r.prototype.hasTransition=function(){return!1},r}(t.Evented),I=function(e){function r(r,i,n,o){e.call(this),this.id=r,this.dispatcher=n,this.setEventedParent(o),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.extend({type:"raster"},i),t.extend(this,t.pick(i,["url","scheme","tileSize"]))}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.load=function(){var e=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=C(this._options,this.map._requestManager,(function(r,i){e._tileJSONRequest=null,e._loaded=!0,r?e.fire(new t.ErrorEvent(r)):i&&(t.extend(e,i),i.bounds&&(e.tileBounds=new E(i.bounds,e.minzoom,e.maxzoom)),t.postTurnstileEvent(i.tiles),t.postMapLoadEvent(i.tiles,e.map._getMapId(),e.map._requestManager._skuToken),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))}))},r.prototype.loaded=function(){return this._loaded},r.prototype.onAdd=function(t){this.map=t,this.load()},r.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},r.prototype.serialize=function(){return t.extend({},this._options)},r.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},r.prototype.loadTile=function(e,r){var i=this,n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);e.request=t.getImage(this.map._requestManager.transformRequest(n,t.ResourceType.Tile),(function(n,o){if(delete e.request,e.aborted)e.state="unloaded",r(null);else if(n)e.state="errored",r(n);else if(o){i.map._refreshExpiredTiles&&e.setExpiryData(o),delete o.cacheControl,delete o.expires;var a=i.map.painter.context,s=a.gl;e.texture=i.map.painter.getTileTexture(o.width),e.texture?e.texture.update(o,{useMipmap:!0}):(e.texture=new t.Texture(a,o,s.RGBA,{useMipmap:!0}),e.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST),a.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax)),e.state="loaded",t.cacheEntryPossiblyAdded(i.dispatcher),r(null)}}))},r.prototype.abortTile=function(t,e){t.request&&(t.request.cancel(),delete t.request),e()},r.prototype.unloadTile=function(t,e){t.texture&&this.map.painter.saveTileTexture(t.texture),e()},r.prototype.hasTransition=function(){return!1},r}(t.Evented),S=function(e){function r(r,i,n,o){e.call(this,r,i,n,o),this.type="raster-dem",this.maxzoom=22,this._options=t.extend({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},r.prototype.loadTile=function(e,r){var i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function n(t,i){t&&(e.state="errored",r(t)),i&&(e.dem=i,e.needsHillshadePrepare=!0,e.state="loaded",r(null))}e.request=t.getImage(this.map._requestManager.transformRequest(i,t.ResourceType.Tile),function(i,o){if(delete e.request,e.aborted)e.state="unloaded",r(null);else if(i)e.state="errored",r(i);else if(o){this.map._refreshExpiredTiles&&e.setExpiryData(o),delete o.cacheControl,delete o.expires;var a=t.window.ImageBitmap&&o instanceof t.window.ImageBitmap&&t.offscreenCanvasSupported()?o:t.browser.getImageData(o,1),s={uid:e.uid,coord:e.tileID,source:this.id,rawImageData:a,encoding:this.encoding};e.actor&&"expired"!==e.state||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",s,n.bind(this)))}}.bind(this)),e.neighboringTiles=this._getNeighboringTiles(e.tileID)},r.prototype._getNeighboringTiles=function(e){var r=e.canonical,i=Math.pow(2,r.z),n=(r.x-1+i)%i,o=0===r.x?e.wrap-1:e.wrap,a=(r.x+1+i)%i,s=r.x+1===i?e.wrap+1:e.wrap,l={};return l[new t.OverscaledTileID(e.overscaledZ,o,r.z,n,r.y).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,s,r.z,a,r.y).key]={backfilled:!1},r.y>0&&(l[new t.OverscaledTileID(e.overscaledZ,o,r.z,n,r.y-1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,e.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,s,r.z,a,r.y-1).key]={backfilled:!1}),r.y+1<i&&(l[new t.OverscaledTileID(e.overscaledZ,o,r.z,n,r.y+1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,e.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,s,r.z,a,r.y+1).key]={backfilled:!1}),l},r.prototype.unloadTile=function(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})},r}(I),M=function(e){function r(r,i,n,o){e.call(this),this.id=r,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(o),this._data=i.data,this._options=t.extend({},i),this._collectResourceTiming=i.collectResourceTiming,this._resourceTiming=[],void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;var a=t.EXTENT/this.tileSize;this.workerOptions=t.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*a,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*a,extent:t.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?Math.min(i.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:t.EXTENT,radius:(i.clusterRadius||50)*a,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.load=function(){var e=this;this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(r){if(r)e.fire(new t.ErrorEvent(r));else{var i={dataType:"source",sourceDataType:"metadata"};e._collectResourceTiming&&e._resourceTiming&&e._resourceTiming.length>0&&(i.resourceTiming=e._resourceTiming,e._resourceTiming=[]),e.fire(new t.Event("data",i))}}))},r.prototype.onAdd=function(t){this.map=t,this.load()},r.prototype.setData=function(e){var r=this;return this._data=e,this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(e){if(e)r.fire(new t.ErrorEvent(e));else{var i={dataType:"source",sourceDataType:"content"};r._collectResourceTiming&&r._resourceTiming&&r._resourceTiming.length>0&&(i.resourceTiming=r._resourceTiming,r._resourceTiming=[]),r.fire(new t.Event("data",i))}})),this},r.prototype.getClusterExpansionZoom=function(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},e),this},r.prototype.getClusterChildren=function(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},e),this},r.prototype.getClusterLeaves=function(t,e,r,i){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:e,offset:r},i),this},r.prototype._updateWorkerData=function(e){var r=this;this._loaded=!1;var i=t.extend({},this.workerOptions),n=this._data;"string"==typeof n?(i.request=this.map._requestManager.transformRequest(t.browser.resolveURL(n),t.ResourceType.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(n),this.actor.send(this.type+".loadData",i,(function(t,n){r._removed||n&&n.abandoned||(r._loaded=!0,n&&n.resourceTiming&&n.resourceTiming[r.id]&&(r._resourceTiming=n.resourceTiming[r.id].slice(0)),r.actor.send(r.type+".coalesce",{source:i.source},null),e(t))}))},r.prototype.loaded=function(){return this._loaded},r.prototype.loadTile=function(e,r){var i=this,n=e.actor?"reloadTile":"loadTile";e.actor=this.actor,e.request=this.actor.send(n,{type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(function(t,o){return delete e.request,e.unloadVectorData(),e.aborted?r(null):t?r(t):(e.loadVectorData(o,i.map.painter,"reloadTile"===n),r(null))}))},r.prototype.abortTile=function(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0},r.prototype.unloadTile=function(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})},r.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},r.prototype.serialize=function(){return t.extend({},this._options,{type:this.type,data:this._data})},r.prototype.hasTransition=function(){return!1},r}(t.Evented),F=t.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),P=function(e){function r(t,r,i,n){e.call(this),this.id=t,this.dispatcher=i,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(n),this.options=r}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.load=function(e,r){var i=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this.url=this.options.url,t.getImage(this.map._requestManager.transformRequest(this.url,t.ResourceType.Image),(function(n,o){i._loaded=!0,n?i.fire(new t.ErrorEvent(n)):o&&(i.image=o,e&&(i.coordinates=e),r&&r(),i._finishLoading())}))},r.prototype.loaded=function(){return this._loaded},r.prototype.updateImage=function(t){var e=this;return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,(function(){e.texture=null})),this):this},r.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})))},r.prototype.onAdd=function(t){this.map=t,this.load()},r.prototype.setCoordinates=function(e){var r=this;this.coordinates=e;var i=e.map(t.MercatorCoordinate.fromLngLat);this.tileID=function(e){for(var r=1/0,i=1/0,n=-1/0,o=-1/0,a=0,s=e;a<s.length;a+=1){var l=s[a];r=Math.min(r,l.x),i=Math.min(i,l.y),n=Math.max(n,l.x),o=Math.max(o,l.y)}var c=Math.max(n-r,o-i),u=Math.max(0,Math.floor(-Math.log(c)/Math.LN2)),h=Math.pow(2,u);return new t.CanonicalTileID(u,Math.floor((r+n)/2*h),Math.floor((i+o)/2*h))}(i),this.minzoom=this.maxzoom=this.tileID.z;var n=i.map((function(t){return r.tileID.getTilePoint(t)._round()}));return this._boundsArray=new t.StructArrayLayout4i8,this._boundsArray.emplaceBack(n[0].x,n[0].y,0,0),this._boundsArray.emplaceBack(n[1].x,n[1].y,t.EXTENT,0),this._boundsArray.emplaceBack(n[3].x,n[3].y,0,t.EXTENT),this._boundsArray.emplaceBack(n[2].x,n[2].y,t.EXTENT,t.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})),this},r.prototype.prepare=function(){if(0!==Object.keys(this.tiles).length&&this.image){var e=this.map.painter.context,r=e.gl;for(var i in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,F.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new t.Texture(e,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE)),this.tiles){var n=this.tiles[i];"loaded"!==n.state&&(n.state="loaded",n.texture=this.texture)}}},r.prototype.loadTile=function(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null))},r.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},r.prototype.hasTransition=function(){return!1},r}(t.Evented),L=function(e){function r(t,r,i,n){e.call(this,t,r,i,n),this.roundZoom=!0,this.type="video",this.options=r}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.load=function(){var e=this;this._loaded=!1;var r=this.options;this.urls=[];for(var i=0,n=r.urls;i<n.length;i+=1)this.urls.push(this.map._requestManager.transformRequest(n[i],t.ResourceType.Source).url);t.getVideo(this.urls,(function(r,i){e._loaded=!0,r?e.fire(new t.ErrorEvent(r)):i&&(e.video=i,e.video.loop=!0,e.video.addEventListener("playing",(function(){e.map.triggerRepaint()})),e.map&&e.video.play(),e._finishLoading())}))},r.prototype.pause=function(){this.video&&this.video.pause()},r.prototype.play=function(){this.video&&this.video.play()},r.prototype.seek=function(e){if(this.video){var r=this.video.seekable;e<r.start(0)||e>r.end(0)?this.fire(new t.ErrorEvent(new t.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+r.start(0)+" and "+r.end(0)+"-second mark."))):this.video.currentTime=e}},r.prototype.getVideo=function(){return this.video},r.prototype.onAdd=function(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},r.prototype.prepare=function(){if(!(0===Object.keys(this.tiles).length||this.video.readyState<2)){var e=this.map.painter.context,r=e.gl;for(var i in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,F.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new t.Texture(e,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE)),this.tiles){var n=this.tiles[i];"loaded"!==n.state&&(n.state="loaded",n.texture=this.texture)}}},r.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},r.prototype.hasTransition=function(){return this.video&&!this.video.paused},r}(P),D=function(e){function r(r,i,n,o){e.call(this,r,i,n,o),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some((function(t){return!Array.isArray(t)||2!==t.length||t.some((function(t){return"number"!=typeof t}))}))||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+r,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+r,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new t.ErrorEvent(new t.ValidationError("sources."+r,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof t.window.HTMLCanvasElement||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+r,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+r,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof t.window.HTMLCanvasElement?this.options.canvas:t.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},r.prototype.getCanvas=function(){return this.canvas},r.prototype.onAdd=function(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()},r.prototype.onRemove=function(){this.pause()},r.prototype.prepare=function(){var e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),!this._hasInvalidDimensions()&&0!==Object.keys(this.tiles).length){var r=this.map.painter.context,i=r.gl;for(var n in this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,F.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.Texture(r,this.canvas,i.RGBA,{premultiply:!0}),this.tiles){var o=this.tiles[n];"loaded"!==o.state&&(o.state="loaded",o.texture=this.texture)}}},r.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},r.prototype.hasTransition=function(){return this._playing},r.prototype._hasInvalidDimensions=function(){for(var t=0,e=[this.canvas.width,this.canvas.height];t<e.length;t+=1){var r=e[t];if(isNaN(r)||r<=0)return!0}return!1},r}(P),U={vector:T,raster:I,"raster-dem":S,geojson:M,video:L,image:P,canvas:D};function k(e,r){var i=t.identity([]);return t.translate(i,i,[1,1,0]),t.scale(i,i,[.5*e.width,.5*e.height,1]),t.multiply(i,i,e.calculatePosMatrix(r.toUnwrapped()))}function z(t,e,r,i,n,o){var a=function(t,e,r){if(t)for(var i=0,n=t;i<n.length;i+=1){var o=e[n[i]];if(o&&o.source===r&&"fill-extrusion"===o.type)return!0}else for(var a in e){var s=e[a];if(s.source===r&&"fill-extrusion"===s.type)return!0}return!1}(n&&n.layers,e,t.id),s=o.maxPitchScaleFactor(),l=t.tilesIn(i,s,a);l.sort(R);for(var c=[],u=0,h=l;u<h.length;u+=1){var A=h[u];c.push({wrappedTileID:A.tileID.wrapped().key,queryResults:A.tile.queryRenderedFeatures(e,r,t._state,A.queryGeometry,A.cameraQueryGeometry,A.scale,n,o,s,k(t.transform,A.tileID))})}var p=function(t){for(var e={},r={},i=0,n=t;i<n.length;i+=1){var o=n[i],a=o.queryResults,s=o.wrappedTileID,l=r[s]=r[s]||{};for(var c in a)for(var u=a[c],h=l[c]=l[c]||{},A=e[c]=e[c]||[],p=0,d=u;p<d.length;p+=1){var f=d[p];h[f.featureIndex]||(h[f.featureIndex]=!0,A.push(f))}}return e}(c);for(var d in p)p[d].forEach((function(e){var r=e.feature,i=t.getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=i}));return p}function R(t,e){var r=t.tileID,i=e.tileID;return r.overscaledZ-i.overscaledZ||r.canonical.y-i.canonical.y||r.wrap-i.wrap||r.canonical.x-i.canonical.x}var O=function(t,e){this.max=t,this.onRemove=e,this.reset()};O.prototype.reset=function(){for(var t in this.data)for(var e=0,r=this.data[t];e<r.length;e+=1){var i=r[e];i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value)}return this.data={},this.order=[],this},O.prototype.add=function(t,e,r){var i=this,n=t.wrapped().key;void 0===this.data[n]&&(this.data[n]=[]);var o={value:e,timeout:void 0};if(void 0!==r&&(o.timeout=setTimeout((function(){i.remove(t,o)}),r)),this.data[n].push(o),this.order.push(n),this.order.length>this.max){var a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this},O.prototype.has=function(t){return t.wrapped().key in this.data},O.prototype.getAndRemove=function(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null},O.prototype._getAndRemoveByKey=function(t){var e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value},O.prototype.getByKey=function(t){var e=this.data[t];return e?e[0].value:null},O.prototype.get=function(t){return this.has(t)?this.data[t.wrapped().key][0].value:null},O.prototype.remove=function(t,e){if(!this.has(t))return this;var r=t.wrapped().key,i=void 0===e?0:this.data[r].indexOf(e),n=this.data[r][i];return this.data[r].splice(i,1),n.timeout&&clearTimeout(n.timeout),0===this.data[r].length&&delete this.data[r],this.onRemove(n.value),this.order.splice(this.order.indexOf(r),1),this},O.prototype.setMaxSize=function(t){for(this.max=t;this.order.length>this.max;){var e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this},O.prototype.filter=function(t){var e=[];for(var r in this.data)for(var i=0,n=this.data[r];i<n.length;i+=1){var o=n[i];t(o.value)||e.push(o)}for(var a=0,s=e;a<s.length;a+=1){var l=s[a];this.remove(l.value.tileID,l)}};var Q=function(t,e,r){this.context=t;var i=t.gl;this.buffer=i.createBuffer(),this.dynamicDraw=Boolean(r),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};Q.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},Q.prototype.updateData=function(t){var e=this.context.gl;this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)},Q.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var N={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},V=function(t,e,r,i){this.length=e.length,this.attributes=r,this.itemSize=e.bytesPerElement,this.dynamicDraw=i,this.context=t;var n=t.gl;this.buffer=n.createBuffer(),t.bindVertexBuffer.set(this.buffer),n.bufferData(n.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};V.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},V.prototype.updateData=function(t){var e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)},V.prototype.enableAttributes=function(t,e){for(var r=0;r<this.attributes.length;r++){var i=e.attributes[this.attributes[r].name];void 0!==i&&t.enableVertexAttribArray(i)}},V.prototype.setVertexAttribPointers=function(t,e,r){for(var i=0;i<this.attributes.length;i++){var n=this.attributes[i],o=e.attributes[n.name];void 0!==o&&t.vertexAttribPointer(o,n.components,t[N[n.type]],!1,this.itemSize,n.offset+this.itemSize*(r||0))}},V.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var H=function(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};H.prototype.get=function(){return this.current},H.prototype.set=function(t){},H.prototype.getDefault=function(){return this.default},H.prototype.setDefault=function(){this.set(this.default)};var j=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.getDefault=function(){return t.Color.transparent},r.prototype.set=function(t){var e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)},r}(H),G=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 1},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)},e}(H),K=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)},e}(H),q=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return[!0,!0,!0,!0]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)},e}(H),Z=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)},e}(H),W=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 255},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)},e}(H),X=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},e.prototype.set=function(t){var e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)},e}(H),$=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)},e}(H),Y=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}},e}(H),J=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return[0,1]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)},e}(H),tt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}},e}(H),et=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.LESS},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)},e}(H),rt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}},e}(H),it=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[t.ONE,t.ZERO]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)},e}(H),nt=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.getDefault=function(){return t.Color.transparent},r.prototype.set=function(t){var e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)},r}(H),ot=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.FUNC_ADD},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)},e}(H),at=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}},e}(H),st=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.BACK},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)},e}(H),lt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.CCW},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)},e}(H),ct=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)},e}(H),ut=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.TEXTURE0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)},e}(H),ht=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)},e}(H),At=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}},e}(H),pt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}},e}(H),dt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}},e}(H),ft=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}},e}(H),mt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){var e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1},e}(H),gt=function(t){function e(e){t.call(this,e),this.vao=e.extVertexArrayObject}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)},e}(H),_t=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 4},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}},e}(H),yt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}},e}(H),vt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}},e}(H),xt=function(t){function e(e,r){t.call(this,e),this.context=e,this.parent=r}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e}(H),wt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.setDirty=function(){this.dirty=!0},e.prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}},e}(xt),bt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t),this.current=t,this.dirty=!1}},e}(xt),Bt=function(t,e,r,i){this.context=t,this.width=e,this.height=r;var n=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new wt(t,n),i&&(this.depthAttachment=new bt(t,n))};Bt.prototype.destroy=function(){var t=this.context.gl,e=this.colorAttachment.get();if(e&&t.deleteTexture(e),this.depthAttachment){var r=this.depthAttachment.get();r&&t.deleteRenderbuffer(r)}t.deleteFramebuffer(this.framebuffer)};var Ct=function(t,e,r){this.func=t,this.mask=e,this.range=r};Ct.ReadOnly=!1,Ct.ReadWrite=!0,Ct.disabled=new Ct(519,Ct.ReadOnly,[0,1]);var Et=function(t,e,r,i,n,o){this.test=t,this.ref=e,this.mask=r,this.fail=i,this.depthFail=n,this.pass=o};Et.disabled=new Et({func:519,mask:0},0,0,7680,7680,7680);var Tt=function(t,e,r){this.blendFunction=t,this.blendColor=e,this.mask=r};Tt.disabled=new Tt(Tt.Replace=[1,0],t.Color.transparent,[!1,!1,!1,!1]),Tt.unblended=new Tt(Tt.Replace,t.Color.transparent,[!0,!0,!0,!0]),Tt.alphaBlended=new Tt([1,771],t.Color.transparent,[!0,!0,!0,!0]);var It=function(t,e,r){this.enable=t,this.mode=e,this.frontFace=r};It.disabled=new It(!1,1029,2305),It.backCCW=new It(!0,1029,2305);var St=function(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new j(this),this.clearDepth=new G(this),this.clearStencil=new K(this),this.colorMask=new q(this),this.depthMask=new Z(this),this.stencilMask=new W(this),this.stencilFunc=new X(this),this.stencilOp=new $(this),this.stencilTest=new Y(this),this.depthRange=new J(this),this.depthTest=new tt(this),this.depthFunc=new et(this),this.blend=new rt(this),this.blendFunc=new it(this),this.blendColor=new nt(this),this.blendEquation=new ot(this),this.cullFace=new at(this),this.cullFaceSide=new st(this),this.frontFace=new lt(this),this.program=new ct(this),this.activeTexture=new ut(this),this.viewport=new ht(this),this.bindFramebuffer=new At(this),this.bindRenderbuffer=new pt(this),this.bindTexture=new dt(this),this.bindVertexBuffer=new ft(this),this.bindElementBuffer=new mt(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new gt(this),this.pixelStoreUnpack=new _t(this),this.pixelStoreUnpackPremultiplyAlpha=new yt(this),this.pixelStoreUnpackFlipY=new vt(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)};St.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},St.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},St.prototype.createIndexBuffer=function(t,e){return new Q(this,t,e)},St.prototype.createVertexBuffer=function(t,e,r){return new V(this,t,e,r)},St.prototype.createRenderbuffer=function(t,e,r){var i=this.gl,n=i.createRenderbuffer();return this.bindRenderbuffer.set(n),i.renderbufferStorage(i.RENDERBUFFER,t,e,r),this.bindRenderbuffer.set(null),n},St.prototype.createFramebuffer=function(t,e,r){return new Bt(this,t,e,r)},St.prototype.clear=function(t){var e=t.color,r=t.depth,i=this.gl,n=0;e&&(n|=i.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==r&&(n|=i.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),i.clear(n)},St.prototype.setCullFace=function(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))},St.prototype.setDepthMode=function(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)},St.prototype.setStencilMode=function(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)},St.prototype.setColorMode=function(e){t.deepEqual(e.blendFunction,Tt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)},St.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Mt=function(e){function r(r,i,n){var o=this;e.call(this),this.id=r,this.dispatcher=n,this.on("data",(function(t){"source"===t.dataType&&"metadata"===t.sourceDataType&&(o._sourceLoaded=!0),o._sourceLoaded&&!o._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(o.reload(),o.transform&&o.update(o.transform))})),this.on("error",(function(){o._sourceErrored=!0})),this._source=function(e,r,i,n){var o=new U[r.type](e,r,i,n);if(o.id!==e)throw new Error("Expected Source id to be "+e+" instead of "+o.id);return t.bindAll(["load","abort","unload","serialize","prepare"],o),o}(r,i,n,this),this._tiles={},this._cache=new O(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new t.SourceFeatureState}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.onAdd=function(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)},r.prototype.onRemove=function(t){this._source&&this._source.onRemove&&this._source.onRemove(t)},r.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(var t in this._tiles){var e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0},r.prototype.getSource=function(){return this._source},r.prototype.pause=function(){this._paused=!0},r.prototype.resume=function(){if(this._paused){var t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}},r.prototype._loadTile=function(t,e){return this._source.loadTile(t,e)},r.prototype._unloadTile=function(t){if(this._source.unloadTile)return this._source.unloadTile(t,(function(){}))},r.prototype._abortTile=function(t){if(this._source.abortTile)return this._source.abortTile(t,(function(){}))},r.prototype.serialize=function(){return this._source.serialize()},r.prototype.prepare=function(t){for(var e in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var r=this._tiles[e];r.upload(t),r.prepare(this.map.style.imageManager)}},r.prototype.getIds=function(){return t.values(this._tiles).map((function(t){return t.tileID})).sort(Ft).map((function(t){return t.key}))},r.prototype.getRenderableIds=function(e){var r=this,i=[];for(var n in this._tiles)this._isIdRenderable(n,e)&&i.push(this._tiles[n]);return e?i.sort((function(e,i){var n=e.tileID,o=i.tileID,a=new t.Point(n.canonical.x,n.canonical.y)._rotate(r.transform.angle),s=new t.Point(o.canonical.x,o.canonical.y)._rotate(r.transform.angle);return n.overscaledZ-o.overscaledZ||s.y-a.y||s.x-a.x})).map((function(t){return t.tileID.key})):i.map((function(t){return t.tileID})).sort(Ft).map((function(t){return t.key}))},r.prototype.hasRenderableParent=function(t){var e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)},r.prototype._isIdRenderable=function(t,e){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())},r.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var t in this._cache.reset(),this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(t,"reloading")},r.prototype._reloadTile=function(t,e){var r=this._tiles[t];r&&("loading"!==r.state&&(r.state=e),this._loadTile(r,this._tileLoaded.bind(this,r,t,e)))},r.prototype._tileLoaded=function(e,r,i,n){if(n)return e.state="errored",void(404!==n.status?this._source.fire(new t.ErrorEvent(n,{tile:e})):this.update(this.transform));e.timeAdded=t.browser.now(),"expired"===i&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new t.Event("data",{dataType:"source",tile:e,coord:e.tileID}))},r.prototype._backfillDEM=function(t){for(var e=this.getRenderableIds(),r=0;r<e.length;r++){var i=e[r];if(t.neighboringTiles&&t.neighboringTiles[i]){var n=this.getTileByID(i);o(t,n),o(n,t)}}function o(t,e){t.needsHillshadePrepare=!0;var r=e.tileID.canonical.x-t.tileID.canonical.x,i=e.tileID.canonical.y-t.tileID.canonical.y,n=Math.pow(2,t.tileID.canonical.z),o=e.tileID.key;0===r&&0===i||Math.abs(i)>1||(Math.abs(r)>1&&(1===Math.abs(r+n)?r+=n:1===Math.abs(r-n)&&(r-=n)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,r,i),t.neighboringTiles&&t.neighboringTiles[o]&&(t.neighboringTiles[o].backfilled=!0)))}},r.prototype.getTile=function(t){return this.getTileByID(t.key)},r.prototype.getTileByID=function(t){return this._tiles[t]},r.prototype._retainLoadedChildren=function(t,e,r,i){for(var n in this._tiles){var o=this._tiles[n];if(!(i[n]||!o.hasData()||o.tileID.overscaledZ<=e||o.tileID.overscaledZ>r)){for(var a=o.tileID;o&&o.tileID.overscaledZ>e+1;){var s=o.tileID.scaledTo(o.tileID.overscaledZ-1);(o=this._tiles[s.key])&&o.hasData()&&(a=s)}for(var l=a;l.overscaledZ>e;)if(t[(l=l.scaledTo(l.overscaledZ-1)).key]){i[a.key]=a;break}}}},r.prototype.findLoadedParent=function(t,e){if(t.key in this._loadedParentTiles){var r=this._loadedParentTiles[t.key];return r&&r.tileID.overscaledZ>=e?r:null}for(var i=t.overscaledZ-1;i>=e;i--){var n=t.scaledTo(i),o=this._getLoadedTile(n);if(o)return o}},r.prototype._getLoadedTile=function(t){var e=this._tiles[t.key];return e&&e.hasData()?e:this._cache.getByKey(t.wrapped().key)},r.prototype.updateCacheSize=function(t){var e=Math.ceil(t.width/this._source.tileSize)+1,r=Math.ceil(t.height/this._source.tileSize)+1,i=Math.floor(e*r*5),n="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,i):i;this._cache.setMaxSize(n)},r.prototype.handleWrapJump=function(t){var e=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,e){var r={};for(var i in this._tiles){var n=this._tiles[i];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+e),r[n.tileID.key]=n}for(var o in this._tiles=r,this._timers)clearTimeout(this._timers[o]),delete this._timers[o];for(var a in this._tiles)this._setTileReloadTimer(a,this._tiles[a])}},r.prototype.update=function(e){var i=this;if(this.transform=e,this._sourceLoaded&&!this._paused){var n;this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?n=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((function(e){return new t.OverscaledTileID(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y)})):(n=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(n=n.filter((function(t){return i._source.hasTile(t)})))):n=[];var o=e.coveringZoomLevel(this._source),a=Math.max(o-r.maxOverzooming,this._source.minzoom),s=Math.max(o+r.maxUnderzooming,this._source.minzoom),l=this._updateRetainedTiles(n,o);if(Pt(this._source.type)){for(var c={},u={},h=0,A=Object.keys(l);h<A.length;h+=1){var p=A[h],d=l[p],f=this._tiles[p];if(f&&!(f.fadeEndTime&&f.fadeEndTime<=t.browser.now())){var m=this.findLoadedParent(d,a);m&&(this._addTile(m.tileID),c[m.tileID.key]=m.tileID),u[p]=d}}for(var g in this._retainLoadedChildren(u,o,s,l),c)l[g]||(this._coveredTiles[g]=!0,l[g]=c[g])}for(var _ in l)this._tiles[_].clearFadeHold();for(var y=0,v=t.keysDifference(this._tiles,l);y<v.length;y+=1){var x=v[y],w=this._tiles[x];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(x)}this._updateLoadedParentTileCache()}},r.prototype.releaseSymbolFadeTiles=function(){for(var t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)},r.prototype._updateRetainedTiles=function(t,e){for(var i={},n={},o=Math.max(e-r.maxOverzooming,this._source.minzoom),a=Math.max(e+r.maxUnderzooming,this._source.minzoom),s={},l=0,c=t;l<c.length;l+=1){var u=c[l],h=this._addTile(u);i[u.key]=u,h.hasData()||e<this._source.maxzoom&&(s[u.key]=u)}this._retainLoadedChildren(s,e,a,i);for(var A=0,p=t;A<p.length;A+=1){var d=p[A],f=this._tiles[d.key];if(!f.hasData()){if(e+1>this._source.maxzoom){var m=d.children(this._source.maxzoom)[0],g=this.getTile(m);if(g&&g.hasData()){i[m.key]=m;continue}}else{var _=d.children(this._source.maxzoom);if(i[_[0].key]&&i[_[1].key]&&i[_[2].key]&&i[_[3].key])continue}for(var y=f.wasRequested(),v=d.overscaledZ-1;v>=o;--v){var x=d.scaledTo(v);if(n[x.key])break;if(n[x.key]=!0,!(f=this.getTile(x))&&y&&(f=this._addTile(x)),f&&(i[x.key]=x,y=f.wasRequested(),f.hasData()))break}}}return i},r.prototype._updateLoadedParentTileCache=function(){for(var t in this._loadedParentTiles={},this._tiles){for(var e=[],r=void 0,i=this._tiles[t].tileID;i.overscaledZ>0;){if(i.key in this._loadedParentTiles){r=this._loadedParentTiles[i.key];break}e.push(i.key);var n=i.scaledTo(i.overscaledZ-1);if(r=this._getLoadedTile(n))break;i=n}for(var o=0,a=e;o<a.length;o+=1)this._loadedParentTiles[a[o]]=r}},r.prototype._addTile=function(e){var r=this._tiles[e.key];if(r)return r;(r=this._cache.getAndRemove(e))&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));var i=Boolean(r);return i||(r=new t.Tile(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(r,this._tileLoaded.bind(this,r,e.key,r.state))),r?(r.uses++,this._tiles[e.key]=r,i||this._source.fire(new t.Event("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null},r.prototype._setTileReloadTimer=function(t,e){var r=this;t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);var i=e.getExpiryTimeout();i&&(this._timers[t]=setTimeout((function(){r._reloadTile(t,"expired"),delete r._timers[t]}),i))},r.prototype._removeTile=function(t){var e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()&&"reloading"!==e.state?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))},r.prototype.clearTiles=function(){for(var t in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(t);this._cache.reset()},r.prototype.tilesIn=function(e,r,i){var n=this,o=[],a=this.transform;if(!a)return o;for(var s=i?a.getCameraQueryGeometry(e):e,l=e.map((function(t){return a.pointCoordinate(t)})),c=s.map((function(t){return a.pointCoordinate(t)})),u=this.getIds(),h=1/0,A=1/0,p=-1/0,d=-1/0,f=0,m=c;f<m.length;f+=1){var g=m[f];h=Math.min(h,g.x),A=Math.min(A,g.y),p=Math.max(p,g.x),d=Math.max(d,g.y)}for(var _=function(e){var i=n._tiles[u[e]];if(!i.holdingForFade()){var s=i.tileID,f=Math.pow(2,a.zoom-i.tileID.overscaledZ),m=r*i.queryPadding*t.EXTENT/i.tileSize/f,g=[s.getTilePoint(new t.MercatorCoordinate(h,A)),s.getTilePoint(new t.MercatorCoordinate(p,d))];if(g[0].x-m<t.EXTENT&&g[0].y-m<t.EXTENT&&g[1].x+m>=0&&g[1].y+m>=0){var _=l.map((function(t){return s.getTilePoint(t)})),y=c.map((function(t){return s.getTilePoint(t)}));o.push({tile:i,tileID:s,queryGeometry:_,cameraQueryGeometry:y,scale:f})}}},y=0;y<u.length;y++)_(y);return o},r.prototype.getVisibleCoordinates=function(t){for(var e=this,r=this.getRenderableIds(t).map((function(t){return e._tiles[t].tileID})),i=0,n=r;i<n.length;i+=1){var o=n[i];o.posMatrix=this.transform.calculatePosMatrix(o.toUnwrapped())}return r},r.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Pt(this._source.type))for(var e in this._tiles){var r=this._tiles[e];if(void 0!==r.fadeEndTime&&r.fadeEndTime>=t.browser.now())return!0}return!1},r.prototype.setFeatureState=function(t,e,r){this._state.updateState(t=t||"_geojsonTileLayer",e,r)},r.prototype.removeFeatureState=function(t,e,r){this._state.removeFeatureState(t=t||"_geojsonTileLayer",e,r)},r.prototype.getFeatureState=function(t,e){return this._state.getState(t=t||"_geojsonTileLayer",e)},r.prototype.setDependencies=function(t,e,r){var i=this._tiles[t];i&&i.setDependencies(e,r)},r.prototype.reloadTilesForDependencies=function(t,e){for(var r in this._tiles)this._tiles[r].hasDependency(t,e)&&this._reloadTile(r,"reloading");this._cache.filter((function(r){return!r.hasDependency(t,e)}))},r}(t.Evented);function Ft(t,e){var r=Math.abs(2*t.wrap)-+(t.wrap<0),i=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||i-r||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function Pt(t){return"raster"===t||"image"===t||"video"===t}function Lt(){return new t.window.Worker(Xn.workerUrl)}Mt.maxOverzooming=10,Mt.maxUnderzooming=3;var Dt="mapboxgl_preloaded_worker_pool",Ut=function(){this.active={}};Ut.prototype.acquire=function(t){if(!this.workers)for(this.workers=[];this.workers.length<Ut.workerCount;)this.workers.push(new Lt);return this.active[t]=!0,this.workers.slice()},Ut.prototype.release=function(t){delete this.active[t],0===this.numActive()&&(this.workers.forEach((function(t){t.terminate()})),this.workers=null)},Ut.prototype.isPreloaded=function(){return!!this.active[Dt]},Ut.prototype.numActive=function(){return Object.keys(this.active).length};var kt,zt=Math.floor(t.browser.hardwareConcurrency/2);function Rt(){return kt||(kt=new Ut),kt}function Ot(e,r){var i={};for(var n in e)"ref"!==n&&(i[n]=e[n]);return t.refProperties.forEach((function(t){t in r&&(i[t]=r[t])})),i}function Qt(t){t=t.slice();for(var e=Object.create(null),r=0;r<t.length;r++)e[t[r].id]=t[r];for(var i=0;i<t.length;i++)"ref"in t[i]&&(t[i]=Ot(t[i],e[t[i].ref]));return t}Ut.workerCount=Math.max(Math.min(zt,6),1);var Nt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Vt(t,e,r){r.push({command:Nt.addSource,args:[t,e[t]]})}function Ht(t,e,r){e.push({command:Nt.removeSource,args:[t]}),r[t]=!0}function jt(t,e,r,i){Ht(t,r,i),Vt(t,e,r)}function Gt(e,r,i){var n;for(n in e[i])if(e[i].hasOwnProperty(n)&&"data"!==n&&!t.deepEqual(e[i][n],r[i][n]))return!1;for(n in r[i])if(r[i].hasOwnProperty(n)&&"data"!==n&&!t.deepEqual(e[i][n],r[i][n]))return!1;return!0}function Kt(e,r,i,n,o,a){var s;for(s in r=r||{},e=e||{})e.hasOwnProperty(s)&&(t.deepEqual(e[s],r[s])||i.push({command:a,args:[n,s,r[s],o]}));for(s in r)r.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(t.deepEqual(e[s],r[s])||i.push({command:a,args:[n,s,r[s],o]}))}function qt(t){return t.id}function Zt(t,e){return t[e.id]=e,t}var Wt=function(t,e){this.reset(t,e)};Wt.prototype.reset=function(t,e){this.points=t||[],this._distances=[0];for(var r=1;r<this.points.length;r++)this._distances[r]=this._distances[r-1]+this.points[r].dist(this.points[r-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(e||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Wt.prototype.lerp=function(e){if(1===this.points.length)return this.points[0];e=t.clamp(e,0,1);for(var r=1,i=this._distances[r],n=e*this.paddedLength+this.padding;i<n&&r<this._distances.length;)i=this._distances[++r];var o=r-1,a=this._distances[o],s=i-a,l=s>0?(n-a)/s:0;return this.points[o].mult(1-l).add(this.points[r].mult(l))};var Xt=function(t,e,r){var i=this.boxCells=[],n=this.circleCells=[];this.xCellCount=Math.ceil(t/r),this.yCellCount=Math.ceil(e/r);for(var o=0;o<this.xCellCount*this.yCellCount;o++)i.push([]),n.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0};function $t(e,r,i,n,o){var a=t.create();return r?(t.scale(a,a,[1/o,1/o,1]),i||t.rotateZ(a,a,n.angle)):t.multiply(a,n.labelPlaneMatrix,e),a}function Yt(e,r,i,n,o){if(r){var a=t.clone(e);return t.scale(a,a,[o,o,1]),i||t.rotateZ(a,a,-n.angle),a}return n.glCoordMatrix}function Jt(e,r){var i=[e.x,e.y,0,1];ue(i,i,r);var n=i[3];return{point:new t.Point(i[0]/n,i[1]/n),signedDistanceFromCamera:n}}function te(t,e){return.5+t/e*.5}function ee(t,e){var r=t[0]/t[3],i=t[1]/t[3];return r>=-e[0]&&r<=e[0]&&i>=-e[1]&&i<=e[1]}function re(e,r,i,n,o,a,s,l){var c=n?e.textSizeData:e.iconSizeData,u=t.evaluateSizeForZoom(c,i.transform.zoom),h=[256/i.width*2+1,256/i.height*2+1],A=n?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;A.clear();for(var p=e.lineVertexArray,d=n?e.text.placedSymbolArray:e.icon.placedSymbolArray,f=i.transform.width/i.transform.height,m=!1,g=0;g<d.length;g++){var _=d.get(g);if(_.hidden||_.writingMode===t.WritingMode.vertical&&!m)ce(_.numGlyphs,A);else{m=!1;var y=[_.anchorX,_.anchorY,0,1];if(t.transformMat4(y,y,r),ee(y,h)){var v=te(i.transform.cameraToCenterDistance,y[3]),x=t.evaluateSizeForFeature(c,u,_),w=s?x/v:x*v,b=new t.Point(_.anchorX,_.anchorY),B=Jt(b,o).point,C={},E=oe(_,w,!1,l,r,o,a,e.glyphOffsetArray,p,A,B,b,C,f);m=E.useVertical,(E.notEnoughRoom||m||E.needsFlipping&&oe(_,w,!0,l,r,o,a,e.glyphOffsetArray,p,A,B,b,C,f).notEnoughRoom)&&ce(_.numGlyphs,A)}else ce(_.numGlyphs,A)}}n?e.text.dynamicLayoutVertexBuffer.updateData(A):e.icon.dynamicLayoutVertexBuffer.updateData(A)}function ie(t,e,r,i,n,o,a,s,l,c,u){var h=s.glyphStartIndex+s.numGlyphs,A=s.lineStartIndex,p=s.lineStartIndex+s.lineLength,d=e.getoffsetX(s.glyphStartIndex),f=e.getoffsetX(h-1),m=se(t*d,r,i,n,o,a,s.segment,A,p,l,c,u);if(!m)return null;var g=se(t*f,r,i,n,o,a,s.segment,A,p,l,c,u);return g?{first:m,last:g}:null}function ne(e,r,i,n){return e===t.WritingMode.horizontal&&Math.abs(i.y-r.y)>Math.abs(i.x-r.x)*n?{useVertical:!0}:(e===t.WritingMode.vertical?r.y<i.y:r.x>i.x)?{needsFlipping:!0}:null}function oe(e,r,i,n,o,a,s,l,c,u,h,A,p,d){var f,m=r/24,g=e.lineOffsetX*m,_=e.lineOffsetY*m;if(e.numGlyphs>1){var y=e.glyphStartIndex+e.numGlyphs,v=e.lineStartIndex,x=e.lineStartIndex+e.lineLength,w=ie(m,l,g,_,i,h,A,e,c,a,p);if(!w)return{notEnoughRoom:!0};var b=Jt(w.first.point,s).point,B=Jt(w.last.point,s).point;if(n&&!i){var C=ne(e.writingMode,b,B,d);if(C)return C}f=[w.first];for(var E=e.glyphStartIndex+1;E<y-1;E++)f.push(se(m*l.getoffsetX(E),g,_,i,h,A,e.segment,v,x,c,a,p));f.push(w.last)}else{if(n&&!i){var T=Jt(A,o).point,I=e.lineStartIndex+e.segment+1,S=new t.Point(c.getx(I),c.gety(I)),M=Jt(S,o),F=M.signedDistanceFromCamera>0?M.point:ae(A,S,T,1,o),P=ne(e.writingMode,T,F,d);if(P)return P}var L=se(m*l.getoffsetX(e.glyphStartIndex),g,_,i,h,A,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,c,a,p);if(!L)return{notEnoughRoom:!0};f=[L]}for(var D=0,U=f;D<U.length;D+=1){var k=U[D];t.addDynamicAttributes(u,k.point,k.angle)}return{}}function ae(t,e,r,i,n){var o=Jt(t.add(t.sub(e)._unit()),n).point,a=r.sub(o);return r.add(a._mult(i/a.mag()))}function se(e,r,i,n,o,a,s,l,c,u,h,A){var p=n?e-r:e+r,d=p>0?1:-1,f=0;n&&(d*=-1,f=Math.PI),d<0&&(f+=Math.PI);for(var m=d>0?l+s:l+s+1,g=o,_=o,y=0,v=0,x=Math.abs(p),w=[];y+v<=x;){if((m+=d)<l||m>=c)return null;if(_=g,w.push(g),void 0===(g=A[m])){var b=new t.Point(u.getx(m),u.gety(m)),B=Jt(b,h);if(B.signedDistanceFromCamera>0)g=A[m]=B.point;else{var C=m-d;g=ae(0===y?a:new t.Point(u.getx(C),u.gety(C)),b,_,x-y+1,h)}}y+=v,v=_.dist(g)}var E=(x-y)/v,T=g.sub(_),I=T.mult(E)._add(_);I._add(T._unit()._perp()._mult(i*d));var S=f+Math.atan2(g.y-_.y,g.x-_.x);return w.push(I),{point:I,angle:S,path:w}}Xt.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Xt.prototype.insert=function(t,e,r,i,n){this._forEachCell(e,r,i,n,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(i),this.bboxes.push(n)},Xt.prototype.insertCircle=function(t,e,r,i){this._forEachCell(e-i,r-i,e+i,r+i,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(r),this.circles.push(i)},Xt.prototype._insertBoxCell=function(t,e,r,i,n,o){this.boxCells[n].push(o)},Xt.prototype._insertCircleCell=function(t,e,r,i,n,o){this.circleCells[n].push(o)},Xt.prototype._query=function(t,e,r,i,n,o){if(r<0||t>this.width||i<0||e>this.height)return!n&&[];var a=[];if(t<=0&&e<=0&&this.width<=r&&this.height<=i){if(n)return!0;for(var s=0;s<this.boxKeys.length;s++)a.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});for(var l=0;l<this.circleKeys.length;l++){var c=this.circles[3*l],u=this.circles[3*l+1],h=this.circles[3*l+2];a.push({key:this.circleKeys[l],x1:c-h,y1:u-h,x2:c+h,y2:u+h})}return o?a.filter(o):a}return this._forEachCell(t,e,r,i,this._queryCell,a,{hitTest:n,seenUids:{box:{},circle:{}}},o),n?a.length>0:a},Xt.prototype._queryCircle=function(t,e,r,i,n){var o=t-r,a=t+r,s=e-r,l=e+r;if(a<0||o>this.width||l<0||s>this.height)return!i&&[];var c=[];return this._forEachCell(o,s,a,l,this._queryCellCircle,c,{hitTest:i,circle:{x:t,y:e,radius:r},seenUids:{box:{},circle:{}}},n),i?c.length>0:c},Xt.prototype.query=function(t,e,r,i,n){return this._query(t,e,r,i,!1,n)},Xt.prototype.hitTest=function(t,e,r,i,n){return this._query(t,e,r,i,!0,n)},Xt.prototype.hitTestCircle=function(t,e,r,i){return this._queryCircle(t,e,r,!0,i)},Xt.prototype._queryCell=function(t,e,r,i,n,o,a,s){var l=a.seenUids,c=this.boxCells[n];if(null!==c)for(var u=this.bboxes,h=0,A=c;h<A.length;h+=1){var p=A[h];if(!l.box[p]){l.box[p]=!0;var d=4*p;if(t<=u[d+2]&&e<=u[d+3]&&r>=u[d+0]&&i>=u[d+1]&&(!s||s(this.boxKeys[p]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[p],x1:u[d],y1:u[d+1],x2:u[d+2],y2:u[d+3]})}}}var f=this.circleCells[n];if(null!==f)for(var m=this.circles,g=0,_=f;g<_.length;g+=1){var y=_[g];if(!l.circle[y]){l.circle[y]=!0;var v=3*y;if(this._circleAndRectCollide(m[v],m[v+1],m[v+2],t,e,r,i)&&(!s||s(this.circleKeys[y]))){if(a.hitTest)return o.push(!0),!0;var x=m[v],w=m[v+1],b=m[v+2];o.push({key:this.circleKeys[y],x1:x-b,y1:w-b,x2:x+b,y2:w+b})}}}},Xt.prototype._queryCellCircle=function(t,e,r,i,n,o,a,s){var l=a.circle,c=a.seenUids,u=this.boxCells[n];if(null!==u)for(var h=this.bboxes,A=0,p=u;A<p.length;A+=1){var d=p[A];if(!c.box[d]){c.box[d]=!0;var f=4*d;if(this._circleAndRectCollide(l.x,l.y,l.radius,h[f+0],h[f+1],h[f+2],h[f+3])&&(!s||s(this.boxKeys[d])))return o.push(!0),!0}}var m=this.circleCells[n];if(null!==m)for(var g=this.circles,_=0,y=m;_<y.length;_+=1){var v=y[_];if(!c.circle[v]){c.circle[v]=!0;var x=3*v;if(this._circlesCollide(g[x],g[x+1],g[x+2],l.x,l.y,l.radius)&&(!s||s(this.circleKeys[v])))return o.push(!0),!0}}},Xt.prototype._forEachCell=function(t,e,r,i,n,o,a,s){for(var l=this._convertToXCellCoord(t),c=this._convertToYCellCoord(e),u=this._convertToXCellCoord(r),h=this._convertToYCellCoord(i),A=l;A<=u;A++)for(var p=c;p<=h;p++)if(n.call(this,t,e,r,i,this.xCellCount*p+A,o,a,s))return},Xt.prototype._convertToXCellCoord=function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))},Xt.prototype._convertToYCellCoord=function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))},Xt.prototype._circlesCollide=function(t,e,r,i,n,o){var a=i-t,s=n-e,l=r+o;return l*l>a*a+s*s},Xt.prototype._circleAndRectCollide=function(t,e,r,i,n,o,a){var s=(o-i)/2,l=Math.abs(t-(i+s));if(l>s+r)return!1;var c=(a-n)/2,u=Math.abs(e-(n+c));if(u>c+r)return!1;if(l<=s||u<=c)return!0;var h=l-s,A=u-c;return h*h+A*A<=r*r};var le=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ce(t,e){for(var r=0;r<t;r++){var i=e.length;e.resize(i+4),e.float32.set(le,3*i)}}function ue(t,e,r){var i=e[0],n=e[1];return t[0]=r[0]*i+r[4]*n+r[12],t[1]=r[1]*i+r[5]*n+r[13],t[3]=r[3]*i+r[7]*n+r[15],t}var he=function(t,e,r){void 0===e&&(e=new Xt(t.width+200,t.height+200,25)),void 0===r&&(r=new Xt(t.width+200,t.height+200,25)),this.transform=t,this.grid=e,this.ignoredGrid=r,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+100,this.screenBottomBoundary=t.height+100,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200};function Ae(e,r,i){return r*(t.EXTENT/(e.tileSize*Math.pow(2,i-e.tileID.overscaledZ)))}he.prototype.placeCollisionBox=function(t,e,r,i,n){var o=this.projectAndGetPerspectiveRatio(i,t.anchorPointX,t.anchorPointY),a=r*o.perspectiveRatio,s=t.x1*a+o.point.x,l=t.y1*a+o.point.y,c=t.x2*a+o.point.x,u=t.y2*a+o.point.y;return!this.isInsideGrid(s,l,c,u)||!e&&this.grid.hitTest(s,l,c,u,n)?{box:[],offscreen:!1}:{box:[s,l,c,u],offscreen:this.isOffscreen(s,l,c,u)}},he.prototype.placeCollisionCircles=function(e,r,i,n,o,a,s,l,c,u,h,A,p){var d=[],f=new t.Point(r.anchorX,r.anchorY),m=Jt(f,a),g=te(this.transform.cameraToCenterDistance,m.signedDistanceFromCamera),_=(u?o/g:o*g)/t.ONE_EM,y=Jt(f,s).point,v=ie(_,n,r.lineOffsetX*_,r.lineOffsetY*_,!1,y,f,r,i,s,{}),x=!1,w=!1,b=!0;if(v){for(var B=.5*A*g+p,C=new t.Point(-100,-100),E=new t.Point(this.screenRightBoundary,this.screenBottomBoundary),T=new Wt,I=v.first,S=v.last,M=[],F=I.path.length-1;F>=1;F--)M.push(I.path[F]);for(var P=1;P<S.path.length;P++)M.push(S.path[P]);var L=2.5*B;if(l){var D=M.map((function(t){return Jt(t,l)}));M=D.some((function(t){return t.signedDistanceFromCamera<=0}))?[]:D.map((function(t){return t.point}))}var U=[];if(M.length>0){for(var k=M[0].clone(),z=M[0].clone(),R=1;R<M.length;R++)k.x=Math.min(k.x,M[R].x),k.y=Math.min(k.y,M[R].y),z.x=Math.max(z.x,M[R].x),z.y=Math.max(z.y,M[R].y);U=k.x>=C.x&&z.x<=E.x&&k.y>=C.y&&z.y<=E.y?[M]:z.x<C.x||k.x>E.x||z.y<C.y||k.y>E.y?[]:t.clipLine([M],C.x,C.y,E.x,E.y)}for(var O=0,Q=U;O<Q.length;O+=1){var N;T.reset(Q[O],.25*B),N=T.length<=.5*B?1:Math.ceil(T.paddedLength/L)+1;for(var V=0;V<N;V++){var H=V/Math.max(N-1,1),j=T.lerp(H),G=j.x+100,K=j.y+100;d.push(G,K,B,0);var q=G-B,Z=K-B,W=G+B,X=K+B;if(b=b&&this.isOffscreen(q,Z,W,X),w=w||this.isInsideGrid(q,Z,W,X),!e&&this.grid.hitTestCircle(G,K,B,h)&&(x=!0,!c))return{circles:[],offscreen:!1,collisionDetected:x}}}}return{circles:!c&&x||!w?[]:d,offscreen:b,collisionDetected:x}},he.prototype.queryRenderedSymbols=function(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};for(var r=[],i=1/0,n=1/0,o=-1/0,a=-1/0,s=0,l=e;s<l.length;s+=1){var c=l[s],u=new t.Point(c.x+100,c.y+100);i=Math.min(i,u.x),n=Math.min(n,u.y),o=Math.max(o,u.x),a=Math.max(a,u.y),r.push(u)}for(var h={},A={},p=0,d=this.grid.query(i,n,o,a).concat(this.ignoredGrid.query(i,n,o,a));p<d.length;p+=1){var f=d[p],m=f.key;if(void 0===h[m.bucketInstanceId]&&(h[m.bucketInstanceId]={}),!h[m.bucketInstanceId][m.featureIndex]){var g=[new t.Point(f.x1,f.y1),new t.Point(f.x2,f.y1),new t.Point(f.x2,f.y2),new t.Point(f.x1,f.y2)];t.polygonIntersectsPolygon(r,g)&&(h[m.bucketInstanceId][m.featureIndex]=!0,void 0===A[m.bucketInstanceId]&&(A[m.bucketInstanceId]=[]),A[m.bucketInstanceId].push(m.featureIndex))}}return A},he.prototype.insertCollisionBox=function(t,e,r,i,n){(e?this.ignoredGrid:this.grid).insert({bucketInstanceId:r,featureIndex:i,collisionGroupID:n},t[0],t[1],t[2],t[3])},he.prototype.insertCollisionCircles=function(t,e,r,i,n){for(var o=e?this.ignoredGrid:this.grid,a={bucketInstanceId:r,featureIndex:i,collisionGroupID:n},s=0;s<t.length;s+=4)o.insertCircle(a,t[s],t[s+1],t[s+2])},he.prototype.projectAndGetPerspectiveRatio=function(e,r,i){var n=[r,i,0,1];return ue(n,n,e),{point:new t.Point((n[0]/n[3]+1)/2*this.transform.width+100,(-n[1]/n[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/n[3]*.5}},he.prototype.isOffscreen=function(t,e,r,i){return r<100||t>=this.screenRightBoundary||i<100||e>this.screenBottomBoundary},he.prototype.isInsideGrid=function(t,e,r,i){return r>=0&&t<this.gridRightBoundary&&i>=0&&e<this.gridBottomBoundary},he.prototype.getViewportMatrix=function(){var e=t.identity([]);return t.translate(e,e,[-100,-100,0]),e};var pe=function(t,e,r,i){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):i&&r?1:0,this.placed=r};pe.prototype.isHidden=function(){return 0===this.opacity&&!this.placed};var de=function(t,e,r,i,n){this.text=new pe(t?t.text:null,e,r,n),this.icon=new pe(t?t.icon:null,e,i,n)};de.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var fe=function(t,e,r){this.text=t,this.icon=e,this.skipFade=r},me=function(){this.invProjMatrix=t.create(),this.viewportMatrix=t.create(),this.circles=[]},ge=function(t,e,r,i,n){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=r,this.bucketIndex=i,this.tileID=n},_e=function(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}};function ye(e,r,i,n,o){var a=t.getAnchorAlignment(e),s=-(a.horizontalAlign-.5)*r,l=-(a.verticalAlign-.5)*i,c=t.evaluateVariableOffset(e,n);return new t.Point(s+c[0]*o,l+c[1]*o)}function ve(e,r,i,n,o,a){var s=e.x1,l=e.x2,c=e.y1,u=e.y2,h=e.anchorPointX,A=e.anchorPointY,p=new t.Point(r,i);return n&&p._rotate(o?a:-a),{x1:s+p.x,y1:c+p.y,x2:l+p.x,y2:u+p.y,anchorPointX:h,anchorPointY:A}}_e.prototype.get=function(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){var e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:function(t){return t.collisionGroupID===e}}}return this.collisionGroups[t]};var xe=function(t,e,r,i){this.transform=t.clone(),this.collisionIndex=new he(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=e,this.retainedQueryData={},this.collisionGroups=new _e(r),this.collisionCircleArrays={},this.prevPlacement=i,i&&(i.prevPlacement=void 0),this.placedOrientations={}};function we(t,e,r,i,n){t.emplaceBack(e?1:0,r?1:0,i||0,n||0),t.emplaceBack(e?1:0,r?1:0,i||0,n||0),t.emplaceBack(e?1:0,r?1:0,i||0,n||0),t.emplaceBack(e?1:0,r?1:0,i||0,n||0)}xe.prototype.getBucketParts=function(e,r,i,n){var o=i.getBucket(r),a=i.latestFeatureIndex;if(o&&a&&r.id===o.layerIds[0]){var s=i.collisionBoxArray,l=o.layers[0].layout,c=Math.pow(2,this.transform.zoom-i.tileID.overscaledZ),u=i.tileSize/t.EXTENT,h=this.transform.calculatePosMatrix(i.tileID.toUnwrapped()),A="map"===l.get("text-pitch-alignment"),p="map"===l.get("text-rotation-alignment"),d=Ae(i,1,this.transform.zoom),f=$t(h,A,p,this.transform,d),m=null;if(A){var g=Yt(h,A,p,this.transform,d);m=t.multiply([],this.transform.labelPlaneMatrix,g)}this.retainedQueryData[o.bucketInstanceId]=new ge(o.bucketInstanceId,a,o.sourceLayerIndex,o.index,i.tileID);var _={bucket:o,layout:l,posMatrix:h,textLabelPlaneMatrix:f,labelToScreenMatrix:m,scale:c,textPixelRatio:u,holdingForFade:i.holdingForFade(),collisionBoxArray:s,partiallyEvaluatedTextSize:t.evaluateSizeForZoom(o.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(n)for(var y=0,v=o.sortKeyRanges;y<v.length;y+=1){var x=v[y];e.push({sortKey:x.sortKey,symbolInstanceStart:x.symbolInstanceStart,symbolInstanceEnd:x.symbolInstanceEnd,parameters:_})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:_})}},xe.prototype.attemptAnchorPlacement=function(t,e,r,i,n,o,a,s,l,c,u,h,A,p,d){var f,m=[h.textOffset0,h.textOffset1],g=ye(t,r,i,m,n),_=this.collisionIndex.placeCollisionBox(ve(e,g.x,g.y,o,a,this.transform.angle),u,s,l,c.predicate);if(!d||0!==this.collisionIndex.placeCollisionBox(ve(d,g.x,g.y,o,a,this.transform.angle),u,s,l,c.predicate).box.length)return _.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID].text&&(f=this.prevPlacement.variableOffsets[h.crossTileID].anchor),this.variableOffsets[h.crossTileID]={textOffset:m,width:r,height:i,anchor:t,textBoxScale:n,prevAnchor:f},this.markUsedJustification(A,t,h,p),A.allowVerticalPlacement&&(this.markUsedOrientation(A,p,h),this.placedOrientations[h.crossTileID]=p),{shift:g,placedGlyphBoxes:_}):void 0},xe.prototype.placeLayerBucketPart=function(e,r,i){var n=this,o=e.parameters,a=o.bucket,s=o.layout,l=o.posMatrix,c=o.textLabelPlaneMatrix,u=o.labelToScreenMatrix,h=o.textPixelRatio,A=o.holdingForFade,p=o.collisionBoxArray,d=o.partiallyEvaluatedTextSize,f=o.collisionGroup,m=s.get("text-optional"),g=s.get("icon-optional"),_=s.get("text-allow-overlap"),y=s.get("icon-allow-overlap"),v="map"===s.get("text-rotation-alignment"),x="map"===s.get("text-pitch-alignment"),w="none"!==s.get("icon-text-fit"),b="viewport-y"===s.get("symbol-z-order"),B=_&&(y||!a.hasIconData()||g),C=y&&(_||!a.hasTextData()||m);!a.collisionArrays&&p&&a.deserializeCollisionBoxes(p);var E=function(e,o){if(!r[e.crossTileID])if(A)n.placements[e.crossTileID]=new fe(!1,!1,!1);else{var p,b=!1,E=!1,T=!0,I=null,S={box:null,offscreen:null},M={box:null,offscreen:null},F=null,P=null,L=0,D=0,U=0;o.textFeatureIndex?L=o.textFeatureIndex:e.useRuntimeCollisionCircles&&(L=e.featureIndex),o.verticalTextFeatureIndex&&(D=o.verticalTextFeatureIndex);var k=o.textBox;if(k){var z=function(r){var i=t.WritingMode.horizontal;if(a.allowVerticalPlacement&&!r&&n.prevPlacement){var o=n.prevPlacement.placedOrientations[e.crossTileID];o&&(n.placedOrientations[e.crossTileID]=o,n.markUsedOrientation(a,i=o,e))}return i},R=function(r,i){if(a.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&o.verticalTextBox)for(var n=0,s=a.writingModes;n<s.length&&(s[n]===t.WritingMode.vertical?(S=i(),M=S):S=r(),!(S&&S.box&&S.box.length));n+=1);else S=r()};if(s.get("text-variable-anchor")){var O=s.get("text-variable-anchor");if(n.prevPlacement&&n.prevPlacement.variableOffsets[e.crossTileID]){var Q=n.prevPlacement.variableOffsets[e.crossTileID];O.indexOf(Q.anchor)>0&&(O=O.filter((function(t){return t!==Q.anchor}))).unshift(Q.anchor)}var N=function(t,r,i){for(var o=t.x2-t.x1,s=t.y2-t.y1,c=e.textBoxScale,u=w&&!y?r:null,A={box:[],offscreen:!1},p=_?2*O.length:O.length,d=0;d<p;++d){var m=n.attemptAnchorPlacement(O[d%O.length],t,o,s,c,v,x,h,l,f,d>=O.length,e,a,i,u);if(m&&(A=m.placedGlyphBoxes)&&A.box&&A.box.length){b=!0,I=m.shift;break}}return A};R((function(){return N(k,o.iconBox,t.WritingMode.horizontal)}),(function(){var r=o.verticalTextBox;return a.allowVerticalPlacement&&!(S&&S.box&&S.box.length)&&e.numVerticalGlyphVertices>0&&r?N(r,o.verticalIconBox,t.WritingMode.vertical):{box:null,offscreen:null}})),S&&(b=S.box,T=S.offscreen);var V=z(S&&S.box);if(!b&&n.prevPlacement){var H=n.prevPlacement.variableOffsets[e.crossTileID];H&&(n.variableOffsets[e.crossTileID]=H,n.markUsedJustification(a,H.anchor,e,V))}}else{var j=function(t,r){var i=n.collisionIndex.placeCollisionBox(t,_,h,l,f.predicate);return i&&i.box&&i.box.length&&(n.markUsedOrientation(a,r,e),n.placedOrientations[e.crossTileID]=r),i};R((function(){return j(k,t.WritingMode.horizontal)}),(function(){var r=o.verticalTextBox;return a.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&r?j(r,t.WritingMode.vertical):{box:null,offscreen:null}})),z(S&&S.box&&S.box.length)}}if(b=(p=S)&&p.box&&p.box.length>0,T=p&&p.offscreen,e.useRuntimeCollisionCircles){var G=a.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex),K=t.evaluateSizeForFeature(a.textSizeData,d,G),q=s.get("text-padding");F=n.collisionIndex.placeCollisionCircles(_,G,a.lineVertexArray,a.glyphOffsetArray,K,l,c,u,i,x,f.predicate,e.collisionCircleDiameter,q),b=_||F.circles.length>0&&!F.collisionDetected,T=T&&F.offscreen}if(o.iconFeatureIndex&&(U=o.iconFeatureIndex),o.iconBox){var Z=function(t){var e=w&&I?ve(t,I.x,I.y,v,x,n.transform.angle):t;return n.collisionIndex.placeCollisionBox(e,y,h,l,f.predicate)};E=M&&M.box&&M.box.length&&o.verticalIconBox?(P=Z(o.verticalIconBox)).box.length>0:(P=Z(o.iconBox)).box.length>0,T=T&&P.offscreen}var W=m||0===e.numHorizontalGlyphVertices&&0===e.numVerticalGlyphVertices,X=g||0===e.numIconVertices;if(W||X?X?W||(E=E&&b):b=E&&b:E=b=E&&b,b&&p&&p.box&&n.collisionIndex.insertCollisionBox(p.box,s.get("text-ignore-placement"),a.bucketInstanceId,M&&M.box&&D?D:L,f.ID),E&&P&&n.collisionIndex.insertCollisionBox(P.box,s.get("icon-ignore-placement"),a.bucketInstanceId,U,f.ID),F&&(b&&n.collisionIndex.insertCollisionCircles(F.circles,s.get("text-ignore-placement"),a.bucketInstanceId,L,f.ID),i)){var $=a.bucketInstanceId,Y=n.collisionCircleArrays[$];void 0===Y&&(Y=n.collisionCircleArrays[$]=new me);for(var J=0;J<F.circles.length;J+=4)Y.circles.push(F.circles[J+0]),Y.circles.push(F.circles[J+1]),Y.circles.push(F.circles[J+2]),Y.circles.push(F.collisionDetected?1:0)}n.placements[e.crossTileID]=new fe(b||B,E||C,T||a.justReloaded),r[e.crossTileID]=!0}};if(b)for(var T=a.getSortedSymbolIndexes(this.transform.angle),I=T.length-1;I>=0;--I){var S=T[I];E(a.symbolInstances.get(S),a.collisionArrays[S])}else for(var M=e.symbolInstanceStart;M<e.symbolInstanceEnd;M++)E(a.symbolInstances.get(M),a.collisionArrays[M]);if(i&&a.bucketInstanceId in this.collisionCircleArrays){var F=this.collisionCircleArrays[a.bucketInstanceId];t.invert(F.invProjMatrix,l),F.viewportMatrix=this.collisionIndex.getViewportMatrix()}a.justReloaded=!1},xe.prototype.markUsedJustification=function(e,r,i,n){var o;o=n===t.WritingMode.vertical?i.verticalPlacedTextSymbolIndex:{left:i.leftJustifiedTextSymbolIndex,center:i.centerJustifiedTextSymbolIndex,right:i.rightJustifiedTextSymbolIndex}[t.getAnchorJustification(r)];for(var a=0,s=[i.leftJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.rightJustifiedTextSymbolIndex,i.verticalPlacedTextSymbolIndex];a<s.length;a+=1){var l=s[a];l>=0&&(e.text.placedSymbolArray.get(l).crossTileID=o>=0&&l!==o?0:i.crossTileID)}},xe.prototype.markUsedOrientation=function(e,r,i){for(var n=r===t.WritingMode.horizontal||r===t.WritingMode.horizontalOnly?r:0,o=r===t.WritingMode.vertical?r:0,a=0,s=[i.leftJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.rightJustifiedTextSymbolIndex];a<s.length;a+=1)e.text.placedSymbolArray.get(s[a]).placedOrientation=n;i.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(i.verticalPlacedTextSymbolIndex).placedOrientation=o)},xe.prototype.commit=function(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;var e=this.prevPlacement,r=!1;this.prevZoomAdjustment=e?e.zoomAdjustment(this.transform.zoom):0;var i=e?e.symbolFadeChange(t):1,n=e?e.opacities:{},o=e?e.variableOffsets:{},a=e?e.placedOrientations:{};for(var s in this.placements){var l=this.placements[s],c=n[s];c?(this.opacities[s]=new de(c,i,l.text,l.icon),r=r||l.text!==c.text.placed||l.icon!==c.icon.placed):(this.opacities[s]=new de(null,i,l.text,l.icon,l.skipFade),r=r||l.text||l.icon)}for(var u in n){var h=n[u];if(!this.opacities[u]){var A=new de(h,i,!1,!1);A.isHidden()||(this.opacities[u]=A,r=r||h.text.placed||h.icon.placed)}}for(var p in o)this.variableOffsets[p]||!this.opacities[p]||this.opacities[p].isHidden()||(this.variableOffsets[p]=o[p]);for(var d in a)this.placedOrientations[d]||!this.opacities[d]||this.opacities[d].isHidden()||(this.placedOrientations[d]=a[d]);r?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)},xe.prototype.updateLayerOpacities=function(t,e){for(var r={},i=0,n=e;i<n.length;i+=1){var o=n[i],a=o.getBucket(t);a&&o.latestFeatureIndex&&t.id===a.layerIds[0]&&this.updateBucketOpacities(a,r,o.collisionBoxArray)}},xe.prototype.updateBucketOpacities=function(e,r,i){var n=this;e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();var o=e.layers[0].layout,a=new de(null,0,!1,!1,!0),s=o.get("text-allow-overlap"),l=o.get("icon-allow-overlap"),c=o.get("text-variable-anchor"),u="map"===o.get("text-rotation-alignment"),h="map"===o.get("text-pitch-alignment"),A="none"!==o.get("icon-text-fit"),p=new de(null,0,s&&(l||!e.hasIconData()||o.get("icon-optional")),l&&(s||!e.hasTextData()||o.get("text-optional")),!0);!e.collisionArrays&&i&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(i);for(var d=function(t,e,r){for(var i=0;i<e/4;i++)t.opacityVertexArray.emplaceBack(r)},f=function(i){var o=e.symbolInstances.get(i),s=o.numHorizontalGlyphVertices,l=o.numVerticalGlyphVertices,f=o.crossTileID,m=n.opacities[f];r[f]?m=a:m||(n.opacities[f]=m=p),r[f]=!0;var g=o.numIconVertices>0,_=n.placedOrientations[o.crossTileID],y=_===t.WritingMode.vertical,v=_===t.WritingMode.horizontal||_===t.WritingMode.horizontalOnly;if(s>0||l>0){var x=Me(m.text);d(e.text,s,y?Fe:x),d(e.text,l,v?Fe:x);var w=m.text.isHidden();[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((function(t){t>=0&&(e.text.placedSymbolArray.get(t).hidden=w||y?1:0)})),o.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(o.verticalPlacedTextSymbolIndex).hidden=w||v?1:0);var b=n.variableOffsets[o.crossTileID];b&&n.markUsedJustification(e,b.anchor,o,_);var B=n.placedOrientations[o.crossTileID];B&&(n.markUsedJustification(e,"left",o,B),n.markUsedOrientation(e,B,o))}if(g){var C=Me(m.icon),E=!(A&&o.verticalPlacedIconSymbolIndex&&y);o.placedIconSymbolIndex>=0&&(d(e.icon,o.numIconVertices,E?C:Fe),e.icon.placedSymbolArray.get(o.placedIconSymbolIndex).hidden=m.icon.isHidden()),o.verticalPlacedIconSymbolIndex>=0&&(d(e.icon,o.numVerticalIconVertices,E?Fe:C),e.icon.placedSymbolArray.get(o.verticalPlacedIconSymbolIndex).hidden=m.icon.isHidden())}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){var T=e.collisionArrays[i];if(T){var I=new t.Point(0,0);if(T.textBox||T.verticalTextBox){var S=!0;if(c){var M=n.variableOffsets[f];M?(I=ye(M.anchor,M.width,M.height,M.textOffset,M.textBoxScale),u&&I._rotate(h?n.transform.angle:-n.transform.angle)):S=!1}T.textBox&&we(e.textCollisionBox.collisionVertexArray,m.text.placed,!S||y,I.x,I.y),T.verticalTextBox&&we(e.textCollisionBox.collisionVertexArray,m.text.placed,!S||v,I.x,I.y)}var F=Boolean(!v&&T.verticalIconBox);T.iconBox&&we(e.iconCollisionBox.collisionVertexArray,m.icon.placed,F,A?I.x:0,A?I.y:0),T.verticalIconBox&&we(e.iconCollisionBox.collisionVertexArray,m.icon.placed,!F,A?I.x:0,A?I.y:0)}}},m=0;m<e.symbolInstances.length;m++)f(m);if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.bucketInstanceId in this.collisionCircleArrays){var g=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=g.invProjMatrix,e.placementViewportMatrix=g.viewportMatrix,e.collisionCircleArray=g.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}},xe.prototype.symbolFadeChange=function(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},xe.prototype.zoomAdjustment=function(t){return Math.max(0,(this.transform.zoom-t)/1.5)},xe.prototype.hasTransitions=function(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration},xe.prototype.stillRecent=function(t,e){var r=this.zoomAtLastRecencyCheck===e?1-this.zoomAdjustment(e):1;return this.zoomAtLastRecencyCheck=e,this.commitTime+this.fadeDuration*r>t},xe.prototype.setStale=function(){this.stale=!0};var be=Math.pow(2,25),Be=Math.pow(2,24),Ce=Math.pow(2,17),Ee=Math.pow(2,16),Te=Math.pow(2,9),Ie=Math.pow(2,8),Se=Math.pow(2,1);function Me(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;var e=t.placed?1:0,r=Math.floor(127*t.opacity);return r*be+e*Be+r*Ce+e*Ee+r*Te+e*Ie+r*Se+e}var Fe=0,Pe=function(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Pe.prototype.continuePlacement=function(t,e,r,i,n){for(var o=this._bucketParts;this._currentTileIndex<t.length;)if(e.getBucketParts(o,i,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,n())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort((function(t,e){return t.sortKey-e.sortKey})));this._currentPartIndex<o.length;)if(e.placeLayerBucketPart(o[this._currentPartIndex],this._seenCrossTileIDs,r),this._currentPartIndex++,n())return!0;return!1};var Le=function(t,e,r,i,n,o,a){this.placement=new xe(t,n,o,a),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=r,this._showCollisionBoxes=i,this._done=!1};Le.prototype.isDone=function(){return this._done},Le.prototype.continuePlacement=function(e,r,i){for(var n=this,o=t.browser.now(),a=function(){var e=t.browser.now()-o;return!n._forceFullPlacement&&e>2};this._currentPlacementIndex>=0;){var s=r[e[this._currentPlacementIndex]],l=this.placement.collisionIndex.transform.zoom;if("symbol"===s.type&&(!s.minzoom||s.minzoom<=l)&&(!s.maxzoom||s.maxzoom>l)){if(this._inProgressLayer||(this._inProgressLayer=new Pe(s)),this._inProgressLayer.continuePlacement(i[s.source],this.placement,this._showCollisionBoxes,s,a))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Le.prototype.commit=function(t){return this.placement.commit(t),this.placement};var De=512/t.EXTENT/2,Ue=function(t,e,r){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=r;for(var i=0;i<e.length;i++){var n=e.get(i),o=n.key;this.indexedSymbolInstances[o]||(this.indexedSymbolInstances[o]=[]),this.indexedSymbolInstances[o].push({crossTileID:n.crossTileID,coord:this.getScaledCoordinates(n,t)})}};Ue.prototype.getScaledCoordinates=function(e,r){var i=De/Math.pow(2,r.canonical.z-this.tileID.canonical.z);return{x:Math.floor((r.canonical.x*t.EXTENT+e.anchorX)*i),y:Math.floor((r.canonical.y*t.EXTENT+e.anchorY)*i)}},Ue.prototype.findMatches=function(t,e,r){for(var i=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z),n=0;n<t.length;n++){var o=t.get(n);if(!o.crossTileID){var a=this.indexedSymbolInstances[o.key];if(a)for(var s=this.getScaledCoordinates(o,e),l=0,c=a;l<c.length;l+=1){var u=c[l];if(Math.abs(u.coord.x-s.x)<=i&&Math.abs(u.coord.y-s.y)<=i&&!r[u.crossTileID]){r[u.crossTileID]=!0,o.crossTileID=u.crossTileID;break}}}}};var ke=function(){this.maxCrossTileID=0};ke.prototype.generate=function(){return++this.maxCrossTileID};var ze=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};ze.prototype.handleWrapJump=function(t){var e=Math.round((t-this.lng)/360);if(0!==e)for(var r in this.indexes){var i=this.indexes[r],n={};for(var o in i){var a=i[o];a.tileID=a.tileID.unwrapTo(a.tileID.wrap+e),n[a.tileID.key]=a}this.indexes[r]=n}this.lng=t},ze.prototype.addBucket=function(t,e,r){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(var i=0;i<e.symbolInstances.length;i++)e.symbolInstances.get(i).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});var n=this.usedCrossTileIDs[t.overscaledZ];for(var o in this.indexes){var a=this.indexes[o];if(Number(o)>t.overscaledZ)for(var s in a){var l=a[s];l.tileID.isChildOf(t)&&l.findMatches(e.symbolInstances,t,n)}else{var c=a[t.scaledTo(Number(o)).key];c&&c.findMatches(e.symbolInstances,t,n)}}for(var u=0;u<e.symbolInstances.length;u++){var h=e.symbolInstances.get(u);h.crossTileID||(h.crossTileID=r.generate(),n[h.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Ue(t,e.symbolInstances,e.bucketInstanceId),!0},ze.prototype.removeBucketCrossTileIDs=function(t,e){for(var r in e.indexedSymbolInstances)for(var i=0,n=e.indexedSymbolInstances[r];i<n.length;i+=1)delete this.usedCrossTileIDs[t][n[i].crossTileID]},ze.prototype.removeStaleBuckets=function(t){var e=!1;for(var r in this.indexes){var i=this.indexes[r];for(var n in i)t[i[n].bucketInstanceId]||(this.removeBucketCrossTileIDs(r,i[n]),delete i[n],e=!0)}return e};var Re=function(){this.layerIndexes={},this.crossTileIDs=new ke,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Re.prototype.addLayer=function(t,e,r){var i=this.layerIndexes[t.id];void 0===i&&(i=this.layerIndexes[t.id]=new ze);var n=!1,o={};i.handleWrapJump(r);for(var a=0,s=e;a<s.length;a+=1){var l=s[a],c=l.getBucket(t);c&&t.id===c.layerIds[0]&&(c.bucketInstanceId||(c.bucketInstanceId=++this.maxBucketInstanceId),i.addBucket(l.tileID,c,this.crossTileIDs)&&(n=!0),o[c.bucketInstanceId]=!0)}return i.removeStaleBuckets(o)&&(n=!0),n},Re.prototype.pruneUnusedLayers=function(t){var e={};for(var r in t.forEach((function(t){e[t]=!0})),this.layerIndexes)e[r]||delete this.layerIndexes[r]};var Oe=function(e,r){return t.emitValidationErrors(e,r&&r.filter((function(t){return"source.canvas"!==t.identifier})))},Qe=t.pick(Nt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Ne=t.pick(Nt,["setCenter","setZoom","setBearing","setPitch"]),Ve=function(){var e={},r=t.styleSpec.$version;for(var i in t.styleSpec.$root){var n,o=t.styleSpec.$root[i];o.required&&null!=(n="version"===i?r:"array"===o.type?[]:{})&&(e[i]=n)}return e}(),He=function(e){function r(i,n){var o=this;void 0===n&&(n={}),e.call(this),this.map=i,this.dispatcher=new B(Rt(),this),this.imageManager=new A,this.imageManager.setEventedParent(this),this.glyphManager=new y(i._requestManager,n.localIdeographFontFamily),this.lineAtlas=new b(256,512),this.crossTileSymbolIndex=new Re,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new t.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",t.getReferrer());var a=this;this._rtlTextPluginCallback=r.registerForPluginStateChange((function(e){a.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:e.pluginStatus,pluginURL:e.pluginURL},(function(e,r){if(t.triggerPluginCompletionEvent(e),r&&r.every((function(t){return t})))for(var i in a.sourceCaches)a.sourceCaches[i].reload()}))})),this.on("data",(function(t){if("source"===t.dataType&&"metadata"===t.sourceDataType){var e=o.sourceCaches[t.sourceId];if(e){var r=e.getSource();if(r&&r.vectorLayerIds)for(var i in o._layers){var n=o._layers[i];n.source===r.id&&o._validateLayer(n)}}}}))}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.loadURL=function(e,r){var i=this;void 0===r&&(r={}),this.fire(new t.Event("dataloading",{dataType:"style"}));var n="boolean"==typeof r.validate?r.validate:!t.isMapboxURL(e);e=this.map._requestManager.normalizeStyleURL(e,r.accessToken);var o=this.map._requestManager.transformRequest(e,t.ResourceType.Style);this._request=t.getJSON(o,(function(e,r){i._request=null,e?i.fire(new t.ErrorEvent(e)):r&&i._load(r,n)}))},r.prototype.loadJSON=function(e,r){var i=this;void 0===r&&(r={}),this.fire(new t.Event("dataloading",{dataType:"style"})),this._request=t.browser.frame((function(){i._request=null,i._load(e,!1!==r.validate)}))},r.prototype.loadEmpty=function(){this.fire(new t.Event("dataloading",{dataType:"style"})),this._load(Ve,!1)},r.prototype._load=function(e,r){if(!r||!Oe(this,t.validateStyle(e))){for(var i in this._loaded=!0,this.stylesheet=e,e.sources)this.addSource(i,e.sources[i],{validate:!1});e.sprite?this._loadSprite(e.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(e.glyphs);var n=Qt(this.stylesheet.layers);this._order=n.map((function(t){return t.id})),this._layers={},this._serializedLayers={};for(var o=0,a=n;o<a.length;o+=1){var s=a[o];(s=t.createStyleLayer(s)).setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=s,this._serializedLayers[s.id]=s.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new w(this.stylesheet.light),this.fire(new t.Event("data",{dataType:"style"})),this.fire(new t.Event("style.load"))}},r.prototype._loadSprite=function(e){var r=this;this._spriteRequest=function(e,r,i){var n,o,a,s=t.browser.devicePixelRatio>1?"@2x":"",l=t.getJSON(r.transformRequest(r.normalizeSpriteURL(e,s,".json"),t.ResourceType.SpriteJSON),(function(t,e){l=null,a||(a=t,n=e,u())})),c=t.getImage(r.transformRequest(r.normalizeSpriteURL(e,s,".png"),t.ResourceType.SpriteImage),(function(t,e){c=null,a||(a=t,o=e,u())}));function u(){if(a)i(a);else if(n&&o){var e=t.browser.getImageData(o),r={};for(var s in n){var l=n[s],c=l.width,u=l.height,h=l.x,A=l.y,p=l.sdf,d=l.pixelRatio,f=l.stretchX,m=l.stretchY,g=l.content,_=new t.RGBAImage({width:c,height:u});t.RGBAImage.copy(e,_,{x:h,y:A},{x:0,y:0},{width:c,height:u}),r[s]={data:_,pixelRatio:d,sdf:p,stretchX:f,stretchY:m,content:g}}i(null,r)}}return{cancel:function(){l&&(l.cancel(),l=null),c&&(c.cancel(),c=null)}}}(e,this.map._requestManager,(function(e,i){if(r._spriteRequest=null,e)r.fire(new t.ErrorEvent(e));else if(i)for(var n in i)r.imageManager.addImage(n,i[n]);r.imageManager.setLoaded(!0),r._availableImages=r.imageManager.listImages(),r.dispatcher.broadcast("setImages",r._availableImages),r.fire(new t.Event("data",{dataType:"style"}))}))},r.prototype._validateLayer=function(e){var r=this.sourceCaches[e.source];if(r){var i=e.sourceLayer;if(i){var n=r.getSource();("geojson"===n.type||n.vectorLayerIds&&-1===n.vectorLayerIds.indexOf(i))&&this.fire(new t.ErrorEvent(new Error('Source layer "'+i+'" does not exist on source "'+n.id+'" as specified by style layer "'+e.id+'"')))}}},r.prototype.loaded=function(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(var t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()},r.prototype._serializeLayers=function(t){for(var e=[],r=0,i=t;r<i.length;r+=1){var n=this._layers[i[r]];"custom"!==n.type&&e.push(n.serialize())}return e},r.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(var e in this._layers)if(this._layers[e].hasTransition())return!0;return!1},r.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},r.prototype.update=function(e){if(this._loaded){var r=this._changed;if(this._changed){var i=Object.keys(this._updatedLayers),n=Object.keys(this._removedLayers);for(var o in(i.length||n.length)&&this._updateWorkerLayers(i,n),this._updatedSources){var a=this._updatedSources[o];"reload"===a?this._reloadSource(o):"clear"===a&&this._clearSource(o)}for(var s in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[s].updateTransitions(e);this.light.updateTransitions(e),this._resetUpdates()}var l={};for(var c in this.sourceCaches){var u=this.sourceCaches[c];l[c]=u.used,u.used=!1}for(var h=0,A=this._order;h<A.length;h+=1){var p=this._layers[A[h]];p.recalculate(e,this._availableImages),!p.isHidden(e.zoom)&&p.source&&(this.sourceCaches[p.source].used=!0)}for(var d in l){var f=this.sourceCaches[d];l[d]!==f.used&&f.fire(new t.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:d}))}this.light.recalculate(e),this.z=e.zoom,r&&this.fire(new t.Event("data",{dataType:"style"}))}},r.prototype._updateTilesForChangedImages=function(){var t=Object.keys(this._changedImages);if(t.length){for(var e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}},r.prototype._updateWorkerLayers=function(t,e){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:e})},r.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},r.prototype.setState=function(e){var r=this;if(this._checkLoaded(),Oe(this,t.validateStyle(e)))return!1;(e=t.clone$1(e)).layers=Qt(e.layers);var i=function(e,r){if(!e)return[{command:Nt.setStyle,args:[r]}];var i=[];try{if(!t.deepEqual(e.version,r.version))return[{command:Nt.setStyle,args:[r]}];t.deepEqual(e.center,r.center)||i.push({command:Nt.setCenter,args:[r.center]}),t.deepEqual(e.zoom,r.zoom)||i.push({command:Nt.setZoom,args:[r.zoom]}),t.deepEqual(e.bearing,r.bearing)||i.push({command:Nt.setBearing,args:[r.bearing]}),t.deepEqual(e.pitch,r.pitch)||i.push({command:Nt.setPitch,args:[r.pitch]}),t.deepEqual(e.sprite,r.sprite)||i.push({command:Nt.setSprite,args:[r.sprite]}),t.deepEqual(e.glyphs,r.glyphs)||i.push({command:Nt.setGlyphs,args:[r.glyphs]}),t.deepEqual(e.transition,r.transition)||i.push({command:Nt.setTransition,args:[r.transition]}),t.deepEqual(e.light,r.light)||i.push({command:Nt.setLight,args:[r.light]});var n={},o=[];!function(e,r,i,n){var o;for(o in r=r||{},e=e||{})e.hasOwnProperty(o)&&(r.hasOwnProperty(o)||Ht(o,i,n));for(o in r)r.hasOwnProperty(o)&&(e.hasOwnProperty(o)?t.deepEqual(e[o],r[o])||("geojson"===e[o].type&&"geojson"===r[o].type&&Gt(e,r,o)?i.push({command:Nt.setGeoJSONSourceData,args:[o,r[o].data]}):jt(o,r,i,n)):Vt(o,r,i))}(e.sources,r.sources,o,n);var a=[];e.layers&&e.layers.forEach((function(t){n[t.source]?i.push({command:Nt.removeLayer,args:[t.id]}):a.push(t)})),i=i.concat(o),function(e,r,i){r=r||[];var n,o,a,s,l,c,u,h=(e=e||[]).map(qt),A=r.map(qt),p=e.reduce(Zt,{}),d=r.reduce(Zt,{}),f=h.slice(),m=Object.create(null);for(n=0,o=0;n<h.length;n++)d.hasOwnProperty(a=h[n])?o++:(i.push({command:Nt.removeLayer,args:[a]}),f.splice(f.indexOf(a,o),1));for(n=0,o=0;n<A.length;n++)f[f.length-1-n]!==(a=A[A.length-1-n])&&(p.hasOwnProperty(a)?(i.push({command:Nt.removeLayer,args:[a]}),f.splice(f.lastIndexOf(a,f.length-o),1)):o++,i.push({command:Nt.addLayer,args:[d[a],c=f[f.length-n]]}),f.splice(f.length-n,0,a),m[a]=!0);for(n=0;n<A.length;n++)if(s=p[a=A[n]],l=d[a],!m[a]&&!t.deepEqual(s,l))if(t.deepEqual(s.source,l.source)&&t.deepEqual(s["source-layer"],l["source-layer"])&&t.deepEqual(s.type,l.type)){for(u in Kt(s.layout,l.layout,i,a,null,Nt.setLayoutProperty),Kt(s.paint,l.paint,i,a,null,Nt.setPaintProperty),t.deepEqual(s.filter,l.filter)||i.push({command:Nt.setFilter,args:[a,l.filter]}),t.deepEqual(s.minzoom,l.minzoom)&&t.deepEqual(s.maxzoom,l.maxzoom)||i.push({command:Nt.setLayerZoomRange,args:[a,l.minzoom,l.maxzoom]}),s)s.hasOwnProperty(u)&&"layout"!==u&&"paint"!==u&&"filter"!==u&&"metadata"!==u&&"minzoom"!==u&&"maxzoom"!==u&&(0===u.indexOf("paint.")?Kt(s[u],l[u],i,a,u.slice(6),Nt.setPaintProperty):t.deepEqual(s[u],l[u])||i.push({command:Nt.setLayerProperty,args:[a,u,l[u]]}));for(u in l)l.hasOwnProperty(u)&&!s.hasOwnProperty(u)&&"layout"!==u&&"paint"!==u&&"filter"!==u&&"metadata"!==u&&"minzoom"!==u&&"maxzoom"!==u&&(0===u.indexOf("paint.")?Kt(s[u],l[u],i,a,u.slice(6),Nt.setPaintProperty):t.deepEqual(s[u],l[u])||i.push({command:Nt.setLayerProperty,args:[a,u,l[u]]}))}else i.push({command:Nt.removeLayer,args:[a]}),c=f[f.lastIndexOf(a)+1],i.push({command:Nt.addLayer,args:[l,c]})}(a,r.layers,i)}catch(t){console.warn("Unable to compute style diff:",t),i=[{command:Nt.setStyle,args:[r]}]}return i}(this.serialize(),e).filter((function(t){return!(t.command in Ne)}));if(0===i.length)return!1;var n=i.filter((function(t){return!(t.command in Qe)}));if(n.length>0)throw new Error("Unimplemented: "+n.map((function(t){return t.command})).join(", ")+".");return i.forEach((function(t){"setTransition"!==t.command&&r[t.command].apply(r,t.args)})),this.stylesheet=e,!0},r.prototype.addImage=function(e,r){if(this.getImage(e))return this.fire(new t.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(e,r),this._afterImageUpdated(e)},r.prototype.updateImage=function(t,e){this.imageManager.updateImage(t,e)},r.prototype.getImage=function(t){return this.imageManager.getImage(t)},r.prototype.removeImage=function(e){if(!this.getImage(e))return this.fire(new t.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(e),this._afterImageUpdated(e)},r.prototype._afterImageUpdated=function(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new t.Event("data",{dataType:"style"}))},r.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},r.prototype.addSource=function(e,r,i){var n=this;if(void 0===i&&(i={}),this._checkLoaded(),void 0!==this.sourceCaches[e])throw new Error("There is already a source with this ID");if(!r.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(r).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(t.validateStyle.source,"sources."+e,r,null,i))){this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);var o=this.sourceCaches[e]=new Mt(e,r,this.dispatcher);o.style=this,o.setEventedParent(this,(function(){return{isSourceLoaded:n.loaded(),source:o.serialize(),sourceId:e}})),o.onAdd(this.map),this._changed=!0}},r.prototype.removeSource=function(e){if(this._checkLoaded(),void 0===this.sourceCaches[e])throw new Error("There is no source with this ID");for(var r in this._layers)if(this._layers[r].source===e)return this.fire(new t.ErrorEvent(new Error('Source "'+e+'" cannot be removed while layer "'+r+'" is using it.')));var i=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],i.fire(new t.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),i.setEventedParent(null),i.clearTiles(),i.onRemove&&i.onRemove(this.map),this._changed=!0},r.prototype.setGeoJSONSourceData=function(t,e){this._checkLoaded(),this.sourceCaches[t].getSource().setData(e),this._changed=!0},r.prototype.getSource=function(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()},r.prototype.addLayer=function(e,r,i){void 0===i&&(i={}),this._checkLoaded();var n=e.id;if(this.getLayer(n))this.fire(new t.ErrorEvent(new Error('Layer with id "'+n+'" already exists on this map')));else{var o;if("custom"===e.type){if(Oe(this,t.validateCustomStyleLayer(e)))return;o=t.createStyleLayer(e)}else{if("object"==Ze(e.source)&&(this.addSource(n,e.source),e=t.clone$1(e),e=t.extend(e,{source:n})),this._validate(t.validateStyle.layer,"layers."+n,e,{arrayIndex:-1},i))return;o=t.createStyleLayer(e),this._validateLayer(o),o.setEventedParent(this,{layer:{id:n}}),this._serializedLayers[o.id]=o.serialize()}var a=r?this._order.indexOf(r):this._order.length;if(r&&-1===a)this.fire(new t.ErrorEvent(new Error('Layer with id "'+r+'" does not exist on this map.')));else{if(this._order.splice(a,0,n),this._layerOrderChanged=!0,this._layers[n]=o,this._removedLayers[n]&&o.source&&"custom"!==o.type){var s=this._removedLayers[n];delete this._removedLayers[n],s.type!==o.type?this._updatedSources[o.source]="clear":(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map)}}},r.prototype.moveLayer=function(e,r){if(this._checkLoaded(),this._changed=!0,this._layers[e]){if(e!==r){var i=this._order.indexOf(e);this._order.splice(i,1);var n=r?this._order.indexOf(r):this._order.length;r&&-1===n?this.fire(new t.ErrorEvent(new Error('Layer with id "'+r+'" does not exist on this map.'))):(this._order.splice(n,0,e),this._layerOrderChanged=!0)}}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be moved.")))},r.prototype.removeLayer=function(e){this._checkLoaded();var r=this._layers[e];if(r){r.setEventedParent(null);var i=this._order.indexOf(e);this._order.splice(i,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=r,delete this._layers[e],delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],r.onRemove&&r.onRemove(this.map)}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be removed.")))},r.prototype.getLayer=function(t){return this._layers[t]},r.prototype.hasLayer=function(t){return t in this._layers},r.prototype.setLayerZoomRange=function(e,r,i){this._checkLoaded();var n=this.getLayer(e);n?n.minzoom===r&&n.maxzoom===i||(null!=r&&(n.minzoom=r),null!=i&&(n.maxzoom=i),this._updateLayer(n)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot have zoom extent.")))},r.prototype.setFilter=function(e,r,i){void 0===i&&(i={}),this._checkLoaded();var n=this.getLayer(e);if(n){if(!t.deepEqual(n.filter,r))return null==r?(n.filter=void 0,void this._updateLayer(n)):void(this._validate(t.validateStyle.filter,"layers."+n.id+".filter",r,null,i)||(n.filter=t.clone$1(r),this._updateLayer(n)))}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be filtered.")))},r.prototype.getFilter=function(e){return t.clone$1(this.getLayer(e).filter)},r.prototype.setLayoutProperty=function(e,r,i,n){void 0===n&&(n={}),this._checkLoaded();var o=this.getLayer(e);o?t.deepEqual(o.getLayoutProperty(r),i)||(o.setLayoutProperty(r,i,n),this._updateLayer(o)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")))},r.prototype.getLayoutProperty=function(e,r){var i=this.getLayer(e);if(i)return i.getLayoutProperty(r);this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style.")))},r.prototype.setPaintProperty=function(e,r,i,n){void 0===n&&(n={}),this._checkLoaded();var o=this.getLayer(e);o?t.deepEqual(o.getPaintProperty(r),i)||(o.setPaintProperty(r,i,n)&&this._updateLayer(o),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")))},r.prototype.getPaintProperty=function(t,e){return this.getLayer(t).getPaintProperty(e)},r.prototype.setFeatureState=function(e,r){this._checkLoaded();var i=e.source,n=e.sourceLayer,o=this.sourceCaches[i];if(void 0!==o){var a=o.getSource().type;"geojson"===a&&n?this.fire(new t.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==a||n?(void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided."))),o.setFeatureState(n,e.id,r)):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+i+"' does not exist in the map's style.")))},r.prototype.removeFeatureState=function(e,r){this._checkLoaded();var i=e.source,n=this.sourceCaches[i];if(void 0!==n){var o=n.getSource().type,a="vector"===o?e.sourceLayer:void 0;"vector"!==o||a?r&&"string"!=typeof e.id&&"number"!=typeof e.id?this.fire(new t.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):n.removeFeatureState(a,e.id,r):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+i+"' does not exist in the map's style.")))},r.prototype.getFeatureState=function(e){this._checkLoaded();var r=e.source,i=e.sourceLayer,n=this.sourceCaches[r];if(void 0!==n){if("vector"!==n.getSource().type||i)return void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided."))),n.getFeatureState(i,e.id);this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+r+"' does not exist in the map's style.")))},r.prototype.getTransition=function(){return t.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},r.prototype.serialize=function(){return t.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:t.mapObject(this.sourceCaches,(function(t){return t.serialize()})),layers:this._serializeLayers(this._order)},(function(t){return void 0!==t}))},r.prototype._updateLayer=function(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&"raster"!==this.sourceCaches[t.source].getSource().type&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0},r.prototype._flattenAndSortRenderedFeatures=function(t){for(var e=this,r=function(t){return"fill-extrusion"===e._layers[t].type},i={},n=[],o=this._order.length-1;o>=0;o--){var a=this._order[o];if(r(a)){i[a]=o;for(var s=0,l=t;s<l.length;s+=1){var c=l[s][a];if(c)for(var u=0,h=c;u<h.length;u+=1)n.push(h[u])}}}n.sort((function(t,e){return e.intersectionZ-t.intersectionZ}));for(var A=[],p=this._order.length-1;p>=0;p--){var d=this._order[p];if(r(d))for(var f=n.length-1;f>=0;f--){var m=n[f].feature;if(i[m.layer.id]<p)break;A.push(m),n.pop()}else for(var g=0,_=t;g<_.length;g+=1){var y=_[g][d];if(y)for(var v=0,x=y;v<x.length;v+=1)A.push(x[v].feature)}}return A},r.prototype.queryRenderedFeatures=function(e,r,i){r&&r.filter&&this._validate(t.validateStyle.filter,"queryRenderedFeatures.filter",r.filter,null,r);var n={};if(r&&r.layers){if(!Array.isArray(r.layers))return this.fire(new t.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var o=0,a=r.layers;o<a.length;o+=1){var s=a[o],l=this._layers[s];if(!l)return this.fire(new t.ErrorEvent(new Error("The layer '"+s+"' does not exist in the map's style and cannot be queried for features."))),[];n[l.source]=!0}}var c=[];for(var u in r.availableImages=this._availableImages,this.sourceCaches)r.layers&&!n[u]||c.push(z(this.sourceCaches[u],this._layers,this._serializedLayers,e,r,i));return this.placement&&c.push(function(t,e,r,i,n,o,a){for(var s={},l=o.queryRenderedSymbols(i),c=[],u=0,h=Object.keys(l).map(Number);u<h.length;u+=1)c.push(a[h[u]]);c.sort(R);for(var A=function(){var r=d[p],i=r.featureIndex.lookupSymbolFeatures(l[r.bucketInstanceId],e,r.bucketIndex,r.sourceLayerIndex,n.filter,n.layers,n.availableImages,t);for(var o in i){var a=s[o]=s[o]||[],c=i[o];c.sort((function(t,e){var i=r.featureSortOrder;if(i){var n=i.indexOf(t.featureIndex);return i.indexOf(e.featureIndex)-n}return e.featureIndex-t.featureIndex}));for(var u=0,h=c;u<h.length;u+=1)a.push(h[u])}},p=0,d=c;p<d.length;p+=1)A();var f=function(e){s[e].forEach((function(i){var n=i.feature,o=r[t[e].source].getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=o}))};for(var m in s)f(m);return s}(this._layers,this._serializedLayers,this.sourceCaches,e,r,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(c)},r.prototype.querySourceFeatures=function(e,r){r&&r.filter&&this._validate(t.validateStyle.filter,"querySourceFeatures.filter",r.filter,null,r);var i=this.sourceCaches[e];return i?function(t,e){for(var r=t.getRenderableIds().map((function(e){return t.getTileByID(e)})),i=[],n={},o=0;o<r.length;o++){var a=r[o],s=a.tileID.canonical.key;n[s]||(n[s]=!0,a.querySourceFeatures(i,e))}return i}(i,r):[]},r.prototype.addSourceType=function(t,e,i){return r.getSourceType(t)?i(new Error('A source type called "'+t+'" already exists.')):(r.setSourceType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},i):i(null,null))},r.prototype.getLight=function(){return this.light.getLight()},r.prototype.setLight=function(e,r){void 0===r&&(r={}),this._checkLoaded();var i=this.light.getLight(),n=!1;for(var o in e)if(!t.deepEqual(e[o],i[o])){n=!0;break}if(n){var a={now:t.browser.now(),transition:t.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,r),this.light.updateTransitions(a)}},r.prototype._validate=function(e,r,i,n,o){return void 0===o&&(o={}),(!o||!1!==o.validate)&&Oe(this,e.call(t.validateStyle,t.extend({key:r,style:this.serialize(),value:i,styleSpec:t.styleSpec},n)))},r.prototype._remove=function(){for(var e in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[e].setEventedParent(null);for(var r in this.sourceCaches)this.sourceCaches[r].clearTiles(),this.sourceCaches[r].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},r.prototype._clearSource=function(t){this.sourceCaches[t].clearTiles()},r.prototype._reloadSource=function(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()},r.prototype._updateSources=function(t){for(var e in this.sourceCaches)this.sourceCaches[e].update(t)},r.prototype._generateCollisionBoxes=function(){for(var t in this.sourceCaches)this._reloadSource(t)},r.prototype._updatePlacement=function(e,r,i,n,o){void 0===o&&(o=!1);for(var a=!1,s=!1,l={},c=0,u=this._order;c<u.length;c+=1){var h=this._layers[u[c]];if("symbol"===h.type){if(!l[h.source]){var A=this.sourceCaches[h.source];l[h.source]=A.getRenderableIds(!0).map((function(t){return A.getTileByID(t)})).sort((function(t,e){return e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1)}))}var p=this.crossTileSymbolIndex.addLayer(h,l[h.source],e.center.lng);a=a||p}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((o=o||this._layerOrderChanged||0===i)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.browser.now(),e.zoom))&&(this.pauseablePlacement=new Le(e,this._order,o,r,i,n,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.browser.now()),s=!0),a&&this.pauseablePlacement.placement.setStale()),s||a)for(var d=0,f=this._order;d<f.length;d+=1){var m=this._layers[f[d]];"symbol"===m.type&&this.placement.updateLayerOpacities(m,l[m.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.browser.now())},r.prototype._releaseSymbolFadeTiles=function(){for(var t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()},r.prototype.getImages=function(t,e,r){this.imageManager.getImages(e.icons,r),this._updateTilesForChangedImages();var i=this.sourceCaches[e.source];i&&i.setDependencies(e.tileID.key,e.type,e.icons)},r.prototype.getGlyphs=function(t,e,r){this.glyphManager.getGlyphs(e.stacks,r)},r.prototype.getResource=function(e,r,i){return t.makeRequest(r,i)},r}(t.Evented);He.getSourceType=function(t){return U[t]},He.setSourceType=function(t,e){U[t]=e},He.registerForPluginStateChange=t.registerForPluginStateChange;var je=t.createLayout([{name:"a_pos",type:"Int16",components:2}]),Ge=_r("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}"),Ke=_r("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),qe=_r("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),We=_r("varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),Xe=_r("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),$e=_r("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),Ye=_r("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Je=_r("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),tr=_r("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),er=_r("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),rr=_r("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),ir=_r("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),nr=_r("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),or=_r("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),ar=_r("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),sr=_r("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),lr=_r("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),cr=_r("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),ur=_r("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),hr=_r("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),Ar=_r("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),pr=_r("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),dr=_r("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),fr=_r("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}"),mr=_r("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),gr=_r("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}");function _r(t,e){var r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,i=e.match(/attribute ([\w]+) ([\w]+)/g),n=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),o=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),a=o?o.concat(n):n,s={};return{fragmentSource:t=t.replace(r,(function(t,e,r,i,n){return s[n]=!0,"define"===e?"\n#ifndef HAS_UNIFORM_u_"+n+"\nvarying "+r+" "+i+" "+n+";\n#else\nuniform "+r+" "+i+" u_"+n+";\n#endif\n":"\n#ifdef HAS_UNIFORM_u_"+n+"\n    "+r+" "+i+" "+n+" = u_"+n+";\n#endif\n"})),vertexSource:e=e.replace(r,(function(t,e,r,i,n){var o="float"===i?"vec2":"vec4",a=n.match(/color/)?"color":o;return s[n]?"define"===e?"\n#ifndef HAS_UNIFORM_u_"+n+"\nuniform lowp float u_"+n+"_t;\nattribute "+r+" "+o+" a_"+n+";\nvarying "+r+" "+i+" "+n+";\n#else\nuniform "+r+" "+i+" u_"+n+";\n#endif\n":"vec4"===a?"\n#ifndef HAS_UNIFORM_u_"+n+"\n    "+n+" = a_"+n+";\n#else\n    "+r+" "+i+" "+n+" = u_"+n+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+n+"\n    "+n+" = unpack_mix_"+a+"(a_"+n+", u_"+n+"_t);\n#else\n    "+r+" "+i+" "+n+" = u_"+n+";\n#endif\n":"define"===e?"\n#ifndef HAS_UNIFORM_u_"+n+"\nuniform lowp float u_"+n+"_t;\nattribute "+r+" "+o+" a_"+n+";\n#else\nuniform "+r+" "+i+" u_"+n+";\n#endif\n":"vec4"===a?"\n#ifndef HAS_UNIFORM_u_"+n+"\n    "+r+" "+i+" "+n+" = a_"+n+";\n#else\n    "+r+" "+i+" "+n+" = u_"+n+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+n+"\n    "+r+" "+i+" "+n+" = unpack_mix_"+a+"(a_"+n+", u_"+n+"_t);\n#else\n    "+r+" "+i+" "+n+" = u_"+n+";\n#endif\n"})),staticAttributes:i,staticUniforms:a}}var yr=Object.freeze({__proto__:null,prelude:Ge,background:Ke,backgroundPattern:qe,circle:We,clippingMask:Xe,heatmap:$e,heatmapTexture:Ye,collisionBox:Je,collisionCircle:tr,debug:er,fill:rr,fillOutline:ir,fillOutlinePattern:nr,fillPattern:or,fillExtrusion:ar,fillExtrusionPattern:sr,hillshadePrepare:lr,hillshade:cr,line:ur,lineGradient:hr,linePattern:Ar,lineSDF:pr,raster:dr,symbolIcon:fr,symbolSDF:mr,symbolTextAndIcon:gr}),vr=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function xr(t){for(var e=[],r=0;r<t.length;r++)if(null!==t[r]){var i=t[r].split(" ");e.push(i.pop())}return e}vr.prototype.bind=function(t,e,r,i,n,o,a,s){this.context=t;for(var l=this.boundPaintVertexBuffers.length!==i.length,c=0;!l&&c<i.length;c++)this.boundPaintVertexBuffers[c]!==i[c]&&(l=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===e&&this.boundLayoutVertexBuffer===r&&!l&&this.boundIndexBuffer===n&&this.boundVertexOffset===o&&this.boundDynamicVertexBuffer===a&&this.boundDynamicVertexBuffer2===s?(t.bindVertexArrayOES.set(this.vao),a&&a.bind(),n&&n.dynamicDraw&&n.bind(),s&&s.bind()):this.freshBind(e,r,i,n,o,a,s)},vr.prototype.freshBind=function(t,e,r,i,n,o,a){var s,l=t.numAttributes,c=this.context,u=c.gl;if(c.extVertexArrayObject)this.vao&&this.destroy(),this.vao=c.extVertexArrayObject.createVertexArrayOES(),c.bindVertexArrayOES.set(this.vao),s=0,this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=r,this.boundIndexBuffer=i,this.boundVertexOffset=n,this.boundDynamicVertexBuffer=o,this.boundDynamicVertexBuffer2=a;else{s=c.currentNumAttributes||0;for(var h=l;h<s;h++)u.disableVertexAttribArray(h)}e.enableAttributes(u,t);for(var A=0,p=r;A<p.length;A+=1)p[A].enableAttributes(u,t);o&&o.enableAttributes(u,t),a&&a.enableAttributes(u,t),e.bind(),e.setVertexAttribPointers(u,t,n);for(var d=0,f=r;d<f.length;d+=1){var m=f[d];m.bind(),m.setVertexAttribPointers(u,t,n)}o&&(o.bind(),o.setVertexAttribPointers(u,t,n)),i&&i.bind(),a&&(a.bind(),a.setVertexAttribPointers(u,t,n)),c.currentNumAttributes=l},vr.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var wr=function(t,e,r,i,n,o){var a=t.gl;this.program=a.createProgram();for(var s=xr(r.staticAttributes),l=i?i.getBinderAttributes():[],c=s.concat(l),u=r.staticUniforms?xr(r.staticUniforms):[],h=i?i.getBinderUniforms():[],A=[],p=0,d=u.concat(h);p<d.length;p+=1){var f=d[p];A.indexOf(f)<0&&A.push(f)}var m=i?i.defines():[];o&&m.push("#define OVERDRAW_INSPECTOR;");var g=m.concat(Ge.fragmentSource,r.fragmentSource).join("\n"),_=m.concat(Ge.vertexSource,r.vertexSource).join("\n"),y=a.createShader(a.FRAGMENT_SHADER);if(a.isContextLost())this.failedToCreate=!0;else{a.shaderSource(y,g),a.compileShader(y),a.attachShader(this.program,y);var v=a.createShader(a.VERTEX_SHADER);if(a.isContextLost())this.failedToCreate=!0;else{a.shaderSource(v,_),a.compileShader(v),a.attachShader(this.program,v),this.attributes={};var x={};this.numAttributes=c.length;for(var w=0;w<this.numAttributes;w++)c[w]&&(a.bindAttribLocation(this.program,w,c[w]),this.attributes[c[w]]=w);a.linkProgram(this.program),a.deleteShader(v),a.deleteShader(y);for(var b=0;b<A.length;b++){var B=A[b];if(B&&!x[B]){var C=a.getUniformLocation(this.program,B);C&&(x[B]=C)}}this.fixedUniforms=n(t,x),this.binderUniforms=i?i.getUniforms(t,x):[]}}};function br(t,e,r){var i=1/Ae(r,1,e.transform.tileZoom),n=Math.pow(2,r.tileID.overscaledZ),o=r.tileSize*Math.pow(2,e.transform.tileZoom)/n,a=o*(r.tileID.canonical.x+r.tileID.wrap*n),s=o*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[i,t.fromScale,t.toScale],u_fade:t.t,u_pixel_coord_upper:[a>>16,s>>16],u_pixel_coord_lower:[65535&a,65535&s]}}wr.prototype.draw=function(t,e,r,i,n,o,a,s,l,c,u,h,A,p,d,f){var m,g=t.gl;if(!this.failedToCreate){for(var _ in t.program.set(this.program),t.setDepthMode(r),t.setStencilMode(i),t.setColorMode(n),t.setCullFace(o),this.fixedUniforms)this.fixedUniforms[_].set(a[_]);p&&p.setUniforms(t,this.binderUniforms,h,{zoom:A});for(var y=(m={},m[g.LINES]=2,m[g.TRIANGLES]=3,m[g.LINE_STRIP]=1,m)[e],v=0,x=u.get();v<x.length;v+=1){var w=x[v],b=w.vaos||(w.vaos={});(b[s]||(b[s]=new vr)).bind(t,this,l,p?p.getPaintVertexBuffers():[],c,w.vertexOffset,d,f),g.drawElements(e,w.primitiveLength*y,g.UNSIGNED_SHORT,w.primitiveOffset*y*2)}}};var Br=function(e,r,i,n){var o=r.style.light,a=o.properties.get("position"),s=[a.x,a.y,a.z],l=t.create$1();"viewport"===o.properties.get("anchor")&&t.fromRotation(l,-r.transform.angle),t.transformMat3(s,s,l);var c=o.properties.get("color");return{u_matrix:e,u_lightpos:s,u_lightintensity:o.properties.get("intensity"),u_lightcolor:[c.r,c.g,c.b],u_vertical_gradient:+i,u_opacity:n}},Cr=function(e,r,i,n,o,a,s){return t.extend(Br(e,r,i,n),br(a,r,s),{u_height_factor:-Math.pow(2,o.overscaledZ)/s.tileSize/8})},Er=function(t){return{u_matrix:t}},Tr=function(e,r,i,n){return t.extend(Er(e),br(i,r,n))},Ir=function(t,e){return{u_matrix:t,u_world:e}},Sr=function(e,r,i,n,o){return t.extend(Tr(e,r,i,n),{u_world:o})},Mr=function(e,r,i,n){var o,a,s=e.transform;if("map"===n.paint.get("circle-pitch-alignment")){var l=Ae(i,1,s.zoom);o=!0,a=[l,l]}else o=!1,a=s.pixelsToGLUnits;return{u_camera_to_center_distance:s.cameraToCenterDistance,u_scale_with_map:+("map"===n.paint.get("circle-pitch-scale")),u_matrix:e.translatePosMatrix(r.posMatrix,i,n.paint.get("circle-translate"),n.paint.get("circle-translate-anchor")),u_pitch_with_map:+o,u_device_pixel_ratio:t.browser.devicePixelRatio,u_extrude_scale:a}},Fr=function(t,e,r){var i=Ae(r,1,e.zoom),n=Math.pow(2,e.zoom-r.tileID.overscaledZ),o=r.tileID.overscaleFactor();return{u_matrix:t,u_camera_to_center_distance:e.cameraToCenterDistance,u_pixels_to_tile_units:i,u_extrude_scale:[e.pixelsToGLUnits[0]/(i*n),e.pixelsToGLUnits[1]/(i*n)],u_overscale_factor:o}},Pr=function(t,e,r){return{u_matrix:t,u_inv_matrix:e,u_camera_to_center_distance:r.cameraToCenterDistance,u_viewport_size:[r.width,r.height]}},Lr=function(t,e,r){return void 0===r&&(r=1),{u_matrix:t,u_color:e,u_overlay:0,u_overlay_scale:r}},Dr=function(t){return{u_matrix:t}},Ur=function(t,e,r,i){return{u_matrix:t,u_extrude_scale:Ae(e,1,r),u_intensity:i}},kr=function(e,r,i){var n=e.transform;return{u_matrix:Nr(e,r,i),u_ratio:1/Ae(r,1,n.zoom),u_device_pixel_ratio:t.browser.devicePixelRatio,u_units_to_pixels:[1/n.pixelsToGLUnits[0],1/n.pixelsToGLUnits[1]]}},zr=function(e,r,i,n){return t.extend(kr(e,r,i),{u_image:0,u_image_height:n})},Rr=function(e,r,i,n){var o=e.transform,a=Qr(r,o);return{u_matrix:Nr(e,r,i),u_texsize:r.imageAtlasTexture.size,u_ratio:1/Ae(r,1,o.zoom),u_device_pixel_ratio:t.browser.devicePixelRatio,u_image:0,u_scale:[a,n.fromScale,n.toScale],u_fade:n.t,u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]]}},Or=function(e,r,i,n,o){var a=e.lineAtlas,s=Qr(r,e.transform),l="round"===i.layout.get("line-cap"),c=a.getDash(n.from,l),u=a.getDash(n.to,l),h=c.width*o.fromScale,A=u.width*o.toScale;return t.extend(kr(e,r,i),{u_patternscale_a:[s/h,-c.height/2],u_patternscale_b:[s/A,-u.height/2],u_sdfgamma:a.width/(256*Math.min(h,A)*t.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:c.y,u_tex_y_b:u.y,u_mix:o.t})};function Qr(t,e){return 1/Ae(t,1,e.tileZoom)}function Nr(t,e,r){return t.translatePosMatrix(e.tileID.posMatrix,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}var Vr=function(t,e,r,i,n){return{u_matrix:t,u_tl_parent:e,u_scale_parent:r,u_buffer_scale:1,u_fade_t:i.mix,u_opacity:i.opacity*n.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:n.paint.get("raster-brightness-min"),u_brightness_high:n.paint.get("raster-brightness-max"),u_saturation_factor:(a=n.paint.get("raster-saturation"),a>0?1-1/(1.001-a):-a),u_contrast_factor:(o=n.paint.get("raster-contrast"),o>0?1/(1-o):1+o),u_spin_weights:Hr(n.paint.get("raster-hue-rotate"))};var o,a};function Hr(t){t*=Math.PI/180;var e=Math.sin(t),r=Math.cos(t);return[(2*r+1)/3,(-Math.sqrt(3)*e-r+1)/3,(Math.sqrt(3)*e-r+1)/3]}var jr,Gr=function(t,e,r,i,n,o,a,s,l,c){var u=n.transform;return{u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:u.cameraToCenterDistance,u_pitch:u.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:u.width/u.height,u_fade_change:n.options.fadeDuration?n.symbolFadeChange:1,u_matrix:o,u_label_plane_matrix:a,u_coord_matrix:s,u_is_text:+l,u_pitch_with_map:+i,u_texsize:c,u_texture:0}},Kr=function(e,r,i,n,o,a,s,l,c,u,h){var A=o.transform;return t.extend(Gr(e,r,i,n,o,a,s,l,c,u),{u_gamma_scale:n?Math.cos(A._pitch)*A.cameraToCenterDistance:1,u_device_pixel_ratio:t.browser.devicePixelRatio,u_is_halo:+h})},qr=function(e,r,i,n,o,a,s,l,c,u){return t.extend(Kr(e,r,i,n,o,a,s,l,!0,c,!0),{u_texsize_icon:u,u_texture_icon:1})},Zr=function(t,e,r){return{u_matrix:t,u_opacity:e,u_color:r}},Wr=function(e,r,i,n,o,a){return t.extend(function(t,e,r,i){var n=r.imageManager.getPattern(t.from.toString()),o=r.imageManager.getPattern(t.to.toString()),a=r.imageManager.getPixelSize(),s=a.width,l=a.height,c=Math.pow(2,i.tileID.overscaledZ),u=i.tileSize*Math.pow(2,r.transform.tileZoom)/c,h=u*(i.tileID.canonical.x+i.tileID.wrap*c),A=u*i.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:n.tl,u_pattern_br_a:n.br,u_pattern_tl_b:o.tl,u_pattern_br_b:o.br,u_texsize:[s,l],u_mix:e.t,u_pattern_size_a:n.displaySize,u_pattern_size_b:o.displaySize,u_scale_a:e.fromScale,u_scale_b:e.toScale,u_tile_units_to_pixels:1/Ae(i,1,r.transform.tileZoom),u_pixel_coord_upper:[h>>16,A>>16],u_pixel_coord_lower:[65535&h,65535&A]}}(n,a,i,o),{u_matrix:e,u_opacity:r})},Xr={fillExtrusion:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_lightpos:new t.Uniform3f(e,r.u_lightpos),u_lightintensity:new t.Uniform1f(e,r.u_lightintensity),u_lightcolor:new t.Uniform3f(e,r.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,r.u_vertical_gradient),u_opacity:new t.Uniform1f(e,r.u_opacity)}},fillExtrusionPattern:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_lightpos:new t.Uniform3f(e,r.u_lightpos),u_lightintensity:new t.Uniform1f(e,r.u_lightintensity),u_lightcolor:new t.Uniform3f(e,r.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,r.u_vertical_gradient),u_height_factor:new t.Uniform1f(e,r.u_height_factor),u_image:new t.Uniform1i(e,r.u_image),u_texsize:new t.Uniform2f(e,r.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,r.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,r.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,r.u_scale),u_fade:new t.Uniform1f(e,r.u_fade),u_opacity:new t.Uniform1f(e,r.u_opacity)}},fill:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix)}},fillPattern:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_image:new t.Uniform1i(e,r.u_image),u_texsize:new t.Uniform2f(e,r.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,r.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,r.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,r.u_scale),u_fade:new t.Uniform1f(e,r.u_fade)}},fillOutline:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_world:new t.Uniform2f(e,r.u_world)}},fillOutlinePattern:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_world:new t.Uniform2f(e,r.u_world),u_image:new t.Uniform1i(e,r.u_image),u_texsize:new t.Uniform2f(e,r.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,r.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,r.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,r.u_scale),u_fade:new t.Uniform1f(e,r.u_fade)}},circle:function(e,r){return{u_camera_to_center_distance:new t.Uniform1f(e,r.u_camera_to_center_distance),u_scale_with_map:new t.Uniform1i(e,r.u_scale_with_map),u_pitch_with_map:new t.Uniform1i(e,r.u_pitch_with_map),u_extrude_scale:new t.Uniform2f(e,r.u_extrude_scale),u_device_pixel_ratio:new t.Uniform1f(e,r.u_device_pixel_ratio),u_matrix:new t.UniformMatrix4f(e,r.u_matrix)}},collisionBox:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_camera_to_center_distance:new t.Uniform1f(e,r.u_camera_to_center_distance),u_pixels_to_tile_units:new t.Uniform1f(e,r.u_pixels_to_tile_units),u_extrude_scale:new t.Uniform2f(e,r.u_extrude_scale),u_overscale_factor:new t.Uniform1f(e,r.u_overscale_factor)}},collisionCircle:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_inv_matrix:new t.UniformMatrix4f(e,r.u_inv_matrix),u_camera_to_center_distance:new t.Uniform1f(e,r.u_camera_to_center_distance),u_viewport_size:new t.Uniform2f(e,r.u_viewport_size)}},debug:function(e,r){return{u_color:new t.UniformColor(e,r.u_color),u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_overlay:new t.Uniform1i(e,r.u_overlay),u_overlay_scale:new t.Uniform1f(e,r.u_overlay_scale)}},clippingMask:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix)}},heatmap:function(e,r){return{u_extrude_scale:new t.Uniform1f(e,r.u_extrude_scale),u_intensity:new t.Uniform1f(e,r.u_intensity),u_matrix:new t.UniformMatrix4f(e,r.u_matrix)}},heatmapTexture:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_world:new t.Uniform2f(e,r.u_world),u_image:new t.Uniform1i(e,r.u_image),u_color_ramp:new t.Uniform1i(e,r.u_color_ramp),u_opacity:new t.Uniform1f(e,r.u_opacity)}},hillshade:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_image:new t.Uniform1i(e,r.u_image),u_latrange:new t.Uniform2f(e,r.u_latrange),u_light:new t.Uniform2f(e,r.u_light),u_shadow:new t.UniformColor(e,r.u_shadow),u_highlight:new t.UniformColor(e,r.u_highlight),u_accent:new t.UniformColor(e,r.u_accent)}},hillshadePrepare:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_image:new t.Uniform1i(e,r.u_image),u_dimension:new t.Uniform2f(e,r.u_dimension),u_zoom:new t.Uniform1f(e,r.u_zoom),u_unpack:new t.Uniform4f(e,r.u_unpack)}},line:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_ratio:new t.Uniform1f(e,r.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,r.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,r.u_units_to_pixels)}},lineGradient:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_ratio:new t.Uniform1f(e,r.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,r.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,r.u_units_to_pixels),u_image:new t.Uniform1i(e,r.u_image),u_image_height:new t.Uniform1f(e,r.u_image_height)}},linePattern:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_texsize:new t.Uniform2f(e,r.u_texsize),u_ratio:new t.Uniform1f(e,r.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,r.u_device_pixel_ratio),u_image:new t.Uniform1i(e,r.u_image),u_units_to_pixels:new t.Uniform2f(e,r.u_units_to_pixels),u_scale:new t.Uniform3f(e,r.u_scale),u_fade:new t.Uniform1f(e,r.u_fade)}},lineSDF:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_ratio:new t.Uniform1f(e,r.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,r.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,r.u_units_to_pixels),u_patternscale_a:new t.Uniform2f(e,r.u_patternscale_a),u_patternscale_b:new t.Uniform2f(e,r.u_patternscale_b),u_sdfgamma:new t.Uniform1f(e,r.u_sdfgamma),u_image:new t.Uniform1i(e,r.u_image),u_tex_y_a:new t.Uniform1f(e,r.u_tex_y_a),u_tex_y_b:new t.Uniform1f(e,r.u_tex_y_b),u_mix:new t.Uniform1f(e,r.u_mix)}},raster:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_tl_parent:new t.Uniform2f(e,r.u_tl_parent),u_scale_parent:new t.Uniform1f(e,r.u_scale_parent),u_buffer_scale:new t.Uniform1f(e,r.u_buffer_scale),u_fade_t:new t.Uniform1f(e,r.u_fade_t),u_opacity:new t.Uniform1f(e,r.u_opacity),u_image0:new t.Uniform1i(e,r.u_image0),u_image1:new t.Uniform1i(e,r.u_image1),u_brightness_low:new t.Uniform1f(e,r.u_brightness_low),u_brightness_high:new t.Uniform1f(e,r.u_brightness_high),u_saturation_factor:new t.Uniform1f(e,r.u_saturation_factor),u_contrast_factor:new t.Uniform1f(e,r.u_contrast_factor),u_spin_weights:new t.Uniform3f(e,r.u_spin_weights)}},symbolIcon:function(e,r){return{u_is_size_zoom_constant:new t.Uniform1i(e,r.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,r.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,r.u_size_t),u_size:new t.Uniform1f(e,r.u_size),u_camera_to_center_distance:new t.Uniform1f(e,r.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,r.u_pitch),u_rotate_symbol:new t.Uniform1i(e,r.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,r.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,r.u_fade_change),u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,r.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,r.u_coord_matrix),u_is_text:new t.Uniform1i(e,r.u_is_text),u_pitch_with_map:new t.Uniform1i(e,r.u_pitch_with_map),u_texsize:new t.Uniform2f(e,r.u_texsize),u_texture:new t.Uniform1i(e,r.u_texture)}},symbolSDF:function(e,r){return{u_is_size_zoom_constant:new t.Uniform1i(e,r.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,r.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,r.u_size_t),u_size:new t.Uniform1f(e,r.u_size),u_camera_to_center_distance:new t.Uniform1f(e,r.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,r.u_pitch),u_rotate_symbol:new t.Uniform1i(e,r.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,r.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,r.u_fade_change),u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,r.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,r.u_coord_matrix),u_is_text:new t.Uniform1i(e,r.u_is_text),u_pitch_with_map:new t.Uniform1i(e,r.u_pitch_with_map),u_texsize:new t.Uniform2f(e,r.u_texsize),u_texture:new t.Uniform1i(e,r.u_texture),u_gamma_scale:new t.Uniform1f(e,r.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,r.u_device_pixel_ratio),u_is_halo:new t.Uniform1i(e,r.u_is_halo)}},symbolTextAndIcon:function(e,r){return{u_is_size_zoom_constant:new t.Uniform1i(e,r.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,r.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,r.u_size_t),u_size:new t.Uniform1f(e,r.u_size),u_camera_to_center_distance:new t.Uniform1f(e,r.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,r.u_pitch),u_rotate_symbol:new t.Uniform1i(e,r.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,r.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,r.u_fade_change),u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,r.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,r.u_coord_matrix),u_is_text:new t.Uniform1i(e,r.u_is_text),u_pitch_with_map:new t.Uniform1i(e,r.u_pitch_with_map),u_texsize:new t.Uniform2f(e,r.u_texsize),u_texsize_icon:new t.Uniform2f(e,r.u_texsize_icon),u_texture:new t.Uniform1i(e,r.u_texture),u_texture_icon:new t.Uniform1i(e,r.u_texture_icon),u_gamma_scale:new t.Uniform1f(e,r.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,r.u_device_pixel_ratio),u_is_halo:new t.Uniform1i(e,r.u_is_halo)}},background:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_opacity:new t.Uniform1f(e,r.u_opacity),u_color:new t.UniformColor(e,r.u_color)}},backgroundPattern:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_opacity:new t.Uniform1f(e,r.u_opacity),u_image:new t.Uniform1i(e,r.u_image),u_pattern_tl_a:new t.Uniform2f(e,r.u_pattern_tl_a),u_pattern_br_a:new t.Uniform2f(e,r.u_pattern_br_a),u_pattern_tl_b:new t.Uniform2f(e,r.u_pattern_tl_b),u_pattern_br_b:new t.Uniform2f(e,r.u_pattern_br_b),u_texsize:new t.Uniform2f(e,r.u_texsize),u_mix:new t.Uniform1f(e,r.u_mix),u_pattern_size_a:new t.Uniform2f(e,r.u_pattern_size_a),u_pattern_size_b:new t.Uniform2f(e,r.u_pattern_size_b),u_scale_a:new t.Uniform1f(e,r.u_scale_a),u_scale_b:new t.Uniform1f(e,r.u_scale_b),u_pixel_coord_upper:new t.Uniform2f(e,r.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,r.u_pixel_coord_lower),u_tile_units_to_pixels:new t.Uniform1f(e,r.u_tile_units_to_pixels)}}};function $r(e,r,i,n,o,a,s){for(var l=e.context,c=l.gl,u=e.useProgram("collisionBox"),h=[],A=0,p=0,d=0;d<n.length;d++){var f=n[d],m=r.getTile(f),g=m.getBucket(i);if(g){var _=f.posMatrix;0===o[0]&&0===o[1]||(_=e.translatePosMatrix(f.posMatrix,m,o,a));var y=s?g.textCollisionBox:g.iconCollisionBox,v=g.collisionCircleArray;if(v.length>0){var x=t.create(),w=_;t.mul(x,g.placementInvProjMatrix,e.transform.glCoordMatrix),t.mul(x,x,g.placementViewportMatrix),h.push({circleArray:v,circleOffset:p,transform:w,invTransform:x}),p=A+=v.length/4}y&&u.draw(l,c.LINES,Ct.disabled,Et.disabled,e.colorModeForRenderPass(),It.disabled,Fr(_,e.transform,m),i.id,y.layoutVertexBuffer,y.indexBuffer,y.segments,null,e.transform.zoom,null,null,y.collisionVertexBuffer)}}if(s&&h.length){var b=e.useProgram("collisionCircle"),B=new t.StructArrayLayout2f1f2i16;B.resize(4*A),B._trim();for(var C=0,E=0,T=h;E<T.length;E+=1)for(var I=T[E],S=0;S<I.circleArray.length/4;S++){var M=4*S,F=I.circleArray[M+0],P=I.circleArray[M+1],L=I.circleArray[M+2],D=I.circleArray[M+3];B.emplace(C++,F,P,L,D,0),B.emplace(C++,F,P,L,D,1),B.emplace(C++,F,P,L,D,2),B.emplace(C++,F,P,L,D,3)}(!jr||jr.length<2*A)&&(jr=function(e){var r=2*e,i=new t.StructArrayLayout3ui6;i.resize(r),i._trim();for(var n=0;n<r;n++){var o=6*n;i.uint16[o+0]=4*n+0,i.uint16[o+1]=4*n+1,i.uint16[o+2]=4*n+2,i.uint16[o+3]=4*n+2,i.uint16[o+4]=4*n+3,i.uint16[o+5]=4*n+0}return i}(A));for(var U=l.createIndexBuffer(jr,!0),k=l.createVertexBuffer(B,t.collisionCircleLayout.members,!0),z=0,R=h;z<R.length;z+=1){var O=R[z],Q=Pr(O.transform,O.invTransform,e.transform);b.draw(l,c.TRIANGLES,Ct.disabled,Et.disabled,e.colorModeForRenderPass(),It.disabled,Q,i.id,k,U,t.SegmentVector.simpleSegment(0,2*O.circleOffset,O.circleArray.length,O.circleArray.length/2),null,e.transform.zoom,null,null,null)}k.destroy(),U.destroy()}}var Yr=t.identity(new Float32Array(16));function Jr(e,r,i,n,o,a){var s=t.getAnchorAlignment(e),l=-(s.horizontalAlign-.5)*r,c=-(s.verticalAlign-.5)*i,u=t.evaluateVariableOffset(e,n);return new t.Point((l/o+u[0])*a,(c/o+u[1])*a)}function ti(e,r,i,n,o,a,s,l,c,u,h){var A=e.text.placedSymbolArray,p=e.text.dynamicLayoutVertexArray,d=e.icon.dynamicLayoutVertexArray,f={};p.clear();for(var m=0;m<A.length;m++){var g=A.get(m),_=g.hidden||!g.crossTileID||e.allowVerticalPlacement&&!g.placedOrientation?null:n[g.crossTileID];if(_){var y=new t.Point(g.anchorX,g.anchorY),v=Jt(y,i?l:s),x=te(a.cameraToCenterDistance,v.signedDistanceFromCamera),w=o.evaluateSizeForFeature(e.textSizeData,u,g)*x/t.ONE_EM;i&&(w*=e.tilePixelRatio/c);for(var b=Jr(_.anchor,_.width,_.height,_.textOffset,_.textBoxScale,w),B=i?Jt(y.add(b),s).point:v.point.add(r?b.rotate(-a.angle):b),C=e.allowVerticalPlacement&&g.placedOrientation===t.WritingMode.vertical?Math.PI/2:0,E=0;E<g.numGlyphs;E++)t.addDynamicAttributes(p,B,C);h&&g.associatedIconIndex>=0&&(f[g.associatedIconIndex]={shiftedAnchor:B,angle:C})}else ce(g.numGlyphs,p)}if(h){d.clear();for(var T=e.icon.placedSymbolArray,I=0;I<T.length;I++){var S=T.get(I);if(S.hidden)ce(S.numGlyphs,d);else{var M=f[I];if(M)for(var F=0;F<S.numGlyphs;F++)t.addDynamicAttributes(d,M.shiftedAnchor,M.angle);else ce(S.numGlyphs,d)}}e.icon.dynamicLayoutVertexBuffer.updateData(d)}e.text.dynamicLayoutVertexBuffer.updateData(p)}function ei(t,e,r){return r.iconsInText&&e?"symbolTextAndIcon":t?"symbolSDF":"symbolIcon"}function ri(e,r,i,n,o,a,s,l,c,u,h,A){for(var p=e.context,d=p.gl,f=e.transform,m="map"===l,g="map"===c,_=m&&"point"!==i.layout.get("symbol-placement"),y=m&&!g&&!_,v=void 0!==i.layout.get("symbol-sort-key").constantOr(1),x=!1,w=e.depthModeForSublayer(0,Ct.ReadOnly),b=i.layout.get("text-variable-anchor"),B=[],C=0,E=n;C<E.length;C+=1){var T=E[C],I=r.getTile(T),S=I.getBucket(i);if(S){var M=o?S.text:S.icon;if(M&&M.segments.get().length){var F=M.programConfigurations.get(i.id),P=o||S.sdfIcons,L=o?S.textSizeData:S.iconSizeData,D=g||0!==f.pitch,U=e.useProgram(ei(P,o,S),F),k=t.evaluateSizeForZoom(L,f.zoom),z=void 0,R=[0,0],O=void 0,Q=void 0,N=null,V=void 0;if(o)O=I.glyphAtlasTexture,Q=d.LINEAR,z=I.glyphAtlasTexture.size,S.iconsInText&&(R=I.imageAtlasTexture.size,N=I.imageAtlasTexture,V=D||e.options.rotating||e.options.zooming||"composite"===L.kind||"camera"===L.kind?d.LINEAR:d.NEAREST);else{var H=1!==i.layout.get("icon-size").constantOr(0)||S.iconsNeedLinear;O=I.imageAtlasTexture,Q=P||e.options.rotating||e.options.zooming||H||D?d.LINEAR:d.NEAREST,z=I.imageAtlasTexture.size}var j=Ae(I,1,e.transform.zoom),G=$t(T.posMatrix,g,m,e.transform,j),K=Yt(T.posMatrix,g,m,e.transform,j),q=b&&S.hasTextData(),Z="none"!==i.layout.get("icon-text-fit")&&q&&S.hasIconData();_&&re(S,T.posMatrix,e,o,G,K,g,u);var W=e.translatePosMatrix(T.posMatrix,I,a,s),X=_||o&&b||Z?Yr:G,$=e.translatePosMatrix(K,I,a,s,!0),Y=P&&0!==i.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1),J={program:U,buffers:M,uniformValues:P?S.iconsInText?qr(L.kind,k,y,g,e,W,X,$,z,R):Kr(L.kind,k,y,g,e,W,X,$,o,z,!0):Gr(L.kind,k,y,g,e,W,X,$,o,z),atlasTexture:O,atlasTextureIcon:N,atlasInterpolation:Q,atlasInterpolationIcon:V,isSDF:P,hasHalo:Y};if(v&&S.canOverlap){x=!0;for(var tt=0,et=M.segments.get();tt<et.length;tt+=1){var rt=et[tt];B.push({segments:new t.SegmentVector([rt]),sortKey:rt.sortKey,state:J})}}else B.push({segments:M.segments,sortKey:0,state:J})}}}x&&B.sort((function(t,e){return t.sortKey-e.sortKey}));for(var it=0,nt=B;it<nt.length;it+=1){var ot=nt[it],at=ot.state;if(p.activeTexture.set(d.TEXTURE0),at.atlasTexture.bind(at.atlasInterpolation,d.CLAMP_TO_EDGE),at.atlasTextureIcon&&(p.activeTexture.set(d.TEXTURE1),at.atlasTextureIcon&&at.atlasTextureIcon.bind(at.atlasInterpolationIcon,d.CLAMP_TO_EDGE)),at.isSDF){var st=at.uniformValues;at.hasHalo&&(st.u_is_halo=1,ii(at.buffers,ot.segments,i,e,at.program,w,h,A,st)),st.u_is_halo=0}ii(at.buffers,ot.segments,i,e,at.program,w,h,A,at.uniformValues)}}function ii(t,e,r,i,n,o,a,s,l){var c=i.context;n.draw(c,c.gl.TRIANGLES,o,a,s,It.disabled,l,r.id,t.layoutVertexBuffer,t.indexBuffer,e,r.paint,i.transform.zoom,t.programConfigurations.get(r.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer)}function ni(t,e,r,i,n,o,a){var s,l,c,u,h,A=t.context.gl,p=r.paint.get("fill-pattern"),d=p&&p.constantOr(1),f=r.getCrossfadeParameters();a?(l=d&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",s=A.LINES):(l=d?"fillPattern":"fill",s=A.TRIANGLES);for(var m=0,g=i;m<g.length;m+=1){var _=g[m],y=e.getTile(_);if(!d||y.patternsLoaded()){var v=y.getBucket(r);if(v){var x=v.programConfigurations.get(r.id),w=t.useProgram(l,x);d&&(t.context.activeTexture.set(A.TEXTURE0),y.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),x.updatePaintBuffers(f));var b=p.constantOr(null);if(b&&y.imageAtlas){var B=y.imageAtlas,C=B.patternPositions[b.to.toString()],E=B.patternPositions[b.from.toString()];C&&E&&x.setConstantPatternPositions(C,E)}var T=t.translatePosMatrix(_.posMatrix,y,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"));if(a){u=v.indexBuffer2,h=v.segments2;var I=[A.drawingBufferWidth,A.drawingBufferHeight];c="fillOutlinePattern"===l&&d?Sr(T,t,f,y,I):Ir(T,I)}else u=v.indexBuffer,h=v.segments,c=d?Tr(T,t,f,y):Er(T);w.draw(t.context,s,n,t.stencilModeForClipping(_),o,It.disabled,c,r.id,v.layoutVertexBuffer,u,h,r.paint,t.transform.zoom,x)}}}}function oi(t,e,r,i,n,o,a){for(var s=t.context,l=s.gl,c=r.paint.get("fill-extrusion-pattern"),u=c.constantOr(1),h=r.getCrossfadeParameters(),A=r.paint.get("fill-extrusion-opacity"),p=0,d=i;p<d.length;p+=1){var f=d[p],m=e.getTile(f),g=m.getBucket(r);if(g){var _=g.programConfigurations.get(r.id),y=t.useProgram(u?"fillExtrusionPattern":"fillExtrusion",_);u&&(t.context.activeTexture.set(l.TEXTURE0),m.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),_.updatePaintBuffers(h));var v=c.constantOr(null);if(v&&m.imageAtlas){var x=m.imageAtlas,w=x.patternPositions[v.to.toString()],b=x.patternPositions[v.from.toString()];w&&b&&_.setConstantPatternPositions(w,b)}var B=t.translatePosMatrix(f.posMatrix,m,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),C=r.paint.get("fill-extrusion-vertical-gradient"),E=u?Cr(B,t,C,A,f,h,m):Br(B,t,C,A);y.draw(s,s.gl.TRIANGLES,n,o,a,It.backCCW,E,r.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,r.paint,t.transform.zoom,_)}}}function ai(e,r,i,n,o,a){var s=e.context,l=s.gl,c=r.fbo;if(c){var u=e.useProgram("hillshade");s.activeTexture.set(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,c.colorAttachment.get());var h=function(e,r,i){var n=i.paint.get("hillshade-shadow-color"),o=i.paint.get("hillshade-highlight-color"),a=i.paint.get("hillshade-accent-color"),s=i.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===i.paint.get("hillshade-illumination-anchor")&&(s-=e.transform.angle);var l,c,u,h=!e.options.moving;return{u_matrix:e.transform.calculatePosMatrix(r.tileID.toUnwrapped(),h),u_image:0,u_latrange:(l=r.tileID,c=Math.pow(2,l.canonical.z),u=l.canonical.y,[new t.MercatorCoordinate(0,u/c).toLngLat().lat,new t.MercatorCoordinate(0,(u+1)/c).toLngLat().lat]),u_light:[i.paint.get("hillshade-exaggeration"),s],u_shadow:n,u_highlight:o,u_accent:a}}(e,r,i);u.draw(s,l.TRIANGLES,n,o,a,It.disabled,h,i.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments)}}function si(e,r,i,n,o,a){var s=e.context,l=s.gl,c=r.dem;if(c&&c.data){var u=c.dim,h=c.stride,A=c.getPixels();if(s.activeTexture.set(l.TEXTURE1),s.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||e.getTileTexture(h),r.demTexture){var p=r.demTexture;p.update(A,{premultiply:!1}),p.bind(l.NEAREST,l.CLAMP_TO_EDGE)}else r.demTexture=new t.Texture(s,A,l.RGBA,{premultiply:!1}),r.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);s.activeTexture.set(l.TEXTURE0);var d=r.fbo;if(!d){var f=new t.Texture(s,{width:u,height:u,data:null},l.RGBA);f.bind(l.LINEAR,l.CLAMP_TO_EDGE),(d=r.fbo=s.createFramebuffer(u,u,!0)).colorAttachment.set(f.texture)}s.bindFramebuffer.set(d.framebuffer),s.viewport.set([0,0,u,u]),e.useProgram("hillshadePrepare").draw(s,l.TRIANGLES,n,o,a,It.disabled,function(e,r){var i=r.stride,n=t.create();return t.ortho(n,0,t.EXTENT,-t.EXTENT,0,0,1),t.translate(n,n,[0,-t.EXTENT,0]),{u_matrix:n,u_image:1,u_dimension:[i,i],u_zoom:e.overscaledZ,u_unpack:r.getUnpackVector()}}(r.tileID,c),i.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments),r.needsHillshadePrepare=!1}}function li(e,r,i,n,o){var a=n.paint.get("raster-fade-duration");if(a>0){var s=t.browser.now(),l=(s-e.timeAdded)/a,c=r?(s-r.timeAdded)/a:-1,u=i.getSource(),h=o.coveringZoomLevel({tileSize:u.tileSize,roundZoom:u.roundZoom}),A=!r||Math.abs(r.tileID.overscaledZ-h)>Math.abs(e.tileID.overscaledZ-h),p=A&&e.refreshedUponExpiration?1:t.clamp(A?l:1-c,0,1);return e.refreshedUponExpiration&&l>=1&&(e.refreshedUponExpiration=!1),r?{opacity:1,mix:1-p}:{opacity:p,mix:0}}return{opacity:1,mix:0}}var ci=new t.Color(1,0,0,1),ui=new t.Color(0,1,0,1),hi=new t.Color(0,0,1,1),Ai=new t.Color(1,0,1,1),pi=new t.Color(0,1,1,1);function di(t,e,r,i){mi(t,0,e+r/2,t.transform.width,r,i)}function fi(t,e,r,i){mi(t,e-r/2,0,r,t.transform.height,i)}function mi(e,r,i,n,o,a){var s=e.context,l=s.gl;l.enable(l.SCISSOR_TEST),l.scissor(r*t.browser.devicePixelRatio,i*t.browser.devicePixelRatio,n*t.browser.devicePixelRatio,o*t.browser.devicePixelRatio),s.clear({color:a}),l.disable(l.SCISSOR_TEST)}function gi(e,r,i){var n=e.context,o=n.gl,a=i.posMatrix,s=e.useProgram("debug"),l=Ct.disabled,c=Et.disabled,u=e.colorModeForRenderPass();n.activeTexture.set(o.TEXTURE0),e.emptyTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE),s.draw(n,o.LINE_STRIP,l,c,u,It.disabled,Lr(a,t.Color.red),"$debug",e.debugBuffer,e.tileBorderIndexBuffer,e.debugSegments);var h=r.getTileByID(i.key).latestRawTileData,A=Math.floor((h&&h.byteLength||0)/1024),p=r.getTile(i).tileSize,d=512/Math.min(p,512)*(i.overscaledZ/e.transform.zoom)*.5,f=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(f+=" => "+i.overscaledZ),function(t,e){t.initDebugOverlayCanvas();var r=t.debugOverlayCanvas,i=t.context.gl,n=t.debugOverlayCanvas.getContext("2d");n.clearRect(0,0,r.width,r.height),n.shadowColor="white",n.shadowBlur=2,n.lineWidth=1.5,n.strokeStyle="white",n.textBaseline="top",n.font="bold 36px Open Sans, sans-serif",n.fillText(e,5,5),n.strokeText(e,5,5),t.debugOverlayTexture.update(r),t.debugOverlayTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}(e,f+" "+A+"kb"),s.draw(n,o.TRIANGLES,l,c,Tt.alphaBlended,It.disabled,Lr(a,t.Color.transparent,d),"$debug",e.debugBuffer,e.quadTriangleIndexBuffer,e.debugSegments)}var _i={symbol:function(e,r,i,n,o){if("translucent"===e.renderPass){var a=Et.disabled,s=e.colorModeForRenderPass();i.layout.get("text-variable-anchor")&&function(e,r,i,n,o,a,s){for(var l=r.transform,c="map"===o,u="map"===a,h=0,A=e;h<A.length;h+=1){var p=A[h],d=n.getTile(p),f=d.getBucket(i);if(f&&f.text&&f.text.segments.get().length){var m=t.evaluateSizeForZoom(f.textSizeData,l.zoom),g=Ae(d,1,r.transform.zoom),_=$t(p.posMatrix,u,c,r.transform,g),y="none"!==i.layout.get("icon-text-fit")&&f.hasIconData();if(m){var v=Math.pow(2,l.zoom-d.tileID.overscaledZ);ti(f,c,u,s,t.symbolSize,l,_,p.posMatrix,v,m,y)}}}}(n,e,i,r,i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),o),0!==i.paint.get("icon-opacity").constantOr(1)&&ri(e,r,i,n,!1,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),i.layout.get("icon-rotation-alignment"),i.layout.get("icon-pitch-alignment"),i.layout.get("icon-keep-upright"),a,s),0!==i.paint.get("text-opacity").constantOr(1)&&ri(e,r,i,n,!0,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),i.layout.get("text-keep-upright"),a,s),r.map.showCollisionBoxes&&($r(e,r,i,n,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),!0),$r(e,r,i,n,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),!1))}},circle:function(e,r,i,n){if("translucent"===e.renderPass){var o=i.paint.get("circle-opacity"),a=i.paint.get("circle-stroke-width"),s=i.paint.get("circle-stroke-opacity"),l=void 0!==i.layout.get("circle-sort-key").constantOr(1);if(0!==o.constantOr(1)||0!==a.constantOr(1)&&0!==s.constantOr(1)){for(var c=e.context,u=c.gl,h=e.depthModeForSublayer(0,Ct.ReadOnly),A=Et.disabled,p=e.colorModeForRenderPass(),d=[],f=0;f<n.length;f++){var m=n[f],g=r.getTile(m),_=g.getBucket(i);if(_){var y=_.programConfigurations.get(i.id),v={programConfiguration:y,program:e.useProgram("circle",y),layoutVertexBuffer:_.layoutVertexBuffer,indexBuffer:_.indexBuffer,uniformValues:Mr(e,m,g,i)};if(l)for(var x=0,w=_.segments.get();x<w.length;x+=1){var b=w[x];d.push({segments:new t.SegmentVector([b]),sortKey:b.sortKey,state:v})}else d.push({segments:_.segments,sortKey:0,state:v})}}l&&d.sort((function(t,e){return t.sortKey-e.sortKey}));for(var B=0,C=d;B<C.length;B+=1){var E=C[B],T=E.state;T.program.draw(c,u.TRIANGLES,h,A,p,It.disabled,T.uniformValues,i.id,T.layoutVertexBuffer,T.indexBuffer,E.segments,i.paint,e.transform.zoom,T.programConfiguration)}}}},heatmap:function(e,r,i,n){if(0!==i.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){var o=e.context,a=o.gl,s=Et.disabled,l=new Tt([a.ONE,a.ONE],t.Color.transparent,[!0,!0,!0,!0]);!function(t,e,r){var i=t.gl;t.activeTexture.set(i.TEXTURE1),t.viewport.set([0,0,e.width/4,e.height/4]);var n,o,a,s,l,c=r.heatmapFbo;if(c)i.bindTexture(i.TEXTURE_2D,c.colorAttachment.get()),t.bindFramebuffer.set(c.framebuffer);else{var u=i.createTexture();i.bindTexture(i.TEXTURE_2D,u),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),c=r.heatmapFbo=t.createFramebuffer(e.width/4,e.height/4,!1),o=e,a=u,s=c,(l=(n=t).gl).texImage2D(l.TEXTURE_2D,0,l.RGBA,o.width/4,o.height/4,0,l.RGBA,n.extRenderToTextureHalfFloat?n.extTextureHalfFloat.HALF_FLOAT_OES:l.UNSIGNED_BYTE,null),s.colorAttachment.set(a)}}(o,e,i),o.clear({color:t.Color.transparent});for(var c=0;c<n.length;c++){var u=n[c];if(!r.hasRenderableParent(u)){var h=r.getTile(u),A=h.getBucket(i);if(A){var p=A.programConfigurations.get(i.id);e.useProgram("heatmap",p).draw(o,a.TRIANGLES,Ct.disabled,s,l,It.disabled,Ur(u.posMatrix,h,e.transform.zoom,i.paint.get("heatmap-intensity")),i.id,A.layoutVertexBuffer,A.indexBuffer,A.segments,i.paint,e.transform.zoom,p)}}}o.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,r){var i=e.context,n=i.gl,o=r.heatmapFbo;if(o){i.activeTexture.set(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,o.colorAttachment.get()),i.activeTexture.set(n.TEXTURE1);var a=r.colorRampTexture;a||(a=r.colorRampTexture=new t.Texture(i,r.colorRamp,n.RGBA)),a.bind(n.LINEAR,n.CLAMP_TO_EDGE),e.useProgram("heatmapTexture").draw(i,n.TRIANGLES,Ct.disabled,Et.disabled,e.colorModeForRenderPass(),It.disabled,function(e,r){var i=t.create();t.ortho(i,0,e.width,e.height,0,0,1);var n=e.context.gl;return{u_matrix:i,u_world:[n.drawingBufferWidth,n.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:r.paint.get("heatmap-opacity")}}(e,r),r.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,r.paint,e.transform.zoom)}}(e,i))},line:function(e,r,i,n){if("translucent"===e.renderPass){var o=i.paint.get("line-opacity"),a=i.paint.get("line-width");if(0!==o.constantOr(1)&&0!==a.constantOr(1))for(var s=e.depthModeForSublayer(0,Ct.ReadOnly),l=e.colorModeForRenderPass(),c=i.paint.get("line-dasharray"),u=i.paint.get("line-pattern"),h=u.constantOr(1),A=i.paint.get("line-gradient"),p=i.getCrossfadeParameters(),d=h?"linePattern":c?"lineSDF":A?"lineGradient":"line",f=e.context,m=f.gl,g=!0,_=0,y=n;_<y.length;_+=1){var v=y[_],x=r.getTile(v);if(!h||x.patternsLoaded()){var w=x.getBucket(i);if(w){var b=w.programConfigurations.get(i.id),B=e.context.program.get(),C=e.useProgram(d,b),E=g||C.program!==B,T=u.constantOr(null);if(T&&x.imageAtlas){var I=x.imageAtlas,S=I.patternPositions[T.to.toString()],M=I.patternPositions[T.from.toString()];S&&M&&b.setConstantPatternPositions(S,M)}var F=h?Rr(e,x,i,p):c?Or(e,x,i,c,p):A?zr(e,x,i,w.lineClipsArray.length):kr(e,x,i);if(h)f.activeTexture.set(m.TEXTURE0),x.imageAtlasTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE),b.updatePaintBuffers(p);else if(c&&(E||e.lineAtlas.dirty))f.activeTexture.set(m.TEXTURE0),e.lineAtlas.bind(f);else if(A){var P=w.gradients[i.id],L=P.texture;if(i.gradientVersion!==P.version){var D=256;if(i.stepInterpolant){var U=r.getSource().maxzoom,k=v.canonical.z===U?Math.ceil(1<<e.transform.maxZoom-v.canonical.z):1;D=t.clamp(t.nextPowerOfTwo(w.maxLineLength/t.EXTENT*1024*k),256,f.maxTextureSize)}P.gradient=t.renderColorRamp({expression:i.gradientExpression(),evaluationKey:"lineProgress",resolution:D,image:P.gradient||void 0,clips:w.lineClipsArray}),P.texture?P.texture.update(P.gradient):P.texture=new t.Texture(f,P.gradient,m.RGBA),P.version=i.gradientVersion,L=P.texture}f.activeTexture.set(m.TEXTURE0),L.bind(i.stepInterpolant?m.NEAREST:m.LINEAR,m.CLAMP_TO_EDGE)}C.draw(f,m.TRIANGLES,s,e.stencilModeForClipping(v),l,It.disabled,F,i.id,w.layoutVertexBuffer,w.indexBuffer,w.segments,i.paint,e.transform.zoom,b,w.layoutVertexBuffer2),g=!1}}}}},fill:function(e,r,i,n){var o=i.paint.get("fill-color"),a=i.paint.get("fill-opacity");if(0!==a.constantOr(1)){var s=e.colorModeForRenderPass(),l=i.paint.get("fill-pattern"),c=e.opaquePassEnabledForLayer()&&!l.constantOr(1)&&1===o.constantOr(t.Color.transparent).a&&1===a.constantOr(0)?"opaque":"translucent";if(e.renderPass===c){var u=e.depthModeForSublayer(1,"opaque"===e.renderPass?Ct.ReadWrite:Ct.ReadOnly);ni(e,r,i,n,u,s,!1)}if("translucent"===e.renderPass&&i.paint.get("fill-antialias")){var h=e.depthModeForSublayer(i.getPaintProperty("fill-outline-color")?2:0,Ct.ReadOnly);ni(e,r,i,n,h,s,!0)}}},"fill-extrusion":function(t,e,r,i){var n=r.paint.get("fill-extrusion-opacity");if(0!==n&&"translucent"===t.renderPass){var o=new Ct(t.context.gl.LEQUAL,Ct.ReadWrite,t.depthRangeFor3D);if(1!==n||r.paint.get("fill-extrusion-pattern").constantOr(1))oi(t,e,r,i,o,Et.disabled,Tt.disabled),oi(t,e,r,i,o,t.stencilModeFor3D(),t.colorModeForRenderPass());else{var a=t.colorModeForRenderPass();oi(t,e,r,i,o,Et.disabled,a)}}},hillshade:function(t,e,r,i){if("offscreen"===t.renderPass||"translucent"===t.renderPass){for(var n=t.context,o=t.depthModeForSublayer(0,Ct.ReadOnly),a=t.colorModeForRenderPass(),s="translucent"===t.renderPass?t.stencilConfigForOverlap(i):[{},i],l=s[0],c=0,u=s[1];c<u.length;c+=1){var h=u[c],A=e.getTile(h);A.needsHillshadePrepare&&"offscreen"===t.renderPass?si(t,A,r,o,Et.disabled,a):"translucent"===t.renderPass&&ai(t,A,r,o,l[h.overscaledZ],a)}n.viewport.set([0,0,t.width,t.height])}},raster:function(t,e,r,i){if("translucent"===t.renderPass&&0!==r.paint.get("raster-opacity")&&i.length)for(var n=t.context,o=n.gl,a=e.getSource(),s=t.useProgram("raster"),l=t.colorModeForRenderPass(),c=a instanceof P?[{},i]:t.stencilConfigForOverlap(i),u=c[0],h=c[1],A=h[h.length-1].overscaledZ,p=!t.options.moving,d=0,f=h;d<f.length;d+=1){var m=f[d],g=t.depthModeForSublayer(m.overscaledZ-A,1===r.paint.get("raster-opacity")?Ct.ReadWrite:Ct.ReadOnly,o.LESS),_=e.getTile(m),y=t.transform.calculatePosMatrix(m.toUnwrapped(),p);_.registerFadeDuration(r.paint.get("raster-fade-duration"));var v=e.findLoadedParent(m,0),x=li(_,v,e,r,t.transform),w=void 0,b=void 0,B="nearest"===r.paint.get("raster-resampling")?o.NEAREST:o.LINEAR;n.activeTexture.set(o.TEXTURE0),_.texture.bind(B,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),n.activeTexture.set(o.TEXTURE1),v?(v.texture.bind(B,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),w=Math.pow(2,v.tileID.overscaledZ-_.tileID.overscaledZ),b=[_.tileID.canonical.x*w%1,_.tileID.canonical.y*w%1]):_.texture.bind(B,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST);var C=Vr(y,b||[0,0],w||1,x,r);a instanceof P?s.draw(n,o.TRIANGLES,g,Et.disabled,l,It.disabled,C,r.id,a.boundsBuffer,t.quadTriangleIndexBuffer,a.boundsSegments):s.draw(n,o.TRIANGLES,g,u[m.overscaledZ],l,It.disabled,C,r.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}},background:function(t,e,r){var i=r.paint.get("background-color"),n=r.paint.get("background-opacity");if(0!==n){var o=t.context,a=o.gl,s=t.transform,l=s.tileSize,c=r.paint.get("background-pattern");if(!t.isPatternMissing(c)){var u=!c&&1===i.a&&1===n&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass===u){var h=Et.disabled,A=t.depthModeForSublayer(0,"opaque"===u?Ct.ReadWrite:Ct.ReadOnly),p=t.colorModeForRenderPass(),d=t.useProgram(c?"backgroundPattern":"background"),f=s.coveringTiles({tileSize:l});c&&(o.activeTexture.set(a.TEXTURE0),t.imageManager.bind(t.context));for(var m=r.getCrossfadeParameters(),g=0,_=f;g<_.length;g+=1){var y=_[g],v=t.transform.calculatePosMatrix(y.toUnwrapped()),x=c?Wr(v,n,t,c,{tileID:y,tileSize:l},m):Zr(v,n,i);d.draw(o,a.TRIANGLES,A,h,p,It.disabled,x,r.id,t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments)}}}}},debug:function(t,e,r){for(var i=0;i<r.length;i++)gi(t,e,r[i])},custom:function(t,e,r){var i=t.context,n=r.implementation;if("offscreen"===t.renderPass){var o=n.prerender;o&&(t.setCustomLayerDefaults(),i.setColorMode(t.colorModeForRenderPass()),o.call(n,i.gl,t.transform.customLayerMatrix()),i.setDirty(),t.setBaseState())}else if("translucent"===t.renderPass){t.setCustomLayerDefaults(),i.setColorMode(t.colorModeForRenderPass()),i.setStencilMode(Et.disabled);var a="3d"===n.renderingMode?new Ct(t.context.gl.LEQUAL,Ct.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,Ct.ReadOnly);i.setDepthMode(a),n.render(i.gl,t.transform.customLayerMatrix()),i.setDirty(),t.setBaseState(),i.bindFramebuffer.set(null)}}},yi=function(t,e){this.context=new St(t),this.transform=e,this._tileTextures={},this.setup(),this.numSublayers=Mt.maxUnderzooming+Mt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Re,this.gpuTimers={}};yi.prototype.resize=function(e,r){if(this.width=e*t.browser.devicePixelRatio,this.height=r*t.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var i=0,n=this.style._order;i<n.length;i+=1)this.style._layers[n[i]].resize()},yi.prototype.setup=function(){var e=this.context,r=new t.StructArrayLayout2i4;r.emplaceBack(0,0),r.emplaceBack(t.EXTENT,0),r.emplaceBack(0,t.EXTENT),r.emplaceBack(t.EXTENT,t.EXTENT),this.tileExtentBuffer=e.createVertexBuffer(r,je.members),this.tileExtentSegments=t.SegmentVector.simpleSegment(0,0,4,2);var i=new t.StructArrayLayout2i4;i.emplaceBack(0,0),i.emplaceBack(t.EXTENT,0),i.emplaceBack(0,t.EXTENT),i.emplaceBack(t.EXTENT,t.EXTENT),this.debugBuffer=e.createVertexBuffer(i,je.members),this.debugSegments=t.SegmentVector.simpleSegment(0,0,4,5);var n=new t.StructArrayLayout4i8;n.emplaceBack(0,0,0,0),n.emplaceBack(t.EXTENT,0,t.EXTENT,0),n.emplaceBack(0,t.EXTENT,0,t.EXTENT),n.emplaceBack(t.EXTENT,t.EXTENT,t.EXTENT,t.EXTENT),this.rasterBoundsBuffer=e.createVertexBuffer(n,F.members),this.rasterBoundsSegments=t.SegmentVector.simpleSegment(0,0,4,2);var o=new t.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(1,0),o.emplaceBack(0,1),o.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(o,je.members),this.viewportSegments=t.SegmentVector.simpleSegment(0,0,4,2);var a=new t.StructArrayLayout1ui2;a.emplaceBack(0),a.emplaceBack(1),a.emplaceBack(3),a.emplaceBack(2),a.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(a);var s=new t.StructArrayLayout3ui6;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(s),this.emptyTexture=new t.Texture(e,{width:1,height:1,data:new Uint8Array([0,0,0,0])},e.gl.RGBA);var l=this.context.gl;this.stencilClearMode=new Et({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO)},yi.prototype.clearStencil=function(){var e=this.context,r=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var i=t.create();t.ortho(i,0,this.width,this.height,0,0,1),t.scale(i,i,[r.drawingBufferWidth,r.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,r.TRIANGLES,Ct.disabled,this.stencilClearMode,Tt.disabled,It.disabled,Dr(i),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},yi.prototype._renderTileClippingMasks=function(t,e){if(this.currentStencilSource!==t.source&&t.isTileClipped()&&e&&e.length){this.currentStencilSource=t.source;var r=this.context,i=r.gl;this.nextStencilID+e.length>256&&this.clearStencil(),r.setColorMode(Tt.disabled),r.setDepthMode(Ct.disabled);var n=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var o=0,a=e;o<a.length;o+=1){var s=a[o],l=this._tileClippingMaskIDs[s.key]=this.nextStencilID++;n.draw(r,i.TRIANGLES,Ct.disabled,new Et({func:i.ALWAYS,mask:0},l,255,i.KEEP,i.KEEP,i.REPLACE),Tt.disabled,It.disabled,Dr(s.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},yi.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var t=this.nextStencilID++,e=this.context.gl;return new Et({func:e.NOTEQUAL,mask:255},t,255,e.KEEP,e.KEEP,e.REPLACE)},yi.prototype.stencilModeForClipping=function(t){var e=this.context.gl;return new Et({func:e.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,e.KEEP,e.KEEP,e.REPLACE)},yi.prototype.stencilConfigForOverlap=function(t){var e,r=this.context.gl,i=t.sort((function(t,e){return e.overscaledZ-t.overscaledZ})),n=i[i.length-1].overscaledZ,o=i[0].overscaledZ-n+1;if(o>1){this.currentStencilSource=void 0,this.nextStencilID+o>256&&this.clearStencil();for(var a={},s=0;s<o;s++)a[s+n]=new Et({func:r.GEQUAL,mask:255},s+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=o,[a,i]}return[(e={},e[n]=Et.disabled,e),i]},yi.prototype.colorModeForRenderPass=function(){var e=this.context.gl;return this._showOverdrawInspector?new Tt([e.CONSTANT_COLOR,e.ONE],new t.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?Tt.unblended:Tt.alphaBlended},yi.prototype.depthModeForSublayer=function(t,e,r){if(!this.opaquePassEnabledForLayer())return Ct.disabled;var i=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Ct(r||this.context.gl.LEQUAL,e,[i,i])},yi.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},yi.prototype.render=function(e,r){var i=this;this.style=e,this.options=r,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(t.browser.now()),this.imageManager.beginFrame();var n=this.style._order,o=this.style.sourceCaches;for(var a in o){var s=o[a];s.used&&s.prepare(this.context)}var l,c,u={},h={},A={};for(var p in o){var d=o[p];u[p]=d.getVisibleCoordinates(),h[p]=u[p].slice().reverse(),A[p]=d.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var f=0;f<n.length;f++)if(this.style._layers[n[f]].is3D()){this.opaquePassCutoff=f;break}this.renderPass="offscreen";for(var m=0,g=n;m<g.length;m+=1){var _=this.style._layers[g[m]];if(_.hasOffscreenPass()&&!_.isHidden(this.transform.zoom)){var y=h[_.source];("custom"===_.type||y.length)&&this.renderLayer(this,o[_.source],_,y)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:r.showOverdrawInspector?t.Color.black:t.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=r.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=n.length-1;this.currentLayer>=0;this.currentLayer--){var v=this.style._layers[n[this.currentLayer]],x=o[v.source],w=u[v.source];this._renderTileClippingMasks(v,w),this.renderLayer(this,x,v,w)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<n.length;this.currentLayer++){var b=this.style._layers[n[this.currentLayer]],B=o[b.source],C=("symbol"===b.type?A:h)[b.source];this._renderTileClippingMasks(b,u[b.source]),this.renderLayer(this,B,b,C)}this.options.showTileBoundaries&&(t.values(this.style._layers).forEach((function(t){t.source&&!t.isHidden(i.transform.zoom)&&(t.source!==(c&&c.id)&&(c=i.style.sourceCaches[t.source]),(!l||l.getSource().maxzoom<c.getSource().maxzoom)&&(l=c))})),l&&_i.debug(this,l,l.getVisibleCoordinates())),this.options.showPadding&&function(t){var e=t.transform.padding;di(t,t.transform.height-(e.top||0),3,ci),di(t,e.bottom||0,3,ui),fi(t,e.left||0,3,hi),fi(t,t.transform.width-(e.right||0),3,Ai);var r,i,n,o,a=t.transform.centerPoint;r=t,i=a.x,n=t.transform.height-a.y,mi(r,i-1,n-10,2,20,o=pi),mi(r,i-10,n-1,20,2,o)}(this),this.context.setDefault()},yi.prototype.renderLayer=function(t,e,r,i){r.isHidden(this.transform.zoom)||("background"===r.type||"custom"===r.type||i.length)&&(this.id=r.id,this.gpuTimingStart(r),_i[r.type](t,e,r,i,this.style.placement.variableOffsets),this.gpuTimingEnd())},yi.prototype.gpuTimingStart=function(t){if(this.options.gpuTiming){var e=this.context.extTimerQuery,r=this.gpuTimers[t.id];r||(r=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:e.createQueryEXT()}),r.calls++,e.beginQueryEXT(e.TIME_ELAPSED_EXT,r.query)}},yi.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}},yi.prototype.collectGpuTimers=function(){var t=this.gpuTimers;return this.gpuTimers={},t},yi.prototype.queryGpuTimers=function(t){var e={};for(var r in t){var i=t[r],n=this.context.extTimerQuery,o=n.getQueryObjectEXT(i.query,n.QUERY_RESULT_EXT)/1e6;n.deleteQueryEXT(i.query),e[r]=o}return e},yi.prototype.translatePosMatrix=function(e,r,i,n,o){if(!i[0]&&!i[1])return e;var a=o?"map"===n?this.transform.angle:0:"viewport"===n?-this.transform.angle:0;if(a){var s=Math.sin(a),l=Math.cos(a);i=[i[0]*l-i[1]*s,i[0]*s+i[1]*l]}var c=[o?i[0]:Ae(r,i[0],this.transform.zoom),o?i[1]:Ae(r,i[1],this.transform.zoom),0],u=new Float32Array(16);return t.translate(u,e,c),u},yi.prototype.saveTileTexture=function(t){var e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]},yi.prototype.getTileTexture=function(t){var e=this._tileTextures[t];return e&&e.length>0?e.pop():null},yi.prototype.isPatternMissing=function(t){if(!t)return!1;if(!t.from||!t.to)return!0;var e=this.imageManager.getPattern(t.from.toString()),r=this.imageManager.getPattern(t.to.toString());return!e||!r},yi.prototype.useProgram=function(t,e){this.cache=this.cache||{};var r=""+t+(e?e.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[r]||(this.cache[r]=new wr(this.context,t,yr[t],e,Xr[t],this._showOverdrawInspector)),this.cache[r]},yi.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},yi.prototype.setBaseState=function(){var t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)},yi.prototype.initDebugOverlayCanvas=function(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=t.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},yi.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var vi=function(t,e){this.points=t,this.planes=e};vi.fromInvProjectionMatrix=function(e,r,i){var n=Math.pow(2,i),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((function(r){return t.transformMat4([],r,e)})).map((function(e){return t.scale$1([],e,1/e[3]/r*n)})),a=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((function(e){var r=t.sub([],o[e[0]],o[e[1]]),i=t.sub([],o[e[2]],o[e[1]]),n=t.normalize([],t.cross([],r,i)),a=-t.dot(n,o[e[1]]);return n.concat(a)}));return new vi(o,a)};var xi=function(e,r){this.min=e,this.max=r,this.center=t.scale$2([],t.add([],this.min,this.max),.5)};xi.prototype.quadrant=function(e){for(var r=[e%2==0,e<2],i=t.clone$2(this.min),n=t.clone$2(this.max),o=0;o<r.length;o++)i[o]=r[o]?this.min[o]:this.center[o],n[o]=r[o]?this.center[o]:this.max[o];return n[2]=this.max[2],new xi(i,n)},xi.prototype.distanceX=function(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]},xi.prototype.distanceY=function(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]},xi.prototype.intersects=function(e){for(var r=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],i=!0,n=0;n<e.planes.length;n++){for(var o=e.planes[n],a=0,s=0;s<r.length;s++)a+=t.dot$1(o,r[s])>=0;if(0===a)return 0;a!==r.length&&(i=!1)}if(i)return 2;for(var l=0;l<3;l++){for(var c=Number.MAX_VALUE,u=-Number.MAX_VALUE,h=0;h<e.points.length;h++){var A=e.points[h][l]-this.min[l];c=Math.min(c,A),u=Math.max(u,A)}if(u<0||c>this.max[l]-this.min[l])return 0}return 1};var wi=function(t,e,r,i){if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0),isNaN(t)||t<0||isNaN(e)||e<0||isNaN(r)||r<0||isNaN(i)||i<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=r,this.right=i};wi.prototype.interpolate=function(e,r,i){return null!=r.top&&null!=e.top&&(this.top=t.number(e.top,r.top,i)),null!=r.bottom&&null!=e.bottom&&(this.bottom=t.number(e.bottom,r.bottom,i)),null!=r.left&&null!=e.left&&(this.left=t.number(e.left,r.left,i)),null!=r.right&&null!=e.right&&(this.right=t.number(e.right,r.right,i)),this},wi.prototype.getCenter=function(e,r){var i=t.clamp((this.left+e-this.right)/2,0,e),n=t.clamp((this.top+r-this.bottom)/2,0,r);return new t.Point(i,n)},wi.prototype.equals=function(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right},wi.prototype.clone=function(){return new wi(this.top,this.bottom,this.left,this.right)},wi.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var bi=function(e,r,i,n,o){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===o||o,this._minZoom=e||0,this._maxZoom=r||22,this._minPitch=null!=i?i:0,this._maxPitch=null!=n?n:60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new t.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new wi,this._posMatrixCache={},this._alignedPosMatrixCache={}},Bi={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};bi.prototype.clone=function(){var t=new bi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._calcMatrices(),t},Bi.minZoom.get=function(){return this._minZoom},Bi.minZoom.set=function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))},Bi.maxZoom.get=function(){return this._maxZoom},Bi.maxZoom.set=function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))},Bi.minPitch.get=function(){return this._minPitch},Bi.minPitch.set=function(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))},Bi.maxPitch.get=function(){return this._maxPitch},Bi.maxPitch.set=function(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))},Bi.renderWorldCopies.get=function(){return this._renderWorldCopies},Bi.renderWorldCopies.set=function(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t},Bi.worldSize.get=function(){return this.tileSize*this.scale},Bi.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Bi.size.get=function(){return new t.Point(this.width,this.height)},Bi.bearing.get=function(){return-this.angle/Math.PI*180},Bi.bearing.set=function(e){var r=-t.wrap(e,-180,180)*Math.PI/180;this.angle!==r&&(this._unmodified=!1,this.angle=r,this._calcMatrices(),this.rotationMatrix=t.create$2(),t.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Bi.pitch.get=function(){return this._pitch/Math.PI*180},Bi.pitch.set=function(e){var r=t.clamp(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())},Bi.fov.get=function(){return this._fov/Math.PI*180},Bi.fov.set=function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())},Bi.zoom.get=function(){return this._zoom},Bi.zoom.set=function(t){var e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom,this._constrain(),this._calcMatrices())},Bi.center.get=function(){return this._center},Bi.center.set=function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())},Bi.padding.get=function(){return this._edgeInsets.toJSON()},Bi.padding.set=function(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())},Bi.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},bi.prototype.isPaddingEqual=function(t){return this._edgeInsets.equals(t)},bi.prototype.interpolatePadding=function(t,e,r){this._unmodified=!1,this._edgeInsets.interpolate(t,e,r),this._constrain(),this._calcMatrices()},bi.prototype.coveringZoomLevel=function(t){var e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)},bi.prototype.getVisibleUnwrappedCoordinates=function(e){var r=[new t.UnwrappedTileID(0,e)];if(this._renderWorldCopies)for(var i=this.pointCoordinate(new t.Point(0,0)),n=this.pointCoordinate(new t.Point(this.width,0)),o=this.pointCoordinate(new t.Point(this.width,this.height)),a=this.pointCoordinate(new t.Point(0,this.height)),s=Math.floor(Math.min(i.x,n.x,o.x,a.x)),l=Math.floor(Math.max(i.x,n.x,o.x,a.x)),c=s-1;c<=l+1;c++)0!==c&&r.push(new t.UnwrappedTileID(c,e));return r},bi.prototype.coveringTiles=function(e){var r=this.coveringZoomLevel(e),i=r;if(void 0!==e.minzoom&&r<e.minzoom)return[];void 0!==e.maxzoom&&r>e.maxzoom&&(r=e.maxzoom);var n=t.MercatorCoordinate.fromLngLat(this.center),o=Math.pow(2,r),a=[o*n.x,o*n.y,0],s=vi.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r),l=e.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(l=r);var c=function(t){return{aabb:new xi([t*o,0,0],[(t+1)*o,o,0]),zoom:0,x:0,y:0,wrap:t,fullyVisible:!1}},u=[],h=[],A=r,p=e.reparseOverscaled?i:r;if(this._renderWorldCopies)for(var d=1;d<=3;d++)u.push(c(-d)),u.push(c(d));for(u.push(c(0));u.length>0;){var f=u.pop(),m=f.x,g=f.y,_=f.fullyVisible;if(!_){var y=f.aabb.intersects(s);if(0===y)continue;_=2===y}var v=f.aabb.distanceX(a),x=f.aabb.distanceY(a),w=Math.max(Math.abs(v),Math.abs(x));if(f.zoom===A||w>3+(1<<A-f.zoom)-2&&f.zoom>=l)h.push({tileID:new t.OverscaledTileID(f.zoom===A?p:f.zoom,f.wrap,f.zoom,m,g),distanceSq:t.sqrLen([a[0]-.5-m,a[1]-.5-g])});else for(var b=0;b<4;b++){var B=(m<<1)+b%2,C=(g<<1)+(b>>1);u.push({aabb:f.aabb.quadrant(b),zoom:f.zoom+1,x:B,y:C,wrap:f.wrap,fullyVisible:_})}}return h.sort((function(t,e){return t.distanceSq-e.distanceSq})).map((function(t){return t.tileID}))},bi.prototype.resize=function(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()},Bi.unmodified.get=function(){return this._unmodified},bi.prototype.zoomScale=function(t){return Math.pow(2,t)},bi.prototype.scaleZoom=function(t){return Math.log(t)/Math.LN2},bi.prototype.project=function(e){var r=t.clamp(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new t.Point(t.mercatorXfromLng(e.lng)*this.worldSize,t.mercatorYfromLat(r)*this.worldSize)},bi.prototype.unproject=function(e){return new t.MercatorCoordinate(e.x/this.worldSize,e.y/this.worldSize).toLngLat()},Bi.point.get=function(){return this.project(this.center)},bi.prototype.setLocationAtPoint=function(e,r){var i=this.pointCoordinate(r),n=this.pointCoordinate(this.centerPoint),o=this.locationCoordinate(e),a=new t.MercatorCoordinate(o.x-(i.x-n.x),o.y-(i.y-n.y));this.center=this.coordinateLocation(a),this._renderWorldCopies&&(this.center=this.center.wrap())},bi.prototype.locationPoint=function(t){return this.coordinatePoint(this.locationCoordinate(t))},bi.prototype.pointLocation=function(t){return this.coordinateLocation(this.pointCoordinate(t))},bi.prototype.locationCoordinate=function(e){return t.MercatorCoordinate.fromLngLat(e)},bi.prototype.coordinateLocation=function(t){return t.toLngLat()},bi.prototype.pointCoordinate=function(e){var r=[e.x,e.y,0,1],i=[e.x,e.y,1,1];t.transformMat4(r,r,this.pixelMatrixInverse),t.transformMat4(i,i,this.pixelMatrixInverse);var n=r[3],o=i[3],a=r[1]/n,s=i[1]/o,l=r[2]/n,c=i[2]/o,u=l===c?0:(0-l)/(c-l);return new t.MercatorCoordinate(t.number(r[0]/n,i[0]/o,u)/this.worldSize,t.number(a,s,u)/this.worldSize)},bi.prototype.coordinatePoint=function(e){var r=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(r,r,this.pixelMatrix),new t.Point(r[0]/r[3],r[1]/r[3])},bi.prototype.getBounds=function(){return(new t.LngLatBounds).extend(this.pointLocation(new t.Point(0,0))).extend(this.pointLocation(new t.Point(this.width,0))).extend(this.pointLocation(new t.Point(this.width,this.height))).extend(this.pointLocation(new t.Point(0,this.height)))},bi.prototype.getMaxBounds=function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new t.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},bi.prototype.setMaxBounds=function(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},bi.prototype.calculatePosMatrix=function(e,r){void 0===r&&(r=!1);var i=e.key,n=r?this._alignedPosMatrixCache:this._posMatrixCache;if(n[i])return n[i];var o=e.canonical,a=this.worldSize/this.zoomScale(o.z),s=o.x+Math.pow(2,o.z)*e.wrap,l=t.identity(new Float64Array(16));return t.translate(l,l,[s*a,o.y*a,0]),t.scale(l,l,[a/t.EXTENT,a/t.EXTENT,1]),t.multiply(l,r?this.alignedProjMatrix:this.projMatrix,l),n[i]=new Float32Array(l),n[i]},bi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},bi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var e,r,i,n,o=-90,a=90,s=-180,l=180,c=this.size,u=this._unmodified;if(this.latRange){var h=this.latRange;o=t.mercatorYfromLat(h[1])*this.worldSize,e=(a=t.mercatorYfromLat(h[0])*this.worldSize)-o<c.y?c.y/(a-o):0}if(this.lngRange){var A=this.lngRange;s=t.mercatorXfromLng(A[0])*this.worldSize,r=(l=t.mercatorXfromLng(A[1])*this.worldSize)-s<c.x?c.x/(l-s):0}var p=this.point,d=Math.max(r||0,e||0);if(d)return this.center=this.unproject(new t.Point(r?(l+s)/2:p.x,e?(a+o)/2:p.y)),this.zoom+=this.scaleZoom(d),this._unmodified=u,void(this._constraining=!1);if(this.latRange){var f=p.y,m=c.y/2;f-m<o&&(n=o+m),f+m>a&&(n=a-m)}if(this.lngRange){var g=p.x,_=c.x/2;g-_<s&&(i=s+_),g+_>l&&(i=l-_)}void 0===i&&void 0===n||(this.center=this.unproject(new t.Point(void 0!==i?i:p.x,void 0!==n?n:p.y))),this._unmodified=u,this._constraining=!1}},bi.prototype._calcMatrices=function(){if(this.height){var e=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var r=Math.PI/2+this._pitch,i=this._fov*(.5+e.y/this.height),n=Math.sin(i)*this.cameraToCenterDistance/Math.sin(t.clamp(Math.PI-r-i,.01,Math.PI-.01)),o=this.point,a=o.x,s=o.y,l=1.01*(Math.cos(Math.PI/2-this._pitch)*n+this.cameraToCenterDistance),c=this.height/50,u=new Float64Array(16);t.perspective(u,this._fov,this.width/this.height,c,l),u[8]=2*-e.x/this.width,u[9]=2*e.y/this.height,t.scale(u,u,[1,-1,1]),t.translate(u,u,[0,0,-this.cameraToCenterDistance]),t.rotateX(u,u,this._pitch),t.rotateZ(u,u,this.angle),t.translate(u,u,[-a,-s,0]),this.mercatorMatrix=t.scale([],u,[this.worldSize,this.worldSize,this.worldSize]),t.scale(u,u,[1,1,t.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=u,this.invProjMatrix=t.invert([],this.projMatrix);var h=this.width%2/2,A=this.height%2/2,p=Math.cos(this.angle),d=Math.sin(this.angle),f=a-Math.round(a)+p*h+d*A,m=s-Math.round(s)+p*A+d*h,g=new Float64Array(u);if(t.translate(g,g,[f>.5?f-1:f,m>.5?m-1:m,0]),this.alignedProjMatrix=g,u=t.create(),t.scale(u,u,[this.width/2,-this.height/2,1]),t.translate(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=t.create(),t.scale(u,u,[1,-1,1]),t.translate(u,u,[-1,-1,0]),t.scale(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u,this.pixelMatrix=t.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(u=t.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=u,this._posMatrixCache={},this._alignedPosMatrixCache={}}},bi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var e=this.pointCoordinate(new t.Point(0,0)),r=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(r,r,this.pixelMatrix)[3]/this.cameraToCenterDistance},bi.prototype.getCameraPoint=function(){var e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.Point(0,e))},bi.prototype.getCameraQueryGeometry=function(e){var r=this.getCameraPoint();if(1===e.length)return[e[0],r];for(var i=r.x,n=r.y,o=r.x,a=r.y,s=0,l=e;s<l.length;s+=1){var c=l[s];i=Math.min(i,c.x),n=Math.min(n,c.y),o=Math.max(o,c.x),a=Math.max(a,c.y)}return[new t.Point(i,n),new t.Point(o,n),new t.Point(o,a),new t.Point(i,a),new t.Point(i,n)]},Object.defineProperties(bi.prototype,Bi);var Ci=function(e){var r,i,n,o;this._hashName=e&&encodeURIComponent(e),t.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(r=this._updateHashUnthrottled.bind(this),i=!1,n=null,o=function(){n=null,i&&(r(),n=setTimeout(o,300),i=!1)},function(){return i=!0,n||o(),n})};Ci.prototype.addTo=function(e){return this._map=e,t.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Ci.prototype.remove=function(){return t.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Ci.prototype.getHashString=function(e){var r=this._map.getCenter(),i=Math.round(100*this._map.getZoom())/100,n=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),o=Math.pow(10,n),a=Math.round(r.lng*o)/o,s=Math.round(r.lat*o)/o,l=this._map.getBearing(),c=this._map.getPitch(),u="";if(u+=e?"/"+a+"/"+s+"/"+i:i+"/"+s+"/"+a,(l||c)&&(u+="/"+Math.round(10*l)/10),c&&(u+="/"+Math.round(c)),this._hashName){var h=this._hashName,A=!1,p=t.window.location.hash.slice(1).split("&").map((function(t){var e=t.split("=")[0];return e===h?(A=!0,e+"="+u):t})).filter((function(t){return t}));return A||p.push(h+"="+u),"#"+p.join("&")}return"#"+u},Ci.prototype._getCurrentHash=function(){var e,r=this,i=t.window.location.hash.replace("#","");return this._hashName?(i.split("&").map((function(t){return t.split("=")})).forEach((function(t){t[0]===r._hashName&&(e=t)})),(e&&e[1]||"").split("/")):i.split("/")},Ci.prototype._onHashChange=function(){var t=this._getCurrentHash();if(t.length>=3&&!t.some((function(t){return isNaN(t)}))){var e=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:e,pitch:+(t[4]||0)}),!0}return!1},Ci.prototype._updateHashUnthrottled=function(){var e=t.window.location.href.replace(/(#.+)?$/,this.getHashString());try{t.window.history.replaceState(t.window.history.state,null,e)}catch(t){}};var Ei={linearity:.3,easing:t.bezier(0,0,.3,1)},Ti=t.extend({deceleration:2500,maxSpeed:1400},Ei),Ii=t.extend({deceleration:20,maxSpeed:1400},Ei),Si=t.extend({deceleration:1e3,maxSpeed:360},Ei),Mi=t.extend({deceleration:1e3,maxSpeed:90},Ei),Fi=function(t){this._map=t,this.clear()};function Pi(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function Li(e,r,i){var n=i.maxSpeed,o=i.linearity,a=i.deceleration,s=t.clamp(e*o/(r/1e3),-n,n),l=Math.abs(s)/(a*o);return{easing:i.easing,duration:1e3*l,amount:s*(l/2)}}Fi.prototype.clear=function(){this._inertiaBuffer=[]},Fi.prototype.record=function(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:t.browser.now(),settings:e})},Fi.prototype._drainInertiaBuffer=function(){for(var e=this._inertiaBuffer,r=t.browser.now();e.length>0&&r-e[0].time>160;)e.shift()},Fi.prototype._onMoveEnd=function(e){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var r={zoom:0,bearing:0,pitch:0,pan:new t.Point(0,0),pinchAround:void 0,around:void 0},i=0,n=this._inertiaBuffer;i<n.length;i+=1){var o=n[i].settings;r.zoom+=o.zoomDelta||0,r.bearing+=o.bearingDelta||0,r.pitch+=o.pitchDelta||0,o.panDelta&&r.pan._add(o.panDelta),o.around&&(r.around=o.around),o.pinchAround&&(r.pinchAround=o.pinchAround)}var a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,s={};if(r.pan.mag()){var l=Li(r.pan.mag(),a,t.extend({},Ti,e||{}));s.offset=r.pan.mult(l.amount/r.pan.mag()),s.center=this._map.transform.center,Pi(s,l)}if(r.zoom){var c=Li(r.zoom,a,Ii);s.zoom=this._map.transform.zoom+c.amount,Pi(s,c)}if(r.bearing){var u=Li(r.bearing,a,Si);s.bearing=this._map.transform.bearing+t.clamp(u.amount,-179,179),Pi(s,u)}if(r.pitch){var h=Li(r.pitch,a,Mi);s.pitch=this._map.transform.pitch+h.amount,Pi(s,h)}if(s.zoom||s.bearing){var A=void 0===r.pinchAround?r.around:r.pinchAround;s.around=A?this._map.unproject(A):this._map.getCenter()}return this.clear(),t.extend(s,{noMoveStart:!0})}};var Di=function(e){function i(i,n,o,a){void 0===a&&(a={});var s=r.mousePos(n.getCanvasContainer(),o),l=n.unproject(s);e.call(this,i,t.extend({point:s,lngLat:l,originalEvent:o},a)),this._defaultPrevented=!1,this.target=n}e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i;var n={defaultPrevented:{configurable:!0}};return i.prototype.preventDefault=function(){this._defaultPrevented=!0},n.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(i.prototype,n),i}(t.Event),Ui=function(e){function i(i,n,o){var a="touchend"===i?o.changedTouches:o.touches,s=r.touchPos(n.getCanvasContainer(),a),l=s.map((function(t){return n.unproject(t)})),c=s.reduce((function(t,e,r,i){return t.add(e.div(i.length))}),new t.Point(0,0)),u=n.unproject(c);e.call(this,i,{points:s,point:c,lngLats:l,lngLat:u,originalEvent:o}),this._defaultPrevented=!1}e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i;var n={defaultPrevented:{configurable:!0}};return i.prototype.preventDefault=function(){this._defaultPrevented=!0},n.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(i.prototype,n),i}(t.Event),ki=function(t){function e(e,r,i){t.call(this,e,{originalEvent:i}),this._defaultPrevented=!1}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={defaultPrevented:{configurable:!0}};return e.prototype.preventDefault=function(){this._defaultPrevented=!0},r.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(e.prototype,r),e}(t.Event),zi=function(t,e){this._map=t,this._clickTolerance=e.clickTolerance};zi.prototype.reset=function(){delete this._mousedownPos},zi.prototype.wheel=function(t){return this._firePreventable(new ki(t.type,this._map,t))},zi.prototype.mousedown=function(t,e){return this._mousedownPos=e,this._firePreventable(new Di(t.type,this._map,t))},zi.prototype.mouseup=function(t){this._map.fire(new Di(t.type,this._map,t))},zi.prototype.click=function(t,e){this._mousedownPos&&this._mousedownPos.dist(e)>=this._clickTolerance||this._map.fire(new Di(t.type,this._map,t))},zi.prototype.dblclick=function(t){return this._firePreventable(new Di(t.type,this._map,t))},zi.prototype.mouseover=function(t){this._map.fire(new Di(t.type,this._map,t))},zi.prototype.mouseout=function(t){this._map.fire(new Di(t.type,this._map,t))},zi.prototype.touchstart=function(t){return this._firePreventable(new Ui(t.type,this._map,t))},zi.prototype.touchmove=function(t){this._map.fire(new Ui(t.type,this._map,t))},zi.prototype.touchend=function(t){this._map.fire(new Ui(t.type,this._map,t))},zi.prototype.touchcancel=function(t){this._map.fire(new Ui(t.type,this._map,t))},zi.prototype._firePreventable=function(t){if(this._map.fire(t),t.defaultPrevented)return{}},zi.prototype.isEnabled=function(){return!0},zi.prototype.isActive=function(){return!1},zi.prototype.enable=function(){},zi.prototype.disable=function(){};var Ri=function(t){this._map=t};Ri.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Ri.prototype.mousemove=function(t){this._map.fire(new Di(t.type,this._map,t))},Ri.prototype.mousedown=function(){this._delayContextMenu=!0},Ri.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Di("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Ri.prototype.contextmenu=function(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Di(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()},Ri.prototype.isEnabled=function(){return!0},Ri.prototype.isActive=function(){return!1},Ri.prototype.enable=function(){},Ri.prototype.disable=function(){};var Oi=function(t,e){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=e.clickTolerance||1};function Qi(t,e){for(var r={},i=0;i<t.length;i++)r[t[i].identifier]=e[i];return r}Oi.prototype.isEnabled=function(){return!!this._enabled},Oi.prototype.isActive=function(){return!!this._active},Oi.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Oi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Oi.prototype.mousedown=function(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(r.disableDrag(),this._startPos=this._lastPos=e,this._active=!0)},Oi.prototype.mousemoveWindow=function(t,e){if(this._active){var i=e;if(!(this._lastPos.equals(i)||!this._box&&i.dist(this._startPos)<this._clickTolerance)){var n=this._startPos;this._lastPos=i,this._box||(this._box=r.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));var o=Math.min(n.x,i.x),a=Math.max(n.x,i.x),s=Math.min(n.y,i.y),l=Math.max(n.y,i.y);r.setTransform(this._box,"translate("+o+"px,"+s+"px)"),this._box.style.width=a-o+"px",this._box.style.height=l-s+"px"}}},Oi.prototype.mouseupWindow=function(e,i){var n=this;if(this._active&&0===e.button){var o=this._startPos,a=i;if(this.reset(),r.suppressClick(),o.x!==a.x||o.y!==a.y)return this._map.fire(new t.Event("boxzoomend",{originalEvent:e})),{cameraAnimation:function(t){return t.fitScreenCoordinates(o,a,n._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",e)}},Oi.prototype.keydown=function(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))},Oi.prototype.blur=function(){this.reset()},Oi.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(r.remove(this._box),this._box=null),r.enableDrag(),delete this._startPos,delete this._lastPos},Oi.prototype._fireEvent=function(e,r){return this._map.fire(new t.Event(e,{originalEvent:r}))};var Ni=function(t){this.reset(),this.numTouches=t.numTouches};Ni.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Ni.prototype.touchstart=function(e,r,i){(this.centroid||i.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=e.timeStamp),i.length===this.numTouches&&(this.centroid=function(e){for(var r=new t.Point(0,0),i=0,n=e;i<n.length;i+=1)r._add(n[i]);return r.div(e.length)}(r),this.touches=Qi(i,r)))},Ni.prototype.touchmove=function(t,e,r){if(!this.aborted&&this.centroid){var i=Qi(r,e);for(var n in this.touches){var o=i[n];(!o||o.dist(this.touches[n])>30)&&(this.aborted=!0)}}},Ni.prototype.touchend=function(t,e,r){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===r.length){var i=!this.aborted&&this.centroid;if(this.reset(),i)return i}};var Vi=function(t){this.singleTap=new Ni(t),this.numTaps=t.numTaps,this.reset()};Vi.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Vi.prototype.touchstart=function(t,e,r){this.singleTap.touchstart(t,e,r)},Vi.prototype.touchmove=function(t,e,r){this.singleTap.touchmove(t,e,r)},Vi.prototype.touchend=function(t,e,r){var i=this.singleTap.touchend(t,e,r);if(i){var n=t.timeStamp-this.lastTime<500,o=!this.lastTap||this.lastTap.dist(i)<30;if(n&&o||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=i,this.count===this.numTaps)return this.reset(),i}};var Hi=function(){this._zoomIn=new Vi({numTouches:1,numTaps:2}),this._zoomOut=new Vi({numTouches:2,numTaps:1}),this.reset()};Hi.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Hi.prototype.touchstart=function(t,e,r){this._zoomIn.touchstart(t,e,r),this._zoomOut.touchstart(t,e,r)},Hi.prototype.touchmove=function(t,e,r){this._zoomIn.touchmove(t,e,r),this._zoomOut.touchmove(t,e,r)},Hi.prototype.touchend=function(t,e,r){var i=this,n=this._zoomIn.touchend(t,e,r),o=this._zoomOut.touchend(t,e,r);return n?(this._active=!0,t.preventDefault(),setTimeout((function(){return i.reset()}),0),{cameraAnimation:function(e){return e.easeTo({duration:300,zoom:e.getZoom()+1,around:e.unproject(n)},{originalEvent:t})}}):o?(this._active=!0,t.preventDefault(),setTimeout((function(){return i.reset()}),0),{cameraAnimation:function(e){return e.easeTo({duration:300,zoom:e.getZoom()-1,around:e.unproject(o)},{originalEvent:t})}}):void 0},Hi.prototype.touchcancel=function(){this.reset()},Hi.prototype.enable=function(){this._enabled=!0},Hi.prototype.disable=function(){this._enabled=!1,this.reset()},Hi.prototype.isEnabled=function(){return this._enabled},Hi.prototype.isActive=function(){return this._active};var ji={0:1,2:2},Gi=function(t){this.reset(),this._clickTolerance=t.clickTolerance||1};Gi.prototype.blur=function(){this.reset()},Gi.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Gi.prototype._correctButton=function(t,e){return!1},Gi.prototype._move=function(t,e){return{}},Gi.prototype.mousedown=function(t,e){if(!this._lastPoint){var i=r.mouseButton(t);this._correctButton(t,i)&&(this._lastPoint=e,this._eventButton=i)}},Gi.prototype.mousemoveWindow=function(t,e){var r=this._lastPoint;if(r)if(t.preventDefault(),function(t,e){var r=ji[e];return void 0===t.buttons||(t.buttons&r)!==r}(t,this._eventButton))this.reset();else if(this._moved||!(e.dist(r)<this._clickTolerance))return this._moved=!0,this._lastPoint=e,this._move(r,e)},Gi.prototype.mouseupWindow=function(t){this._lastPoint&&r.mouseButton(t)===this._eventButton&&(this._moved&&r.suppressClick(),this.reset())},Gi.prototype.enable=function(){this._enabled=!0},Gi.prototype.disable=function(){this._enabled=!1,this.reset()},Gi.prototype.isEnabled=function(){return this._enabled},Gi.prototype.isActive=function(){return this._active};var Ki=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.mousedown=function(e,r){t.prototype.mousedown.call(this,e,r),this._lastPoint&&(this._active=!0)},e.prototype._correctButton=function(t,e){return 0===e&&!t.ctrlKey},e.prototype._move=function(t,e){return{around:e,panDelta:e.sub(t)}},e}(Gi),qi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._correctButton=function(t,e){return 0===e&&t.ctrlKey||2===e},e.prototype._move=function(t,e){var r=.8*(e.x-t.x);if(r)return this._active=!0,{bearingDelta:r}},e.prototype.contextmenu=function(t){t.preventDefault()},e}(Gi),Zi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._correctButton=function(t,e){return 0===e&&t.ctrlKey||2===e},e.prototype._move=function(t,e){var r=-.5*(e.y-t.y);if(r)return this._active=!0,{pitchDelta:r}},e.prototype.contextmenu=function(t){t.preventDefault()},e}(Gi),Wi=function(t){this._minTouches=1,this._clickTolerance=t.clickTolerance||1,this.reset()};Wi.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new t.Point(0,0)},Wi.prototype.touchstart=function(t,e,r){return this._calculateTransform(t,e,r)},Wi.prototype.touchmove=function(t,e,r){if(this._active&&!(r.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,e,r)},Wi.prototype.touchend=function(t,e,r){this._calculateTransform(t,e,r),this._active&&r.length<this._minTouches&&this.reset()},Wi.prototype.touchcancel=function(){this.reset()},Wi.prototype._calculateTransform=function(e,r,i){i.length>0&&(this._active=!0);var n=Qi(i,r),o=new t.Point(0,0),a=new t.Point(0,0),s=0;for(var l in n){var c=n[l],u=this._touches[l];u&&(o._add(c),a._add(c.sub(u)),s++,n[l]=c)}if(this._touches=n,!(s<this._minTouches)&&a.mag()){var h=a.div(s);if(this._sum._add(h),!(this._sum.mag()<this._clickTolerance))return{around:o.div(s),panDelta:h}}},Wi.prototype.enable=function(){this._enabled=!0},Wi.prototype.disable=function(){this._enabled=!1,this.reset()},Wi.prototype.isEnabled=function(){return this._enabled},Wi.prototype.isActive=function(){return this._active};var Xi=function(){this.reset()};function $i(t,e,r){for(var i=0;i<t.length;i++)if(t[i].identifier===r)return e[i]}function Yi(t,e){return Math.log(t/e)/Math.LN2}Xi.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Xi.prototype._start=function(t){},Xi.prototype._move=function(t,e,r){return{}},Xi.prototype.touchstart=function(t,e,r){this._firstTwoTouches||r.length<2||(this._firstTwoTouches=[r[0].identifier,r[1].identifier],this._start([e[0],e[1]]))},Xi.prototype.touchmove=function(t,e,r){if(this._firstTwoTouches){t.preventDefault();var i=this._firstTwoTouches,n=i[1],o=$i(r,e,i[0]),a=$i(r,e,n);if(o&&a){var s=this._aroundCenter?null:o.add(a).div(2);return this._move([o,a],s,t)}}},Xi.prototype.touchend=function(t,e,i){if(this._firstTwoTouches){var n=this._firstTwoTouches,o=n[1],a=$i(i,e,n[0]),s=$i(i,e,o);a&&s||(this._active&&r.suppressClick(),this.reset())}},Xi.prototype.touchcancel=function(){this.reset()},Xi.prototype.enable=function(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around},Xi.prototype.disable=function(){this._enabled=!1,this.reset()},Xi.prototype.isEnabled=function(){return this._enabled},Xi.prototype.isActive=function(){return this._active};var Ji=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.reset=function(){t.prototype.reset.call(this),delete this._distance,delete this._startDistance},e.prototype._start=function(t){this._startDistance=this._distance=t[0].dist(t[1])},e.prototype._move=function(t,e){var r=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Yi(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Yi(this._distance,r),pinchAround:e}},e}(Xi);function tn(t,e){return 180*t.angleWith(e)/Math.PI}var en=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.reset=function(){t.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},e.prototype._start=function(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])},e.prototype._move=function(t,e){var r=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:tn(this._vector,r),pinchAround:e}},e.prototype._isBelowThreshold=function(t){this._minDiameter=Math.min(this._minDiameter,t.mag());var e=25/(Math.PI*this._minDiameter)*360,r=tn(t,this._startVector);return Math.abs(r)<e},e}(Xi);function rn(t){return Math.abs(t.y)>Math.abs(t.x)}var nn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.reset=function(){t.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},e.prototype._start=function(t){this._lastPoints=t,rn(t[0].sub(t[1]))&&(this._valid=!1)},e.prototype._move=function(t,e,r){var i=t[0].sub(this._lastPoints[0]),n=t[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(i,n,r.timeStamp),this._valid)return this._lastPoints=t,this._active=!0,{pitchDelta:(i.y+n.y)/2*-.5}},e.prototype.gestureBeginsVertically=function(t,e,r){if(void 0!==this._valid)return this._valid;var i=t.mag()>=2,n=e.mag()>=2;if(i||n){if(!i||!n)return void 0===this._firstMove&&(this._firstMove=r),r-this._firstMove<100&&void 0;var o=t.y>0==e.y>0;return rn(t)&&rn(e)&&o}},e}(Xi),on={panStep:100,bearingStep:15,pitchStep:10},an=function(){var t=on;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1};function sn(t){return t*(2-t)}an.prototype.blur=function(){this.reset()},an.prototype.reset=function(){this._active=!1},an.prototype.keydown=function(t){var e=this;if(!(t.altKey||t.ctrlKey||t.metaKey)){var r=0,i=0,n=0,o=0,a=0;switch(t.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:t.shiftKey?i=-1:(t.preventDefault(),o=-1);break;case 39:t.shiftKey?i=1:(t.preventDefault(),o=1);break;case 38:t.shiftKey?n=1:(t.preventDefault(),a=-1);break;case 40:t.shiftKey?n=-1:(t.preventDefault(),a=1);break;default:return}return this._rotationDisabled&&(i=0,n=0),{cameraAnimation:function(s){var l=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:sn,zoom:r?Math.round(l)+r*(t.shiftKey?2:1):l,bearing:s.getBearing()+i*e._bearingStep,pitch:s.getPitch()+n*e._pitchStep,offset:[-o*e._panStep,-a*e._panStep],center:s.getCenter()},{originalEvent:t})}}}},an.prototype.enable=function(){this._enabled=!0},an.prototype.disable=function(){this._enabled=!1,this.reset()},an.prototype.isEnabled=function(){return this._enabled},an.prototype.isActive=function(){return this._active},an.prototype.disableRotation=function(){this._rotationDisabled=!0},an.prototype.enableRotation=function(){this._rotationDisabled=!1};var ln=function(e,r){this._map=e,this._el=e.getCanvasContainer(),this._handler=r,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,t.bindAll(["_onTimeout"],this)};ln.prototype.setZoomRate=function(t){this._defaultZoomRate=t},ln.prototype.setWheelZoomRate=function(t){this._wheelZoomRate=t},ln.prototype.isEnabled=function(){return!!this._enabled},ln.prototype.isActive=function(){return!!this._active||void 0!==this._finishTimeout},ln.prototype.isZooming=function(){return!!this._zooming},ln.prototype.enable=function(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&"center"===t.around)},ln.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ln.prototype.wheel=function(e){if(this.isEnabled()){var r=e.deltaMode===t.window.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,i=t.browser.now(),n=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,0!==r&&r%4.000244140625==0?this._type="wheel":0!==r&&Math.abs(r)<4?this._type="trackpad":n>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(n*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),e.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=e,this._delta-=r,this._active||this._start(e)),e.preventDefault()}},ln.prototype._onTimeout=function(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)},ln.prototype._start=function(e){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var i=r.mousePos(this._el,e);this._around=t.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(i)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},ln.prototype.renderFrame=function(){var e=this;if(this._frameId&&(this._frameId=null,this.isActive())){var r=this._map.transform;if(0!==this._delta){var i="wheel"===this._type&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,n=2/(1+Math.exp(-Math.abs(this._delta*i)));this._delta<0&&0!==n&&(n=1/n);var o="number"==typeof this._targetZoom?r.zoomScale(this._targetZoom):r.scale;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(o*n))),"wheel"===this._type&&(this._startZoom=r.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var a,s="number"==typeof this._targetZoom?this._targetZoom:r.zoom,l=this._startZoom,c=this._easing,u=!1;if("wheel"===this._type&&l&&c){var h=Math.min((t.browser.now()-this._lastWheelEventTime)/200,1),A=c(h);a=t.number(l,s,A),h<1?this._frameId||(this._frameId=!0):u=!0}else a=s,u=!0;return this._active=!0,u&&(this._active=!1,this._finishTimeout=setTimeout((function(){e._zooming=!1,e._handler._triggerRenderFrame(),delete e._targetZoom,delete e._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!u,zoomDelta:a-r.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},ln.prototype._smoothOutEasing=function(e){var r=t.ease;if(this._prevEase){var i=this._prevEase,n=(t.browser.now()-i.start)/i.duration,o=i.easing(n+.01)-i.easing(n),a=.27/Math.sqrt(o*o+1e-4)*.01,s=Math.sqrt(.0729-a*a);r=t.bezier(a,s,.25,1)}return this._prevEase={start:t.browser.now(),duration:e,easing:r},r},ln.prototype.blur=function(){this.reset()},ln.prototype.reset=function(){this._active=!1};var cn=function(t,e){this._clickZoom=t,this._tapZoom=e};cn.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},cn.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},cn.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},cn.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var un=function(){this.reset()};un.prototype.reset=function(){this._active=!1},un.prototype.blur=function(){this.reset()},un.prototype.dblclick=function(t,e){return t.preventDefault(),{cameraAnimation:function(r){r.easeTo({duration:300,zoom:r.getZoom()+(t.shiftKey?-1:1),around:r.unproject(e)},{originalEvent:t})}}},un.prototype.enable=function(){this._enabled=!0},un.prototype.disable=function(){this._enabled=!1,this.reset()},un.prototype.isEnabled=function(){return this._enabled},un.prototype.isActive=function(){return this._active};var hn=function(){this._tap=new Vi({numTouches:1,numTaps:1}),this.reset()};hn.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},hn.prototype.touchstart=function(t,e,r){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?r.length>0&&(this._swipePoint=e[0],this._swipeTouch=r[0].identifier):this._tap.touchstart(t,e,r))},hn.prototype.touchmove=function(t,e,r){if(this._tapTime){if(this._swipePoint){if(r[0].identifier!==this._swipeTouch)return;var i=e[0],n=i.y-this._swipePoint.y;return this._swipePoint=i,t.preventDefault(),this._active=!0,{zoomDelta:n/128}}}else this._tap.touchmove(t,e,r)},hn.prototype.touchend=function(t,e,r){this._tapTime?this._swipePoint&&0===r.length&&this.reset():this._tap.touchend(t,e,r)&&(this._tapTime=t.timeStamp)},hn.prototype.touchcancel=function(){this.reset()},hn.prototype.enable=function(){this._enabled=!0},hn.prototype.disable=function(){this._enabled=!1,this.reset()},hn.prototype.isEnabled=function(){return this._enabled},hn.prototype.isActive=function(){return this._active};var An=function(t,e,r){this._el=t,this._mousePan=e,this._touchPan=r};An.prototype.enable=function(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},An.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},An.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},An.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var pn=function(t,e,r){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=e,this._mousePitch=r};pn.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},pn.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},pn.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},pn.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var dn=function(t,e,r,i){this._el=t,this._touchZoom=e,this._touchRotate=r,this._tapDragZoom=i,this._rotationDisabled=!1,this._enabled=!0};dn.prototype.enable=function(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},dn.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},dn.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},dn.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},dn.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},dn.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var fn=function(t){return t.zoom||t.drag||t.pitch||t.rotate},mn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(t.Event);function gn(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}var _n=function(e,i){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Fi(e),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(i),t.bindAll(["handleEvent","handleWindowEvent"],this);var n=this._el;this._listeners=[[n,"touchstart",{passive:!0}],[n,"touchmove",{passive:!1}],[n,"touchend",void 0],[n,"touchcancel",void 0],[n,"mousedown",void 0],[n,"mousemove",void 0],[n,"mouseup",void 0],[t.window.document,"mousemove",{capture:!0}],[t.window.document,"mouseup",void 0],[n,"mouseover",void 0],[n,"mouseout",void 0],[n,"dblclick",void 0],[n,"click",void 0],[n,"keydown",{capture:!1}],[n,"keyup",void 0],[n,"wheel",{passive:!1}],[n,"contextmenu",void 0],[t.window,"blur",void 0]];for(var o=0,a=this._listeners;o<a.length;o+=1){var s=a[o],l=s[0];r.addEventListener(l,s[1],l===t.window.document?this.handleWindowEvent:this.handleEvent,s[2])}};_n.prototype.destroy=function(){for(var e=0,i=this._listeners;e<i.length;e+=1){var n=i[e],o=n[0];r.removeEventListener(o,n[1],o===t.window.document?this.handleWindowEvent:this.handleEvent,n[2])}},_n.prototype._addDefaultHandlers=function(t){var e=this._map,r=e.getCanvasContainer();this._add("mapEvent",new zi(e,t));var i=e.boxZoom=new Oi(e,t);this._add("boxZoom",i);var n=new Hi,o=new un;e.doubleClickZoom=new cn(o,n),this._add("tapZoom",n),this._add("clickZoom",o);var a=new hn;this._add("tapDragZoom",a);var s=e.touchPitch=new nn;this._add("touchPitch",s);var l=new qi(t),c=new Zi(t);e.dragRotate=new pn(t,l,c),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);var u=new Ki(t),h=new Wi(t);e.dragPan=new An(r,u,h),this._add("mousePan",u),this._add("touchPan",h,["touchZoom","touchRotate"]);var A=new en,p=new Ji;e.touchZoomRotate=new dn(r,p,A,a),this._add("touchRotate",A,["touchPan","touchZoom"]),this._add("touchZoom",p,["touchPan","touchRotate"]);var d=e.scrollZoom=new ln(e,this);this._add("scrollZoom",d,["mousePan"]);var f=e.keyboard=new an;this._add("keyboard",f),this._add("blockableMapEvent",new Ri(e));for(var m=0,g=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];m<g.length;m+=1){var _=g[m];t.interactive&&t[_]&&e[_].enable(t[_])}},_n.prototype._add=function(t,e,r){this._handlers.push({handlerName:t,handler:e,allowed:r}),this._handlersById[t]=e},_n.prototype.stop=function(t){if(!this._updatingCamera){for(var e=0,r=this._handlers;e<r.length;e+=1)r[e].handler.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}},_n.prototype.isActive=function(){for(var t=0,e=this._handlers;t<e.length;t+=1)if(e[t].handler.isActive())return!0;return!1},_n.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},_n.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},_n.prototype.isMoving=function(){return Boolean(fn(this._eventsInProgress))||this.isZooming()},_n.prototype._blockedByActive=function(t,e,r){for(var i in t)if(i!==r&&(!e||e.indexOf(i)<0))return!0;return!1},_n.prototype.handleWindowEvent=function(t){this.handleEvent(t,t.type+"Window")},_n.prototype._getMapTouches=function(t){for(var e=[],r=0,i=t;r<i.length;r+=1){var n=i[r];this._el.contains(n.target)&&e.push(n)}return e},_n.prototype.handleEvent=function(t,e){this._updatingCamera=!0;for(var i="renderFrame"===t.type?void 0:t,n={needsRenderFrame:!1},o={},a={},s=t.touches?this._getMapTouches(t.touches):void 0,l=s?r.touchPos(this._el,s):r.mousePos(this._el,t),c=0,u=this._handlers;c<u.length;c+=1){var h=u[c],A=h.handlerName,p=h.handler,d=h.allowed;if(p.isEnabled()){var f=void 0;this._blockedByActive(a,d,A)?p.reset():p[e||t.type]&&(f=p[e||t.type](t,l,s),this.mergeHandlerResult(n,o,f,A,i),f&&f.needsRenderFrame&&this._triggerRenderFrame()),(f||p.isActive())&&(a[A]=p)}}var m={};for(var g in this._previousActiveHandlers)a[g]||(m[g]=i);this._previousActiveHandlers=a,(Object.keys(m).length||gn(n))&&(this._changes.push([n,o,m]),this._triggerRenderFrame()),(Object.keys(a).length||gn(n))&&this._map._stop(!0),this._updatingCamera=!1;var _=n.cameraAnimation;_&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],_(this._map))},_n.prototype.mergeHandlerResult=function(e,r,i,n,o){if(i){t.extend(e,i);var a={handlerName:n,originalEvent:i.originalEvent||o};void 0!==i.zoomDelta&&(r.zoom=a),void 0!==i.panDelta&&(r.drag=a),void 0!==i.pitchDelta&&(r.pitch=a),void 0!==i.bearingDelta&&(r.rotate=a)}},_n.prototype._applyChanges=function(){for(var e={},r={},i={},n=0,o=this._changes;n<o.length;n+=1){var a=o[n],s=a[0],l=a[1],c=a[2];s.panDelta&&(e.panDelta=(e.panDelta||new t.Point(0,0))._add(s.panDelta)),s.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+s.zoomDelta),s.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+s.bearingDelta),s.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+s.pitchDelta),void 0!==s.around&&(e.around=s.around),void 0!==s.pinchAround&&(e.pinchAround=s.pinchAround),s.noInertia&&(e.noInertia=s.noInertia),t.extend(r,l),t.extend(i,c)}this._updateMapTransform(e,r,i),this._changes=[]},_n.prototype._updateMapTransform=function(t,e,r){var i=this._map,n=i.transform;if(!gn(t))return this._fireEvents(e,r,!0);var o=t.panDelta,a=t.zoomDelta,s=t.bearingDelta,l=t.pitchDelta,c=t.around,u=t.pinchAround;void 0!==u&&(c=u),i._stop(!0),c=c||i.transform.centerPoint;var h=n.pointLocation(o?c.sub(o):c);s&&(n.bearing+=s),l&&(n.pitch+=l),a&&(n.zoom+=a),n.setLocationAtPoint(h,c),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(e,r,!0)},_n.prototype._fireEvents=function(e,r,i){var n=this,o=fn(this._eventsInProgress),a=fn(e),s={};for(var l in e)this._eventsInProgress[l]||(s[l+"start"]=e[l].originalEvent),this._eventsInProgress[l]=e[l];for(var c in!o&&a&&this._fireEvent("movestart",a.originalEvent),s)this._fireEvent(c,s[c]);for(var u in a&&this._fireEvent("move",a.originalEvent),e)this._fireEvent(u,e[u].originalEvent);var h,A={};for(var p in this._eventsInProgress){var d=this._eventsInProgress[p],f=d.handlerName,m=d.originalEvent;this._handlersById[f].isActive()||(delete this._eventsInProgress[p],A[p+"end"]=h=r[f]||m)}for(var g in A)this._fireEvent(g,A[g]);var _=fn(this._eventsInProgress);if(i&&(o||a)&&!_){this._updatingCamera=!0;var y=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),v=function(t){return 0!==t&&-n._bearingSnap<t&&t<n._bearingSnap};y?(v(y.bearing||this._map.getBearing())&&(y.bearing=0),this._map.easeTo(y,{originalEvent:h})):(this._map.fire(new t.Event("moveend",{originalEvent:h})),v(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},_n.prototype._fireEvent=function(e,r){this._map.fire(new t.Event(e,r?{originalEvent:r}:{}))},_n.prototype._requestFrame=function(){var t=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add((function(e){delete t._frameId,t.handleEvent(new mn("renderFrame",{timeStamp:e})),t._applyChanges()}))},_n.prototype._triggerRenderFrame=function(){void 0===this._frameId&&(this._frameId=this._requestFrame())};var yn=function(e){function r(r,i){e.call(this),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=i.bearingSnap,t.bindAll(["_renderFrameCallback"],this)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.getCenter=function(){return new t.LngLat(this.transform.center.lng,this.transform.center.lat)},r.prototype.setCenter=function(t,e){return this.jumpTo({center:t},e)},r.prototype.panBy=function(e,r,i){return e=t.Point.convert(e).mult(-1),this.panTo(this.transform.center,t.extend({offset:e},r),i)},r.prototype.panTo=function(e,r,i){return this.easeTo(t.extend({center:e},r),i)},r.prototype.getZoom=function(){return this.transform.zoom},r.prototype.setZoom=function(t,e){return this.jumpTo({zoom:t},e),this},r.prototype.zoomTo=function(e,r,i){return this.easeTo(t.extend({zoom:e},r),i)},r.prototype.zoomIn=function(t,e){return this.zoomTo(this.getZoom()+1,t,e),this},r.prototype.zoomOut=function(t,e){return this.zoomTo(this.getZoom()-1,t,e),this},r.prototype.getBearing=function(){return this.transform.bearing},r.prototype.setBearing=function(t,e){return this.jumpTo({bearing:t},e),this},r.prototype.getPadding=function(){return this.transform.padding},r.prototype.setPadding=function(t,e){return this.jumpTo({padding:t},e),this},r.prototype.rotateTo=function(e,r,i){return this.easeTo(t.extend({bearing:e},r),i)},r.prototype.resetNorth=function(e,r){return this.rotateTo(0,t.extend({duration:1e3},e),r),this},r.prototype.resetNorthPitch=function(e,r){return this.easeTo(t.extend({bearing:0,pitch:0,duration:1e3},e),r),this},r.prototype.snapToNorth=function(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this},r.prototype.getPitch=function(){return this.transform.pitch},r.prototype.setPitch=function(t,e){return this.jumpTo({pitch:t},e),this},r.prototype.cameraForBounds=function(e,r){e=t.LngLatBounds.convert(e);var i=r&&r.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),i,r)},r.prototype._cameraForBoxAndBearing=function(e,r,i,n){var o={top:0,bottom:0,right:0,left:0};if("number"==typeof(n=t.extend({padding:o,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding){var a=n.padding;n.padding={top:a,bottom:a,right:a,left:a}}n.padding=t.extend(o,n.padding);var s=this.transform,l=s.padding,c=s.project(t.LngLat.convert(e)),u=s.project(t.LngLat.convert(r)),h=c.rotate(-i*Math.PI/180),A=u.rotate(-i*Math.PI/180),p=new t.Point(Math.max(h.x,A.x),Math.max(h.y,A.y)),d=new t.Point(Math.min(h.x,A.x),Math.min(h.y,A.y)),f=p.sub(d),m=(s.width-(l.left+l.right+n.padding.left+n.padding.right))/f.x,g=(s.height-(l.top+l.bottom+n.padding.top+n.padding.bottom))/f.y;if(!(g<0||m<0)){var _=Math.min(s.scaleZoom(s.scale*Math.min(m,g)),n.maxZoom),y="number"==typeof n.offset.x?new t.Point(n.offset.x,n.offset.y):t.Point.convert(n.offset),v=new t.Point((n.padding.left-n.padding.right)/2,(n.padding.top-n.padding.bottom)/2).rotate(i*Math.PI/180),x=y.add(v).mult(s.scale/s.zoomScale(_));return{center:s.unproject(c.add(u).div(2).sub(x)),zoom:_,bearing:i}}t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},r.prototype.fitBounds=function(t,e,r){return this._fitInternal(this.cameraForBounds(t,e),e,r)},r.prototype.fitScreenCoordinates=function(e,r,i,n,o){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(t.Point.convert(e)),this.transform.pointLocation(t.Point.convert(r)),i,n),n,o)},r.prototype._fitInternal=function(e,r,i){return e?(delete(r=t.extend(e,r)).padding,r.linear?this.easeTo(r,i):this.flyTo(r,i)):this},r.prototype.jumpTo=function(e,r){this.stop();var i=this.transform,n=!1,o=!1,a=!1;return"zoom"in e&&i.zoom!==+e.zoom&&(n=!0,i.zoom=+e.zoom),void 0!==e.center&&(i.center=t.LngLat.convert(e.center)),"bearing"in e&&i.bearing!==+e.bearing&&(o=!0,i.bearing=+e.bearing),"pitch"in e&&i.pitch!==+e.pitch&&(a=!0,i.pitch=+e.pitch),null==e.padding||i.isPaddingEqual(e.padding)||(i.padding=e.padding),this.fire(new t.Event("movestart",r)).fire(new t.Event("move",r)),n&&this.fire(new t.Event("zoomstart",r)).fire(new t.Event("zoom",r)).fire(new t.Event("zoomend",r)),o&&this.fire(new t.Event("rotatestart",r)).fire(new t.Event("rotate",r)).fire(new t.Event("rotateend",r)),a&&this.fire(new t.Event("pitchstart",r)).fire(new t.Event("pitch",r)).fire(new t.Event("pitchend",r)),this.fire(new t.Event("moveend",r))},r.prototype.easeTo=function(e,r){var i=this;this._stop(!1,e.easeId),(!1===(e=t.extend({offset:[0,0],duration:500,easing:t.ease},e)).animate||!e.essential&&t.browser.prefersReducedMotion)&&(e.duration=0);var n=this.transform,o=this.getZoom(),a=this.getBearing(),s=this.getPitch(),l=this.getPadding(),c="zoom"in e?+e.zoom:o,u="bearing"in e?this._normalizeBearing(e.bearing,a):a,h="pitch"in e?+e.pitch:s,A="padding"in e?e.padding:n.padding,p=t.Point.convert(e.offset),d=n.centerPoint.add(p),f=n.pointLocation(d),m=t.LngLat.convert(e.center||f);this._normalizeCenter(m);var g,_,y=n.project(f),v=n.project(m).sub(y),x=n.zoomScale(c-o);e.around&&(g=t.LngLat.convert(e.around),_=n.locationPoint(g));var w={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||c!==o,this._rotating=this._rotating||a!==u,this._pitching=this._pitching||h!==s,this._padding=!n.isPaddingEqual(A),this._easeId=e.easeId,this._prepareEase(r,e.noMoveStart,w),this._ease((function(e){if(i._zooming&&(n.zoom=t.number(o,c,e)),i._rotating&&(n.bearing=t.number(a,u,e)),i._pitching&&(n.pitch=t.number(s,h,e)),i._padding&&(n.interpolatePadding(l,A,e),d=n.centerPoint.add(p)),g)n.setLocationAtPoint(g,_);else{var f=n.zoomScale(n.zoom-o),m=c>o?Math.min(2,x):Math.max(.5,x),w=Math.pow(m,1-e),b=n.unproject(y.add(v.mult(e*w)).mult(f));n.setLocationAtPoint(n.renderWorldCopies?b.wrap():b,d)}i._fireMoveEvents(r)}),(function(t){i._afterEase(r,t)}),e),this},r.prototype._prepareEase=function(e,r,i){void 0===i&&(i={}),this._moving=!0,r||i.moving||this.fire(new t.Event("movestart",e)),this._zooming&&!i.zooming&&this.fire(new t.Event("zoomstart",e)),this._rotating&&!i.rotating&&this.fire(new t.Event("rotatestart",e)),this._pitching&&!i.pitching&&this.fire(new t.Event("pitchstart",e))},r.prototype._fireMoveEvents=function(e){this.fire(new t.Event("move",e)),this._zooming&&this.fire(new t.Event("zoom",e)),this._rotating&&this.fire(new t.Event("rotate",e)),this._pitching&&this.fire(new t.Event("pitch",e))},r.prototype._afterEase=function(e,r){if(!this._easeId||!r||this._easeId!==r){delete this._easeId;var i=this._zooming,n=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,i&&this.fire(new t.Event("zoomend",e)),n&&this.fire(new t.Event("rotateend",e)),o&&this.fire(new t.Event("pitchend",e)),this.fire(new t.Event("moveend",e))}},r.prototype.flyTo=function(e,r){var i=this;if(!e.essential&&t.browser.prefersReducedMotion){var n=t.pick(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(n,r)}this.stop(),e=t.extend({offset:[0,0],speed:1.2,curve:1.42,easing:t.ease},e);var o=this.transform,a=this.getZoom(),s=this.getBearing(),l=this.getPitch(),c=this.getPadding(),u="zoom"in e?t.clamp(+e.zoom,o.minZoom,o.maxZoom):a,h="bearing"in e?this._normalizeBearing(e.bearing,s):s,A="pitch"in e?+e.pitch:l,p="padding"in e?e.padding:o.padding,d=o.zoomScale(u-a),f=t.Point.convert(e.offset),m=o.centerPoint.add(f),g=o.pointLocation(m),_=t.LngLat.convert(e.center||g);this._normalizeCenter(_);var y=o.project(g),v=o.project(_).sub(y),x=e.curve,w=Math.max(o.width,o.height),b=w/d,B=v.mag();if("minZoom"in e){var C=t.clamp(Math.min(e.minZoom,a,u),o.minZoom,o.maxZoom),E=w/o.zoomScale(C-a);x=Math.sqrt(E/B*2)}var T=x*x;function I(t){var e=(b*b-w*w+(t?-1:1)*T*T*B*B)/(2*(t?b:w)*T*B);return Math.log(Math.sqrt(e*e+1)-e)}function S(t){return(Math.exp(t)-Math.exp(-t))/2}function M(t){return(Math.exp(t)+Math.exp(-t))/2}var F=I(0),P=function(t){return M(F)/M(F+x*t)},L=function(t){return w*((M(F)*(S(e=F+x*t)/M(e))-S(F))/T)/B;var e},D=(I(1)-F)/x;if(Math.abs(B)<1e-6||!isFinite(D)){if(Math.abs(w-b)<1e-6)return this.easeTo(e,r);var U=b<w?-1:1;D=Math.abs(Math.log(b/w))/x,L=function(){return 0},P=function(t){return Math.exp(U*x*t)}}return e.duration="duration"in e?+e.duration:1e3*D/("screenSpeed"in e?+e.screenSpeed/x:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=s!==h,this._pitching=A!==l,this._padding=!o.isPaddingEqual(p),this._prepareEase(r,!1),this._ease((function(e){var n=e*D,d=1/P(n);o.zoom=1===e?u:a+o.scaleZoom(d),i._rotating&&(o.bearing=t.number(s,h,e)),i._pitching&&(o.pitch=t.number(l,A,e)),i._padding&&(o.interpolatePadding(c,p,e),m=o.centerPoint.add(f));var g=1===e?_:o.unproject(y.add(v.mult(L(n))).mult(d));o.setLocationAtPoint(o.renderWorldCopies?g.wrap():g,m),i._fireMoveEvents(r)}),(function(){return i._afterEase(r)}),e),this},r.prototype.isEasing=function(){return!!this._easeFrameId},r.prototype.stop=function(){return this._stop()},r.prototype._stop=function(t,e){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var r=this._onEaseEnd;delete this._onEaseEnd,r.call(this,e)}if(!t){var i=this.handlers;i&&i.stop(!1)}return this},r.prototype._ease=function(e,r,i){!1===i.animate||0===i.duration?(e(1),r()):(this._easeStart=t.browser.now(),this._easeOptions=i,this._onEaseFrame=e,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},r.prototype._renderFrameCallback=function(){var e=Math.min((t.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},r.prototype._normalizeBearing=function(e,r){e=t.wrap(e,-180,180);var i=Math.abs(e-r);return Math.abs(e-360-r)<i&&(e-=360),Math.abs(e+360-r)<i&&(e+=360),e},r.prototype._normalizeCenter=function(t){var e=this.transform;if(e.renderWorldCopies&&!e.lngRange){var r=t.lng-e.center.lng;t.lng+=r>180?-360:r<-180?360:0}},r}(t.Evented),vn=function(e){void 0===e&&(e={}),this.options=e,t.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};vn.prototype.getDefaultPosition=function(){return"bottom-right"},vn.prototype.onAdd=function(t){var e=this.options&&this.options.compact;return this._map=t,this._container=r.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=r.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=r.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),e&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},vn.prototype.onRemove=function(){r.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},vn.prototype._setElementTitle=function(t,e){var r=this._map._getUIString("AttributionControl."+e);t.title=r,t.setAttribute("aria-label",r)},vn.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},vn.prototype._updateEditLink=function(){var e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));var r=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||t.config.ACCESS_TOKEN}];if(e){var i=r.reduce((function(t,e,i){return e.value&&(t+=e.key+"="+e.value+(i<r.length-1?"&":"")),t}),"?");e.href=t.config.FEEDBACK_URL+"/"+i+(this._map._hash?this._map._hash.getHashString(!0):""),e.rel="noopener nofollow",this._setElementTitle(e,"MapFeedback")}},vn.prototype._updateData=function(t){!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())},vn.prototype._updateAttributions=function(){if(this._map.style){var t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((function(t){return"string"!=typeof t?"":t}))):"string"==typeof this.options.customAttribution&&t.push(this.options.customAttribution)),this._map.style.stylesheet){var e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}var r=this._map.style.sourceCaches;for(var i in r){var n=r[i];if(n.used){var o=n.getSource();o.attribution&&t.indexOf(o.attribution)<0&&t.push(o.attribution)}}t.sort((function(t,e){return t.length-e.length}));var a=(t=t.filter((function(e,r){for(var i=r+1;i<t.length;i++)if(t[i].indexOf(e)>=0)return!1;return!0}))).join(" | ");a!==this._attribHTML&&(this._attribHTML=a,t.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},vn.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var xn=function(){t.bindAll(["_updateLogo"],this),t.bindAll(["_updateCompact"],this)};xn.prototype.onAdd=function(t){this._map=t,this._container=r.create("div","mapboxgl-ctrl");var e=r.create("a","mapboxgl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://www.mapbox.com/",e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},xn.prototype.onRemove=function(){r.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},xn.prototype.getDefaultPosition=function(){return"bottom-left"},xn.prototype._updateLogo=function(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")},xn.prototype._logoRequired=function(){if(this._map.style){var t=this._map.style.sourceCaches;for(var e in t)if(t[e].getSource().mapbox_logo)return!0;return!1}},xn.prototype._updateCompact=function(){var t=this._container.children;if(t.length){var e=t[0];this._map.getCanvasContainer().offsetWidth<250?e.classList.add("mapboxgl-compact"):e.classList.remove("mapboxgl-compact")}};var wn=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};wn.prototype.add=function(t){var e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e},wn.prototype.remove=function(t){for(var e=this._currentlyRunning,r=0,i=e?this._queue.concat(e):this._queue;r<i.length;r+=1){var n=i[r];if(n.id===t)return void(n.cancelled=!0)}},wn.prototype.run=function(t){void 0===t&&(t=0);var e=this._currentlyRunning=this._queue;this._queue=[];for(var r=0,i=e;r<i.length;r+=1){var n=i[r];if(!n.cancelled&&(n.callback(t),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},wn.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var bn={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Bn=t.window.HTMLImageElement,Cn=t.window.HTMLElement,En=t.window.ImageBitmap,Tn={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},In=function(i){function n(e){var r=this;if(null!=(e=t.extend({},Tn,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&e.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var n=new bi(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies);if(i.call(this,n,e),this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=e.collectResourceTiming,this._renderTaskQueue=new wn,this._controls=[],this._mapId=t.uniqueId(),this._locale=t.extend({},bn,e.locale),this._clickTolerance=e.clickTolerance,this._requestManager=new t.RequestManager(e.transformRequest,e.accessToken),"string"==typeof e.container){if(this._container=t.window.document.getElementById(e.container),!this._container)throw new Error("Container '"+e.container+"' not found.")}else{if(!(e.container instanceof Cn))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),t.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",(function(){return r._update(!1)})),this.on("moveend",(function(){return r._update(!1)})),this.on("zoom",(function(){return r._update(!0)})),void 0!==t.window&&(t.window.addEventListener("online",this._onWindowOnline,!1),t.window.addEventListener("resize",this._onWindowResize,!1),t.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new _n(this,e),this._hash=e.hash&&new Ci("string"==typeof e.hash&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,t.extend({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new vn({customAttribution:e.customAttribution})),this.addControl(new xn,e.logoPosition),this.on("style.load",(function(){r.transform.unmodified&&r.jumpTo(r.style.stylesheet)})),this.on("data",(function(e){r._update("style"===e.dataType),r.fire(new t.Event(e.dataType+"data",e))})),this.on("dataloading",(function(e){r.fire(new t.Event(e.dataType+"dataloading",e))}))}i&&(n.__proto__=i),(n.prototype=Object.create(i&&i.prototype)).constructor=n;var o={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return n.prototype._getMapId=function(){return this._mapId},n.prototype.addControl=function(e,r){if(void 0===r&&(r=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var i=e.onAdd(this);this._controls.push(e);var n=this._controlPositions[r];return-1!==r.indexOf("bottom")?n.insertBefore(i,n.firstChild):n.appendChild(i),this},n.prototype.removeControl=function(e){if(!e||!e.onRemove)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var r=this._controls.indexOf(e);return r>-1&&this._controls.splice(r,1),e.onRemove(this),this},n.prototype.hasControl=function(t){return this._controls.indexOf(t)>-1},n.prototype.resize=function(e){var r=this._containerDimensions(),i=r[0],n=r[1];if(i===this.transform.width&&n===this.transform.height)return this;this._resizeCanvas(i,n),this.transform.resize(i,n),this.painter.resize(i,n);var o=!this._moving;return o&&this.fire(new t.Event("movestart",e)).fire(new t.Event("move",e)),this.fire(new t.Event("resize",e)),o&&this.fire(new t.Event("moveend",e)),this},n.prototype.getBounds=function(){return this.transform.getBounds()},n.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},n.prototype.setMaxBounds=function(e){return this.transform.setMaxBounds(t.LngLatBounds.convert(e)),this._update()},n.prototype.setMinZoom=function(t){var e;if((t=null!==(e=t)&&void 0!==e?e:-2)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},n.prototype.getMinZoom=function(){return this.transform.minZoom},n.prototype.setMaxZoom=function(t){var e;if((t=null!==(e=t)&&void 0!==e?e:22)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")},n.prototype.getMaxZoom=function(){return this.transform.maxZoom},n.prototype.setMinPitch=function(t){var e;if((t=null!==(e=t)&&void 0!==e?e:0)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},n.prototype.getMinPitch=function(){return this.transform.minPitch},n.prototype.setMaxPitch=function(t){var e;if((t=null!==(e=t)&&void 0!==e?e:60)>60)throw new Error("maxPitch must be less than or equal to 60");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")},n.prototype.getMaxPitch=function(){return this.transform.maxPitch},n.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},n.prototype.setRenderWorldCopies=function(t){return this.transform.renderWorldCopies=t,this._update()},n.prototype.project=function(e){return this.transform.locationPoint(t.LngLat.convert(e))},n.prototype.unproject=function(e){return this.transform.pointLocation(t.Point.convert(e))},n.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},n.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},n.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},n.prototype._createDelegatedListener=function(t,e,r){var i,n=this;if("mouseenter"===t||"mouseover"===t){var o=!1;return{layer:e,listener:r,delegates:{mousemove:function(i){var a=n.getLayer(e)?n.queryRenderedFeatures(i.point,{layers:[e]}):[];a.length?o||(o=!0,r.call(n,new Di(t,n,i.originalEvent,{features:a}))):o=!1},mouseout:function(){o=!1}}}}if("mouseleave"===t||"mouseout"===t){var a=!1;return{layer:e,listener:r,delegates:{mousemove:function(i){(n.getLayer(e)?n.queryRenderedFeatures(i.point,{layers:[e]}):[]).length?a=!0:a&&(a=!1,r.call(n,new Di(t,n,i.originalEvent)))},mouseout:function(e){a&&(a=!1,r.call(n,new Di(t,n,e.originalEvent)))}}}}return{layer:e,listener:r,delegates:(i={},i[t]=function(t){var i=n.getLayer(e)?n.queryRenderedFeatures(t.point,{layers:[e]}):[];i.length&&(t.features=i,r.call(n,t),delete t.features)},i)}},n.prototype.on=function(t,e,r){if(void 0===r)return i.prototype.on.call(this,t,e);var n=this._createDelegatedListener(t,e,r);for(var o in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(n),n.delegates)this.on(o,n.delegates[o]);return this},n.prototype.once=function(t,e,r){if(void 0===r)return i.prototype.once.call(this,t,e);var n=this._createDelegatedListener(t,e,r);for(var o in n.delegates)this.once(o,n.delegates[o]);return this},n.prototype.off=function(t,e,r){var n=this;return void 0===r?i.prototype.off.call(this,t,e):(this._delegatedListeners&&this._delegatedListeners[t]&&function(i){for(var o=i[t],a=0;a<o.length;a++){var s=o[a];if(s.layer===e&&s.listener===r){for(var l in s.delegates)n.off(l,s.delegates[l]);return o.splice(a,1),n}}}(this._delegatedListeners),this)},n.prototype.queryRenderedFeatures=function(e,r){if(!this.style)return[];var i;if(void 0!==r||void 0===e||e instanceof t.Point||Array.isArray(e)||(r=e,e=void 0),r=r||{},(e=e||[[0,0],[this.transform.width,this.transform.height]])instanceof t.Point||"number"==typeof e[0])i=[t.Point.convert(e)];else{var n=t.Point.convert(e[0]),o=t.Point.convert(e[1]);i=[n,new t.Point(o.x,n.y),o,new t.Point(n.x,o.y),n]}return this.style.queryRenderedFeatures(i,r,this.transform)},n.prototype.querySourceFeatures=function(t,e){return this.style.querySourceFeatures(t,e)},n.prototype.setStyle=function(e,r){return!1!==(r=t.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},r)).diff&&r.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&e?(this._diffStyle(e,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._updateStyle(e,r))},n.prototype._getUIString=function(t){var e=this._locale[t];if(null==e)throw new Error("Missing UI string '"+t+"'");return e},n.prototype._updateStyle=function(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove()),t?(this.style=new He(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t),this):(delete this.style,this)},n.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new He(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},n.prototype._diffStyle=function(e,r){var i=this;if("string"==typeof e){var n=this._requestManager.normalizeStyleURL(e),o=this._requestManager.transformRequest(n,t.ResourceType.Style);t.getJSON(o,(function(e,n){e?i.fire(new t.ErrorEvent(e)):n&&i._updateDiff(n,r)}))}else"object"==Ze(e)&&this._updateDiff(e,r)},n.prototype._updateDiff=function(e,r){try{this.style.setState(e)&&this._update(!0)}catch(i){t.warnOnce("Unable to perform style diff: "+(i.message||i.error||i)+".  Rebuilding the style from scratch."),this._updateStyle(e,r)}},n.prototype.getStyle=function(){if(this.style)return this.style.serialize()},n.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():t.warnOnce("There is no style added to the map.")},n.prototype.addSource=function(t,e){return this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)},n.prototype.isSourceLoaded=function(e){var r=this.style&&this.style.sourceCaches[e];if(void 0!==r)return r.loaded();this.fire(new t.ErrorEvent(new Error("There is no source with ID '"+e+"'")))},n.prototype.areTilesLoaded=function(){var t=this.style&&this.style.sourceCaches;for(var e in t){var r=t[e]._tiles;for(var i in r){var n=r[i];if("loaded"!==n.state&&"errored"!==n.state)return!1}}return!0},n.prototype.addSourceType=function(t,e,r){return this._lazyInitEmptyStyle(),this.style.addSourceType(t,e,r)},n.prototype.removeSource=function(t){return this.style.removeSource(t),this._update(!0)},n.prototype.getSource=function(t){return this.style.getSource(t)},n.prototype.addImage=function(e,r,i){void 0===i&&(i={});var n=i.pixelRatio;void 0===n&&(n=1);var o=i.sdf;void 0===o&&(o=!1);var a=i.stretchX,s=i.stretchY,l=i.content;if(this._lazyInitEmptyStyle(),r instanceof Bn||En&&r instanceof En){var c=t.browser.getImageData(r);this.style.addImage(e,{data:new t.RGBAImage({width:c.width,height:c.height},c.data),pixelRatio:n,stretchX:a,stretchY:s,content:l,sdf:o,version:0})}else{if(void 0===r.width||void 0===r.height)return this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var u=r;this.style.addImage(e,{data:new t.RGBAImage({width:r.width,height:r.height},new Uint8Array(r.data)),pixelRatio:n,stretchX:a,stretchY:s,content:l,sdf:o,version:0,userImage:u}),u.onAdd&&u.onAdd(this,e)}},n.prototype.updateImage=function(e,r){var i=this.style.getImage(e);if(!i)return this.fire(new t.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var n=r instanceof Bn||En&&r instanceof En?t.browser.getImageData(r):r,o=n.width,a=n.height,s=n.data;return void 0===o||void 0===a?this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):o!==i.data.width||a!==i.data.height?this.fire(new t.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(i.data.replace(s,!(r instanceof Bn||En&&r instanceof En)),void this.style.updateImage(e,i))},n.prototype.hasImage=function(e){return e?!!this.style.getImage(e):(this.fire(new t.ErrorEvent(new Error("Missing required image id"))),!1)},n.prototype.removeImage=function(t){this.style.removeImage(t)},n.prototype.loadImage=function(e,r){t.getImage(this._requestManager.transformRequest(e,t.ResourceType.Image),r)},n.prototype.listImages=function(){return this.style.listImages()},n.prototype.addLayer=function(t,e){return this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)},n.prototype.moveLayer=function(t,e){return this.style.moveLayer(t,e),this._update(!0)},n.prototype.removeLayer=function(t){return this.style.removeLayer(t),this._update(!0)},n.prototype.getLayer=function(t){return this.style.getLayer(t)},n.prototype.setLayerZoomRange=function(t,e,r){return this.style.setLayerZoomRange(t,e,r),this._update(!0)},n.prototype.setFilter=function(t,e,r){return void 0===r&&(r={}),this.style.setFilter(t,e,r),this._update(!0)},n.prototype.getFilter=function(t){return this.style.getFilter(t)},n.prototype.setPaintProperty=function(t,e,r,i){return void 0===i&&(i={}),this.style.setPaintProperty(t,e,r,i),this._update(!0)},n.prototype.getPaintProperty=function(t,e){return this.style.getPaintProperty(t,e)},n.prototype.setLayoutProperty=function(t,e,r,i){return void 0===i&&(i={}),this.style.setLayoutProperty(t,e,r,i),this._update(!0)},n.prototype.getLayoutProperty=function(t,e){return this.style.getLayoutProperty(t,e)},n.prototype.setLight=function(t,e){return void 0===e&&(e={}),this._lazyInitEmptyStyle(),this.style.setLight(t,e),this._update(!0)},n.prototype.getLight=function(){return this.style.getLight()},n.prototype.setFeatureState=function(t,e){return this.style.setFeatureState(t,e),this._update()},n.prototype.removeFeatureState=function(t,e){return this.style.removeFeatureState(t,e),this._update()},n.prototype.getFeatureState=function(t){return this.style.getFeatureState(t)},n.prototype.getContainer=function(){return this._container},n.prototype.getCanvasContainer=function(){return this._canvasContainer},n.prototype.getCanvas=function(){return this._canvas},n.prototype._containerDimensions=function(){var t=0,e=0;return this._container&&(t=this._container.clientWidth||400,e=this._container.clientHeight||300),[t,e]},n.prototype._detectMissingCSS=function(){"rgb(250, 128, 114)"!==t.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&t.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},n.prototype._setupContainer=function(){var t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=r.create("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();var e=this._canvasContainer=r.create("div","mapboxgl-canvas-container",t);this._interactive&&e.classList.add("mapboxgl-interactive"),this._canvas=r.create("canvas","mapboxgl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var i=this._containerDimensions();this._resizeCanvas(i[0],i[1]);var n=this._controlContainer=r.create("div","mapboxgl-control-container",t),o=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((function(t){o[t]=r.create("div","mapboxgl-ctrl-"+t,n)})),this._container.addEventListener("scroll",this._onMapScroll,!1)},n.prototype._resizeCanvas=function(e,r){var i=t.browser.devicePixelRatio||1;this._canvas.width=i*e,this._canvas.height=i*r,this._canvas.style.width=e+"px",this._canvas.style.height=r+"px"},n.prototype._setupPainter=function(){var r=t.extend({},e.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl",r)||this._canvas.getContext("experimental-webgl",r);i?(this.painter=new yi(i,this.transform),t.webpSupported.testSupport(i)):this.fire(new t.ErrorEvent(new Error("Failed to initialize WebGL")))},n.prototype._contextLost=function(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.Event("webglcontextlost",{originalEvent:e}))},n.prototype._contextRestored=function(e){this._setupPainter(),this.resize(),this._update(),this.fire(new t.Event("webglcontextrestored",{originalEvent:e}))},n.prototype._onMapScroll=function(t){if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},n.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},n.prototype._update=function(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this},n.prototype._requestRenderFrame=function(t){return this._update(),this._renderTaskQueue.add(t)},n.prototype._cancelRenderFrame=function(t){this._renderTaskQueue.remove(t)},n.prototype._render=function(e){var r,i=this,n=0,o=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(r=o.createQueryEXT(),o.beginQueryEXT(o.TIME_ELAPSED_EXT,r),n=t.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(e),!this._removed){var a=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var s=this.transform.zoom,l=t.browser.now();this.style.zoomHistory.update(s,l);var c=new t.EvaluationParameters(s,{now:l,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),u=c.crossFadingFactor();1===u&&u===this._crossFadingFactor||(a=!0,this._crossFadingFactor=u),this.style.update(c)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new t.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new t.Event("load"))),this.style&&(this.style.hasTransitions()||a)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var h=t.browser.now()-n;o.endQueryEXT(o.TIME_ELAPSED_EXT,r),setTimeout((function(){var e=o.getQueryObjectEXT(r,o.QUERY_RESULT_EXT)/1e6;o.deleteQueryEXT(r),i.fire(new t.Event("gpu-timing-frame",{cpuTime:h,gpuTime:e}))}),50)}if(this.listens("gpu-timing-layer")){var A=this.painter.collectGpuTimers();setTimeout((function(){var e=i.painter.queryGpuTimers(A);i.fire(new t.Event("gpu-timing-layer",{layerTimes:e}))}),50)}var p=this._sourcesDirty||this._styleDirty||this._placementDirty;return p||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new t.Event("idle")),!this._loaded||this._fullyLoaded||p||(this._fullyLoaded=!0),this}},n.prototype.remove=function(){this._hash&&this._hash.remove();for(var e=0,r=this._controls;e<r.length;e+=1)r[e].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==t.window&&(t.window.removeEventListener("resize",this._onWindowResize,!1),t.window.removeEventListener("orientationchange",this._onWindowResize,!1),t.window.removeEventListener("online",this._onWindowOnline,!1));var i=this.painter.context.gl.getExtension("WEBGL_lose_context");i&&i.loseContext(),Sn(this._canvasContainer),Sn(this._controlContainer),Sn(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new t.Event("remove"))},n.prototype.triggerRepaint=function(){var e=this;this.style&&!this._frame&&(this._frame=t.browser.frame((function(t){e._frame=null,e._render(t)})))},n.prototype._onWindowOnline=function(){this._update()},n.prototype._onWindowResize=function(t){this._trackResize&&this.resize({originalEvent:t})._update()},o.showTileBoundaries.get=function(){return!!this._showTileBoundaries},o.showTileBoundaries.set=function(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())},o.showPadding.get=function(){return!!this._showPadding},o.showPadding.set=function(t){this._showPadding!==t&&(this._showPadding=t,this._update())},o.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},o.showCollisionBoxes.set=function(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())},o.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},o.showOverdrawInspector.set=function(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())},o.repaint.get=function(){return!!this._repaint},o.repaint.set=function(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())},o.vertices.get=function(){return!!this._vertices},o.vertices.set=function(t){this._vertices=t,this._update()},n.prototype._setCacheLimits=function(e,r){t.setCacheLimits(e,r)},o.version.get=function(){return t.version},Object.defineProperties(n.prototype,o),n}(yn);function Sn(t){t.parentNode&&t.parentNode.removeChild(t)}var Mn={showCompass:!0,showZoom:!0,visualizePitch:!1},Fn=function(e){var i=this;this.options=t.extend({},Mn,e),this._container=r.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(function(t){return t.preventDefault()})),this.options.showZoom&&(t.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(function(t){return i._map.zoomIn({},{originalEvent:t})})),r.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(function(t){return i._map.zoomOut({},{originalEvent:t})})),r.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(t.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(function(t){i.options.visualizePitch?i._map.resetNorthPitch({},{originalEvent:t}):i._map.resetNorth({},{originalEvent:t})})),this._compassIcon=r.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Fn.prototype._updateZoomButtons=function(){var t=this._map.getZoom(),e=t===this._map.getMaxZoom(),r=t===this._map.getMinZoom();this._zoomInButton.disabled=e,this._zoomOutButton.disabled=r,this._zoomInButton.setAttribute("aria-disabled",e.toString()),this._zoomOutButton.setAttribute("aria-disabled",r.toString())},Fn.prototype._rotateCompassArrow=function(){var t=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=t},Fn.prototype.onAdd=function(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Pn(this._map,this._compass,this.options.visualizePitch)),this._container},Fn.prototype.onRemove=function(){r.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Fn.prototype._createButton=function(t,e){var i=r.create("button",t,this._container);return i.type="button",i.addEventListener("click",e),i},Fn.prototype._setButtonTitle=function(t,e){var r=this._map._getUIString("NavigationControl."+e);t.title=r,t.setAttribute("aria-label",r)};var Pn=function(e,i,n){void 0===n&&(n=!1),this._clickTolerance=10,this.element=i,this.mouseRotate=new qi({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,n&&(this.mousePitch=new Zi({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),t.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),r.addEventListener(i,"mousedown",this.mousedown),r.addEventListener(i,"touchstart",this.touchstart,{passive:!1}),r.addEventListener(i,"touchmove",this.touchmove),r.addEventListener(i,"touchend",this.touchend),r.addEventListener(i,"touchcancel",this.reset)};function Ln(e,r,i){if(e=new t.LngLat(e.lng,e.lat),r){var n=new t.LngLat(e.lng-360,e.lat),o=new t.LngLat(e.lng+360,e.lat),a=i.locationPoint(e).distSqr(r);i.locationPoint(n).distSqr(r)<a?e=n:i.locationPoint(o).distSqr(r)<a&&(e=o)}for(;Math.abs(e.lng-i.center.lng)>180;){var s=i.locationPoint(e);if(s.x>=0&&s.y>=0&&s.x<=i.width&&s.y<=i.height)break;e.lng>i.center.lng?e.lng-=360:e.lng+=360}return e}Pn.prototype.down=function(t,e){this.mouseRotate.mousedown(t,e),this.mousePitch&&this.mousePitch.mousedown(t,e),r.disableDrag()},Pn.prototype.move=function(t,e){var r=this.map,i=this.mouseRotate.mousemoveWindow(t,e);if(i&&i.bearingDelta&&r.setBearing(r.getBearing()+i.bearingDelta),this.mousePitch){var n=this.mousePitch.mousemoveWindow(t,e);n&&n.pitchDelta&&r.setPitch(r.getPitch()+n.pitchDelta)}},Pn.prototype.off=function(){var t=this.element;r.removeEventListener(t,"mousedown",this.mousedown),r.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),r.removeEventListener(t,"touchmove",this.touchmove),r.removeEventListener(t,"touchend",this.touchend),r.removeEventListener(t,"touchcancel",this.reset),this.offTemp()},Pn.prototype.offTemp=function(){r.enableDrag(),r.removeEventListener(t.window,"mousemove",this.mousemove),r.removeEventListener(t.window,"mouseup",this.mouseup)},Pn.prototype.mousedown=function(e){this.down(t.extend({},e,{ctrlKey:!0,preventDefault:function(){return e.preventDefault()}}),r.mousePos(this.element,e)),r.addEventListener(t.window,"mousemove",this.mousemove),r.addEventListener(t.window,"mouseup",this.mouseup)},Pn.prototype.mousemove=function(t){this.move(t,r.mousePos(this.element,t))},Pn.prototype.mouseup=function(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()},Pn.prototype.touchstart=function(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=r.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return t.preventDefault()}},this._startPos))},Pn.prototype.touchmove=function(t){1!==t.targetTouches.length?this.reset():(this._lastPos=r.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:function(){return t.preventDefault()}},this._lastPos))},Pn.prototype.touchend=function(t){0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Pn.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Dn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Un(t,e,r){var i=t.classList;for(var n in Dn)i.remove("mapboxgl-"+r+"-anchor-"+n);i.add("mapboxgl-"+r+"-anchor-"+e)}var kn,zn=function(e){function i(i,n){if(e.call(this),(i instanceof t.window.HTMLElement||n)&&(i=t.extend({element:i},n)),t.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&"auto"!==i.pitchAlignment?i.pitchAlignment:this._rotationAlignment,i&&i.element)this._element=i.element,this._offset=t.Point.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=r.create("div"),this._element.setAttribute("aria-label","Map marker");var o=r.createNS("http://www.w3.org/2000/svg","svg");o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height","41px"),o.setAttributeNS(null,"width","27px"),o.setAttributeNS(null,"viewBox","0 0 27 41");var a=r.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"stroke","none"),a.setAttributeNS(null,"stroke-width","1"),a.setAttributeNS(null,"fill","none"),a.setAttributeNS(null,"fill-rule","evenodd");var s=r.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"fill-rule","nonzero");var l=r.createNS("http://www.w3.org/2000/svg","g");l.setAttributeNS(null,"transform","translate(3.0, 29.0)"),l.setAttributeNS(null,"fill","#000000");for(var c=0,u=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];c<u.length;c+=1){var h=u[c],A=r.createNS("http://www.w3.org/2000/svg","ellipse");A.setAttributeNS(null,"opacity","0.04"),A.setAttributeNS(null,"cx","10.5"),A.setAttributeNS(null,"cy","5.80029008"),A.setAttributeNS(null,"rx",h.rx),A.setAttributeNS(null,"ry",h.ry),l.appendChild(A)}var p=r.createNS("http://www.w3.org/2000/svg","g");p.setAttributeNS(null,"fill",this._color);var d=r.createNS("http://www.w3.org/2000/svg","path");d.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),p.appendChild(d);var f=r.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"opacity","0.25"),f.setAttributeNS(null,"fill","#000000");var m=r.createNS("http://www.w3.org/2000/svg","path");m.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),f.appendChild(m);var g=r.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"transform","translate(6.0, 7.0)"),g.setAttributeNS(null,"fill","#FFFFFF");var _=r.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"transform","translate(8.0, 8.0)");var y=r.createNS("http://www.w3.org/2000/svg","circle");y.setAttributeNS(null,"fill","#000000"),y.setAttributeNS(null,"opacity","0.25"),y.setAttributeNS(null,"cx","5.5"),y.setAttributeNS(null,"cy","5.5"),y.setAttributeNS(null,"r","5.4999962");var v=r.createNS("http://www.w3.org/2000/svg","circle");v.setAttributeNS(null,"fill","#FFFFFF"),v.setAttributeNS(null,"cx","5.5"),v.setAttributeNS(null,"cy","5.5"),v.setAttributeNS(null,"r","5.4999962"),_.appendChild(y),_.appendChild(v),s.appendChild(l),s.appendChild(p),s.appendChild(f),s.appendChild(g),s.appendChild(_),o.appendChild(s),o.setAttributeNS(null,"height",41*this._scale+"px"),o.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(o),this._offset=t.Point.convert(i&&i.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(function(t){t.preventDefault()})),this._element.addEventListener("mousedown",(function(t){t.preventDefault()})),Un(this._element,this._anchor,"marker"),this._popup=null}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.addTo=function(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},i.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),r.remove(this._element),this._popup&&this._popup.remove(),this},i.prototype.getLngLat=function(){return this._lngLat},i.prototype.setLngLat=function(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},i.prototype.getElement=function(){return this._element},i.prototype.setPopup=function(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){var e=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[e,-1*(24.6+e)],"bottom-right":[-e,-1*(24.6+e)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},i.prototype._onKeyPress=function(t){var e=t.code,r=t.charCode||t.keyCode;"Space"!==e&&"Enter"!==e&&32!==r&&13!==r||this.togglePopup()},i.prototype._onMapClick=function(t){var e=t.originalEvent.target,r=this._element;this._popup&&(e===r||r.contains(e))&&this.togglePopup()},i.prototype.getPopup=function(){return this._popup},i.prototype.togglePopup=function(){var t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this},i.prototype._update=function(t){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Ln(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var e="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?e="rotateZ("+this._rotation+"deg)":"map"===this._rotationAlignment&&(e="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var i="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?i="rotateX(0deg)":"map"===this._pitchAlignment&&(i="rotateX("+this._map.getPitch()+"deg)"),t&&"moveend"!==t.type||(this._pos=this._pos.round()),r.setTransform(this._element,Dn[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+i+" "+e)}},i.prototype.getOffset=function(){return this._offset},i.prototype.setOffset=function(e){return this._offset=t.Point.convert(e),this._update(),this},i.prototype._onMove=function(e){if(!this._isDragging){var r=this._clickTolerance||this._map._clickTolerance;this._isDragging=e.point.dist(this._pointerdownPos)>=r}this._isDragging&&(this._pos=e.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.Event("dragstart"))),this.fire(new t.Event("drag")))},i.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new t.Event("dragend")),this._state="inactive"},i.prototype._addDragHandler=function(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},i.prototype.setDraggable=function(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},i.prototype.isDraggable=function(){return this._draggable},i.prototype.setRotation=function(t){return this._rotation=t||0,this._update(),this},i.prototype.getRotation=function(){return this._rotation},i.prototype.setRotationAlignment=function(t){return this._rotationAlignment=t||"auto",this._update(),this},i.prototype.getRotationAlignment=function(){return this._rotationAlignment},i.prototype.setPitchAlignment=function(t){return this._pitchAlignment=t&&"auto"!==t?t:this._rotationAlignment,this._update(),this},i.prototype.getPitchAlignment=function(){return this._pitchAlignment},i}(t.Evented),Rn={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},On=0,Qn=!1,Nn=function(e){function i(r){e.call(this),this.options=t.extend({},Rn,r),t.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.onAdd=function(e){var i;return this._map=e,this._container=r.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),i=this._setupUI,void 0!==kn?i(kn):void 0!==t.window.navigator.permissions?t.window.navigator.permissions.query({name:"geolocation"}).then((function(t){i(kn="denied"!==t.state)})):i(kn=!!t.window.navigator.geolocation),this._container},i.prototype.onRemove=function(){void 0!==this._geolocationWatchID&&(t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),r.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,On=0,Qn=!1},i.prototype._isOutOfMapMaxBounds=function(t){var e=this._map.getMaxBounds(),r=t.coords;return e&&(r.longitude<e.getWest()||r.longitude>e.getEast()||r.latitude<e.getSouth()||r.latitude>e.getNorth())},i.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},i.prototype._onSuccess=function(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new t.Event("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("geolocate",e)),this._finish()}},i.prototype._updateCamera=function(e){var r=new t.LngLat(e.coords.longitude,e.coords.latitude),i=e.coords.accuracy,n=this._map.getBearing(),o=t.extend({bearing:n},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(i),o,{geolocateSource:!0})},i.prototype._updateMarker=function(e){if(e){var r=new t.LngLat(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},i.prototype._updateCircleRadius=function(){var t=this._map._container.clientHeight/2,e=this._map.unproject([0,t]),r=this._map.unproject([1,t]),i=e.distanceTo(r),n=Math.ceil(2*this._accuracy/i);this._circleElement.style.width=n+"px",this._circleElement.style.height=n+"px"},i.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},i.prototype._onError=function(e){if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&Qn)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("error",e)),this._finish()}},i.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},i.prototype._setupUI=function(e){var i=this;if(this._container.addEventListener("contextmenu",(function(t){return t.preventDefault()})),this._geolocateButton=r.create("button","mapboxgl-ctrl-geolocate",this._container),r.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===e){t.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{var o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=r.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new zn(this._dotElement),this._circleElement=r.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new zn({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(function(e){e.geolocateSource||"ACTIVE_LOCK"!==i._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(i._watchState="BACKGROUND",i._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),i._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),i.fire(new t.Event("trackuserlocationend")))}))},i.prototype.trigger=function(){if(!this._setup)return t.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":On--,Qn=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){var e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++On>1?(e={maximumAge:6e5,timeout:0},Qn=!0):(e=this.options.positionOptions,Qn=!1),this._geolocationWatchID=t.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,e)}}else t.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},i.prototype._clearWatch=function(){t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},i}(t.Evented),Vn={maxWidth:100,unit:"metric"},Hn=function(e){this.options=t.extend({},Vn,e),t.bindAll(["_onMove","setUnit"],this)};function jn(t,e,r){var i=r&&r.maxWidth||100,n=t._container.clientHeight/2,o=t.unproject([0,n]),a=t.unproject([i,n]),s=o.distanceTo(a);if(r&&"imperial"===r.unit){var l=3.2808*s;l>5280?Gn(e,i,l/5280,t._getUIString("ScaleControl.Miles")):Gn(e,i,l,t._getUIString("ScaleControl.Feet"))}else r&&"nautical"===r.unit?Gn(e,i,s/1852,t._getUIString("ScaleControl.NauticalMiles")):s>=1e3?Gn(e,i,s/1e3,t._getUIString("ScaleControl.Kilometers")):Gn(e,i,s,t._getUIString("ScaleControl.Meters"))}function Gn(t,e,r,i){var n,o,a,s,l,c=(n=r,(o=Math.pow(10,(""+Math.floor(n)).length-1))*(a=(a=n/o)>=10?10:a>=5?5:a>=3?3:a>=2?2:a>=1?1:(s=a,l=Math.pow(10,Math.ceil(-Math.log(s)/Math.LN10)),Math.round(s*l)/l)));t.style.width=e*(c/r)+"px",t.innerHTML=c+"&nbsp;"+i}Hn.prototype.getDefaultPosition=function(){return"bottom-left"},Hn.prototype._onMove=function(){jn(this._map,this._container,this.options)},Hn.prototype.onAdd=function(t){return this._map=t,this._container=r.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Hn.prototype.onRemove=function(){r.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Hn.prototype.setUnit=function(t){this.options.unit=t,jn(this._map,this._container,this.options)};var Kn=function(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof t.window.HTMLElement?this._container=e.container:t.warnOnce("Full screen control 'container' must be a DOM element.")),t.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in t.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in t.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in t.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in t.window.document&&(this._fullscreenchange="MSFullscreenChange")};Kn.prototype.onAdd=function(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=r.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Kn.prototype.onRemove=function(){r.remove(this._controlContainer),this._map=null,t.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Kn.prototype._checkFullscreenSupport=function(){return!!(t.window.document.fullscreenEnabled||t.window.document.mozFullScreenEnabled||t.window.document.msFullscreenEnabled||t.window.document.webkitFullscreenEnabled)},Kn.prototype._setupUI=function(){var e=this._fullscreenButton=r.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);r.create("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden",!0),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),t.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Kn.prototype._updateTitle=function(){var t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.title=t},Kn.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Kn.prototype._isFullscreen=function(){return this._fullscreen},Kn.prototype._changeIcon=function(){(t.window.document.fullscreenElement||t.window.document.mozFullScreenElement||t.window.document.webkitFullscreenElement||t.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Kn.prototype._onClickFullscreen=function(){this._isFullscreen()?t.window.document.exitFullscreen?t.window.document.exitFullscreen():t.window.document.mozCancelFullScreen?t.window.document.mozCancelFullScreen():t.window.document.msExitFullscreen?t.window.document.msExitFullscreen():t.window.document.webkitCancelFullScreen&&t.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var qn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Zn=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Wn=function(e){function i(r){e.call(this),this.options=t.extend(Object.create(qn),r),t.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.addTo=function(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new t.Event("open")),this},i.prototype.isOpen=function(){return!!this._map},i.prototype.remove=function(){return this._content&&r.remove(this._content),this._container&&(r.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new t.Event("close")),this},i.prototype.getLngLat=function(){return this._lngLat},i.prototype.setLngLat=function(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},i.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},i.prototype.getElement=function(){return this._container},i.prototype.setText=function(e){return this.setDOMContent(t.window.document.createTextNode(e))},i.prototype.setHTML=function(e){var r,i=t.window.document.createDocumentFragment(),n=t.window.document.createElement("body");for(n.innerHTML=e;r=n.firstChild;)i.appendChild(r);return this.setDOMContent(i)},i.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},i.prototype.setMaxWidth=function(t){return this.options.maxWidth=t,this._update(),this},i.prototype.setDOMContent=function(t){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=r.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(t),this._createCloseButton(),this._update(),this._focusFirstElement(),this},i.prototype.addClassName=function(t){this._container&&this._container.classList.add(t)},i.prototype.removeClassName=function(t){this._container&&this._container.classList.remove(t)},i.prototype.setOffset=function(t){return this.options.offset=t,this._update(),this},i.prototype.toggleClassName=function(t){if(this._container)return this._container.classList.toggle(t)},i.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=r.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},i.prototype._onMouseUp=function(t){this._update(t.point)},i.prototype._onMouseMove=function(t){this._update(t.point)},i.prototype._onDrag=function(t){this._update(t.point)},i.prototype._update=function(e){var i=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=r.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=r.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach((function(t){return i._container.classList.add(t)})),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ln(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||e)){var n=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat),o=this.options.anchor,a=function e(r){if(r){if("number"==typeof r){var i=Math.round(Math.sqrt(.5*Math.pow(r,2)));return{center:new t.Point(0,0),top:new t.Point(0,r),"top-left":new t.Point(i,i),"top-right":new t.Point(-i,i),bottom:new t.Point(0,-r),"bottom-left":new t.Point(i,-i),"bottom-right":new t.Point(-i,-i),left:new t.Point(r,0),right:new t.Point(-r,0)}}if(r instanceof t.Point||Array.isArray(r)){var n=t.Point.convert(r);return{center:n,top:n,"top-left":n,"top-right":n,bottom:n,"bottom-left":n,"bottom-right":n,left:n,right:n}}return{center:t.Point.convert(r.center||[0,0]),top:t.Point.convert(r.top||[0,0]),"top-left":t.Point.convert(r["top-left"]||[0,0]),"top-right":t.Point.convert(r["top-right"]||[0,0]),bottom:t.Point.convert(r.bottom||[0,0]),"bottom-left":t.Point.convert(r["bottom-left"]||[0,0]),"bottom-right":t.Point.convert(r["bottom-right"]||[0,0]),left:t.Point.convert(r.left||[0,0]),right:t.Point.convert(r.right||[0,0])}}return e(new t.Point(0,0))}(this.options.offset);if(!o){var s,l=this._container.offsetWidth,c=this._container.offsetHeight;s=n.y+a.bottom.y<c?["top"]:n.y>this._map.transform.height-c?["bottom"]:[],n.x<l/2?s.push("left"):n.x>this._map.transform.width-l/2&&s.push("right"),o=0===s.length?"bottom":s.join("-")}var u=n.add(a[o]).round();r.setTransform(this._container,Dn[o]+" translate("+u.x+"px,"+u.y+"px)"),Un(this._container,o,"popup")}},i.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var t=this._container.querySelector(Zn);t&&t.focus()}},i.prototype._onClose=function(){this.remove()},i}(t.Evented),Xn={version:t.version,supported:e,setRTLTextPlugin:t.setRTLTextPlugin,getRTLTextPluginStatus:t.getRTLTextPluginStatus,Map:In,NavigationControl:Fn,GeolocateControl:Nn,AttributionControl:vn,ScaleControl:Hn,FullscreenControl:Kn,Popup:Wn,Marker:zn,Style:He,LngLat:t.LngLat,LngLatBounds:t.LngLatBounds,Point:t.Point,MercatorCoordinate:t.MercatorCoordinate,Evented:t.Evented,config:t.config,prewarm:function(){Rt().acquire(Dt)},clearPrewarmedResources:function(){var t=kt;t&&(t.isPreloaded()&&1===t.numActive()?(t.release(Dt),kt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return t.config.ACCESS_TOKEN},set accessToken(e){t.config.ACCESS_TOKEN=e},get baseApiUrl(){return t.config.API_URL},set baseApiUrl(e){t.config.API_URL=e},get workerCount(){return Ut.workerCount},set workerCount(t){Ut.workerCount=t},get maxParallelImageRequests(){return t.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){t.config.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage:function(e){t.clearTileCache(e)},workerUrl:""};return Xn})),r}()},Lb(Ub={path:Db,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null!=e||Ub.path)}},Ub.exports),Ub.exports);kb.AttributionControl,kb.Evented,kb.FullscreenControl,kb.GeolocateControl,kb.LngLat,kb.LngLatBounds,kb.Map,kb.Marker,kb.MercatorCoordinate,kb.NavigationControl,kb.Point,kb.Popup,kb.ScaleControl,kb.Style,kb.accessToken,kb.baseApiUrl,kb.clearPrewarmedResources,kb.clearStorage,kb.config,kb.getRTLTextPluginStatus,kb.maxParallelImageRequests,kb.prewarm,kb.setRTLTextPlugin,kb.supported,kb.version,kb.workerCount,kb.workerUrl;function zb(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,i=Xe(t);if(e){var n=Xe(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return We(this,r)}}function Rb(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function Ob(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Rb(Object(r),!0).forEach((function(e){tr(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Rb(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Qb(t){lu(t,"svelte-1g0va6n","svelte-scroller-foreground{pointer-events:none !important}svelte-scroller-foreground section div{pointer-events:all !important}.chart.svelte-1g0va6n{margin-top:45px;width:calc(100% - 5px)}")}function Nb(t){var e;return{c:function(){e=du("Scroll to begin")},m:function(t,r){cu(t,e,r)},d:function(t){t&&uu(e)}}}function Vb(t){var e,r,i,n,o,a,s;return a=new Ey({props:{color:"black",animation:t[6],$$slots:{default:[Nb]},$$scope:{ctx:t}}}),{c:function(){(e=Au("h1")).textContent="PeaceRep",r=fu(),(i=Au("p")).textContent="Third-Party Actors in Peace Agreements",n=fu(),o=Au("div"),Zu(a.$$.fragment),_u(i,"class","text-big"),xu(i,"margin-top","5px"),xu(o,"margin-top","90px")},m:function(t,l){cu(t,e,l),cu(t,r,l),cu(t,i,l),cu(t,n,l),cu(t,o,l),Wu(a,o,null),s=!0},p:function(t,e){var r={};512&e[1]&&(r.$$scope={dirty:e,ctx:t}),a.$set(r)},i:function(t){s||(Gu(a.$$.fragment,t),s=!0)},o:function(t){Ku(a.$$.fragment,t),s=!1},d:function(t){t&&uu(e),t&&uu(r),t&&uu(i),t&&uu(n),t&&uu(o),Xu(a)}}}function Hb(t){var e;return{c:function(){(e=Au("p")).textContent="Timeline of Agreements",_u(e,"class","text-big")},m:function(t,r){cu(t,e,r)},p:Kc,d:function(t){t&&uu(e)}}}function jb(t){var e,r,i;return r=new uv({props:{beeswarm_data:t[2],just_year_parser:t[7]}}),{c:function(){e=Au("div"),Zu(r.$$.fragment),_u(e,"class","chart svelte-1g0va6n")},m:function(t,n){cu(t,e,n),Wu(r,e,null),i=!0},p:function(t,e){var i={};4&e[0]&&(i.beeswarm_data=t[2]),r.$set(i)},i:function(t){i||(Gu(r.$$.fragment,t),i=!0)},o:function(t){Ku(r.$$.fragment,t),i=!1},d:function(t){t&&uu(e),Xu(r)}}}function Gb(t){var e,r,i,n,o=t[2]&&jb(t);return{c:function(){e=Au("div"),r=Au("figure"),i=Au("div"),o&&o.c(),_u(i,"class","col-wide height-full"),_u(e,"slot","background")},m:function(t,a){cu(t,e,a),su(e,r),su(r,i),o&&o.m(i,null),n=!0},p:function(t,e){t[2]?o?(o.p(t,e),4&e[0]&&Gu(o,1)):((o=jb(t)).c(),Gu(o,1),o.m(i,null)):o&&(Hu(),Ku(o,1,1,(function(){o=null})),ju())},i:function(t){n||(Gu(o),n=!0)},o:function(t){Ku(o),n=!1},d:function(t){t&&uu(e),o&&o.d()}}}function Kb(t){var e;return{c:function(){(e=Au("div")).innerHTML='<section data-id="chart01"><div class="col-medium"><p>Russia has most often acted as a third-party signatory in\n\t\t\t\t\tthe 1990s. Majority of these agreements relate to the\n\t\t\t\t\tdissolution of the Soviet Union.</p></div></section> \n\t\t<section data-id="chart02"><div class="col-medium"><p>Russia has most often acted as a third-party signatory in\n\t\t\t\t\tthe 1990s. Majority of these agreements relate to the\n\t\t\t\t\tdissolution of the Soviet Union.</p></div></section> \n\t\t<section data-id="chart03"><div class="col-medium"><p>Russia has most often acted as a third-party signatory in\n\t\t\t\t\tthe 1990s. Majority of these agreements relate to the\n\t\t\t\t\tdissolution of the Soviet Union.</p></div></section> \n\t\t<section data-id="chart04"><div class="col-medium"><p>Russia has most often acted as a third-party signatory in\n\t\t\t\t\tthe 1990s. Majority of these agreements relate to the\n\t\t\t\t\tdissolution of the Soviet Union.</p></div></section> \n\t\t<section data-id="chart05"><div class="col-medium"><h3>Select a district</h3> \n\t\t\t\t<p>Russia has most often acted as a third-party signatory in\n\t\t\t\t\tthe 1990s. Majority of these agreements relate to the\n\t\t\t\t\tdissolution of the Soviet Union.</p></div></section>',_u(e,"slot","foreground")},m:function(t,r){cu(t,e,r)},p:Kc,d:function(t){t&&uu(e)}}}function qb(t){var e;return{c:function(){(e=Au("p")).textContent="Russia and other UN Security Council Permanent Members",_u(e,"class","text-big")},m:function(t,r){cu(t,e,r)},p:Kc,d:function(t){t&&uu(e)}}}function Zb(t){var e,r,i;return r=new vv({props:{areachart_data:t[3],just_year_parser:t[7]}}),{c:function(){e=Au("div"),Zu(r.$$.fragment),_u(e,"class","chart svelte-1g0va6n")},m:function(t,n){cu(t,e,n),Wu(r,e,null),i=!0},p:function(t,e){var i={};8&e[0]&&(i.areachart_data=t[3]),r.$set(i)},i:function(t){i||(Gu(r.$$.fragment,t),i=!0)},o:function(t){Ku(r.$$.fragment,t),i=!1},d:function(t){t&&uu(e),Xu(r)}}}function Wb(t){var e,r,i,n,o=t[3]&&Zb(t);return{c:function(){e=Au("div"),r=Au("figure"),i=Au("div"),o&&o.c(),_u(i,"class","col-wide height-full"),_u(e,"slot","background")},m:function(t,a){cu(t,e,a),su(e,r),su(r,i),o&&o.m(i,null),n=!0},p:function(t,e){t[3]?o?(o.p(t,e),8&e[0]&&Gu(o,1)):((o=Zb(t)).c(),Gu(o,1),o.m(i,null)):o&&(Hu(),Ku(o,1,1,(function(){o=null})),ju())},i:function(t){n||(Gu(o),n=!0)},o:function(t){Ku(o),n=!1},d:function(t){t&&uu(e),o&&o.d()}}}function Xb(t){var e;return{c:function(){(e=Au("div")).innerHTML='<section data-id="chart01"><div class="col-medium"><p>Russia has most often acted as a third-party signatory in\n\t\t\t\t\tthe 1990s. Majority of these agreements relate to the\n\t\t\t\t\tdissolution of the Soviet Union.</p></div></section> \n\t\t<section data-id="chart02"><div class="col-medium"><p>Russia has most often acted as a third-party signatory in\n\t\t\t\t\tthe 1990s. Majority of these agreements relate to the\n\t\t\t\t\tdissolution of the Soviet Union.</p></div></section> \n\t\t<section data-id="chart03"><div class="col-medium"><p>Russia has most often acted as a third-party signatory in\n\t\t\t\t\tthe 1990s. Majority of these agreements relate to the\n\t\t\t\t\tdissolution of the Soviet Union.</p></div></section> \n\t\t<section data-id="chart04"><div class="col-medium"><p>Russia has most often acted as a third-party signatory in\n\t\t\t\t\tthe 1990s. Majority of these agreements relate to the\n\t\t\t\t\tdissolution of the Soviet Union.</p></div></section> \n\t\t<section data-id="chart05"><div class="col-medium"><h3>Select a district</h3> \n\t\t\t\t<p>Russia has most often acted as a third-party signatory in\n\t\t\t\t\tthe 1990s. Majority of these agreements relate to the\n\t\t\t\t\tdissolution of the Soviet Union.</p></div></section>',_u(e,"slot","foreground")},m:function(t,r){cu(t,e,r)},p:Kc,d:function(t){t&&uu(e)}}}function $b(t){var e;return{c:function(){(e=Au("p")).textContent="Agreement Stages",_u(e,"class","text-big")},m:function(t,r){cu(t,e,r)},p:Kc,d:function(t){t&&uu(e)}}}function Yb(t){var e,r,i;return r=new Mv({props:{donut_data:t[4]}}),{c:function(){e=Au("div"),Zu(r.$$.fragment),_u(e,"class","chart svelte-1g0va6n")},m:function(t,n){cu(t,e,n),Wu(r,e,null),i=!0},p:function(t,e){var i={};16&e[0]&&(i.donut_data=t[4]),r.$set(i)},i:function(t){i||(Gu(r.$$.fragment,t),i=!0)},o:function(t){Ku(r.$$.fragment,t),i=!1},d:function(t){t&&uu(e),Xu(r)}}}function Jb(t){var e,r,i,n,o=t[4]&&Yb(t);return{c:function(){e=Au("div"),r=Au("figure"),i=Au("div"),o&&o.c(),_u(i,"class","col-wide height-full"),_u(e,"slot","background")},m:function(t,a){cu(t,e,a),su(e,r),su(r,i),o&&o.m(i,null),n=!0},p:function(t,e){t[4]?o?(o.p(t,e),16&e[0]&&Gu(o,1)):((o=Yb(t)).c(),Gu(o,1),o.m(i,null)):o&&(Hu(),Ku(o,1,1,(function(){o=null})),ju())},i:function(t){n||(Gu(o),n=!0)},o:function(t){Ku(o),n=!1},d:function(t){t&&uu(e),o&&o.d()}}}function tB(t){var e;return{c:function(){(e=Au("div")).innerHTML='<section data-id="chart01"><div class="col-medium"><p>Russia has most often acted as a third-party signatory in\n\t\t\t\t\tthe 1990s. Majority of these agreements relate to the\n\t\t\t\t\tdissolution of the Soviet Union.</p></div></section> \n\t\t<section data-id="chart02"><div class="col-medium"><p>Russia has most often acted as a third-party signatory in\n\t\t\t\t\tthe 1990s. Majority of these agreements relate to the\n\t\t\t\t\tdissolution of the Soviet Union.</p></div></section> \n\t\t<section data-id="chart03"><div class="col-medium"><p>Russia has most often acted as a third-party signatory in\n\t\t\t\t\tthe 1990s. Majority of these agreements relate to the\n\t\t\t\t\tdissolution of the Soviet Union.</p></div></section> \n\t\t<section data-id="chart04"><div class="col-medium"><p>Russia has most often acted as a third-party signatory in\n\t\t\t\t\tthe 1990s. Majority of these agreements relate to the\n\t\t\t\t\tdissolution of the Soviet Union.</p></div></section> \n\t\t<section data-id="chart05"><div class="col-medium"><h3>Select a district</h3> \n\t\t\t\t<p>Russia has most often acted as a third-party signatory in\n\t\t\t\t\tthe 1990s. Majority of these agreements relate to the\n\t\t\t\t\tdissolution of the Soviet Union.</p></div></section>',_u(e,"slot","foreground")},m:function(t,r){cu(t,e,r)},p:Kc,d:function(t){t&&uu(e)}}}function eB(t){var e;return{c:function(){(e=Au("p")).textContent="Comparison of Agreement Stages",_u(e,"class","text-big")},m:function(t,r){cu(t,e,r)},p:Kc,d:function(t){t&&uu(e)}}}function rB(t){var e,r,i;return r=new Vv({props:{barchart_data:t[5]}}),{c:function(){e=Au("div"),Zu(r.$$.fragment),_u(e,"class","chart svelte-1g0va6n")},m:function(t,n){cu(t,e,n),Wu(r,e,null),i=!0},p:function(t,e){var i={};32&e[0]&&(i.barchart_data=t[5]),r.$set(i)},i:function(t){i||(Gu(r.$$.fragment,t),i=!0)},o:function(t){Ku(r.$$.fragment,t),i=!1},d:function(t){t&&uu(e),Xu(r)}}}function iB(t){var e,r,i,n,o=t[5]&&rB(t);return{c:function(){e=Au("div"),r=Au("figure"),i=Au("div"),o&&o.c(),_u(i,"class","col-wide height-full"),_u(e,"slot","background")},m:function(t,a){cu(t,e,a),su(e,r),su(r,i),o&&o.m(i,null),n=!0},p:function(t,e){t[5]?o?(o.p(t,e),32&e[0]&&Gu(o,1)):((o=rB(t)).c(),Gu(o,1),o.m(i,null)):o&&(Hu(),Ku(o,1,1,(function(){o=null})),ju())},i:function(t){n||(Gu(o),n=!0)},o:function(t){Ku(o),n=!1},d:function(t){t&&uu(e),o&&o.d()}}}function nB(t){var e;return{c:function(){(e=Au("div")).innerHTML='<section data-id="chart01"><div class="col-medium"><p>Russia has most often acted as a third-party signatory in\n\t\t\t\t\tthe 1990s. Majority of these agreements relate to the\n\t\t\t\t\tdissolution of the Soviet Union.</p></div></section> \n\t\t<section data-id="chart02"><div class="col-medium"><p>Russia has most often acted as a third-party signatory in\n\t\t\t\t\tthe 1990s. Majority of these agreements relate to the\n\t\t\t\t\tdissolution of the Soviet Union.</p></div></section> \n\t\t<section data-id="chart03"><div class="col-medium"><p>Russia has most often acted as a third-party signatory in\n\t\t\t\t\tthe 1990s. Majority of these agreements relate to the\n\t\t\t\t\tdissolution of the Soviet Union.</p></div></section> \n\t\t<section data-id="chart04"><div class="col-medium"><p>Russia has most often acted as a third-party signatory in\n\t\t\t\t\tthe 1990s. Majority of these agreements relate to the\n\t\t\t\t\tdissolution of the Soviet Union.</p></div></section> \n\t\t<section data-id="chart05"><div class="col-medium"><h3>Select a district</h3> \n\t\t\t\t<p>Russia has most often acted as a third-party signatory in\n\t\t\t\t\tthe 1990s. Majority of these agreements relate to the\n\t\t\t\t\tdissolution of the Soviet Union.</p></div></section>',_u(e,"slot","foreground")},m:function(t,r){cu(t,e,r)},p:Kc,d:function(t){t&&uu(e)}}}function oB(t){var e;return{c:function(){(e=Au("p")).textContent="Geography",_u(e,"class","text-big")},m:function(t,r){cu(t,e,r)},p:Kc,d:function(t){t&&uu(e)}}}function aB(t){var e,r,i;function n(e){t[15](e)}var o={threshold:AB,$$slots:{foreground:[lB],background:[sB]},$$scope:{ctx:t}};return void 0!==t[0].map&&(o.id=t[0].map),e=new ay({props:o}),Mu.push((function(){return qu(e,"id",n)})),{c:function(){Zu(e.$$.fragment)},m:function(t,r){Wu(e,t,r),i=!0},p:function(t,i){var n={};2&i[0]|512&i[1]&&(n.$$scope={dirty:i,ctx:t}),!r&&1&i[0]&&(r=!0,n.id=t[0].map,ku((function(){return r=!1}))),e.$set(n)},i:function(t){i||(Gu(e.$$.fragment,t),i=!0)},o:function(t){Ku(e.$$.fragment,t),i=!1},d:function(t){Xu(e,t)}}}function sB(t){var e,r,i,n,o;return n=new Zv({props:{mygeojson:t[1]}}),{c:function(){e=Au("div"),r=Au("figure"),i=Au("div"),Zu(n.$$.fragment),_u(i,"class","col-full height-full"),_u(e,"slot","background")},m:function(t,a){cu(t,e,a),su(e,r),su(r,i),Wu(n,i,null),o=!0},p:function(t,e){var r={};2&e[0]&&(r.mygeojson=t[1]),n.$set(r)},i:function(t){o||(Gu(n.$$.fragment,t),o=!0)},o:function(t){Ku(n.$$.fragment,t),o=!1},d:function(t){t&&uu(e),Xu(n)}}}function lB(t){var e;return{c:function(){(e=Au("div")).innerHTML='<section data-id="map01"><div class="col-medium"><p>Russia has most often acted as a third-party signatory\n\t\t\t\t\t\tin the 1990s. Majority of these agreements relate to the\n\t\t\t\t\t\tdissolution of the Soviet Union.</p></div></section> \n\t\t\t<section data-id="map02"><div class="col-medium"><p>Russia has most often acted as a third-party signatory\n\t\t\t\t\t\tin the 1990s. Majority of these agreements relate to the\n\t\t\t\t\t\tdissolution of the Soviet Union.</p></div></section> \n\t\t\t<section data-id="map03"><div class="col-medium"><p>Russia has most often acted as a third-party signatory\n\t\t\t\t\t\tin the 1990s. Majority of these agreements relate to the\n\t\t\t\t\t\tdissolution of the Soviet Union.</p></div></section> \n\t\t\t<section data-id="map04"><div class="col-medium"><h3>Select a district</h3> \n\t\t\t\t\t<p>Russia has most often acted as a third-party signatory\n\t\t\t\t\t\tin the 1990s. Majority of these agreements relate to the\n\t\t\t\t\t\tdissolution of the Soviet Union.</p></div></section>',_u(e,"slot","foreground")},m:function(t,r){cu(t,e,r)},p:Kc,d:function(t){t&&uu(e)}}}function cB(t){var e,r,i;return{c:function(){(e=Au("h2")).textContent="Research",r=fu(),(i=Au("p")).textContent="Read our research on Russia and its approaches to conflict, peace processes and mediation.",_u(i,"class","mb")},m:function(t,n){cu(t,e,n),cu(t,r,n),cu(t,i,n)},p:Kc,d:function(t){t&&uu(e),t&&uu(r),t&&uu(i)}}}function uB(t){var e,r,i,n,o,a,s,l,c,u,h,A,p,d,f,m,g,_,y,v,x,w,b,B,C,E,T,I,S,M,F;function P(e){t[11](e)}e=new k_({props:{filled:!0,center:!1}}),i=new N_({props:{bgcolor:"white",bgfixed:!0,theme:"light",center:!0,short:!1,$$slots:{default:[Vb]},$$scope:{ctx:t}}}),o=new hy({props:{theme:"light",short:!0,wide:!0,center:!0,$$slots:{default:[Hb]},$$scope:{ctx:t}}});var L={threshold:AB,splitscreen:!0,$$slots:{foreground:[Kb],background:[Gb]},$$scope:{ctx:t}};function D(e){t[12](e)}void 0!==t[0].chart&&(L.id=t[0].chart),s=new ay({props:L}),Mu.push((function(){return qu(s,"id",P)})),u=new hy({props:{theme:"light",short:!0,wide:!0,center:!0,$$slots:{default:[qb]},$$scope:{ctx:t}}});var U={threshold:AB,splitscreen:!0,$$slots:{foreground:[Xb],background:[Wb]},$$scope:{ctx:t}};function k(e){t[13](e)}void 0!==t[0].chart&&(U.id=t[0].chart),A=new ay({props:U}),Mu.push((function(){return qu(A,"id",D)})),f=new hy({props:{theme:"light",short:!0,wide:!0,center:!0,$$slots:{default:[$b]},$$scope:{ctx:t}}});var z={threshold:AB,splitscreen:!0,$$slots:{foreground:[tB],background:[Jb]},$$scope:{ctx:t}};function R(e){t[14](e)}void 0!==t[0].chart&&(z.id=t[0].chart),g=new ay({props:z}),Mu.push((function(){return qu(g,"id",k)})),v=new hy({props:{theme:"light",short:!0,wide:!0,center:!0,$$slots:{default:[eB]},$$scope:{ctx:t}}});var O={threshold:AB,splitscreen:!0,$$slots:{foreground:[nB],background:[iB]},$$scope:{ctx:t}};void 0!==t[0].chart&&(O.id=t[0].chart),w=new ay({props:O}),Mu.push((function(){return qu(w,"id",R)})),C=new hy({props:{theme:"light",short:!0,wide:!0,center:!0,$$slots:{default:[oB]},$$scope:{ctx:t}}});var Q=t[1]&&aB(t);return I=new G_({props:{$$slots:{default:[cB]},$$scope:{ctx:t}}}),M=new _y({}),{c:function(){Zu(e.$$.fragment),r=fu(),Zu(i.$$.fragment),n=fu(),Zu(o.$$.fragment),a=fu(),Zu(s.$$.fragment),c=fu(),Zu(u.$$.fragment),h=fu(),Zu(A.$$.fragment),d=fu(),Zu(f.$$.fragment),m=fu(),Zu(g.$$.fragment),y=fu(),Zu(v.$$.fragment),x=fu(),Zu(w.$$.fragment),B=fu(),Zu(C.$$.fragment),E=fu(),Q&&Q.c(),T=fu(),Zu(I.$$.fragment),S=fu(),Zu(M.$$.fragment)},m:function(t,l){Wu(e,t,l),cu(t,r,l),Wu(i,t,l),cu(t,n,l),Wu(o,t,l),cu(t,a,l),Wu(s,t,l),cu(t,c,l),Wu(u,t,l),cu(t,h,l),Wu(A,t,l),cu(t,d,l),Wu(f,t,l),cu(t,m,l),Wu(g,t,l),cu(t,y,l),Wu(v,t,l),cu(t,x,l),Wu(w,t,l),cu(t,B,l),Wu(C,t,l),cu(t,E,l),Q&&Q.m(t,l),cu(t,T,l),Wu(I,t,l),cu(t,S,l),Wu(M,t,l),F=!0},p:function(t,e){var r={};512&e[1]&&(r.$$scope={dirty:e,ctx:t}),i.$set(r);var n={};512&e[1]&&(n.$$scope={dirty:e,ctx:t}),o.$set(n);var a={};4&e[0]|512&e[1]&&(a.$$scope={dirty:e,ctx:t}),!l&&1&e[0]&&(l=!0,a.id=t[0].chart,ku((function(){return l=!1}))),s.$set(a);var c={};512&e[1]&&(c.$$scope={dirty:e,ctx:t}),u.$set(c);var h={};8&e[0]|512&e[1]&&(h.$$scope={dirty:e,ctx:t}),!p&&1&e[0]&&(p=!0,h.id=t[0].chart,ku((function(){return p=!1}))),A.$set(h);var d={};512&e[1]&&(d.$$scope={dirty:e,ctx:t}),f.$set(d);var m={};16&e[0]|512&e[1]&&(m.$$scope={dirty:e,ctx:t}),!_&&1&e[0]&&(_=!0,m.id=t[0].chart,ku((function(){return _=!1}))),g.$set(m);var y={};512&e[1]&&(y.$$scope={dirty:e,ctx:t}),v.$set(y);var x={};32&e[0]|512&e[1]&&(x.$$scope={dirty:e,ctx:t}),!b&&1&e[0]&&(b=!0,x.id=t[0].chart,ku((function(){return b=!1}))),w.$set(x);var B={};512&e[1]&&(B.$$scope={dirty:e,ctx:t}),C.$set(B),t[1]?Q?(Q.p(t,e),2&e[0]&&Gu(Q,1)):((Q=aB(t)).c(),Gu(Q,1),Q.m(T.parentNode,T)):Q&&(Hu(),Ku(Q,1,1,(function(){Q=null})),ju());var E={};512&e[1]&&(E.$$scope={dirty:e,ctx:t}),I.$set(E)},i:function(t){F||(Gu(e.$$.fragment,t),Gu(i.$$.fragment,t),Gu(o.$$.fragment,t),Gu(s.$$.fragment,t),Gu(u.$$.fragment,t),Gu(A.$$.fragment,t),Gu(f.$$.fragment,t),Gu(g.$$.fragment,t),Gu(v.$$.fragment,t),Gu(w.$$.fragment,t),Gu(C.$$.fragment,t),Gu(Q),Gu(I.$$.fragment,t),Gu(M.$$.fragment,t),F=!0)},o:function(t){Ku(e.$$.fragment,t),Ku(i.$$.fragment,t),Ku(o.$$.fragment,t),Ku(s.$$.fragment,t),Ku(u.$$.fragment,t),Ku(A.$$.fragment,t),Ku(f.$$.fragment,t),Ku(g.$$.fragment,t),Ku(v.$$.fragment,t),Ku(w.$$.fragment,t),Ku(C.$$.fragment,t),Ku(Q),Ku(I.$$.fragment,t),Ku(M.$$.fragment,t),F=!1},d:function(t){Xu(e,t),t&&uu(r),Xu(i,t),t&&uu(n),Xu(o,t),t&&uu(a),Xu(s,t),t&&uu(c),Xu(u,t),t&&uu(h),Xu(A,t),t&&uu(d),Xu(f,t),t&&uu(m),Xu(g,t),t&&uu(y),Xu(v,t),t&&uu(x),Xu(w,t),t&&uu(B),Xu(C,t),t&&uu(E),Q&&Q.d(t),t&&uu(T),Xu(I,t),t&&uu(S),Xu(M,t)}}}var hB="light",AB=.65;function pB(t,e,r){var i;!function(t,e){Eu().$$.context.set(t,e)}("theme",hB),function(t,e){for(var r in t[e])document.documentElement.style.setProperty("--"+r,t[e][r])}(M_,hB);var n,o=!(!(n=window.matchMedia("(prefers-reduced-motion: reduce)"))||n.matches),a={},s={};Tu((function(){s=Ob({},a)}));var l,c={district:{},region:{}},u={district:{},region:{}};var h,A={map:{map01:function(){[]},map02:function(){[]},map03:function(){var t=Je(c.district.indicators).sort((function(t,e){return e.age_med-t.age_med}))[0];!function(t){l&&t&&Xv(l.features.find((function(e){return e.properties.AREACD==t})).geometry)}(t.code),[t.code]},map04:function(){[]}},chart:{chart01:function(){},chart02:function(){},chart03:function(){},chart04:function(){},chart05:function(){}}};["region","district"].forEach((function(t){(function(t){return T_.apply(this,arguments)})("./data/data_".concat(t,".csv")).then((function(e){var i=e.map((function(t){return{code:t.code,name:t.name,parent:t.parent?t.parent:null}})),n={};i.forEach((function(t){n[t.code]=t})),r(8,u[t].array=i,u),r(8,u[t].lookup=n,u);var o=e.map((function(t,e){return Ob(Ob({},i[e]),{},{area:t.area,pop:t[2020],density:t.density,age_med:t.age_med})}));"district"==t&&["density","age_med"].forEach((function(t){var e,r,i=o.map((function(e){return e[t]})).sort((function(t,e){return t-e})),n=(r=(e=i).length,[e[0],e[Math.floor(.2*r)],e[Math.floor(.4*r)],e[Math.floor(.6*r)],e[Math.floor(.8*r)],e[r-1]]);o.forEach((function(e,r){return o[r][t+"_color"]=function(t,e,r){for(var i,n=!1,o=1;0==n;)t<=e[o]?(i=r[o-1],n=!0):o++;return i||"lightgrey"}(e[t],n,F_)}))})),c[t].indicators=o;var a=[2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020],s=[];e.forEach((function(t){a.forEach((function(e){s.push({code:t.code,name:t.name,value:t[e],year:e})}))})),c[t].timeseries=s}))})),function(t,e){return I_.apply(this,arguments)}("./data/geo_lad2021.json","geog").then((function(t){t.features.sort((function(t,e){return t.properties.AREANM.localeCompare(e.properties.AREANM)})),l=t})),function(t){return S_.apply(this,arguments)}("./data/all_countries.json").then((function(t){r(1,h=t)}));var p,d,f,m,g,_=Pm("%Y-%m-%d"),y=Pm("%Y");return function(t){return E_.apply(this,arguments)}(["./data/agts_rus_china.csv","./data/paax_practical_third_labelled_signatories.csv"]).then((function(t){var e=t[0];e.forEach((function(t){t.AgtId=+t.AgtId,t.dat=t.date,t.date=_(t.date)}));var i=uA(e,(function(t){return t.global_actor}));p=i[0][1],i[1][1];var n=uA(e,(function(t){return t.AgtId}),(function(t){return t.date}));n.sort((function(t,e){return jh(t[1][0][0],e[1][0][0])})),r(2,d=n);var o=t[1],a=uA(o,(function(t){return+t.year}),(function(t){return t.AgtId}));a.sort((function(t,e){return jh(t[0],e[0])}));var s=[];a.forEach((function(t){s.push({date:y(t[0]),value:t[1].length})})),r(3,f=s);var l=uA(p,(function(t){return t.stage_label}),(function(t){return t.AgtId}));r(4,m=l);var c=function(t){var e=0;t.forEach((function(t){e+=t[1].length}));var r=[];return t.forEach((function(t){r.push({stage:t[0],percentage:t[1].length/e*100})})),r},u=uA(p,(function(t){return t.stage_label}),(function(t){return t.AgtId})),h=c(uA(o,(function(t){return t.stage_label}),(function(t){return t.AgtId}))),A=c(u),v=h.map((function(t){var e=A.find((function(e){return e.stage===t.stage}));return Ob(Ob({},t),{},{chart_data:e?e.percentage:0})})).map((function(t){return{group:t.stage,All:t.percentage,Russia:t.chart_data}}));v.forEach((function(t){"Framework-substantive, partial"===t.group?t.group="Partial":"Framework-substantive, comprehensive"===t.group&&(t.group="Comprehensive")})),r(5,g=v)})),t.$$.update=function(){768&t.$$.dirty[0]&&r(10,i=null),1280&t.$$.dirty[0]&&(u.district.array&&i?u.district.array.filter((function(t){return t.parent==i})).map((function(t){return t.code})):[]),1&t.$$.dirty[0]&&a&&function(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((function(t){a[t]!=s[t]&&(A[t][a[t]]&&A[t][a[t]](),s[t]=a[t])}))}(Object.keys(A))},[a,h,d,f,m,g,o,y,u,undefined,i,function(e){t.$$.not_equal(a.chart,e)&&(a.chart=e,r(0,a))},function(e){t.$$.not_equal(a.chart,e)&&(a.chart=e,r(0,a))},function(e){t.$$.not_equal(a.chart,e)&&(a.chart=e,r(0,a))},function(e){t.$$.not_equal(a.chart,e)&&(a.chart=e,r(0,a))},function(e){t.$$.not_equal(a.map,e)&&(a.map=e,r(0,a))}]}return new(function(t){qe(r,t);var e=zb(r);function r(t){var i;return je(this,r),Yu(Ge(i=e.call(this)),t,pB,uB,$c,{},Qb,[-1,-1]),i}return r}(Ju))({target:document.body})}();
//# sourceMappingURL=bundle.legacy.js.map
